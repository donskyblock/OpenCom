var HS=Object.defineProperty;var qh=e=>{throw TypeError(e)};var GS=(e,t,n)=>t in e?HS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>GS(e,typeof t!="symbol"?t+"":t,n),Xh=(e,t,n)=>t.has(e)||qh("Cannot "+n);var oe=(e,t,n)=>(Xh(e,t,"read from private field"),n?n.call(e):t.get(e)),Ke=(e,t,n)=>t.has(e)?qh("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ce=(e,t,n,r)=>(Xh(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function QS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rv={exports:{}},Zc={},sv={exports:{}},ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ya=Symbol.for("react.element"),KS=Symbol.for("react.portal"),YS=Symbol.for("react.fragment"),JS=Symbol.for("react.strict_mode"),qS=Symbol.for("react.profiler"),XS=Symbol.for("react.provider"),ZS=Symbol.for("react.context"),eC=Symbol.for("react.forward_ref"),tC=Symbol.for("react.suspense"),nC=Symbol.for("react.memo"),rC=Symbol.for("react.lazy"),Zh=Symbol.iterator;function sC(e){return e===null||typeof e!="object"?null:(e=Zh&&e[Zh]||e["@@iterator"],typeof e=="function"?e:null)}var iv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},av=Object.assign,ov={};function Ii(e,t,n){this.props=e,this.context=t,this.refs=ov,this.updater=n||iv}Ii.prototype.isReactComponent={};Ii.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ii.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function cv(){}cv.prototype=Ii.prototype;function cp(e,t,n){this.props=e,this.context=t,this.refs=ov,this.updater=n||iv}var lp=cp.prototype=new cv;lp.constructor=cp;av(lp,Ii.prototype);lp.isPureReactComponent=!0;var em=Array.isArray,lv=Object.prototype.hasOwnProperty,dp={current:null},dv={key:!0,ref:!0,__self:!0,__source:!0};function uv(e,t,n){var r,i={},a=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)lv.call(t,r)&&!dv.hasOwnProperty(r)&&(i[r]=t[r]);var f=arguments.length-2;if(f===1)i.children=n;else if(1<f){for(var h=Array(f),_=0;_<f;_++)h[_]=arguments[_+2];i.children=h}if(e&&e.defaultProps)for(r in f=e.defaultProps,f)i[r]===void 0&&(i[r]=f[r]);return{$$typeof:Ya,type:e,key:a,ref:o,props:i,_owner:dp.current}}function iC(e,t){return{$$typeof:Ya,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function up(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ya}function aC(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var tm=/\/+/g;function Rd(e,t){return typeof e=="object"&&e!==null&&e.key!=null?aC(""+e.key):t.toString(36)}function lc(e,t,n,r,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ya:case KS:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Rd(o,0):r,em(i)?(n="",e!=null&&(n=e.replace(tm,"$&/")+"/"),lc(i,t,n,"",function(_){return _})):i!=null&&(up(i)&&(i=iC(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(tm,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",em(e))for(var f=0;f<e.length;f++){a=e[f];var h=r+Rd(a,f);o+=lc(a,t,n,h,i)}else if(h=sC(e),typeof h=="function")for(e=h.call(e),f=0;!(a=e.next()).done;)a=a.value,h=r+Rd(a,f++),o+=lc(a,t,n,h,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Bo(e,t,n){if(e==null)return e;var r=[],i=0;return lc(e,r,"","",function(a){return t.call(n,a,i++)}),r}function oC(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var mt={current:null},dc={transition:null},cC={ReactCurrentDispatcher:mt,ReactCurrentBatchConfig:dc,ReactCurrentOwner:dp};function pv(){throw Error("act(...) is not supported in production builds of React.")}ue.Children={map:Bo,forEach:function(e,t,n){Bo(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Bo(e,function(){t++}),t},toArray:function(e){return Bo(e,function(t){return t})||[]},only:function(e){if(!up(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ue.Component=Ii;ue.Fragment=YS;ue.Profiler=qS;ue.PureComponent=cp;ue.StrictMode=JS;ue.Suspense=tC;ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cC;ue.act=pv;ue.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=av({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=dp.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var f=e.type.defaultProps;for(h in t)lv.call(t,h)&&!dv.hasOwnProperty(h)&&(r[h]=t[h]===void 0&&f!==void 0?f[h]:t[h])}var h=arguments.length-2;if(h===1)r.children=n;else if(1<h){f=Array(h);for(var _=0;_<h;_++)f[_]=arguments[_+2];r.children=f}return{$$typeof:Ya,type:e.type,key:i,ref:a,props:r,_owner:o}};ue.createContext=function(e){return e={$$typeof:ZS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:XS,_context:e},e.Consumer=e};ue.createElement=uv;ue.createFactory=function(e){var t=uv.bind(null,e);return t.type=e,t};ue.createRef=function(){return{current:null}};ue.forwardRef=function(e){return{$$typeof:eC,render:e}};ue.isValidElement=up;ue.lazy=function(e){return{$$typeof:rC,_payload:{_status:-1,_result:e},_init:oC}};ue.memo=function(e,t){return{$$typeof:nC,type:e,compare:t===void 0?null:t}};ue.startTransition=function(e){var t=dc.transition;dc.transition={};try{e()}finally{dc.transition=t}};ue.unstable_act=pv;ue.useCallback=function(e,t){return mt.current.useCallback(e,t)};ue.useContext=function(e){return mt.current.useContext(e)};ue.useDebugValue=function(){};ue.useDeferredValue=function(e){return mt.current.useDeferredValue(e)};ue.useEffect=function(e,t){return mt.current.useEffect(e,t)};ue.useId=function(){return mt.current.useId()};ue.useImperativeHandle=function(e,t,n){return mt.current.useImperativeHandle(e,t,n)};ue.useInsertionEffect=function(e,t){return mt.current.useInsertionEffect(e,t)};ue.useLayoutEffect=function(e,t){return mt.current.useLayoutEffect(e,t)};ue.useMemo=function(e,t){return mt.current.useMemo(e,t)};ue.useReducer=function(e,t,n){return mt.current.useReducer(e,t,n)};ue.useRef=function(e){return mt.current.useRef(e)};ue.useState=function(e){return mt.current.useState(e)};ue.useSyncExternalStore=function(e,t,n){return mt.current.useSyncExternalStore(e,t,n)};ue.useTransition=function(){return mt.current.useTransition()};ue.version="18.3.1";sv.exports=ue;var b=sv.exports;const lC=QS(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dC=b,uC=Symbol.for("react.element"),pC=Symbol.for("react.fragment"),fC=Object.prototype.hasOwnProperty,hC=dC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mC={key:!0,ref:!0,__self:!0,__source:!0};function fv(e,t,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)fC.call(t,r)&&!mC.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:uC,type:e,key:a,ref:o,props:i,_owner:hC.current}}Zc.Fragment=pC;Zc.jsx=fv;Zc.jsxs=fv;rv.exports=Zc;var c=rv.exports,hv={exports:{}},Mt={},mv={exports:{}},gv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(H,J){var Q=H.length;H.push(J);e:for(;0<Q;){var X=Q-1>>>1,le=H[X];if(0<i(le,J))H[X]=J,H[Q]=le,Q=X;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var J=H[0],Q=H.pop();if(Q!==J){H[0]=Q;e:for(var X=0,le=H.length,At=le>>>1;X<At;){var Ge=2*(X+1)-1,Yt=H[Ge],Ae=Ge+1,er=H[Ae];if(0>i(Yt,Q))Ae<le&&0>i(er,Yt)?(H[X]=er,H[Ae]=Q,X=Ae):(H[X]=Yt,H[Ge]=Q,X=Ge);else if(Ae<le&&0>i(er,Q))H[X]=er,H[Ae]=Q,X=Ae;else break e}}return J}function i(H,J){var Q=H.sortIndex-J.sortIndex;return Q!==0?Q:H.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,f=o.now();e.unstable_now=function(){return o.now()-f}}var h=[],_=[],p=1,S=null,k=3,M=!1,V=!1,B=!1,v=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(H){for(var J=n(_);J!==null;){if(J.callback===null)r(_);else if(J.startTime<=H)r(_),J.sortIndex=J.expirationTime,t(h,J);else break;J=n(_)}}function C(H){if(B=!1,g(H),!V)if(n(h)!==null)V=!0,ae(N);else{var J=n(_);J!==null&&L(C,J.startTime-H)}}function N(H,J){V=!1,B&&(B=!1,l(T),T=-1),M=!0;var Q=k;try{for(g(J),S=n(h);S!==null&&(!(S.expirationTime>J)||H&&!j());){var X=S.callback;if(typeof X=="function"){S.callback=null,k=S.priorityLevel;var le=X(S.expirationTime<=J);J=e.unstable_now(),typeof le=="function"?S.callback=le:S===n(h)&&r(h),g(J)}else r(h);S=n(h)}if(S!==null)var At=!0;else{var Ge=n(_);Ge!==null&&L(C,Ge.startTime-J),At=!1}return At}finally{S=null,k=Q,M=!1}}var w=!1,x=null,T=-1,D=5,P=-1;function j(){return!(e.unstable_now()-P<D)}function $(){if(x!==null){var H=e.unstable_now();P=H;var J=!0;try{J=x(!0,H)}finally{J?z():(w=!1,x=null)}}else w=!1}var z;if(typeof u=="function")z=function(){u($)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Z=G.port2;G.port1.onmessage=$,z=function(){Z.postMessage(null)}}else z=function(){v($,0)};function ae(H){x=H,w||(w=!0,z())}function L(H,J){T=v(function(){H(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){V||M||(V=!0,ae(N))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return k},e.unstable_getFirstCallbackNode=function(){return n(h)},e.unstable_next=function(H){switch(k){case 1:case 2:case 3:var J=3;break;default:J=k}var Q=k;k=J;try{return H()}finally{k=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,J){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Q=k;k=H;try{return J()}finally{k=Q}},e.unstable_scheduleCallback=function(H,J,Q){var X=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?X+Q:X):Q=X,H){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=Q+le,H={id:p++,callback:J,priorityLevel:H,startTime:Q,expirationTime:le,sortIndex:-1},Q>X?(H.sortIndex=Q,t(_,H),n(h)===null&&H===n(_)&&(B?(l(T),T=-1):B=!0,L(C,Q-X))):(H.sortIndex=le,t(h,H),V||M||(V=!0,ae(N))),H},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(H){var J=k;return function(){var Q=k;k=J;try{return H.apply(this,arguments)}finally{k=Q}}}})(gv);mv.exports=gv;var gC=mv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vC=b,Lt=gC;function K(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vv=new Set,Pa={};function ys(e,t){Ci(e,t),Ci(e+"Capture",t)}function Ci(e,t){for(Pa[e]=t,e=0;e<t.length;e++)vv.add(t[e])}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),du=Object.prototype.hasOwnProperty,yC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,nm={},rm={};function wC(e){return du.call(rm,e)?!0:du.call(nm,e)?!1:yC.test(e)?rm[e]=!0:(nm[e]=!0,!1)}function _C(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function SC(e,t,n,r){if(t===null||typeof t>"u"||_C(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function gt(e,t,n,r,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var Ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ze[e]=new gt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ze[t]=new gt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ze[e]=new gt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ze[e]=new gt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ze[e]=new gt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ze[e]=new gt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ze[e]=new gt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ze[e]=new gt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ze[e]=new gt(e,5,!1,e.toLowerCase(),null,!1,!1)});var pp=/[\-:]([a-z])/g;function fp(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(pp,fp);Ze[t]=new gt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(pp,fp);Ze[t]=new gt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(pp,fp);Ze[t]=new gt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ze[e]=new gt(e,1,!1,e.toLowerCase(),null,!1,!1)});Ze.xlinkHref=new gt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ze[e]=new gt(e,1,!1,e.toLowerCase(),null,!0,!0)});function hp(e,t,n,r){var i=Ze.hasOwnProperty(t)?Ze[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(SC(t,n,i,r)&&(n=null),r||i===null?wC(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Xn=vC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vo=Symbol.for("react.element"),qs=Symbol.for("react.portal"),Xs=Symbol.for("react.fragment"),mp=Symbol.for("react.strict_mode"),uu=Symbol.for("react.profiler"),yv=Symbol.for("react.provider"),wv=Symbol.for("react.context"),gp=Symbol.for("react.forward_ref"),pu=Symbol.for("react.suspense"),fu=Symbol.for("react.suspense_list"),vp=Symbol.for("react.memo"),cr=Symbol.for("react.lazy"),_v=Symbol.for("react.offscreen"),sm=Symbol.iterator;function Zi(e){return e===null||typeof e!="object"?null:(e=sm&&e[sm]||e["@@iterator"],typeof e=="function"?e:null)}var Pe=Object.assign,Id;function ma(e){if(Id===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Id=t&&t[1]||""}return`
`+Id+e}var Nd=!1;function Pd(e,t){if(!e||Nd)return"";Nd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(_){var r=_}Reflect.construct(e,[],t)}else{try{t.call()}catch(_){r=_}e.call(t.prototype)}else{try{throw Error()}catch(_){r=_}e()}}catch(_){if(_&&r&&typeof _.stack=="string"){for(var i=_.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,f=a.length-1;1<=o&&0<=f&&i[o]!==a[f];)f--;for(;1<=o&&0<=f;o--,f--)if(i[o]!==a[f]){if(o!==1||f!==1)do if(o--,f--,0>f||i[o]!==a[f]){var h=`
`+i[o].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}while(1<=o&&0<=f);break}}}finally{Nd=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ma(e):""}function CC(e){switch(e.tag){case 5:return ma(e.type);case 16:return ma("Lazy");case 13:return ma("Suspense");case 19:return ma("SuspenseList");case 0:case 2:case 15:return e=Pd(e.type,!1),e;case 11:return e=Pd(e.type.render,!1),e;case 1:return e=Pd(e.type,!0),e;default:return""}}function hu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Xs:return"Fragment";case qs:return"Portal";case uu:return"Profiler";case mp:return"StrictMode";case pu:return"Suspense";case fu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case wv:return(e.displayName||"Context")+".Consumer";case yv:return(e._context.displayName||"Context")+".Provider";case gp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case vp:return t=e.displayName||null,t!==null?t:hu(e.type)||"Memo";case cr:t=e._payload,e=e._init;try{return hu(e(t))}catch{}}return null}function xC(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hu(t);case 8:return t===mp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function br(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Sv(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function bC(e){var t=Sv(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Wo(e){e._valueTracker||(e._valueTracker=bC(e))}function Cv(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Sv(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Ic(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function mu(e,t){var n=t.checked;return Pe({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function im(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=br(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function xv(e,t){t=t.checked,t!=null&&hp(e,"checked",t,!1)}function gu(e,t){xv(e,t);var n=br(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?vu(e,t.type,n):t.hasOwnProperty("defaultValue")&&vu(e,t.type,br(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function am(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function vu(e,t,n){(t!=="number"||Ic(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ga=Array.isArray;function ui(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+br(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function yu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(K(91));return Pe({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function om(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(K(92));if(ga(n)){if(1<n.length)throw Error(K(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:br(n)}}function bv(e,t){var n=br(t.value),r=br(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function cm(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ev(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ev(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ho,kv=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ho=Ho||document.createElement("div"),Ho.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ho.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ja(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var wa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},EC=["Webkit","ms","Moz","O"];Object.keys(wa).forEach(function(e){EC.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),wa[t]=wa[e]})});function Tv(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||wa.hasOwnProperty(e)&&wa[e]?(""+t).trim():t+"px"}function Rv(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Tv(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var kC=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _u(e,t){if(t){if(kC[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(K(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(K(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(K(61))}if(t.style!=null&&typeof t.style!="object")throw Error(K(62))}}function Su(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cu=null;function yp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var xu=null,pi=null,fi=null;function lm(e){if(e=Xa(e)){if(typeof xu!="function")throw Error(K(280));var t=e.stateNode;t&&(t=sl(t),xu(e.stateNode,e.type,t))}}function Iv(e){pi?fi?fi.push(e):fi=[e]:pi=e}function Nv(){if(pi){var e=pi,t=fi;if(fi=pi=null,lm(e),t)for(e=0;e<t.length;e++)lm(t[e])}}function Pv(e,t){return e(t)}function jv(){}var jd=!1;function Dv(e,t,n){if(jd)return e(t,n);jd=!0;try{return Pv(e,t,n)}finally{jd=!1,(pi!==null||fi!==null)&&(jv(),Nv())}}function Da(e,t){var n=e.stateNode;if(n===null)return null;var r=sl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(K(231,t,typeof n));return n}var bu=!1;if(Kn)try{var ea={};Object.defineProperty(ea,"passive",{get:function(){bu=!0}}),window.addEventListener("test",ea,ea),window.removeEventListener("test",ea,ea)}catch{bu=!1}function TC(e,t,n,r,i,a,o,f,h){var _=Array.prototype.slice.call(arguments,3);try{t.apply(n,_)}catch(p){this.onError(p)}}var _a=!1,Nc=null,Pc=!1,Eu=null,RC={onError:function(e){_a=!0,Nc=e}};function IC(e,t,n,r,i,a,o,f,h){_a=!1,Nc=null,TC.apply(RC,arguments)}function NC(e,t,n,r,i,a,o,f,h){if(IC.apply(this,arguments),_a){if(_a){var _=Nc;_a=!1,Nc=null}else throw Error(K(198));Pc||(Pc=!0,Eu=_)}}function ws(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Lv(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function dm(e){if(ws(e)!==e)throw Error(K(188))}function PC(e){var t=e.alternate;if(!t){if(t=ws(e),t===null)throw Error(K(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return dm(i),e;if(a===r)return dm(i),t;a=a.sibling}throw Error(K(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,f=i.child;f;){if(f===n){o=!0,n=i,r=a;break}if(f===r){o=!0,r=i,n=a;break}f=f.sibling}if(!o){for(f=a.child;f;){if(f===n){o=!0,n=a,r=i;break}if(f===r){o=!0,r=a,n=i;break}f=f.sibling}if(!o)throw Error(K(189))}}if(n.alternate!==r)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?e:t}function Mv(e){return e=PC(e),e!==null?Ov(e):null}function Ov(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ov(e);if(t!==null)return t;e=e.sibling}return null}var Av=Lt.unstable_scheduleCallback,um=Lt.unstable_cancelCallback,jC=Lt.unstable_shouldYield,DC=Lt.unstable_requestPaint,Oe=Lt.unstable_now,LC=Lt.unstable_getCurrentPriorityLevel,wp=Lt.unstable_ImmediatePriority,$v=Lt.unstable_UserBlockingPriority,jc=Lt.unstable_NormalPriority,MC=Lt.unstable_LowPriority,Fv=Lt.unstable_IdlePriority,el=null,kn=null;function OC(e){if(kn&&typeof kn.onCommitFiberRoot=="function")try{kn.onCommitFiberRoot(el,e,void 0,(e.current.flags&128)===128)}catch{}}var on=Math.clz32?Math.clz32:FC,AC=Math.log,$C=Math.LN2;function FC(e){return e>>>=0,e===0?32:31-(AC(e)/$C|0)|0}var Go=64,Qo=4194304;function va(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Dc(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=n&268435455;if(o!==0){var f=o&~i;f!==0?r=va(f):(a&=o,a!==0&&(r=va(a)))}else o=n&~i,o!==0?r=va(o):a!==0&&(r=va(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-on(t),i=1<<n,r|=e[n],t&=~i;return r}function UC(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zC(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-on(a),f=1<<o,h=i[o];h===-1?(!(f&n)||f&r)&&(i[o]=UC(f,t)):h<=t&&(e.expiredLanes|=f),a&=~f}}function ku(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Uv(){var e=Go;return Go<<=1,!(Go&4194240)&&(Go=64),e}function Dd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ja(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-on(t),e[t]=n}function BC(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-on(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}function _p(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-on(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var ge=0;function zv(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Bv,Sp,Vv,Wv,Hv,Tu=!1,Ko=[],mr=null,gr=null,vr=null,La=new Map,Ma=new Map,dr=[],VC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pm(e,t){switch(e){case"focusin":case"focusout":mr=null;break;case"dragenter":case"dragleave":gr=null;break;case"mouseover":case"mouseout":vr=null;break;case"pointerover":case"pointerout":La.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ma.delete(t.pointerId)}}function ta(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=Xa(t),t!==null&&Sp(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function WC(e,t,n,r,i){switch(t){case"focusin":return mr=ta(mr,e,t,n,r,i),!0;case"dragenter":return gr=ta(gr,e,t,n,r,i),!0;case"mouseover":return vr=ta(vr,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return La.set(a,ta(La.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Ma.set(a,ta(Ma.get(a)||null,e,t,n,r,i)),!0}return!1}function Gv(e){var t=Jr(e.target);if(t!==null){var n=ws(t);if(n!==null){if(t=n.tag,t===13){if(t=Lv(n),t!==null){e.blockedOn=t,Hv(e.priority,function(){Vv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function uc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ru(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Cu=r,n.target.dispatchEvent(r),Cu=null}else return t=Xa(n),t!==null&&Sp(t),e.blockedOn=n,!1;t.shift()}return!0}function fm(e,t,n){uc(e)&&n.delete(t)}function HC(){Tu=!1,mr!==null&&uc(mr)&&(mr=null),gr!==null&&uc(gr)&&(gr=null),vr!==null&&uc(vr)&&(vr=null),La.forEach(fm),Ma.forEach(fm)}function na(e,t){e.blockedOn===t&&(e.blockedOn=null,Tu||(Tu=!0,Lt.unstable_scheduleCallback(Lt.unstable_NormalPriority,HC)))}function Oa(e){function t(i){return na(i,e)}if(0<Ko.length){na(Ko[0],e);for(var n=1;n<Ko.length;n++){var r=Ko[n];r.blockedOn===e&&(r.blockedOn=null)}}for(mr!==null&&na(mr,e),gr!==null&&na(gr,e),vr!==null&&na(vr,e),La.forEach(t),Ma.forEach(t),n=0;n<dr.length;n++)r=dr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<dr.length&&(n=dr[0],n.blockedOn===null);)Gv(n),n.blockedOn===null&&dr.shift()}var hi=Xn.ReactCurrentBatchConfig,Lc=!0;function GC(e,t,n,r){var i=ge,a=hi.transition;hi.transition=null;try{ge=1,Cp(e,t,n,r)}finally{ge=i,hi.transition=a}}function QC(e,t,n,r){var i=ge,a=hi.transition;hi.transition=null;try{ge=4,Cp(e,t,n,r)}finally{ge=i,hi.transition=a}}function Cp(e,t,n,r){if(Lc){var i=Ru(e,t,n,r);if(i===null)Vd(e,t,r,Mc,n),pm(e,r);else if(WC(i,e,t,n,r))r.stopPropagation();else if(pm(e,r),t&4&&-1<VC.indexOf(e)){for(;i!==null;){var a=Xa(i);if(a!==null&&Bv(a),a=Ru(e,t,n,r),a===null&&Vd(e,t,r,Mc,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Vd(e,t,r,null,n)}}var Mc=null;function Ru(e,t,n,r){if(Mc=null,e=yp(r),e=Jr(e),e!==null)if(t=ws(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Lv(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Mc=e,null}function Qv(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(LC()){case wp:return 1;case $v:return 4;case jc:case MC:return 16;case Fv:return 536870912;default:return 16}default:return 16}}var fr=null,xp=null,pc=null;function Kv(){if(pc)return pc;var e,t=xp,n=t.length,r,i="value"in fr?fr.value:fr.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return pc=i.slice(e,1<r?1-r:void 0)}function fc(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Yo(){return!0}function hm(){return!1}function Ot(e){function t(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var f in e)e.hasOwnProperty(f)&&(n=e[f],this[f]=n?n(a):a[f]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Yo:hm,this.isPropagationStopped=hm,this}return Pe(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),t}var Ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bp=Ot(Ni),qa=Pe({},Ni,{view:0,detail:0}),KC=Ot(qa),Ld,Md,ra,tl=Pe({},qa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ep,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ra&&(ra&&e.type==="mousemove"?(Ld=e.screenX-ra.screenX,Md=e.screenY-ra.screenY):Md=Ld=0,ra=e),Ld)},movementY:function(e){return"movementY"in e?e.movementY:Md}}),mm=Ot(tl),YC=Pe({},tl,{dataTransfer:0}),JC=Ot(YC),qC=Pe({},qa,{relatedTarget:0}),Od=Ot(qC),XC=Pe({},Ni,{animationName:0,elapsedTime:0,pseudoElement:0}),ZC=Ot(XC),ex=Pe({},Ni,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),tx=Ot(ex),nx=Pe({},Ni,{data:0}),gm=Ot(nx),rx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ix={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ax(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ix[e])?!!t[e]:!1}function Ep(){return ax}var ox=Pe({},qa,{key:function(e){if(e.key){var t=rx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=fc(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?sx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ep,charCode:function(e){return e.type==="keypress"?fc(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?fc(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),cx=Ot(ox),lx=Pe({},tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vm=Ot(lx),dx=Pe({},qa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ep}),ux=Ot(dx),px=Pe({},Ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),fx=Ot(px),hx=Pe({},tl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),mx=Ot(hx),gx=[9,13,27,32],kp=Kn&&"CompositionEvent"in window,Sa=null;Kn&&"documentMode"in document&&(Sa=document.documentMode);var vx=Kn&&"TextEvent"in window&&!Sa,Yv=Kn&&(!kp||Sa&&8<Sa&&11>=Sa),ym=" ",wm=!1;function Jv(e,t){switch(e){case"keyup":return gx.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qv(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Zs=!1;function yx(e,t){switch(e){case"compositionend":return qv(t);case"keypress":return t.which!==32?null:(wm=!0,ym);case"textInput":return e=t.data,e===ym&&wm?null:e;default:return null}}function wx(e,t){if(Zs)return e==="compositionend"||!kp&&Jv(e,t)?(e=Kv(),pc=xp=fr=null,Zs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Yv&&t.locale!=="ko"?null:t.data;default:return null}}var _x={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _m(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!_x[e.type]:t==="textarea"}function Xv(e,t,n,r){Iv(r),t=Oc(t,"onChange"),0<t.length&&(n=new bp("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ca=null,Aa=null;function Sx(e){ly(e,0)}function nl(e){var t=ni(e);if(Cv(t))return e}function Cx(e,t){if(e==="change")return t}var Zv=!1;if(Kn){var Ad;if(Kn){var $d="oninput"in document;if(!$d){var Sm=document.createElement("div");Sm.setAttribute("oninput","return;"),$d=typeof Sm.oninput=="function"}Ad=$d}else Ad=!1;Zv=Ad&&(!document.documentMode||9<document.documentMode)}function Cm(){Ca&&(Ca.detachEvent("onpropertychange",ey),Aa=Ca=null)}function ey(e){if(e.propertyName==="value"&&nl(Aa)){var t=[];Xv(t,Aa,e,yp(e)),Dv(Sx,t)}}function xx(e,t,n){e==="focusin"?(Cm(),Ca=t,Aa=n,Ca.attachEvent("onpropertychange",ey)):e==="focusout"&&Cm()}function bx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return nl(Aa)}function Ex(e,t){if(e==="click")return nl(t)}function kx(e,t){if(e==="input"||e==="change")return nl(t)}function Tx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var dn=typeof Object.is=="function"?Object.is:Tx;function $a(e,t){if(dn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!du.call(t,i)||!dn(e[i],t[i]))return!1}return!0}function xm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function bm(e,t){var n=xm(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=xm(n)}}function ty(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ty(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ny(){for(var e=window,t=Ic();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ic(e.document)}return t}function Tp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Rx(e){var t=ny(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ty(n.ownerDocument.documentElement,n)){if(r!==null&&Tp(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=bm(n,a);var o=bm(n,r);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ix=Kn&&"documentMode"in document&&11>=document.documentMode,ei=null,Iu=null,xa=null,Nu=!1;function Em(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Nu||ei==null||ei!==Ic(r)||(r=ei,"selectionStart"in r&&Tp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),xa&&$a(xa,r)||(xa=r,r=Oc(Iu,"onSelect"),0<r.length&&(t=new bp("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ei)))}function Jo(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ti={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionend:Jo("Transition","TransitionEnd")},Fd={},ry={};Kn&&(ry=document.createElement("div").style,"AnimationEvent"in window||(delete ti.animationend.animation,delete ti.animationiteration.animation,delete ti.animationstart.animation),"TransitionEvent"in window||delete ti.transitionend.transition);function rl(e){if(Fd[e])return Fd[e];if(!ti[e])return e;var t=ti[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ry)return Fd[e]=t[n];return e}var sy=rl("animationend"),iy=rl("animationiteration"),ay=rl("animationstart"),oy=rl("transitionend"),cy=new Map,km="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){cy.set(e,t),ys(t,[e])}for(var Ud=0;Ud<km.length;Ud++){var zd=km[Ud],Nx=zd.toLowerCase(),Px=zd[0].toUpperCase()+zd.slice(1);kr(Nx,"on"+Px)}kr(sy,"onAnimationEnd");kr(iy,"onAnimationIteration");kr(ay,"onAnimationStart");kr("dblclick","onDoubleClick");kr("focusin","onFocus");kr("focusout","onBlur");kr(oy,"onTransitionEnd");Ci("onMouseEnter",["mouseout","mouseover"]);Ci("onMouseLeave",["mouseout","mouseover"]);Ci("onPointerEnter",["pointerout","pointerover"]);Ci("onPointerLeave",["pointerout","pointerover"]);ys("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ys("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ys("onBeforeInput",["compositionend","keypress","textInput","paste"]);ys("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ys("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ys("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ya="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jx=new Set("cancel close invalid load scroll toggle".split(" ").concat(ya));function Tm(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,NC(r,t,void 0,e),e.currentTarget=null}function ly(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var f=r[o],h=f.instance,_=f.currentTarget;if(f=f.listener,h!==a&&i.isPropagationStopped())break e;Tm(i,f,_),a=h}else for(o=0;o<r.length;o++){if(f=r[o],h=f.instance,_=f.currentTarget,f=f.listener,h!==a&&i.isPropagationStopped())break e;Tm(i,f,_),a=h}}}if(Pc)throw e=Eu,Pc=!1,Eu=null,e}function xe(e,t){var n=t[Mu];n===void 0&&(n=t[Mu]=new Set);var r=e+"__bubble";n.has(r)||(dy(t,e,2,!1),n.add(r))}function Bd(e,t,n){var r=0;t&&(r|=4),dy(n,e,r,t)}var qo="_reactListening"+Math.random().toString(36).slice(2);function Fa(e){if(!e[qo]){e[qo]=!0,vv.forEach(function(n){n!=="selectionchange"&&(jx.has(n)||Bd(n,!1,e),Bd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[qo]||(t[qo]=!0,Bd("selectionchange",!1,t))}}function dy(e,t,n,r){switch(Qv(t)){case 1:var i=GC;break;case 4:i=QC;break;default:i=Cp}n=i.bind(null,t,n,e),i=void 0,!bu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vd(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var f=r.stateNode.containerInfo;if(f===i||f.nodeType===8&&f.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var h=o.tag;if((h===3||h===4)&&(h=o.stateNode.containerInfo,h===i||h.nodeType===8&&h.parentNode===i))return;o=o.return}for(;f!==null;){if(o=Jr(f),o===null)return;if(h=o.tag,h===5||h===6){r=a=o;continue e}f=f.parentNode}}r=r.return}Dv(function(){var _=a,p=yp(n),S=[];e:{var k=cy.get(e);if(k!==void 0){var M=bp,V=e;switch(e){case"keypress":if(fc(n)===0)break e;case"keydown":case"keyup":M=cx;break;case"focusin":V="focus",M=Od;break;case"focusout":V="blur",M=Od;break;case"beforeblur":case"afterblur":M=Od;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":M=mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":M=JC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":M=ux;break;case sy:case iy:case ay:M=ZC;break;case oy:M=fx;break;case"scroll":M=KC;break;case"wheel":M=mx;break;case"copy":case"cut":case"paste":M=tx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":M=vm}var B=(t&4)!==0,v=!B&&e==="scroll",l=B?k!==null?k+"Capture":null:k;B=[];for(var u=_,g;u!==null;){g=u;var C=g.stateNode;if(g.tag===5&&C!==null&&(g=C,l!==null&&(C=Da(u,l),C!=null&&B.push(Ua(u,C,g)))),v)break;u=u.return}0<B.length&&(k=new M(k,V,null,n,p),S.push({event:k,listeners:B}))}}if(!(t&7)){e:{if(k=e==="mouseover"||e==="pointerover",M=e==="mouseout"||e==="pointerout",k&&n!==Cu&&(V=n.relatedTarget||n.fromElement)&&(Jr(V)||V[Yn]))break e;if((M||k)&&(k=p.window===p?p:(k=p.ownerDocument)?k.defaultView||k.parentWindow:window,M?(V=n.relatedTarget||n.toElement,M=_,V=V?Jr(V):null,V!==null&&(v=ws(V),V!==v||V.tag!==5&&V.tag!==6)&&(V=null)):(M=null,V=_),M!==V)){if(B=mm,C="onMouseLeave",l="onMouseEnter",u="mouse",(e==="pointerout"||e==="pointerover")&&(B=vm,C="onPointerLeave",l="onPointerEnter",u="pointer"),v=M==null?k:ni(M),g=V==null?k:ni(V),k=new B(C,u+"leave",M,n,p),k.target=v,k.relatedTarget=g,C=null,Jr(p)===_&&(B=new B(l,u+"enter",V,n,p),B.target=g,B.relatedTarget=v,C=B),v=C,M&&V)t:{for(B=M,l=V,u=0,g=B;g;g=Fs(g))u++;for(g=0,C=l;C;C=Fs(C))g++;for(;0<u-g;)B=Fs(B),u--;for(;0<g-u;)l=Fs(l),g--;for(;u--;){if(B===l||l!==null&&B===l.alternate)break t;B=Fs(B),l=Fs(l)}B=null}else B=null;M!==null&&Rm(S,k,M,B,!1),V!==null&&v!==null&&Rm(S,v,V,B,!0)}}e:{if(k=_?ni(_):window,M=k.nodeName&&k.nodeName.toLowerCase(),M==="select"||M==="input"&&k.type==="file")var N=Cx;else if(_m(k))if(Zv)N=kx;else{N=bx;var w=xx}else(M=k.nodeName)&&M.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(N=Ex);if(N&&(N=N(e,_))){Xv(S,N,n,p);break e}w&&w(e,k,_),e==="focusout"&&(w=k._wrapperState)&&w.controlled&&k.type==="number"&&vu(k,"number",k.value)}switch(w=_?ni(_):window,e){case"focusin":(_m(w)||w.contentEditable==="true")&&(ei=w,Iu=_,xa=null);break;case"focusout":xa=Iu=ei=null;break;case"mousedown":Nu=!0;break;case"contextmenu":case"mouseup":case"dragend":Nu=!1,Em(S,n,p);break;case"selectionchange":if(Ix)break;case"keydown":case"keyup":Em(S,n,p)}var x;if(kp)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Zs?Jv(e,n)&&(T="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(Yv&&n.locale!=="ko"&&(Zs||T!=="onCompositionStart"?T==="onCompositionEnd"&&Zs&&(x=Kv()):(fr=p,xp="value"in fr?fr.value:fr.textContent,Zs=!0)),w=Oc(_,T),0<w.length&&(T=new gm(T,e,null,n,p),S.push({event:T,listeners:w}),x?T.data=x:(x=qv(n),x!==null&&(T.data=x)))),(x=vx?yx(e,n):wx(e,n))&&(_=Oc(_,"onBeforeInput"),0<_.length&&(p=new gm("onBeforeInput","beforeinput",null,n,p),S.push({event:p,listeners:_}),p.data=x))}ly(S,t)})}function Ua(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Oc(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Da(e,n),a!=null&&r.unshift(Ua(e,a,i)),a=Da(e,t),a!=null&&r.push(Ua(e,a,i))),e=e.return}return r}function Fs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Rm(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var f=n,h=f.alternate,_=f.stateNode;if(h!==null&&h===r)break;f.tag===5&&_!==null&&(f=_,i?(h=Da(n,a),h!=null&&o.unshift(Ua(n,h,f))):i||(h=Da(n,a),h!=null&&o.push(Ua(n,h,f)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Dx=/\r\n?/g,Lx=/\u0000|\uFFFD/g;function Im(e){return(typeof e=="string"?e:""+e).replace(Dx,`
`).replace(Lx,"")}function Xo(e,t,n){if(t=Im(t),Im(e)!==t&&n)throw Error(K(425))}function Ac(){}var Pu=null,ju=null;function Du(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Lu=typeof setTimeout=="function"?setTimeout:void 0,Mx=typeof clearTimeout=="function"?clearTimeout:void 0,Nm=typeof Promise=="function"?Promise:void 0,Ox=typeof queueMicrotask=="function"?queueMicrotask:typeof Nm<"u"?function(e){return Nm.resolve(null).then(e).catch(Ax)}:Lu;function Ax(e){setTimeout(function(){throw e})}function Wd(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),Oa(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Oa(t)}function yr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Pm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Pi=Math.random().toString(36).slice(2),En="__reactFiber$"+Pi,za="__reactProps$"+Pi,Yn="__reactContainer$"+Pi,Mu="__reactEvents$"+Pi,$x="__reactListeners$"+Pi,Fx="__reactHandles$"+Pi;function Jr(e){var t=e[En];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Yn]||n[En]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Pm(e);e!==null;){if(n=e[En])return n;e=Pm(e)}return t}e=n,n=e.parentNode}return null}function Xa(e){return e=e[En]||e[Yn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ni(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(K(33))}function sl(e){return e[za]||null}var Ou=[],ri=-1;function Tr(e){return{current:e}}function be(e){0>ri||(e.current=Ou[ri],Ou[ri]=null,ri--)}function _e(e,t){ri++,Ou[ri]=e.current,e.current=t}var Er={},ct=Tr(Er),Ct=Tr(!1),us=Er;function xi(e,t){var n=e.type.contextTypes;if(!n)return Er;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function xt(e){return e=e.childContextTypes,e!=null}function $c(){be(Ct),be(ct)}function jm(e,t,n){if(ct.current!==Er)throw Error(K(168));_e(ct,t),_e(Ct,n)}function uy(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(K(108,xC(e)||"Unknown",i));return Pe({},n,r)}function Fc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Er,us=ct.current,_e(ct,e),_e(Ct,Ct.current),!0}function Dm(e,t,n){var r=e.stateNode;if(!r)throw Error(K(169));n?(e=uy(e,t,us),r.__reactInternalMemoizedMergedChildContext=e,be(Ct),be(ct),_e(ct,e)):be(Ct),_e(Ct,n)}var Vn=null,il=!1,Hd=!1;function py(e){Vn===null?Vn=[e]:Vn.push(e)}function Ux(e){il=!0,py(e)}function Rr(){if(!Hd&&Vn!==null){Hd=!0;var e=0,t=ge;try{var n=Vn;for(ge=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Vn=null,il=!1}catch(i){throw Vn!==null&&(Vn=Vn.slice(e+1)),Av(wp,Rr),i}finally{ge=t,Hd=!1}}return null}var si=[],ii=0,Uc=null,zc=0,Vt=[],Wt=0,ps=null,Wn=1,Hn="";function Kr(e,t){si[ii++]=zc,si[ii++]=Uc,Uc=e,zc=t}function fy(e,t,n){Vt[Wt++]=Wn,Vt[Wt++]=Hn,Vt[Wt++]=ps,ps=e;var r=Wn;e=Hn;var i=32-on(r)-1;r&=~(1<<i),n+=1;var a=32-on(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Wn=1<<32-on(t)+i|n<<i|r,Hn=a+e}else Wn=1<<a|n<<i|r,Hn=e}function Rp(e){e.return!==null&&(Kr(e,1),fy(e,1,0))}function Ip(e){for(;e===Uc;)Uc=si[--ii],si[ii]=null,zc=si[--ii],si[ii]=null;for(;e===ps;)ps=Vt[--Wt],Vt[Wt]=null,Hn=Vt[--Wt],Vt[Wt]=null,Wn=Vt[--Wt],Vt[Wt]=null}var Dt=null,jt=null,Te=!1,an=null;function hy(e,t){var n=Ht(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Lm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Dt=e,jt=yr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Dt=e,jt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ps!==null?{id:Wn,overflow:Hn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Ht(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Dt=e,jt=null,!0):!1;default:return!1}}function Au(e){return(e.mode&1)!==0&&(e.flags&128)===0}function $u(e){if(Te){var t=jt;if(t){var n=t;if(!Lm(e,t)){if(Au(e))throw Error(K(418));t=yr(n.nextSibling);var r=Dt;t&&Lm(e,t)?hy(r,n):(e.flags=e.flags&-4097|2,Te=!1,Dt=e)}}else{if(Au(e))throw Error(K(418));e.flags=e.flags&-4097|2,Te=!1,Dt=e}}}function Mm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Dt=e}function Zo(e){if(e!==Dt)return!1;if(!Te)return Mm(e),Te=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Du(e.type,e.memoizedProps)),t&&(t=jt)){if(Au(e))throw my(),Error(K(418));for(;t;)hy(e,t),t=yr(t.nextSibling)}if(Mm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(K(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){jt=yr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}jt=null}}else jt=Dt?yr(e.stateNode.nextSibling):null;return!0}function my(){for(var e=jt;e;)e=yr(e.nextSibling)}function bi(){jt=Dt=null,Te=!1}function Np(e){an===null?an=[e]:an.push(e)}var zx=Xn.ReactCurrentBatchConfig;function sa(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(K(309));var r=n.stateNode}if(!r)throw Error(K(147,e));var i=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var f=i.refs;o===null?delete f[a]:f[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(K(284));if(!n._owner)throw Error(K(290,e))}return e}function ec(e,t){throw e=Object.prototype.toString.call(t),Error(K(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Om(e){var t=e._init;return t(e._payload)}function gy(e){function t(l,u){if(e){var g=l.deletions;g===null?(l.deletions=[u],l.flags|=16):g.push(u)}}function n(l,u){if(!e)return null;for(;u!==null;)t(l,u),u=u.sibling;return null}function r(l,u){for(l=new Map;u!==null;)u.key!==null?l.set(u.key,u):l.set(u.index,u),u=u.sibling;return l}function i(l,u){return l=Cr(l,u),l.index=0,l.sibling=null,l}function a(l,u,g){return l.index=g,e?(g=l.alternate,g!==null?(g=g.index,g<u?(l.flags|=2,u):g):(l.flags|=2,u)):(l.flags|=1048576,u)}function o(l){return e&&l.alternate===null&&(l.flags|=2),l}function f(l,u,g,C){return u===null||u.tag!==6?(u=Xd(g,l.mode,C),u.return=l,u):(u=i(u,g),u.return=l,u)}function h(l,u,g,C){var N=g.type;return N===Xs?p(l,u,g.props.children,C,g.key):u!==null&&(u.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===cr&&Om(N)===u.type)?(C=i(u,g.props),C.ref=sa(l,u,g),C.return=l,C):(C=_c(g.type,g.key,g.props,null,l.mode,C),C.ref=sa(l,u,g),C.return=l,C)}function _(l,u,g,C){return u===null||u.tag!==4||u.stateNode.containerInfo!==g.containerInfo||u.stateNode.implementation!==g.implementation?(u=Zd(g,l.mode,C),u.return=l,u):(u=i(u,g.children||[]),u.return=l,u)}function p(l,u,g,C,N){return u===null||u.tag!==7?(u=ds(g,l.mode,C,N),u.return=l,u):(u=i(u,g),u.return=l,u)}function S(l,u,g){if(typeof u=="string"&&u!==""||typeof u=="number")return u=Xd(""+u,l.mode,g),u.return=l,u;if(typeof u=="object"&&u!==null){switch(u.$$typeof){case Vo:return g=_c(u.type,u.key,u.props,null,l.mode,g),g.ref=sa(l,null,u),g.return=l,g;case qs:return u=Zd(u,l.mode,g),u.return=l,u;case cr:var C=u._init;return S(l,C(u._payload),g)}if(ga(u)||Zi(u))return u=ds(u,l.mode,g,null),u.return=l,u;ec(l,u)}return null}function k(l,u,g,C){var N=u!==null?u.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return N!==null?null:f(l,u,""+g,C);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Vo:return g.key===N?h(l,u,g,C):null;case qs:return g.key===N?_(l,u,g,C):null;case cr:return N=g._init,k(l,u,N(g._payload),C)}if(ga(g)||Zi(g))return N!==null?null:p(l,u,g,C,null);ec(l,g)}return null}function M(l,u,g,C,N){if(typeof C=="string"&&C!==""||typeof C=="number")return l=l.get(g)||null,f(u,l,""+C,N);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Vo:return l=l.get(C.key===null?g:C.key)||null,h(u,l,C,N);case qs:return l=l.get(C.key===null?g:C.key)||null,_(u,l,C,N);case cr:var w=C._init;return M(l,u,g,w(C._payload),N)}if(ga(C)||Zi(C))return l=l.get(g)||null,p(u,l,C,N,null);ec(u,C)}return null}function V(l,u,g,C){for(var N=null,w=null,x=u,T=u=0,D=null;x!==null&&T<g.length;T++){x.index>T?(D=x,x=null):D=x.sibling;var P=k(l,x,g[T],C);if(P===null){x===null&&(x=D);break}e&&x&&P.alternate===null&&t(l,x),u=a(P,u,T),w===null?N=P:w.sibling=P,w=P,x=D}if(T===g.length)return n(l,x),Te&&Kr(l,T),N;if(x===null){for(;T<g.length;T++)x=S(l,g[T],C),x!==null&&(u=a(x,u,T),w===null?N=x:w.sibling=x,w=x);return Te&&Kr(l,T),N}for(x=r(l,x);T<g.length;T++)D=M(x,l,T,g[T],C),D!==null&&(e&&D.alternate!==null&&x.delete(D.key===null?T:D.key),u=a(D,u,T),w===null?N=D:w.sibling=D,w=D);return e&&x.forEach(function(j){return t(l,j)}),Te&&Kr(l,T),N}function B(l,u,g,C){var N=Zi(g);if(typeof N!="function")throw Error(K(150));if(g=N.call(g),g==null)throw Error(K(151));for(var w=N=null,x=u,T=u=0,D=null,P=g.next();x!==null&&!P.done;T++,P=g.next()){x.index>T?(D=x,x=null):D=x.sibling;var j=k(l,x,P.value,C);if(j===null){x===null&&(x=D);break}e&&x&&j.alternate===null&&t(l,x),u=a(j,u,T),w===null?N=j:w.sibling=j,w=j,x=D}if(P.done)return n(l,x),Te&&Kr(l,T),N;if(x===null){for(;!P.done;T++,P=g.next())P=S(l,P.value,C),P!==null&&(u=a(P,u,T),w===null?N=P:w.sibling=P,w=P);return Te&&Kr(l,T),N}for(x=r(l,x);!P.done;T++,P=g.next())P=M(x,l,T,P.value,C),P!==null&&(e&&P.alternate!==null&&x.delete(P.key===null?T:P.key),u=a(P,u,T),w===null?N=P:w.sibling=P,w=P);return e&&x.forEach(function($){return t(l,$)}),Te&&Kr(l,T),N}function v(l,u,g,C){if(typeof g=="object"&&g!==null&&g.type===Xs&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case Vo:e:{for(var N=g.key,w=u;w!==null;){if(w.key===N){if(N=g.type,N===Xs){if(w.tag===7){n(l,w.sibling),u=i(w,g.props.children),u.return=l,l=u;break e}}else if(w.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===cr&&Om(N)===w.type){n(l,w.sibling),u=i(w,g.props),u.ref=sa(l,w,g),u.return=l,l=u;break e}n(l,w);break}else t(l,w);w=w.sibling}g.type===Xs?(u=ds(g.props.children,l.mode,C,g.key),u.return=l,l=u):(C=_c(g.type,g.key,g.props,null,l.mode,C),C.ref=sa(l,u,g),C.return=l,l=C)}return o(l);case qs:e:{for(w=g.key;u!==null;){if(u.key===w)if(u.tag===4&&u.stateNode.containerInfo===g.containerInfo&&u.stateNode.implementation===g.implementation){n(l,u.sibling),u=i(u,g.children||[]),u.return=l,l=u;break e}else{n(l,u);break}else t(l,u);u=u.sibling}u=Zd(g,l.mode,C),u.return=l,l=u}return o(l);case cr:return w=g._init,v(l,u,w(g._payload),C)}if(ga(g))return V(l,u,g,C);if(Zi(g))return B(l,u,g,C);ec(l,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,u!==null&&u.tag===6?(n(l,u.sibling),u=i(u,g),u.return=l,l=u):(n(l,u),u=Xd(g,l.mode,C),u.return=l,l=u),o(l)):n(l,u)}return v}var Ei=gy(!0),vy=gy(!1),Bc=Tr(null),Vc=null,ai=null,Pp=null;function jp(){Pp=ai=Vc=null}function Dp(e){var t=Bc.current;be(Bc),e._currentValue=t}function Fu(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function mi(e,t){Vc=e,Pp=ai=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(St=!0),e.firstContext=null)}function Qt(e){var t=e._currentValue;if(Pp!==e)if(e={context:e,memoizedValue:t,next:null},ai===null){if(Vc===null)throw Error(K(308));ai=e,Vc.dependencies={lanes:0,firstContext:e}}else ai=ai.next=e;return t}var qr=null;function Lp(e){qr===null?qr=[e]:qr.push(e)}function yy(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,Lp(t)):(n.next=i.next,i.next=n),t.interleaved=n,Jn(e,r)}function Jn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var lr=!1;function Mp(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wy(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function wr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,me&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Jn(e,n)}return i=r.interleaved,i===null?(t.next=t,Lp(r)):(t.next=i.next,i.next=t),r.interleaved=t,Jn(e,n)}function hc(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,_p(e,n)}}function Am(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wc(e,t,n,r){var i=e.updateQueue;lr=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,f=i.shared.pending;if(f!==null){i.shared.pending=null;var h=f,_=h.next;h.next=null,o===null?a=_:o.next=_,o=h;var p=e.alternate;p!==null&&(p=p.updateQueue,f=p.lastBaseUpdate,f!==o&&(f===null?p.firstBaseUpdate=_:f.next=_,p.lastBaseUpdate=h))}if(a!==null){var S=i.baseState;o=0,p=_=h=null,f=a;do{var k=f.lane,M=f.eventTime;if((r&k)===k){p!==null&&(p=p.next={eventTime:M,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});e:{var V=e,B=f;switch(k=t,M=n,B.tag){case 1:if(V=B.payload,typeof V=="function"){S=V.call(M,S,k);break e}S=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=B.payload,k=typeof V=="function"?V.call(M,S,k):V,k==null)break e;S=Pe({},S,k);break e;case 2:lr=!0}}f.callback!==null&&f.lane!==0&&(e.flags|=64,k=i.effects,k===null?i.effects=[f]:k.push(f))}else M={eventTime:M,lane:k,tag:f.tag,payload:f.payload,callback:f.callback,next:null},p===null?(_=p=M,h=S):p=p.next=M,o|=k;if(f=f.next,f===null){if(f=i.shared.pending,f===null)break;k=f,f=k.next,k.next=null,i.lastBaseUpdate=k,i.shared.pending=null}}while(!0);if(p===null&&(h=S),i.baseState=h,i.firstBaseUpdate=_,i.lastBaseUpdate=p,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);hs|=o,e.lanes=o,e.memoizedState=S}}function $m(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(K(191,i));i.call(r)}}}var Za={},Tn=Tr(Za),Ba=Tr(Za),Va=Tr(Za);function Xr(e){if(e===Za)throw Error(K(174));return e}function Op(e,t){switch(_e(Va,t),_e(Ba,e),_e(Tn,Za),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:wu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=wu(t,e)}be(Tn),_e(Tn,t)}function ki(){be(Tn),be(Ba),be(Va)}function _y(e){Xr(Va.current);var t=Xr(Tn.current),n=wu(t,e.type);t!==n&&(_e(Ba,e),_e(Tn,n))}function Ap(e){Ba.current===e&&(be(Tn),be(Ba))}var Ie=Tr(0);function Hc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gd=[];function $p(){for(var e=0;e<Gd.length;e++)Gd[e]._workInProgressVersionPrimary=null;Gd.length=0}var mc=Xn.ReactCurrentDispatcher,Qd=Xn.ReactCurrentBatchConfig,fs=0,Ne=null,Be=null,We=null,Gc=!1,ba=!1,Wa=0,Bx=0;function it(){throw Error(K(321))}function Fp(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!dn(e[n],t[n]))return!1;return!0}function Up(e,t,n,r,i,a){if(fs=a,Ne=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,mc.current=e===null||e.memoizedState===null?Gx:Qx,e=n(r,i),ba){a=0;do{if(ba=!1,Wa=0,25<=a)throw Error(K(301));a+=1,We=Be=null,t.updateQueue=null,mc.current=Kx,e=n(r,i)}while(ba)}if(mc.current=Qc,t=Be!==null&&Be.next!==null,fs=0,We=Be=Ne=null,Gc=!1,t)throw Error(K(300));return e}function zp(){var e=Wa!==0;return Wa=0,e}function Sn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return We===null?Ne.memoizedState=We=e:We=We.next=e,We}function Kt(){if(Be===null){var e=Ne.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var t=We===null?Ne.memoizedState:We.next;if(t!==null)We=t,Be=e;else{if(e===null)throw Error(K(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},We===null?Ne.memoizedState=We=e:We=We.next=e}return We}function Ha(e,t){return typeof t=="function"?t(e):t}function Kd(e){var t=Kt(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var r=Be,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var f=o=null,h=null,_=a;do{var p=_.lane;if((fs&p)===p)h!==null&&(h=h.next={lane:0,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null}),r=_.hasEagerState?_.eagerState:e(r,_.action);else{var S={lane:p,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null};h===null?(f=h=S,o=r):h=h.next=S,Ne.lanes|=p,hs|=p}_=_.next}while(_!==null&&_!==a);h===null?o=r:h.next=f,dn(r,t.memoizedState)||(St=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=h,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do a=i.lane,Ne.lanes|=a,hs|=a,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Yd(e){var t=Kt(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);dn(a,t.memoizedState)||(St=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Sy(){}function Cy(e,t){var n=Ne,r=Kt(),i=t(),a=!dn(r.memoizedState,i);if(a&&(r.memoizedState=i,St=!0),r=r.queue,Bp(Ey.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||We!==null&&We.memoizedState.tag&1){if(n.flags|=2048,Ga(9,by.bind(null,n,r,i,t),void 0,null),He===null)throw Error(K(349));fs&30||xy(n,t,i)}return i}function xy(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Ne.updateQueue,t===null?(t={lastEffect:null,stores:null},Ne.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function by(e,t,n,r){t.value=n,t.getSnapshot=r,ky(t)&&Ty(e)}function Ey(e,t,n){return n(function(){ky(t)&&Ty(e)})}function ky(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!dn(e,n)}catch{return!0}}function Ty(e){var t=Jn(e,1);t!==null&&cn(t,e,1,-1)}function Fm(e){var t=Sn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:e},t.queue=e,e=e.dispatch=Hx.bind(null,Ne,e),[t.memoizedState,e]}function Ga(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Ne.updateQueue,t===null?(t={lastEffect:null,stores:null},Ne.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Ry(){return Kt().memoizedState}function gc(e,t,n,r){var i=Sn();Ne.flags|=e,i.memoizedState=Ga(1|t,n,void 0,r===void 0?null:r)}function al(e,t,n,r){var i=Kt();r=r===void 0?null:r;var a=void 0;if(Be!==null){var o=Be.memoizedState;if(a=o.destroy,r!==null&&Fp(r,o.deps)){i.memoizedState=Ga(t,n,a,r);return}}Ne.flags|=e,i.memoizedState=Ga(1|t,n,a,r)}function Um(e,t){return gc(8390656,8,e,t)}function Bp(e,t){return al(2048,8,e,t)}function Iy(e,t){return al(4,2,e,t)}function Ny(e,t){return al(4,4,e,t)}function Py(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function jy(e,t,n){return n=n!=null?n.concat([e]):null,al(4,4,Py.bind(null,t,e),n)}function Vp(){}function Dy(e,t){var n=Kt();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Fp(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ly(e,t){var n=Kt();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Fp(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function My(e,t,n){return fs&21?(dn(n,t)||(n=Uv(),Ne.lanes|=n,hs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,St=!0),e.memoizedState=n)}function Vx(e,t){var n=ge;ge=n!==0&&4>n?n:4,e(!0);var r=Qd.transition;Qd.transition={};try{e(!1),t()}finally{ge=n,Qd.transition=r}}function Oy(){return Kt().memoizedState}function Wx(e,t,n){var r=Sr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ay(e))$y(t,n);else if(n=yy(e,t,n,r),n!==null){var i=ht();cn(n,e,r,i),Fy(n,t,r)}}function Hx(e,t,n){var r=Sr(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ay(e))$y(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,f=a(o,n);if(i.hasEagerState=!0,i.eagerState=f,dn(f,o)){var h=t.interleaved;h===null?(i.next=i,Lp(t)):(i.next=h.next,h.next=i),t.interleaved=i;return}}catch{}finally{}n=yy(e,t,i,r),n!==null&&(i=ht(),cn(n,e,r,i),Fy(n,t,r))}}function Ay(e){var t=e.alternate;return e===Ne||t!==null&&t===Ne}function $y(e,t){ba=Gc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Fy(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,_p(e,n)}}var Qc={readContext:Qt,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useInsertionEffect:it,useLayoutEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useMutableSource:it,useSyncExternalStore:it,useId:it,unstable_isNewReconciler:!1},Gx={readContext:Qt,useCallback:function(e,t){return Sn().memoizedState=[e,t===void 0?null:t],e},useContext:Qt,useEffect:Um,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,gc(4194308,4,Py.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gc(4194308,4,e,t)},useInsertionEffect:function(e,t){return gc(4,2,e,t)},useMemo:function(e,t){var n=Sn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Sn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Wx.bind(null,Ne,e),[r.memoizedState,e]},useRef:function(e){var t=Sn();return e={current:e},t.memoizedState=e},useState:Fm,useDebugValue:Vp,useDeferredValue:function(e){return Sn().memoizedState=e},useTransition:function(){var e=Fm(!1),t=e[0];return e=Vx.bind(null,e[1]),Sn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Ne,i=Sn();if(Te){if(n===void 0)throw Error(K(407));n=n()}else{if(n=t(),He===null)throw Error(K(349));fs&30||xy(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Um(Ey.bind(null,r,a,e),[e]),r.flags|=2048,Ga(9,by.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Sn(),t=He.identifierPrefix;if(Te){var n=Hn,r=Wn;n=(r&~(1<<32-on(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Wa++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Bx++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Qx={readContext:Qt,useCallback:Dy,useContext:Qt,useEffect:Bp,useImperativeHandle:jy,useInsertionEffect:Iy,useLayoutEffect:Ny,useMemo:Ly,useReducer:Kd,useRef:Ry,useState:function(){return Kd(Ha)},useDebugValue:Vp,useDeferredValue:function(e){var t=Kt();return My(t,Be.memoizedState,e)},useTransition:function(){var e=Kd(Ha)[0],t=Kt().memoizedState;return[e,t]},useMutableSource:Sy,useSyncExternalStore:Cy,useId:Oy,unstable_isNewReconciler:!1},Kx={readContext:Qt,useCallback:Dy,useContext:Qt,useEffect:Bp,useImperativeHandle:jy,useInsertionEffect:Iy,useLayoutEffect:Ny,useMemo:Ly,useReducer:Yd,useRef:Ry,useState:function(){return Yd(Ha)},useDebugValue:Vp,useDeferredValue:function(e){var t=Kt();return Be===null?t.memoizedState=e:My(t,Be.memoizedState,e)},useTransition:function(){var e=Yd(Ha)[0],t=Kt().memoizedState;return[e,t]},useMutableSource:Sy,useSyncExternalStore:Cy,useId:Oy,unstable_isNewReconciler:!1};function rn(e,t){if(e&&e.defaultProps){t=Pe({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Uu(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Pe({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var ol={isMounted:function(e){return(e=e._reactInternals)?ws(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ht(),i=Sr(e),a=Gn(r,i);a.payload=t,n!=null&&(a.callback=n),t=wr(e,a,i),t!==null&&(cn(t,e,i,r),hc(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ht(),i=Sr(e),a=Gn(r,i);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=wr(e,a,i),t!==null&&(cn(t,e,i,r),hc(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ht(),r=Sr(e),i=Gn(n,r);i.tag=2,t!=null&&(i.callback=t),t=wr(e,i,r),t!==null&&(cn(t,e,r,n),hc(t,e,r))}};function zm(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!$a(n,r)||!$a(i,a):!0}function Uy(e,t,n){var r=!1,i=Er,a=t.contextType;return typeof a=="object"&&a!==null?a=Qt(a):(i=xt(t)?us:ct.current,r=t.contextTypes,a=(r=r!=null)?xi(e,i):Er),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ol,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Bm(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ol.enqueueReplaceState(t,t.state,null)}function zu(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Mp(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=Qt(a):(a=xt(t)?us:ct.current,i.context=xi(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(Uu(e,t,a,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&ol.enqueueReplaceState(i,i.state,null),Wc(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Ti(e,t){try{var n="",r=t;do n+=CC(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function Jd(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Bu(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Yx=typeof WeakMap=="function"?WeakMap:Map;function zy(e,t,n){n=Gn(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Yc||(Yc=!0,Xu=r),Bu(e,t)},n}function By(e,t,n){n=Gn(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Bu(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Bu(e,t),typeof r!="function"&&(_r===null?_r=new Set([this]):_r.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Vm(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Yx;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=l0.bind(null,e,t,n),t.then(e,e))}function Wm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Hm(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Gn(-1,1),t.tag=2,wr(n,t,1))),n.lanes|=1),e)}var Jx=Xn.ReactCurrentOwner,St=!1;function pt(e,t,n,r){t.child=e===null?vy(t,null,n,r):Ei(t,e.child,n,r)}function Gm(e,t,n,r,i){n=n.render;var a=t.ref;return mi(t,i),r=Up(e,t,n,r,a,i),n=zp(),e!==null&&!St?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qn(e,t,i)):(Te&&n&&Rp(t),t.flags|=1,pt(e,t,r,i),t.child)}function Qm(e,t,n,r,i){if(e===null){var a=n.type;return typeof a=="function"&&!qp(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,Vy(e,t,a,r,i)):(e=_c(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:$a,n(o,r)&&e.ref===t.ref)return qn(e,t,i)}return t.flags|=1,e=Cr(a,r),e.ref=t.ref,e.return=t,t.child=e}function Vy(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if($a(a,r)&&e.ref===t.ref)if(St=!1,t.pendingProps=r=a,(e.lanes&i)!==0)e.flags&131072&&(St=!0);else return t.lanes=e.lanes,qn(e,t,i)}return Vu(e,t,n,r,i)}function Wy(e,t,n){var r=t.pendingProps,i=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},_e(ci,Nt),Nt|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,_e(ci,Nt),Nt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,_e(ci,Nt),Nt|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,_e(ci,Nt),Nt|=r;return pt(e,t,i,n),t.child}function Hy(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Vu(e,t,n,r,i){var a=xt(n)?us:ct.current;return a=xi(t,a),mi(t,i),n=Up(e,t,n,r,a,i),r=zp(),e!==null&&!St?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qn(e,t,i)):(Te&&r&&Rp(t),t.flags|=1,pt(e,t,n,i),t.child)}function Km(e,t,n,r,i){if(xt(n)){var a=!0;Fc(t)}else a=!1;if(mi(t,i),t.stateNode===null)vc(e,t),Uy(t,n,r),zu(t,n,r,i),r=!0;else if(e===null){var o=t.stateNode,f=t.memoizedProps;o.props=f;var h=o.context,_=n.contextType;typeof _=="object"&&_!==null?_=Qt(_):(_=xt(n)?us:ct.current,_=xi(t,_));var p=n.getDerivedStateFromProps,S=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";S||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(f!==r||h!==_)&&Bm(t,o,r,_),lr=!1;var k=t.memoizedState;o.state=k,Wc(t,r,o,i),h=t.memoizedState,f!==r||k!==h||Ct.current||lr?(typeof p=="function"&&(Uu(t,n,p,r),h=t.memoizedState),(f=lr||zm(t,n,f,r,k,h,_))?(S||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=_,r=f):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,wy(e,t),f=t.memoizedProps,_=t.type===t.elementType?f:rn(t.type,f),o.props=_,S=t.pendingProps,k=o.context,h=n.contextType,typeof h=="object"&&h!==null?h=Qt(h):(h=xt(n)?us:ct.current,h=xi(t,h));var M=n.getDerivedStateFromProps;(p=typeof M=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(f!==S||k!==h)&&Bm(t,o,r,h),lr=!1,k=t.memoizedState,o.state=k,Wc(t,r,o,i);var V=t.memoizedState;f!==S||k!==V||Ct.current||lr?(typeof M=="function"&&(Uu(t,n,M,r),V=t.memoizedState),(_=lr||zm(t,n,_,r,k,V,h)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,V,h),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,V,h)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=V),o.props=r,o.state=V,o.context=h,r=_):(typeof o.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),r=!1)}return Wu(e,t,n,r,a,i)}function Wu(e,t,n,r,i,a){Hy(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return i&&Dm(t,n,!1),qn(e,t,a);r=t.stateNode,Jx.current=t;var f=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Ei(t,e.child,null,a),t.child=Ei(t,null,f,a)):pt(e,t,f,a),t.memoizedState=r.state,i&&Dm(t,n,!0),t.child}function Gy(e){var t=e.stateNode;t.pendingContext?jm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&jm(e,t.context,!1),Op(e,t.containerInfo)}function Ym(e,t,n,r,i){return bi(),Np(i),t.flags|=256,pt(e,t,n,r),t.child}var Hu={dehydrated:null,treeContext:null,retryLane:0};function Gu(e){return{baseLanes:e,cachePool:null,transitions:null}}function Qy(e,t,n){var r=t.pendingProps,i=Ie.current,a=!1,o=(t.flags&128)!==0,f;if((f=o)||(f=e!==null&&e.memoizedState===null?!1:(i&2)!==0),f?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),_e(Ie,i&1),e===null)return $u(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=dl(o,r,0,null),e=ds(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Gu(n),t.memoizedState=Hu,e):Wp(t,o));if(i=e.memoizedState,i!==null&&(f=i.dehydrated,f!==null))return qx(e,t,o,r,f,i,n);if(a){a=r.fallback,o=t.mode,i=e.child,f=i.sibling;var h={mode:"hidden",children:r.children};return!(o&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=h,t.deletions=null):(r=Cr(i,h),r.subtreeFlags=i.subtreeFlags&14680064),f!==null?a=Cr(f,a):(a=ds(a,o,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,o=e.child.memoizedState,o=o===null?Gu(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~n,t.memoizedState=Hu,r}return a=e.child,e=a.sibling,r=Cr(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Wp(e,t){return t=dl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function tc(e,t,n,r){return r!==null&&Np(r),Ei(t,e.child,null,n),e=Wp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function qx(e,t,n,r,i,a,o){if(n)return t.flags&256?(t.flags&=-257,r=Jd(Error(K(422))),tc(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=dl({mode:"visible",children:r.children},i,0,null),a=ds(a,i,o,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&Ei(t,e.child,null,o),t.child.memoizedState=Gu(o),t.memoizedState=Hu,a);if(!(t.mode&1))return tc(e,t,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var f=r.dgst;return r=f,a=Error(K(419)),r=Jd(a,r,void 0),tc(e,t,o,r)}if(f=(o&e.childLanes)!==0,St||f){if(r=He,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Jn(e,i),cn(r,e,i,-1))}return Jp(),r=Jd(Error(K(421))),tc(e,t,o,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=d0.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,jt=yr(i.nextSibling),Dt=t,Te=!0,an=null,e!==null&&(Vt[Wt++]=Wn,Vt[Wt++]=Hn,Vt[Wt++]=ps,Wn=e.id,Hn=e.overflow,ps=t),t=Wp(t,r.children),t.flags|=4096,t)}function Jm(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Fu(e.return,t,n)}function qd(e,t,n,r,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Ky(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(pt(e,t,r.children,n),r=Ie.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Jm(e,n,t);else if(e.tag===19)Jm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(_e(Ie,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Hc(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),qd(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Hc(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}qd(t,!0,n,null,a);break;case"together":qd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function vc(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),hs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(K(153));if(t.child!==null){for(e=t.child,n=Cr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Cr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Xx(e,t,n){switch(t.tag){case 3:Gy(t),bi();break;case 5:_y(t);break;case 1:xt(t.type)&&Fc(t);break;case 4:Op(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;_e(Bc,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(_e(Ie,Ie.current&1),t.flags|=128,null):n&t.child.childLanes?Qy(e,t,n):(_e(Ie,Ie.current&1),e=qn(e,t,n),e!==null?e.sibling:null);_e(Ie,Ie.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Ky(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),_e(Ie,Ie.current),r)break;return null;case 22:case 23:return t.lanes=0,Wy(e,t,n)}return qn(e,t,n)}var Yy,Qu,Jy,qy;Yy=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qu=function(){};Jy=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Xr(Tn.current);var a=null;switch(n){case"input":i=mu(e,i),r=mu(e,r),a=[];break;case"select":i=Pe({},i,{value:void 0}),r=Pe({},r,{value:void 0}),a=[];break;case"textarea":i=yu(e,i),r=yu(e,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Ac)}_u(n,r);var o;n=null;for(_ in i)if(!r.hasOwnProperty(_)&&i.hasOwnProperty(_)&&i[_]!=null)if(_==="style"){var f=i[_];for(o in f)f.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else _!=="dangerouslySetInnerHTML"&&_!=="children"&&_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(Pa.hasOwnProperty(_)?a||(a=[]):(a=a||[]).push(_,null));for(_ in r){var h=r[_];if(f=i!=null?i[_]:void 0,r.hasOwnProperty(_)&&h!==f&&(h!=null||f!=null))if(_==="style")if(f){for(o in f)!f.hasOwnProperty(o)||h&&h.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in h)h.hasOwnProperty(o)&&f[o]!==h[o]&&(n||(n={}),n[o]=h[o])}else n||(a||(a=[]),a.push(_,n)),n=h;else _==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,f=f?f.__html:void 0,h!=null&&f!==h&&(a=a||[]).push(_,h)):_==="children"?typeof h!="string"&&typeof h!="number"||(a=a||[]).push(_,""+h):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&(Pa.hasOwnProperty(_)?(h!=null&&_==="onScroll"&&xe("scroll",e),a||f===h||(a=[])):(a=a||[]).push(_,h))}n&&(a=a||[]).push("style",n);var _=a;(t.updateQueue=_)&&(t.flags|=4)}};qy=function(e,t,n,r){n!==r&&(t.flags|=4)};function ia(e,t){if(!Te)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function at(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Zx(e,t,n){var r=t.pendingProps;switch(Ip(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(t),null;case 1:return xt(t.type)&&$c(),at(t),null;case 3:return r=t.stateNode,ki(),be(Ct),be(ct),$p(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Zo(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,an!==null&&(tp(an),an=null))),Qu(e,t),at(t),null;case 5:Ap(t);var i=Xr(Va.current);if(n=t.type,e!==null&&t.stateNode!=null)Jy(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(K(166));return at(t),null}if(e=Xr(Tn.current),Zo(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[En]=t,r[za]=a,e=(t.mode&1)!==0,n){case"dialog":xe("cancel",r),xe("close",r);break;case"iframe":case"object":case"embed":xe("load",r);break;case"video":case"audio":for(i=0;i<ya.length;i++)xe(ya[i],r);break;case"source":xe("error",r);break;case"img":case"image":case"link":xe("error",r),xe("load",r);break;case"details":xe("toggle",r);break;case"input":im(r,a),xe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},xe("invalid",r);break;case"textarea":om(r,a),xe("invalid",r)}_u(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var f=a[o];o==="children"?typeof f=="string"?r.textContent!==f&&(a.suppressHydrationWarning!==!0&&Xo(r.textContent,f,e),i=["children",f]):typeof f=="number"&&r.textContent!==""+f&&(a.suppressHydrationWarning!==!0&&Xo(r.textContent,f,e),i=["children",""+f]):Pa.hasOwnProperty(o)&&f!=null&&o==="onScroll"&&xe("scroll",r)}switch(n){case"input":Wo(r),am(r,a,!0);break;case"textarea":Wo(r),cm(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Ac)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ev(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[En]=t,e[za]=r,Yy(e,t,!1,!1),t.stateNode=e;e:{switch(o=Su(n,r),n){case"dialog":xe("cancel",e),xe("close",e),i=r;break;case"iframe":case"object":case"embed":xe("load",e),i=r;break;case"video":case"audio":for(i=0;i<ya.length;i++)xe(ya[i],e);i=r;break;case"source":xe("error",e),i=r;break;case"img":case"image":case"link":xe("error",e),xe("load",e),i=r;break;case"details":xe("toggle",e),i=r;break;case"input":im(e,r),i=mu(e,r),xe("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Pe({},r,{value:void 0}),xe("invalid",e);break;case"textarea":om(e,r),i=yu(e,r),xe("invalid",e);break;default:i=r}_u(n,i),f=i;for(a in f)if(f.hasOwnProperty(a)){var h=f[a];a==="style"?Rv(e,h):a==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,h!=null&&kv(e,h)):a==="children"?typeof h=="string"?(n!=="textarea"||h!=="")&&ja(e,h):typeof h=="number"&&ja(e,""+h):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Pa.hasOwnProperty(a)?h!=null&&a==="onScroll"&&xe("scroll",e):h!=null&&hp(e,a,h,o))}switch(n){case"input":Wo(e),am(e,r,!1);break;case"textarea":Wo(e),cm(e);break;case"option":r.value!=null&&e.setAttribute("value",""+br(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?ui(e,!!r.multiple,a,!1):r.defaultValue!=null&&ui(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Ac)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return at(t),null;case 6:if(e&&t.stateNode!=null)qy(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(K(166));if(n=Xr(Va.current),Xr(Tn.current),Zo(t)){if(r=t.stateNode,n=t.memoizedProps,r[En]=t,(a=r.nodeValue!==n)&&(e=Dt,e!==null))switch(e.tag){case 3:Xo(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Xo(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[En]=t,t.stateNode=r}return at(t),null;case 13:if(be(Ie),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Te&&jt!==null&&t.mode&1&&!(t.flags&128))my(),bi(),t.flags|=98560,a=!1;else if(a=Zo(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(K(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(K(317));a[En]=t}else bi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;at(t),a=!1}else an!==null&&(tp(an),an=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ie.current&1?Ve===0&&(Ve=3):Jp())),t.updateQueue!==null&&(t.flags|=4),at(t),null);case 4:return ki(),Qu(e,t),e===null&&Fa(t.stateNode.containerInfo),at(t),null;case 10:return Dp(t.type._context),at(t),null;case 17:return xt(t.type)&&$c(),at(t),null;case 19:if(be(Ie),a=t.memoizedState,a===null)return at(t),null;if(r=(t.flags&128)!==0,o=a.rendering,o===null)if(r)ia(a,!1);else{if(Ve!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Hc(e),o!==null){for(t.flags|=128,ia(a,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return _e(Ie,Ie.current&1|2),t.child}e=e.sibling}a.tail!==null&&Oe()>Ri&&(t.flags|=128,r=!0,ia(a,!1),t.lanes=4194304)}else{if(!r)if(e=Hc(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ia(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Te)return at(t),null}else 2*Oe()-a.renderingStartTime>Ri&&n!==1073741824&&(t.flags|=128,r=!0,ia(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(n=a.last,n!==null?n.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Oe(),t.sibling=null,n=Ie.current,_e(Ie,r?n&1|2:n&1),t):(at(t),null);case 22:case 23:return Yp(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Nt&1073741824&&(at(t),t.subtreeFlags&6&&(t.flags|=8192)):at(t),null;case 24:return null;case 25:return null}throw Error(K(156,t.tag))}function e0(e,t){switch(Ip(t),t.tag){case 1:return xt(t.type)&&$c(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ki(),be(Ct),be(ct),$p(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ap(t),null;case 13:if(be(Ie),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(K(340));bi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return be(Ie),null;case 4:return ki(),null;case 10:return Dp(t.type._context),null;case 22:case 23:return Yp(),null;case 24:return null;default:return null}}var nc=!1,ot=!1,t0=typeof WeakSet=="function"?WeakSet:Set,ee=null;function oi(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){De(e,t,r)}else n.current=null}function Ku(e,t,n){try{n()}catch(r){De(e,t,r)}}var qm=!1;function n0(e,t){if(Pu=Lc,e=ny(),Tp(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,f=-1,h=-1,_=0,p=0,S=e,k=null;t:for(;;){for(var M;S!==n||i!==0&&S.nodeType!==3||(f=o+i),S!==a||r!==0&&S.nodeType!==3||(h=o+r),S.nodeType===3&&(o+=S.nodeValue.length),(M=S.firstChild)!==null;)k=S,S=M;for(;;){if(S===e)break t;if(k===n&&++_===i&&(f=o),k===a&&++p===r&&(h=o),(M=S.nextSibling)!==null)break;S=k,k=S.parentNode}S=M}n=f===-1||h===-1?null:{start:f,end:h}}else n=null}n=n||{start:0,end:0}}else n=null;for(ju={focusedElem:e,selectionRange:n},Lc=!1,ee=t;ee!==null;)if(t=ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ee=e;else for(;ee!==null;){t=ee;try{var V=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var B=V.memoizedProps,v=V.memoizedState,l=t.stateNode,u=l.getSnapshotBeforeUpdate(t.elementType===t.type?B:rn(t.type,B),v);l.__reactInternalSnapshotBeforeUpdate=u}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(C){De(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,ee=e;break}ee=t.return}return V=qm,qm=!1,V}function Ea(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&Ku(t,n,a)}i=i.next}while(i!==r)}}function cl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Yu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Xy(e){var t=e.alternate;t!==null&&(e.alternate=null,Xy(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[En],delete t[za],delete t[Mu],delete t[$x],delete t[Fx])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Zy(e){return e.tag===5||e.tag===3||e.tag===4}function Xm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Zy(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ju(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ac));else if(r!==4&&(e=e.child,e!==null))for(Ju(e,t,n),e=e.sibling;e!==null;)Ju(e,t,n),e=e.sibling}function qu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(qu(e,t,n),e=e.sibling;e!==null;)qu(e,t,n),e=e.sibling}var Je=null,sn=!1;function or(e,t,n){for(n=n.child;n!==null;)ew(e,t,n),n=n.sibling}function ew(e,t,n){if(kn&&typeof kn.onCommitFiberUnmount=="function")try{kn.onCommitFiberUnmount(el,n)}catch{}switch(n.tag){case 5:ot||oi(n,t);case 6:var r=Je,i=sn;Je=null,or(e,t,n),Je=r,sn=i,Je!==null&&(sn?(e=Je,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Je.removeChild(n.stateNode));break;case 18:Je!==null&&(sn?(e=Je,n=n.stateNode,e.nodeType===8?Wd(e.parentNode,n):e.nodeType===1&&Wd(e,n),Oa(e)):Wd(Je,n.stateNode));break;case 4:r=Je,i=sn,Je=n.stateNode.containerInfo,sn=!0,or(e,t,n),Je=r,sn=i;break;case 0:case 11:case 14:case 15:if(!ot&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Ku(n,t,o),i=i.next}while(i!==r)}or(e,t,n);break;case 1:if(!ot&&(oi(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(f){De(n,t,f)}or(e,t,n);break;case 21:or(e,t,n);break;case 22:n.mode&1?(ot=(r=ot)||n.memoizedState!==null,or(e,t,n),ot=r):or(e,t,n);break;default:or(e,t,n)}}function Zm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new t0),t.forEach(function(r){var i=u0.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function nn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,f=o;e:for(;f!==null;){switch(f.tag){case 5:Je=f.stateNode,sn=!1;break e;case 3:Je=f.stateNode.containerInfo,sn=!0;break e;case 4:Je=f.stateNode.containerInfo,sn=!0;break e}f=f.return}if(Je===null)throw Error(K(160));ew(a,o,i),Je=null,sn=!1;var h=i.alternate;h!==null&&(h.return=null),i.return=null}catch(_){De(i,t,_)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tw(t,e),t=t.sibling}function tw(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nn(t,e),yn(e),r&4){try{Ea(3,e,e.return),cl(3,e)}catch(B){De(e,e.return,B)}try{Ea(5,e,e.return)}catch(B){De(e,e.return,B)}}break;case 1:nn(t,e),yn(e),r&512&&n!==null&&oi(n,n.return);break;case 5:if(nn(t,e),yn(e),r&512&&n!==null&&oi(n,n.return),e.flags&32){var i=e.stateNode;try{ja(i,"")}catch(B){De(e,e.return,B)}}if(r&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=n!==null?n.memoizedProps:a,f=e.type,h=e.updateQueue;if(e.updateQueue=null,h!==null)try{f==="input"&&a.type==="radio"&&a.name!=null&&xv(i,a),Su(f,o);var _=Su(f,a);for(o=0;o<h.length;o+=2){var p=h[o],S=h[o+1];p==="style"?Rv(i,S):p==="dangerouslySetInnerHTML"?kv(i,S):p==="children"?ja(i,S):hp(i,p,S,_)}switch(f){case"input":gu(i,a);break;case"textarea":bv(i,a);break;case"select":var k=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var M=a.value;M!=null?ui(i,!!a.multiple,M,!1):k!==!!a.multiple&&(a.defaultValue!=null?ui(i,!!a.multiple,a.defaultValue,!0):ui(i,!!a.multiple,a.multiple?[]:"",!1))}i[za]=a}catch(B){De(e,e.return,B)}}break;case 6:if(nn(t,e),yn(e),r&4){if(e.stateNode===null)throw Error(K(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(B){De(e,e.return,B)}}break;case 3:if(nn(t,e),yn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Oa(t.containerInfo)}catch(B){De(e,e.return,B)}break;case 4:nn(t,e),yn(e);break;case 13:nn(t,e),yn(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Qp=Oe())),r&4&&Zm(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(ot=(_=ot)||p,nn(t,e),ot=_):nn(t,e),yn(e),r&8192){if(_=e.memoizedState!==null,(e.stateNode.isHidden=_)&&!p&&e.mode&1)for(ee=e,p=e.child;p!==null;){for(S=ee=p;ee!==null;){switch(k=ee,M=k.child,k.tag){case 0:case 11:case 14:case 15:Ea(4,k,k.return);break;case 1:oi(k,k.return);var V=k.stateNode;if(typeof V.componentWillUnmount=="function"){r=k,n=k.return;try{t=r,V.props=t.memoizedProps,V.state=t.memoizedState,V.componentWillUnmount()}catch(B){De(r,n,B)}}break;case 5:oi(k,k.return);break;case 22:if(k.memoizedState!==null){tg(S);continue}}M!==null?(M.return=k,ee=M):tg(S)}p=p.sibling}e:for(p=null,S=e;;){if(S.tag===5){if(p===null){p=S;try{i=S.stateNode,_?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(f=S.stateNode,h=S.memoizedProps.style,o=h!=null&&h.hasOwnProperty("display")?h.display:null,f.style.display=Tv("display",o))}catch(B){De(e,e.return,B)}}}else if(S.tag===6){if(p===null)try{S.stateNode.nodeValue=_?"":S.memoizedProps}catch(B){De(e,e.return,B)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===e)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===e)break e;for(;S.sibling===null;){if(S.return===null||S.return===e)break e;p===S&&(p=null),S=S.return}p===S&&(p=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:nn(t,e),yn(e),r&4&&Zm(e);break;case 21:break;default:nn(t,e),yn(e)}}function yn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Zy(n)){var r=n;break e}n=n.return}throw Error(K(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ja(i,""),r.flags&=-33);var a=Xm(e);qu(e,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,f=Xm(e);Ju(e,f,o);break;default:throw Error(K(161))}}catch(h){De(e,e.return,h)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function r0(e,t,n){ee=e,nw(e)}function nw(e,t,n){for(var r=(e.mode&1)!==0;ee!==null;){var i=ee,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||nc;if(!o){var f=i.alternate,h=f!==null&&f.memoizedState!==null||ot;f=nc;var _=ot;if(nc=o,(ot=h)&&!_)for(ee=i;ee!==null;)o=ee,h=o.child,o.tag===22&&o.memoizedState!==null?ng(i):h!==null?(h.return=o,ee=h):ng(i);for(;a!==null;)ee=a,nw(a),a=a.sibling;ee=i,nc=f,ot=_}eg(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,ee=a):eg(e)}}function eg(e){for(;ee!==null;){var t=ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ot||cl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ot)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:rn(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&$m(t,a,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}$m(t,o,n)}break;case 5:var f=t.stateNode;if(n===null&&t.flags&4){n=f;var h=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":h.autoFocus&&n.focus();break;case"img":h.src&&(n.src=h.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var _=t.alternate;if(_!==null){var p=_.memoizedState;if(p!==null){var S=p.dehydrated;S!==null&&Oa(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}ot||t.flags&512&&Yu(t)}catch(k){De(t,t.return,k)}}if(t===e){ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,ee=n;break}ee=t.return}}function tg(e){for(;ee!==null;){var t=ee;if(t===e){ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ee=n;break}ee=t.return}}function ng(e){for(;ee!==null;){var t=ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{cl(4,t)}catch(h){De(t,n,h)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(h){De(t,i,h)}}var a=t.return;try{Yu(t)}catch(h){De(t,a,h)}break;case 5:var o=t.return;try{Yu(t)}catch(h){De(t,o,h)}}}catch(h){De(t,t.return,h)}if(t===e){ee=null;break}var f=t.sibling;if(f!==null){f.return=t.return,ee=f;break}ee=t.return}}var s0=Math.ceil,Kc=Xn.ReactCurrentDispatcher,Hp=Xn.ReactCurrentOwner,Gt=Xn.ReactCurrentBatchConfig,me=0,He=null,Ue=null,qe=0,Nt=0,ci=Tr(0),Ve=0,Qa=null,hs=0,ll=0,Gp=0,ka=null,_t=null,Qp=0,Ri=1/0,Bn=null,Yc=!1,Xu=null,_r=null,rc=!1,hr=null,Jc=0,Ta=0,Zu=null,yc=-1,wc=0;function ht(){return me&6?Oe():yc!==-1?yc:yc=Oe()}function Sr(e){return e.mode&1?me&2&&qe!==0?qe&-qe:zx.transition!==null?(wc===0&&(wc=Uv()),wc):(e=ge,e!==0||(e=window.event,e=e===void 0?16:Qv(e.type)),e):1}function cn(e,t,n,r){if(50<Ta)throw Ta=0,Zu=null,Error(K(185));Ja(e,n,r),(!(me&2)||e!==He)&&(e===He&&(!(me&2)&&(ll|=n),Ve===4&&ur(e,qe)),bt(e,r),n===1&&me===0&&!(t.mode&1)&&(Ri=Oe()+500,il&&Rr()))}function bt(e,t){var n=e.callbackNode;zC(e,t);var r=Dc(e,e===He?qe:0);if(r===0)n!==null&&um(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&um(n),t===1)e.tag===0?Ux(rg.bind(null,e)):py(rg.bind(null,e)),Ox(function(){!(me&6)&&Rr()}),n=null;else{switch(zv(r)){case 1:n=wp;break;case 4:n=$v;break;case 16:n=jc;break;case 536870912:n=Fv;break;default:n=jc}n=dw(n,rw.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rw(e,t){if(yc=-1,wc=0,me&6)throw Error(K(327));var n=e.callbackNode;if(gi()&&e.callbackNode!==n)return null;var r=Dc(e,e===He?qe:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=qc(e,r);else{t=r;var i=me;me|=2;var a=iw();(He!==e||qe!==t)&&(Bn=null,Ri=Oe()+500,ls(e,t));do try{o0();break}catch(f){sw(e,f)}while(!0);jp(),Kc.current=a,me=i,Ue!==null?t=0:(He=null,qe=0,t=Ve)}if(t!==0){if(t===2&&(i=ku(e),i!==0&&(r=i,t=ep(e,i))),t===1)throw n=Qa,ls(e,0),ur(e,r),bt(e,Oe()),n;if(t===6)ur(e,r);else{if(i=e.current.alternate,!(r&30)&&!i0(i)&&(t=qc(e,r),t===2&&(a=ku(e),a!==0&&(r=a,t=ep(e,a))),t===1))throw n=Qa,ls(e,0),ur(e,r),bt(e,Oe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(K(345));case 2:Yr(e,_t,Bn);break;case 3:if(ur(e,r),(r&130023424)===r&&(t=Qp+500-Oe(),10<t)){if(Dc(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){ht(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Lu(Yr.bind(null,e,_t,Bn),t);break}Yr(e,_t,Bn);break;case 4:if(ur(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-on(r);a=1<<o,o=t[o],o>i&&(i=o),r&=~a}if(r=i,r=Oe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*s0(r/1960))-r,10<r){e.timeoutHandle=Lu(Yr.bind(null,e,_t,Bn),r);break}Yr(e,_t,Bn);break;case 5:Yr(e,_t,Bn);break;default:throw Error(K(329))}}}return bt(e,Oe()),e.callbackNode===n?rw.bind(null,e):null}function ep(e,t){var n=ka;return e.current.memoizedState.isDehydrated&&(ls(e,t).flags|=256),e=qc(e,t),e!==2&&(t=_t,_t=n,t!==null&&tp(t)),e}function tp(e){_t===null?_t=e:_t.push.apply(_t,e)}function i0(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!dn(a(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ur(e,t){for(t&=~Gp,t&=~ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-on(t),r=1<<n;e[n]=-1,t&=~r}}function rg(e){if(me&6)throw Error(K(327));gi();var t=Dc(e,0);if(!(t&1))return bt(e,Oe()),null;var n=qc(e,t);if(e.tag!==0&&n===2){var r=ku(e);r!==0&&(t=r,n=ep(e,r))}if(n===1)throw n=Qa,ls(e,0),ur(e,t),bt(e,Oe()),n;if(n===6)throw Error(K(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Yr(e,_t,Bn),bt(e,Oe()),null}function Kp(e,t){var n=me;me|=1;try{return e(t)}finally{me=n,me===0&&(Ri=Oe()+500,il&&Rr())}}function ms(e){hr!==null&&hr.tag===0&&!(me&6)&&gi();var t=me;me|=1;var n=Gt.transition,r=ge;try{if(Gt.transition=null,ge=1,e)return e()}finally{ge=r,Gt.transition=n,me=t,!(me&6)&&Rr()}}function Yp(){Nt=ci.current,be(ci)}function ls(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Mx(n)),Ue!==null)for(n=Ue.return;n!==null;){var r=n;switch(Ip(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$c();break;case 3:ki(),be(Ct),be(ct),$p();break;case 5:Ap(r);break;case 4:ki();break;case 13:be(Ie);break;case 19:be(Ie);break;case 10:Dp(r.type._context);break;case 22:case 23:Yp()}n=n.return}if(He=e,Ue=e=Cr(e.current,null),qe=Nt=t,Ve=0,Qa=null,Gp=ll=hs=0,_t=ka=null,qr!==null){for(t=0;t<qr.length;t++)if(n=qr[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}qr=null}return e}function sw(e,t){do{var n=Ue;try{if(jp(),mc.current=Qc,Gc){for(var r=Ne.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Gc=!1}if(fs=0,We=Be=Ne=null,ba=!1,Wa=0,Hp.current=null,n===null||n.return===null){Ve=1,Qa=t,Ue=null;break}e:{var a=e,o=n.return,f=n,h=t;if(t=qe,f.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){var _=h,p=f,S=p.tag;if(!(p.mode&1)&&(S===0||S===11||S===15)){var k=p.alternate;k?(p.updateQueue=k.updateQueue,p.memoizedState=k.memoizedState,p.lanes=k.lanes):(p.updateQueue=null,p.memoizedState=null)}var M=Wm(o);if(M!==null){M.flags&=-257,Hm(M,o,f,a,t),M.mode&1&&Vm(a,_,t),t=M,h=_;var V=t.updateQueue;if(V===null){var B=new Set;B.add(h),t.updateQueue=B}else V.add(h);break e}else{if(!(t&1)){Vm(a,_,t),Jp();break e}h=Error(K(426))}}else if(Te&&f.mode&1){var v=Wm(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Hm(v,o,f,a,t),Np(Ti(h,f));break e}}a=h=Ti(h,f),Ve!==4&&(Ve=2),ka===null?ka=[a]:ka.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var l=zy(a,h,t);Am(a,l);break e;case 1:f=h;var u=a.type,g=a.stateNode;if(!(a.flags&128)&&(typeof u.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(_r===null||!_r.has(g)))){a.flags|=65536,t&=-t,a.lanes|=t;var C=By(a,f,t);Am(a,C);break e}}a=a.return}while(a!==null)}ow(n)}catch(N){t=N,Ue===n&&n!==null&&(Ue=n=n.return);continue}break}while(!0)}function iw(){var e=Kc.current;return Kc.current=Qc,e===null?Qc:e}function Jp(){(Ve===0||Ve===3||Ve===2)&&(Ve=4),He===null||!(hs&268435455)&&!(ll&268435455)||ur(He,qe)}function qc(e,t){var n=me;me|=2;var r=iw();(He!==e||qe!==t)&&(Bn=null,ls(e,t));do try{a0();break}catch(i){sw(e,i)}while(!0);if(jp(),me=n,Kc.current=r,Ue!==null)throw Error(K(261));return He=null,qe=0,Ve}function a0(){for(;Ue!==null;)aw(Ue)}function o0(){for(;Ue!==null&&!jC();)aw(Ue)}function aw(e){var t=lw(e.alternate,e,Nt);e.memoizedProps=e.pendingProps,t===null?ow(e):Ue=t,Hp.current=null}function ow(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=e0(n,t),n!==null){n.flags&=32767,Ue=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ve=6,Ue=null;return}}else if(n=Zx(n,t,Nt),n!==null){Ue=n;return}if(t=t.sibling,t!==null){Ue=t;return}Ue=t=e}while(t!==null);Ve===0&&(Ve=5)}function Yr(e,t,n){var r=ge,i=Gt.transition;try{Gt.transition=null,ge=1,c0(e,t,n,r)}finally{Gt.transition=i,ge=r}return null}function c0(e,t,n,r){do gi();while(hr!==null);if(me&6)throw Error(K(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(K(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(BC(e,a),e===He&&(Ue=He=null,qe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||rc||(rc=!0,dw(jc,function(){return gi(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Gt.transition,Gt.transition=null;var o=ge;ge=1;var f=me;me|=4,Hp.current=null,n0(e,n),tw(n,e),Rx(ju),Lc=!!Pu,ju=Pu=null,e.current=n,r0(n),DC(),me=f,ge=o,Gt.transition=a}else e.current=n;if(rc&&(rc=!1,hr=e,Jc=i),a=e.pendingLanes,a===0&&(_r=null),OC(n.stateNode),bt(e,Oe()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Yc)throw Yc=!1,e=Xu,Xu=null,e;return Jc&1&&e.tag!==0&&gi(),a=e.pendingLanes,a&1?e===Zu?Ta++:(Ta=0,Zu=e):Ta=0,Rr(),null}function gi(){if(hr!==null){var e=zv(Jc),t=Gt.transition,n=ge;try{if(Gt.transition=null,ge=16>e?16:e,hr===null)var r=!1;else{if(e=hr,hr=null,Jc=0,me&6)throw Error(K(331));var i=me;for(me|=4,ee=e.current;ee!==null;){var a=ee,o=a.child;if(ee.flags&16){var f=a.deletions;if(f!==null){for(var h=0;h<f.length;h++){var _=f[h];for(ee=_;ee!==null;){var p=ee;switch(p.tag){case 0:case 11:case 15:Ea(8,p,a)}var S=p.child;if(S!==null)S.return=p,ee=S;else for(;ee!==null;){p=ee;var k=p.sibling,M=p.return;if(Xy(p),p===_){ee=null;break}if(k!==null){k.return=M,ee=k;break}ee=M}}}var V=a.alternate;if(V!==null){var B=V.child;if(B!==null){V.child=null;do{var v=B.sibling;B.sibling=null,B=v}while(B!==null)}}ee=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,ee=o;else e:for(;ee!==null;){if(a=ee,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Ea(9,a,a.return)}var l=a.sibling;if(l!==null){l.return=a.return,ee=l;break e}ee=a.return}}var u=e.current;for(ee=u;ee!==null;){o=ee;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,ee=g;else e:for(o=u;ee!==null;){if(f=ee,f.flags&2048)try{switch(f.tag){case 0:case 11:case 15:cl(9,f)}}catch(N){De(f,f.return,N)}if(f===o){ee=null;break e}var C=f.sibling;if(C!==null){C.return=f.return,ee=C;break e}ee=f.return}}if(me=i,Rr(),kn&&typeof kn.onPostCommitFiberRoot=="function")try{kn.onPostCommitFiberRoot(el,e)}catch{}r=!0}return r}finally{ge=n,Gt.transition=t}}return!1}function sg(e,t,n){t=Ti(n,t),t=zy(e,t,1),e=wr(e,t,1),t=ht(),e!==null&&(Ja(e,1,t),bt(e,t))}function De(e,t,n){if(e.tag===3)sg(e,e,n);else for(;t!==null;){if(t.tag===3){sg(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(_r===null||!_r.has(r))){e=Ti(n,e),e=By(t,e,1),t=wr(t,e,1),e=ht(),t!==null&&(Ja(t,1,e),bt(t,e));break}}t=t.return}}function l0(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=ht(),e.pingedLanes|=e.suspendedLanes&n,He===e&&(qe&n)===n&&(Ve===4||Ve===3&&(qe&130023424)===qe&&500>Oe()-Qp?ls(e,0):Gp|=n),bt(e,t)}function cw(e,t){t===0&&(e.mode&1?(t=Qo,Qo<<=1,!(Qo&130023424)&&(Qo=4194304)):t=1);var n=ht();e=Jn(e,t),e!==null&&(Ja(e,t,n),bt(e,n))}function d0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),cw(e,n)}function u0(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(t),cw(e,n)}var lw;lw=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ct.current)St=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return St=!1,Xx(e,t,n);St=!!(e.flags&131072)}else St=!1,Te&&t.flags&1048576&&fy(t,zc,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;vc(e,t),e=t.pendingProps;var i=xi(t,ct.current);mi(t,n),i=Up(null,t,r,e,i,n);var a=zp();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xt(r)?(a=!0,Fc(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Mp(t),i.updater=ol,t.stateNode=i,i._reactInternals=t,zu(t,r,e,n),t=Wu(null,t,r,!0,a,n)):(t.tag=0,Te&&a&&Rp(t),pt(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(vc(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=f0(r),e=rn(r,e),i){case 0:t=Vu(null,t,r,e,n);break e;case 1:t=Km(null,t,r,e,n);break e;case 11:t=Gm(null,t,r,e,n);break e;case 14:t=Qm(null,t,r,rn(r.type,e),n);break e}throw Error(K(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:rn(r,i),Vu(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:rn(r,i),Km(e,t,r,i,n);case 3:e:{if(Gy(t),e===null)throw Error(K(387));r=t.pendingProps,a=t.memoizedState,i=a.element,wy(e,t),Wc(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=Ti(Error(K(423)),t),t=Ym(e,t,r,n,i);break e}else if(r!==i){i=Ti(Error(K(424)),t),t=Ym(e,t,r,n,i);break e}else for(jt=yr(t.stateNode.containerInfo.firstChild),Dt=t,Te=!0,an=null,n=vy(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bi(),r===i){t=qn(e,t,n);break e}pt(e,t,r,n)}t=t.child}return t;case 5:return _y(t),e===null&&$u(t),r=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,Du(r,i)?o=null:a!==null&&Du(r,a)&&(t.flags|=32),Hy(e,t),pt(e,t,o,n),t.child;case 6:return e===null&&$u(t),null;case 13:return Qy(e,t,n);case 4:return Op(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ei(t,null,r,n):pt(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:rn(r,i),Gm(e,t,r,i,n);case 7:return pt(e,t,t.pendingProps,n),t.child;case 8:return pt(e,t,t.pendingProps.children,n),t.child;case 12:return pt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,_e(Bc,r._currentValue),r._currentValue=o,a!==null)if(dn(a.value,o)){if(a.children===i.children&&!Ct.current){t=qn(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var f=a.dependencies;if(f!==null){o=a.child;for(var h=f.firstContext;h!==null;){if(h.context===r){if(a.tag===1){h=Gn(-1,n&-n),h.tag=2;var _=a.updateQueue;if(_!==null){_=_.shared;var p=_.pending;p===null?h.next=h:(h.next=p.next,p.next=h),_.pending=h}}a.lanes|=n,h=a.alternate,h!==null&&(h.lanes|=n),Fu(a.return,n,t),f.lanes|=n;break}h=h.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(K(341));o.lanes|=n,f=o.alternate,f!==null&&(f.lanes|=n),Fu(o,n,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}pt(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,mi(t,n),i=Qt(i),r=r(i),t.flags|=1,pt(e,t,r,n),t.child;case 14:return r=t.type,i=rn(r,t.pendingProps),i=rn(r.type,i),Qm(e,t,r,i,n);case 15:return Vy(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:rn(r,i),vc(e,t),t.tag=1,xt(r)?(e=!0,Fc(t)):e=!1,mi(t,n),Uy(t,r,i),zu(t,r,i,n),Wu(null,t,r,!0,e,n);case 19:return Ky(e,t,n);case 22:return Wy(e,t,n)}throw Error(K(156,t.tag))};function dw(e,t){return Av(e,t)}function p0(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ht(e,t,n,r){return new p0(e,t,n,r)}function qp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function f0(e){if(typeof e=="function")return qp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===gp)return 11;if(e===vp)return 14}return 2}function Cr(e,t){var n=e.alternate;return n===null?(n=Ht(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function _c(e,t,n,r,i,a){var o=2;if(r=e,typeof e=="function")qp(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Xs:return ds(n.children,i,a,t);case mp:o=8,i|=8;break;case uu:return e=Ht(12,n,t,i|2),e.elementType=uu,e.lanes=a,e;case pu:return e=Ht(13,n,t,i),e.elementType=pu,e.lanes=a,e;case fu:return e=Ht(19,n,t,i),e.elementType=fu,e.lanes=a,e;case _v:return dl(n,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case yv:o=10;break e;case wv:o=9;break e;case gp:o=11;break e;case vp:o=14;break e;case cr:o=16,r=null;break e}throw Error(K(130,e==null?e:typeof e,""))}return t=Ht(o,n,t,i),t.elementType=e,t.type=r,t.lanes=a,t}function ds(e,t,n,r){return e=Ht(7,e,r,t),e.lanes=n,e}function dl(e,t,n,r){return e=Ht(22,e,r,t),e.elementType=_v,e.lanes=n,e.stateNode={isHidden:!1},e}function Xd(e,t,n){return e=Ht(6,e,null,t),e.lanes=n,e}function Zd(e,t,n){return t=Ht(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function h0(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dd(0),this.expirationTimes=Dd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dd(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Xp(e,t,n,r,i,a,o,f,h){return e=new h0(e,t,n,f,h),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Ht(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mp(a),e}function m0(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qs,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function uw(e){if(!e)return Er;e=e._reactInternals;e:{if(ws(e)!==e||e.tag!==1)throw Error(K(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(K(171))}if(e.tag===1){var n=e.type;if(xt(n))return uy(e,n,t)}return t}function pw(e,t,n,r,i,a,o,f,h){return e=Xp(n,r,!0,e,i,a,o,f,h),e.context=uw(null),n=e.current,r=ht(),i=Sr(n),a=Gn(r,i),a.callback=t??null,wr(n,a,i),e.current.lanes=i,Ja(e,i,r),bt(e,r),e}function ul(e,t,n,r){var i=t.current,a=ht(),o=Sr(i);return n=uw(n),t.context===null?t.context=n:t.pendingContext=n,t=Gn(a,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=wr(i,t,o),e!==null&&(cn(e,i,o,a),hc(e,i,o)),o}function Xc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ig(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Zp(e,t){ig(e,t),(e=e.alternate)&&ig(e,t)}function g0(){return null}var fw=typeof reportError=="function"?reportError:function(e){console.error(e)};function ef(e){this._internalRoot=e}pl.prototype.render=ef.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(K(409));ul(e,t,null,null)};pl.prototype.unmount=ef.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ms(function(){ul(null,e,null,null)}),t[Yn]=null}};function pl(e){this._internalRoot=e}pl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Wv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<dr.length&&t!==0&&t<dr[n].priority;n++);dr.splice(n,0,e),n===0&&Gv(e)}};function tf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function fl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ag(){}function v0(e,t,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var _=Xc(o);a.call(_)}}var o=pw(t,r,e,0,null,!1,!1,"",ag);return e._reactRootContainer=o,e[Yn]=o.current,Fa(e.nodeType===8?e.parentNode:e),ms(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var f=r;r=function(){var _=Xc(h);f.call(_)}}var h=Xp(e,0,!1,null,null,!1,!1,"",ag);return e._reactRootContainer=h,e[Yn]=h.current,Fa(e.nodeType===8?e.parentNode:e),ms(function(){ul(t,h,n,r)}),h}function hl(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var f=i;i=function(){var h=Xc(o);f.call(h)}}ul(t,o,e,i)}else o=v0(n,t,e,i,r);return Xc(o)}Bv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=va(t.pendingLanes);n!==0&&(_p(t,n|1),bt(t,Oe()),!(me&6)&&(Ri=Oe()+500,Rr()))}break;case 13:ms(function(){var r=Jn(e,1);if(r!==null){var i=ht();cn(r,e,1,i)}}),Zp(e,1)}};Sp=function(e){if(e.tag===13){var t=Jn(e,134217728);if(t!==null){var n=ht();cn(t,e,134217728,n)}Zp(e,134217728)}};Vv=function(e){if(e.tag===13){var t=Sr(e),n=Jn(e,t);if(n!==null){var r=ht();cn(n,e,t,r)}Zp(e,t)}};Wv=function(){return ge};Hv=function(e,t){var n=ge;try{return ge=e,t()}finally{ge=n}};xu=function(e,t,n){switch(t){case"input":if(gu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=sl(r);if(!i)throw Error(K(90));Cv(r),gu(r,i)}}}break;case"textarea":bv(e,n);break;case"select":t=n.value,t!=null&&ui(e,!!n.multiple,t,!1)}};Pv=Kp;jv=ms;var y0={usingClientEntryPoint:!1,Events:[Xa,ni,sl,Iv,Nv,Kp]},aa={findFiberByHostInstance:Jr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},w0={bundleType:aa.bundleType,version:aa.version,rendererPackageName:aa.rendererPackageName,rendererConfig:aa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Xn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Mv(e),e===null?null:e.stateNode},findFiberByHostInstance:aa.findFiberByHostInstance||g0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sc.isDisabled&&sc.supportsFiber)try{el=sc.inject(w0),kn=sc}catch{}}Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y0;Mt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tf(t))throw Error(K(200));return m0(e,t,null,n)};Mt.createRoot=function(e,t){if(!tf(e))throw Error(K(299));var n=!1,r="",i=fw;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Xp(e,1,!1,null,null,n,!1,r,i),e[Yn]=t.current,Fa(e.nodeType===8?e.parentNode:e),new ef(t)};Mt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(K(188)):(e=Object.keys(e).join(","),Error(K(268,e)));return e=Mv(t),e=e===null?null:e.stateNode,e};Mt.flushSync=function(e){return ms(e)};Mt.hydrate=function(e,t,n){if(!fl(t))throw Error(K(200));return hl(null,e,t,!0,n)};Mt.hydrateRoot=function(e,t,n){if(!tf(e))throw Error(K(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=fw;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=pw(t,null,e,1,n??null,i,!1,a,o),e[Yn]=t.current,Fa(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new pl(t)};Mt.render=function(e,t,n){if(!fl(t))throw Error(K(200));return hl(null,e,t,!1,n)};Mt.unmountComponentAtNode=function(e){if(!fl(e))throw Error(K(40));return e._reactRootContainer?(ms(function(){hl(null,null,e,!1,function(){e._reactRootContainer=null,e[Yn]=null})}),!0):!1};Mt.unstable_batchedUpdates=Kp;Mt.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!fl(n))throw Error(K(200));if(e==null||e._reactInternals===void 0)throw Error(K(38));return hl(e,t,n,!1,r)};Mt.version="18.3.1-next-f1338f8080-20240426";function hw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hw)}catch(e){console.error(e)}}hw(),hv.exports=Mt;var _0=hv.exports,mw,og=_0;mw=og.createRoot,og.hydrateRoot;var eu={},np={exports:{}},tu,cg;function S0(){if(cg)return tu;cg=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,a=r*365.25;tu=function(p,S){S=S||{};var k=typeof p;if(k==="string"&&p.length>0)return o(p);if(k==="number"&&isFinite(p))return S.long?h(p):f(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function o(p){if(p=String(p),!(p.length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(S){var k=parseFloat(S[1]),M=(S[2]||"ms").toLowerCase();switch(M){case"years":case"year":case"yrs":case"yr":case"y":return k*a;case"weeks":case"week":case"w":return k*i;case"days":case"day":case"d":return k*r;case"hours":case"hour":case"hrs":case"hr":case"h":return k*n;case"minutes":case"minute":case"mins":case"min":case"m":return k*t;case"seconds":case"second":case"secs":case"sec":case"s":return k*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return k;default:return}}}}function f(p){var S=Math.abs(p);return S>=r?Math.round(p/r)+"d":S>=n?Math.round(p/n)+"h":S>=t?Math.round(p/t)+"m":S>=e?Math.round(p/e)+"s":p+"ms"}function h(p){var S=Math.abs(p);return S>=r?_(p,S,r,"day"):S>=n?_(p,S,n,"hour"):S>=t?_(p,S,t,"minute"):S>=e?_(p,S,e,"second"):p+" ms"}function _(p,S,k,M){var V=S>=k*1.5;return Math.round(p/k)+" "+M+(V?"s":"")}return tu}function C0(e){n.debug=n,n.default=n,n.coerce=h,n.disable=o,n.enable=i,n.enabled=f,n.humanize=S0(),n.destroy=_,Object.keys(e).forEach(p=>{n[p]=e[p]}),n.names=[],n.skips=[],n.formatters={};function t(p){let S=0;for(let k=0;k<p.length;k++)S=(S<<5)-S+p.charCodeAt(k),S|=0;return n.colors[Math.abs(S)%n.colors.length]}n.selectColor=t;function n(p){let S,k=null,M,V;function B(...v){if(!B.enabled)return;const l=B,u=Number(new Date),g=u-(S||u);l.diff=g,l.prev=S,l.curr=u,S=u,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let C=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(w,x)=>{if(w==="%%")return"%";C++;const T=n.formatters[x];if(typeof T=="function"){const D=v[C];w=T.call(l,D),v.splice(C,1),C--}return w}),n.formatArgs.call(l,v),(l.log||n.log).apply(l,v)}return B.namespace=p,B.useColors=n.useColors(),B.color=n.selectColor(p),B.extend=r,B.destroy=n.destroy,Object.defineProperty(B,"enabled",{enumerable:!0,configurable:!1,get:()=>k!==null?k:(M!==n.namespaces&&(M=n.namespaces,V=n.enabled(p)),V),set:v=>{k=v}}),typeof n.init=="function"&&n.init(B),B}function r(p,S){const k=n(this.namespace+(typeof S>"u"?":":S)+p);return k.log=this.log,k}function i(p){n.save(p),n.namespaces=p,n.names=[],n.skips=[];const S=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const k of S)k[0]==="-"?n.skips.push(k.slice(1)):n.names.push(k)}function a(p,S){let k=0,M=0,V=-1,B=0;for(;k<p.length;)if(M<S.length&&(S[M]===p[k]||S[M]==="*"))S[M]==="*"?(V=M,B=k,M++):(k++,M++);else if(V!==-1)M=V+1,B++,k=B;else return!1;for(;M<S.length&&S[M]==="*";)M++;return M===S.length}function o(){const p=[...n.names,...n.skips.map(S=>"-"+S)].join(",");return n.enable(""),p}function f(p){for(const S of n.skips)if(a(p,S))return!1;for(const S of n.names)if(a(p,S))return!0;return!1}function h(p){return p instanceof Error?p.stack||p.message:p}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var x0=C0;(function(e,t){var n={};t.formatArgs=i,t.save=a,t.load=o,t.useColors=r,t.storage=f(),t.destroy=(()=>{let _=!1;return()=>{_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let _;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(_=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(_[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;_.splice(1,0,p,"color: inherit");let S=0,k=0;_[0].replace(/%[a-zA-Z%]/g,M=>{M!=="%%"&&(S++,M==="%c"&&(k=S))}),_.splice(k,0,p)}t.log=console.debug||console.log||(()=>{});function a(_){try{_?t.storage.setItem("debug",_):t.storage.removeItem("debug")}catch{}}function o(){let _;try{_=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!_&&typeof process<"u"&&"env"in process&&(_=n.DEBUG),_}function f(){try{return localStorage}catch{}}e.exports=x0(t);const{formatters:h}=e.exports;h.j=function(_){try{return JSON.stringify(_)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(np,np.exports);var ml=np.exports,gw={};Object.defineProperty(gw,"__esModule",{value:!0});var Gr={},et={};Object.defineProperty(et,"__esModule",{value:!0});et.Logger=void 0;const Us=ml,zs="mediasoup-client";let b0=class{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=(0,Us.default)(`${zs}:${t}`),this._warn=(0,Us.default)(`${zs}:WARN:${t}`),this._error=(0,Us.default)(`${zs}:ERROR:${t}`)):(this._debug=(0,Us.default)(zs),this._warn=(0,Us.default)(`${zs}:WARN`),this._error=(0,Us.default)(`${zs}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};et.Logger=b0;var dt={},nf={exports:{}},vi=typeof Reflect=="object"?Reflect:null,lg=vi&&typeof vi.apply=="function"?vi.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Sc;vi&&typeof vi.ownKeys=="function"?Sc=vi.ownKeys:Object.getOwnPropertySymbols?Sc=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Sc=function(t){return Object.getOwnPropertyNames(t)};function E0(e){console&&console.warn&&console.warn(e)}var vw=Number.isNaN||function(t){return t!==t};function ve(){ve.init.call(this)}nf.exports=ve;nf.exports.once=I0;ve.EventEmitter=ve;ve.prototype._events=void 0;ve.prototype._eventsCount=0;ve.prototype._maxListeners=void 0;var dg=10;function gl(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ve,"defaultMaxListeners",{enumerable:!0,get:function(){return dg},set:function(e){if(typeof e!="number"||e<0||vw(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");dg=e}});ve.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ve.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||vw(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function yw(e){return e._maxListeners===void 0?ve.defaultMaxListeners:e._maxListeners}ve.prototype.getMaxListeners=function(){return yw(this)};ve.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var f=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw f.context=o,f}var h=a[t];if(h===void 0)return!1;if(typeof h=="function")lg(h,this,n);else for(var _=h.length,p=xw(h,_),r=0;r<_;++r)lg(p[r],this,n);return!0};function ww(e,t,n,r){var i,a,o;if(gl(n),a=e._events,a===void 0?(a=e._events=Object.create(null),e._eventsCount=0):(a.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),o===void 0)o=a[t]=n,++e._eventsCount;else if(typeof o=="function"?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=yw(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=o.length,E0(f)}return e}ve.prototype.addListener=function(t,n){return ww(this,t,n,!1)};ve.prototype.on=ve.prototype.addListener;ve.prototype.prependListener=function(t,n){return ww(this,t,n,!0)};function k0(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _w(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=k0.bind(r);return i.listener=n,r.wrapFn=i,i}ve.prototype.once=function(t,n){return gl(n),this.on(t,_w(this,t,n)),this};ve.prototype.prependOnceListener=function(t,n){return gl(n),this.prependListener(t,_w(this,t,n)),this};ve.prototype.removeListener=function(t,n){var r,i,a,o,f;if(gl(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(a=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){f=r[o].listener,a=o;break}if(a<0)return this;a===0?r.shift():T0(r,a),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,f||n)}return this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var a=Object.keys(r),o;for(i=0;i<a.length;++i)o=a[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function Sw(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?R0(i):xw(i,i.length)}ve.prototype.listeners=function(t){return Sw(this,t,!0)};ve.prototype.rawListeners=function(t){return Sw(this,t,!1)};ve.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Cw.call(e,t)};ve.prototype.listenerCount=Cw;function Cw(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ve.prototype.eventNames=function(){return this._eventsCount>0?Sc(this._events):[]};function xw(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function T0(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function R0(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function I0(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,a),r(o)}function a(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}bw(e,t,a,{once:!0}),t!=="error"&&N0(e,i,{once:!0})})}function N0(e,t,n){typeof e.on=="function"&&bw(e,"error",t,n)}function bw(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(a){r.once&&e.removeEventListener(t,i),n(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var P0=nf.exports;Object.defineProperty(dt,"__esModule",{value:!0});dt.EnhancedEventEmitter=void 0;const j0=P0,D0=et,L0=new D0.Logger("EnhancedEventEmitter");class M0 extends j0.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(t,...n){return super.emit(t,...n)}safeEmit(t,...n){try{return super.emit(t,...n)}catch(r){L0.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,r);try{super.emit("listenererror",t,r)}catch{}return!!super.listenerCount(t)}}on(t,n){return super.on(t,n),this}off(t,n){return super.off(t,n),this}addListener(t,n){return super.on(t,n),this}prependListener(t,n){return super.prependListener(t,n),this}once(t,n){return super.once(t,n),this}prependOnceListener(t,n){return super.prependOnceListener(t,n),this}removeListener(t,n){return super.off(t,n),this}removeAllListeners(t){return super.removeAllListeners(t),this}listenerCount(t){return super.listenerCount(t)}listeners(t){return super.listeners(t)}rawListeners(t){return super.rawListeners(t)}}dt.EnhancedEventEmitter=M0;var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.InvalidStateError=lt.UnsupportedError=void 0;class rf extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,rf):this.stack=new Error(t).stack}}lt.UnsupportedError=rf;class sf extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,sf):this.stack=new Error(t).stack}}lt.InvalidStateError=sf;var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0});Rn.clone=O0;Rn.generateRandomNumber=A0;Rn.deepFreeze=Ew;function O0(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function A0(){return Math.round(Math.random()*1e7)}function Ew(e){const t=Reflect.ownKeys(e);for(const n of t){const r=e[n];(r&&typeof r=="object"||typeof r=="function")&&Ew(r)}return Object.freeze(e)}var Le={},Xe={},vl={};Object.defineProperty(vl,"__esModule",{value:!0});vl.Logger=void 0;const Bs=ml,Vs="h264-profile-level-id";let $0=class{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=(0,Bs.default)(`${Vs}:${t}`),this._warn=(0,Bs.default)(`${Vs}:WARN:${t}`),this._error=(0,Bs.default)(`${Vs}:ERROR:${t}`)):(this._debug=(0,Bs.default)(Vs),this._warn=(0,Bs.default)(`${Vs}:WARN`),this._error=(0,Bs.default)(`${Vs}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};vl.Logger=$0;Object.defineProperty(Xe,"__esModule",{value:!0});Xe.ProfileLevelId=Xe.Level=Xe.Profile=void 0;Xe.parseProfileLevelId=kw;Xe.profileLevelIdToString=Tw;Xe.profileToString=B0;Xe.levelToString=V0;Xe.parseSdpProfileLevelId=gs;Xe.isSameProfile=W0;Xe.isSameProfileAndLevel=H0;Xe.generateProfileLevelIdStringForAnswer=G0;Xe.supportedLevel=Q0;const F0=vl,ln=new F0.Logger;var we;(function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"})(we||(Xe.Profile=we={}));var ne;(function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"})(ne||(Xe.Level=ne={}));class yl{constructor(t,n){I(this,"profile");I(this,"level");this.profile=t,this.level=n}}Xe.ProfileLevelId=yl;const U0=new yl(we.ConstrainedBaseline,ne.L3_1);class An{constructor(t){I(this,"mask");I(this,"masked_value");this.mask=~pg("x",t),this.masked_value=pg("1",t)}isMatch(t){return this.masked_value===(t&this.mask)}}class $n{constructor(t,n,r){I(this,"profile_idc");I(this,"profile_iop");I(this,"profile");this.profile_idc=t,this.profile_iop=n,this.profile=r}}const z0=[new $n(66,new An("x1xx0000"),we.ConstrainedBaseline),new $n(77,new An("1xxx0000"),we.ConstrainedBaseline),new $n(88,new An("11xx0000"),we.ConstrainedBaseline),new $n(66,new An("x0xx0000"),we.Baseline),new $n(88,new An("10xx0000"),we.Baseline),new $n(77,new An("0x0x0000"),we.Main),new $n(100,new An("00000000"),we.High),new $n(100,new An("00001100"),we.ConstrainedHigh),new $n(244,new An("00000000"),we.PredictiveHigh444)],ug=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:ne.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:ne.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:ne.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:ne.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:ne.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:ne.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:ne.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:ne.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:ne.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:ne.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:ne.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:ne.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:ne.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:ne.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:ne.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:ne.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:ne.L5_2}];function kw(e){if(typeof e!="string"||e.length!==6)return;const n=parseInt(e,16);if(n===0)return;const r=n&255,i=n>>8&255,a=n>>16&255;let o;switch(r){case ne.L1_1:{o=i&16?ne.L1_b:ne.L1_1;break}case ne.L1:case ne.L1_2:case ne.L1_3:case ne.L2:case ne.L2_1:case ne.L2_2:case ne.L3:case ne.L3_1:case ne.L3_2:case ne.L4:case ne.L4_1:case ne.L4_2:case ne.L5:case ne.L5_1:case ne.L5_2:{o=r;break}default:{ln.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`);return}}for(const f of z0)if(a===f.profile_idc&&f.profile_iop.isMatch(i))return ln.debug(`parseProfileLevelId() | result [str:${e}, profile:${f.profile}, level:${o}]`),new yl(f.profile,o);ln.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${a}, profile_iop:${i}]`)}function Tw(e){if(e.level==ne.L1_b)switch(e.profile){case we.ConstrainedBaseline:return"42f00b";case we.Baseline:return"42100b";case we.Main:return"4d100b";default:{ln.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`);return}}let t;switch(e.profile){case we.ConstrainedBaseline:{t="42e0";break}case we.Baseline:{t="4200";break}case we.Main:{t="4d00";break}case we.ConstrainedHigh:{t="640c";break}case we.High:{t="6400";break}case we.PredictiveHigh444:{t="f400";break}default:{ln.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`);return}}let n=e.level.toString(16);return n.length===1&&(n=`0${n}`),`${t}${n}`}function B0(e){switch(e){case we.ConstrainedBaseline:return"ConstrainedBaseline";case we.Baseline:return"Baseline";case we.Main:return"Main";case we.ConstrainedHigh:return"ConstrainedHigh";case we.High:return"High";case we.PredictiveHigh444:return"PredictiveHigh444";default:{ln.warn(`profileToString() | unrecognized profile ${e}`);return}}}function V0(e){switch(e){case ne.L1_b:return"1b";case ne.L1:return"1";case ne.L1_1:return"1.1";case ne.L1_2:return"1.2";case ne.L1_3:return"1.3";case ne.L2:return"2";case ne.L2_1:return"2.1";case ne.L2_2:return"2.2";case ne.L3:return"3";case ne.L3_1:return"3.1";case ne.L3_2:return"3.2";case ne.L4:return"4";case ne.L4_1:return"4.1";case ne.L4_2:return"4.2";case ne.L5:return"5";case ne.L5_1:return"5.1";case ne.L5_2:return"5.2";default:{ln.warn(`levelToString() | unrecognized level ${e}`);return}}}function gs(e={}){const t=e["profile-level-id"];return t?kw(t):U0}function W0(e={},t={}){const n=gs(e),r=gs(t);return!!(n&&r&&n.profile===r.profile)}function H0(e={},t={}){const n=gs(e),r=gs(t);return!!(n&&r&&n.profile===r.profile&&n.level==r.level)}function G0(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){ln.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const n=gs(e),r=gs(t);if(!n)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const i=fg(e)&&fg(t),a=n.level,o=r.level,f=Y0(a,o),h=i?a:f;return ln.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${n.profile}, level:${h}]`),Tw(new yl(n.profile,h))}function Q0(e,t){for(let r=ug.length-1;r>=0;--r){const i=ug[r];if(i.max_macroblock_frame_size*256<=e&&i.max_macroblocks_per_second<=t*i.max_macroblock_frame_size)return ln.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${t}, level:${i.level}]`),i.level}ln.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${t}]`)}function pg(e,t){return+(t[0]===e)<<7|+(t[1]===e)<<6|+(t[2]===e)<<5|+(t[3]===e)<<4|+(t[4]===e)<<3|+(t[5]===e)<<2|+(t[6]===e)<<1|+(t[7]===e)<<0}function K0(e,t){return e===ne.L1_b?t!==ne.L1&&t!==ne.L1_b:t===ne.L1_b?e!==ne.L1:e<t}function Y0(e,t){return K0(e,t)?e:t}function fg(e={}){const t=e["level-asymmetry-allowed"];return t===!0||t===1||t==="1"}Object.defineProperty(Le,"__esModule",{value:!0});Le.validateAndNormalizeRtpCapabilities=eb;Le.validateAndNormalizeRtpParameters=af;Le.validateAndNormalizeSctpStreamParameters=tb;Le.validateSctpCapabilities=nb;Le.getExtendedRtpCapabilities=rb;Le.getRecvRtpCapabilities=sb;Le.getSendingRtpParameters=ib;Le.getSendingRemoteRtpParameters=ab;Le.reduceCodecs=ob;Le.generateProbatorRtpParameters=cb;Le.canSend=lb;Le.canReceive=db;const hg=Xe,J0=Rn,q0="probator",X0=1234,Z0=127;function eb(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)ub(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)pb(t)}function af(e){if(typeof e!="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)fb(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)hb(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)mb(t);if(e.rtcp&&typeof e.rtcp!="object")throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),gb(e.rtcp)}function tb(e){if(typeof e!="object")throw new TypeError("params is not an object");if(typeof e.streamId!="number")throw new TypeError("missing params.streamId");let t=!1;if(typeof e.ordered=="boolean"?t=!0:e.ordered=!0,e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&typeof e.label!="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!="string")throw new TypeError("invalid params.protocol")}function nb(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!="object")throw new TypeError("missing caps.numStreams");vb(e.numStreams)}function rb(e,t,n){const r={codecs:[],headerExtensions:[]};if(n)for(const i of e.codecs??[]){if(li(i))continue;const a=(t.codecs??[]).find(f=>rp(f,i,{strict:!0,modify:!0}));if(!a)continue;const o={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:a.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters??{},remoteParameters:a.parameters??{},rtcpFeedback:mg(i,a)};r.codecs.push(o)}else for(const i of t.codecs??[]){if(li(i))continue;const a=(e.codecs??[]).find(f=>rp(f,i,{strict:!0,modify:!0}));if(!a)continue;const o={kind:a.kind,mimeType:a.mimeType,clockRate:a.clockRate,channels:a.channels,localPayloadType:a.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:a.parameters??{},remoteParameters:i.parameters??{},rtcpFeedback:mg(a,i)};r.codecs.push(o)}for(const i of r.codecs){const a=e.codecs.find(f=>{var h;return li(f)&&((h=f.parameters)==null?void 0:h.apt)===i.localPayloadType}),o=t.codecs.find(f=>{var h;return li(f)&&((h=f.parameters)==null?void 0:h.apt)===i.remotePayloadType});a&&o&&(i.localRtxPayloadType=a.preferredPayloadType,i.remoteRtxPayloadType=o.preferredPayloadType)}for(const i of t.headerExtensions){const a=e.headerExtensions.find(f=>yb(f,i));if(!a)continue;const o={kind:i.kind,uri:i.uri,sendId:a.preferredId,recvId:i.preferredId,encrypt:a.preferredEncrypt??!1,direction:"sendrecv"};switch(i.direction){case"sendrecv":{o.direction="sendrecv";break}case"recvonly":{o.direction="sendonly";break}case"sendonly":{o.direction="recvonly";break}case"inactive":{o.direction="inactive";break}}r.headerExtensions.push(o)}return r}function sb(e){const t={codecs:[],headerExtensions:[]};for(const n of e.codecs){const r={kind:n.kind,mimeType:n.mimeType,preferredPayloadType:n.remotePayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),!n.remoteRtxPayloadType)continue;const i={kind:n.kind,mimeType:`${n.kind}/rtx`,preferredPayloadType:n.remoteRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const n of e.headerExtensions){if(n.direction!=="sendrecv"&&n.direction!=="recvonly")continue;const r={kind:n.kind,uri:n.uri,preferredId:n.recvId,preferredEncrypt:n.encrypt??!1,direction:n.direction};t.headerExtensions.push(r)}return t}function ib(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(a)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}return n}function ab(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(a)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}if(n.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(n.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return n}function ob(e,t){const n=[];if(!t)n.push(e[0]),li(e[1])&&n.push(e[1]);else{for(let r=0;r<e.length;++r)if(rp(e[r],t,{strict:!0})){n.push(e[r]),li(e[r+1])&&n.push(e[r+1]);break}if(n.length===0)throw new TypeError("no matching codec found")}return n}function cb(e){e=J0.clone(e),af(e);const t={mid:q0,codecs:[],headerExtensions:[],encodings:[{ssrc:X0}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=Z0,t.headerExtensions=e.headerExtensions,t}function lb(e,t){return(t.codecs??[]).some(n=>n.kind===e)}function db(e,t){if(af(e),e.codecs.length===0)return!1;const n=e.codecs[0];return(t.codecs??[]).some(r=>r.preferredPayloadType===n.payloadType)}function ub(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(e.kind=n[1].toLowerCase(),typeof e.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");e.kind==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const r of Object.keys(e.parameters)){let i=e.parameters[r];if(i===void 0&&(e.parameters[r]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${i}]`);if(r==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const r of e.rtcpFeedback)Rw(r)}function Rw(e){if(typeof e!="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!="string")throw new TypeError("missing fb.type");(!e.parameter||typeof e.parameter!="string")&&(e.parameter="")}function pb(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&typeof e.direction!="string")throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function fb(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(typeof e.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");n[1].toLowerCase()==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const i of Object.keys(e.parameters)){let a=e.parameters[i];if(a===void 0&&(e.parameters[i]="",a=""),typeof a!="string"&&typeof a!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${a}]`);if(i==="apt"&&typeof a!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const i of e.rtcpFeedback)Rw(i)}function hb(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.id!="number")throw new TypeError("missing ext.id");if(e.encrypt&&typeof e.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const t of Object.keys(e.parameters)){let n=e.parameters[t];if(n===void 0&&(e.parameters[t]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError("invalid header extension parameter")}}function mb(e){if(typeof e!="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!="object")throw new TypeError("invalid encoding.rtx");if(e.rtx&&typeof e.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||typeof e.dtx!="boolean")&&(e.dtx=!1),e.scalabilityMode&&typeof e.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function gb(e){if(typeof e!="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!="string")throw new TypeError("invalid rtcp.cname");(!e.reducedSize||typeof e.reducedSize!="boolean")&&(e.reducedSize=!0)}function vb(e){if(typeof e!="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!="number")throw new TypeError("missing numStreams.MIS")}function li(e){return e?/.+\/rtx$/i.test(e.mimeType):!1}function rp(e,t,{strict:n=!1,modify:r=!1}={}){const i=e.mimeType.toLowerCase(),a=t.mimeType.toLowerCase();if(i!==a||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(i){case"video/h264":{if(n){const o=e.parameters["packetization-mode"]??0,f=t.parameters["packetization-mode"]??0;if(o!==f||!hg.isSameProfile(e.parameters,t.parameters))return!1;let h;try{h=hg.generateProfileLevelIdStringForAnswer(e.parameters,t.parameters)}catch{return!1}r&&(h?(e.parameters["profile-level-id"]=h,t.parameters["profile-level-id"]=h):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break}case"video/vp9":{if(n){const o=e.parameters["profile-id"]??0,f=t.parameters["profile-id"]??0;if(o!==f)return!1}break}}return!0}function yb(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function mg(e,t){const n=[];for(const r of e.rtcpFeedback??[]){const i=(t.rtcpFeedback??[]).find(a=>a.type===r.type&&(a.parameter===r.parameter||!a.parameter&&!r.parameter));i&&n.push(i)}return n}var wl={},Iw={},_l={},Sl={};Object.defineProperty(Sl,"__esModule",{value:!0});Sl.Logger=void 0;const Ws=ml,Hs="awaitqueue";class wb{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=Ws(`${Hs}:${t}`),this._warn=Ws(`${Hs}:WARN:${t}`),this._error=Ws(`${Hs}:ERROR:${t}`)):(this._debug=Ws(Hs),this._warn=Ws(`${Hs}:WARN`),this._error=Ws(`${Hs}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Sl.Logger=wb;var vs={};Object.defineProperty(vs,"__esModule",{value:!0});vs.AwaitQueueRemovedTaskError=vs.AwaitQueueStoppedError=void 0;class of extends Error{constructor(t){super(t??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,of)}}vs.AwaitQueueStoppedError=of;class cf extends Error{constructor(t){super(t??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,cf)}}vs.AwaitQueueRemovedTaskError=cf;Object.defineProperty(_l,"__esModule",{value:!0});_l.AwaitQueue=void 0;const _b=Sl,nu=vs,Fn=new _b.Logger("AwaitQueue");class Sb{constructor(){I(this,"pendingTasks",new Map);I(this,"nextTaskId",0);Fn.debug("constructor()")}get size(){return this.pendingTasks.size}async push(t,n,r){if(n=n??t.name,Fn.debug(`push() [name:${n}, options:%o]`,r),typeof t!="function")throw new TypeError("given task is not a function");if(n)try{Object.defineProperty(t,"name",{value:n})}catch{}return new Promise((i,a)=>{if(n&&(r!=null&&r.removeOngoingTasksWithSameName))for(const f of this.pendingTasks.values())f.name===n&&f.reject(new nu.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});const o={id:this.nextTaskId++,task:t,name:n,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:f=>{if(o.completed)return;o.completed=!0,this.pendingTasks.delete(o.id),Fn.debug(`resolving task [name:${o.name}]`),i(f);const[h]=this.pendingTasks.values();h&&!h.executedAt&&this.execute(h)},reject:(f,{canExecuteNextTask:h})=>{if(!o.completed&&(o.completed=!0,this.pendingTasks.delete(o.id),Fn.debug(`rejecting task [name:${o.name}]: %s`,String(f)),a(f),h)){const[_]=this.pendingTasks.values();_&&!_.executedAt&&this.execute(_)}}};this.pendingTasks.set(o.id,o),this.pendingTasks.size===1&&this.execute(o)})}stop(){Fn.debug("stop()");for(const t of this.pendingTasks.values())Fn.debug(`stop() | stopping task [name:${t.name}]`),t.reject(new nu.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(t){Fn.debug(`remove() [taskIdx:${t}]`);const n=Array.from(this.pendingTasks.values())[t];if(!n){Fn.debug(`stop() | no task with given idx [taskIdx:${t}]`);return}n.reject(new nu.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){const t=Date.now();let n=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:n++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:t-r.enqueuedAt,executionTime:r.executedAt?t-r.executedAt:0}))}async execute(t){if(Fn.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{const n=await t.task();t.resolve(n)}catch(n){t.reject(n,{canExecuteNextTask:!0})}}}_l.AwaitQueue=Sb;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var t=_l;Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return t.AwaitQueue}});var n=vs;Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return n.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return n.AwaitQueueRemovedTaskError}})})(Iw);var Cl={};Object.defineProperty(Cl,"__esModule",{value:!0});Cl.Producer=void 0;const Cb=et,gg=dt,Gs=lt,wn=new Cb.Logger("Producer");class xb extends gg.EnhancedEventEmitter{constructor({id:n,localId:r,rtpSender:i,track:a,rtpParameters:o,stopTracks:f,disableTrackOnPause:h,zeroRtpOnPause:_,appData:p}){super();I(this,"_id");I(this,"_localId");I(this,"_closed",!1);I(this,"_rtpSender");I(this,"_track");I(this,"_kind");I(this,"_rtpParameters");I(this,"_paused");I(this,"_maxSpatialLayer");I(this,"_stopTracks");I(this,"_disableTrackOnPause");I(this,"_zeroRtpOnPause");I(this,"_appData");I(this,"_observer",new gg.EnhancedEventEmitter);wn.debug("constructor()"),this._id=n,this._localId=r,this._rtpSender=i,this._track=a,this._kind=a.kind,this._rtpParameters=o,this._paused=h?!a.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=f,this._disableTrackOnPause=h,this._zeroRtpOnPause=_,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(wn.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(wn.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Gs.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(wn.debug("pause()"),this._closed){wn.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@pause",n,r)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(wn.debug("resume()"),this._closed){wn.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@resume",n,r)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:n}){if(wn.debug("replaceTrack() [track:%o]",n),this._closed){if(n&&this._stopTracks)try{n.stop()}catch{}throw new Gs.InvalidStateError("closed")}else if((n==null?void 0:n.readyState)==="ended")throw new Gs.InvalidStateError("track ended");if(n===this._track){wn.debug("replaceTrack() | same track, ignored");return}await new Promise((r,i)=>{this.safeEmit("@replacetrack",n,r,i)}),this.destroyTrack(),this._track=n,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(n){if(this._closed)throw new Gs.InvalidStateError("closed");if(this._kind!=="video")throw new Gs.UnsupportedError("not a video Producer");if(typeof n!="number")throw new TypeError("invalid spatialLayer");n!==this._maxSpatialLayer&&(await new Promise((r,i)=>{this.safeEmit("@setmaxspatiallayer",n,r,i)}).catch(()=>{}),this._maxSpatialLayer=n)}async setRtpEncodingParameters(n){if(this._closed)throw new Gs.InvalidStateError("closed");if(typeof n!="object")throw new TypeError("invalid params");await new Promise((r,i)=>{this.safeEmit("@setrtpencodingparameters",n,r,i)})}onTrackEnded(){wn.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}Cl.Producer=xb;var xl={};Object.defineProperty(xl,"__esModule",{value:!0});xl.Consumer=void 0;const bb=et,vg=dt,Eb=lt,_n=new bb.Logger("Consumer");class kb extends vg.EnhancedEventEmitter{constructor({id:n,localId:r,producerId:i,rtpReceiver:a,track:o,rtpParameters:f,appData:h}){super();I(this,"_id");I(this,"_localId");I(this,"_producerId");I(this,"_closed",!1);I(this,"_rtpReceiver");I(this,"_track");I(this,"_rtpParameters");I(this,"_paused");I(this,"_appData");I(this,"_observer",new vg.EnhancedEventEmitter);_n.debug("constructor()"),this._id=n,this._localId=r,this._producerId=i,this._rtpReceiver=a,this._track=o,this._rtpParameters=f,this._paused=!o.enabled,this._appData=h??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(_n.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(_n.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Eb.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(_n.debug("pause()"),this._closed){_n.error("pause() | Consumer closed");return}if(this._paused){_n.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(_n.debug("resume()"),this._closed){_n.error("resume() | Consumer closed");return}if(!this._paused){_n.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){_n.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}xl.Consumer=kb;var bl={};Object.defineProperty(bl,"__esModule",{value:!0});bl.DataProducer=void 0;const Tb=et,yg=dt,Rb=lt,Un=new Tb.Logger("DataProducer");class Ib extends yg.EnhancedEventEmitter{constructor({id:n,dataChannel:r,sctpStreamParameters:i,appData:a}){super();I(this,"_id");I(this,"_dataChannel");I(this,"_closed",!1);I(this,"_sctpStreamParameters");I(this,"_appData");I(this,"_observer",new yg.EnhancedEventEmitter);Un.debug("constructor()"),this._id=n,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=a??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._dataChannel.bufferedAmountLowThreshold=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Un.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Un.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(n){if(Un.debug("send()"),this._closed)throw new Rb.InvalidStateError("closed");this._dataChannel.send(n)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Un.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,a;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?Un.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(a=n.error)==null?void 0:a.sctpCauseCode,n.error.message):Un.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Un.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||Un.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}bl.DataProducer=Ib;var El={};Object.defineProperty(El,"__esModule",{value:!0});El.DataConsumer=void 0;const Nb=et,wg=dt,Qr=new Nb.Logger("DataConsumer");class Pb extends wg.EnhancedEventEmitter{constructor({id:n,dataProducerId:r,dataChannel:i,sctpStreamParameters:a,appData:o}){super();I(this,"_id");I(this,"_dataProducerId");I(this,"_dataChannel");I(this,"_closed",!1);I(this,"_sctpStreamParameters");I(this,"_appData");I(this,"_observer",new wg.EnhancedEventEmitter);Qr.debug("constructor()"),this._id=n,this._dataProducerId=r,this._dataChannel=i,this._sctpStreamParameters=a,this._appData=o??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(n){this._dataChannel.binaryType=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Qr.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Qr.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Qr.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,a;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?Qr.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(a=n.error)==null?void 0:a.sctpCauseCode,n.error.message):Qr.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Qr.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",n=>{this._closed||this.safeEmit("message",n.data)})}}El.DataConsumer=Pb;Object.defineProperty(wl,"__esModule",{value:!0});wl.Transport=void 0;const jb=Iw,Db=et,_g=dt,ze=lt,ru=Rn,oa=Le,Lb=Cl,Mb=xl,Ob=bl,Ab=El,Me=new Db.Logger("Transport");class $b{constructor(t){I(this,"consumerOptions");I(this,"promise");I(this,"resolve");I(this,"reject");this.consumerOptions=t,this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}class Fb extends _g.EnhancedEventEmitter{constructor({direction:n,id:r,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:f,iceServers:h,iceTransportPolicy:_,additionalSettings:p,appData:S,handlerFactory:k,getSendExtendedRtpCapabilities:M,recvRtpCapabilities:V,canProduceByKind:B}){super();I(this,"_id");I(this,"_closed",!1);I(this,"_direction");I(this,"_getSendExtendedRtpCapabilities");I(this,"_recvRtpCapabilities");I(this,"_canProduceByKind");I(this,"_maxSctpMessageSize");I(this,"_handler");I(this,"_iceGatheringState","new");I(this,"_connectionState","new");I(this,"_appData");I(this,"_producers",new Map);I(this,"_consumers",new Map);I(this,"_dataProducers",new Map);I(this,"_dataConsumers",new Map);I(this,"_probatorConsumerCreated",!1);I(this,"_awaitQueue",new jb.AwaitQueue);I(this,"_pendingConsumerTasks",[]);I(this,"_consumerCreationInProgress",!1);I(this,"_pendingPauseConsumers",new Map);I(this,"_consumerPauseInProgress",!1);I(this,"_pendingResumeConsumers",new Map);I(this,"_consumerResumeInProgress",!1);I(this,"_pendingCloseConsumers",new Map);I(this,"_consumerCloseInProgress",!1);I(this,"_observer",new _g.EnhancedEventEmitter);Me.debug("constructor() [id:%s, direction:%s]",r,n),this._id=r,this._direction=n,this._getSendExtendedRtpCapabilities=M,this._recvRtpCapabilities=V,this._canProduceByKind=B,this._maxSctpMessageSize=f?f.maxMessageSize:null;const v=ru.clone(p)??{};delete v.iceServers,delete v.iceTransportPolicy,delete v.bundlePolicy,delete v.rtcpMuxPolicy,this._handler=k.factory({direction:n,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:f,iceServers:h,iceTransportPolicy:_,additionalSettings:v,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=S??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){if(!this._closed){Me.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const n of this._producers.values())n.transportClosed();this._producers.clear();for(const n of this._consumers.values())n.transportClosed();this._consumers.clear();for(const n of this._dataProducers.values())n.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new ze.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:n}){if(Me.debug("restartIce()"),this._closed)throw new ze.InvalidStateError("closed");if(!n)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(n),"transport.restartIce()")}async updateIceServers({iceServers:n}={}){if(Me.debug("updateIceServers()"),this._closed)throw new ze.InvalidStateError("closed");if(!Array.isArray(n))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(n),"transport.updateIceServers()")}async produce({track:n,streamId:r,encodings:i,codecOptions:a,headerExtensionOptions:o,codec:f,stopTracks:h=!0,disableTrackOnPause:_=!0,zeroRtpOnPause:p=!1,onRtpSender:S,appData:k={}}={}){if(Me.debug("produce() [track:%o]",n),this._closed)throw new ze.InvalidStateError("closed");if(n){if(this._direction!=="send")throw new ze.UnsupportedError("not a sending Transport");if(this._canProduceByKind[n.kind]){if(n.readyState==="ended")throw new ze.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(k&&typeof k!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError(`cannot produce ${n.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let M;if(i&&!Array.isArray(i))throw TypeError("encodings must be an array");(i==null?void 0:i.length)===0?M=void 0:i&&(M=i.map(l=>{const u={active:!0};return l.active===!1&&(u.active=!1),typeof l.dtx=="boolean"&&(u.dtx=l.dtx),typeof l.scalabilityMode=="string"&&(u.scalabilityMode=l.scalabilityMode),typeof l.scaleResolutionDownBy=="number"&&(u.scaleResolutionDownBy=l.scaleResolutionDownBy),typeof l.maxBitrate=="number"&&(u.maxBitrate=l.maxBitrate),typeof l.maxFramerate=="number"&&(u.maxFramerate=l.maxFramerate),typeof l.adaptivePtime=="boolean"&&(u.adaptivePtime=l.adaptivePtime),typeof l.priority=="string"&&(u.priority=l.priority),typeof l.networkPriority=="string"&&(u.networkPriority=l.networkPriority),u}));const{localId:V,rtpParameters:B,rtpSender:v}=await this._handler.send({track:n,streamId:r,encodings:M,codecOptions:a,headerExtensionOptions:o,codec:f,onRtpSender:S});try{oa.validateAndNormalizeRtpParameters(B);const{id:l}=await new Promise((g,C)=>{this.safeEmit("produce",{kind:n.kind,rtpParameters:B,appData:k},g,C)}),u=new Lb.Producer({id:l,localId:V,rtpSender:v,track:n,rtpParameters:B,stopTracks:h,disableTrackOnPause:_,zeroRtpOnPause:p,appData:k});return this._producers.set(u.id,u),this.handleProducer(u),this._observer.safeEmit("newproducer",u),u}catch(l){throw this._handler.stopSending(V).catch(()=>{}),l}},"transport.produce()").catch(M=>{if(h)try{n.stop()}catch{}throw M})}async consume({id:n,producerId:r,kind:i,rtpParameters:a,streamId:o,onRtpReceiver:f,appData:h={}}){if(Me.debug("consume()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="recv")throw new ze.UnsupportedError("not a receiving Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind '${i}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object");const _=ru.clone(a);if(!oa.canReceive(_,this._recvRtpCapabilities))throw new ze.UnsupportedError("cannot consume this Producer");const S=new $b({id:n,producerId:r,kind:i,rtpParameters:_,streamId:o,onRtpReceiver:f,appData:h});return this._pendingConsumerTasks.push(S),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),S.promise}async produceData({ordered:n=!0,maxPacketLifeTime:r,maxRetransmits:i,label:a="",protocol:o="",appData:f={}}={}){if(Me.debug("produceData()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="send")throw new ze.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(f&&typeof f!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError("SCTP not enabled by remote Transport");return(r||i)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:h,sctpStreamParameters:_}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o});oa.validateAndNormalizeSctpStreamParameters(_);const{id:p}=await new Promise((k,M)=>{this.safeEmit("producedata",{sctpStreamParameters:_,label:a,protocol:o,appData:f},k,M)}),S=new Ob.DataProducer({id:p,dataChannel:h,sctpStreamParameters:_,appData:f});return this._dataProducers.set(S.id,S),this.handleDataProducer(S),this._observer.safeEmit("newdataproducer",S),S},"transport.produceData()")}async consumeData({id:n,dataProducerId:r,sctpStreamParameters:i,label:a="",protocol:o="",appData:f={}}){if(Me.debug("consumeData()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="recv")throw new ze.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(f&&typeof f!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError("SCTP not enabled by remote Transport");const h=ru.clone(i);return oa.validateAndNormalizeSctpStreamParameters(h),this._awaitQueue.push(async()=>{const{dataChannel:_}=await this._handler.receiveDataChannel({sctpStreamParameters:h,label:a,protocol:o}),p=new Ab.DataConsumer({id:n,dataProducerId:r,dataChannel:_,sctpStreamParameters:h,appData:f});return this._dataConsumers.set(p.id,p),this.handleDataConsumer(p),this._observer.safeEmit("newdataconsumer",p),p},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){Me.debug("createPendingConsumers() | there is no Consumer to be created");return}const n=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r;const i=[];for(const a of n){const{id:o,kind:f,rtpParameters:h,streamId:_,onRtpReceiver:p}=a.consumerOptions;i.push({trackId:o,kind:f,rtpParameters:h,streamId:_,onRtpReceiver:p})}try{const a=await this._handler.receive(i);for(let o=0;o<a.length;++o){const f=n[o],h=a[o],{id:_,producerId:p,kind:S,rtpParameters:k,appData:M}=f.consumerOptions,{localId:V,rtpReceiver:B,track:v}=h,l=new Mb.Consumer({id:_,localId:V,producerId:p,rtpReceiver:B,track:v,rtpParameters:k,appData:M});this._consumers.set(l.id,l),this.handleConsumer(l),!this._probatorConsumerCreated&&!r&&S==="video"&&(r=l),this._observer.safeEmit("newconsumer",l),f.resolve(l)}}catch(a){for(const o of n)o.reject(a)}if(r)try{const a=oa.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:a}]),Me.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(a){Me.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",a)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){Me.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const n=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.pauseReceiving(r)}catch(r){Me.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){Me.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const n=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.resumeReceiving(r)}catch(r){Me.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){Me.debug("closePendingConsumers() | there is no Consumer to be closed");return}const n=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(n.map(r=>r.localId))}catch(r){Me.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const n=this._handler;n.on("@connect",({dtlsParameters:r},i,a)=>{if(this._closed){a(new ze.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:r},i,a)}),n.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(Me.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),n.on("@icecandidateerror",r=>{Me.warn(`ICE candidate error [url:${r.url}, localAddress:${r.address}, localPort:${r.port}]: ${r.errorCode} "${r.errorText}"`),this.safeEmit("icecandidateerror",r)}),n.on("@connectionstatechange",r=>{r!==this._connectionState&&(Me.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(n.localId),"producer @close event").catch(r=>Me.warn("producer.close() failed:%o",r))}),n.on("@pause",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(n.localId),"producer @pause event").then(r).catch(i)}),n.on("@resume",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(n.localId),"producer @resume event").then(r).catch(i)}),n.on("@replacetrack",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(n.localId,r),"producer @replacetrack event").then(i).catch(a)}),n.on("@setmaxspatiallayer",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(n.localId,r),"producer @setmaxspatiallayer event").then(i).catch(a)}),n.on("@setrtpencodingparameters",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(n.localId,r),"producer @setrtpencodingparameters event").then(i).catch(a)}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new ze.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(r).catch(i)})}handleConsumer(n){n.on("@close",()=>{this._consumers.delete(n.id),this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.delete(n.id),!this._closed&&(this._pendingCloseConsumers.set(n.id,n),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),n.on("@pause",()=>{this._pendingResumeConsumers.has(n.id)&&this._pendingResumeConsumers.delete(n.id),this._pendingPauseConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),n.on("@resume",()=>{this._pendingPauseConsumers.has(n.id)&&this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new ze.InvalidStateError("closed"));this._handler.getReceiverStats(n.localId).then(r).catch(i)})}handleDataProducer(n){n.on("@close",()=>{this._dataProducers.delete(n.id)})}handleDataConsumer(n){n.on("@close",()=>{this._dataConsumers.delete(n.id)})}}wl.Transport=Fb;var ca={},tt={},Nw={},Pw={exports:{}},Sg=Pw.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Sg).forEach(function(e){var t=Sg[e];t.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var lf=Pw.exports;(function(e){var t=function(f){return String(Number(f))===f?Number(f):f},n=function(f,h,_,p){if(p&&!_)h[p]=t(f[1]);else for(var S=0;S<_.length;S+=1)f[S+1]!=null&&(h[_[S]]=t(f[S+1]))},r=function(f,h,_){var p=f.name&&f.names;f.push&&!h[f.push]?h[f.push]=[]:p&&!h[f.name]&&(h[f.name]={});var S=f.push?{}:p?h[f.name]:h;n(_.match(f.reg),S,f.names,f.name),f.push&&h[f.push].push(S)},i=lf,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(f){var h={},_=[],p=h;return f.split(/(\r\n|\r|\n)/).filter(a).forEach(function(S){var k=S[0],M=S.slice(2);k==="m"&&(_.push({rtp:[],fmtp:[]}),p=_[_.length-1]);for(var V=0;V<(i[k]||[]).length;V+=1){var B=i[k][V];if(B.reg.test(M))return r(B,p,M)}}),h.media=_,h};var o=function(f,h){var _=h.split(/=(.+)/,2);return _.length===2?f[_[0]]=t(_[1]):_.length===1&&h.length>1&&(f[_[0]]=void 0),f};e.parseParams=function(f){return f.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(f){return f.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(f){for(var h=[],_=f.split(" ").map(t),p=0;p<_.length;p+=3)h.push({component:_[p],ip:_[p+1],port:_[p+2]});return h},e.parseImageAttributes=function(f){return f.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(f){return f.split(";").map(function(h){return h.split(",").map(function(_){var p,S=!1;return _[0]!=="~"?p=t(_):(p=t(_.substring(1,_.length)),S=!0),{scid:p,paused:S}})})}})(Nw);var su=lf,Ub=/%[sdv%]/g,zb=function(e){var t=1,n=arguments,r=n.length;return e.replace(Ub,function(i){if(t>=r)return i;var a=n[t];switch(t+=1,i){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})},la=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var a=0;a<t.names.length;a+=1){var o=t.names[a];t.name?i.push(n[t.name][o]):i.push(n[t.names[a]])}else i.push(n[t.name]);return zb.apply(null,i)},Bb=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Vb=["i","c","b","a"],Wb=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var n=t.outerOrder||Bb,r=t.innerOrder||Vb,i=[];return n.forEach(function(a){su[a].forEach(function(o){o.name in e&&e[o.name]!=null?i.push(la(a,o,e)):o.push in e&&e[o.push]!=null&&e[o.push].forEach(function(f){i.push(la(a,o,f))})})}),e.media.forEach(function(a){i.push(la("m",su.m[0],a)),r.forEach(function(o){su[o].forEach(function(f){f.name in a&&a[f.name]!=null?i.push(la(o,f,a)):f.push in a&&a[f.push]!=null&&a[f.push].forEach(function(h){i.push(la(o,f,h))})})})}),i.join(`\r
`)+`\r
`},_s=Nw,Hb=Wb,Gb=lf;tt.grammar=Gb;tt.write=Hb;tt.parse=_s.parse;tt.parseParams=_s.parseParams;tt.parseFmtpConfig=_s.parseFmtpConfig;tt.parsePayloads=_s.parsePayloads;tt.parseRemoteCandidates=_s.parseRemoteCandidates;tt.parseImageAttributes=_s.parseImageAttributes;tt.parseSimulcastStreamList=_s.parseSimulcastStreamList;var Ir={};Object.defineProperty(Ir,"__esModule",{value:!0});Ir.parse=Kb;const Qb=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function Kb(e){const t=Qb.exec(e??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}var da={},xr={};Object.defineProperty(xr,"__esModule",{value:!0});xr.OfferMediaSection=xr.AnswerMediaSection=xr.MediaSection=void 0;const Yb=tt,Cg=Rn;class df{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r}){I(this,"_mediaObject");if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},t&&this.setIceParameters(t),n){this._mediaObject.candidates=[];for(const i of n){const a={foundation:i.foundation,component:1,ip:i.address??i.ip,port:i.port,priority:i.priority,transport:i.protocol,type:i.type};i.tcpType&&(a.tcptype=i.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(t){this._mediaObject.iceUfrag=t.usernameFragment,this._mediaObject.icePwd=t.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause()}close(){this.disable(),this._mediaObject.port=0,delete this._mediaObject.candidates,delete this._mediaObject.endOfCandidates,delete this._mediaObject.iceUfrag,delete this._mediaObject.icePwd,delete this._mediaObject.iceOptions,this._mediaObject.rtp=[],this._mediaObject.fmtp=[],delete this._mediaObject.rtcp,delete this._mediaObject.rtcpFb,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}xr.MediaSection=df;class Jb extends df{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:a,offerMediaObject:o,offerRtpParameters:f,answerRtpParameters:h,codecOptions:_}){switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const p of h.codecs){const S={payload:p.payloadType,codec:jw(p),rate:p.clockRate};p.channels>1&&(S.encoding=p.channels),this._mediaObject.rtp.push(S);const k=Cg.clone(p.parameters)??{};let M=Cg.clone(p.rtcpFeedback)??[];if(_){const{opusStereo:B,opusFec:v,opusDtx:l,opusMaxPlaybackRate:u,opusMaxAverageBitrate:g,opusPtime:C,opusNack:N,videoGoogleStartBitrate:w,videoGoogleMaxBitrate:x,videoGoogleMinBitrate:T}=_,D=f.codecs.find(P=>P.payloadType===p.payloadType);switch(p.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{B!==void 0&&(D.parameters["sprop-stereo"]=B?1:0,k.stereo=B?1:0),v!==void 0&&(D.parameters.useinbandfec=v?1:0,k.useinbandfec=v?1:0),l!==void 0&&(D.parameters.usedtx=l?1:0,k.usedtx=l?1:0),u!==void 0&&(k.maxplaybackrate=u),g!==void 0&&(k.maxaveragebitrate=g),C!==void 0&&(D.parameters.ptime=C,k.ptime=C),N||(D.rtcpFeedback=D.rtcpFeedback.filter(P=>P.type!=="nack"||P.parameter),M=M.filter(P=>P.type!=="nack"||P.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{w!==void 0&&(k["x-google-start-bitrate"]=w),x!==void 0&&(k["x-google-max-bitrate"]=x),T!==void 0&&(k["x-google-min-bitrate"]=T);break}}}const V={payload:p.payloadType,config:""};for(const B of Object.keys(k))V.config&&(V.config+=";"),V.config+=`${B}=${k[B]}`;V.config&&this._mediaObject.fmtp.push(V);for(const B of M)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:B.type,subtype:B.parameter})}this._mediaObject.payloads=h.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of h.headerExtensions)(o.ext??[]).some(k=>k.uri===p.uri)&&this._mediaObject.ext.push({uri:p.uri,value:p.id});if(o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const p of o.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const p of o.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=String(i.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(t){switch(t){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(t){var a,o;if(!((a=this._mediaObject.simulcast)!=null&&a.list1))return;const n={};for(const f of t)f.rid&&(n[f.rid]=f);const r=this._mediaObject.simulcast.list1,i=Yb.parseSimulcastStreamList(r);for(const f of i)for(const h of f)h.paused=!((o=n[h.scid])!=null&&o.active);this._mediaObject.simulcast.list1=i.map(f=>f.map(h=>`${h.paused?"~":""}${h.scid}`).join(",")).join(";")}}xr.AnswerMediaSection=Jb;class qb extends df{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:a,mid:o,kind:f,offerRtpParameters:h,streamId:_,trackId:p}){var S;switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(o),this._mediaObject.type=f,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",f){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:_,appdata:p}];for(const B of h.codecs){const v={payload:B.payloadType,codec:jw(B),rate:B.clockRate};B.channels>1&&(v.encoding=B.channels),this._mediaObject.rtp.push(v);const l={payload:B.payloadType,config:""};for(const u of Object.keys(B.parameters??{}))l.config&&(l.config+=";"),l.config+=`${u}=${B.parameters[u]}`;l.config&&this._mediaObject.fmtp.push(l);for(const u of B.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:B.payloadType,type:u.type,subtype:u.parameter})}this._mediaObject.payloads=h.codecs.map(B=>B.payloadType).join(" "),this._mediaObject.ext=[];for(const B of h.headerExtensions)this._mediaObject.ext.push({uri:B.uri,value:B.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const k=h.encodings[0],M=k.ssrc,V=(S=k.rtx)==null?void 0:S.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],M&&h.rtcp.cname&&this._mediaObject.ssrcs.push({id:M,attribute:"cname",value:h.rtcp.cname}),V&&(h.rtcp.cname&&this._mediaObject.ssrcs.push({id:V,attribute:"cname",value:h.rtcp.cname}),M&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${M} ${V}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize;break}}}setDtlsRole(t){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}xr.OfferMediaSection=qb;function jw(e){const n=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");return n[2]}var xg;function eo(){if(xg)return da;xg=1,Object.defineProperty(da,"__esModule",{value:!0}),da.RemoteSdp=void 0;const e=tt,t=et,n=xr,r=Aw(),i=["av1","h264"],a=new t.Logger("RemoteSdp");let o=class{constructor({iceParameters:h,iceCandidates:_,dtlsParameters:p,sctpParameters:S,plainRtpParameters:k}){I(this,"_iceParameters");I(this,"_iceCandidates");I(this,"_dtlsParameters");I(this,"_sctpParameters");I(this,"_plainRtpParameters");I(this,"_mediaSections",[]);I(this,"_midToIndex",new Map);I(this,"_firstMid");I(this,"_sdpObject");if(this._iceParameters=h,this._iceCandidates=_,this._dtlsParameters=p,this._sctpParameters=S,this._plainRtpParameters=k,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:`mediasoup-client-v${r.version}`},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",h!=null&&h.iceLite&&(this._sdpObject.icelite="ice-lite"),p){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const M=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:p.fingerprints[M-1].algorithm,hash:p.fingerprints[M-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}k&&(this._sdpObject.origin.address=k.ip,this._sdpObject.origin.ipVer=k.ipVersion)}updateIceParameters(h){a.debug("updateIceParameters() [iceParameters:%o]",h),this._iceParameters=h,this._sdpObject.icelite=h.iceLite?"ice-lite":void 0;for(const _ of this._mediaSections)_.setIceParameters(h)}updateDtlsRole(h){a.debug("updateDtlsRole() [role:%s]",h),this._dtlsParameters.role=h;for(const _ of this._mediaSections)_.setDtlsRole(h)}setSessionExtmapAllowMixed(){a.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let h=0;h<this._mediaSections.length;++h){const _=this._mediaSections[h];if(_.closed)return{idx:h,reuseMid:_.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:h,reuseMid:_,offerRtpParameters:p,answerRtpParameters:S,codecOptions:k}){var v;const M=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:h,offerRtpParameters:p,answerRtpParameters:S,codecOptions:k}),V=M.getObject();V.rtp.find(l=>i.includes(l.codec.toLowerCase()))||(V.ext=(v=V.ext)==null?void 0:v.filter(l=>l.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),_?this.replaceMediaSection(M,_):this._midToIndex.has(M.mid)?this.replaceMediaSection(M):this.addMediaSection(M)}receive({mid:h,kind:_,offerRtpParameters:p,streamId:S,trackId:k}){this.setSessionExtmapAllowMixed();const M=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:h,kind:_,offerRtpParameters:p,streamId:S,trackId:k}),V=this._mediaSections.find(B=>B.closed);V?this.replaceMediaSection(M,V.mid):this.addMediaSection(M)}pauseMediaSection(h){this.findMediaSection(h).pause()}resumeSendingMediaSection(h){this.findMediaSection(h).resume()}resumeReceivingMediaSection(h){this.findMediaSection(h).resume()}disableMediaSection(h){this.findMediaSection(h).disable()}closeMediaSection(h){const _=this.findMediaSection(h);return h===this._firstMid?(a.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",h),this.disableMediaSection(h),!1):(_.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(h,_){const p=this.findMediaSection(h);p.muxSimulcastStreams(_),this.replaceMediaSection(p)}sendSctpAssociation({offerMediaObject:h}){const _=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:h});this.addMediaSection(_)}receiveSctpAssociation(){const h=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(h)}getSdp(){return this._sdpObject.origin.sessionVersion++,e.write(this._sdpObject)}addMediaSection(h){this._firstMid||(this._firstMid=h.mid),this._mediaSections.push(h),this._midToIndex.set(h.mid,this._mediaSections.length-1),this._sdpObject.media.push(h.getObject()),this.regenerateBundleMids()}replaceMediaSection(h,_){if(typeof _=="string"){const p=this._midToIndex.get(_);if(p===void 0)throw new Error(`no media section found for reuseMid '${_}'`);const S=this._mediaSections[p];this._mediaSections[p]=h,this._midToIndex.delete(S.mid),this._midToIndex.set(h.mid,p),this._sdpObject.media[p]=h.getObject(),this.regenerateBundleMids()}else{const p=this._midToIndex.get(h.mid);if(p===void 0)throw new Error(`no media section found with mid '${h.mid}'`);this._mediaSections[p]=h,this._sdpObject.media[p]=h.getObject()}}findMediaSection(h){const _=this._midToIndex.get(h);if(_===void 0)throw new Error(`no media section found with mid '${h}'`);return this._mediaSections[_]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(h=>!h.closed).map(h=>h.mid).join(" "))}};return da.RemoteSdp=o,da}var un={};Object.defineProperty(un,"__esModule",{value:!0});un.extractRtpCapabilities=Xb;un.extractDtlsParameters=Zb;un.getCname=eE;un.applyCodecParameters=tE;un.addHeaderExtension=nE;const Dw=tt;function Xb({sdpObject:e}){const t=new Map,n=new Map;for(const i of e.media){const a=i.type;switch(a){case"audio":case"video":break;default:continue}for(const o of i.rtp){const f={kind:a,mimeType:`${a}/${o.codec}`,preferredPayloadType:o.payload,clockRate:o.rate,channels:o.encoding,parameters:{},rtcpFeedback:[]};t.set(f.preferredPayloadType,f)}for(const o of i.fmtp??[]){const f=Dw.parseParams(o.config),h=t.get(o.payload);h&&(f!=null&&f.hasOwnProperty("profile-level-id")&&(f["profile-level-id"]=String(f["profile-level-id"])),h.parameters=f)}for(const o of i.rtcpFb??[]){const f={type:o.type,parameter:o.subtype};if(f.parameter||delete f.parameter,o.payload!=="*"){const h=t.get(Number(o.payload));if(!h)continue;h.rtcpFeedback.push(f)}else for(const h of t.values())h.kind===a&&!/.+\/rtx$/i.test(h.mimeType)&&h.rtcpFeedback.push(f)}for(const o of i.ext??[]){if(o["encrypt-uri"])continue;const f={kind:a,uri:o.uri,preferredId:o.value};n.set(f.preferredId,f)}}return{codecs:Array.from(t.values()),headerExtensions:Array.from(n.values())}}function Zb({sdpObject:e}){let t=e.setup,n=e.fingerprint;if(!t||!n){const a=(e.media??[]).find(o=>o.port!==0);a&&(t=t??a.setup,n=n??a.fingerprint)}if(t){if(!n)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let r;switch(t){case"active":{r="client";break}case"passive":{r="server";break}case"actpass":{r="auto";break}}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function eE({offerMediaObject:e}){const t=(e.ssrcs??[]).find(n=>n.attribute==="cname");return t?t.value:""}function tE({offerRtpParameters:e,answerMediaObject:t}){var n;for(const r of e.codecs){const i=r.mimeType.toLowerCase();if(i!=="audio/opus"||!(t.rtp??[]).find(h=>h.payload===r.payloadType))continue;t.fmtp=t.fmtp??[];let o=t.fmtp.find(h=>h.payload===r.payloadType);o||(o={payload:r.payloadType,config:""},t.fmtp.push(o));const f=Dw.parseParams(o.config);switch(i){case"audio/opus":{const h=(n=r.parameters)==null?void 0:n["sprop-stereo"];h!==void 0&&(f.stereo=Number(h)?1:0);break}}o.config="";for(const h of Object.keys(f))o.config&&(o.config+=";"),o.config+=`${h}=${f[h]}`}}function nE({offerMediaObject:e,headerExtensionUri:t,headerExtensionId:n}){e.ext||(e.ext=[]),e.ext.push({uri:t,value:n})}var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.getRtpEncodings=rE;Nr.addLegacySimulcast=sE;function rE({offerMediaObject:e,codecs:t}){const n=new Set;for(const a of e.ssrcs??[]){const o=a.id;o&&n.add(o)}if(n.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups??[]){if(a.semantics!=="FID")continue;const o=a.ssrcs.split(/\s+/),f=Number(o[0]),h=Number(o[1]);n.has(f)&&(n.delete(f),n.delete(h),r.set(f,h))}for(const a of n)r.set(a,void 0);const i=[];for(const[a,o]of r){const f={ssrc:a};o&&t.length>1&&(f.rtx={ssrc:o}),i.push(f)}return i}function sE({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const n=(e.ssrcs??[]).find(S=>S.attribute==="msid");if(!n)throw new Error("a=ssrc line with msid information not found");const[r,i]=n.value.split(" "),a=Number(n.id);let o;(e.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const k=S.ssrcs.split(/\s+/);return Number(k[0])===a?(o=Number(k[1]),!0):!1});const f=(e.ssrcs??[]).find(S=>S.attribute==="cname");if(!f)throw new Error("a=ssrc line with cname information not found");const h=f.value,_=[],p=[];for(let S=0;S<t;++S)_.push(a+S),o&&p.push(o+S);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:_.join(" ")});for(const S of _)e.ssrcs.push({id:S,attribute:"cname",value:h}),e.ssrcs.push({id:S,attribute:"msid",value:`${r} ${i}`});for(let S=0;S<p.length;++S){const k=_[S],M=p[S];e.ssrcs.push({id:M,attribute:"cname",value:h}),e.ssrcs.push({id:M,attribute:"msid",value:`${r} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${k} ${M}`})}}var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.addNackSupportForOpus=iE;Zn.addHeaderExtensionSupport=aE;Zn.getMsidStreamIdAndTrackId=oE;function iE(e){var t;for(const n of e.codecs??[])(n.mimeType.toLowerCase()==="audio/opus"||n.mimeType.toLowerCase()==="audio/multiopus")&&!((t=n.rtcpFeedback)!=null&&t.some(r=>r.type==="nack"&&!r.parameter))&&(n.rtcpFeedback||(n.rtcpFeedback=[]),n.rtcpFeedback.push({type:"nack"}))}function aE(e,t){var a;let n;const r=(a=e.headerExtensions)==null?void 0:a.find(o=>o.uri===t.uri);if(r){if(r.kind===t.kind)return;n=r.preferredId}if(e.headerExtensions||(e.headerExtensions=[]),n===void 0){n=1;const o=new Set(e.headerExtensions.map(f=>f.preferredId));for(;o.has(n);)++n}const i={kind:t.kind,uri:t.uri,preferredId:n,preferredEncrypt:!1,direction:t.direction};e.headerExtensions.push(i)}function oE(e){if(!e||typeof e!="string")return{msidStreamId:void 0,msidTrackId:void 0};const[t,n]=e.trim().split(/\s+/);return t?{msidStreamId:t,msidTrackId:n}:{msidStreamId:void 0,msidTrackId:void 0}}var bg;function cE(){if(bg)return ca;bg=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.Chrome111=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Ir,o=eo(),f=un,h=Nr,_=Zn,p=new n.Logger("Chrome111"),S="Chrome111",k={OS:1024,MIS:1024};let M=class Cc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:T}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=T,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Cc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return Cc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){if(this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1){let J=1;for(const Q of u){const X=Q.scalabilityMode?(0,a.parse)(Q.scalabilityMode).temporalLayers:3;X>J&&(J=X)}u.forEach((Q,X)=>{Q.rid=`r${X}`,Q.scalabilityMode=`L1T${J}`})}const x=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});w&&w(T.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=Cc.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);if(Z.codecs=r.reduceCodecs(Z.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),C!=null&&C.absCaptureTime){const J=P.media[x.idx];f.addHeaderExtension({offerMediaObject:J,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}}p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);const ae=T.mid;G.mid=ae,P=e.parse(this._pc.localDescription.sdp);const L=P.media[x.idx];if(G.rtcp.cname=f.getCname({offerMediaObject:L}),G.msid=`${l??this._sendStream.id} ${v.id}`,!u)G.encodings=h.getRtpEncodings({offerMediaObject:L,codecs:G.codecs});else if(u.length===1){const J=h.getRtpEncodings({offerMediaObject:L,codecs:G.codecs});Object.assign(J[0],u[0]),G.encodings=J}else G.encodings=u;this._remoteSdp.send({offerMediaObject:L,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const H={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",H),await this._pc.setRemoteDescription(H),this._mapMidTransceiver.set(ae,T),{localId:ae,rtpParameters:G,rtpSender:T.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),D=e.parse(T.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:T,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",T,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(T,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:T})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:T,onRtpReceiver:D}=x;if(D){const P=u.get(T),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:T,rtpParameters:D}=x,P=u.get(T),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:T}=x,D=u.get(T),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const T=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ca.Chrome111=M,ca}var ua={},Eg;function lE(){if(Eg)return ua;Eg=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.Chrome74=void 0;const e=tt,t=et,n=dt,r=Le,i=lt,a=Ir,o=eo(),f=un,h=Nr,_=Zn,p=new t.Logger("Chrome74"),S="Chrome74",k={OS:1024,MIS:1024};let M=class xc extends n.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:T}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=T,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new xc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return xc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((Q,X)=>{Q.rid=`r${X}`});const w=this._remoteSdp.getNextMediaSectionIdx(),x=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});let T=await this._pc.createOffer(),D=e.parse(T.sdp);D.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const P=[];P.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const j=xc.getLocalRtpCapabilities(D,P),$=this._getSendExtendedRtpCapabilities(j),z=r.getSendingRtpParameters(v.kind,$);z.codecs=r.reduceCodecs(z.codecs,N);const G=r.getSendingRemoteRtpParameters(v.kind,$);G.codecs=r.reduceCodecs(G.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D});let Z=!1;const ae=(0,a.parse)((u??[{}])[0].scalabilityMode);let L;(u==null?void 0:u.length)===1&&ae.spatialLayers>1&&z.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),Z=!0,D=e.parse(T.sdp),L=D.media[w.idx],h.addLegacySimulcast({offerMediaObject:L,numStreams:ae.spatialLayers}),T={type:"offer",sdp:e.write(D)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",T),C!=null&&C.absCaptureTime&&(L=D.media[w.idx],f.addHeaderExtension({offerMediaObject:L,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:G.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),T={type:"offer",sdp:e.write(D)}),await this._pc.setLocalDescription(T);const H=x.mid;if(z.mid=H,D=e.parse(this._pc.localDescription.sdp),L=D.media[w.idx],z.rtcp.cname=f.getCname({offerMediaObject:L}),z.msid=`${l??this._sendStream.id} ${v.id}`,!u)z.encodings=h.getRtpEncodings({offerMediaObject:L,codecs:z.codecs});else if(u.length===1){let Q=h.getRtpEncodings({offerMediaObject:L,codecs:z.codecs});Object.assign(Q[0],u[0]),Z&&(Q=[Q[0]]),z.encodings=Q}else z.encodings=u;if(z.encodings.length>1&&(z.codecs[0].mimeType.toLowerCase()==="video/vp8"||z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of z.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${ae.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:w.reuseMid,offerRtpParameters:z,answerRtpParameters:G,codecOptions:g});const J={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",J),await this._pc.setRemoteDescription(J),this._mapMidTransceiver.set(H,x),{localId:H,rtpParameters:z,rtpSender:x.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),D=e.parse(T.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:T,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",T,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(T,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:T})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:T,rtpParameters:D}=x,P=u.get(T),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:T}=x,D=u.get(T),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const T=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ua.Chrome74=M,ua}var pa={},kg;function dE(){if(kg)return pa;kg=1,Object.defineProperty(pa,"__esModule",{value:!0}),pa.Firefox120=void 0;const e=tt,t=dt,n=et,r=lt,i=Le,a=Ir,o=eo(),f=un,h=Nr,_=Zn,p=new n.Logger("Firefox120"),S="Firefox120",k={OS:16,MIS:2048};let M=class bc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:T}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=T,this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new bc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const l=document.createElement("canvas");l.getContext("2d");const g=l.captureStream().getVideoTracks()[0];try{v.addTransceiver("audio",{direction:"sendrecv"}),v.addTransceiver(g,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const C=await v.createOffer();try{l.remove()}catch{}try{g.stop()}catch{}try{v.close()}catch{}v=void 0;const N=e.parse(C.sdp);return bc.getLocalRtpCapabilities(N)}catch(C){try{l.remove()}catch{}try{g.stop()}catch{}try{v==null||v.close()}catch{}throw v=void 0,C}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v){const l=f.extractRtpCapabilities({sdpObject:v});return i.validateAndNormalizeRtpCapabilities(l),l}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){throw this.assertNotClosed(),new r.UnsupportedError("not supported")}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,codec:C,onRtpSender:N}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((L,H)=>{L.rid=`r${H}`});const w=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});N&&N(w.sender);const x=await this._pc.createOffer();let T=e.parse(x.sdp);T.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const D=bc.getLocalRtpCapabilities(T),P=this._getSendExtendedRtpCapabilities(D),j=i.getSendingRtpParameters(v.kind,P);j.codecs=i.reduceCodecs(j.codecs,C);const $=i.getSendingRemoteRtpParameters(v.kind,P);$.codecs=i.reduceCodecs($.codecs,C),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:T});const z=(0,a.parse)((u??[{}])[0].scalabilityMode);p.debug("send() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const G=w.mid;j.mid=G,T=e.parse(this._pc.localDescription.sdp);const Z=T.media[T.media.length-1];if(j.rtcp.cname=f.getCname({offerMediaObject:Z}),j.msid=`${l??this._sendStream.id} ${v.id}`,!u)j.encodings=h.getRtpEncodings({offerMediaObject:Z,codecs:j.codecs});else if(u.length===1){const L=h.getRtpEncodings({offerMediaObject:Z,codecs:j.codecs});Object.assign(L[0],u[0]),j.encodings=L}else j.encodings=u;if(j.encodings.length>1&&(j.codecs[0].mimeType.toLowerCase()==="video/vp8"||j.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const L of j.encodings)L.scalabilityMode?L.scalabilityMode=`L1T${z.temporalLayers}`:L.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Z,offerRtpParameters:j,answerRtpParameters:$,codecOptions:g});const ae={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ae),await this._pc.setRemoteDescription(ae),this._mapMidTransceiver.set(G,w),{localId:G,rtpParameters:j,rtpSender:w.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated transceiver not found");l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.disableMediaSection(l.mid);const u=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated transceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),D=e.parse(T.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:T,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",T,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(T,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:T})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:T,onRtpReceiver:D}=x;if(D){const P=u.get(T),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:T,rtpParameters:D}=x,P=u.get(T),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j}),C={type:"answer",sdp:e.write(N)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:T}=x,D=u.get(T),P=this._pc.getTransceivers().find(j=>j.mid===D);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const T=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new r.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return pa.Firefox120=M,pa}var fa={},Tg;function uE(){if(Tg)return fa;Tg=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.Safari12=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Ir,o=eo(),f=un,h=Nr,_=Zn,p=new n.Logger("Safari12"),S="Safari12",k={OS:1024,MIS:1024};let M=class Ec extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:T}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=T,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",D=>{this.emit("@icecandidateerror",D)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Ec(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return Ec.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l);const x=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream]});w&&w(T.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=Ec.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,N);let ae;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});const L=(0,a.parse)((u??[{}])[0].scalabilityMode);u&&u.length>1&&(p.debug("send() | enabling legacy simulcast"),P=e.parse(D.sdp),ae=P.media[x.idx],h.addLegacySimulcast({offerMediaObject:ae,numStreams:u.length}),D={type:"offer",sdp:e.write(P)}),C!=null&&C.absCaptureTime&&(ae=P.media[x.idx],f.addHeaderExtension({offerMediaObject:ae,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);const H=T.mid;if(G.mid=H,P=e.parse(this._pc.localDescription.sdp),ae=P.media[x.idx],G.rtcp.cname=f.getCname({offerMediaObject:ae}),G.msid=`${l??this._sendStream.id} ${v.id}`,G.encodings=h.getRtpEncodings({offerMediaObject:ae,codecs:G.codecs}),u)for(let Q=0;Q<G.encodings.length;++Q)u[Q]&&Object.assign(G.encodings[Q],u[Q]);if(G.encodings.length>1&&(G.codecs[0].mimeType.toLowerCase()==="video/vp8"||G.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of G.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${L.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ae,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const J={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",J),await this._pc.setRemoteDescription(J),this._mapMidTransceiver.set(H,T),{localId:H,rtpParameters:G,rtpSender:T.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),D=e.parse(T.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:T,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",T,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(T,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:T})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:T,onRtpReceiver:D}=x;if(D){const P=u.get(T),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:T,rtpParameters:D}=x,P=u.get(T),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:T}=x,D=u.get(T),P=this._pc.getTransceivers().find(j=>j.mid===D);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const T=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return fa.Safari12=M,fa}var ha={},Rg;function pE(){if(Rg)return ha;Rg=1,Object.defineProperty(ha,"__esModule",{value:!0}),ha.ReactNative106=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Ir,o=eo(),f=un,h=Nr,_=Zn,p=new n.Logger("ReactNative106"),S="ReactNative106",k={OS:1024,MIS:1024};let M=class kc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:T}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=T,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new kc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return kc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((X,le)=>{X.rid=`r${le}`});const x=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});w&&w(T.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=kc.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});let ae=!1;const L=(0,a.parse)((u??[{}])[0].scalabilityMode);let H;(u==null?void 0:u.length)===1&&L.spatialLayers>1&&G.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),ae=!0,P=e.parse(D.sdp),H=P.media[x.idx],h.addLegacySimulcast({offerMediaObject:H,numStreams:L.spatialLayers}),D={type:"offer",sdp:e.write(P)}),C!=null&&C.absCaptureTime&&(H=P.media[x.idx],f.addHeaderExtension({offerMediaObject:H,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(X=>X.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);let J=T.mid??void 0;if(J||p.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),G.mid=J,P=e.parse(this._pc.localDescription.sdp),H=P.media[x.idx],G.rtcp.cname=f.getCname({offerMediaObject:H}),G.msid=`${l??this._sendStream.id} ${v.id}`,!u)G.encodings=h.getRtpEncodings({offerMediaObject:H,codecs:G.codecs});else if(u.length===1){let X=h.getRtpEncodings({offerMediaObject:H,codecs:G.codecs});Object.assign(X[0],u[0]),ae&&(X=[X[0]]),G.encodings=X}else G.encodings=u;if(G.encodings.length>1&&(G.codecs[0].mimeType.toLowerCase()==="video/vp8"||G.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const X of G.encodings)X.scalabilityMode?X.scalabilityMode=`L1T${L.temporalLayers}`:X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:H,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),J||(J=T.mid,G.mid=J),this._mapMidTransceiver.set(J,T),{localId:J,rtpParameters:G,rtpSender:T.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),D=e.parse(T.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:T,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",T,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(T,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:T})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:T,onRtpReceiver:D}=x;if(D){const P=u.get(T),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:T,rtpParameters:D}=x,P=u.get(T),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:T}=x,D=u.get(T),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const T=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ha.ReactNative106=M,ha}var Ig;function fE(){if(Ig)return Gr;Ig=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.Device=void 0,Gr.detectDevice=k,Gr.detectDeviceAsync=M;const e=et,t=dt,n=lt,r=Rn,i=Le,a=wl,o=cE(),f=lE(),h=dE(),_=uE(),p=pE(),S=new e.Logger("Device");function k(w,x){return S.debug("detectDevice()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!x&&typeof navigator=="object"&&(x=navigator.userAgentData),B(w,x)}async function M(w,x){return S.debug("detectDeviceAsync()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!x&&typeof navigator=="object"&&(x=navigator.userAgentData),B(w,x)}let V=class Lw{constructor({handlerName:x,handlerFactory:T}={}){I(this,"_handlerFactory");I(this,"_handlerName");I(this,"_loaded",!1);I(this,"_getSendExtendedRtpCapabilities");I(this,"_recvRtpCapabilities");I(this,"_canProduceByKind",{audio:!1,video:!1});I(this,"_sctpCapabilities");I(this,"_observer",new t.EnhancedEventEmitter);if(S.debug("constructor()"),x&&T)throw new TypeError("just one of handlerName or handlerInterface can be given");if(T)this._handlerFactory=T;else{if(x)S.debug("constructor() | handler given: %s",x);else if(x=k(),x)S.debug("constructor() | detected handler: %s",x);else throw new n.UnsupportedError("device not supported");switch(x){case"Chrome111":{this._handlerFactory=o.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=f.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=h.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=_.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=p.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${x}"`)}}this._handlerName=this._handlerFactory.name}static async factory({handlerName:x,handlerFactory:T}={}){if(S.debug("factory()"),x&&T)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!x&&!T&&(x=await M(),!x))throw new n.UnsupportedError("device not supported");return new Lw({handlerName:x,handlerFactory:T})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:x,preferLocalCodecsOrder:T=!1}){if(S.debug("load() [routerRtpCapabilities:%o]",x),this._loaded)throw new n.InvalidStateError("already loaded");const D=r.clone(x);i.validateAndNormalizeRtpCapabilities(D);const{getNativeRtpCapabilities:P,getNativeSctpCapabilities:j}=this._handlerFactory,$=r.clone(await P());i.validateAndNormalizeRtpCapabilities($),S.debug("load() | got native RTP capabilities:%o",$),this._getSendExtendedRtpCapabilities=G=>r.clone(i.getExtendedRtpCapabilities(G,D,T));const z=i.getExtendedRtpCapabilities($,D,!1);this._recvRtpCapabilities=i.getRecvRtpCapabilities(z),i.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),S.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=i.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=i.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await j(),i.validateSctpCapabilities(this._sctpCapabilities),S.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),S.debug("load() succeeded"),this._loaded=!0}canProduce(x){if(this._loaded){if(x!=="audio"&&x!=="video")throw new TypeError(`invalid kind "${x}"`)}else throw new n.InvalidStateError("not loaded");return this._canProduceByKind[x]}createSendTransport({id:x,iceParameters:T,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z}){return S.debug("createSendTransport()"),this.createTransport({direction:"send",id:x,iceParameters:T,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z})}createRecvTransport({id:x,iceParameters:T,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z}){return S.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:x,iceParameters:T,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z})}createTransport({direction:x,id:T,iceParameters:D,iceCandidates:P,dtlsParameters:j,sctpParameters:$,iceServers:z,iceTransportPolicy:G,additionalSettings:Z,appData:ae}){if(this._loaded){if(typeof T!="string")throw new TypeError("missing id");if(typeof D!="object")throw new TypeError("missing iceParameters");if(Array.isArray(P)){if(typeof j!="object")throw new TypeError("missing dtlsParameters");if($&&typeof $!="object")throw new TypeError("wrong sctpParameters");if(ae&&typeof ae!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new n.InvalidStateError("not loaded");const L=new a.Transport({direction:x,id:T,iceParameters:D,iceCandidates:P,dtlsParameters:j,sctpParameters:$,iceServers:z,iceTransportPolicy:G,additionalSettings:Z,appData:ae,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",L),L}};Gr.Device=V;function B(w,x){S.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',w,x);const T=v(w,x);if(T){if(T>=111)return S.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(T>=74)return S.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";S.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const D=l(w);if(D){if(D>=120)return S.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";S.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const P=u(w);if(P){if(P>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const j=g(w);if(j){if(j>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(N()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return S.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";S.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}S.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',w,x)}function v(w,x){if(S.debug("getChromiumMajorVersion()"),C(w,x)){S.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(x){const D=(x.brands??[]).find(P=>P.brand==="Chromium");if(D){const P=Number(D.version);return S.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${P}`),P}}const T=w==null?void 0:w.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(T!=null&&T[1]){const D=Number(T[1]);return S.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${D}`),D}S.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function l(w){if(S.debug("getFirefoxMajorVersion()"),C(w)){S.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const x=w==null?void 0:w.match(/\bFirefox\/(\w+)/i);if(x!=null&&x[1]){const T=Number(x[1]);return S.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${T}`),T}S.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function u(w){if(S.debug("getMacOSWebKitMajorVersion()"),C(w)){S.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(w&&/\bSafari\b/i.test(w)&&!/\bChrome\b/i.test(w)&&!/\bChromium\b/i.test(w)&&!/\bFirefox\b/i.test(w))){S.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const T=w.match(/AppleWebKit\/(\w+)/i);if(T!=null&&T[1]){const D=Number(T[1]);return S.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${D}`),D}S.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function g(w){if(S.debug("getIOSWebKitMajorVersion()"),!C(w)){S.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(N()){S.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const x=w==null?void 0:w.match(/AppleWebKit\/(\w+)/i);if(x!=null&&x[1]){const T=Number(x[1]);return S.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${T}`),T}S.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function C(w,x){return S.debug("isIOS()"),(x==null?void 0:x.platform)==="iOS"?(S.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):x!=null&&x.platform?(S.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):w&&/iPad|iPhone|iPod/.test(w)?(S.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(S.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(S.debug("isIOS() | this is not iOS => false"),!1)}function N(){return S.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(S.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(S.debug("isReactNative() | this is not React-Native => false"),!1)}return Gr}var kl={},Tl={},Mw={},Zr=256,Tc=[],ic;for(;Zr--;)Tc[Zr]=(Zr+256).toString(16).substring(1);function hE(){var e=0,t,n="";if(!ic||Zr+16>256){for(ic=Array(e=256);e--;)ic[e]=256*Math.random()|0;e=Zr=0}for(;e<16;e++)t=ic[Zr+e],e==6?n+=Tc[t&15|64]:e==8?n+=Tc[t&63|128]:n+=Tc[t],e&1&&e>1&&e<11&&(n+="-");return Zr++,n}Mw.v4=hE;var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0});Rl.FakeEventTarget=void 0;let mE=class{constructor(){I(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}};Rl.FakeEventTarget=mE;var Il={};Object.defineProperty(Il,"__esModule",{value:!0});Il.FakeEvent=void 0;class gE{constructor(t,n={}){I(this,"NONE",0);I(this,"CAPTURING_PHASE",1);I(this,"AT_TARGET",2);I(this,"BUBBLING_PHASE",3);I(this,"type");I(this,"bubbles");I(this,"cancelable");I(this,"defaultPrevented",!1);I(this,"composed",!1);I(this,"currentTarget",null);I(this,"eventPhase",this.NONE);I(this,"isTrusted",!0);I(this,"target",null);I(this,"timeStamp",0);I(this,"cancelBubble",!1);I(this,"returnValue",!0);I(this,"srcElement",null);this.type=t,this.bubbles=n.bubbles??!1,this.cancelable=n.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(t,n,r){}}Il.FakeEvent=gE;var uf={};Object.defineProperty(uf,"__esModule",{value:!0});uf.clone=vE;function vE(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}Object.defineProperty(Tl,"__esModule",{value:!0});Tl.FakeMediaStreamTrack=void 0;const Ng=Mw,yE=Rl,Qs=Il,ac=uf;var Ka,yi,wi,Cn,pr,xn,ts,_i,ns,Si,rs,ss,is,as,os,cs;const hf=class hf extends yE.FakeEventTarget{constructor({kind:n,id:r,label:i,contentHint:a,enabled:o,muted:f,readyState:h,capabilities:_,constraints:p,settings:S,data:k}){super();Ke(this,Ka);Ke(this,yi);Ke(this,wi);Ke(this,Cn);Ke(this,pr);Ke(this,xn);Ke(this,ts);Ke(this,_i);Ke(this,ns);Ke(this,Si);Ke(this,rs);Ke(this,ss,null);Ke(this,is,null);Ke(this,as,null);Ke(this,os,null);Ke(this,cs,null);Ce(this,Ka,r??(0,Ng.v4)()),Ce(this,yi,n),Ce(this,wi,i??""),Ce(this,ts,a??""),Ce(this,pr,o??!0),Ce(this,xn,f??!1),Ce(this,Cn,h??"live"),Ce(this,_i,_??{}),Ce(this,ns,p??{}),Ce(this,Si,S??{}),Ce(this,rs,k??{})}get id(){return oe(this,Ka)}get kind(){return oe(this,yi)}get label(){return oe(this,wi)}get contentHint(){return oe(this,ts)}set contentHint(n){Ce(this,ts,n)}get enabled(){return oe(this,pr)}set enabled(n){const r=oe(this,pr)!==n;Ce(this,pr,n),r&&this.dispatchEvent(new Qs.FakeEvent("enabledchange"))}get muted(){return oe(this,xn)}get readyState(){return oe(this,Cn)}get data(){return oe(this,rs)}set data(n){Ce(this,rs,n)}get onmute(){return oe(this,ss)}set onmute(n){oe(this,ss)&&this.removeEventListener("mute",oe(this,ss)),Ce(this,ss,n),n&&this.addEventListener("mute",n)}get onunmute(){return oe(this,is)}set onunmute(n){oe(this,is)&&this.removeEventListener("unmute",oe(this,is)),Ce(this,is,n),n&&this.addEventListener("unmute",n)}get onended(){return oe(this,as)}set onended(n){oe(this,as)&&this.removeEventListener("ended",oe(this,as)),Ce(this,as,n),n&&this.addEventListener("ended",n)}get onenabledchange(){return oe(this,os)}set onenabledchange(n){oe(this,os)&&this.removeEventListener("enabledchange",oe(this,os)),Ce(this,os,n),n&&this.addEventListener("enabledchange",n)}get onstopped(){return oe(this,cs)}set onstopped(n){oe(this,cs)&&this.removeEventListener("stopped",oe(this,cs)),Ce(this,cs,n),n&&this.addEventListener("stopped",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}stop(){oe(this,Cn)!=="ended"&&(Ce(this,Cn,"ended"),this.dispatchEvent(new Qs.FakeEvent("stopped")))}clone({id:n,data:r}={}){return new hf({id:n??(0,Ng.v4)(),kind:oe(this,yi),label:oe(this,wi),contentHint:oe(this,ts),enabled:oe(this,pr),muted:oe(this,xn),readyState:oe(this,Cn),capabilities:(0,ac.clone)(oe(this,_i)),constraints:(0,ac.clone)(oe(this,ns)),settings:(0,ac.clone)(oe(this,Si)),data:r??(0,ac.clone)(oe(this,rs))})}getCapabilities(){return oe(this,_i)}getConstraints(){return oe(this,ns)}async applyConstraints(n={}){return Ce(this,ns,n),Promise.resolve()}getSettings(){return oe(this,Si)}remoteStop(){oe(this,Cn)!=="ended"&&(Ce(this,Cn,"ended"),this.dispatchEvent(new Qs.FakeEvent("stopped")),this.dispatchEvent(new Qs.FakeEvent("ended")))}remoteMute(){oe(this,xn)||(Ce(this,xn,!0),this.dispatchEvent(new Qs.FakeEvent("mute")))}remoteUnmute(){oe(this,xn)&&(Ce(this,xn,!1),this.dispatchEvent(new Qs.FakeEvent("unmute")))}};Ka=new WeakMap,yi=new WeakMap,wi=new WeakMap,Cn=new WeakMap,pr=new WeakMap,xn=new WeakMap,ts=new WeakMap,_i=new WeakMap,ns=new WeakMap,Si=new WeakMap,rs=new WeakMap,ss=new WeakMap,is=new WeakMap,as=new WeakMap,os=new WeakMap,cs=new WeakMap;let sp=hf;Tl.FakeMediaStreamTrack=sp;var Nl={};Object.defineProperty(Nl,"__esModule",{value:!0});Nl.FakeEventTarget=void 0;class wE{constructor(){I(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}}Nl.FakeEventTarget=wE;Object.defineProperty(kl,"__esModule",{value:!0});kl.FakeHandler=void 0;const _E=Tl,SE=dt,CE=et,Ks=Rn,iu=Le,Ow=lt,xE=Nl,Ye=new CE.Logger("FakeHandler"),Pg="FakeHandler";class Ra extends SE.EnhancedEventEmitter{constructor({getSendExtendedRtpCapabilities:n},r){super();I(this,"_closed",!1);I(this,"_fakeParameters");I(this,"_getSendExtendedRtpCapabilities");I(this,"_cname",`CNAME-${Ks.generateRandomNumber()}`);I(this,"_defaultSendStreamId",`${Ks.generateRandomNumber()}`);I(this,"_transportReady",!1);I(this,"_nextLocalId",1);I(this,"_tracks",new Map);I(this,"_nextSctpStreamId",0);Ye.debug("constructor()"),this._getSendExtendedRtpCapabilities=n,this._fakeParameters=r}static createFactory(n){return{name:Pg,factory:r=>new Ra(r,n),getNativeRtpCapabilities:async()=>(Ye.debug("getNativeRtpCapabilities()"),Ra.getLocalRtpCapabilities(n)),getNativeSctpCapabilities:async()=>(Ye.debug("getNativeSctpCapabilities()"),n.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(n){const r=n.generateNativeRtpCapabilities();return iu.validateAndNormalizeRtpCapabilities(r),r}get name(){return Pg}close(){Ye.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(n){this.emit("@icegatheringstatechange",n)}setConnectionState(n){this.emit("@connectionstatechange",n)}async updateIceServers(n){this.assertNotClosed(),Ye.debug("updateIceServers()")}async restartIce(n){this.assertNotClosed(),Ye.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:n,streamId:r,encodings:i,codecOptions:a,codec:o}){this.assertNotClosed(),Ye.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const f=Ra.getLocalRtpCapabilities(this._fakeParameters),h=this._getSendExtendedRtpCapabilities(f),_=iu.getSendingRtpParameters(n.kind,h);_.codecs=iu.reduceCodecs(_.codecs,o);const p=_.codecs.some(k=>/.+\/rtx$/i.test(k.mimeType));_.mid=`mid-${Ks.generateRandomNumber()}`,_.msid=`${r??"-"} ${n.id}`,i||(i=[{}]);for(const k of i)k.ssrc=Ks.generateRandomNumber(),p&&(k.rtx={ssrc:Ks.generateRandomNumber()});_.encodings=i,_.rtcp={cname:this._cname,reducedSize:!0,mux:!0},_.msid=`${r??this._defaultSendStreamId} ${n.id}`;const S=this._nextLocalId++;return this._tracks.set(S,n),{localId:String(S),rtpParameters:_}}async stopSending(n){if(Ye.debug("stopSending() [localId:%s]",n),!this._closed){if(!this._tracks.has(Number(n)))throw new Error("local track not found");this._tracks.delete(Number(n))}}async pauseSending(n){this.assertNotClosed()}async resumeSending(n){this.assertNotClosed()}async replaceTrack(n,r){this.assertNotClosed(),r?Ye.debug("replaceTrack() [localId:%s, track.id:%s]",n,r.id):Ye.debug("replaceTrack() [localId:%s, no track]",n),this._tracks.delete(Number(n)),this._tracks.set(Number(n),r)}async setMaxSpatialLayer(n,r){this.assertNotClosed(),Ye.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",n,r)}async setRtpEncodingParameters(n,r){this.assertNotClosed(),Ye.debug("setRtpEncodingParameters() [localId:%s, params:%o]",n,r)}async getSenderStats(n){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),Ye.debug("sendDataChannel()");const f=new jg({id:this._nextSctpStreamId++,ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o}),h={streamId:this._nextSctpStreamId,ordered:n,maxPacketLifeTime:r,maxRetransmits:i};return{dataChannel:f,sctpStreamParameters:h}}async receive(n){this.assertNotClosed();const r=[];for(const i of n){const{trackId:a,kind:o}=i;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Ye.debug("receive() [trackId:%s, kind:%s]",a,o);const f=this._nextLocalId++,h=new _E.FakeMediaStreamTrack({kind:o});this._tracks.set(f,h),r.push({localId:String(f),track:h})}return r}async stopReceiving(n){if(!this._closed)for(const r of n)Ye.debug("stopReceiving() [localId:%s]",r),this._tracks.delete(Number(r))}async pauseReceiving(n){this.assertNotClosed()}async resumeReceiving(n){this.assertNotClosed()}async getReceiverStats(n){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:n,label:r,protocol:i}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Ye.debug("receiveDataChannel()"),{dataChannel:new jg({id:n.streamId,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,label:r,protocol:i})}}async setupTransport({localDtlsRole:n,localSdpObject:r}){const i=Ks.clone(this._fakeParameters.generateLocalDtlsParameters());n&&(i.role=n),this.emit("@connectionstatechange","connecting"),await new Promise((a,o)=>this.emit("@connect",{dtlsParameters:i},a,o)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Ow.InvalidStateError("method called in a closed handler")}}kl.FakeHandler=Ra;class jg extends xE.FakeEventTarget{constructor({id:n,ordered:r=!0,maxPacketLifeTime:i=null,maxRetransmits:a=null,label:o="",protocol:f=""}){super();I(this,"_id");I(this,"_negotiated",!0);I(this,"_ordered");I(this,"_maxPacketLifeTime");I(this,"_maxRetransmits");I(this,"_label");I(this,"_protocol");I(this,"_readyState","connecting");I(this,"_bufferedAmount",0);I(this,"_bufferedAmountLowThreshold",0);I(this,"_binaryType","arraybuffer");I(this,"_onopen",null);I(this,"_onclosing",null);I(this,"_onclose",null);I(this,"_onmessage",null);I(this,"_onbufferedamountlow",null);I(this,"_onerror",null);Ye.debug(`constructor() [id:${n}, ordered:${r}, maxPacketLifeTime:${i}, maxRetransmits:${a}, label:${o}, protocol:${f}`),this._id=n,this._ordered=r,this._maxPacketLifeTime=i,this._maxRetransmits=a,this._label=o,this._protocol=f}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._bufferedAmountLowThreshold=n}get binaryType(){return this._binaryType}set binaryType(n){this._binaryType=n}get onopen(){return this._onopen}set onopen(n){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=n,n&&this.addEventListener("open",n)}get onclosing(){return this._onclosing}set onclosing(n){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=n,n&&this.addEventListener("closing",n)}get onclose(){return this._onclose}set onclose(n){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=n,n&&this.addEventListener("close",n)}get onmessage(){return this._onmessage}set onmessage(n){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=n,n&&this.addEventListener("message",n)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(n){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=n,n&&this.addEventListener("bufferedamountlow",n)}get onerror(){return this._onerror}set onerror(n){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=n,n&&this.addEventListener("error",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(n){if(this._readyState!=="open")throw new Ow.InvalidStateError("not open")}}var pn={};Object.defineProperty(pn,"__esModule",{value:!0});pn.generateRouterRtpCapabilities=bE;pn.generateNativeRtpCapabilities=EE;pn.generateNativeSctpCapabilities=kE;pn.generateLocalDtlsParameters=TE;pn.generateTransportRemoteParameters=RE;pn.generateProducerRemoteParameters=IE;pn.generateConsumerRemoteParameters=NE;pn.generateDataProducerRemoteParameters=PE;pn.generateDataConsumerRemoteParameters=jE;const ft=Rn;function Pt(){return String(ft.generateRandomNumber())}function bE(){return ft.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function EE(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function kE(){return ft.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function TE(){return ft.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function RE(){return{id:Pt(),iceParameters:ft.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:ft.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:ft.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:ft.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function IE(){return ft.deepFreeze({id:Pt()})}function NE({id:e,codecMimeType:t}={}){switch(t){case"audio/opus":return{id:e??Pt(),producerId:Pt(),kind:"audio",rtpParameters:ft.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:e??Pt(),producerId:Pt(),kind:"audio",rtpParameters:ft.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:e??Pt(),producerId:Pt(),kind:"video",rtpParameters:ft.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:e??Pt(),producerId:Pt(),kind:"video",rtpParameters:ft.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${t}'`)}}function PE(){return ft.deepFreeze({id:Pt()})}function jE({id:e}={}){return{id:e??Pt(),dataProducerId:Pt(),sctpStreamParameters:ft.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}var Dg;function Aw(){return Dg||(Dg=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.enhancedEvents=e.ortc=e.parseScalabilityMode=e.detectDeviceAsync=e.detectDevice=e.Device=e.version=e.types=void 0;const t=ml;e.debug=t.default,e.types=gw,e.version="3.18.6";var n=fE();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return n.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return n.detectDevice}}),Object.defineProperty(e,"detectDeviceAsync",{enumerable:!0,get:function(){return n.detectDeviceAsync}});var r=Ir;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=Le,e.enhancedEvents=dt;var i=kl;Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=pn}(eu)),eu}var DE=Aw();const oc=1e4;function LE({selfUserId:e,getSelfUserId:t,sendDispatch:n,waitForEvent:r,onRemoteAudioAdded:i,onRemoteAudioRemoved:a}){const o={sessionToken:0,guildId:"",channelId:"",device:null,sendTransport:null,recvTransport:null,localProducer:null,localStream:null,consumersByProducerId:new Map,producerOwnerByProducerId:new Map,isMuted:!1,isDeafened:!1,audioOutputDeviceId:"",pendingAudioStartByProducerId:new Map};function f(j){const $=o.pendingAudioStartByProducerId.get(j);$&&($.cleanup(),o.pendingAudioStartByProducerId.delete(j))}function h(j,$){if(!j||!$||o.pendingAudioStartByProducerId.has($))return;const z=()=>{j.paused?j.play().then(()=>{f($)}).catch(()=>{}):f($)},G=["pointerdown","touchstart","keydown","click"];G.forEach(ae=>window.addEventListener(ae,z,{passive:!0}));const Z=window.setInterval(z,1500);o.pendingAudioStartByProducerId.set($,{cleanup:()=>{window.clearInterval(Z),G.forEach(ae=>window.removeEventListener(ae,z))}})}function _(j){return j===o.sessionToken&&!!o.channelId}function p(){return(t==null?void 0:t())||e||""}async function S(j,$,z=oc){return r({type:j,match:$,timeoutMs:z,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken})}async function k(j,$=oc){return r({type:"VOICE_TRANSPORT_CONNECTED",timeoutMs:$,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken,transportId:j})}async function M(j=oc){return r({type:"VOICE_ERROR",timeoutMs:j,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken})}async function V(j,$=oc){const z=j(),G=M($).then(Z=>{throw new Error(`VOICE_ERROR: ${(Z==null?void 0:Z.error)||"UNKNOWN"}`)});return Promise.race([z,G])}async function B(j,$){await n("VOICE_CREATE_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,direction:j});const z=await S("VOICE_TRANSPORT_CREATED",G=>(G==null?void 0:G.direction)===j);if(!_($))throw new Error("VOICE_SESSION_CANCELLED");return j==="send"?o.device.createSendTransport(z.transport):o.device.createRecvTransport(z.transport)}async function v(j,$,z){if(!j||!o.recvTransport||!o.device||!_(z)||o.consumersByProducerId.has(j))return;await n("VOICE_CONSUME",{guildId:o.guildId,channelId:o.channelId,transportId:o.recvTransport.id,producerId:j,rtpCapabilities:o.device.rtpCapabilities});const G=await V(()=>S("VOICE_CONSUMED",H=>(H==null?void 0:H.producerId)===j));if(!_(z))return;const Z=await o.recvTransport.consume(G),ae=new MediaStream([Z.track]),L=document.createElement("audio");L.autoplay=!0,L.playsInline=!0,L.preload="auto",L.muted=!1,L.srcObject=ae,L.style.display="none",document.body.appendChild(L),L.addEventListener("loadedmetadata",()=>{L.paused&&L.play().catch(()=>{h(L,j)})}),typeof L.setSinkId=="function"&&o.audioOutputDeviceId&&await L.setSinkId(o.audioOutputDeviceId).catch(()=>{}),L.volume=o.isDeafened?0:1,await L.play().catch(()=>{h(L,j)}),o.consumersByProducerId.set(j,{consumer:Z,audio:L,userId:$||""}),$&&o.producerOwnerByProducerId.set(j,$),i==null||i({producerId:j,userId:$,audio:L})}async function l({guildId:j,channelId:$,audioInputDeviceId:z,isMuted:G=!1,isDeafened:Z=!1,audioOutputDeviceId:ae=""}){await g(),o.sessionToken+=1;const L=o.sessionToken;o.guildId=j,o.channelId=$,o.isMuted=!!G,o.isDeafened=!!Z,o.audioOutputDeviceId=ae||"",await n("VOICE_JOIN",{guildId:j,channelId:$});const H=await r({type:"VOICE_JOINED",match:X=>(X==null?void 0:X.guildId)===j&&(X==null?void 0:X.channelId)===$,timeoutMs:12e3,guildId:j,channelId:$,sessionToken:L});if(!_(L))throw new Error("VOICE_SESSION_CANCELLED");o.device=new DE.Device,await o.device.load({routerRtpCapabilities:H.rtpCapabilities}),o.sendTransport=await B("send",L),o.sendTransport.on("connect",async({dtlsParameters:X},le,At)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,transportId:o.sendTransport.id,dtlsParameters:X}),await V(()=>k(o.sendTransport.id)),le()}catch(Ge){At(Ge)}}),o.sendTransport.on("produce",async({kind:X,rtpParameters:le},At,Ge)=>{try{await n("VOICE_PRODUCE",{guildId:o.guildId,channelId:o.channelId,transportId:o.sendTransport.id,kind:X,rtpParameters:le});const Yt=await V(()=>S("VOICE_PRODUCED",Ae=>(Ae==null?void 0:Ae.guildId)===o.guildId&&(Ae==null?void 0:Ae.channelId)===o.channelId&&(Ae==null?void 0:Ae.userId)===p()));At({id:Yt.producerId})}catch(Yt){Ge(Yt)}});const J={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,...z?{deviceId:{exact:z}}:{}};o.localStream=await navigator.mediaDevices.getUserMedia({audio:J});const Q=o.localStream.getAudioTracks()[0];if(!Q)throw new Error("MIC_TRACK_NOT_FOUND");o.localProducer=await o.sendTransport.produce({track:Q}),o.isMuted&&(o.localProducer.pause(),Q.enabled=!1),o.recvTransport=await B("recv",L),o.recvTransport.on("connect",async({dtlsParameters:X},le,At)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,transportId:o.recvTransport.id,dtlsParameters:X}),await V(()=>k(o.recvTransport.id)),le()}catch(Ge){At(Ge)}});for(const X of H.producers||[])await v(X.producerId,X.userId,L)}async function u(j){const $=o.consumersByProducerId.get(j);if($){o.consumersByProducerId.delete(j),o.producerOwnerByProducerId.delete(j),f(j);try{$.consumer.close()}catch{}try{$.audio.pause(),$.audio.srcObject=null,$.audio.remove()}catch{}a==null||a({producerId:j,userId:$.userId||""})}}async function g(){var j,$,z;o.sessionToken+=1;for(const G of[...o.pendingAudioStartByProducerId.keys()])f(G);for(const G of[...o.consumersByProducerId.keys()])await u(G);try{(j=o.localProducer)==null||j.close()}catch{}o.localProducer=null,o.localStream&&(o.localStream.getTracks().forEach(G=>G.stop()),o.localStream=null);try{($=o.sendTransport)==null||$.close()}catch{}o.sendTransport=null;try{(z=o.recvTransport)==null||z.close()}catch{}o.recvTransport=null,o.device=null,o.guildId="",o.channelId=""}async function C(j,$){if(!(!o.channelId||!o.guildId)&&!($!=null&&$.guildId&&$.guildId!==o.guildId)&&!($!=null&&$.channelId&&$.channelId!==o.channelId)&&!(o.localProducer&&$.producerId===o.localProducer.id)){if(j==="VOICE_NEW_PRODUCER"&&($!=null&&$.producerId)){if($.userId&&$.userId===p())return;await v($.producerId,$.userId,o.sessionToken).catch(()=>{});return}if(j==="VOICE_PRODUCER_CLOSED"&&($!=null&&$.producerId)){await u($.producerId);return}j==="VOICE_USER_LEFT"&&($!=null&&$.userId)&&N($.userId)}}function N(j){if(!j)return;[...o.producerOwnerByProducerId.entries()].filter(([,z])=>z===j).map(([z])=>z).forEach(z=>{u(z).catch(()=>{})})}function w(j){var z,G;o.isMuted=!!j;const $=(G=(z=o.localStream)==null?void 0:z.getAudioTracks)==null?void 0:G.call(z)[0];o.localProducer&&(o.isMuted?o.localProducer.pause():o.localProducer.resume()),$&&($.enabled=!o.isMuted)}function x(j){o.isDeafened=!!j;for(const{audio:$}of o.consumersByProducerId.values())$.volume=o.isDeafened?0:1}function T(j){o.audioOutputDeviceId=j||"";for(const{audio:$}of o.consumersByProducerId.values())typeof $.setSinkId=="function"&&o.audioOutputDeviceId&&$.setSinkId(o.audioOutputDeviceId).catch(()=>{})}function D(){return o.localStream}function P(){return{guildId:o.guildId,channelId:o.channelId}}return{join:l,cleanup:g,handleGatewayDispatch:C,closeConsumersForUser:N,setMuted:w,setDeafened:x,setAudioOutputDevice:T,getLocalStream:D,getContext:P}}function ME({downloadMenuRef:e,downloadsMenuOpen:t,setDownloadsMenuOpen:n,downloadTargets:r,preferredDownloadTarget:i,onOpenClient:a}){var o;return c.jsxs("div",{className:"landing-page",children:[c.jsxs("header",{className:"landing-header",children:[c.jsx("img",{src:"logo.png",alt:"OpenCom",className:"landing-logo"}),c.jsx("span",{className:"landing-brand",children:"OpenCom"})]}),c.jsxs("main",{className:"landing-main",children:[c.jsxs("section",{className:"landing-hero",children:[c.jsx("h1",{className:"landing-headline",children:"The best way to communicate."}),c.jsx("p",{className:"landing-sub",children:"One place for your servers, friends, and communities. Chat, voice, and stay in sync without the noise."})]}),c.jsxs("section",{className:"landing-features",children:[c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Servers and channels"}),c.jsx("p",{children:"Organize conversations by topic. Create spaces that scale from a few friends to large communities."})]}),c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Friends and DMs"}),c.jsx("p",{children:"Add friends, send direct messages, and see who is online. Simple and private."})]}),c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Voice and presence"}),c.jsx("p",{children:"Jump into voice channels when you need to talk. Status and presence keep everyone in the loop."})]})]}),c.jsxs("section",{className:"landing-cta",children:[c.jsxs("div",{className:"landing-cta-download",ref:e,children:[c.jsx("h3",{children:"Get the desktop app"}),c.jsx("p",{className:"landing-hint",children:"Windows and Linux builds are available."}),c.jsxs("div",{className:"download-wrapper",children:[c.jsx("a",{href:(i==null?void 0:i.href)||((o=r[0])==null?void 0:o.href)||"#",className:"landing-btn landing-btn-secondary",target:"_blank",rel:"noopener noreferrer",children:i?`Download ${i.label}`:"Download"}),c.jsx("button",{type:"button",className:"landing-btn landing-btn-secondary",onClick:()=>n(f=>!f),children:"All downloads"}),t&&c.jsx("div",{className:"download-menu",children:r.map(f=>c.jsx("a",{href:f.href,className:"download-item",target:"_blank",rel:"noopener noreferrer",children:f.label},f.href))})]})]}),c.jsxs("div",{className:"landing-cta-client",children:[c.jsx("h3",{children:"Use OpenCom now"}),c.jsx("p",{className:"landing-hint",children:"Open the client in your browser. No install required."}),c.jsx("button",{type:"button",className:"landing-btn landing-btn-primary",onClick:a,children:"Open client"})]})]})]}),c.jsx("footer",{className:"landing-footer",children:c.jsx("p",{children:"OpenCom. One place for teams, communities, and friends."})})]})}function OE({authMode:e,setAuthMode:t,email:n,setEmail:r,username:i,setUsername:a,password:o,setPassword:f,pendingVerificationEmail:h,status:_,onSubmit:p,onResendVerification:S,onBackHome:k}){return c.jsx("div",{className:"auth-shell",children:c.jsxs("div",{className:"auth-card",children:[c.jsx("button",{type:"button",className:"link-btn auth-back",onClick:k,children:"Back to home"}),c.jsx("h1",{children:"Welcome back"}),c.jsx("p",{className:"sub",children:"OpenCom keeps your teams, communities, and updates in one place."}),c.jsxs("form",{onSubmit:p,children:[c.jsxs("label",{children:["Email",c.jsx("input",{value:n,onChange:M=>r(M.target.value),type:"email",required:!0})]}),e==="register"&&c.jsxs("label",{children:["Username",c.jsx("input",{value:i,onChange:M=>a(M.target.value),required:!0})]}),c.jsxs("label",{children:["Password",c.jsx("input",{value:o,onChange:M=>f(M.target.value),type:"password",required:!0})]}),c.jsx("button",{type:"submit",children:e==="login"?"Log in":"Create account"})]}),c.jsx("button",{className:"link-btn",onClick:()=>t(e==="login"?"register":"login"),children:e==="login"?"Need an account? Register":"Have an account? Login"}),e==="login"&&c.jsx("button",{type:"button",className:"link-btn",onClick:S,children:"Resend verification email"}),h&&e==="login"&&c.jsxs("p",{className:"sub",children:["Pending verification: ",h]}),c.jsx("p",{className:"status",children:_})]})})}const AE="donskyblock/OpenCom",$E="main",au=`https://raw.githubusercontent.com/${AE}/${$E}`.replace(/\/$/,""),ip=[{href:`${au}/frontend/OpenCom.exe`,label:"Windows (.exe)"},{href:`${au}/frontend/OpenCom.deb`,label:"Linux (.deb)"},{href:`${au}/frontend/OpenCom.tar.gz`,label:"Linux (.tar.gz)"}];function FE(e=ip){return typeof navigator>"u"?e[0]||null:`${navigator.platform||""} ${navigator.userAgent||""}`.toLowerCase().includes("win")?e.find(n=>n.label.toLowerCase().includes("windows"))||e[0]||null:e.find(n=>n.label.toLowerCase().includes(".deb"))||e[0]||null}const Qn="/",di="/login",es="/app",ou=/^[a-zA-Z0-9_-]{3,32}$/;function UE(e=""){return/^\/join\/[a-zA-Z0-9_-]{3,32}\/?$/.test(e||"")}function zE(){return typeof window>"u"?!1:new URLSearchParams(window.location.search||"").get("desktop")==="1"}function pf(e=""){const t=e.replace(/\/+$/,"")||Qn;return t===di?di:t===es?es:Qn}function BE(){if(typeof window>"u")return Qn;const t=(new URLSearchParams(window.location.search||"").get("route")||"").trim();return t.startsWith("/")?t:window.location.pathname||Qn}function cc(){const e=pf(BE());return zE()&&e===Qn?es:e}function VE(e,{replace:t=!1}={}){if(typeof window>"u")return;const n=pf(e),r=window.location.hash||"";if(window.location.protocol==="file:"){const a=new URLSearchParams(window.location.search||"");n===Qn?a.delete("route"):a.set("route",n);const o=`${window.location.pathname}${a.toString()?`?${a}`:""}${r}`;window.history[t?"replaceState":"pushState"]({},"",o);return}const i=`${n}${r}`;window.history[t?"replaceState":"pushState"]({},"",i)}function ap(e=""){const t=(e||"").trim();if(!t)return"";if(ou.test(t))return t;const n=t.match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(n!=null&&n[1])return n[1];try{const r=new URL(t),i=(r.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(i!=null&&i[1])return i[1];const a=r.searchParams.get("join");if(a&&ou.test(a))return a;for(const f of r.searchParams.keys())if(/^join[a-zA-Z0-9_-]{3,32}$/.test(f))return f;const o=(r.hash||"").replace(/^#/,"");if(o.startsWith("join=")){const f=decodeURIComponent(o.slice(5));if(ou.test(f))return f}}catch{return""}return""}function WE(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);return e!=null&&e[1]?e[1]:ap(window.location.href||"")}function Lg(e){return typeof window>"u"?"":`${window.location.origin}/join/${encodeURIComponent(e)}`}function HE(){const e="".trim();let t="";if(typeof window<"u"){const r=new URLSearchParams(window.location.search||"");t=String(r.get("coreApi")||"").trim()}const n=t||e||"https://api.opencom.online";try{const r=new URL(n);return r.protocol!=="http:"&&r.protocol!=="https:"?"https://api.opencom.online":r.toString().replace(/\/$/,"")}catch{return"https://api.opencom.online"}}const bn=HE();function It(e){return!e||typeof e!="string"?null:e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?`${bn.replace(/\/$/,"")}${e}`:e}const Mg="opencom_custom_theme_css",Og="opencom_custom_theme_enabled",Ag="opencom_self_status",$g="opencom_pinned_server_messages",Fg="opencom_pinned_dm_messages",cu="opencom_active_dm",Ug="opencom_gateway_device_id",zg="opencom_mic_gain",Bg="opencom_mic_sensitivity",Vg="opencom_audio_input_device",Wg="opencom_audio_output_device",GE="opencom_server_voice_gateway_prefs",Hg="opencom_last_core_gateway",Gg="opencom_last_server_gateway",Rc="wss://ws.opencom.online/gateway",QE="opencom_debug_voice",Qg="opencom_client_extensions_enabled",Kg="opencom_client_extensions_dev_mode",Yg="opencom_client_extensions_dev_urls",Ia="opencom_access_token",Na="opencom_refresh_token",Jg={smile:"",grin:"",joy:"",rofl:"",wink:"",heart:"",thumbs_up:"",fire:"",tada:"",eyes:"",thinking:"",sob:""},Ys={MANAGE_CHANNELS:1n<<2n,MANAGE_ROLES:1n<<3n,KICK_MEMBERS:1n<<4n,BAN_MEMBERS:1n<<5n,ADMINISTRATOR:1n<<60n};function KE(e){try{return typeof e=="bigint"?e:typeof e=="number"?BigInt(e):typeof e=="string"&&e.trim()?BigInt(e.trim()):0n}catch{return 0n}}function YE(){const e="".trim()==="1",t=typeof window<"u"&&localStorage.getItem(QE)==="1";return e||t}function JE(e=""){try{const t=e.split(".");if(t.length!==3)return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(n);return JSON.parse(r)}catch{return null}}async function op(){const e=localStorage.getItem(Na)||"";if(!e)return null;const t=await fetch(`${bn}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return null;const n=await t.json().catch(()=>null),r=n==null?void 0:n.accessToken;return r?(localStorage.setItem(Ia,r),n!=null&&n.refreshToken&&localStorage.setItem(Na,n.refreshToken),typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-access-token-refresh",{detail:{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}})),{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}):null}async function qE(e,t){if(!t)return null;const n=localStorage.getItem(Ia)||"";if(!n)return null;const r=JE(t),i=(r==null?void 0:r.core_server_id)||(r==null?void 0:r.server_id);if(!i)return null;const a=await fetch(`${bn}/v1/servers/${encodeURIComponent(i)}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!a.ok)return null;const o=await a.json().catch(()=>null),f=o==null?void 0:o.membershipToken;return f?(typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-membership-token-refresh",{detail:{serverId:i,membershipToken:f}})),f):null}function XE(e,t){return Fw(e,t)}function ff(e){if(!e||typeof e!="string")return"";const t=e.trim();if(!t)return"";if(typeof window<"u"&&window.location.protocol==="file:"&&(t.startsWith("/")||!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(t)))return Rc;try{const n=new URL(t,window.location.origin);return n.protocol!=="ws:"&&n.protocol!=="wss:"&&(n.protocol=n.protocol==="http:"?"ws:":"wss:"),n.pathname="/gateway",n.search="",n.hash="",n.toString().replace(/\/$/,"")}catch{const n=t.replace(/\/$/,"");return n.endsWith("/gateway")?n:`${n}/gateway`}}function ZE(){if(typeof window>"u"||window.location.protocol==="file:")return Rc;const e=window.location.hostname||"";return e==="opencom.online"||e.endsWith(".opencom.online")?Rc:ff("/gateway")}function $w(){const e=[];return(n=>{const r=ff(n);r&&(e.includes(r)||e.push(r))})(ZE()),e}function ek(e,t=!1){const n=[],r=a=>{const o=ff(a);o&&(n.includes(o)||n.push(o))};for(const a of $w())r(a);return(t||"".trim()==="1")&&r(e),n}function Fw(e,t){const n=localStorage.getItem(t);if(!n)return e;const r=e.indexOf(n);return r<=0?e:[e[r],...e.slice(0,r),...e.slice(r+1)]}function tk(){const[e,t]=b.useState(localStorage.getItem(Mg)||""),[n,r]=b.useState(localStorage.getItem(Og)!=="0");return b.useEffect(()=>{let i=document.getElementById("opencom-theme-style");i||(i=document.createElement("style"),i.id="opencom-theme-style",document.head.appendChild(i)),i.textContent=n?e:"",localStorage.setItem(Mg,e),localStorage.setItem(Og,n?"1":"0")},[e,n]),[e,t,n,r]}function qg(e=[],t,n,r=null,i=null){const a=[];for(const o of e){const f=t(o),h=r?r(o):f,_=i?i(o):null,p=n(o),S=p?new Date(p):null,k=S&&!Number.isNaN(S.getTime())?S.getTime():null,M=a[a.length-1];if(M&&M.authorId===h&&k!==null&&M.lastMessageMs!==null&&k-M.lastMessageMs<=12e4){M.messages.push(o),M.lastMessageMs=k;continue}a.push({id:o.id,author:f,authorId:h,pfpUrl:_,firstMessageTime:p,lastMessageMs:k,messages:[o]})}return a}async function re(e,t={}){const n=t.__retried===!0,r={...t};delete r.__retried;const i=await fetch(`${bn}${e}`,{headers:{"Content-Type":"application/json",...r.headers||{}},...r});if(!i.ok){if(i.status===401&&!n&&e!=="/v1/auth/refresh"){const f=await op().catch(()=>null);if(f!=null&&f.accessToken){const h={...r.headers||{},Authorization:`Bearer ${f.accessToken}`};return re(e,{...r,headers:h,__retried:!0})}}const a=await i.json().catch(()=>({})),o=new Error(a.error||`HTTP_${i.status}`);throw o.status=i.status,o}return i.json()}async function ie(e,t,n,r={}){const i=r.__retried===!0,a={...r};delete a.__retried;const o=a.body!==void 0&&a.body!==null,f=await fetch(`${e}${t}`,{headers:{...o?{"Content-Type":"application/json"}:{},Authorization:`Bearer ${n}`,...a.headers||{}},...a});if(!f.ok){if(f.status===401&&!i){const _=await qE(e,n).catch(()=>null);if(_)return ie(e,t,_,{...a,__retried:!0})}const h=await f.json().catch(()=>({}));throw new Error(h.error||`HTTP_${f.status}`)}return f.json()}function Js(e,t){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function Xg(e){const t=Js(e,[]);return Array.isArray(t)?t.filter(n=>typeof n=="string"&&n.trim()):[]}function zn(e=""){const t=e.trim();if(!t)return"OC";const n=t.split(/\s+/).filter(Boolean);return n.length===1?n[0].slice(0,2).toUpperCase():`${n[0][0]||""}${n[1][0]||""}`.toUpperCase()}function lu(e=""){const t=e.match(/(?:^|\s)(@\{?)([^\s{}@]*)$/);if(!t)return null;const n=t[1]||"@",r=t[2]||"",i=e.length-n.length-r.length;return{query:r.toLowerCase(),start:i}}function nk(e=""){const t=e.trimStart();return t.startsWith("/")?(t.slice(1).split(/\s+/)[0]||"").toLowerCase():null}function rk(e=""){const t=[],n=/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|(\S+)/g;let r=n.exec(e);for(;r;)t.push((r[1]??r[2]??r[3]??"").replace(/\\(["'\\])/g,"$1")),r=n.exec(e);return t}function sk(e,t){if(t==="number"){const n=Number(e);if(Number.isNaN(n))throw new Error(`Invalid number: ${e}`);return n}if(t==="boolean"){const n=String(e).toLowerCase();if(["true","1","yes","on"].includes(n))return!0;if(["false","0","no","off"].includes(n))return!1;throw new Error(`Invalid boolean: ${e}`)}return e}function Zg(e){if(!e)return"just now";const t=new Date(e);return Number.isNaN(t.getTime())?"just now":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function ev(e=null){var t,n,r,i,a,o,f,h;return{name:(e==null?void 0:e.name)||"",details:(e==null?void 0:e.details)||"",state:(e==null?void 0:e.state)||"",largeImageUrl:(e==null?void 0:e.largeImageUrl)||"",largeImageText:(e==null?void 0:e.largeImageText)||"",smallImageUrl:(e==null?void 0:e.smallImageUrl)||"",smallImageText:(e==null?void 0:e.smallImageText)||"",button1Label:((n=(t=e==null?void 0:e.buttons)==null?void 0:t[0])==null?void 0:n.label)||"",button1Url:((i=(r=e==null?void 0:e.buttons)==null?void 0:r[0])==null?void 0:i.url)||"",button2Label:((o=(a=e==null?void 0:e.buttons)==null?void 0:a[1])==null?void 0:o.label)||"",button2Url:((h=(f=e==null?void 0:e.buttons)==null?void 0:f[1])==null?void 0:h.url)||""}}function ik(e){const t=[];return e.button1Label.trim()&&e.button1Url.trim()&&t.push({label:e.button1Label.trim(),url:e.button1Url.trim()}),e.button2Label.trim()&&e.button2Url.trim()&&t.push({label:e.button2Label.trim(),url:e.button2Url.trim()}),{name:e.name.trim()||void 0,details:e.details.trim()||void 0,state:e.state.trim()||void 0,largeImageUrl:e.largeImageUrl.trim()||void 0,largeImageText:e.largeImageText.trim()||void 0,smallImageUrl:e.smallImageUrl.trim()||void 0,smallImageText:e.smallImageText.trim()||void 0,buttons:t.length?t:void 0}}function tv(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function nv(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function ak(e=!1){if(!e)try{const t=new window.AudioContext,n=t.createOscillator(),r=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.value=523.25,r.type="sine",r.frequency.value=659.25,i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.12,t.currentTime+.04),i.gain.linearRampToValueAtTime(0,t.currentTime+.22),n.connect(i),r.connect(i),i.connect(t.destination),n.start(),r.start(),n.stop(t.currentTime+.22),r.stop(t.currentTime+.22),n.onended=()=>{r.onended=()=>t.close()}}catch{}}function ok(){var Kh,Yh,Jh;const e=YE(),t=(s,d={})=>{e&&console.debug(`[voice-debug] ${s}`,d)},n=localStorage.getItem(cu)||"",[r,i]=b.useState(localStorage.getItem(Ia)||""),[a,o]=b.useState(localStorage.getItem(Na)||""),[f,h]=b.useState("login"),[_,p]=b.useState(""),[S,k]=b.useState(""),[M,V]=b.useState(""),[B,v]=b.useState(""),[l,u]=b.useState(null),[g,C]=b.useState("servers"),[N,w]=b.useState(""),[x,T]=b.useState([]),[D,P]=b.useState([]),[j,$]=b.useState(""),[z,G]=b.useState(""),[Z,ae]=b.useState(""),[L,H]=b.useState(null),[J,Q]=b.useState([]),[X,le]=b.useState(""),[At,Ge]=b.useState(!1),[Yt,Ae]=b.useState(""),[er,mf]=b.useState(""),[ji,to]=b.useState([]),[gf,Pl]=b.useState(""),[In,no]=b.useState([]),[jl,Uw]=b.useState(""),[vf,yf]=b.useState(""),[Pr,Di]=b.useState("online"),[$t,Nn]=b.useState([]),[ye,Pn]=b.useState(n),[ro,Dl]=b.useState(""),[de,Li]=b.useState(null),[jn,tr]=b.useState({displayName:"",bio:"",pfpUrl:"",bannerUrl:""}),[Ft,Et]=b.useState({name:"",details:"",state:"",largeImageUrl:"",largeImageText:"",smallImageUrl:"",smallImageText:"",button1Label:"",button1Url:"",button2Label:"",button2Url:""}),[nr,Mi]=b.useState({name:"",logoUrl:"",bannerUrl:""}),[Ss,Ll]=b.useState(""),[Cs,Ml]=b.useState("https://"),[xs,Ol]=b.useState(""),[Al,$l]=b.useState(""),[Fl,wf]=b.useState(""),[so,zw]=b.useState(""),[_f,Bw]=b.useState(""),[Sf,Cf]=b.useState(""),[xf,Vw]=b.useState(!1),[bs,Oi]=b.useState(""),[fn,io]=b.useState(null),[Ul,bf]=b.useState(""),[ao,Ww]=b.useState("text"),[Ef,kf]=b.useState(""),[Ai,Tf]=b.useState(""),[oo,zl]=b.useState({incoming:[],outgoing:[]}),[ck,Hw]=b.useState(!0),[Gw,Qw]=b.useState({}),[Rf,co]=b.useState({guildId:"",channelId:""}),[Bl,If]=b.useState(!1),[Kw,Nf]=b.useState(!1),[jr,Pf]=b.useState(!1),[Dr,jf]=b.useState(!1),[lo,Yw]=b.useState(Number(localStorage.getItem(zg)||100)),[Es,Jw]=b.useState(Number(localStorage.getItem(Bg)||50)),[Dn,Df]=b.useState(localStorage.getItem(Vg)||""),[rr,Lf]=b.useState(localStorage.getItem(Wg)||""),[qw,Xw]=b.useState([]),[Zw,e_]=b.useState([]),[Jt,t_]=b.useState(localStorage.getItem(Ag)||"online"),[Mf,Of]=b.useState(!1),[Lr,Vl]=b.useState(""),[sr,Wl]=b.useState(""),[Hl,Gl]=b.useState(""),[uo,n_]=b.useState(Js($g,{})),[po,r_]=b.useState(Js(Fg,{})),[Ql,Af]=b.useState(""),[Kl,s_]=b.useState(""),[Yl,i_]=b.useState(""),[$i,$f]=b.useState(""),[Ff,a_]=b.useState(""),[Jl,Uf]=b.useState(""),[ks,Ts]=b.useState(!1),[fo,o_]=b.useState({x:26,y:26}),[zf,Bf]=b.useState(!1),[Fi,hn]=b.useState(!1),[Re,Qe]=b.useState("profile"),[Ui,c_]=b.useState(null),[l_,Vf]=b.useState(!1),[d_,Mr]=b.useState(!1),[Rs,ho]=b.useState("create"),[Ut,nt]=b.useState(null),[rt,zt]=b.useState(null),[kt,Tt]=b.useState(null),[Or,qt]=b.useState(null),[Ar,Xt]=b.useState(null),[zi,ql]=b.useState(null),[Wf,u_]=b.useState({}),[ce,$r]=b.useState(null),[Fr,Xl]=b.useState({}),Zl=b.useRef(new Set),[p_,Hf,f_,h_]=tk(),[lk,m_]=b.useState([]),[dk,uk]=b.useState({current:"",new:"",confirm:""}),[g_,ed]=b.useState(!1),[Gf,td]=b.useState(""),[mo,nd]=b.useState(""),[Qf,rd]=b.useState(""),[v_,pk]=b.useState([{id:"current",device:"Current Device",location:"Your Location",lastActive:"Now",status:"active"}]),[Kf,fk]=b.useState({date:new Date().toISOString(),device:"Current Device",location:"Your Location"}),[y_,sd]=b.useState(""),[Yf,w_]=b.useState(""),[Jf,go]=b.useState([]),[qf,id]=b.useState(""),[__,ad]=b.useState(!1),[Xf,vo]=b.useState(!1),[Zf,eh]=b.useState({twoFactorEnabled:!1}),[yo,od]=b.useState(null),[wo,cd]=b.useState(null),[_o,th]=b.useState(""),[So,Bi]=b.useState({}),[Vi,nh]=b.useState(cc),[S_,ld]=b.useState(!1),[hk,Co]=b.useState(!1),[Wi,dd]=b.useState(null),[Ur,C_]=b.useState({}),[rh,sh]=b.useState({}),[ih,x_]=b.useState(Js(GE,{})),[ah,b_]=b.useState({}),[oh,ud]=b.useState([]),[Hi,E_]=b.useState(Xg(Qg)),[Is,k_]=b.useState(localStorage.getItem(Kg)==="1"),[Gi,ch]=b.useState(Xg(Yg)),[lh,dh]=b.useState(""),[xo,pd]=b.useState({}),[bo,fd]=b.useState([]),[uh,Eo]=b.useState(0),ko=b.useRef(null),vt=b.useRef(null),Bt=b.useRef(null),$e=b.useRef(null),ut=b.useRef(null),Rt=b.useRef(!1),Qi=b.useRef([]),hd=b.useRef({audioCtx:null,stream:null,analyser:null,timer:null,lastSpeaking:!1}),Ln=b.useRef(new Map),ph=b.useRef("");ph.current=(l==null?void 0:l.id)||"";const Zt=b.useRef(null);Zt.current||(Zt.current=LE({getSelfUserId:()=>ph.current,sendDispatch:(s,d)=>Fo(s,d),waitForEvent:jS,debugLog:t}));const fh=b.useRef(Jt);fh.current=Jt;function mn(s){var d;return s?s===(l==null?void 0:l.id)?Jt:((d=So[s])==null?void 0:d.status)??"offline":"offline"}function T_(s){var d;return s?((d=So[s])==null?void 0:d.richPresence)??null:null}const R_={online:"Online",idle:"Idle",dnd:"Do Not Disturb",offline:"Offline"};function To(s){return R_[s]||s||"Offline"}const Ki=b.useRef(null),Yi=b.useRef(null),Ns=b.useRef(null),hh=b.useRef(null),Ro=b.useRef(!0),md=b.useRef(0),mh=b.useRef(""),gd=b.useRef(""),vd=b.useRef({x:0,y:0}),yd=b.useRef(null),I_=b.useMemo(()=>FE(ip),[]),gh=b.useRef(new Set),N_=b.useRef([]),vh=b.useRef([]),zr=(l==null?void 0:l.id)||"anonymous";function Br(s,{replace:d=!1}={}){VE(s,{replace:d}),nh(cc())}b.useEffect(()=>{vh.current=x},[x]),b.useEffect(()=>{const s=()=>nh(cc());return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),b.useEffect(()=>{if(typeof window>"u"||window.location.protocol==="file:"||UE(window.location.pathname||""))return;const s=pf(window.location.pathname||"");s!==(window.location.pathname||"")&&Br(s,{replace:!0})},[]),b.useEffect(()=>{r&&Vi!==es&&Br(es,{replace:!0})},[r,Vi]),b.useEffect(()=>{r||Vi===es&&Br(di,{replace:!0})},[r,Vi]),b.useEffect(()=>{function s(m){yd.current&&!yd.current.contains(m.target)&&ld(!1)}function d(m){m.key==="Escape"&&ld(!1)}return document.addEventListener("mousedown",s),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",d)}},[]),b.useEffect(()=>{localStorage.setItem(Qg,JSON.stringify(Hi))},[Hi]),b.useEffect(()=>{localStorage.setItem(Kg,Is?"1":"0")},[Is]),b.useEffect(()=>{localStorage.setItem(Yg,JSON.stringify(Gi))},[Gi]),b.useEffect(()=>{const s=x.find(d=>d.id===j);if(!s){Mi({name:"",logoUrl:"",bannerUrl:""});return}Mi({name:s.name||"",logoUrl:s.logoUrl||"",bannerUrl:s.bannerUrl||""})},[j,x]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){ud([]);return}re("/v1/extensions/catalog",{headers:{Authorization:`Bearer ${r}`}}).then(s=>ud(s.clientExtensions||[])).catch(()=>ud([]))},[r,l==null?void 0:l.id]),b.useEffect(()=>{const s=x.find(d=>d.id===j)||null;if(!r||!s){fd([]);return}ie(s.baseUrl,"/v1/extensions/commands",s.membershipToken).then(d=>fd(Array.isArray(d.commands)?d.commands:[])).catch(()=>fd([]))},[r,j,x]),b.useEffect(()=>{if(!r||x.length===0)return;let s=!1;const d=async()=>{try{const y=vh.current||[],E=await Promise.all(y.map(async A=>{try{const U=await re(`/v1/servers/${A.id}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});return{id:A.id,membershipToken:U.membershipToken}}catch{return null}}));if(s)return;const R=new Map(E.filter(Boolean).map(A=>[A.id,A.membershipToken]));R.size&&T(A=>A.map(U=>{const F=R.get(U.id);return F?{...U,membershipToken:F}:U}))}catch{}};d();const m=window.setInterval(d,8*60*1e3);return()=>{s=!0,window.clearInterval(m)}},[r,x.length]),b.useEffect(()=>{if(!a)return;let s=!1;const d=async()=>{const y=await op().catch(()=>null);s||y!=null&&y.accessToken||(w("Session expired. Please sign in again."),i(""),o(""))},m=window.setInterval(d,10*60*1e3);return()=>{s=!0,window.clearInterval(m)}},[a]),b.useEffect(()=>{Eo(0)},[X,bo]);async function P_({extensionId:s,extensionName:d,devUrl:m}){if(m){const E=await fetch(m);if(!E.ok)throw new Error(`HTTP_${E.status}`);return E.text()}const y=await fetch(`${bn}/v1/extensions/client/${encodeURIComponent(s)}/source`,{headers:{Authorization:`Bearer ${r}`}});if(!y.ok)throw new Error(`HTTP_${y.status}`);return y.text()}async function j_({extensionId:s,extensionName:d,devUrl:m}){const y=await P_({extensionId:s,extensionName:d,devUrl:m}),E=new Blob([y],{type:"application/javascript"}),R=URL.createObjectURL(E);try{const A=await import(R),U=(A==null?void 0:A.activateClient)||(A==null?void 0:A.default);if(typeof U!="function")throw new Error("Missing activateClient export");const F={registerPanel:W=>{N_.current.push(W)},coreApi:(W,Y={})=>re(W,{...Y,headers:{Authorization:`Bearer ${r}`,...Y.headers||{}}}),getSelf:()=>l,setStatus:w};await Promise.resolve(U(F))}finally{URL.revokeObjectURL(R)}}b.useEffect(()=>{if(!r)return;[...Hi.map(d=>({id:d,extensionId:d,extensionName:d,devUrl:null})),...Is?Gi.map((d,m)=>({id:`dev:${d}`,extensionId:`dev-extension-${m+1}`,extensionName:`Developer Extension ${m+1}`,devUrl:d})):[]].forEach(d=>{gh.current.has(d.id)||(gh.current.add(d.id),pd(m=>({...m,[d.id]:"loading"})),j_(d).then(()=>pd(m=>({...m,[d.id]:"loaded"}))).catch(m=>pd(y=>({...y,[d.id]:`error:${m.message}`}))))})},[r,Hi,Is,Gi,l]);function D_(s,d){E_(m=>d?m.includes(s)?m:[...m,s]:m.filter(y=>y!==s))}function L_(){const s=lh.trim();s&&(ch(d=>d.includes(s)?d:[...d,s]),dh(""))}b.useEffect(()=>{if(!r)return;const s=new Set;((L==null?void 0:L.members)||[]).forEach(m=>m.id&&s.add(m.id)),J.forEach(m=>{const y=m.author_id||m.authorId;y&&s.add(y)}),l!=null&&l.id&&s.add(l.id);const d=[...s].filter(m=>!Fr[m]&&!Zl.current.has(m));d.length!==0&&(d.forEach(m=>Zl.current.add(m)),Promise.all(d.map(m=>fetch(`${bn}/v1/users/${m}/profile`,{headers:{Authorization:`Bearer ${r}`}}).then(y=>y.ok?y.json():null).catch(()=>null))).then(m=>{d.forEach(y=>Zl.current.delete(y)),Xl(y=>{const E={...y};return d.forEach((R,A)=>{const U=m[A];U&&(U.username!=null||U.displayName!=null||U.pfpUrl!=null)&&(E[R]={username:U.username??U.displayName??R,displayName:U.displayName??U.username??R,pfpUrl:U.pfpUrl??null})}),E})}))},[r,L==null?void 0:L.members,J,l==null?void 0:l.id]),b.useEffect(()=>{!(l!=null&&l.id)||!de||Xl(s=>({...s,[l.id]:{username:de.username??l.username??l.id,displayName:de.displayName??de.username??l.username??l.id,pfpUrl:de.pfpUrl??null}}))},[l==null?void 0:l.id,l==null?void 0:l.username,de==null?void 0:de.username,de==null?void 0:de.displayName,de==null?void 0:de.pfpUrl]);const O=b.useMemo(()=>x.find(s=>s.id===j)||null,[x,j]),Mn=b.useMemo(()=>D.find(s=>s.id===z)||null,[D,z]),yt=b.useMemo(()=>{var s;return z||(Mn==null?void 0:Mn.id)||((s=L==null?void 0:L.guild)==null?void 0:s.id)||(O==null?void 0:O.defaultGuildId)||""},[z,Mn==null?void 0:Mn.id,(Kh=L==null?void 0:L.guild)==null?void 0:Kh.id,O==null?void 0:O.defaultGuildId]),wt=Rf.channelId,Fe=Rf.guildId,Vr=!!wt,Ps=(L==null?void 0:L.channels)||[],yh=b.useMemo(()=>{if(!wt)return"";const s=Ps.find(d=>d.id===wt);return(s==null?void 0:s.name)||wt},[Ps,wt]),js=b.useMemo(()=>Ps.find(s=>s.id===Z)||null,[Ps,Z]),Ee=b.useMemo(()=>$t.find(s=>s.id===ye)||null,[$t,ye]),wd=b.useMemo(()=>{var y;const s=(L==null?void 0:L.roles)||[],d=new Set(((y=L==null?void 0:L.me)==null?void 0:y.roleIds)||[]);let m=0n;for(const E of s)E&&(E.is_everyone||d.has(E.id))&&(m|=KE(E.permissions));return m},[L==null?void 0:L.roles,(Yh=L==null?void 0:L.me)==null?void 0:Yh.roleIds]),Wr=b.useMemo(()=>s=>(wd&Ys.ADMINISTRATOR)===Ys.ADMINISTRATOR?!0:(wd&s)===s,[wd]),Se=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Wr(Ys.MANAGE_CHANNELS)||Wr(Ys.MANAGE_ROLES):!1,[O,Wr]),Ji=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Wr(Ys.KICK_MEMBERS):!1,[O,Wr]),ir=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Wr(Ys.BAN_MEMBERS):!1,[O,Wr]),_d=Ji||ir,Ds=b.useMemo(()=>[...Ps||[]].filter(Boolean).sort((s,d)=>(s.position??0)-(d.position??0)),[Ps]),qi=b.useMemo(()=>Ds.filter(s=>s&&s.type==="category"),[Ds]),wh=b.useMemo(()=>{const s=new Map;for(const d of(L==null?void 0:L.emotes)||[]){const m=String((d==null?void 0:d.name)||"").toLowerCase();m&&s.set(m,d)}return s},[L==null?void 0:L.emotes]),Io=b.useMemo(()=>{const s=jl.trim().toLowerCase();return s?In.filter(d=>d.username.toLowerCase().includes(s)||d.id.includes(s)):In},[jl,In]),_h=b.useMemo(()=>{var m;const s=(L==null?void 0:L.members)||[];if(s.length)return s;const d=new Map;for(const y of J){const E=y.author_id||y.authorId;!E||d.has(E)||d.set(E,{id:E,username:y.username||E,status:"offline",pfp_url:y.pfp_url||null,roleIds:[]})}return l!=null&&l.id&&!d.has(l.id)&&d.set(l.id,{id:l.id,username:l.username||l.id,status:"offline",pfp_url:(de==null?void 0:de.pfpUrl)||null,roleIds:((m=L==null?void 0:L.me)==null?void 0:m.roleIds)||[]}),Array.from(d.values())},[L,J,l,de]),st=b.useMemo(()=>_h.map(s=>{var d,m,y;return{...s,username:((d=Fr[s.id])==null?void 0:d.displayName)||((m=Fr[s.id])==null?void 0:m.username)||s.username,pfp_url:((y=Fr[s.id])==null?void 0:y.pfpUrl)??s.pfp_url}}),[_h,Fr]),No=b.useMemo(()=>{const s=lu(X);if(!s||g!=="servers")return[];const d=["everyone",...st.map(y=>y.username||"")].map(y=>y.trim()).filter(Boolean),m=Array.from(new Set(d));return s.query?m.filter(y=>y.toLowerCase().startsWith(s.query)).slice(0,8):m.slice(0,8)},[X,g,st]),Ls=b.useMemo(()=>g!=="servers"?null:nk(X),[X,g]),en=b.useMemo(()=>{if(Ls==null)return[];const s=[...bo].sort((d,m)=>d.name.localeCompare(m.name));return Ls?s.filter(d=>d.name.toLowerCase().includes(Ls)).slice(0,10):s.slice(0,10)},[Ls,bo]),Po=Ls!=null,M_=b.useMemo(()=>{const s=new Map;for(const d of st)d!=null&&d.id&&(s.set(String(d.id).toLowerCase(),d),d.username&&s.set(String(d.username).toLowerCase(),d));return s},[st]),jo=b.useMemo(()=>new Map(st.map(s=>[s.id,s.username])),[st]),ar=b.useMemo(()=>{const s=(L==null?void 0:L.voiceStates)||[];if(!z)return s;const d=Ur[z]||{};if(!Object.keys(d).length)return s;const m=new Map(s.map(y=>[y.userId,y]));for(const[y,E]of Object.entries(d))E!=null&&E.channelId?m.set(y,{userId:y,channelId:E.channelId,muted:!!E.muted,deafened:!!E.deafened}):m.delete(y);return Array.from(m.values())},[L==null?void 0:L.voiceStates,Ur,z]),Sd=b.useMemo(()=>{var d;if(!(l!=null&&l.id)||!Fe||!wt)return!1;const s=(d=Ur[Fe])==null?void 0:d[l.id];if(s!=null&&s.channelId)return s.channelId===wt;if(z===Fe){const m=ar.find(y=>y.userId===l.id);return(m==null?void 0:m.channelId)===wt}return!1},[l==null?void 0:l.id,Fe,wt,Ur,z,ar]),Do=b.useMemo(()=>{var d;const s=new Map;for(const m of ar)!(m!=null&&m.channelId)||!(m!=null&&m.userId)||(s.has(m.channelId)||s.set(m.channelId,[]),s.get(m.channelId).push({userId:m.userId,username:jo.get(m.userId)||m.userId,pfp_url:((d=st.find(y=>y.id===m.userId))==null?void 0:d.pfp_url)||null,muted:!!m.muted,deafened:!!m.deafened}));return s},[ar,jo,st]),Sh=b.useMemo(()=>{const s=qi.map(m=>({category:m,channels:Ds.filter(y=>y.parent_id===m.id&&y.type!=="category")})),d=Ds.filter(m=>!m.parent_id&&m.type!=="category");return[...s,...d.length?[{category:{id:"uncategorized",name:"Channels"},channels:d}]:[]]},[qi,Ds]),O_=b.useMemo(()=>qg(J,s=>{const d=s.author_id||s.authorId;return jo.get(d)||d||"Unknown"},s=>s.created_at||s.createdAt,s=>s.author_id||s.authorId||"unknown",s=>{var m;const d=s.author_id||s.authorId;return((m=Fr[d])==null?void 0:m.pfpUrl)??s.pfp_url??null}),[J,jo,Fr]),A_=b.useMemo(()=>qg((Ee==null?void 0:Ee.messages)||[],s=>s.author||"Unknown",s=>s.createdAt,s=>s.authorId||"unknown",s=>s.pfp_url||null),[Ee]),Lo=b.useMemo(()=>uo[Z]||[],[uo,Z]),Mo=b.useMemo(()=>po[ye]||[],[po,ye]),Ch=b.useMemo(()=>{if(!j)return{mode:"core",customUrl:""};const s=ih[j]||{};return{mode:s.mode==="server"?"server":"core",customUrl:typeof s.customUrl=="string"?s.customUrl:""}},[j,ih]);async function xh(s=r){var A;if(!s)return;const[d,m,y,E]=await Promise.all([re("/v1/social/friends",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/dms",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/requests",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/settings",{headers:{Authorization:`Bearer ${s}`}})]);no(d.friends||[]);let R=[];if(Nn(U=>{const F=new Map(U.map(W=>[W.id,W]));return R=(m.dms||[]).map(W=>{var Y;return{...W,messages:((Y=F.get(W.id))==null?void 0:Y.messages)||[]}}),R}),!R.some(U=>U.id===ye)){const U=R.find(W=>W.messages&&W.messages.length>0),F=(U==null?void 0:U.id)||((A=R[0])==null?void 0:A.id)||"";F&&(Pn(F),localStorage.setItem(cu,F))}zl({incoming:y.incoming||[],outgoing:y.outgoing||[]}),Hw(E.allowFriendRequests!==!1)}b.useEffect(()=>{r?localStorage.setItem(Ia,r):localStorage.removeItem(Ia)},[r]),b.useEffect(()=>{var s,d;try{(d=(s=window.opencomDesktopBridge)==null?void 0:s.setPresenceAuth)==null||d.call(s,{accessToken:r||"",coreApi:bn})}catch{}},[r]),b.useEffect(()=>{r||!a||op().then(s=>{s!=null&&s.accessToken&&(i(s.accessToken),s.refreshToken&&o(s.refreshToken))}).catch(()=>{})},[r,a]);const bh=b.useMemo(()=>{var s;return JSON.stringify((l!=null&&l.id?(s=So[l.id])==null?void 0:s.richPresence:null)||null)},[l==null?void 0:l.id,So]);b.useEffect(()=>{if(!(l!=null&&l.id))return;let s=null;try{s=JSON.parse(bh)}catch{}Et(ev(s))},[l==null?void 0:l.id,bh]),b.useEffect(()=>{a?localStorage.setItem(Na,a):localStorage.removeItem(Na)},[a]),b.useEffect(()=>{const s=m=>{var R,A;const y=((R=m==null?void 0:m.detail)==null?void 0:R.accessToken)||"",E=((A=m==null?void 0:m.detail)==null?void 0:A.refreshToken)||"";y&&i(y),E&&o(E)},d=m=>{var R,A;const y=(R=m==null?void 0:m.detail)==null?void 0:R.serverId,E=(A=m==null?void 0:m.detail)==null?void 0:A.membershipToken;!y||!E||T(U=>U.map(F=>F.id===y?{...F,membershipToken:E}:F))};return window.addEventListener("opencom-access-token-refresh",s),window.addEventListener("opencom-membership-token-refresh",d),()=>{window.removeEventListener("opencom-access-token-refresh",s),window.removeEventListener("opencom-membership-token-refresh",d)}},[]),b.useEffect(()=>{var m;if(r)return;const s=Js(`opencom_friends_${zr}`,[]),d=Js(`opencom_dms_${zr}`,[]);no(s),Nn(d),d.some(y=>y.id===ye)||Pn(((m=d[0])==null?void 0:m.id)||"")},[zr,r]),b.useEffect(()=>{localStorage.setItem(`opencom_friends_${zr}`,JSON.stringify(In))},[In,zr]),b.useEffect(()=>{localStorage.setItem(`opencom_dms_${zr}`,JSON.stringify($t))},[$t,zr]),b.useEffect(()=>{if(!N)return;const s=window.setTimeout(()=>w(""),4500);return()=>window.clearTimeout(s)},[N]),b.useEffect(()=>{localStorage.setItem(Ag,Jt)},[Jt]),b.useEffect(()=>{localStorage.setItem($g,JSON.stringify(uo))},[uo]),b.useEffect(()=>{localStorage.setItem(Fg,JSON.stringify(po))},[po]),b.useEffect(()=>{ye&&localStorage.setItem(cu,ye)},[ye]),b.useEffect(()=>{if(!zf)return;const s=m=>{const y=Math.max(8,Math.min(window.innerWidth-340,m.clientX-vd.current.x)),E=Math.max(8,Math.min(window.innerHeight-280,m.clientY-vd.current.y));o_({x:y,y:E})},d=()=>Bf(!1);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",d)}},[zf]),b.useEffect(()=>{const s=()=>{nt(null),zt(null),Tt(null),qt(null),Xt(null),Fi||$r(null)},d=m=>{m.key==="Escape"&&(nt(null),zt(null),Tt(null),qt(null),Xt(null),$r(null),hn(!1))};return window.addEventListener("click",s),window.addEventListener("keydown",d),()=>{window.removeEventListener("click",s),window.removeEventListener("keydown",d)}},[Fi]),b.useEffect(()=>{!ko.current||g!=="servers"||ko.current.scrollTo({top:ko.current.scrollHeight,behavior:"smooth"})},[J,g]),b.useEffect(()=>{var R,A;if(!Ki.current||g!=="dms")return;const s=Ki.current;if(ye!==mh.current){mh.current=ye,md.current=((R=Ee==null?void 0:Ee.messages)==null?void 0:R.length)||0,s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Ro.current=!0;return}const m=s.scrollHeight-s.scrollTop-s.clientHeight<100,y=((A=Ee==null?void 0:Ee.messages)==null?void 0:A.length)||0,E=y>md.current;E&&m?(s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Ro.current=!0):E&&(Ro.current=!1),md.current=y},[Ee==null?void 0:Ee.messages,ye,g]),b.useEffect(()=>{if(!Ki.current||g!=="dms")return;const s=Ki.current,d=()=>{const m=s.scrollHeight-s.scrollTop-s.clientHeight<100;Ro.current=m};return s.addEventListener("scroll",d),()=>s.removeEventListener("scroll",d)},[g,ye]),b.useEffect(()=>{if(!r)return;async function s(){try{const d=await re("/v1/me",{headers:{Authorization:`Bearer ${r}`}});u(d);const[m,y]=await Promise.all([re(`/v1/users/${d.id}/profile`,{headers:{Authorization:`Bearer ${r}`}}),re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})]),E=y.servers||[];Li(m),tr({displayName:m.displayName||"",bio:m.bio||"",pfpUrl:m.pfpUrl||"",bannerUrl:m.bannerUrl||""}),T(E);try{await xh(r)}catch{}if(!E.length){$(""),G(""),H(null),Q([]);return}E.some(R=>R.id===j)||$(E[0].id)}catch(d){const m=String((d==null?void 0:d.message)||"");if(m.includes("UNAUTHORIZED")||m.includes("HTTP_401")||m.includes("INVALID_REFRESH")||m.includes("REFRESH_")){i(""),o(""),T([]),H(null),Q([]),w("Session expired. Please sign in again.");return}w(`Session error: ${d.message}`)}}s()},[r]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){Co(!1),vt.current&&(vt.current.close(),vt.current=null),Bt.current&&(clearInterval(Bt.current),Bt.current=null);return}let s=localStorage.getItem(Ug);s||(s="web-"+Math.random().toString(36).slice(2)+"-"+Date.now(),localStorage.setItem(Ug,s));let d=!1,m=!1,y=!1,E=null,R=0,A=0;const U=Fw($w(),Hg),F=()=>{if(d)return;const Y=Math.min(5e3,300*2**Math.min(A,4));A+=1,E=setTimeout(W,Y)},W=()=>{if(d||m||!U.length)return;const Y=U[R%U.length];R+=1;const q=new WebSocket(Y);vt.current=q,q.onopen=()=>{q.send(JSON.stringify({op:"IDENTIFY",d:{accessToken:r,deviceId:s}}))},q.onmessage=se=>{var fe,te,pe,he,je,On,As,$s;try{const ke=JSON.parse(se.data);if(ke.op==="HELLO"&&((fe=ke.d)!=null&&fe.heartbeat_interval)&&(Bt.current&&clearInterval(Bt.current),Bt.current=setInterval(()=>{var gn;((gn=vt.current)==null?void 0:gn.readyState)===WebSocket.OPEN&&vt.current.send(JSON.stringify({op:"HEARTBEAT"}))},ke.d.heartbeat_interval)),ke.op==="READY"&&(m=!0,y=!0,A=0,Co(!0),localStorage.setItem(Hg,Y),w(""),((te=vt.current)==null?void 0:te.readyState)===WebSocket.OPEN&&vt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:Jt,customStatus:null}}))),ke.op==="DISPATCH"&&ke.t==="PRESENCE_UPDATE"&&((pe=ke.d)!=null&&pe.userId)&&Bi(gn=>({...gn,[ke.d.userId]:{status:ke.d.status??"offline",customStatus:ke.d.customStatus??null,richPresence:ke.d.richPresence??null}})),ke.op==="DISPATCH"&&ke.t==="SOCIAL_DM_MESSAGE_CREATE"&&((he=ke.d)!=null&&he.threadId)&&((On=(je=ke.d)==null?void 0:je.message)!=null&&On.id)){const gn=ke.d.threadId,tn=ke.d.message;Nn(zo=>{const vn=[...zo],Xi=vn.findIndex(Hr=>Hr.id===gn),VS=(Hr=[])=>Hr.some(WS=>WS.id===tn.id);if(Xi>=0){const Hr=vn[Xi];return VS(Hr.messages||[])?zo:(vn[Xi]={...Hr,messages:[...Hr.messages||[],tn]},vn)}return[{id:gn,participantId:tn.authorId===(l==null?void 0:l.id)?"unknown":tn.authorId,name:tn.authorId===(l==null?void 0:l.id)?"Unknown":tn.author||"Unknown",messages:[tn]},...vn]}),tn.authorId&&tn.authorId!==(l==null?void 0:l.id)&&(ak(fh.current==="dnd"),dd({dmId:gn,at:Date.now()}))}if(ke.op==="DISPATCH"&&ke.t==="SOCIAL_DM_MESSAGE_DELETE"&&((As=ke.d)!=null&&As.threadId)&&(($s=ke.d)!=null&&$s.messageId)){const gn=ke.d.threadId,tn=ke.d.messageId;Nn(zo=>zo.map(vn=>vn.id===gn?{...vn,messages:(vn.messages||[]).filter(Xi=>Xi.id!==tn)}:vn))}}catch{}},q.onclose=()=>{d||(Co(!1),vt.current=null,Bt.current&&(clearInterval(Bt.current),Bt.current=null),m=!1,kd("VOICE_GATEWAY_CLOSED"),F(),w(y?"Gateway disconnected. Reconnecting...":"Gateway websocket unavailable. Check DNS/TLS or set VITE_CORE_GATEWAY_URL."))},q.onerror=()=>{}};return W(),()=>{d=!0,E&&clearTimeout(E),Co(!1),Bt.current&&clearInterval(Bt.current),Bt.current=null,vt.current&&vt.current.close(),vt.current=null}},[r,l==null?void 0:l.id]),b.useEffect(()=>{var s;!r||!(l!=null&&l.id)||((s=vt.current)==null?void 0:s.readyState)!==WebSocket.OPEN||vt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:Jt,customStatus:null}}))},[Jt,r,l==null?void 0:l.id]),b.useEffect(()=>{const s=O;if(!(s!=null&&s.baseUrl)||!(s!=null&&s.membershipToken)){if(Qi.current=[],Rt.current=!1,ut.current&&(clearInterval(ut.current),ut.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}return}if(ah[s.id]){if(Qi.current=[],Rt.current=!1,ut.current&&(clearInterval(ut.current),ut.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}return}const d=XE(ek(s.baseUrl,!0),Gg);if(Qi.current=d,!d.length)return;let m=!1,y=!1,E=!1,R=null,A=0,U=0;const F=()=>{if(m)return;const Y=Math.min(5e3,300*2**Math.min(U,4));U+=1,R=setTimeout(W,Y)},W=()=>{if(m||!d.length)return;const Y=d[A%d.length];A+=1;const q=new WebSocket(Y);$e.current=q,q.onopen=()=>{w(""),q.send(JSON.stringify({op:"IDENTIFY",d:{membershipToken:s.membershipToken}}))},q.onmessage=se=>{var fe,te,pe;try{const he=JSON.parse(se.data);if(DS(he),he.op==="HELLO"&&((fe=he.d)!=null&&fe.heartbeat_interval)){ut.current&&clearInterval(ut.current),ut.current=setInterval(()=>{var je;((je=$e.current)==null?void 0:je.readyState)===WebSocket.OPEN&&$e.current.send(JSON.stringify({op:"HEARTBEAT"}))},he.d.heartbeat_interval);return}if(he.op==="READY"){y=!0,E=!0,U=0,Rt.current=!0,localStorage.setItem(Gg,Y),activeGuildIdRef.current&&q.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:activeGuildIdRef.current}})),gd.current&&q.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:gd.current}}));return}if(he.op==="ERROR"&&((te=he.d)!=null&&te.error)){if(typeof he.d.error=="string"&&he.d.error.startsWith("VOICE_UPSTREAM_UNAVAILABLE")&&(s!=null&&s.id)){b_(je=>je[s.id]?je:{...je,[s.id]:!0}),w("Realtime voice gateway unavailable for this server. Falling back to REST voice controls.");try{q.close()}catch{}return}w(`Voice gateway error: ${he.d.error}`);return}he.op==="DISPATCH"&&typeof he.t=="string"&&((pe=Zt.current)==null||pe.handleGatewayDispatch(he.t,he.d).catch(()=>{}))}catch{}},q.onclose=()=>{m||(Rt.current=!1,ut.current&&(clearInterval(ut.current),ut.current=null),$e.current=null,y=!1,kd("VOICE_GATEWAY_CLOSED"),F(),w(E?"Server voice gateway disconnected. Reconnecting...":"Voice gateway unavailable. Check core gateway/proxy configuration."))},q.onerror=()=>{}};return W(),()=>{if(m=!0,R&&clearTimeout(R),Rt.current=!1,ut.current&&(clearInterval(ut.current),ut.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}}},[O==null?void 0:O.id,O==null?void 0:O.baseUrl,O==null?void 0:O.membershipToken,ah]),b.useEffect(()=>{if(!z||!Z)return;const s=$e.current;!s||s.readyState!==WebSocket.OPEN||!Rt.current||(s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:z}})),s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:Z}})))},[z,Z]),b.useEffect(()=>{var d;if(g!=="servers"||!z||!((d=L==null?void 0:L.channels)!=null&&d.length))return;const s=$e.current;if(!(!s||s.readyState!==WebSocket.OPEN||!Rt.current))for(const m of L.channels)!(m!=null&&m.id)||m.type!=="text"||s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:m.id}}))},[g,z,L==null?void 0:L.channels]),b.useEffect(()=>{j&&u_(s=>{if(!s[j])return s;const d={...s};return delete d[j],d})},[j]),b.useEffect(()=>{if(!r)return;const s=new Set;((L==null?void 0:L.members)||[]).forEach(y=>y.id&&s.add(y.id)),(In||[]).forEach(y=>y.id&&s.add(y.id));const d=[...s];if(d.length===0)return;const m=new URLSearchParams({userIds:d.join(",")});fetch(`${bn}/v1/presence?${m}`,{headers:{Authorization:`Bearer ${r}`}}).then(y=>y.ok?y.json():{}).then(y=>{y&&typeof y=="object"&&Bi(E=>({...E,...y}))}).catch(()=>{})},[r,L==null?void 0:L.members,In]),b.useEffect(()=>{const s=WE();if(!s)return;Oi(s),Pl(s),Mr(!0),ho("join"),xd(s),Br(r?es:di,{replace:!0})},[r]),b.useEffect(()=>{if(g!=="servers"||!O){P([]),g!=="servers"&&(H(null),Q([]));return}ie(O.baseUrl,"/v1/guilds",O.membershipToken).then(s=>{const d=s||[];if(P(d),!d.length){G(""),H(null);return}d.some(y=>y.id===z)||G(d[0].id)}).catch(s=>{P([]),H(null),w(`Workspace list failed: ${s.message}`)})},[O,z,g]),b.useEffect(()=>{if(g!=="servers"||!O||!z)return;let s=!1;const d=()=>ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken).then(y=>{var U;if(s)return;const E=y.channels||[];if(H(y),E.some(F=>F.id===Z&&F.type==="text"))return;const A=((U=E.find(F=>F.type==="text"))==null?void 0:U.id)||"";ae(A)}).catch(y=>{s||(H(null),ae(""),Q([]),w(`Workspace state failed: ${y.message}`))});d();const m=window.setInterval(d,3e3);return()=>{s=!0,window.clearInterval(m)}},[O,z,g,Z]),b.useEffect(()=>{g!=="dms"||!ye||!r||re(`/v1/social/dms/${ye}/messages`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{const d=s.messages||[];Nn(m=>m.map(y=>y.id===ye?{...y,messages:d}:y))}).catch(()=>{})},[ye,g,r]),b.useEffect(()=>{if(g==="dms"){if(!$t.length){Pn("");return}(!ye||!$t.some(s=>s.id===ye))&&Pn($t[0].id)}},[g,$t,ye]),b.useEffect(()=>{if(!Wi)return;const s=setTimeout(()=>dd(null),4e3);return()=>clearTimeout(s)},[Wi]),b.useEffect(()=>{var m,y,E;const s=Vr&&Sd&&!!Fe&&!!Rt.current&&((m=$e.current)==null?void 0:m.readyState)===WebSocket.OPEN;if(!Vr||!Sd||!Fe||jr||Dr||!((y=navigator.mediaDevices)!=null&&y.getUserMedia)||!s){const R=hd.current;R.timer&&clearInterval(R.timer),R.timer=null,R.stream&&R.stream!==((E=Zt.current)==null?void 0:E.getLocalStream())&&R.stream.getTracks().forEach(A=>A.stop()),R.stream=null,R.audioCtx&&R.audioCtx.close().catch(()=>{}),R.audioCtx=null,R.analyser=null,R.lastSpeaking=!1,Fe&&(l!=null&&l.id)&&sh(A=>({...A,[Fe]:{...A[Fe]||{},[l.id]:!1}})),Vr&&Fe&&s&&Fo("VOICE_SPEAKING",{guildId:Fe,channelId:wt,speaking:!1}).catch(()=>{});return}let d=!1;return(async()=>{var R;try{const A=((R=Zt.current)==null?void 0:R.getLocalStream())||await navigator.mediaDevices.getUserMedia({audio:Dn?{deviceId:{exact:Dn}}:!0});if(d){A.getTracks().forEach(se=>se.stop());return}const U=new window.AudioContext,F=U.createMediaStreamSource(A),W=U.createAnalyser();W.fftSize=1024,F.connect(W);const Y=hd.current;Y.stream=A,Y.audioCtx=U,Y.analyser=W,Y.lastSpeaking=!1;const q=new Uint8Array(W.fftSize);Y.timer=setInterval(()=>{var he;W.getByteTimeDomainData(q);let se=0;for(let je=0;je<q.length;je+=1){const On=(q[je]-128)/128;se+=On*On}const fe=Math.sqrt(se/q.length),te=.01+(100-Math.max(0,Math.min(100,Es)))/100*.03,pe=fe>te;pe!==Y.lastSpeaking&&(Y.lastSpeaking=pe,Fe&&(l!=null&&l.id)&&sh(je=>({...je,[Fe]:{...je[Fe]||{},[l.id]:pe}})),Vr&&Fe&&Rt.current&&((he=$e.current)==null?void 0:he.readyState)===WebSocket.OPEN&&Fo("VOICE_SPEAKING",{guildId:Fe,channelId:wt,speaking:pe}).catch(()=>{}))},150)}catch{w("Mic speaking detection unavailable. Check microphone permissions.")}})(),()=>{var A;d=!0;const R=hd.current;R.timer&&clearInterval(R.timer),R.timer=null,R.stream&&R.stream!==((A=Zt.current)==null?void 0:A.getLocalStream())&&R.stream.getTracks().forEach(U=>U.stop()),R.stream=null,R.audioCtx&&R.audioCtx.close().catch(()=>{}),R.audioCtx=null,R.analyser=null,R.lastSpeaking=!1}},[Vr,Sd,Fe,wt,jr,Dr,Es,Dn,l==null?void 0:l.id]),b.useEffect(()=>{localStorage.setItem(zg,String(lo))},[lo]),b.useEffect(()=>{localStorage.setItem(Bg,String(Es))},[Es]),b.useEffect(()=>{localStorage.setItem(Vg,Dn||"")},[Dn]),b.useEffect(()=>{localStorage.setItem(Wg,rr||"")},[rr]),b.useEffect(()=>{var s;(s=Zt.current)==null||s.setMuted(jr)},[jr]),b.useEffect(()=>{var s;(s=Zt.current)==null||s.setDeafened(Dr)},[Dr]),b.useEffect(()=>{var s;(s=Zt.current)==null||s.setAudioOutputDevice(rr)},[rr]),b.useEffect(()=>{var m;if(Re!=="voice"||!Fi||!((m=navigator.mediaDevices)!=null&&m.enumerateDevices))return;let s=!1;return(async()=>{var y,E;try{try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch{}const R=await navigator.mediaDevices.enumerateDevices();if(s)return;const A=R.filter(F=>F.kind==="audioinput"),U=R.filter(F=>F.kind==="audiooutput");Xw(A),e_(U),!Dn&&((y=A[0])!=null&&y.deviceId)&&Df(A[0].deviceId),!rr&&((E=U[0])!=null&&E.deviceId)&&Lf(U[0].deviceId)}catch{s||w("Could not load audio devices. Check browser permissions.")}})(),()=>{s=!0}},[Re,Fi,Dn,rr]),b.useEffect(()=>{if(!(l!=null&&l.id))return;let s="",d="";for(const[m,y]of Object.entries(Ur||{})){const E=y==null?void 0:y[l.id];if(E!=null&&E.channelId){s=m,d=E.channelId;break}}if(!d){const m=ar.find(y=>y.userId===l.id);m!=null&&m.channelId&&(s=z||Fe||"",d=m.channelId)}co(m=>d?m.guildId===s&&m.channelId===d?m:{guildId:s,channelId:d}:m.guildId&&m.guildId!==z||!m.guildId&&!m.channelId?m:{guildId:"",channelId:""})},[ar,Ur,l==null?void 0:l.id,z,Fe]),b.useEffect(()=>{!r||g!=="friends"&&g!=="dms"||xh(r).catch(()=>{})},[r,g]),gd.current=Z,b.useEffect(()=>{if(g!=="servers"||!O||!Z){g!=="servers"&&Q([]);return}let s=!1;const d=()=>ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken).then(y=>{s||(w(""),Q((y.messages||[]).slice().reverse()))}).catch(y=>{var E,R;if(!s){if((E=y==null?void 0:y.message)!=null&&E.startsWith("HTTP_403")){Q([]),w("You no longer have access to that channel."),ae("");return}if((R=y==null?void 0:y.message)!=null&&R.startsWith("HTTP_404")){Q([]),w("That channel no longer exists. Switching to an available channel."),ae("");return}w(`Message fetch failed: ${y.message}`)}});d();const m=window.setInterval(d,2e3);return()=>{s=!0,window.clearInterval(m)}},[O,Z,g]),b.useEffect(()=>{to([]),Ns.current&&(Ns.current.value="")},[j,Z]),b.useEffect(()=>{if(g!=="servers"||!r||!z)return;let s=!1;const d=()=>{const y=Array.from(new Set(((L==null?void 0:L.members)||[]).map(R=>R==null?void 0:R.id).filter(Boolean)));if(!y.length)return;const E=new URLSearchParams({userIds:y.join(",")});fetch(`${bn}/v1/presence?${E}`,{headers:{Authorization:`Bearer ${r}`}}).then(R=>R.ok?R.json():{}).then(R=>{s||!R||typeof R!="object"||Bi(A=>({...A,...R}))}).catch(()=>{})};d();const m=window.setInterval(d,3e3);return()=>{s=!0,window.clearInterval(m)}},[g,r,z,L==null?void 0:L.members]),b.useEffect(()=>{const s=new URLSearchParams(window.location.search||""),d=s.get("verifyEmailToken");d&&(cc()===Qn&&Br(di,{replace:!0}),w("Verifying your email..."),re("/v1/auth/verify-email",{method:"POST",body:JSON.stringify({token:d})}).then(()=>{h("login"),w("Email verified. You can now log in.")}).catch(m=>{w(`Email verification failed: ${m.message}`)}).finally(()=>{s.delete("verifyEmailToken");const m=s.toString(),y=`${window.location.pathname}${m?`?${m}`:""}${window.location.hash||""}`;window.history.replaceState({},"",y)}))},[]);async function $_(s){s.preventDefault(),w("Authenticating...");try{if(f==="register"){await re("/v1/auth/register",{method:"POST",body:JSON.stringify({email:_,username:S,password:M})}),v(_.trim()),h("login"),V(""),w("Account created. Check your email for a verification link before logging in.");return}const d=await re("/v1/auth/login",{method:"POST",body:JSON.stringify({email:_,password:M})});i(d.accessToken),o(d.refreshToken||""),u(d.user),v(""),w("Authenticated.")}catch(d){if((d==null?void 0:d.message)==="EMAIL_NOT_VERIFIED"){v(_.trim()),w("Auth failed: EMAIL_NOT_VERIFIED. Use the resend button below if needed.");return}if((d==null?void 0:d.message)==="SMTP_NOT_CONFIGURED"){w("Auth failed: SMTP is not configured on the API server, so verification emails cannot be sent yet.");return}if((d==null?void 0:d.message)==="SMTP_AUTH_FAILED"){w("Auth failed: SMTP auth failed. Check Zoho SMTP username/app password.");return}if((d==null?void 0:d.message)==="SMTP_CONNECTION_FAILED"){w("Auth failed: SMTP connection failed. Check server network + SMTP host/port/TLS.");return}w(`Auth failed: ${d.message}`)}}async function F_(){const s=(B||_||"").trim();if(!s){w("Enter your email first, then resend verification.");return}w("Sending verification email...");try{await re("/v1/auth/resend-verification",{method:"POST",body:JSON.stringify({email:s})}),v(s),w("If the account exists and is unverified, a new verification email has been sent.")}catch(d){if((d==null?void 0:d.message)==="SMTP_NOT_CONFIGURED"){w("Resend failed: SMTP is not configured on the API server. Set SMTP_* (or Zoho SMTP envs) and restart backend.");return}if((d==null?void 0:d.message)==="SMTP_AUTH_FAILED"){w("Resend failed: SMTP auth failed. Check Zoho username and app password.");return}if((d==null?void 0:d.message)==="SMTP_CONNECTION_FAILED"){w("Resend failed: could not connect to SMTP server. Check host/port/TLS/firewall.");return}w(`Resend failed: ${d.message}`)}}async function U_(s){const m=s.trim().replace(/^\//,"").trim(),[y,...E]=m.split(/\s+/);if(!y)return!1;const R=bo.find(W=>W.name===y);if(!R)return w(`Unknown command: /${y}`),!0;const A=Array.isArray(R.options)?R.options:[],U=rk(E.join(" ")),F={};try{A.forEach((W,Y)=>{const q=U[Y];if((q==null||q==="")&&W.required)throw new Error(`Missing required option: ${W.name}`);q==null||q===""||(F[W.name]=sk(q,W.type||"string"))})}catch(W){return w(`/${y}: ${W.message}`),!0}try{le("");const W=await ie(O.baseUrl,`/v1/extensions/commands/${encodeURIComponent(y)}/execute`,O.membershipToken,{method:"POST",body:JSON.stringify({args:F})}),Y=W==null?void 0:W.result;if(Y&&typeof Y=="object"&&(Y.content||Array.isArray(Y.embeds))){await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken,{method:"POST",body:JSON.stringify({content:String(Y.content||`/${y}`),embeds:Array.isArray(Y.embeds)?Y.embeds:[]})});const q=await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken);Q((q.messages||[]).slice().reverse()),w(`Executed /${y}`)}else w(`Executed /${y}${(W==null?void 0:W.result)!=null?`  ${typeof W.result=="string"?W.result:JSON.stringify(W.result)}`:""}`)}catch(W){le(s),w(`Command failed: ${W.message}`)}return!0}async function z_(s){if(!(!O||!z||!Z||!s))try{const d=new FormData;d.append("guildId",z),d.append("channelId",Z),d.append("file",s,s.name||"upload.bin");const m=await fetch(`${O.baseUrl}/v1/attachments/upload`,{method:"POST",headers:{Authorization:`Bearer ${O.membershipToken}`},body:d});if(!m.ok){const E=await m.json().catch(()=>({}));throw new Error(E.error||`HTTP_${m.status}`)}const y=await m.json();to(E=>[...E,y]),w(`Attached ${y.fileName||"file"} (${y.tier||"default"} tier).`)}catch(d){w(`Attachment upload failed: ${d.message}`)}}async function Eh(){if(!O||!Z||!X.trim()&&ji.length===0)return;if(X.trimStart().startsWith("/")){await U_(X);return}const s=`${zi?`> replying to ${zi.author}: ${zi.content}
`:""}${X.trim()}`;try{le(""),Ge(!1),await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken,{method:"POST",body:JSON.stringify({content:s||"Attachment",attachmentIds:ji.map(m=>m.attachmentId||m.id).filter(Boolean)})});const d=await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken);Q((d.messages||[]).slice().reverse()),ql(null),to([]),Ns.current&&(Ns.current.value="")}catch(d){le(s),w(`Send failed: ${d.message}`)}}async function kh(){if(!Ee||!ro.trim())return;const s=ro.trim();Dl("");try{await re(`/v1/social/dms/${Ee.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({content:s})});const d=await re(`/v1/social/dms/${Ee.id}/messages`,{headers:{Authorization:`Bearer ${r}`}});Nn(m=>m.map(y=>y.id===Ee.id?{...y,messages:d.messages||[]}:y))}catch(d){Dl(s),w(`DM send failed: ${d.message}`)}}async function B_(){const s=vf.trim();if(s)try{const d=await re("/v1/social/friends",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({username:s})});if(d.friend&&d.threadId){no(E=>[d.friend,...E.filter(R=>R.id!==d.friend.id)]);const y={id:d.threadId,participantId:d.friend.id,name:d.friend.username,messages:[]};Nn(E=>[y,...E.filter(R=>R.id!==y.id)]),Pn(y.id),w(`You're now connected with ${d.friend.username}.`)}else w("Friend request sent.");const m=await re("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}});zl({incoming:m.incoming||[],outgoing:m.outgoing||[]}),yf(""),Di("requests")}catch(d){w(`Add friend failed: ${d.message}`)}}async function Th(s,d){try{await re(`/v1/social/requests/${s}/${d}`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});const[m,y]=await Promise.all([re("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}}),re("/v1/social/friends",{headers:{Authorization:`Bearer ${r}`}})]);zl({incoming:m.incoming||[],outgoing:m.outgoing||[]}),no(y.friends||[]),w(d==="accept"?"Friend request accepted.":"Friend request declined.")}catch(m){w(`Request update failed: ${m.message}`)}}async function V_(){if(r)try{const s=await re("/v1/auth/sessions",{headers:{Authorization:`Bearer ${r}`}});m_(s.sessions||[])}catch(s){w(`Could not load sessions: ${s.message}`)}}async function Rh(){if(r){Vf(!0);try{const s=await re("/v1/billing/boost",{headers:{Authorization:`Bearer ${r}`}});c_(s)}catch(s){w(`Could not load billing status: ${s.message}`)}finally{Vf(!1)}}}async function W_(){if(r)try{const s=await re("/v1/billing/boost/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not start checkout: ${s.message}`)}}async function H_(){if(r)try{const s=await re("/v1/billing/boost/portal",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not open billing portal: ${s.message}`)}}function G_(s=32){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let m="";for(let y=0;y<s;y++)m+=d.charAt(Math.floor(Math.random()*d.length));return m}function Q_(s=8){const d=[];for(let m=0;m<s;m++){let y="";for(let E=0;E<4;E++)y+=Math.floor(Math.random()*1e4).toString().padStart(4,"0"),E<3&&(y+="-");d.push(y)}return d}function K_(){const s=G_(32),d=Q_(8);sd(s),go(d),vo(!0),ad(!1),id("");const m="OpenCom",y=(l==null?void 0:l.username)||"user",E=`otpauth://totp/${m}:${y}?secret=${s}&issuer=${m}`,R=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(E)}`;w_(R),w("2FA setup initiated. Scan the QR code with your authenticator app.")}function Y_(s,d){if(!s||!d)return!1;const m=s.replace(/\s/g,"").slice(0,6);if(!/^\d{6}$/.test(m))return!1;if(Jf.includes(m))return w("Backup code verified! Removing code from backups."),go(y=>y.filter(E=>E!==m)),!0;for(let y=-1;y<=1;y++){const E=Math.floor(Date.now()/3e4)+y;if(J_(d,E)===m)return!0}return!1}function J_(s,d){const m=q_(s),y=new ArrayBuffer(8);return new DataView(y).setBigInt64(0,BigInt(d),!1),X_(m,y)}function q_(s){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let m="";for(let E=0;E<s.length;E++){const R=d.indexOf(s[E]);R<0||(m+=R.toString(2).padStart(5,"0"))}const y=new Uint8Array(Math.floor(m.length/8));for(let E=0;E<y.length;E++)y[E]=parseInt(m.slice(E*8,(E+1)*8),2);return y}function X_(s,d){let y=new Uint8Array(64);s.length>64?(y=Cd(s),y=new Uint8Array(64).map((se,fe)=>fe<y.length?y[fe]:0)):y.set(s);const E=new Uint8Array(64),R=new Uint8Array(64);for(let se=0;se<64;se++)E[se]=y[se]^92,R[se]=y[se]^54;const A=new Uint8Array(R.length+d.byteLength);A.set(R),A.set(new Uint8Array(d),R.length);const U=Cd(A.buffer),F=new Uint8Array(E.length+U.length);F.set(E),F.set(U,E.length);const W=Cd(F.buffer),Y=W[W.length-1]&15;return(((W[Y]&127)<<24|(W[Y+1]&255)<<16|(W[Y+2]&255)<<8|W[Y+3]&255)%1e6).toString().padStart(6,"0")}function Cd(s){let d=new Uint8Array(s);const m=Array.from(d).map(U=>String.fromCharCode(U)).join(""),y=[1732584193,4023233417,2562383102,271733878,3285377520],E=m.length*8;let R=m.slice(0);for(R+="";R.length*8%512!==448;)R+="\0";for(let U=7;U>=0;U--)R+=String.fromCharCode(E>>>U*8&255);for(let U=0;U<R.length;U+=64){const F=Array(80);for(let te=0;te<16;te++)F[te]=R.charCodeAt(U+te*4)<<24|R.charCodeAt(U+te*4+1)<<16|R.charCodeAt(U+te*4+2)<<8|R.charCodeAt(U+te*4+3);for(let te=16;te<80;te++)F[te]=(F[te-3]^F[te-8]^F[te-14]^F[te-16])<<1|(F[te-3]^F[te-8]^F[te-14]^F[te-16])>>>31;let[W,Y,q,se,fe]=y;for(let te=0;te<80;te++){let pe,he;te<20?(pe=Y&q|~Y&se,he=1518500249):te<40?(pe=Y^q^se,he=1859775393):te<60?(pe=Y&q|Y&se|q&se,he=2400959708):(pe=Y^q^se,he=3395469782);const je=(W<<5|W>>>27)+pe+fe+he+F[te]>>>0;fe=se,se=q,q=Y<<30|Y>>>2,Y=W,W=je}y[0]=y[0]+W>>>0,y[1]=y[1]+Y>>>0,y[2]=y[2]+q>>>0,y[3]=y[3]+se>>>0,y[4]=y[4]+fe>>>0}const A=new Uint8Array(20);for(let U=0;U<5;U++)A[U*4]=y[U]>>>24&255,A[U*4+1]=y[U]>>>16&255,A[U*4+2]=y[U]>>>8&255,A[U*4+3]=y[U]&255;return A}function Z_(){if(!Y_(qf,y_)){w("Invalid token. Please check your authenticator app.");return}eh(s=>({...s,twoFactorEnabled:!0})),ad(!0),w("2FA enabled successfully! Your backup codes have been saved."),vo(!1)}function eS(){window.confirm("Are you sure? You will lose 2FA protection.")&&(eh(s=>({...s,twoFactorEnabled:!1})),sd(""),go([]),ad(!1),vo(!1),w("2FA has been disabled."))}async function Oo(s){const d=$t.find(m=>m.participantId===s.id||m.name===s.username);if(d){Pn(d.id),C("dms");return}try{const y=(await re("/v1/social/dms/open",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({friendId:s.id})})).threadId;Nn(E=>E.find(A=>A.id===y)?E:[{id:y,participantId:s.id,name:s.username,messages:[]},...E]),Pn(y),C("dms")}catch(m){w(`Open DM failed: ${m.message}`)}}async function tS(){try{if(await re("/v1/me/profile",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({displayName:jn.displayName||null,bio:jn.bio||null,pfpUrl:jn.pfpUrl||null,bannerUrl:jn.bannerUrl||null})}),l!=null&&l.id){const s=await re(`/v1/users/${l.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});Li(s),tr({displayName:s.displayName??"",bio:s.bio??"",pfpUrl:s.pfpUrl??"",bannerUrl:s.bannerUrl??""})}else Li(s=>({...s,...jn}));w("Profile updated.")}catch(s){const d=(s==null?void 0:s.message)||"";d.includes("INVALID_IMAGE")?w("Invalid image. Use PNG, JPG, GIF, or WebP under 4MB."):w(`Profile update failed: ${d}`)}}async function nS(){if(!r)return;const s=ik(Ft);if(!s.name&&!s.details&&!s.state&&!s.largeImageUrl&&!s.smallImageUrl&&!s.buttons){w("Add at least one rich presence field before saving.");return}try{await re("/v1/presence/rpc",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({activity:s})}),l!=null&&l.id&&Bi(d=>{var m,y;return{...d,[l.id]:{...d[l.id]||{},status:((m=d[l.id])==null?void 0:m.status)||Jt,customStatus:((y=d[l.id])==null?void 0:y.customStatus)??null,richPresence:s}}}),w("Rich presence updated.")}catch(d){w(`Rich presence update failed: ${d.message}`)}}async function rS(){if(r)try{await re("/v1/presence/rpc",{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),l!=null&&l.id&&Bi(s=>{var d,m;return{...s,[l.id]:{...s[l.id]||{},status:((d=s[l.id])==null?void 0:d.status)||Jt,customStatus:((m=s[l.id])==null?void 0:m.customStatus)??null,richPresence:null}}}),Et(ev(null)),w("Rich presence cleared.")}catch(s){w(`Clear rich presence failed: ${s.message}`)}}async function sS(){var s,d,m;if(!(!O||!Se))try{await re(`/v1/servers/${O.id}/profile`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:((s=nr.name)==null?void 0:s.trim())||void 0,logoUrl:(d=nr.logoUrl)!=null&&d.trim()?nr.logoUrl.trim():null,bannerUrl:(m=nr.bannerUrl)!=null&&m.trim()?nr.bannerUrl.trim():null})});const E=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];T(E),w("Server profile updated.")}catch(y){w(`Server profile update failed: ${y.message}`)}}async function Ih(){if(!(!Ss.trim()||!Cs.trim()||!xs.trim()))try{await re("/v1/servers",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:Ss.trim(),baseUrl:Cs.trim(),logoUrl:xs.trim(),bannerUrl:Al.trim()||null})}),Ll(""),Ml("https://"),Ol(""),$l(""),w("Server provider added.");const s=await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}});T(s.servers||[]),Mr(!1)}catch(s){w(`Add server failed: ${s.message}`)}}function Nh(s){j&&x_(d=>{const y={...d[j]||{mode:"core",customUrl:""},...s};return{...d,[j]:y}})}async function iS(){if(!(O!=null&&O.baseUrl)||!(O!=null&&O.membershipToken)||!(Ai!=null&&Ai.trim())){w("Select a server and enter a workspace name.");return}try{const s=await ie(O.baseUrl,"/v1/guilds",O.membershipToken,{method:"POST",body:JSON.stringify({name:Ai.trim(),createDefaultVoice:!0})});Tf(""),w("Workspace created.");const d=await ie(O.baseUrl,"/v1/guilds",O.membershipToken),m=Array.isArray(d)?d:[];P(m),s!=null&&s.guildId&&m.length&&G(s.guildId)}catch(s){w(`Create workspace failed: ${s.message}`)}}async function aS(){if(Fl)try{const s={serverId:Fl,code:Sf.trim()||void 0,permanent:xf},d=await re("/v1/invites",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify(s)});zw(d.code),Bw(d.joinUrl||""),Cf(""),w("Invite code generated.")}catch(s){w(`Invite failed: ${s.message}`)}}async function xd(s=null){const d=ap(s??bs??"");if(!d){io(null),w("Invalid invite code/link.");return}try{const m=await re(`/v1/invites/${d}`);io(m),Oi(d),Pl(d),w("Invite preview loaded.")}catch(m){io(null),w(`Invite lookup failed: ${m.message}`)}}async function Ph(s=null){const d=ap(s||bs||"");if(d)try{const m=await re(`/v1/invites/${d}/join`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({accept:!0})});Oi(""),io(null),Pl(""),w("Joined server from invite.");const E=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];T(E);const R=m==null?void 0:m.serverId;R&&E.some(A=>A.id===R)?$(R):E.length&&$(E[0].id),Mr(!1)}catch(m){w(`Join failed: ${m.message}`)}}const jh=1,Ao=2;function Dh(s=""){const d=s.split(",").map(A=>A.trim()).filter(Boolean);if(!d.length)return[];const m=((L==null?void 0:L.roles)||[]).filter(A=>!A.is_everyone),y=new Map(m.map(A=>[String(A.id).toLowerCase(),A.id])),E=new Map(m.map(A=>[String(A.name||"").toLowerCase(),A.id])),R=[];for(const A of d){const U=A.toLowerCase(),F=y.get(U)||E.get(U);F&&!R.includes(F)&&R.push(F)}return R}async function Lh(s,d=[],m=O,y=yt){if(!m||!y||!s)return;const E=((L==null?void 0:L.roles)||[]).find(R=>R.is_everyone);if(!E)throw new Error("EVERYONE_ROLE_NOT_FOUND");await ie(m.baseUrl,`/v1/channels/${s}/overwrites`,m.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:E.id,allow:"0",deny:String(jh)})});for(const R of d)await ie(m.baseUrl,`/v1/channels/${s}/overwrites`,m.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:R,allow:String(jh),deny:"0"})})}async function Mh({server:s=O,guildId:d=yt,name:m,type:y="text",parentId:E="",privateRoleIds:R=null}){if(!s||!d||!(m!=null&&m.trim()))return null;const A={name:m.trim(),type:y};y!=="category"&&E&&(A.parentId=E);const U=await ie(s.baseUrl,`/v1/guilds/${d}/channels`,s.membershipToken,{method:"POST",body:JSON.stringify(A)}),F=U==null?void 0:U.channelId;if(F&&Array.isArray(R)&&await Lh(F,R,s,d),s.id===j&&d===yt){const W=await ie(s.baseUrl,`/v1/guilds/${d}/state`,s.membershipToken);H(W)}return F}async function Ms({server:s=O,guildId:d=yt,fixedType:m="",fixedParentId:y=""}={}){if(!s||!d){w("No active guild selected yet. Open a channel first, then try again.");return}const E=m||(window.prompt("Channel type: text, voice, or category","text")||"").trim().toLowerCase();if(!["text","voice","category"].includes(E)){w("Invalid channel type.");return}const R=E==="category"?"New Category":`new-${E}`,A=(window.prompt(`Name for the new ${E}:`,R)||"").trim();if(!A)return;let U=y||"";if(E!=="category"&&!y){const W=(window.prompt("Optional category name/ID (leave blank for none):","")||"").trim();if(W){const Y=(qi||[]).find(q=>q.id===W||String(q.name||"").toLowerCase()===W.toLowerCase());if(!Y){w("Category not found.");return}U=Y.id}}let F=null;if(E==="category"&&window.confirm("Make this category private?")){const Y=((L==null?void 0:L.roles)||[]).filter(se=>!se.is_everyone).map(se=>se.name).join(", "),q=window.prompt(`Allowed roles (comma-separated names or IDs).
Available: ${Y}`,"")||"";F=Dh(q)}try{await Mh({server:s,guildId:d,name:A,type:E,parentId:U,privateRoleIds:F}),w(`${E==="category"?"Category":"Channel"} created.`)}catch(W){w(`Create channel failed: ${W.message}`)}}async function oS(){if(!(!O||!yt||!Ul.trim()))try{await Mh({server:O,guildId:yt,name:Ul,type:ao,parentId:ao!=="category"?Ef:""}),bf(""),kf(""),w("Channel created.")}catch(s){w(`Create channel failed: ${s.message}`)}}async function cS(){if(!(!O||!z||!Yt.trim()||!er.trim()))try{await ie(O.baseUrl,`/v1/guilds/${z}/emotes`,O.membershipToken,{method:"POST",body:JSON.stringify({name:Yt.trim().toLowerCase(),imageUrl:er.trim()})}),Ae(""),mf("");const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s),w("Custom emote created.")}catch(s){w(`Create emote failed: ${s.message}`)}}async function lS(s){if(!(!O||!z||!s))try{await ie(O.baseUrl,`/v1/guilds/${z}/emotes/${s}`,O.membershipToken,{method:"DELETE"});const d=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(d),w("Custom emote removed.")}catch(d){w(`Remove emote failed: ${d.message}`)}}async function Oh(s,d){if(!(!O||!z))try{await ie(O.baseUrl,`/v1/channels/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({position:d})});const m=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(m)}catch(m){w(`Move channel failed: ${m.message}`)}}async function dS(s,d,m){var fe;const y=m.findIndex(te=>te.id===s),E=m.findIndex(te=>te.id===d);if(y===-1||E===-1||y===E)return;const R=[...m],[A]=R.splice(y,1);R.splice(E,0,A);const U=(L==null?void 0:L.channels)||[],F=new Map;for(const te of U){const pe=te.parent_id||"__uncat__";F.has(pe)||F.set(pe,[]),F.get(pe).push(te)}const W=((fe=m[0])==null?void 0:fe.parent_id)??"__uncat__",Y=[],q=[...F.keys()].sort((te,pe)=>{const he=F.get(te),je=F.get(pe),On=Math.min(...he.map($s=>$s.position??0)),As=Math.min(...je.map($s=>$s.position??0));return On-As});for(const te of q){const pe=F.get(te),je=te===W?R:pe.sort((On,As)=>(On.position??0)-(As.position??0));Y.push(...je)}const se=Y.map((te,pe)=>(te.position??-1)!==pe?Oh(te.id,pe):Promise.resolve());await Promise.all(se),od(null)}async function uS(s,d){const m=[...qi||[]],y=m.findIndex(U=>U.id===s),E=m.findIndex(U=>U.id===d);if(y===-1||E===-1||y===E)return;const R=[...m],[A]=R.splice(y,1);R.splice(E,0,A);try{await Promise.all(R.map((U,F)=>Oh(U.id,F*100))),cd(null)}catch(U){w(`Move category failed: ${U.message}`)}}async function pS(s,d,m){if(!(!O||!s||!d))try{const y=((L==null?void 0:L.roles)||[]).find(R=>R.is_everyone);if(m)y&&await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:y.id,allow:"0",deny:String(Ao)})}),await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:d,allow:String(Ao),deny:"0"})});else{await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:d})});const R=((L==null?void 0:L.overwrites)||[]).filter(A=>A.channel_id===s&&A.target_type==="role"&&A.target_id!==d&&parseInt(A.allow,10)&Ao);y&&R.length===0&&await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:y.id})})}const E=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(E)}catch(y){w(`Permission update failed: ${y.message}`)}}function fS(s,d){const m=((L==null?void 0:L.overwrites)||[]).find(y=>y.channel_id===s&&y.target_type==="role"&&y.target_id===d);return m?(parseInt(m.allow,10)&Ao)!==0:!1}async function hS(){if(!(!O||!z||!Ql.trim()))try{await ie(O.baseUrl,`/v1/guilds/${z}/roles`,O.membershipToken,{method:"POST",body:JSON.stringify({name:Ql.trim(),permissions:"0"})}),Af("");const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s),w("Role created.")}catch(s){w(`Create role failed: ${s.message}`)}}async function mS(){if(!(!O||!z||!Yl||!Kl))try{await ie(O.baseUrl,`/v1/guilds/${z}/members/${Yl}/roles/${Kl}`,O.membershipToken,{method:"PUT",body:"{}"}),w("Role assigned.")}catch(s){w(`Assign role failed: ${s.message}`)}}async function Ah(){if(!O||!z)return;const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s)}async function bd(s){if(!O||!z||!s||!Ji||ks)return;const d=st.find(y=>y.id===s),m=(d==null?void 0:d.username)||s;if(window.confirm(`Kick ${m}? They can rejoin with an invite.`)){Ts(!0);try{await ie(O.baseUrl,`/v1/guilds/${z}/members/${s}/kick`,O.membershipToken,{method:"POST",body:"{}"}),await Ah(),(ce==null?void 0:ce.id)===s&&$r(null),w(`Kicked ${m}.`)}catch(y){w(`Kick failed: ${y.message}`)}finally{Ts(!1)}}}async function Ed(s,d=""){if(!O||!z||!s||!ir||ks)return;const m=st.find(E=>E.id===s),y=(m==null?void 0:m.username)||s;if(window.confirm(`Ban ${y}? This removes them and blocks rejoin until unbanned.`)){Ts(!0);try{const E={};d.trim()&&(E.reason=d.trim().slice(0,256)),await ie(O.baseUrl,`/v1/guilds/${z}/members/${s}/ban`,O.membershipToken,{method:"POST",body:JSON.stringify(E)}),await Ah(),(ce==null?void 0:ce.id)===s&&$r(null),w(`Banned ${y}.`)}catch(E){w(`Ban failed: ${E.message}`)}finally{Ts(!1)}}}async function gS(s){if(!(!O||!z||!s||!ir||ks)){Ts(!0);try{await ie(O.baseUrl,`/v1/guilds/${z}/bans/${s}`,O.membershipToken,{method:"DELETE"}),w(`Unbanned ${s}.`),Uf("")}catch(d){w(`Unban failed: ${d.message}`)}finally{Ts(!1)}}}async function $h(s,{color:d,position:m}){if(!(!O||!s))try{const y={};if(d!==void 0&&(y.color=typeof d=="string"&&d.startsWith("#")?parseInt(d.slice(1),16):d),m!==void 0&&(y.position=m),Object.keys(y).length===0)return;await ie(O.baseUrl,`/v1/roles/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify(y)});const E=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(E),w("Role updated.")}catch(y){w(`Update role failed: ${y.message}`)}}function vS(s){s.preventDefault(),vd.current={x:s.clientX-fo.x,y:s.clientY-fo.y},Bf(!0)}function yS(s){Qw(d=>({...d,[s]:!d[s]}))}function wS(s,d){s.preventDefault(),zt(null),Tt(null),qt(null),Xt(null),nt({server:d,x:s.clientX,y:s.clientY})}function _S(s,d){s.preventDefault(),nt(null),zt(null),Tt(null),Xt(null),qt({channel:d,x:s.clientX,y:s.clientY})}function SS(s,d){s.preventDefault(),nt(null),zt(null),Tt(null),qt(null),Xt({category:d,x:s.clientX,y:s.clientY})}async function CS(s,d){if(!O||!yt)return;const m=(window.prompt("Channel name:",d||"")||"").trim();!m||m===d||await ie(O.baseUrl,`/v1/channels/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({name:m})})}async function xS(s){if(!O||!yt||!s)return;const d=((L==null?void 0:L.roles)||[]).filter(E=>!E.is_everyone).map(E=>E.name).join(", "),m=window.prompt(`Visible to roles (comma-separated names or IDs). Leave blank to keep private for admins only.
Available: ${d}`,"");if(m==null)return;const y=Dh(m);await Lh(s,y,O,yt)}async function $o(s){if(!(!s||!Se||!O||!yt))try{await CS(s.id,s.name),window.confirm("Configure visibility (private roles) for this channel/category?")&&await xS(s.id);const d=await ie(O.baseUrl,`/v1/guilds/${yt}/state`,O.membershipToken);H(d),w("Channel settings updated.")}catch(d){w(`Update channel failed: ${d.message}`)}finally{qt(null),Xt(null)}}async function Fh(s){if(!s||!Se||!O||!yt)return;const d=s.type==="category"?"category":"channel";if(window.confirm(`Delete ${d} "${s.name}"?`))try{if(s.type==="category"){const y=((L==null?void 0:L.channels)||[]).filter(E=>E.parent_id===s.id);for(const E of y)await ie(O.baseUrl,`/v1/channels/${E.id}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({parentId:null})})}await ie(O.baseUrl,`/v1/channels/${s.id}`,O.membershipToken,{method:"DELETE"}),Z===s.id&&ae("");const m=await ie(O.baseUrl,`/v1/guilds/${yt}/state`,O.membershipToken);H(m),w(`${d[0].toUpperCase()}${d.slice(1)} deleted.`)}catch(m){w(`Delete channel failed: ${m.message}`)}finally{qt(null),Xt(null)}}async function bS(s){try{await navigator.clipboard.writeText(s),w("Server ID copied.")}catch{w("Could not copy server ID.")}nt(null)}function ES(s){C("servers"),$(s),nt(null)}async function Uh(s,d){const m=x.findIndex(A=>A.id===s);if(m<0)return;const y=d==="up"?m-1:m+1;if(y<0||y>=x.length)return;const E=x.slice(),[R]=E.splice(m,1);E.splice(y,0,R),T(E),nt(null);try{await re("/v1/servers/reorder",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({serverIds:E.map(A=>A.id)})}),w("Server order updated.")}catch(A){w(`Server reorder failed: ${A.message}`)}}async function kS(s){if(!(s!=null&&s.id))return;nt(null);const d=j===s.id;d&&($(""),G(""),H(null),Q([]));try{if(await re(`/v1/servers/${s.id}/leave`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),s.defaultGuildId&&s.baseUrl)try{await ie(s.baseUrl,`/v1/guilds/${s.defaultGuildId}/leave`,s.membershipToken,{method:"POST",body:"{}"})}catch{}const y=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];T(y),d&&y.length&&$(y[0].id),w("Left server.")}catch(m){w(`Leave failed: ${m.message}`)}}async function TS(s){if(!(!(s!=null&&s.id)||!(s.roles||[]).includes("owner"))&&window.confirm(`Delete "${s.name}"? This cannot be undone. All members will lose access.`)){nt(null);try{await re(`/v1/servers/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});const m=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];T(m),j===s.id&&($(m.length?m[0].id:""),G(""),H(null),Q([])),w("Server deleted.")}catch(d){w(`Delete failed: ${d.message}`)}}}async function RS(s){if(!(!O||!Z||!s)){try{await ie(O.baseUrl,`/v1/channels/${Z}/messages/${s}`,O.membershipToken,{method:"DELETE",body:"{}"}),Q(d=>d.filter(m=>m.id!==s)),w("Message deleted.")}catch(d){w(`Delete failed: ${d.message}`)}zt(null)}}async function IS(s){if(!(!ye||!s)){try{await re(`/v1/social/dms/${ye}/messages/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),Nn(d=>d.map(m=>m.id===ye?{...m,messages:(m.messages||[]).filter(y=>y.id!==s)}:m)),w("DM message deleted.")}catch(d){w(`Delete failed: ${d.message}`)}zt(null)}}function NS(s){if(s!=null&&s.id){if(s.kind==="server"){if(!Z)return;n_(d=>{const m=d[Z]||[],E=m.some(R=>R.id===s.id)?m.filter(R=>R.id!==s.id):[{id:s.id,author:s.author,content:s.content},...m].slice(0,50);return{...d,[Z]:E}}),w("Updated pinned messages.");return}if(s.kind==="dm"){if(!ye)return;r_(d=>{const m=d[ye]||[],E=m.some(R=>R.id===s.id)?m.filter(R=>R.id!==s.id):[{id:s.id,author:s.author,content:s.content},...m].slice(0,50);return{...d,[ye]:E}}),w("Updated pinned messages.")}}}function PS(s){return s!=null&&s.id?s.kind==="server"?Lo.some(d=>d.id===s.id):s.kind==="dm"?Mo.some(d=>d.id===s.id):!1:!1}function jS({type:s,match:d=null,timeoutMs:m=1e4,guildId:y=null,channelId:E=null,sessionToken:R=null,transportId:A=null}){return new Promise((U,F)=>{const W=s,Y=Ln.current.get(W)||[],q={match:d,guildId:y,channelId:E,sessionToken:R,transportId:A,resolve:U,reject:F,timeout:setTimeout(()=>{F(new Error(`${s}_TIMEOUT`));const se=Ln.current.get(W)||[];Ln.current.set(W,se.filter(fe=>fe!==q))},m)};Y.push(q),Ln.current.set(W,Y)})}function DS(s){if((s==null?void 0:s.op)!=="DISPATCH"||typeof s.t!="string")return;const d=Ln.current.get(s.t);if(!(d!=null&&d.length))return;const m=s.d||{},y=s.t==="VOICE_TRANSPORT_CONNECTED",E=[];for(const R of d){const A=y?!R.guildId||m.guildId==null||m.guildId===R.guildId:!R.guildId||m.guildId===R.guildId,U=y?!R.channelId||m.channelId==null||m.channelId===R.channelId:!R.channelId||m.channelId===R.channelId,F=!y||!R.transportId||m.transportId===R.transportId,W=!R.match||R.match(m,s);if(A&&U&&F&&W){clearTimeout(R.timeout),R.resolve(m);continue}E.push(R)}E.length?Ln.current.set(s.t,E):Ln.current.delete(s.t)}function kd(s="VOICE_REQUEST_CANCELLED"){for(const[d,m]of Ln.current.entries()){for(const y of m)clearTimeout(y.timeout),y.reject(new Error(s));Ln.current.delete(d)}}async function zh(){var s;kd("VOICE_SESSION_CLEANUP"),await((s=Zt.current)==null?void 0:s.cleanup())}async function LS(s=15e3){var R,A;const d=Date.now();for(;Date.now()-d<s;){const U=$e.current;if(U&&U.readyState===WebSocket.OPEN&&Rt.current)return U;await new Promise(F=>setTimeout(F,120))}const m=(R=$e.current)==null?void 0:R.readyState,y=m===WebSocket.CONNECTING?"CONNECTING":m===WebSocket.OPEN?"OPEN":m===WebSocket.CLOSING?"CLOSING":m===WebSocket.CLOSED?"CLOSED":"MISSING",E=(A=Qi.current)!=null&&A.length?Qi.current.join(","):"none";throw new Error(`VOICE_GATEWAY_UNAVAILABLE:ready=${Rt.current?"1":"0"},ws=${y},candidates=${E}`)}async function Fo(s,d){(await LS()).send(JSON.stringify({op:"DISPATCH",t:s,d}))}function MS(){const s=$e.current,d=!!(s&&s.readyState===WebSocket.OPEN&&Rt.current);if(e){const m=s==null?void 0:s.readyState,y=m===WebSocket.CONNECTING?"CONNECTING":m===WebSocket.OPEN?"OPEN":m===WebSocket.CLOSING?"CLOSING":m===WebSocket.CLOSED?"CLOSED":"MISSING";t("canUseRealtimeVoiceGateway",{usable:d,readyState:y,gatewayReady:Rt.current,activeGuildId:z,activeChannelId:Z})}return d}async function OS(s){var y;if(!(s!=null&&s.id)||!z||!(O!=null&&O.baseUrl)||!(O!=null&&O.membershipToken))return;let d=null;try{w(`Joining ${s.name}...`),await((y=Zt.current)==null?void 0:y.join({guildId:z,channelId:s.id,audioInputDeviceId:Dn,isMuted:jr,isDeafened:Dr,audioOutputDeviceId:rr})),co({guildId:z,channelId:s.id}),w(`Joined ${s.name}.`);return}catch(E){d=E}if(!("".trim()==="1")){const R=`Voice connection failed: ${(d==null?void 0:d.message)||"VOICE_GATEWAY_UNAVAILABLE"}. Realtime voice gateway is required; set VITE_ENABLE_REST_VOICE_FALLBACK=1 only for diagnostics.`;w(R),window.alert(R);return}try{await ie(O.baseUrl,`/v1/channels/${s.id}/voice/join`,O.membershipToken,{method:"POST"}),co({guildId:z,channelId:s.id});const E=d!=null&&d.message?` (gateway fallback: ${d.message})`:"";w(`Joined ${s.name} (REST voice mode, no SFU playback).${E}`)}catch(E){const R=`Voice connection failed: ${E.message||"VOICE_JOIN_FAILED"}`;w(R),window.alert(R)}}async function AS(){if(Bl)return;let s=Fe,d=wt;if(!s||!d)for(const[E,R]of Object.entries(Ur||{})){const A=R==null?void 0:R[l==null?void 0:l.id];if(A!=null&&A.channelId){s=E,d=A.channelId;break}}if(!d){const E=ar.find(R=>R.userId===(l==null?void 0:l.id));E!=null&&E.channelId&&(s=s||z||"",d=E.channelId)}const m=x.find(E=>E.defaultGuildId===s)||O||null,y=async()=>{co({guildId:"",channelId:""}),Nf(!1),Pf(!1),jf(!1),l!=null&&l.id&&C_(E=>{var U;let R=!1;const A={...E};for(const F of Object.keys(A)){if(!((U=A[F])!=null&&U[l.id]))continue;const W={...A[F]};delete W[l.id],A[F]=W,R=!0}return R?A:E}),await zh()};If(!0);try{if(await y(),w("Disconnected from voice."),!s||!d){if(!(m!=null&&m.baseUrl)||!(m!=null&&m.membershipToken))return;try{await ie(m.baseUrl,"/v1/me/voice-disconnect",m.membershipToken,{method:"POST"})}catch(E){const R=`Disconnected locally. Server voice leave failed: ${E.message||"VOICE_LEAVE_FAILED"}`;w(R),console.warn(R)}return}if(MS())try{await Fo("VOICE_LEAVE",{guildId:s,channelId:d});return}catch{}if(!(m!=null&&m.baseUrl)||!(m!=null&&m.membershipToken))return;try{if(d){await ie(m.baseUrl,`/v1/channels/${d}/voice/leave`,m.membershipToken,{method:"POST"});return}await ie(m.baseUrl,"/v1/me/voice-disconnect",m.membershipToken,{method:"POST"})}catch(E){const R=`Disconnected locally. Server voice leave failed: ${E.message||"VOICE_LEAVE_FAILED"}`;w(R),console.warn(R)}}finally{If(!1)}}async function Bh(){const s=Lr.trim();if(!(!s||!r||!sr.trim()))try{const d=await re("/v1/servers/official",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:s,logoUrl:sr.trim(),bannerUrl:Hl.trim()||null})});Vl(""),Wl(""),Gl(""),w("Your server was created.");const y=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];T(y),d.serverId&&y.length&&($(d.serverId),C("servers")),Mr(!1)}catch(d){const m=(d==null?void 0:d.message)||"";m.includes("SERVER_LIMIT")?w("You already have a server."):m.includes("OFFICIAL_SERVER_NOT_CONFIGURED")?w("Server creation isnt set up yet. The site admin needs to set OFFICIAL_NODE_SERVER_ID on the API server (same value as NODE_SERVER_ID on the node)."):m.includes("OFFICIAL_SERVER_UNAVAILABLE")?w("Official server is unavailable. Please try again later."):w(`Failed: ${m}`)}}function Vh(s,d){s.preventDefault();const m=Math.min(s.clientX,window.innerWidth-240),y=Math.min(s.clientY,window.innerHeight-180);qt(null),Xt(null),Tt(null),zt({x:m,y,message:{...d,pinned:PS(d)}})}function Td(s,d){if(!(d!=null&&d.id))return;s.preventDefault(),s.stopPropagation();const m=Math.min(s.clientX,window.innerWidth-250),y=Math.min(s.clientY,window.innerHeight-220);nt(null),qt(null),Xt(null),zt(null),Tt({x:m,y,member:d})}const Uo=25*1024*1024;function Wh(s){return s!=null&&s.type?s.type.startsWith("image/"):!1}async function Hh(s,d){const m=new FormData;m.append("image",s);const y=await fetch(`${bn}${d}`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:m});if(!y.ok){const E=await y.json().catch(()=>({}));throw new Error(E.error||`Upload failed: ${y.status}`)}return y.json()}async function $S(s){var m;const d=(m=s.target.files)==null?void 0:m[0];if(s.target.value="",!!d){if(!Wh(d)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(d.size>Uo){w(`Image too large. Max ${Math.round(Uo/1024/1024)}MB.`);return}try{w("Uploading avatar");const y=await Hh(d,"/v1/me/profile/pfp");tr(E=>({...E,pfpUrl:y.pfpUrl||""})),Li(de?{...de,pfpUrl:y.pfpUrl}:null),w("Avatar updated.")}catch(y){w(y.message||"Upload failed.")}}}async function FS(s){var m;const d=(m=s.target.files)==null?void 0:m[0];if(s.target.value="",!!d){if(!Wh(d)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(d.size>Uo){w(`Image too large. Max ${Math.round(Uo/1024/1024)}MB.`);return}try{w("Uploading banner");const y=await Hh(d,"/v1/me/profile/banner");tr(E=>({...E,bannerUrl:y.bannerUrl||""})),Li(de?{...de,bannerUrl:y.bannerUrl}:null),w("Banner updated.")}catch(y){w(y.message||"Upload failed.")}}}async function Os(s){try{const d=await re(`/v1/users/${s.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});Xl(m=>{var y;return{...m,[s.id]:{username:d.username??((y=m[s.id])==null?void 0:y.username)??s.username,displayName:d.displayName??d.username??s.username,pfpUrl:d.pfpUrl??null}}}),$r({...d,username:d.username||s.username,status:mn(s.id)||"offline",roleIds:s.roleIds||[]})}catch{$r({id:s.id,username:s.username||s.id,displayName:s.username||s.id,bio:"Profile details are private or unavailable.",badges:[],badgeDetails:[],status:mn(s.id)||"offline",platformTitle:null,createdAt:null,roleIds:s.roleIds||[]})}}function US(s){if(s&&typeof s=="object"&&(s.bgColor||s.icon||s.name))return{icon:s.icon||"",name:s.name||String(s.id||"Badge"),bgColor:s.bgColor||"#3a4f72",fgColor:s.fgColor||"#ffffff"};const d=String((s==null?void 0:s.id)||s||"").toLowerCase();return d==="platform_owner"?{icon:"",name:"Platform Owner",bgColor:"#2d6cdf",fgColor:"#ffffff"}:d==="platform_admin"?{icon:"",name:"Platform Admin",bgColor:"#2d6cdf",fgColor:"#ffffff"}:d==="boost"?{icon:"",name:"Boost",bgColor:"#4f7ecf",fgColor:"#ffffff"}:{icon:(s==null?void 0:s.icon)||"",name:(s==null?void 0:s.name)||d||"Badge",bgColor:(s==null?void 0:s.bgColor)||"#3a4f72",fgColor:(s==null?void 0:s.fgColor)||"#ffffff"}}function Gh(s){var m;const d=`:${s}:`;le(y=>{const E=y||"",R=E.length>0&&!/\s$/.test(E)?" ":"";return`${E}${R}${d} `}),Ge(!1),(m=Yi.current)==null||m.focus()}function zS(s){const d=(s==null?void 0:s.content)||"",m=[],y=(U,F)=>{if(!U)return;const W=/:([a-zA-Z0-9_+-]{2,32}):/g;let Y=0,q=W.exec(U),se=0;for(;q;){const fe=q.index??0;fe>Y&&(m.push(c.jsx("span",{children:U.slice(Y,fe)},`${F}-plain-${se}`)),se+=1);const te=String(q[1]||"").toLowerCase(),pe=Jg[te];if(pe)m.push(c.jsx("span",{className:"message-emote",title:`:${te}:`,children:pe},`${F}-emote-${se}`));else if(wh.has(te)){const he=wh.get(te);m.push(c.jsx("img",{className:"message-custom-emote",src:he.imageUrl||he.image_url,alt:`:${te}:`,title:`:${te}:`},`${F}-custom-emote-${se}`))}else m.push(c.jsx("span",{children:q[0]},`${F}-raw-${se}`));se+=1,Y=fe+q[0].length,q=W.exec(U)}Y<U.length&&m.push(c.jsx("span",{children:U.slice(Y)},`${F}-tail-${se}`))},E=(U,F)=>{if(!U)return;const W=/(https?:\/\/[^\s<>"'`]+)/gi;let Y=0,q=W.exec(U),se=0;for(;q;){const fe=q.index??0;fe>Y&&(y(U.slice(Y,fe),`${F}-text-${se}`),se+=1);const te=q[1];m.push(c.jsx("a",{href:te,target:"_blank",rel:"noreferrer",children:te},`${F}-link-${se}`)),se+=1,Y=fe+te.length,q=W.exec(U)}Y<U.length&&y(U.slice(Y),`${F}-tail-${se}`)},R=/@\{([^}\n]{1,64})\}|@([a-zA-Z0-9_.-]{2,64})/g;let A=0;for(const U of d.matchAll(R)){const F=U.index??0,W=(U[1]||U[2]||"").trim(),Y=U[0],q=F>0?d[F-1]:"";if(!(!(F===0||/\s/.test(q))||!W)){if(F>A&&E(d.slice(A,F),`text-${A}`),W.toLowerCase()==="everyone")m.push(c.jsx("span",{className:"message-mention",children:Y},`everyone-${F}`));else{const fe=M_.get(W.toLowerCase());fe?m.push(c.jsxs("button",{type:"button",className:"message-mention mention-click",onClick:te=>{te.stopPropagation(),Os(fe)},children:["@",fe.username||fe.id]},`mention-${F}`)):m.push(c.jsx("span",{className:"message-mention",children:Y},`unknown-${F}`))}A=F+Y.length}}return A<d.length&&E(d.slice(A),`tail-${A}`),m.length?m:d}function Qh(s){if(!s)return null;try{const d=new Date(s);return Number.isNaN(d.getTime())?null:d.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return null}}async function BS(s){var m;const d=(m=s.target.files)==null?void 0:m[0];d&&(Hf(await d.text()),w(`Theme loaded: ${d.name}`))}return r?c.jsxs("div",{className:"opencom-shell",children:[c.jsxs("aside",{className:"server-rail",children:[c.jsx("div",{className:"rail-header",title:"OpenCom",children:c.jsx("img",{src:"logo.png",alt:"OpenCom",className:"logo-img",style:{width:"100%",height:"100%",objectFit:"contain"}})}),Wi&&(()=>{const s=$t.find(d=>d.id===Wi.dmId);return s?c.jsxs("button",{type:"button",className:"dm-notification-popup",onClick:()=>{C("dms"),Pn(Wi.dmId),dd(null)},children:[s.pfp_url?c.jsx("img",{src:It(s.pfp_url),alt:"",className:"dm-notification-avatar"}):c.jsx("div",{className:"dm-notification-avatar dm-notification-avatar-initials",children:zn(s.name||s.username||"?")}),c.jsxs("span",{className:"dm-notification-text",children:["New message from ",s.name||s.username||"Someone"]})]}):null})(),c.jsx("button",{className:`server-pill nav-pill ${g==="friends"?"active":""}`,onClick:()=>C("friends"),title:"Friends",children:""}),c.jsx("button",{className:`server-pill nav-pill ${g==="dms"?"active":""}`,onClick:()=>C("dms"),title:"Direct messages",children:""}),c.jsx("button",{className:`server-pill nav-pill ${g==="profile"?"active":""}`,onClick:()=>C("profile"),title:"Profile",children:""}),c.jsxs("div",{className:"server-list",children:[x.map(s=>c.jsxs("button",{className:`server-pill ${s.id===j&&g==="servers"?"active":""}`,title:s.name,onClick:()=>{C("servers"),$(s.id),G(""),H(null),Q([])},onContextMenu:d=>wS(d,s),children:[s.logoUrl?c.jsx("img",{src:It(s.logoUrl),alt:s.name,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"inherit"}}):zn(s.name),(Wf[s.id]||0)>0&&c.jsx("span",{className:"server-pill-ping-badge",children:Wf[s.id]})]},s.id)),c.jsx("button",{className:"server-pill",title:"Create or join a server",onClick:()=>Mr(!0),children:""})]})]}),c.jsxs("aside",{className:`channel-sidebar ${Vr?"voice-connected":""}`,children:[c.jsxs("header",{className:"sidebar-header",style:O!=null&&O.bannerUrl?{backgroundImage:`linear-gradient(rgba(10,16,30,0.72), rgba(10,16,30,0.86)), url(${It(O.bannerUrl)})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[c.jsx("h2",{children:g==="servers"?(O==null?void 0:O.name)||"No server":g.toUpperCase()}),c.jsx("small",{children:g==="servers"?(Mn==null?void 0:Mn.name)||"Choose a channel":"Unified communication hub"})]}),g==="servers"&&c.jsx(c.Fragment,{children:c.jsxs("section",{className:"sidebar-block channels-container",children:[Sh.map(({category:s,channels:d})=>{const m=Gw[s.id];return c.jsxs("div",{className:"category-block",children:[c.jsxs("div",{className:"category-header-row",children:[c.jsxs("button",{className:`category-header ${wo===s.id?"channel-dragging":""}`,draggable:Se&&s.id!=="uncategorized",onDragStart:()=>Se&&s.id!=="uncategorized"&&cd(s.id),onDragOver:y=>{y.preventDefault(),s.id!=="uncategorized"&&y.currentTarget.classList.add("channel-drop-target")},onDragLeave:y=>y.currentTarget.classList.remove("channel-drop-target"),onDrop:y=>{y.preventDefault(),y.currentTarget.classList.remove("channel-drop-target"),Se&&wo&&s.id!=="uncategorized"&&wo!==s.id&&uS(wo,s.id)},onDragEnd:()=>cd(null),onClick:()=>yS(s.id),onContextMenu:y=>s.id!=="uncategorized"&&Se&&SS(y,s),children:[c.jsx("span",{className:"chevron",children:m?"":""}),s.name]}),Se&&s.id!=="uncategorized"&&c.jsxs("div",{className:"category-actions",children:[c.jsx("button",{type:"button",className:"channel-action-btn",title:"Create channel in category",onClick:y=>{y.stopPropagation(),Ms({fixedType:"text",fixedParentId:s.id})},children:""}),c.jsx("button",{type:"button",className:"channel-action-btn",title:"Category settings",onClick:y=>{y.stopPropagation(),$o(s)},children:""})]})]}),!m&&c.jsx("div",{className:"category-items",children:d.map(y=>{var E,R;return c.jsxs("div",{children:[c.jsxs("div",{className:"channel-row-wrap",children:[c.jsxs("button",{className:`channel-row ${y.id===Z?"active":""} ${yo===y.id?"channel-dragging":""}`,draggable:Se,onDragStart:()=>Se&&od(y.id),onDragOver:A=>{A.preventDefault(),A.currentTarget.classList.add("channel-drop-target")},onDragLeave:A=>A.currentTarget.classList.remove("channel-drop-target"),onDrop:A=>{A.preventDefault(),A.currentTarget.classList.remove("channel-drop-target"),Se&&yo&&yo!==y.id&&dS(yo,y.id,d)},onDragEnd:()=>od(null),onContextMenu:A=>Se&&_S(A,y),onClick:()=>{if(y.type==="text"){ae(y.id);return}y.type==="voice"&&OS(y)},children:[c.jsx("span",{className:"channel-hash",children:y.type==="voice"?"":"#"}),c.jsxs("span",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:0},children:[c.jsx("span",{children:y.name}),y.type==="voice"&&(((E=Do.get(y.id))==null?void 0:E.length)||0)>0&&c.jsxs("span",{className:"hint",style:{fontSize:"11px"},children:[Do.get(y.id).length," connected"]})]})]}),Se&&c.jsx("button",{type:"button",className:"channel-action-btn channel-row-cog",title:"Channel settings",onClick:A=>{A.stopPropagation(),$o(y)},children:""})]}),y.type==="voice"&&(((R=Do.get(y.id))==null?void 0:R.length)||0)>0&&c.jsx("div",{className:"voice-channel-members",children:Do.get(y.id).map(A=>{var F;const U=!!((F=rh[z])!=null&&F[A.userId]);return c.jsxs("div",{className:"voice-channel-member-row",children:[c.jsx("div",{className:`avatar member-avatar vc-avatar ${U?"speaking":""}`,children:A.pfp_url?c.jsx("img",{src:It(A.pfp_url),alt:A.username,className:"avatar-image"}):zn(A.username)}),c.jsx("span",{className:"voice-channel-member-name",children:A.username}),c.jsx("span",{className:"voice-channel-member-icons",children:A.deafened?"":A.muted?"":""})]},`${y.id}-${A.userId}`)})})]},y.id)})})]},s.id)}),!Sh.length&&c.jsx("p",{className:"hint",children:"No channels available. Create one in Settings."})]})}),g==="dms"&&c.jsxs("section",{className:"sidebar-block channels-container",children:[$t.map(s=>{var d;return c.jsxs("button",{className:`channel-row dm-sidebar-row ${s.id===ye?"active":""}`,onClick:()=>Pn(s.id),title:`DM ${s.name}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.pfp_url?c.jsx("img",{src:It(s.pfp_url),alt:s.name,style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover",flexShrink:0}}):c.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`hsl(${Math.abs((s.participantId||s.id||"").charCodeAt(0)*7)%360}, 70%, 60%)`,display:"grid",placeItems:"center",fontSize:"12px",fontWeight:"bold",flexShrink:0},children:(d=s.name)==null?void 0:d.substring(0,1).toUpperCase()}),c.jsx("span",{className:"channel-hash",children:"@"}),c.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:s.name})]},s.id)}),!$t.length&&c.jsx("p",{className:"hint",children:"Add friends to open direct message threads."})]}),g==="friends"&&c.jsxs("section",{className:"sidebar-block channels-container",children:[In.map(s=>{var d;return c.jsxs("button",{className:"friend-row friend-sidebar-row",onClick:()=>Oo(s),title:`Open ${s.username}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.pfp_url?c.jsx("img",{src:It(s.pfp_url),alt:s.username,style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover",flexShrink:0}}):c.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`hsl(${Math.abs((s.id||"").charCodeAt(0)*7)%360}, 70%, 60%)`,display:"grid",placeItems:"center",fontSize:"12px",fontWeight:"bold",flexShrink:0},children:(d=s.username)==null?void 0:d.substring(0,1).toUpperCase()}),c.jsxs("div",{style:{flex:1,minWidth:0},children:[c.jsx("strong",{children:s.username}),c.jsx("span",{className:"hint",children:s.status})]})]},s.id)}),!In.length&&c.jsx("p",{className:"hint",children:"No friends yet. Use the Add Friend tab in the main panel."})]}),g==="profile"&&de&&c.jsx("section",{className:"sidebar-block channels-container",children:c.jsxs("div",{className:"profile-preview",style:{backgroundImage:de!=null&&de.bannerUrl?`url(${It(de.bannerUrl)})`:void 0},children:[c.jsx("div",{className:"avatar",children:zn(de.displayName||de.username||"User")}),c.jsx("strong",{children:de.displayName||de.username}),c.jsxs("span",{children:["@",de.username]}),c.jsx("small",{children:de.platformTitle||"OpenCom Member"})]})}),c.jsxs("footer",{className:"self-card",children:[Vr&&c.jsxs("div",{className:"voice-widget",children:[c.jsxs("div",{className:"voice-top",children:[c.jsx("strong",{children:"Voice connected"}),c.jsx("span",{title:yh,children:yh})]}),c.jsxs("div",{className:"voice-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>Nf(s=>!s),children:Kw?"Stop Share":"Share Screen"}),c.jsx("button",{className:"danger",onClick:AS,disabled:Bl,children:Bl?"Disconnecting...":"Disconnect"})]}),c.jsx("p",{className:"hint",children:"Voice controls moved to Settings  Voice."})]}),c.jsxs("div",{className:"user-row",children:[c.jsx("div",{className:"avatar",children:de!=null&&de.pfpUrl?c.jsx("img",{src:It(de.pfpUrl),alt:"Your avatar",className:"avatar-image"}):zn((l==null?void 0:l.username)||"OpenCom User")}),c.jsxs("div",{className:"user-meta",children:[c.jsx("strong",{children:l==null?void 0:l.username}),c.jsx("span",{children:Se?"Owner":"Member"})]}),c.jsxs("select",{className:"status-select",value:Jt,onChange:s=>t_(s.target.value),title:"Your status",children:[c.jsx("option",{value:"online",children:"Online"}),c.jsx("option",{value:"idle",children:"Idle"}),c.jsx("option",{value:"dnd",children:"Do Not Disturb"}),c.jsx("option",{value:"invisible",children:"Invisible"})]}),c.jsxs("div",{className:"user-controls",children:[c.jsx("button",{className:`icon-btn ${jr?"danger":"ghost"}`,onClick:()=>Pf(s=>!s),children:jr?"":""}),c.jsx("button",{className:`icon-btn ${Dr?"danger":"ghost"}`,onClick:()=>jf(s=>!s),children:Dr?"":""}),c.jsx("button",{className:"icon-btn ghost",onClick:()=>{hn(!0),Qe("profile")},children:""}),c.jsx("button",{className:"icon-btn danger",onClick:()=>{zh().catch(()=>{}),i(""),o(""),T([]),H(null),Q([])},children:""})]})]})]})]}),c.jsxs("main",{className:"chat-pane",children:[g==="servers"&&x.length===0&&c.jsxs("div",{className:"create-server-empty",style:{padding:"2rem",maxWidth:"420px",margin:"auto"},children:[c.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Create your server"}),c.jsx("p",{className:"hint",style:{marginBottom:"1rem"},children:"You get one server hosted by us. Name it and start customising channels and roles."}),c.jsx("input",{type:"text",value:Lr,onChange:s=>Vl(s.target.value),placeholder:"Server name",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsx("input",{type:"text",value:sr,onChange:s=>Wl(s.target.value),placeholder:"Logo URL (.png/.jpg/.webp/.svg)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsx("input",{type:"text",value:Hl,onChange:s=>Gl(s.target.value),placeholder:"Banner URL (optional)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsx("button",{onClick:Bh,disabled:!Lr.trim()||!sr.trim(),children:"Create your server"})]}),g==="servers"&&x.length>0&&c.jsxs("div",{className:"chat-layout",children:[c.jsxs("section",{className:"chat-main",children:[c.jsxs("header",{className:"chat-header",children:[c.jsxs("h3",{children:[c.jsx("span",{className:"channel-hash",children:"#"})," ",(js==null?void 0:js.name)||"updates"]}),c.jsxs("div",{className:"chat-actions",children:[c.jsx("button",{className:"icon-btn ghost",title:"Pinned messages",onClick:()=>Of(s=>!s),children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Threads",children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Notifications",children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Members",children:""}),c.jsx("input",{className:"search-input",placeholder:`Search ${(O==null?void 0:O.name)||"server"}`}),c.jsx("button",{className:"ghost",onClick:()=>{hn(!0),Qe("server")},children:"Open settings"})]})]}),Mf&&Lo.length>0&&c.jsx("div",{className:"pinned-strip",children:Lo.slice(0,3).map(s=>c.jsxs("div",{className:"pinned-item",children:[c.jsx("strong",{children:s.author}),c.jsx("span",{children:s.content})]},s.id))}),c.jsxs("div",{className:"messages",ref:ko,children:[(()=>{let s="";return O_.map(d=>{const m=st.find(F=>F.id===d.authorId),E=((L==null?void 0:L.roles)||[]).filter(F=>((m==null?void 0:m.roleIds)||[]).includes(F.id)).sort((F,W)=>(W.position??0)-(F.position??0))[0],R=(E==null?void 0:E.color)!=null&&E.color!==""?typeof E.color=="number"?`#${Number(E.color).toString(16).padStart(6,"0")}`:E.color:null,A=tv(d.firstMessageTime),U=!!A&&A!==s;return A&&(s=A),c.jsxs("div",{children:[U&&c.jsx("div",{className:"message-date-divider",children:c.jsx("span",{children:nv(d.firstMessageTime)})}),c.jsxs("article",{className:"msg grouped-msg",children:[c.jsx("div",{className:"msg-avatar",children:d.pfpUrl?c.jsx("img",{src:It(d.pfpUrl),alt:d.author}):zn(d.author||"User")}),c.jsxs("div",{className:"msg-body",children:[c.jsxs("strong",{className:"msg-author",children:[c.jsx("button",{className:"name-btn",style:R?{color:R}:void 0,onClick:()=>Os({id:d.authorId,username:d.author,status:mn(d.authorId),pfp_url:d.pfpUrl}),onContextMenu:F=>Td(F,{id:d.authorId,username:d.author,pfp_url:d.pfpUrl,roleIds:(m==null?void 0:m.roleIds)||[]}),children:d.author}),E&&c.jsx("span",{className:"msg-role-tag",children:E.name}),c.jsx("span",{className:"msg-time",children:Zg(d.firstMessageTime)})]}),d.messages.map(F=>c.jsxs("div",{onContextMenu:W=>Vh(W,{id:F.id,kind:"server",author:d.author,content:F.content,mine:(F.author_id||F.authorId)===(l==null?void 0:l.id)}),children:[c.jsxs("p",{children:[Lo.some(W=>W.id===F.id)?" ":"",zS(F)]}),Array.isArray(F==null?void 0:F.embeds)&&F.embeds.length>0&&c.jsx("div",{className:"message-embeds",children:F.embeds.map((W,Y)=>{var q;return c.jsxs("div",{className:"message-embed-card",children:[W.title&&c.jsx("strong",{children:W.title}),W.description&&c.jsx("p",{children:W.description}),W.url&&c.jsx("a",{href:W.url,target:"_blank",rel:"noreferrer",children:W.url}),((q=W.footer)==null?void 0:q.text)&&c.jsx("small",{children:W.footer.text})]},`${F.id}-embed-${Y}`)})}),Array.isArray(F==null?void 0:F.linkEmbeds)&&F.linkEmbeds.length>0&&c.jsx("div",{className:"message-embeds",children:F.linkEmbeds.map((W,Y)=>c.jsxs("a",{className:"message-embed-card",href:W.url,target:"_blank",rel:"noreferrer",children:[c.jsx("strong",{children:W.title||"Link"}),c.jsx("p",{children:W.url})]},`${F.id}-link-${Y}`))}),Array.isArray(F==null?void 0:F.attachments)&&F.attachments.length>0&&c.jsx("div",{className:"message-embeds",children:F.attachments.map((W,Y)=>c.jsxs("a",{className:"message-embed-card",href:`${(O==null?void 0:O.baseUrl)||""}${W.url}`,target:"_blank",rel:"noreferrer",children:[c.jsx("strong",{children:W.fileName||"Attachment"}),c.jsx("p",{children:W.contentType||"file"})]},`${F.id}-att-${Y}`))})]},F.id))]})]})]},`group-wrap-${d.id}`)})})(),!J.length&&c.jsx("p",{className:"empty",children:"No messages yet. Start the conversation."})]}),zi&&c.jsxs("div",{className:"reply-banner",children:[c.jsxs("span",{children:["Replying to ",zi.author]}),c.jsx("button",{className:"ghost",onClick:()=>ql(null),children:"Cancel"})]}),c.jsxs("footer",{className:"composer server-composer",onClick:()=>{var s;return(s=Yi.current)==null?void 0:s.focus()},children:[c.jsx("button",{className:"ghost composer-icon",onClick:s=>{var d;s.stopPropagation(),(d=Ns.current)==null||d.click()},children:""}),c.jsx("input",{ref:Ns,type:"file",multiple:!0,style:{display:"none"},onChange:async s=>{const d=Array.from(s.target.files||[]);for(const m of d.slice(0,10))await z_(m)}}),c.jsxs("div",{className:"composer-input-wrap",children:[ji.length>0&&c.jsx("div",{className:"mention-suggestions",children:ji.map((s,d)=>c.jsxs("div",{className:"mention-suggestion",style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[c.jsx("span",{children:s.fileName||"attachment"}),c.jsx("button",{type:"button",className:"ghost",onClick:m=>{m.stopPropagation(),to(y=>y.filter((E,R)=>R!==d))},children:"Remove"})]},`pending-att-${d}`))}),c.jsx("input",{ref:Yi,value:X,onChange:s=>le(s.target.value),placeholder:`Message #${(js==null?void 0:js.name)||"channel"}`,onKeyDown:s=>{if(s.key==="ArrowDown"&&en.length>0){s.preventDefault(),Eo(d=>(d+1)%en.length);return}if(s.key==="ArrowUp"&&en.length>0){s.preventDefault(),Eo(d=>(d-1+en.length)%en.length);return}if(s.key==="Escape"&&Po){s.preventDefault(),le("");return}if((s.key==="Tab"||s.key==="Enter")&&en.length>0){s.preventDefault();const d=en[Math.min(uh,en.length-1)]||en[0];if(!d)return;le(`/${d.name} `);return}if(s.key==="Enter"){Eh();return}if(s.key==="Tab"&&No.length){s.preventDefault();const d=lu(X);if(!d)return;const m=No[0],y=X.slice(0,d.start);le(`${y}@{${m}} `)}}}),Po&&c.jsxs("div",{className:"slash-command-suggestions",children:[c.jsxs("div",{className:"slash-command-header",children:["COMMANDS MATCHING /",(Ls||"").toUpperCase()]}),en.length===0?c.jsx("div",{className:"slash-command-empty",children:"No commands found for this server."}):en.map((s,d)=>c.jsxs("button",{type:"button",className:`slash-command-item ${d===uh?"active":""}`,onClick:m=>{var y;m.stopPropagation(),le(`/${s.name} `),Eo(d),(y=Yi.current)==null||y.focus()},children:[c.jsxs("div",{children:[c.jsxs("strong",{children:["/",s.name]}),c.jsx("p",{children:s.description||"No description provided."})]}),c.jsx("span",{children:s.extensionName||s.extensionId})]},s.name))]}),No.length>0&&!Po&&c.jsx("div",{className:"mention-suggestions",children:No.map(s=>c.jsxs("button",{type:"button",className:"mention-suggestion",onClick:d=>{var E;d.stopPropagation();const m=lu(X);if(!m)return;const y=X.slice(0,m.start);le(`${y}@{${s}} `),(E=Yi.current)==null||E.focus()},children:["@",s]},s))}),At&&!Po&&c.jsxs("div",{className:"emote-picker",children:[Object.entries(Jg).map(([s,d])=>c.jsxs("button",{type:"button",className:"emote-item",onClick:m=>{m.stopPropagation(),Gh(s)},title:`:${s}:`,children:[c.jsx("span",{children:d}),c.jsxs("small",{children:[":",s,":"]})]},s)),((L==null?void 0:L.emotes)||[]).map(s=>c.jsxs("button",{type:"button",className:"emote-item",onClick:d=>{d.stopPropagation(),Gh(String(s.name||"").toLowerCase())},title:`:${s.name}:`,children:[c.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:`:${s.name}:`}),c.jsxs("small",{children:[":",s.name,":"]})]},s.id||s.name))]})]}),c.jsx("button",{className:"ghost composer-icon",onClick:s=>{s.stopPropagation(),Ge(d=>!d)},title:"Open emotes",children:""}),c.jsx("button",{className:"send-btn",onClick:Eh,disabled:!Z||!X.trim()&&ji.length===0,children:"Send"})]})]}),c.jsxs("aside",{className:"members-pane",children:[c.jsxs("h4",{children:["Members  ",st.length]}),(()=>{const s=new Map(((L==null?void 0:L.roles)||[]).map(R=>[R.id,R])),d=R=>(R.roleIds||[]).map(U=>s.get(U)).filter(Boolean).sort((U,F)=>(F.position??0)-(U.position??0))[0]||null,m=new Map;for(const R of st){const A=d(R),U=(A==null?void 0:A.id)??"__none__";m.has(U)||m.set(U,{role:A,members:[]}),m.get(U).members.push(R)}const y={id:"__none__",name:"No role",position:-1,color:null},E=Array.from(m.entries()).map(([R,{role:A,members:U}])=>({role:A||y,members:U}));return E.sort((R,A)=>(A.role.position??0)-(R.role.position??0)),E.map(({role:R,members:A})=>{const U=R.color!=null&&R.color!==""?typeof R.color=="number"?`#${Number(R.color).toString(16).padStart(6,"0")}`:R.color:null;return c.jsxs("div",{className:"members-role-section",children:[c.jsx("div",{className:"members-role-label",style:U?{color:U}:void 0,children:R.name}),A.map(F=>{var te;const W=d(F),Y=(W==null?void 0:W.color)!=null&&W.color!==""?typeof W.color=="number"?`#${Number(W.color).toString(16).padStart(6,"0")}`:W.color:null,q=ar.find(pe=>pe.userId===F.id),fe=!!((q==null?void 0:q.channelId)&&q.channelId===wt)&&!!((te=rh[z])!=null&&te[F.id]);return c.jsxs("button",{className:"member-row",title:`View ${F.username}`,onClick:pe=>{pe.stopPropagation(),Os(F)},onContextMenu:pe=>Td(pe,F),children:[F.pfp_url?c.jsx("img",{src:It(F.pfp_url),alt:F.username,className:`avatar member-avatar ${fe?"speaking":""}`,style:{objectFit:"cover"}}):c.jsx("div",{className:`avatar member-avatar ${fe?"speaking":""}`,children:zn(F.username)}),c.jsxs("div",{children:[c.jsx("strong",{style:Y?{color:Y}:void 0,children:F.username}),c.jsx("span",{children:q?`${q.deafened?"":q.muted?"":""} In voice`:To(mn(F.id))})]})]},F.id)})]},R.id)})})(),!st.length&&c.jsx("p",{className:"hint",children:"No visible members yet."})]})]}),g==="dms"&&c.jsxs("section",{className:"chat-main",children:[c.jsxs("header",{className:"chat-header dm-header-actions",children:[c.jsx("h3",{children:Ee?`@ ${Ee.name}`:"Direct Messages"}),c.jsx("div",{className:"chat-actions",children:c.jsx("button",{className:"icon-btn ghost",onClick:()=>Of(s=>!s),title:"Pinned DMs",children:""})})]}),Mf&&Mo.length>0&&c.jsx("div",{className:"pinned-strip",children:Mo.slice(0,3).map(s=>c.jsxs("div",{className:"pinned-item",children:[c.jsx("strong",{children:s.author}),c.jsx("span",{children:s.content})]},s.id))}),c.jsxs("div",{className:"messages",ref:Ki,children:[(()=>{let s="";return A_.map(d=>{const m=tv(d.firstMessageTime),y=!!m&&m!==s;return m&&(s=m),c.jsxs("div",{children:[y&&c.jsx("div",{className:"message-date-divider",children:c.jsx("span",{children:nv(d.firstMessageTime)})}),c.jsxs("article",{className:"msg dm-msg grouped-msg",children:[c.jsx("div",{className:"msg-avatar",children:d.pfpUrl?c.jsx("img",{src:It(d.pfpUrl),alt:d.author}):zn(d.author)}),c.jsxs("div",{className:"msg-body",children:[c.jsxs("strong",{className:"msg-author",children:[c.jsx("button",{className:"name-btn",onClick:()=>Os({id:d.authorId,username:d.author,status:mn(d.authorId),pfp_url:d.pfpUrl}),onContextMenu:E=>Td(E,{id:d.authorId,username:d.author,pfp_url:d.pfpUrl}),children:d.author}),c.jsx("span",{className:"msg-time",children:Zg(d.firstMessageTime)})]}),d.messages.map(E=>c.jsxs("p",{onContextMenu:R=>Vh(R,{id:E.id,kind:"dm",author:E.author,content:E.content,mine:E.authorId===(l==null?void 0:l.id)}),children:[Mo.some(R=>R.id===E.id)?" ":"",E.content]},E.id))]})]})]},`dm-group-wrap-${d.id}`)})})(),!Ee&&c.jsx("p",{className:"empty",children:"Select a DM on the left."})]}),c.jsxs("footer",{className:"composer dm-composer",onClick:()=>{var s;return(s=hh.current)==null?void 0:s.focus()},children:[c.jsx("input",{ref:hh,value:ro,onChange:s=>Dl(s.target.value),placeholder:`Message ${(Ee==null?void 0:Ee.name)||"friend"}`,onKeyDown:s=>s.key==="Enter"&&kh()}),c.jsx("button",{className:"send-btn",onClick:kh,disabled:!Ee||!ro.trim(),children:"Send"})]})]}),g==="friends"&&c.jsxs("div",{className:"friends-surface",children:[c.jsxs("section",{className:"friends-main",children:[c.jsxs("header",{className:"friends-header",children:[c.jsx("h3",{children:"Friends"}),c.jsxs("div",{className:"friends-tabs",children:[c.jsx("button",{className:Pr==="online"?"active":"ghost",onClick:()=>Di("online"),children:"Online"}),c.jsx("button",{className:Pr==="all"?"active":"ghost",onClick:()=>Di("all"),children:"All"}),c.jsx("button",{className:Pr==="add"?"active":"ghost",onClick:()=>Di("add"),children:"Add Friend"}),c.jsx("button",{className:Pr==="requests"?"active":"ghost",onClick:()=>Di("requests"),children:"Requests"})]})]}),c.jsx("input",{placeholder:"Search friends",value:jl,onChange:s=>Uw(s.target.value)}),Pr==="add"&&c.jsxs("div",{className:"friend-add-card",children:[c.jsx("h4",{children:"Add Friend"}),c.jsx("p",{className:"hint",children:"Type the username and send your request instantly."}),c.jsxs("div",{className:"friend-add-row",children:[c.jsx("input",{placeholder:"Username",value:vf,onChange:s=>yf(s.target.value)}),c.jsx("button",{onClick:B_,children:"Send Request"})]})]}),Pr==="requests"&&c.jsxs("div",{className:"friend-add-card",children:[c.jsx("h4",{children:"Friend Requests"}),oo.incoming.map(s=>c.jsxs("div",{className:"friend-row",children:[c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:"Incoming request"})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{onClick:()=>Th(s.id,"accept"),children:"Accept"}),c.jsx("button",{className:"ghost",onClick:()=>Th(s.id,"decline"),children:"Decline"})]})]},s.id)),oo.outgoing.map(s=>c.jsx("div",{className:"friend-row",children:c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:"Pending"})]})},s.id)),!oo.incoming.length&&!oo.outgoing.length&&c.jsx("p",{className:"hint",children:"No pending friend requests."})]}),(Pr==="online"?Io.filter(s=>mn(s.id)!=="offline"):Io).map(s=>c.jsxs("div",{className:"friend-row",children:[c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:To(mn(s.id))})]}),c.jsx("button",{className:"ghost",onClick:d=>{d.stopPropagation(),Oo(s)},children:"Message"})]},s.id))]}),c.jsxs("aside",{className:"active-now",children:[c.jsx("h4",{children:"Active Now"}),Io.slice(0,5).map(s=>c.jsxs("button",{className:"active-card",onClick:d=>{d.stopPropagation(),Os(s)},children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:mn(s.id)==="online"?"Available now":To(mn(s.id))})]},`active-${s.id}`)),!Io.length&&c.jsx("p",{className:"hint",children:"When friends are active, they will appear here."})]})]}),g==="profile"&&c.jsxs("div",{className:"social-panel",children:[c.jsx("h3",{children:"Your Profile"}),c.jsx("p",{className:"hint",children:"Manage your public details and account appearance in Settings."}),c.jsx("button",{onClick:()=>{hn(!0),Qe("profile")},children:"Open Profile Settings"})]})]}),rt&&c.jsxs("div",{className:"server-context-menu",style:{top:rt.y,left:rt.x},onClick:s=>s.stopPropagation(),children:[rt.message.kind==="server"&&c.jsx("button",{onClick:()=>{ql({author:rt.message.author,content:rt.message.content}),zt(null)},children:"Reply"}),c.jsx("button",{onClick:()=>{NS(rt.message),zt(null)},children:rt.message.pinned?"Unpin":"Pin"}),rt.message.kind==="dm"&&c.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(rt.message.content||""),w("Copied message text.")}catch{w("Could not copy message text.")}zt(null)},children:"Copy Text"}),rt.message.mine&&rt.message.kind==="server"&&c.jsx("button",{className:"danger",onClick:()=>RS(rt.message.id),children:"Delete"}),rt.message.mine&&rt.message.kind==="dm"&&c.jsx("button",{className:"danger",onClick:()=>IS(rt.message.id),children:"Delete"})]}),kt&&c.jsxs("div",{className:"server-context-menu",style:{top:kt.y,left:kt.x},onClick:s=>s.stopPropagation(),children:[c.jsx("button",{onClick:()=>{Os(kt.member),Tt(null)},children:"View Profile"}),c.jsx("button",{onClick:()=>{Oo({id:kt.member.id,username:kt.member.username||kt.member.id}),Tt(null)},children:"Message"}),c.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(kt.member.id||""),w("User ID copied.")}catch{w("Could not copy user ID.")}Tt(null)},children:"Copy User ID"}),Ji&&kt.member.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:async()=>{await bd(kt.member.id),Tt(null)},children:"Kick Member"}),ir&&kt.member.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:async()=>{await Ed(kt.member.id,""),Tt(null)},children:"Ban Member"}),_d&&c.jsx("button",{onClick:()=>{$f(kt.member.id||""),hn(!0),Qe("moderation"),Tt(null)},children:"Open Moderation Panel"})]}),Ut&&c.jsxs("div",{className:"server-context-menu",style:{top:Ut.y,left:Ut.x},onClick:s=>s.stopPropagation(),children:[c.jsx("button",{onClick:()=>ES(Ut.server.id),children:"Open Server"}),Se&&Ut.server.id===j&&!!yt&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{Ms({fixedType:"text"}),nt(null)},children:"Create Text Channel"}),c.jsx("button",{onClick:()=>{Ms({fixedType:"voice"}),nt(null)},children:"Create Voice Channel"}),c.jsx("button",{onClick:()=>{Ms({fixedType:"category"}),nt(null)},children:"Create Category"})]}),c.jsx("button",{onClick:()=>Uh(Ut.server.id,"up"),children:"Move Up"}),c.jsx("button",{onClick:()=>Uh(Ut.server.id,"down"),children:"Move Down"}),c.jsx("button",{onClick:()=>{wf(Ut.server.id),hn(!0),Qe("invites"),nt(null)},children:"Create Invite"}),c.jsx("button",{onClick:()=>bS(Ut.server.id),children:"Copy Server ID"}),c.jsx("button",{onClick:()=>{hn(!0),Qe("server"),nt(null)},children:"Server Settings"}),c.jsx("button",{className:"danger",onClick:()=>kS(Ut.server),children:"Leave Server"}),(Ut.server.roles||[]).includes("owner")&&c.jsx("button",{className:"danger",onClick:()=>TS(Ut.server),children:"Delete Server"})]}),Or&&c.jsxs("div",{className:"server-context-menu",style:{top:Or.y,left:Or.x},onClick:s=>s.stopPropagation(),children:[Se&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>$o(Or.channel),children:"Edit Channel"}),c.jsx("button",{onClick:()=>{th(Or.channel.id),hn(!0),Qe("server"),qt(null)},children:"Permissions"})]}),c.jsx("button",{onClick:()=>{ae(Or.channel.id),qt(null)},children:"Open"}),Se&&c.jsx("button",{className:"danger",onClick:()=>Fh(Or.channel),children:"Delete"})]}),Ar&&c.jsx("div",{className:"server-context-menu",style:{top:Ar.y,left:Ar.x},onClick:s=>s.stopPropagation(),children:Se&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{Ms({fixedType:"text",fixedParentId:Ar.category.id}),Xt(null)},children:"Create Text Channel"}),c.jsx("button",{onClick:()=>{Ms({fixedType:"voice",fixedParentId:Ar.category.id}),Xt(null)},children:"Create Voice Channel"}),c.jsx("button",{onClick:()=>$o(Ar.category),children:"Edit Category"}),c.jsx("button",{className:"danger",onClick:()=>Fh(Ar.category),children:"Delete Category"})]})}),d_&&c.jsx("div",{className:"settings-overlay",onClick:()=>Mr(!1),children:c.jsxs("div",{className:"add-server-modal",onClick:s=>s.stopPropagation(),children:[c.jsxs("header",{className:"add-server-modal-header",children:[c.jsx("h3",{style:{margin:0},children:"Create or join a server"}),c.jsxs("div",{className:"add-server-tabs",children:[c.jsx("button",{type:"button",className:Rs==="join"?"active":"ghost",onClick:()=>ho("join"),children:"Join"}),c.jsx("button",{type:"button",className:Rs==="custom"?"active":"ghost",onClick:()=>ho("custom"),children:"Add host"}),c.jsx("button",{type:"button",className:Rs==="create"?"active":"ghost",onClick:()=>ho("create"),children:"Create yours"}),x.some(s=>{var d,m;return(m=(d=s==null?void 0:s.roles)==null?void 0:d.includes)==null?void 0:m.call(d,"owner")})&&c.jsx("a",{href:"/server-admin.html",target:"_blank",rel:"noopener noreferrer",className:"add-server-admin-link",onClick:s=>s.stopPropagation(),children:" Admin"})]})]}),c.jsxs("div",{className:"add-server-content",children:[Rs==="join"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Paste an invite code or full join link. Invite links are previewed and need explicit accept."}),c.jsx("input",{placeholder:"Invite code or join link",value:bs??"",onChange:s=>Oi(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("div",{className:"row-actions",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("button",{className:"ghost",onClick:xd,children:"Preview"}),c.jsx("button",{onClick:()=>Ph(gf||bs),children:"Accept Invite"})]}),fn&&c.jsxs("p",{className:"hint",style:{marginTop:"0.5rem"},children:["Invite: ",fn.code,"  Server: ",fn.serverName||fn.server_id,"  Uses: ",fn.uses]})]}),Rs==="custom"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Connect to a server node by URL (self-hosted or provider)."}),c.jsx("input",{placeholder:"Server name",value:Ss??"",onChange:s=>Ll(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"https://node.example.com",value:Cs??"https://",onChange:s=>Ml(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:xs??"",onChange:s=>Ol(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Al??"",onChange:s=>$l(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("button",{onClick:Ih,disabled:!Ss.trim()||!Cs.trim()||!xs.trim(),children:"Add Server"})]}),Rs==="create"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"One server hosted by usname it and customize channels and roles."}),c.jsx("input",{placeholder:"Server name",value:Lr??"",onChange:s=>Vl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:sr??"",onChange:s=>Wl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Hl??"",onChange:s=>Gl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("button",{onClick:Bh,disabled:!(Lr!=null&&Lr.trim())||!(sr!=null&&sr.trim()),children:"Create your server"})]})]}),c.jsx("button",{type:"button",className:"ghost",style:{width:"100%",marginTop:"0.5rem"},onClick:()=>Mr(!1),children:"Close"})]})}),ce&&c.jsxs("div",{className:"member-profile-popout",style:{right:fo.x,bottom:fo.y},onClick:s=>s.stopPropagation(),children:[c.jsx("div",{className:"popout-drag-handle",onMouseDown:vS,children:"Drag"}),c.jsx("div",{className:"popout-banner",style:{backgroundImage:ce.bannerUrl?`url(${It(ce.bannerUrl)})`:void 0}}),c.jsxs("div",{className:"popout-content",children:[(()=>{const s=T_(ce.id);return s?c.jsxs("div",{className:"message-embed-card",style:{marginBottom:"8px"},children:[s.largeImageUrl&&c.jsx("img",{src:s.largeImageUrl,alt:s.largeImageText||"Activity",style:{width:"100%",borderRadius:"8px",marginBottom:"6px"}}),c.jsx("strong",{children:s.name||"Activity"}),s.details&&c.jsx("p",{children:s.details}),s.state&&c.jsx("p",{children:s.state}),Array.isArray(s.buttons)&&s.buttons.length>0&&c.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"6px"},children:s.buttons.map((d,m)=>c.jsx("a",{href:d.url,target:"_blank",rel:"noreferrer",className:"ghost",style:{padding:"4px 8px",borderRadius:"8px",border:"1px solid var(--border-subtle)",textDecoration:"none",color:"var(--text-soft)"},children:d.label},`${d.url}-${m}`))})]}):null})(),c.jsx("div",{className:"avatar popout-avatar",children:ce.pfpUrl?c.jsx("img",{src:It(ce.pfpUrl),alt:"Profile avatar",className:"avatar-image"}):zn(ce.displayName||ce.username||"User")}),c.jsx("h4",{children:ce.displayName||ce.username}),c.jsxs("p",{className:"hint",children:["@",ce.username,"  ",To(mn(ce==null?void 0:ce.id)||(ce==null?void 0:ce.status)||"offline")]}),ce.platformTitle&&c.jsx("p",{className:"hint",children:ce.platformTitle}),Qh(ce.createdAt)&&c.jsxs("p",{className:"hint",children:["Account created: ",Qh(ce.createdAt)]}),Array.isArray(ce.badgeDetails)&&ce.badgeDetails.length>0&&c.jsx("div",{className:"popout-roles",children:ce.badgeDetails.map((s,d)=>{const m=US(s);return c.jsx("span",{className:"popout-role-tag",title:m.name,style:{backgroundColor:m.bgColor,color:m.fgColor,borderColor:m.bgColor},children:m.icon},`${s.id||s.name||"badge"}-${d}`)})}),((Jh=ce.roleIds)==null?void 0:Jh.length)>0&&(L==null?void 0:L.roles)&&c.jsx("div",{className:"popout-roles",children:(L.roles||[]).filter(s=>(ce.roleIds||[]).includes(s.id)&&!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>{const d=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return c.jsx("span",{className:"popout-role-tag",style:{backgroundColor:d+"22",color:d,borderColor:d},children:s.name},s.id)})}),c.jsx("p",{children:ce.bio||"No bio set."}),c.jsxs("div",{className:"popout-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>Oo({id:ce.id,username:ce.username}),children:"Message"}),Ji&&ce.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"ghost",onClick:()=>bd(ce.id),children:"Kick"}),ir&&ce.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:()=>Ed(ce.id,""),children:"Ban"}),c.jsx("button",{onClick:()=>$r(null),children:"Close"})]})]})]}),Fi&&c.jsx("div",{className:"settings-overlay",onClick:()=>hn(!1),children:c.jsxs("div",{className:"settings-panel",onClick:s=>s.stopPropagation(),children:[c.jsxs("aside",{className:"settings-nav",children:[c.jsx("h3",{children:"Settings"}),c.jsx("button",{className:Re==="profile"?"active":"ghost",onClick:()=>Qe("profile"),children:"Profile"}),c.jsx("button",{className:Re==="security"?"active":"ghost",onClick:()=>{Qe("security"),V_()},children:" Security"}),c.jsx("button",{className:Re==="billing"?"active":"ghost",onClick:()=>{Qe("billing"),Rh()},children:" Billing"}),c.jsx("button",{className:Re==="server"?"active":"ghost",onClick:()=>Qe("server"),children:"Server"}),c.jsx("button",{className:Re==="roles"?"active":"ghost",onClick:()=>Qe("roles"),children:"Roles"}),_d&&c.jsx("button",{className:Re==="moderation"?"active":"ghost",onClick:()=>Qe("moderation"),children:"Moderation"}),c.jsx("button",{className:Re==="invites"?"active":"ghost",onClick:()=>Qe("invites"),children:"Invites"}),c.jsx("button",{className:Re==="appearance"?"active":"ghost",onClick:()=>Qe("appearance"),children:"Appearance"}),c.jsx("button",{className:Re==="extensions"?"active":"ghost",onClick:()=>Qe("extensions"),children:"Extensions"}),c.jsx("button",{className:Re==="voice"?"active":"ghost",onClick:()=>Qe("voice"),children:"Voice"}),x.some(s=>s.roles.includes("owner"))&&c.jsx("a",{href:"/server-admin.html",target:"_blank",style:{display:"block",padding:"var(--space-sm) var(--space-md)",background:"rgba(149, 168, 205, 0.12)",border:"1px solid rgba(125, 164, 255, 0.25)",borderRadius:"calc(var(--radius) * 0.9)",color:"var(--text-main)",textDecoration:"none",textAlign:"center",fontWeight:"500",cursor:"pointer",fontSize:"0.95em"},children:" Server Admin Panel"}),c.jsx("button",{className:"ghost",onClick:()=>hn(!1),children:"Close"})]}),c.jsxs("section",{className:"settings-content",children:[Re==="profile"&&c.jsxs("div",{className:"card",children:[c.jsx("h4",{children:"Profile Settings"}),c.jsxs("label",{children:["Display Name",c.jsx("input",{value:jn.displayName,onChange:s=>tr(d=>({...d,displayName:s.target.value}))})]}),c.jsxs("label",{children:["Bio",c.jsx("textarea",{rows:4,value:jn.bio,onChange:s=>tr(d=>({...d,bio:s.target.value}))})]}),c.jsxs("label",{children:["Avatar URL",c.jsx("input",{value:jn.pfpUrl,onChange:s=>tr(d=>({...d,pfpUrl:s.target.value}))})]}),c.jsxs("label",{children:["Upload Avatar",c.jsx("input",{type:"file",accept:"image/*",onChange:$S})]}),c.jsxs("label",{children:["Banner URL",c.jsx("input",{value:jn.bannerUrl,onChange:s=>tr(d=>({...d,bannerUrl:s.target.value}))})]}),c.jsxs("label",{children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:FS})]}),c.jsx("button",{onClick:tS,children:"Save Profile"}),c.jsx("hr",{style:{borderColor:"var(--border-subtle)",width:"100%"}}),c.jsx("h4",{children:"Rich Presence (RPC-style)"}),c.jsx("p",{className:"hint",children:"No app ID needed. Set activity text, image URLs, and optional buttons."}),c.jsxs("label",{children:["Activity Name",c.jsx("input",{value:Ft.name,onChange:s=>Et(d=>({...d,name:s.target.value})),placeholder:"Playing OpenCom"})]}),c.jsxs("label",{children:["Details",c.jsx("input",{value:Ft.details,onChange:s=>Et(d=>({...d,details:s.target.value})),placeholder:"In a voice channel"})]}),c.jsxs("label",{children:["State",c.jsx("input",{value:Ft.state,onChange:s=>Et(d=>({...d,state:s.target.value})),placeholder:"With friends"})]}),c.jsxs("label",{children:["Large Image URL",c.jsx("input",{value:Ft.largeImageUrl,onChange:s=>Et(d=>({...d,largeImageUrl:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Large Image Text",c.jsx("input",{value:Ft.largeImageText,onChange:s=>Et(d=>({...d,largeImageText:s.target.value})),placeholder:"Tooltip text"})]}),c.jsxs("label",{children:["Small Image URL",c.jsx("input",{value:Ft.smallImageUrl,onChange:s=>Et(d=>({...d,smallImageUrl:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Small Image Text",c.jsx("input",{value:Ft.smallImageText,onChange:s=>Et(d=>({...d,smallImageText:s.target.value})),placeholder:"Tooltip text"})]}),c.jsxs("label",{children:["Button 1 Label",c.jsx("input",{value:Ft.button1Label,onChange:s=>Et(d=>({...d,button1Label:s.target.value})),placeholder:"Watch"})]}),c.jsxs("label",{children:["Button 1 URL",c.jsx("input",{value:Ft.button1Url,onChange:s=>Et(d=>({...d,button1Url:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Button 2 Label",c.jsx("input",{value:Ft.button2Label,onChange:s=>Et(d=>({...d,button2Label:s.target.value})),placeholder:"Join"})]}),c.jsxs("label",{children:["Button 2 URL",c.jsx("input",{value:Ft.button2Url,onChange:s=>Et(d=>({...d,button2Url:s.target.value})),placeholder:"https://..."})]}),c.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[c.jsx("button",{onClick:nS,children:"Save Rich Presence"}),c.jsx("button",{className:"ghost",onClick:rS,children:"Clear"})]})]}),Re==="server"&&c.jsxs(c.Fragment,{children:[O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Server Branding"}),c.jsx("input",{placeholder:"Server name",value:nr.name??"",onChange:s=>Mi(d=>({...d,name:s.target.value}))}),c.jsx("input",{placeholder:"Logo URL",value:nr.logoUrl??"",onChange:s=>Mi(d=>({...d,logoUrl:s.target.value}))}),c.jsx("input",{placeholder:"Banner URL",value:nr.bannerUrl??"",onChange:s=>Mi(d=>({...d,bannerUrl:s.target.value}))}),c.jsx("button",{onClick:sS,children:"Save Server Profile"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Add Server Provider"}),c.jsx("input",{placeholder:"Server name",value:Ss??"",onChange:s=>Ll(s.target.value)}),c.jsx("input",{placeholder:"https://node.provider.tld",value:Cs??"https://",onChange:s=>Ml(s.target.value)}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:xs??"",onChange:s=>Ol(s.target.value)}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Al??"",onChange:s=>$l(s.target.value)}),c.jsx("button",{onClick:Ih,disabled:!Ss.trim()||!Cs.trim()||!xs.trim(),children:"Add Server"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Voice Gateway Routing"}),c.jsx("p",{className:"hint",children:"Default is OpenCom core gateway. Switch to self-hosted to reduce latency for your server."}),c.jsxs("label",{children:["Voice Gateway Mode",c.jsxs("select",{value:Ch.mode,onChange:s=>Nh({mode:s.target.value==="server"?"server":"core"}),children:[c.jsx("option",{value:"core",children:"OpenCom Core (default)"}),c.jsx("option",{value:"server",children:"Self-hosted/Server-first"})]})]}),c.jsxs("label",{children:["Optional custom gateway URL",c.jsx("input",{placeholder:"https://gateway.yourserver.tld",value:Ch.customUrl,onChange:s=>Nh({customUrl:s.target.value})})]}),c.jsx("p",{className:"hint",children:"Client fallback order follows this mode and automatically tries the other gateways if one fails."})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Workspace"}),c.jsx("input",{placeholder:"Workspace name",value:Ai??"",onChange:s=>Tf(s.target.value)}),c.jsx("button",{onClick:iS,children:"Create Workspace"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Channel"}),c.jsx("input",{placeholder:"New channel/category",value:Ul??"",onChange:s=>bf(s.target.value)}),c.jsxs("select",{value:ao??"text",onChange:s=>Ww(s.target.value),children:[c.jsx("option",{value:"text",children:"Text Channel"}),c.jsx("option",{value:"voice",children:"Voice Channel"}),c.jsx("option",{value:"category",children:"Category"})]}),ao!=="category"&&c.jsxs("select",{value:Ef??"",onChange:s=>kf(s.target.value),children:[c.jsx("option",{value:"",children:"No category"}),(qi||[]).map(s=>c.jsx("option",{value:(s==null?void 0:s.id)??"",children:(s==null?void 0:s.name)??"Category"},(s==null?void 0:s.id)??""))]}),c.jsx("button",{onClick:oS,children:"Create Channel"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Custom Emotes"}),c.jsxs("p",{className:"hint",children:["Use emotes in chat with ",c.jsx("code",{children:":name:"}),"."]}),c.jsx("input",{placeholder:"Emote name (example: hype)",value:Yt,onChange:s=>Ae(s.target.value)}),c.jsx("input",{placeholder:"Emote image URL (.png/.gif/.webp/.svg)",value:er,onChange:s=>mf(s.target.value)}),c.jsx("button",{onClick:cS,children:"Create Emote"}),c.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:((L==null?void 0:L.emotes)||[]).map(s=>c.jsxs("li",{children:[c.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[c.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:s.name}),c.jsxs("code",{children:[":",s.name,":"]})]}),c.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>lS(s.id),children:"Remove"})]},s.id))})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Channel permissions"}),c.jsx("p",{className:"hint",children:"Choose a channel and set which roles can send messages there. By default everyone can send."}),c.jsxs("select",{value:_o,onChange:s=>th(s.target.value),children:[c.jsx("option",{value:"",children:"Select channel"}),(Ds||[]).filter(s=>s.type==="text").map(s=>c.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]}),_o&&c.jsx("ul",{className:"channel-perms-role-list",children:((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>c.jsx("li",{children:c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:fS(_o,s.id),onChange:d=>pS(_o,s.id,d.target.checked)}),c.jsx("span",{className:"channel-perms-role-name",style:{color:s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5"},children:s.name}),c.jsx("span",{className:"hint",children:" can send here"})]})},s.id))})]}),Re==="server"&&!O&&x.length>0&&c.jsx("p",{className:"hint",children:"Select a server from the sidebar to manage workspaces and channels."})]}),Re==="roles"&&Se&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Role"}),c.jsx("input",{placeholder:"Role name",value:Ql,onChange:s=>Af(s.target.value)}),c.jsx("button",{onClick:hS,children:"Create Role"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Edit Roles (colour & hierarchy)"}),c.jsx("p",{className:"hint",children:"Higher position = higher in the list. Colours show in member list and chat."}),c.jsx("ul",{className:"role-edit-list",children:((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>{const d=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return c.jsxs("li",{className:"role-edit-row",children:[c.jsx("span",{className:"role-edit-name",style:{color:d},children:s.name}),c.jsx("input",{type:"color",value:d,onChange:m=>$h(s.id,{color:m.target.value}),title:"Role colour"}),c.jsxs("label",{children:["Position ",c.jsx("input",{type:"number",min:0,value:s.position??0,onChange:m=>$h(s.id,{position:parseInt(m.target.value,10)||0})})]})]},s.id)})})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Assign Role"}),c.jsxs("select",{value:Yl,onChange:s=>i_(s.target.value),children:[c.jsx("option",{value:"",children:"Select member"}),st.map(s=>c.jsx("option",{value:s.id,children:s.username},s.id))]}),c.jsxs("select",{value:Kl,onChange:s=>s_(s.target.value),children:[c.jsx("option",{value:"",children:"Select role"}),((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]}),c.jsx("button",{onClick:mS,children:"Assign Role"})]})]}),Re==="moderation"&&_d&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Member moderation"}),c.jsx("p",{className:"hint",children:"Kick removes a member from this guild. Ban removes and blocks rejoin until unbanned."}),c.jsxs("select",{value:$i,onChange:s=>$f(s.target.value),children:[c.jsx("option",{value:"",children:"Select member"}),st.filter(s=>s.id!==(l==null?void 0:l.id)).map(s=>c.jsx("option",{value:s.id,children:s.username},s.id))]}),ir&&c.jsx("input",{placeholder:"Ban reason (optional)",value:Ff,onChange:s=>a_(s.target.value)}),c.jsxs("div",{className:"row-actions",children:[Ji&&c.jsx("button",{disabled:!$i||ks,onClick:()=>bd($i),children:"Kick Member"}),ir&&c.jsx("button",{className:"danger",disabled:!$i||ks,onClick:()=>Ed($i,Ff),children:"Ban Member"})]})]}),ir&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Unban user"}),c.jsx("p",{className:"hint",children:"Paste a user ID and remove their ban record."}),c.jsx("input",{placeholder:"User ID to unban",value:Jl,onChange:s=>Uf(s.target.value)}),c.jsx("button",{disabled:!Jl.trim()||ks,onClick:()=>gS(Jl.trim()),children:"Unban User"})]})]}),Re==="invites"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Join Server"}),c.jsx("input",{placeholder:"Paste invite code or join link",value:bs,onChange:s=>Oi(s.target.value)}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:xd,children:"Preview"}),c.jsx("button",{onClick:()=>Ph(gf||bs),children:"Accept Invite"})]}),fn&&c.jsxs("p",{className:"hint",children:["Invite: ",fn.code,"  Server: ",fn.serverName||fn.server_id,"  Uses: ",fn.uses]})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Invite"}),c.jsxs("p",{className:"hint",children:["Boost perk: custom code + permanent invite links (example: ",c.jsx("code",{children:"?joinOpen"}),")."]}),c.jsxs("select",{value:Fl,onChange:s=>wf(s.target.value),children:[c.jsx("option",{value:"",children:"Select server"}),x.map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]}),c.jsx("input",{placeholder:"Custom code (Boost perk, optional)",value:Sf,onChange:s=>Cf(s.target.value)}),c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[c.jsx("input",{type:"checkbox",checked:xf,onChange:s=>Vw(s.target.checked)}),"Permanent invite (Boost perk)"]}),c.jsx("button",{onClick:aS,children:"Generate Invite"}),so&&c.jsxs(c.Fragment,{children:[c.jsxs("p",{className:"hint",children:["Code: ",c.jsx("code",{children:so})]}),c.jsx("p",{className:"hint",children:"Invite link (share this):"}),c.jsxs("div",{className:"invite-link-row",children:[c.jsx("input",{readOnly:!0,className:"invite-link-input",value:_f||Lg(so)}),c.jsx("button",{type:"button",onClick:()=>{const s=_f||Lg(so);navigator.clipboard.writeText(s).then(()=>w("Invite link copied.")).catch(()=>w("Could not copy."))},children:"Copy link"})]})]})]})]}),Re==="extensions"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Client Extensions"}),c.jsx("p",{className:"hint",children:"Enable reviewed client-only extensions from the catalog. Extensions run in your client session."}),oh.length?c.jsx("ul",{className:"channel-perms-role-list",children:oh.map(s=>{const d=Hi.includes(s.id);return c.jsxs("li",{children:[c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:d,onChange:m=>D_(s.id,m.target.checked)}),c.jsx("strong",{children:s.name}),c.jsxs("span",{className:"hint",children:["  ",s.id,"  ",s.version||"0.1.0"]}),c.jsx("span",{className:"hint",style:{marginLeft:"6px",color:d?"#4ec97e":"#f0a4a4"},children:d?"Enabled":"Disabled"})]}),s.description&&c.jsx("p",{className:"hint",style:{margin:"4px 0 0 24px"},children:s.description}),xo[s.id]&&c.jsxs("p",{className:"hint",style:{margin:"2px 0 0 24px"},children:["Status: ",xo[s.id]]})]},s.id)})}):c.jsx("p",{className:"hint",children:"No client extensions found in the catalog."})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Developer Mode"}),c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[c.jsx("input",{type:"checkbox",checked:Is,onChange:s=>k_(s.target.checked)}),"Enable local/testing extension URLs"]}),c.jsx("p",{className:"hint",children:"Use this while developing extensions. Add one URL per extension entry script."}),Is&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"row-actions",style:{marginTop:"8px"},children:[c.jsx("input",{placeholder:"http://localhost:5174/my-extension.js",value:lh,onChange:s=>dh(s.target.value),style:{flex:1}}),c.jsx("button",{onClick:L_,children:"Add URL"})]}),c.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:Gi.map(s=>c.jsxs("li",{children:[c.jsx("span",{style:{wordBreak:"break-all"},children:s}),c.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>ch(d=>d.filter(m=>m!==s)),children:"Remove"}),xo[`dev:${s}`]&&c.jsxs("p",{className:"hint",style:{margin:"4px 0 0 0"},children:["Status: ",xo[`dev:${s}`]]})]},s))})]})]})]}),Re==="appearance"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Custom CSS Theme"}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:f_,onChange:s=>h_(s.target.checked)})," Enable custom CSS"]}),c.jsx("input",{type:"file",accept:"text/css,.css",onChange:BS}),c.jsx("textarea",{value:p_,onChange:s=>Hf(s.target.value),rows:10,placeholder:"Paste custom CSS"})]}),Re==="voice"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Voice Settings"}),c.jsxs("label",{children:["Input Device",c.jsxs("select",{value:Dn,onChange:s=>Df(s.target.value),children:[c.jsx("option",{value:"",children:"System default"}),qw.map(s=>c.jsx("option",{value:s.deviceId,children:s.label||`Microphone ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),c.jsxs("label",{children:["Output Device",c.jsxs("select",{value:rr,onChange:s=>Lf(s.target.value),children:[c.jsx("option",{value:"",children:"System default"}),Zw.map(s=>c.jsx("option",{value:s.deviceId,children:s.label||`Speaker ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),c.jsxs("label",{children:["Microphone Gain (",lo,"%)",c.jsx("input",{type:"range",min:"0",max:"200",step:"5",value:lo,onChange:s=>Yw(Number(s.target.value))})]}),c.jsxs("label",{children:["Mic Sensitivity (",Es,"%)",c.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Es,onChange:s=>Jw(Number(s.target.value))})]}),c.jsx("p",{className:"hint",children:"Tip: allow microphone permissions so device names show properly."})]}),Re==="billing"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"OpenCom Boost"}),c.jsx("p",{className:"hint",children:"10/month  100MB upload limit  Unlimited servers. More Boost features are coming soon."}),l_&&c.jsx("p",{className:"hint",children:"Loading billing status"}),Ui&&c.jsxs(c.Fragment,{children:[c.jsxs("p",{className:"hint",children:["Status: ",Ui.active?"Active":"Inactive",Ui.currentPeriodEnd?`  Renews ${new Date(Ui.currentPeriodEnd).toLocaleDateString()}`:""]}),!Ui.stripeConfigured&&c.jsx("p",{className:"hint",children:"Stripe is not configured on this server yet."})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{onClick:W_,children:"Subscribe to OpenCom Boost"}),c.jsx("button",{className:"ghost",onClick:H_,children:"Manage Subscription"}),c.jsx("button",{className:"ghost",onClick:Rh,children:"Refresh"})]})]}),Re==="security"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Account Security"}),c.jsxs("div",{className:"security-info",children:[c.jsxs("p",{className:"hint",children:["Last login: ",new Date(Kf.date).toLocaleString()]}),c.jsxs("p",{className:"hint",children:["Device: ",Kf.device]})]})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Change Password"}),g_?c.jsxs(c.Fragment,{children:[c.jsxs("label",{children:["Current Password",c.jsx("input",{type:"password",value:Gf,onChange:s=>td(s.target.value)})]}),c.jsxs("label",{children:["New Password",c.jsx("input",{type:"password",value:mo,onChange:s=>nd(s.target.value)})]}),c.jsxs("label",{children:["Confirm Password",c.jsx("input",{type:"password",value:Qf,onChange:s=>rd(s.target.value)})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>{ed(!1),td(""),nd(""),rd("")},children:"Cancel"}),c.jsx("button",{onClick:async()=>{if(mo!==Qf){w("Passwords do not match.");return}if(mo.length<8){w("Password must be at least 8 characters.");return}try{await re("/v1/auth/password",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({currentPassword:Gf,newPassword:mo})}),w("Password changed successfully."),ed(!1),td(""),nd(""),rd("")}catch(s){w(`Could not change password: ${s.message}`)}},children:"Update Password"})]})]}):c.jsx("button",{onClick:()=>ed(!0),children:"Change Password"})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Two-Factor Authentication"}),c.jsx("p",{className:"hint",children:"Secure your account with an additional authentication layer"}),!Zf.twoFactorEnabled&&!Xf&&c.jsx("button",{onClick:K_,children:"Enable 2FA"}),Xf&&!__&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"hint",style:{marginTop:"var(--space-sm)",fontWeight:600},children:" Step 1: Scan QR Code"}),c.jsx("p",{className:"hint",children:"Scan this QR code with an authenticator app (Google Authenticator, Authy, Microsoft Authenticator, etc.):"}),Yf&&c.jsx("img",{src:Yf,alt:"2FA QR Code",style:{width:"200px",height:"200px",border:"2px solid rgba(125, 164, 255, 0.3)",borderRadius:"var(--radius)",margin:"var(--space-sm) 0",background:"#fff",padding:"0.5em"}}),c.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 2: Verify Token"}),c.jsx("p",{className:"hint",children:"Enter a 6-digit code from your authenticator app:"}),c.jsx("input",{type:"text",placeholder:"000000",value:qf,onChange:s=>id(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:"6",style:{textAlign:"center",fontSize:"1.2em",letterSpacing:"0.3em",fontFamily:"monospace"}}),c.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 3: Save Backup Codes"}),c.jsx("p",{className:"hint",children:"Save these backup codes somewhere safe. You can use them to regain access if you lose your authenticator."}),c.jsx("code",{style:{display:"block",background:"var(--bg-input)",padding:"var(--space-sm)",borderRadius:"calc(var(--radius)*0.8)",fontSize:"0.85em",marginBottom:"var(--space-sm)",whiteSpace:"pre-wrap",wordBreak:"break-all",fontFamily:"monospace",lineHeight:"1.8"},children:Jf.map(s=>`${s}
`).join("")}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>{vo(!1),sd(""),go([]),id("")},children:"Cancel"}),c.jsx("button",{onClick:Z_,children:"Verify & Enable 2FA"})]})]}),Zf.twoFactorEnabled&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{color:"var(--green)",fontWeight:600,marginTop:"var(--space-sm)"},children:" 2FA is enabled"}),c.jsx("p",{className:"hint",children:"Your account is protected with two-factor authentication. Your backup codes are stored securely."}),c.jsx("button",{className:"danger",onClick:eS,style:{marginTop:"var(--space-sm)"},children:"Disable 2FA"})]})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Active Sessions"}),c.jsx("p",{className:"hint",children:"Devices where you're logged in. Sign out of any session you don't recognize."}),v_.map(s=>c.jsxs("div",{className:"session-item",children:[c.jsxs("div",{className:"session-info",children:[c.jsx("strong",{children:s.device}),c.jsx("span",{className:"hint",children:s.location}),c.jsxs("span",{className:"hint",children:["Last active: ",s.lastActive]})]}),c.jsx("button",{className:s.status==="active"?"ghost":"danger",onClick:()=>w(`Session ${s.device} would be signed out.`),children:s.status==="active"?"Current":"Sign Out"})]},s.id))]}),c.jsxs("section",{className:"card security-card danger-card",children:[c.jsx("h4",{children:" Danger Zone"}),c.jsx("p",{className:"hint",children:"Irreversible actions. Proceed with caution."}),c.jsx("button",{className:"danger",onClick:()=>{window.confirm("Are you absolutely sure? This cannot be undone.")&&w("Account deletion request submitted for review.")},children:"Delete Account Permanently"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Security Privacy"}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox"})," Log out of all other sessions"]}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox"})," Show security alerts"]}),c.jsx("button",{onClick:()=>w("Privacy settings saved."),children:"Save Security Settings"})]})]}),c.jsx("p",{className:"status",children:N})]})]})})]}):Vi===Qn?c.jsx(ME,{downloadMenuRef:yd,downloadsMenuOpen:S_,setDownloadsMenuOpen:ld,downloadTargets:ip,preferredDownloadTarget:I_,onOpenClient:()=>Br(di)}):c.jsx(OE,{authMode:f,setAuthMode:h,email:_,setEmail:p,username:S,setUsername:k,password:M,setPassword:V,pendingVerificationEmail:B,status:N,onSubmit:$_,onResendVerification:F_,onBackHome:()=>Br(Qn)})}mw(document.getElementById("root")).render(c.jsx(lC.StrictMode,{children:c.jsx(ok,{})}));
