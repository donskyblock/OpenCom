var lb=Object.defineProperty;var zv=e=>{throw TypeError(e)};var db=(e,t,n)=>t in e?lb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>db(e,typeof t!="symbol"?t+"":t,n),Vv=(e,t,n)=>t.has(e)||zv("Cannot "+n);var he=(e,t,n)=>(Vv(e,t,"read from private field"),n?n.call(e):t.get(e)),ft=(e,t,n)=>t.has(e)?zv("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Me=(e,t,n,r)=>(Vv(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();function ub(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yw={exports:{}},Pd={},Jw={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hc=Symbol.for("react.element"),pb=Symbol.for("react.portal"),fb=Symbol.for("react.fragment"),hb=Symbol.for("react.strict_mode"),mb=Symbol.for("react.profiler"),gb=Symbol.for("react.provider"),vb=Symbol.for("react.context"),yb=Symbol.for("react.forward_ref"),wb=Symbol.for("react.suspense"),Sb=Symbol.for("react.memo"),_b=Symbol.for("react.lazy"),Gv=Symbol.iterator;function xb(e){return e===null||typeof e!="object"?null:(e=Gv&&e[Gv]||e["@@iterator"],typeof e=="function"?e:null)}var qw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xw=Object.assign,Zw={};function Uo(e,t,n){this.props=e,this.context=t,this.refs=Zw,this.updater=n||qw}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Uo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function eS(){}eS.prototype=Uo.prototype;function ch(e,t,n){this.props=e,this.context=t,this.refs=Zw,this.updater=n||qw}var lh=ch.prototype=new eS;lh.constructor=ch;Xw(lh,Uo.prototype);lh.isPureReactComponent=!0;var Hv=Array.isArray,tS=Object.prototype.hasOwnProperty,dh={current:null},nS={key:!0,ref:!0,__self:!0,__source:!0};function rS(e,t,n){var r,i={},c=null,u=null;if(t!=null)for(r in t.ref!==void 0&&(u=t.ref),t.key!==void 0&&(c=""+t.key),t)tS.call(t,r)&&!nS.hasOwnProperty(r)&&(i[r]=t[r]);var h=arguments.length-2;if(h===1)i.children=n;else if(1<h){for(var g=Array(h),S=0;S<h;S++)g[S]=arguments[S+2];i.children=g}if(e&&e.defaultProps)for(r in h=e.defaultProps,h)i[r]===void 0&&(i[r]=h[r]);return{$$typeof:hc,type:e,key:c,ref:u,props:i,_owner:dh.current}}function Cb(e,t){return{$$typeof:hc,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function uh(e){return typeof e=="object"&&e!==null&&e.$$typeof===hc}function bb(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Wv=/\/+/g;function bp(e,t){return typeof e=="object"&&e!==null&&e.key!=null?bb(""+e.key):t.toString(36)}function Fl(e,t,n,r,i){var c=typeof e;(c==="undefined"||c==="boolean")&&(e=null);var u=!1;if(e===null)u=!0;else switch(c){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case hc:case pb:u=!0}}if(u)return u=e,i=i(u),e=r===""?"."+bp(u,0):r,Hv(i)?(n="",e!=null&&(n=e.replace(Wv,"$&/")+"/"),Fl(i,t,n,"",function(S){return S})):i!=null&&(uh(i)&&(i=Cb(i,n+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(Wv,"$&/")+"/")+e)),t.push(i)),1;if(u=0,r=r===""?".":r+":",Hv(e))for(var h=0;h<e.length;h++){c=e[h];var g=r+bp(c,h);u+=Fl(c,t,n,g,i)}else if(g=xb(e),typeof g=="function")for(e=g.call(e),h=0;!(c=e.next()).done;)c=c.value,g=r+bp(c,h++),u+=Fl(c,t,n,g,i);else if(c==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function vl(e,t,n){if(e==null)return e;var r=[],i=0;return Fl(e,r,"","",function(c){return t.call(n,c,i++)}),r}function Eb(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Gt={current:null},Bl={transition:null},kb={ReactCurrentDispatcher:Gt,ReactCurrentBatchConfig:Bl,ReactCurrentOwner:dh};function sS(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:vl,forEach:function(e,t,n){vl(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return vl(e,function(){t++}),t},toArray:function(e){return vl(e,function(t){return t})||[]},only:function(e){if(!uh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ve.Component=Uo;ve.Fragment=fb;ve.Profiler=mb;ve.PureComponent=ch;ve.StrictMode=hb;ve.Suspense=wb;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kb;ve.act=sS;ve.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Xw({},e.props),i=e.key,c=e.ref,u=e._owner;if(t!=null){if(t.ref!==void 0&&(c=t.ref,u=dh.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var h=e.type.defaultProps;for(g in t)tS.call(t,g)&&!nS.hasOwnProperty(g)&&(r[g]=t[g]===void 0&&h!==void 0?h[g]:t[g])}var g=arguments.length-2;if(g===1)r.children=n;else if(1<g){h=Array(g);for(var S=0;S<g;S++)h[S]=arguments[S+2];r.children=h}return{$$typeof:hc,type:e.type,key:i,ref:c,props:r,_owner:u}};ve.createContext=function(e){return e={$$typeof:vb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gb,_context:e},e.Consumer=e};ve.createElement=rS;ve.createFactory=function(e){var t=rS.bind(null,e);return t.type=e,t};ve.createRef=function(){return{current:null}};ve.forwardRef=function(e){return{$$typeof:yb,render:e}};ve.isValidElement=uh;ve.lazy=function(e){return{$$typeof:_b,_payload:{_status:-1,_result:e},_init:Eb}};ve.memo=function(e,t){return{$$typeof:Sb,type:e,compare:t===void 0?null:t}};ve.startTransition=function(e){var t=Bl.transition;Bl.transition={};try{e()}finally{Bl.transition=t}};ve.unstable_act=sS;ve.useCallback=function(e,t){return Gt.current.useCallback(e,t)};ve.useContext=function(e){return Gt.current.useContext(e)};ve.useDebugValue=function(){};ve.useDeferredValue=function(e){return Gt.current.useDeferredValue(e)};ve.useEffect=function(e,t){return Gt.current.useEffect(e,t)};ve.useId=function(){return Gt.current.useId()};ve.useImperativeHandle=function(e,t,n){return Gt.current.useImperativeHandle(e,t,n)};ve.useInsertionEffect=function(e,t){return Gt.current.useInsertionEffect(e,t)};ve.useLayoutEffect=function(e,t){return Gt.current.useLayoutEffect(e,t)};ve.useMemo=function(e,t){return Gt.current.useMemo(e,t)};ve.useReducer=function(e,t,n){return Gt.current.useReducer(e,t,n)};ve.useRef=function(e){return Gt.current.useRef(e)};ve.useState=function(e){return Gt.current.useState(e)};ve.useSyncExternalStore=function(e,t,n){return Gt.current.useSyncExternalStore(e,t,n)};ve.useTransition=function(){return Gt.current.useTransition()};ve.version="18.3.1";Jw.exports=ve;var x=Jw.exports;const Tb=ub(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rb=x,Ib=Symbol.for("react.element"),jb=Symbol.for("react.fragment"),Nb=Object.prototype.hasOwnProperty,Pb=Rb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lb={key:!0,ref:!0,__self:!0,__source:!0};function iS(e,t,n){var r,i={},c=null,u=null;n!==void 0&&(c=""+n),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(u=t.ref);for(r in t)Nb.call(t,r)&&!Lb.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:Ib,type:e,key:c,ref:u,props:i,_owner:Pb.current}}Pd.Fragment=jb;Pd.jsx=iS;Pd.jsxs=iS;Yw.exports=Pd;var o=Yw.exports,oS={exports:{}},vn={},aS={exports:{}},cS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(H,X){var Q=H.length;H.push(X);e:for(;0<Q;){var ae=Q-1>>>1,V=H[ae];if(0<i(V,X))H[ae]=X,H[Q]=V,Q=ae;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var X=H[0],Q=H.pop();if(Q!==X){H[0]=Q;e:for(var ae=0,V=H.length,W=V>>>1;ae<W;){var ie=2*(ae+1)-1,fe=H[ie],we=ie+1,et=H[we];if(0>i(fe,Q))we<V&&0>i(et,fe)?(H[ae]=et,H[we]=Q,ae=we):(H[ae]=fe,H[ie]=Q,ae=ie);else if(we<V&&0>i(et,Q))H[ae]=et,H[we]=Q,ae=we;else break e}}return X}function i(H,X){var Q=H.sortIndex-X.sortIndex;return Q!==0?Q:H.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var u=Date,h=u.now();e.unstable_now=function(){return u.now()-h}}var g=[],S=[],p=1,C=null,R=3,D=!1,B=!1,$=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(H){for(var X=n(S);X!==null;){if(X.callback===null)r(S);else if(X.startTime<=H)r(S),X.sortIndex=X.expirationTime,t(g,X);else break;X=n(S)}}function b(H){if($=!1,v(H),!B)if(n(g)!==null)B=!0,me(P);else{var X=n(S);X!==null&&U(b,X.startTime-H)}}function P(H,X){B=!1,$&&($=!1,l(I),I=-1),D=!0;var Q=R;try{for(v(X),C=n(g);C!==null&&(!(C.expirationTime>X)||H&&!F());){var ae=C.callback;if(typeof ae=="function"){C.callback=null,R=C.priorityLevel;var V=ae(C.expirationTime<=X);X=e.unstable_now(),typeof V=="function"?C.callback=V:C===n(g)&&r(g),v(X)}else r(g);C=n(g)}if(C!==null)var W=!0;else{var ie=n(S);ie!==null&&U(b,ie.startTime-X),W=!1}return W}finally{C=null,R=Q,D=!1}}var w=!1,k=null,I=-1,O=5,L=-1;function F(){return!(e.unstable_now()-L<O)}function q(){if(k!==null){var H=e.unstable_now();L=H;var X=!0;try{X=k(!0,H)}finally{X?z():(w=!1,k=null)}}else w=!1}var z;if(typeof f=="function")z=function(){f(q)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,te=Z.port2;Z.port1.onmessage=q,z=function(){te.postMessage(null)}}else z=function(){y(q,0)};function me(H){k=H,w||(w=!0,z())}function U(H,X){I=y(function(){H(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){B||D||(B=!0,me(P))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return R},e.unstable_getFirstCallbackNode=function(){return n(g)},e.unstable_next=function(H){switch(R){case 1:case 2:case 3:var X=3;break;default:X=R}var Q=R;R=X;try{return H()}finally{R=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,X){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Q=R;R=H;try{return X()}finally{R=Q}},e.unstable_scheduleCallback=function(H,X,Q){var ae=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ae+Q:ae):Q=ae,H){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=Q+V,H={id:p++,callback:X,priorityLevel:H,startTime:Q,expirationTime:V,sortIndex:-1},Q>ae?(H.sortIndex=Q,t(S,H),n(g)===null&&H===n(S)&&($?(l(I),I=-1):$=!0,U(b,Q-ae))):(H.sortIndex=V,t(g,H),B||D||(B=!0,me(P))),H},e.unstable_shouldYield=F,e.unstable_wrapCallback=function(H){var X=R;return function(){var Q=R;R=X;try{return H.apply(this,arguments)}finally{R=Q}}}})(cS);aS.exports=cS;var Db=aS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mb=x,gn=Db;function J(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lS=new Set,Ja={};function hi(e,t){No(e,t),No(e+"Capture",t)}function No(e,t){for(Ja[e]=t,e=0;e<t.length;e++)lS.add(t[e])}var Mr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),df=Object.prototype.hasOwnProperty,Ob=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Kv={},Qv={};function Ab(e){return df.call(Qv,e)?!0:df.call(Kv,e)?!1:Ob.test(e)?Qv[e]=!0:(Kv[e]=!0,!1)}function Ub(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function $b(e,t,n,r){if(t===null||typeof t>"u"||Ub(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ht(e,t,n,r,i,c,u){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=c,this.removeEmptyString=u}var yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){yt[e]=new Ht(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];yt[t]=new Ht(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){yt[e]=new Ht(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){yt[e]=new Ht(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){yt[e]=new Ht(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){yt[e]=new Ht(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){yt[e]=new Ht(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){yt[e]=new Ht(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){yt[e]=new Ht(e,5,!1,e.toLowerCase(),null,!1,!1)});var ph=/[\-:]([a-z])/g;function fh(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(ph,fh);yt[t]=new Ht(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(ph,fh);yt[t]=new Ht(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(ph,fh);yt[t]=new Ht(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){yt[e]=new Ht(e,1,!1,e.toLowerCase(),null,!1,!1)});yt.xlinkHref=new Ht("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){yt[e]=new Ht(e,1,!1,e.toLowerCase(),null,!0,!0)});function hh(e,t,n,r){var i=yt.hasOwnProperty(t)?yt[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&($b(t,n,i,r)&&(n=null),r||i===null?Ab(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var $r=Mb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yl=Symbol.for("react.element"),io=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),mh=Symbol.for("react.strict_mode"),uf=Symbol.for("react.profiler"),dS=Symbol.for("react.provider"),uS=Symbol.for("react.context"),gh=Symbol.for("react.forward_ref"),pf=Symbol.for("react.suspense"),ff=Symbol.for("react.suspense_list"),vh=Symbol.for("react.memo"),ns=Symbol.for("react.lazy"),pS=Symbol.for("react.offscreen"),Yv=Symbol.iterator;function ya(e){return e===null||typeof e!="object"?null:(e=Yv&&e[Yv]||e["@@iterator"],typeof e=="function"?e:null)}var Ve=Object.assign,Ep;function Da(e){if(Ep===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ep=t&&t[1]||""}return`
`+Ep+e}var kp=!1;function Tp(e,t){if(!e||kp)return"";kp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(S){var r=S}Reflect.construct(e,[],t)}else{try{t.call()}catch(S){r=S}e.call(t.prototype)}else{try{throw Error()}catch(S){r=S}e()}}catch(S){if(S&&r&&typeof S.stack=="string"){for(var i=S.stack.split(`
`),c=r.stack.split(`
`),u=i.length-1,h=c.length-1;1<=u&&0<=h&&i[u]!==c[h];)h--;for(;1<=u&&0<=h;u--,h--)if(i[u]!==c[h]){if(u!==1||h!==1)do if(u--,h--,0>h||i[u]!==c[h]){var g=`
`+i[u].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=u&&0<=h);break}}}finally{kp=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Da(e):""}function Fb(e){switch(e.tag){case 5:return Da(e.type);case 16:return Da("Lazy");case 13:return Da("Suspense");case 19:return Da("SuspenseList");case 0:case 2:case 15:return e=Tp(e.type,!1),e;case 11:return e=Tp(e.type.render,!1),e;case 1:return e=Tp(e.type,!0),e;default:return""}}function hf(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case oo:return"Fragment";case io:return"Portal";case uf:return"Profiler";case mh:return"StrictMode";case pf:return"Suspense";case ff:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uS:return(e.displayName||"Context")+".Consumer";case dS:return(e._context.displayName||"Context")+".Provider";case gh:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case vh:return t=e.displayName||null,t!==null?t:hf(e.type)||"Memo";case ns:t=e._payload,e=e._init;try{return hf(e(t))}catch{}}return null}function Bb(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hf(t);case 8:return t===mh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ys(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function fS(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function zb(e){var t=fS(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,c=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(u){r=""+u,c.call(this,u)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(u){r=""+u},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function wl(e){e._valueTracker||(e._valueTracker=zb(e))}function hS(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=fS(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function cd(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function mf(e,t){var n=t.checked;return Ve({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Jv(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=ys(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function mS(e,t){t=t.checked,t!=null&&hh(e,"checked",t,!1)}function gf(e,t){mS(e,t);var n=ys(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?vf(e,t.type,n):t.hasOwnProperty("defaultValue")&&vf(e,t.type,ys(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function qv(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function vf(e,t,n){(t!=="number"||cd(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ma=Array.isArray;function So(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ys(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function yf(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return Ve({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Xv(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(J(92));if(Ma(n)){if(1<n.length)throw Error(J(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ys(n)}}function gS(e,t){var n=ys(t.value),r=ys(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Zv(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function vS(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wf(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?vS(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Sl,yS=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Sl=Sl||document.createElement("div"),Sl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Sl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function qa(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ua={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vb=["Webkit","ms","Moz","O"];Object.keys(Ua).forEach(function(e){Vb.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ua[t]=Ua[e]})});function wS(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ua.hasOwnProperty(e)&&Ua[e]?(""+t).trim():t+"px"}function SS(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=wS(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var Gb=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sf(e,t){if(t){if(Gb[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function _f(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xf=null;function yh(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Cf=null,_o=null,xo=null;function ey(e){if(e=vc(e)){if(typeof Cf!="function")throw Error(J(280));var t=e.stateNode;t&&(t=Ad(t),Cf(e.stateNode,e.type,t))}}function _S(e){_o?xo?xo.push(e):xo=[e]:_o=e}function xS(){if(_o){var e=_o,t=xo;if(xo=_o=null,ey(e),t)for(e=0;e<t.length;e++)ey(t[e])}}function CS(e,t){return e(t)}function bS(){}var Rp=!1;function ES(e,t,n){if(Rp)return e(t,n);Rp=!0;try{return CS(e,t,n)}finally{Rp=!1,(_o!==null||xo!==null)&&(bS(),xS())}}function Xa(e,t){var n=e.stateNode;if(n===null)return null;var r=Ad(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(J(231,t,typeof n));return n}var bf=!1;if(Mr)try{var wa={};Object.defineProperty(wa,"passive",{get:function(){bf=!0}}),window.addEventListener("test",wa,wa),window.removeEventListener("test",wa,wa)}catch{bf=!1}function Hb(e,t,n,r,i,c,u,h,g){var S=Array.prototype.slice.call(arguments,3);try{t.apply(n,S)}catch(p){this.onError(p)}}var $a=!1,ld=null,dd=!1,Ef=null,Wb={onError:function(e){$a=!0,ld=e}};function Kb(e,t,n,r,i,c,u,h,g){$a=!1,ld=null,Hb.apply(Wb,arguments)}function Qb(e,t,n,r,i,c,u,h,g){if(Kb.apply(this,arguments),$a){if($a){var S=ld;$a=!1,ld=null}else throw Error(J(198));dd||(dd=!0,Ef=S)}}function mi(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function kS(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ty(e){if(mi(e)!==e)throw Error(J(188))}function Yb(e){var t=e.alternate;if(!t){if(t=mi(e),t===null)throw Error(J(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var c=i.alternate;if(c===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===c.child){for(c=i.child;c;){if(c===n)return ty(i),e;if(c===r)return ty(i),t;c=c.sibling}throw Error(J(188))}if(n.return!==r.return)n=i,r=c;else{for(var u=!1,h=i.child;h;){if(h===n){u=!0,n=i,r=c;break}if(h===r){u=!0,r=i,n=c;break}h=h.sibling}if(!u){for(h=c.child;h;){if(h===n){u=!0,n=c,r=i;break}if(h===r){u=!0,r=c,n=i;break}h=h.sibling}if(!u)throw Error(J(189))}}if(n.alternate!==r)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?e:t}function TS(e){return e=Yb(e),e!==null?RS(e):null}function RS(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=RS(e);if(t!==null)return t;e=e.sibling}return null}var IS=gn.unstable_scheduleCallback,ny=gn.unstable_cancelCallback,Jb=gn.unstable_shouldYield,qb=gn.unstable_requestPaint,Je=gn.unstable_now,Xb=gn.unstable_getCurrentPriorityLevel,wh=gn.unstable_ImmediatePriority,jS=gn.unstable_UserBlockingPriority,ud=gn.unstable_NormalPriority,Zb=gn.unstable_LowPriority,NS=gn.unstable_IdlePriority,Ld=null,hr=null;function eE(e){if(hr&&typeof hr.onCommitFiberRoot=="function")try{hr.onCommitFiberRoot(Ld,e,void 0,(e.current.flags&128)===128)}catch{}}var Gn=Math.clz32?Math.clz32:rE,tE=Math.log,nE=Math.LN2;function rE(e){return e>>>=0,e===0?32:31-(tE(e)/nE|0)|0}var _l=64,xl=4194304;function Oa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pd(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,c=e.pingedLanes,u=n&268435455;if(u!==0){var h=u&~i;h!==0?r=Oa(h):(c&=u,c!==0&&(r=Oa(c)))}else u=n&~i,u!==0?r=Oa(u):c!==0&&(r=Oa(c));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,c=t&-t,i>=c||i===16&&(c&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Gn(t),i=1<<n,r|=e[n],t&=~i;return r}function sE(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iE(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,c=e.pendingLanes;0<c;){var u=31-Gn(c),h=1<<u,g=i[u];g===-1?(!(h&n)||h&r)&&(i[u]=sE(h,t)):g<=t&&(e.expiredLanes|=h),c&=~h}}function kf(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function PS(){var e=_l;return _l<<=1,!(_l&4194240)&&(_l=64),e}function Ip(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mc(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Gn(t),e[t]=n}function oE(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Gn(n),c=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~c}}function Sh(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Gn(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var be=0;function LS(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var DS,_h,MS,OS,AS,Tf=!1,Cl=[],ls=null,ds=null,us=null,Za=new Map,ec=new Map,ss=[],aE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ry(e,t){switch(e){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":us=null;break;case"pointerover":case"pointerout":Za.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ec.delete(t.pointerId)}}function Sa(e,t,n,r,i,c){return e===null||e.nativeEvent!==c?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:c,targetContainers:[i]},t!==null&&(t=vc(t),t!==null&&_h(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function cE(e,t,n,r,i){switch(t){case"focusin":return ls=Sa(ls,e,t,n,r,i),!0;case"dragenter":return ds=Sa(ds,e,t,n,r,i),!0;case"mouseover":return us=Sa(us,e,t,n,r,i),!0;case"pointerover":var c=i.pointerId;return Za.set(c,Sa(Za.get(c)||null,e,t,n,r,i)),!0;case"gotpointercapture":return c=i.pointerId,ec.set(c,Sa(ec.get(c)||null,e,t,n,r,i)),!0}return!1}function US(e){var t=Ks(e.target);if(t!==null){var n=mi(t);if(n!==null){if(t=n.tag,t===13){if(t=kS(n),t!==null){e.blockedOn=t,AS(e.priority,function(){MS(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function zl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Rf(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);xf=r,n.target.dispatchEvent(r),xf=null}else return t=vc(n),t!==null&&_h(t),e.blockedOn=n,!1;t.shift()}return!0}function sy(e,t,n){zl(e)&&n.delete(t)}function lE(){Tf=!1,ls!==null&&zl(ls)&&(ls=null),ds!==null&&zl(ds)&&(ds=null),us!==null&&zl(us)&&(us=null),Za.forEach(sy),ec.forEach(sy)}function _a(e,t){e.blockedOn===t&&(e.blockedOn=null,Tf||(Tf=!0,gn.unstable_scheduleCallback(gn.unstable_NormalPriority,lE)))}function tc(e){function t(i){return _a(i,e)}if(0<Cl.length){_a(Cl[0],e);for(var n=1;n<Cl.length;n++){var r=Cl[n];r.blockedOn===e&&(r.blockedOn=null)}}for(ls!==null&&_a(ls,e),ds!==null&&_a(ds,e),us!==null&&_a(us,e),Za.forEach(t),ec.forEach(t),n=0;n<ss.length;n++)r=ss[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<ss.length&&(n=ss[0],n.blockedOn===null);)US(n),n.blockedOn===null&&ss.shift()}var Co=$r.ReactCurrentBatchConfig,fd=!0;function dE(e,t,n,r){var i=be,c=Co.transition;Co.transition=null;try{be=1,xh(e,t,n,r)}finally{be=i,Co.transition=c}}function uE(e,t,n,r){var i=be,c=Co.transition;Co.transition=null;try{be=4,xh(e,t,n,r)}finally{be=i,Co.transition=c}}function xh(e,t,n,r){if(fd){var i=Rf(e,t,n,r);if(i===null)$p(e,t,r,hd,n),ry(e,r);else if(cE(i,e,t,n,r))r.stopPropagation();else if(ry(e,r),t&4&&-1<aE.indexOf(e)){for(;i!==null;){var c=vc(i);if(c!==null&&DS(c),c=Rf(e,t,n,r),c===null&&$p(e,t,r,hd,n),c===i)break;i=c}i!==null&&r.stopPropagation()}else $p(e,t,r,null,n)}}var hd=null;function Rf(e,t,n,r){if(hd=null,e=yh(r),e=Ks(e),e!==null)if(t=mi(e),t===null)e=null;else if(n=t.tag,n===13){if(e=kS(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return hd=e,null}function $S(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xb()){case wh:return 1;case jS:return 4;case ud:case Zb:return 16;case NS:return 536870912;default:return 16}default:return 16}}var as=null,Ch=null,Vl=null;function FS(){if(Vl)return Vl;var e,t=Ch,n=t.length,r,i="value"in as?as.value:as.textContent,c=i.length;for(e=0;e<n&&t[e]===i[e];e++);var u=n-e;for(r=1;r<=u&&t[n-r]===i[c-r];r++);return Vl=i.slice(e,1<r?1-r:void 0)}function Gl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bl(){return!0}function iy(){return!1}function yn(e){function t(n,r,i,c,u){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=c,this.target=u,this.currentTarget=null;for(var h in e)e.hasOwnProperty(h)&&(n=e[h],this[h]=n?n(c):c[h]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?bl:iy,this.isPropagationStopped=iy,this}return Ve(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bl)},persist:function(){},isPersistent:bl}),t}var $o={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bh=yn($o),gc=Ve({},$o,{view:0,detail:0}),pE=yn(gc),jp,Np,xa,Dd=Ve({},gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xa&&(xa&&e.type==="mousemove"?(jp=e.screenX-xa.screenX,Np=e.screenY-xa.screenY):Np=jp=0,xa=e),jp)},movementY:function(e){return"movementY"in e?e.movementY:Np}}),oy=yn(Dd),fE=Ve({},Dd,{dataTransfer:0}),hE=yn(fE),mE=Ve({},gc,{relatedTarget:0}),Pp=yn(mE),gE=Ve({},$o,{animationName:0,elapsedTime:0,pseudoElement:0}),vE=yn(gE),yE=Ve({},$o,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wE=yn(yE),SE=Ve({},$o,{data:0}),ay=yn(SE),_E={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bE(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=CE[e])?!!t[e]:!1}function Eh(){return bE}var EE=Ve({},gc,{key:function(e){if(e.key){var t=_E[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xE[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eh,charCode:function(e){return e.type==="keypress"?Gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),kE=yn(EE),TE=Ve({},Dd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cy=yn(TE),RE=Ve({},gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eh}),IE=yn(RE),jE=Ve({},$o,{propertyName:0,elapsedTime:0,pseudoElement:0}),NE=yn(jE),PE=Ve({},Dd,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),LE=yn(PE),DE=[9,13,27,32],kh=Mr&&"CompositionEvent"in window,Fa=null;Mr&&"documentMode"in document&&(Fa=document.documentMode);var ME=Mr&&"TextEvent"in window&&!Fa,BS=Mr&&(!kh||Fa&&8<Fa&&11>=Fa),ly=" ",dy=!1;function zS(e,t){switch(e){case"keyup":return DE.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function VS(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ao=!1;function OE(e,t){switch(e){case"compositionend":return VS(t);case"keypress":return t.which!==32?null:(dy=!0,ly);case"textInput":return e=t.data,e===ly&&dy?null:e;default:return null}}function AE(e,t){if(ao)return e==="compositionend"||!kh&&zS(e,t)?(e=FS(),Vl=Ch=as=null,ao=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return BS&&t.locale!=="ko"?null:t.data;default:return null}}var UE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uy(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!UE[e.type]:t==="textarea"}function GS(e,t,n,r){_S(r),t=md(t,"onChange"),0<t.length&&(n=new bh("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ba=null,nc=null;function $E(e){t_(e,0)}function Md(e){var t=uo(e);if(hS(t))return e}function FE(e,t){if(e==="change")return t}var HS=!1;if(Mr){var Lp;if(Mr){var Dp="oninput"in document;if(!Dp){var py=document.createElement("div");py.setAttribute("oninput","return;"),Dp=typeof py.oninput=="function"}Lp=Dp}else Lp=!1;HS=Lp&&(!document.documentMode||9<document.documentMode)}function fy(){Ba&&(Ba.detachEvent("onpropertychange",WS),nc=Ba=null)}function WS(e){if(e.propertyName==="value"&&Md(nc)){var t=[];GS(t,nc,e,yh(e)),ES($E,t)}}function BE(e,t,n){e==="focusin"?(fy(),Ba=t,nc=n,Ba.attachEvent("onpropertychange",WS)):e==="focusout"&&fy()}function zE(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Md(nc)}function VE(e,t){if(e==="click")return Md(t)}function GE(e,t){if(e==="input"||e==="change")return Md(t)}function HE(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Kn=typeof Object.is=="function"?Object.is:HE;function rc(e,t){if(Kn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!df.call(t,i)||!Kn(e[i],t[i]))return!1}return!0}function hy(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function my(e,t){var n=hy(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hy(n)}}function KS(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?KS(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function QS(){for(var e=window,t=cd();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=cd(e.document)}return t}function Th(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function WE(e){var t=QS(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&KS(n.ownerDocument.documentElement,n)){if(r!==null&&Th(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,c=Math.min(r.start,i);r=r.end===void 0?c:Math.min(r.end,i),!e.extend&&c>r&&(i=r,r=c,c=i),i=my(n,c);var u=my(n,r);i&&u&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==u.node||e.focusOffset!==u.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),c>r?(e.addRange(t),e.extend(u.node,u.offset)):(t.setEnd(u.node,u.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var KE=Mr&&"documentMode"in document&&11>=document.documentMode,co=null,If=null,za=null,jf=!1;function gy(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;jf||co==null||co!==cd(r)||(r=co,"selectionStart"in r&&Th(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),za&&rc(za,r)||(za=r,r=md(If,"onSelect"),0<r.length&&(t=new bh("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=co)))}function El(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var lo={animationend:El("Animation","AnimationEnd"),animationiteration:El("Animation","AnimationIteration"),animationstart:El("Animation","AnimationStart"),transitionend:El("Transition","TransitionEnd")},Mp={},YS={};Mr&&(YS=document.createElement("div").style,"AnimationEvent"in window||(delete lo.animationend.animation,delete lo.animationiteration.animation,delete lo.animationstart.animation),"TransitionEvent"in window||delete lo.transitionend.transition);function Od(e){if(Mp[e])return Mp[e];if(!lo[e])return e;var t=lo[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in YS)return Mp[e]=t[n];return e}var JS=Od("animationend"),qS=Od("animationiteration"),XS=Od("animationstart"),ZS=Od("transitionend"),e_=new Map,vy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ss(e,t){e_.set(e,t),hi(t,[e])}for(var Op=0;Op<vy.length;Op++){var Ap=vy[Op],QE=Ap.toLowerCase(),YE=Ap[0].toUpperCase()+Ap.slice(1);Ss(QE,"on"+YE)}Ss(JS,"onAnimationEnd");Ss(qS,"onAnimationIteration");Ss(XS,"onAnimationStart");Ss("dblclick","onDoubleClick");Ss("focusin","onFocus");Ss("focusout","onBlur");Ss(ZS,"onTransitionEnd");No("onMouseEnter",["mouseout","mouseover"]);No("onMouseLeave",["mouseout","mouseover"]);No("onPointerEnter",["pointerout","pointerover"]);No("onPointerLeave",["pointerout","pointerover"]);hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hi("onBeforeInput",["compositionend","keypress","textInput","paste"]);hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Aa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Aa));function yy(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Qb(r,t,void 0,e),e.currentTarget=null}function t_(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var c=void 0;if(t)for(var u=r.length-1;0<=u;u--){var h=r[u],g=h.instance,S=h.currentTarget;if(h=h.listener,g!==c&&i.isPropagationStopped())break e;yy(i,h,S),c=g}else for(u=0;u<r.length;u++){if(h=r[u],g=h.instance,S=h.currentTarget,h=h.listener,g!==c&&i.isPropagationStopped())break e;yy(i,h,S),c=g}}}if(dd)throw e=Ef,dd=!1,Ef=null,e}function Oe(e,t){var n=t[Mf];n===void 0&&(n=t[Mf]=new Set);var r=e+"__bubble";n.has(r)||(n_(t,e,2,!1),n.add(r))}function Up(e,t,n){var r=0;t&&(r|=4),n_(n,e,r,t)}var kl="_reactListening"+Math.random().toString(36).slice(2);function sc(e){if(!e[kl]){e[kl]=!0,lS.forEach(function(n){n!=="selectionchange"&&(JE.has(n)||Up(n,!1,e),Up(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[kl]||(t[kl]=!0,Up("selectionchange",!1,t))}}function n_(e,t,n,r){switch($S(t)){case 1:var i=dE;break;case 4:i=uE;break;default:i=xh}n=i.bind(null,t,n,e),i=void 0,!bf||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function $p(e,t,n,r,i){var c=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var u=r.tag;if(u===3||u===4){var h=r.stateNode.containerInfo;if(h===i||h.nodeType===8&&h.parentNode===i)break;if(u===4)for(u=r.return;u!==null;){var g=u.tag;if((g===3||g===4)&&(g=u.stateNode.containerInfo,g===i||g.nodeType===8&&g.parentNode===i))return;u=u.return}for(;h!==null;){if(u=Ks(h),u===null)return;if(g=u.tag,g===5||g===6){r=c=u;continue e}h=h.parentNode}}r=r.return}ES(function(){var S=c,p=yh(n),C=[];e:{var R=e_.get(e);if(R!==void 0){var D=bh,B=e;switch(e){case"keypress":if(Gl(n)===0)break e;case"keydown":case"keyup":D=kE;break;case"focusin":B="focus",D=Pp;break;case"focusout":B="blur",D=Pp;break;case"beforeblur":case"afterblur":D=Pp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=oy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=hE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=IE;break;case JS:case qS:case XS:D=vE;break;case ZS:D=NE;break;case"scroll":D=pE;break;case"wheel":D=LE;break;case"copy":case"cut":case"paste":D=wE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=cy}var $=(t&4)!==0,y=!$&&e==="scroll",l=$?R!==null?R+"Capture":null:R;$=[];for(var f=S,v;f!==null;){v=f;var b=v.stateNode;if(v.tag===5&&b!==null&&(v=b,l!==null&&(b=Xa(f,l),b!=null&&$.push(ic(f,b,v)))),y)break;f=f.return}0<$.length&&(R=new D(R,B,null,n,p),C.push({event:R,listeners:$}))}}if(!(t&7)){e:{if(R=e==="mouseover"||e==="pointerover",D=e==="mouseout"||e==="pointerout",R&&n!==xf&&(B=n.relatedTarget||n.fromElement)&&(Ks(B)||B[Or]))break e;if((D||R)&&(R=p.window===p?p:(R=p.ownerDocument)?R.defaultView||R.parentWindow:window,D?(B=n.relatedTarget||n.toElement,D=S,B=B?Ks(B):null,B!==null&&(y=mi(B),B!==y||B.tag!==5&&B.tag!==6)&&(B=null)):(D=null,B=S),D!==B)){if($=oy,b="onMouseLeave",l="onMouseEnter",f="mouse",(e==="pointerout"||e==="pointerover")&&($=cy,b="onPointerLeave",l="onPointerEnter",f="pointer"),y=D==null?R:uo(D),v=B==null?R:uo(B),R=new $(b,f+"leave",D,n,p),R.target=y,R.relatedTarget=v,b=null,Ks(p)===S&&($=new $(l,f+"enter",B,n,p),$.target=v,$.relatedTarget=y,b=$),y=b,D&&B)t:{for($=D,l=B,f=0,v=$;v;v=Ki(v))f++;for(v=0,b=l;b;b=Ki(b))v++;for(;0<f-v;)$=Ki($),f--;for(;0<v-f;)l=Ki(l),v--;for(;f--;){if($===l||l!==null&&$===l.alternate)break t;$=Ki($),l=Ki(l)}$=null}else $=null;D!==null&&wy(C,R,D,$,!1),B!==null&&y!==null&&wy(C,y,B,$,!0)}}e:{if(R=S?uo(S):window,D=R.nodeName&&R.nodeName.toLowerCase(),D==="select"||D==="input"&&R.type==="file")var P=FE;else if(uy(R))if(HS)P=GE;else{P=zE;var w=BE}else(D=R.nodeName)&&D.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(P=VE);if(P&&(P=P(e,S))){GS(C,P,n,p);break e}w&&w(e,R,S),e==="focusout"&&(w=R._wrapperState)&&w.controlled&&R.type==="number"&&vf(R,"number",R.value)}switch(w=S?uo(S):window,e){case"focusin":(uy(w)||w.contentEditable==="true")&&(co=w,If=S,za=null);break;case"focusout":za=If=co=null;break;case"mousedown":jf=!0;break;case"contextmenu":case"mouseup":case"dragend":jf=!1,gy(C,n,p);break;case"selectionchange":if(KE)break;case"keydown":case"keyup":gy(C,n,p)}var k;if(kh)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ao?zS(e,n)&&(I="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(BS&&n.locale!=="ko"&&(ao||I!=="onCompositionStart"?I==="onCompositionEnd"&&ao&&(k=FS()):(as=p,Ch="value"in as?as.value:as.textContent,ao=!0)),w=md(S,I),0<w.length&&(I=new ay(I,e,null,n,p),C.push({event:I,listeners:w}),k?I.data=k:(k=VS(n),k!==null&&(I.data=k)))),(k=ME?OE(e,n):AE(e,n))&&(S=md(S,"onBeforeInput"),0<S.length&&(p=new ay("onBeforeInput","beforeinput",null,n,p),C.push({event:p,listeners:S}),p.data=k))}t_(C,t)})}function ic(e,t,n){return{instance:e,listener:t,currentTarget:n}}function md(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,c=i.stateNode;i.tag===5&&c!==null&&(i=c,c=Xa(e,n),c!=null&&r.unshift(ic(e,c,i)),c=Xa(e,t),c!=null&&r.push(ic(e,c,i))),e=e.return}return r}function Ki(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wy(e,t,n,r,i){for(var c=t._reactName,u=[];n!==null&&n!==r;){var h=n,g=h.alternate,S=h.stateNode;if(g!==null&&g===r)break;h.tag===5&&S!==null&&(h=S,i?(g=Xa(n,c),g!=null&&u.unshift(ic(n,g,h))):i||(g=Xa(n,c),g!=null&&u.push(ic(n,g,h)))),n=n.return}u.length!==0&&e.push({event:t,listeners:u})}var qE=/\r\n?/g,XE=/\u0000|\uFFFD/g;function Sy(e){return(typeof e=="string"?e:""+e).replace(qE,`
`).replace(XE,"")}function Tl(e,t,n){if(t=Sy(t),Sy(e)!==t&&n)throw Error(J(425))}function gd(){}var Nf=null,Pf=null;function Lf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Df=typeof setTimeout=="function"?setTimeout:void 0,ZE=typeof clearTimeout=="function"?clearTimeout:void 0,_y=typeof Promise=="function"?Promise:void 0,ek=typeof queueMicrotask=="function"?queueMicrotask:typeof _y<"u"?function(e){return _y.resolve(null).then(e).catch(tk)}:Df;function tk(e){setTimeout(function(){throw e})}function Fp(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),tc(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);tc(t)}function ps(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function xy(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Fo=Math.random().toString(36).slice(2),pr="__reactFiber$"+Fo,oc="__reactProps$"+Fo,Or="__reactContainer$"+Fo,Mf="__reactEvents$"+Fo,nk="__reactListeners$"+Fo,rk="__reactHandles$"+Fo;function Ks(e){var t=e[pr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Or]||n[pr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=xy(e);e!==null;){if(n=e[pr])return n;e=xy(e)}return t}e=n,n=e.parentNode}return null}function vc(e){return e=e[pr]||e[Or],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function uo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function Ad(e){return e[oc]||null}var Of=[],po=-1;function _s(e){return{current:e}}function Ae(e){0>po||(e.current=Of[po],Of[po]=null,po--)}function je(e,t){po++,Of[po]=e.current,e.current=t}var ws={},Lt=_s(ws),tn=_s(!1),ai=ws;function Po(e,t){var n=e.type.contextTypes;if(!n)return ws;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},c;for(c in n)i[c]=t[c];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function nn(e){return e=e.childContextTypes,e!=null}function vd(){Ae(tn),Ae(Lt)}function Cy(e,t,n){if(Lt.current!==ws)throw Error(J(168));je(Lt,t),je(tn,n)}function r_(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(J(108,Bb(e)||"Unknown",i));return Ve({},n,r)}function yd(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ws,ai=Lt.current,je(Lt,e),je(tn,tn.current),!0}function by(e,t,n){var r=e.stateNode;if(!r)throw Error(J(169));n?(e=r_(e,t,ai),r.__reactInternalMemoizedMergedChildContext=e,Ae(tn),Ae(Lt),je(Lt,e)):Ae(tn),je(tn,n)}var Nr=null,Ud=!1,Bp=!1;function s_(e){Nr===null?Nr=[e]:Nr.push(e)}function sk(e){Ud=!0,s_(e)}function xs(){if(!Bp&&Nr!==null){Bp=!0;var e=0,t=be;try{var n=Nr;for(be=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Nr=null,Ud=!1}catch(i){throw Nr!==null&&(Nr=Nr.slice(e+1)),IS(wh,xs),i}finally{be=t,Bp=!1}}return null}var fo=[],ho=0,wd=null,Sd=0,In=[],jn=0,ci=null,Pr=1,Lr="";function Gs(e,t){fo[ho++]=Sd,fo[ho++]=wd,wd=e,Sd=t}function i_(e,t,n){In[jn++]=Pr,In[jn++]=Lr,In[jn++]=ci,ci=e;var r=Pr;e=Lr;var i=32-Gn(r)-1;r&=~(1<<i),n+=1;var c=32-Gn(t)+i;if(30<c){var u=i-i%5;c=(r&(1<<u)-1).toString(32),r>>=u,i-=u,Pr=1<<32-Gn(t)+i|n<<i|r,Lr=c+e}else Pr=1<<c|n<<i|r,Lr=e}function Rh(e){e.return!==null&&(Gs(e,1),i_(e,1,0))}function Ih(e){for(;e===wd;)wd=fo[--ho],fo[ho]=null,Sd=fo[--ho],fo[ho]=null;for(;e===ci;)ci=In[--jn],In[jn]=null,Lr=In[--jn],In[jn]=null,Pr=In[--jn],In[jn]=null}var mn=null,hn=null,Fe=!1,Vn=null;function o_(e,t){var n=Nn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Ey(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,mn=e,hn=ps(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,mn=e,hn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ci!==null?{id:Pr,overflow:Lr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Nn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,mn=e,hn=null,!0):!1;default:return!1}}function Af(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Uf(e){if(Fe){var t=hn;if(t){var n=t;if(!Ey(e,t)){if(Af(e))throw Error(J(418));t=ps(n.nextSibling);var r=mn;t&&Ey(e,t)?o_(r,n):(e.flags=e.flags&-4097|2,Fe=!1,mn=e)}}else{if(Af(e))throw Error(J(418));e.flags=e.flags&-4097|2,Fe=!1,mn=e}}}function ky(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;mn=e}function Rl(e){if(e!==mn)return!1;if(!Fe)return ky(e),Fe=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Lf(e.type,e.memoizedProps)),t&&(t=hn)){if(Af(e))throw a_(),Error(J(418));for(;t;)o_(e,t),t=ps(t.nextSibling)}if(ky(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){hn=ps(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}hn=null}}else hn=mn?ps(e.stateNode.nextSibling):null;return!0}function a_(){for(var e=hn;e;)e=ps(e.nextSibling)}function Lo(){hn=mn=null,Fe=!1}function jh(e){Vn===null?Vn=[e]:Vn.push(e)}var ik=$r.ReactCurrentBatchConfig;function Ca(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var r=n.stateNode}if(!r)throw Error(J(147,e));var i=r,c=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===c?t.ref:(t=function(u){var h=i.refs;u===null?delete h[c]:h[c]=u},t._stringRef=c,t)}if(typeof e!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,e))}return e}function Il(e,t){throw e=Object.prototype.toString.call(t),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ty(e){var t=e._init;return t(e._payload)}function c_(e){function t(l,f){if(e){var v=l.deletions;v===null?(l.deletions=[f],l.flags|=16):v.push(f)}}function n(l,f){if(!e)return null;for(;f!==null;)t(l,f),f=f.sibling;return null}function r(l,f){for(l=new Map;f!==null;)f.key!==null?l.set(f.key,f):l.set(f.index,f),f=f.sibling;return l}function i(l,f){return l=gs(l,f),l.index=0,l.sibling=null,l}function c(l,f,v){return l.index=v,e?(v=l.alternate,v!==null?(v=v.index,v<f?(l.flags|=2,f):v):(l.flags|=2,f)):(l.flags|=1048576,f)}function u(l){return e&&l.alternate===null&&(l.flags|=2),l}function h(l,f,v,b){return f===null||f.tag!==6?(f=Qp(v,l.mode,b),f.return=l,f):(f=i(f,v),f.return=l,f)}function g(l,f,v,b){var P=v.type;return P===oo?p(l,f,v.props.children,b,v.key):f!==null&&(f.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===ns&&Ty(P)===f.type)?(b=i(f,v.props),b.ref=Ca(l,f,v),b.return=l,b):(b=ql(v.type,v.key,v.props,null,l.mode,b),b.ref=Ca(l,f,v),b.return=l,b)}function S(l,f,v,b){return f===null||f.tag!==4||f.stateNode.containerInfo!==v.containerInfo||f.stateNode.implementation!==v.implementation?(f=Yp(v,l.mode,b),f.return=l,f):(f=i(f,v.children||[]),f.return=l,f)}function p(l,f,v,b,P){return f===null||f.tag!==7?(f=oi(v,l.mode,b,P),f.return=l,f):(f=i(f,v),f.return=l,f)}function C(l,f,v){if(typeof f=="string"&&f!==""||typeof f=="number")return f=Qp(""+f,l.mode,v),f.return=l,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case yl:return v=ql(f.type,f.key,f.props,null,l.mode,v),v.ref=Ca(l,null,f),v.return=l,v;case io:return f=Yp(f,l.mode,v),f.return=l,f;case ns:var b=f._init;return C(l,b(f._payload),v)}if(Ma(f)||ya(f))return f=oi(f,l.mode,v,null),f.return=l,f;Il(l,f)}return null}function R(l,f,v,b){var P=f!==null?f.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return P!==null?null:h(l,f,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case yl:return v.key===P?g(l,f,v,b):null;case io:return v.key===P?S(l,f,v,b):null;case ns:return P=v._init,R(l,f,P(v._payload),b)}if(Ma(v)||ya(v))return P!==null?null:p(l,f,v,b,null);Il(l,v)}return null}function D(l,f,v,b,P){if(typeof b=="string"&&b!==""||typeof b=="number")return l=l.get(v)||null,h(f,l,""+b,P);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case yl:return l=l.get(b.key===null?v:b.key)||null,g(f,l,b,P);case io:return l=l.get(b.key===null?v:b.key)||null,S(f,l,b,P);case ns:var w=b._init;return D(l,f,v,w(b._payload),P)}if(Ma(b)||ya(b))return l=l.get(v)||null,p(f,l,b,P,null);Il(f,b)}return null}function B(l,f,v,b){for(var P=null,w=null,k=f,I=f=0,O=null;k!==null&&I<v.length;I++){k.index>I?(O=k,k=null):O=k.sibling;var L=R(l,k,v[I],b);if(L===null){k===null&&(k=O);break}e&&k&&L.alternate===null&&t(l,k),f=c(L,f,I),w===null?P=L:w.sibling=L,w=L,k=O}if(I===v.length)return n(l,k),Fe&&Gs(l,I),P;if(k===null){for(;I<v.length;I++)k=C(l,v[I],b),k!==null&&(f=c(k,f,I),w===null?P=k:w.sibling=k,w=k);return Fe&&Gs(l,I),P}for(k=r(l,k);I<v.length;I++)O=D(k,l,I,v[I],b),O!==null&&(e&&O.alternate!==null&&k.delete(O.key===null?I:O.key),f=c(O,f,I),w===null?P=O:w.sibling=O,w=O);return e&&k.forEach(function(F){return t(l,F)}),Fe&&Gs(l,I),P}function $(l,f,v,b){var P=ya(v);if(typeof P!="function")throw Error(J(150));if(v=P.call(v),v==null)throw Error(J(151));for(var w=P=null,k=f,I=f=0,O=null,L=v.next();k!==null&&!L.done;I++,L=v.next()){k.index>I?(O=k,k=null):O=k.sibling;var F=R(l,k,L.value,b);if(F===null){k===null&&(k=O);break}e&&k&&F.alternate===null&&t(l,k),f=c(F,f,I),w===null?P=F:w.sibling=F,w=F,k=O}if(L.done)return n(l,k),Fe&&Gs(l,I),P;if(k===null){for(;!L.done;I++,L=v.next())L=C(l,L.value,b),L!==null&&(f=c(L,f,I),w===null?P=L:w.sibling=L,w=L);return Fe&&Gs(l,I),P}for(k=r(l,k);!L.done;I++,L=v.next())L=D(k,l,I,L.value,b),L!==null&&(e&&L.alternate!==null&&k.delete(L.key===null?I:L.key),f=c(L,f,I),w===null?P=L:w.sibling=L,w=L);return e&&k.forEach(function(q){return t(l,q)}),Fe&&Gs(l,I),P}function y(l,f,v,b){if(typeof v=="object"&&v!==null&&v.type===oo&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case yl:e:{for(var P=v.key,w=f;w!==null;){if(w.key===P){if(P=v.type,P===oo){if(w.tag===7){n(l,w.sibling),f=i(w,v.props.children),f.return=l,l=f;break e}}else if(w.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===ns&&Ty(P)===w.type){n(l,w.sibling),f=i(w,v.props),f.ref=Ca(l,w,v),f.return=l,l=f;break e}n(l,w);break}else t(l,w);w=w.sibling}v.type===oo?(f=oi(v.props.children,l.mode,b,v.key),f.return=l,l=f):(b=ql(v.type,v.key,v.props,null,l.mode,b),b.ref=Ca(l,f,v),b.return=l,l=b)}return u(l);case io:e:{for(w=v.key;f!==null;){if(f.key===w)if(f.tag===4&&f.stateNode.containerInfo===v.containerInfo&&f.stateNode.implementation===v.implementation){n(l,f.sibling),f=i(f,v.children||[]),f.return=l,l=f;break e}else{n(l,f);break}else t(l,f);f=f.sibling}f=Yp(v,l.mode,b),f.return=l,l=f}return u(l);case ns:return w=v._init,y(l,f,w(v._payload),b)}if(Ma(v))return B(l,f,v,b);if(ya(v))return $(l,f,v,b);Il(l,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,f!==null&&f.tag===6?(n(l,f.sibling),f=i(f,v),f.return=l,l=f):(n(l,f),f=Qp(v,l.mode,b),f.return=l,l=f),u(l)):n(l,f)}return y}var Do=c_(!0),l_=c_(!1),_d=_s(null),xd=null,mo=null,Nh=null;function Ph(){Nh=mo=xd=null}function Lh(e){var t=_d.current;Ae(_d),e._currentValue=t}function $f(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function bo(e,t){xd=e,Nh=mo=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(en=!0),e.firstContext=null)}function Ln(e){var t=e._currentValue;if(Nh!==e)if(e={context:e,memoizedValue:t,next:null},mo===null){if(xd===null)throw Error(J(308));mo=e,xd.dependencies={lanes:0,firstContext:e}}else mo=mo.next=e;return t}var Qs=null;function Dh(e){Qs===null?Qs=[e]:Qs.push(e)}function d_(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,Dh(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ar(e,r)}function Ar(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var rs=!1;function Mh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u_(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Dr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fs(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,ye&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ar(e,n)}return i=r.interleaved,i===null?(t.next=t,Dh(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ar(e,n)}function Hl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Sh(e,n)}}function Ry(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var u={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?i=c=u:c=c.next=u,n=n.next}while(n!==null);c===null?i=c=t:c=c.next=t}else i=c=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:c,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Cd(e,t,n,r){var i=e.updateQueue;rs=!1;var c=i.firstBaseUpdate,u=i.lastBaseUpdate,h=i.shared.pending;if(h!==null){i.shared.pending=null;var g=h,S=g.next;g.next=null,u===null?c=S:u.next=S,u=g;var p=e.alternate;p!==null&&(p=p.updateQueue,h=p.lastBaseUpdate,h!==u&&(h===null?p.firstBaseUpdate=S:h.next=S,p.lastBaseUpdate=g))}if(c!==null){var C=i.baseState;u=0,p=S=g=null,h=c;do{var R=h.lane,D=h.eventTime;if((r&R)===R){p!==null&&(p=p.next={eventTime:D,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var B=e,$=h;switch(R=t,D=n,$.tag){case 1:if(B=$.payload,typeof B=="function"){C=B.call(D,C,R);break e}C=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=$.payload,R=typeof B=="function"?B.call(D,C,R):B,R==null)break e;C=Ve({},C,R);break e;case 2:rs=!0}}h.callback!==null&&h.lane!==0&&(e.flags|=64,R=i.effects,R===null?i.effects=[h]:R.push(h))}else D={eventTime:D,lane:R,tag:h.tag,payload:h.payload,callback:h.callback,next:null},p===null?(S=p=D,g=C):p=p.next=D,u|=R;if(h=h.next,h===null){if(h=i.shared.pending,h===null)break;R=h,h=R.next,R.next=null,i.lastBaseUpdate=R,i.shared.pending=null}}while(!0);if(p===null&&(g=C),i.baseState=g,i.firstBaseUpdate=S,i.lastBaseUpdate=p,t=i.shared.interleaved,t!==null){i=t;do u|=i.lane,i=i.next;while(i!==t)}else c===null&&(i.shared.lanes=0);di|=u,e.lanes=u,e.memoizedState=C}}function Iy(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(J(191,i));i.call(r)}}}var yc={},mr=_s(yc),ac=_s(yc),cc=_s(yc);function Ys(e){if(e===yc)throw Error(J(174));return e}function Oh(e,t){switch(je(cc,t),je(ac,e),je(mr,yc),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:wf(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=wf(t,e)}Ae(mr),je(mr,t)}function Mo(){Ae(mr),Ae(ac),Ae(cc)}function p_(e){Ys(cc.current);var t=Ys(mr.current),n=wf(t,e.type);t!==n&&(je(ac,e),je(mr,n))}function Ah(e){ac.current===e&&(Ae(mr),Ae(ac))}var Be=_s(0);function bd(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var zp=[];function Uh(){for(var e=0;e<zp.length;e++)zp[e]._workInProgressVersionPrimary=null;zp.length=0}var Wl=$r.ReactCurrentDispatcher,Vp=$r.ReactCurrentBatchConfig,li=0,ze=null,it=null,lt=null,Ed=!1,Va=!1,lc=0,ok=0;function jt(){throw Error(J(321))}function $h(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Kn(e[n],t[n]))return!1;return!0}function Fh(e,t,n,r,i,c){if(li=c,ze=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Wl.current=e===null||e.memoizedState===null?dk:uk,e=n(r,i),Va){c=0;do{if(Va=!1,lc=0,25<=c)throw Error(J(301));c+=1,lt=it=null,t.updateQueue=null,Wl.current=pk,e=n(r,i)}while(Va)}if(Wl.current=kd,t=it!==null&&it.next!==null,li=0,lt=it=ze=null,Ed=!1,t)throw Error(J(300));return e}function Bh(){var e=lc!==0;return lc=0,e}function ar(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?ze.memoizedState=lt=e:lt=lt.next=e,lt}function Dn(){if(it===null){var e=ze.alternate;e=e!==null?e.memoizedState:null}else e=it.next;var t=lt===null?ze.memoizedState:lt.next;if(t!==null)lt=t,it=e;else{if(e===null)throw Error(J(310));it=e,e={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},lt===null?ze.memoizedState=lt=e:lt=lt.next=e}return lt}function dc(e,t){return typeof t=="function"?t(e):t}function Gp(e){var t=Dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=it,i=r.baseQueue,c=n.pending;if(c!==null){if(i!==null){var u=i.next;i.next=c.next,c.next=u}r.baseQueue=i=c,n.pending=null}if(i!==null){c=i.next,r=r.baseState;var h=u=null,g=null,S=c;do{var p=S.lane;if((li&p)===p)g!==null&&(g=g.next={lane:0,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null}),r=S.hasEagerState?S.eagerState:e(r,S.action);else{var C={lane:p,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null};g===null?(h=g=C,u=r):g=g.next=C,ze.lanes|=p,di|=p}S=S.next}while(S!==null&&S!==c);g===null?u=r:g.next=h,Kn(r,t.memoizedState)||(en=!0),t.memoizedState=r,t.baseState=u,t.baseQueue=g,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do c=i.lane,ze.lanes|=c,di|=c,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Hp(e){var t=Dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,c=t.memoizedState;if(i!==null){n.pending=null;var u=i=i.next;do c=e(c,u.action),u=u.next;while(u!==i);Kn(c,t.memoizedState)||(en=!0),t.memoizedState=c,t.baseQueue===null&&(t.baseState=c),n.lastRenderedState=c}return[c,r]}function f_(){}function h_(e,t){var n=ze,r=Dn(),i=t(),c=!Kn(r.memoizedState,i);if(c&&(r.memoizedState=i,en=!0),r=r.queue,zh(v_.bind(null,n,r,e),[e]),r.getSnapshot!==t||c||lt!==null&&lt.memoizedState.tag&1){if(n.flags|=2048,uc(9,g_.bind(null,n,r,i,t),void 0,null),dt===null)throw Error(J(349));li&30||m_(n,t,i)}return i}function m_(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ze.updateQueue,t===null?(t={lastEffect:null,stores:null},ze.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function g_(e,t,n,r){t.value=n,t.getSnapshot=r,y_(t)&&w_(e)}function v_(e,t,n){return n(function(){y_(t)&&w_(e)})}function y_(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Kn(e,n)}catch{return!0}}function w_(e){var t=Ar(e,1);t!==null&&Hn(t,e,1,-1)}function jy(e){var t=ar();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:e},t.queue=e,e=e.dispatch=lk.bind(null,ze,e),[t.memoizedState,e]}function uc(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=ze.updateQueue,t===null?(t={lastEffect:null,stores:null},ze.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function S_(){return Dn().memoizedState}function Kl(e,t,n,r){var i=ar();ze.flags|=e,i.memoizedState=uc(1|t,n,void 0,r===void 0?null:r)}function $d(e,t,n,r){var i=Dn();r=r===void 0?null:r;var c=void 0;if(it!==null){var u=it.memoizedState;if(c=u.destroy,r!==null&&$h(r,u.deps)){i.memoizedState=uc(t,n,c,r);return}}ze.flags|=e,i.memoizedState=uc(1|t,n,c,r)}function Ny(e,t){return Kl(8390656,8,e,t)}function zh(e,t){return $d(2048,8,e,t)}function __(e,t){return $d(4,2,e,t)}function x_(e,t){return $d(4,4,e,t)}function C_(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function b_(e,t,n){return n=n!=null?n.concat([e]):null,$d(4,4,C_.bind(null,t,e),n)}function Vh(){}function E_(e,t){var n=Dn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&$h(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function k_(e,t){var n=Dn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&$h(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function T_(e,t,n){return li&21?(Kn(n,t)||(n=PS(),ze.lanes|=n,di|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,en=!0),e.memoizedState=n)}function ak(e,t){var n=be;be=n!==0&&4>n?n:4,e(!0);var r=Vp.transition;Vp.transition={};try{e(!1),t()}finally{be=n,Vp.transition=r}}function R_(){return Dn().memoizedState}function ck(e,t,n){var r=ms(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},I_(e))j_(t,n);else if(n=d_(e,t,n,r),n!==null){var i=Vt();Hn(n,e,r,i),N_(n,t,r)}}function lk(e,t,n){var r=ms(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(I_(e))j_(t,i);else{var c=e.alternate;if(e.lanes===0&&(c===null||c.lanes===0)&&(c=t.lastRenderedReducer,c!==null))try{var u=t.lastRenderedState,h=c(u,n);if(i.hasEagerState=!0,i.eagerState=h,Kn(h,u)){var g=t.interleaved;g===null?(i.next=i,Dh(t)):(i.next=g.next,g.next=i),t.interleaved=i;return}}catch{}finally{}n=d_(e,t,i,r),n!==null&&(i=Vt(),Hn(n,e,r,i),N_(n,t,r))}}function I_(e){var t=e.alternate;return e===ze||t!==null&&t===ze}function j_(e,t){Va=Ed=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function N_(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Sh(e,n)}}var kd={readContext:Ln,useCallback:jt,useContext:jt,useEffect:jt,useImperativeHandle:jt,useInsertionEffect:jt,useLayoutEffect:jt,useMemo:jt,useReducer:jt,useRef:jt,useState:jt,useDebugValue:jt,useDeferredValue:jt,useTransition:jt,useMutableSource:jt,useSyncExternalStore:jt,useId:jt,unstable_isNewReconciler:!1},dk={readContext:Ln,useCallback:function(e,t){return ar().memoizedState=[e,t===void 0?null:t],e},useContext:Ln,useEffect:Ny,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Kl(4194308,4,C_.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Kl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kl(4,2,e,t)},useMemo:function(e,t){var n=ar();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ar();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ck.bind(null,ze,e),[r.memoizedState,e]},useRef:function(e){var t=ar();return e={current:e},t.memoizedState=e},useState:jy,useDebugValue:Vh,useDeferredValue:function(e){return ar().memoizedState=e},useTransition:function(){var e=jy(!1),t=e[0];return e=ak.bind(null,e[1]),ar().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ze,i=ar();if(Fe){if(n===void 0)throw Error(J(407));n=n()}else{if(n=t(),dt===null)throw Error(J(349));li&30||m_(r,t,n)}i.memoizedState=n;var c={value:n,getSnapshot:t};return i.queue=c,Ny(v_.bind(null,r,c,e),[e]),r.flags|=2048,uc(9,g_.bind(null,r,c,n,t),void 0,null),n},useId:function(){var e=ar(),t=dt.identifierPrefix;if(Fe){var n=Lr,r=Pr;n=(r&~(1<<32-Gn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=lc++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=ok++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},uk={readContext:Ln,useCallback:E_,useContext:Ln,useEffect:zh,useImperativeHandle:b_,useInsertionEffect:__,useLayoutEffect:x_,useMemo:k_,useReducer:Gp,useRef:S_,useState:function(){return Gp(dc)},useDebugValue:Vh,useDeferredValue:function(e){var t=Dn();return T_(t,it.memoizedState,e)},useTransition:function(){var e=Gp(dc)[0],t=Dn().memoizedState;return[e,t]},useMutableSource:f_,useSyncExternalStore:h_,useId:R_,unstable_isNewReconciler:!1},pk={readContext:Ln,useCallback:E_,useContext:Ln,useEffect:zh,useImperativeHandle:b_,useInsertionEffect:__,useLayoutEffect:x_,useMemo:k_,useReducer:Hp,useRef:S_,useState:function(){return Hp(dc)},useDebugValue:Vh,useDeferredValue:function(e){var t=Dn();return it===null?t.memoizedState=e:T_(t,it.memoizedState,e)},useTransition:function(){var e=Hp(dc)[0],t=Dn().memoizedState;return[e,t]},useMutableSource:f_,useSyncExternalStore:h_,useId:R_,unstable_isNewReconciler:!1};function Bn(e,t){if(e&&e.defaultProps){t=Ve({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Ff(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ve({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Fd={isMounted:function(e){return(e=e._reactInternals)?mi(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Vt(),i=ms(e),c=Dr(r,i);c.payload=t,n!=null&&(c.callback=n),t=fs(e,c,i),t!==null&&(Hn(t,e,i,r),Hl(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Vt(),i=ms(e),c=Dr(r,i);c.tag=1,c.payload=t,n!=null&&(c.callback=n),t=fs(e,c,i),t!==null&&(Hn(t,e,i,r),Hl(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Vt(),r=ms(e),i=Dr(n,r);i.tag=2,t!=null&&(i.callback=t),t=fs(e,i,r),t!==null&&(Hn(t,e,r,n),Hl(t,e,r))}};function Py(e,t,n,r,i,c,u){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,c,u):t.prototype&&t.prototype.isPureReactComponent?!rc(n,r)||!rc(i,c):!0}function P_(e,t,n){var r=!1,i=ws,c=t.contextType;return typeof c=="object"&&c!==null?c=Ln(c):(i=nn(t)?ai:Lt.current,r=t.contextTypes,c=(r=r!=null)?Po(e,i):ws),t=new t(n,c),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Fd,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=c),t}function Ly(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Fd.enqueueReplaceState(t,t.state,null)}function Bf(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Mh(e);var c=t.contextType;typeof c=="object"&&c!==null?i.context=Ln(c):(c=nn(t)?ai:Lt.current,i.context=Po(e,c)),i.state=e.memoizedState,c=t.getDerivedStateFromProps,typeof c=="function"&&(Ff(e,t,c,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Fd.enqueueReplaceState(i,i.state,null),Cd(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Oo(e,t){try{var n="",r=t;do n+=Fb(r),r=r.return;while(r);var i=n}catch(c){i=`
Error generating stack: `+c.message+`
`+c.stack}return{value:e,source:t,stack:i,digest:null}}function Wp(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function zf(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fk=typeof WeakMap=="function"?WeakMap:Map;function L_(e,t,n){n=Dr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Rd||(Rd=!0,Xf=r),zf(e,t)},n}function D_(e,t,n){n=Dr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){zf(e,t)}}var c=e.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){zf(e,t),typeof r!="function"&&(hs===null?hs=new Set([this]):hs.add(this));var u=t.stack;this.componentDidCatch(t.value,{componentStack:u!==null?u:""})}),n}function Dy(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new fk;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Tk.bind(null,e,t,n),t.then(e,e))}function My(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Oy(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Dr(-1,1),t.tag=2,fs(n,t,1))),n.lanes|=1),e)}var hk=$r.ReactCurrentOwner,en=!1;function Bt(e,t,n,r){t.child=e===null?l_(t,null,n,r):Do(t,e.child,n,r)}function Ay(e,t,n,r,i){n=n.render;var c=t.ref;return bo(t,i),r=Fh(e,t,n,r,c,i),n=Bh(),e!==null&&!en?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ur(e,t,i)):(Fe&&n&&Rh(t),t.flags|=1,Bt(e,t,r,i),t.child)}function Uy(e,t,n,r,i){if(e===null){var c=n.type;return typeof c=="function"&&!qh(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=c,M_(e,t,c,r,i)):(e=ql(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(c=e.child,!(e.lanes&i)){var u=c.memoizedProps;if(n=n.compare,n=n!==null?n:rc,n(u,r)&&e.ref===t.ref)return Ur(e,t,i)}return t.flags|=1,e=gs(c,r),e.ref=t.ref,e.return=t,t.child=e}function M_(e,t,n,r,i){if(e!==null){var c=e.memoizedProps;if(rc(c,r)&&e.ref===t.ref)if(en=!1,t.pendingProps=r=c,(e.lanes&i)!==0)e.flags&131072&&(en=!0);else return t.lanes=e.lanes,Ur(e,t,i)}return Vf(e,t,n,r,i)}function O_(e,t,n){var r=t.pendingProps,i=r.children,c=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(vo,un),un|=n;else{if(!(n&1073741824))return e=c!==null?c.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,je(vo,un),un|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=c!==null?c.baseLanes:n,je(vo,un),un|=r}else c!==null?(r=c.baseLanes|n,t.memoizedState=null):r=n,je(vo,un),un|=r;return Bt(e,t,i,n),t.child}function A_(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Vf(e,t,n,r,i){var c=nn(n)?ai:Lt.current;return c=Po(t,c),bo(t,i),n=Fh(e,t,n,r,c,i),r=Bh(),e!==null&&!en?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ur(e,t,i)):(Fe&&r&&Rh(t),t.flags|=1,Bt(e,t,n,i),t.child)}function $y(e,t,n,r,i){if(nn(n)){var c=!0;yd(t)}else c=!1;if(bo(t,i),t.stateNode===null)Ql(e,t),P_(t,n,r),Bf(t,n,r,i),r=!0;else if(e===null){var u=t.stateNode,h=t.memoizedProps;u.props=h;var g=u.context,S=n.contextType;typeof S=="object"&&S!==null?S=Ln(S):(S=nn(n)?ai:Lt.current,S=Po(t,S));var p=n.getDerivedStateFromProps,C=typeof p=="function"||typeof u.getSnapshotBeforeUpdate=="function";C||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(h!==r||g!==S)&&Ly(t,u,r,S),rs=!1;var R=t.memoizedState;u.state=R,Cd(t,r,u,i),g=t.memoizedState,h!==r||R!==g||tn.current||rs?(typeof p=="function"&&(Ff(t,n,p,r),g=t.memoizedState),(h=rs||Py(t,n,h,r,R,g,S))?(C||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=g),u.props=r,u.state=g,u.context=S,r=h):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{u=t.stateNode,u_(e,t),h=t.memoizedProps,S=t.type===t.elementType?h:Bn(t.type,h),u.props=S,C=t.pendingProps,R=u.context,g=n.contextType,typeof g=="object"&&g!==null?g=Ln(g):(g=nn(n)?ai:Lt.current,g=Po(t,g));var D=n.getDerivedStateFromProps;(p=typeof D=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(h!==C||R!==g)&&Ly(t,u,r,g),rs=!1,R=t.memoizedState,u.state=R,Cd(t,r,u,i);var B=t.memoizedState;h!==C||R!==B||tn.current||rs?(typeof D=="function"&&(Ff(t,n,D,r),B=t.memoizedState),(S=rs||Py(t,n,S,r,R,B,g)||!1)?(p||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(r,B,g),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(r,B,g)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||h===e.memoizedProps&&R===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&R===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=B),u.props=r,u.state=B,u.context=g,r=S):(typeof u.componentDidUpdate!="function"||h===e.memoizedProps&&R===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&R===e.memoizedState||(t.flags|=1024),r=!1)}return Gf(e,t,n,r,c,i)}function Gf(e,t,n,r,i,c){A_(e,t);var u=(t.flags&128)!==0;if(!r&&!u)return i&&by(t,n,!1),Ur(e,t,c);r=t.stateNode,hk.current=t;var h=u&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&u?(t.child=Do(t,e.child,null,c),t.child=Do(t,null,h,c)):Bt(e,t,h,c),t.memoizedState=r.state,i&&by(t,n,!0),t.child}function U_(e){var t=e.stateNode;t.pendingContext?Cy(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Cy(e,t.context,!1),Oh(e,t.containerInfo)}function Fy(e,t,n,r,i){return Lo(),jh(i),t.flags|=256,Bt(e,t,n,r),t.child}var Hf={dehydrated:null,treeContext:null,retryLane:0};function Wf(e){return{baseLanes:e,cachePool:null,transitions:null}}function $_(e,t,n){var r=t.pendingProps,i=Be.current,c=!1,u=(t.flags&128)!==0,h;if((h=u)||(h=e!==null&&e.memoizedState===null?!1:(i&2)!==0),h?(c=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),je(Be,i&1),e===null)return Uf(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(u=r.children,e=r.fallback,c?(r=t.mode,c=t.child,u={mode:"hidden",children:u},!(r&1)&&c!==null?(c.childLanes=0,c.pendingProps=u):c=Vd(u,r,0,null),e=oi(e,r,n,null),c.return=t,e.return=t,c.sibling=e,t.child=c,t.child.memoizedState=Wf(n),t.memoizedState=Hf,e):Gh(t,u));if(i=e.memoizedState,i!==null&&(h=i.dehydrated,h!==null))return mk(e,t,u,r,h,i,n);if(c){c=r.fallback,u=t.mode,i=e.child,h=i.sibling;var g={mode:"hidden",children:r.children};return!(u&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=g,t.deletions=null):(r=gs(i,g),r.subtreeFlags=i.subtreeFlags&14680064),h!==null?c=gs(h,c):(c=oi(c,u,n,null),c.flags|=2),c.return=t,r.return=t,r.sibling=c,t.child=r,r=c,c=t.child,u=e.child.memoizedState,u=u===null?Wf(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},c.memoizedState=u,c.childLanes=e.childLanes&~n,t.memoizedState=Hf,r}return c=e.child,e=c.sibling,r=gs(c,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Gh(e,t){return t=Vd({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function jl(e,t,n,r){return r!==null&&jh(r),Do(t,e.child,null,n),e=Gh(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function mk(e,t,n,r,i,c,u){if(n)return t.flags&256?(t.flags&=-257,r=Wp(Error(J(422))),jl(e,t,u,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(c=r.fallback,i=t.mode,r=Vd({mode:"visible",children:r.children},i,0,null),c=oi(c,i,u,null),c.flags|=2,r.return=t,c.return=t,r.sibling=c,t.child=r,t.mode&1&&Do(t,e.child,null,u),t.child.memoizedState=Wf(u),t.memoizedState=Hf,c);if(!(t.mode&1))return jl(e,t,u,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var h=r.dgst;return r=h,c=Error(J(419)),r=Wp(c,r,void 0),jl(e,t,u,r)}if(h=(u&e.childLanes)!==0,en||h){if(r=dt,r!==null){switch(u&-u){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|u)?0:i,i!==0&&i!==c.retryLane&&(c.retryLane=i,Ar(e,i),Hn(r,e,i,-1))}return Jh(),r=Wp(Error(J(421))),jl(e,t,u,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=Rk.bind(null,e),i._reactRetry=t,null):(e=c.treeContext,hn=ps(i.nextSibling),mn=t,Fe=!0,Vn=null,e!==null&&(In[jn++]=Pr,In[jn++]=Lr,In[jn++]=ci,Pr=e.id,Lr=e.overflow,ci=t),t=Gh(t,r.children),t.flags|=4096,t)}function By(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),$f(e.return,t,n)}function Kp(e,t,n,r,i){var c=e.memoizedState;c===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(c.isBackwards=t,c.rendering=null,c.renderingStartTime=0,c.last=r,c.tail=n,c.tailMode=i)}function F_(e,t,n){var r=t.pendingProps,i=r.revealOrder,c=r.tail;if(Bt(e,t,r.children,n),r=Be.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&By(e,n,t);else if(e.tag===19)By(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(je(Be,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&bd(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Kp(t,!1,i,n,c);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&bd(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Kp(t,!0,n,null,c);break;case"together":Kp(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ql(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ur(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),di|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(J(153));if(t.child!==null){for(e=t.child,n=gs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=gs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function gk(e,t,n){switch(t.tag){case 3:U_(t),Lo();break;case 5:p_(t);break;case 1:nn(t.type)&&yd(t);break;case 4:Oh(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;je(_d,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(je(Be,Be.current&1),t.flags|=128,null):n&t.child.childLanes?$_(e,t,n):(je(Be,Be.current&1),e=Ur(e,t,n),e!==null?e.sibling:null);je(Be,Be.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return F_(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),je(Be,Be.current),r)break;return null;case 22:case 23:return t.lanes=0,O_(e,t,n)}return Ur(e,t,n)}var B_,Kf,z_,V_;B_=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Kf=function(){};z_=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ys(mr.current);var c=null;switch(n){case"input":i=mf(e,i),r=mf(e,r),c=[];break;case"select":i=Ve({},i,{value:void 0}),r=Ve({},r,{value:void 0}),c=[];break;case"textarea":i=yf(e,i),r=yf(e,r),c=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=gd)}Sf(n,r);var u;n=null;for(S in i)if(!r.hasOwnProperty(S)&&i.hasOwnProperty(S)&&i[S]!=null)if(S==="style"){var h=i[S];for(u in h)h.hasOwnProperty(u)&&(n||(n={}),n[u]="")}else S!=="dangerouslySetInnerHTML"&&S!=="children"&&S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(Ja.hasOwnProperty(S)?c||(c=[]):(c=c||[]).push(S,null));for(S in r){var g=r[S];if(h=i!=null?i[S]:void 0,r.hasOwnProperty(S)&&g!==h&&(g!=null||h!=null))if(S==="style")if(h){for(u in h)!h.hasOwnProperty(u)||g&&g.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in g)g.hasOwnProperty(u)&&h[u]!==g[u]&&(n||(n={}),n[u]=g[u])}else n||(c||(c=[]),c.push(S,n)),n=g;else S==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,h=h?h.__html:void 0,g!=null&&h!==g&&(c=c||[]).push(S,g)):S==="children"?typeof g!="string"&&typeof g!="number"||(c=c||[]).push(S,""+g):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(S)?(g!=null&&S==="onScroll"&&Oe("scroll",e),c||h===g||(c=[])):(c=c||[]).push(S,g))}n&&(c=c||[]).push("style",n);var S=c;(t.updateQueue=S)&&(t.flags|=4)}};V_=function(e,t,n,r){n!==r&&(t.flags|=4)};function ba(e,t){if(!Fe)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Nt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function vk(e,t,n){var r=t.pendingProps;switch(Ih(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nt(t),null;case 1:return nn(t.type)&&vd(),Nt(t),null;case 3:return r=t.stateNode,Mo(),Ae(tn),Ae(Lt),Uh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Rl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Vn!==null&&(th(Vn),Vn=null))),Kf(e,t),Nt(t),null;case 5:Ah(t);var i=Ys(cc.current);if(n=t.type,e!==null&&t.stateNode!=null)z_(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return Nt(t),null}if(e=Ys(mr.current),Rl(t)){r=t.stateNode,n=t.type;var c=t.memoizedProps;switch(r[pr]=t,r[oc]=c,e=(t.mode&1)!==0,n){case"dialog":Oe("cancel",r),Oe("close",r);break;case"iframe":case"object":case"embed":Oe("load",r);break;case"video":case"audio":for(i=0;i<Aa.length;i++)Oe(Aa[i],r);break;case"source":Oe("error",r);break;case"img":case"image":case"link":Oe("error",r),Oe("load",r);break;case"details":Oe("toggle",r);break;case"input":Jv(r,c),Oe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!c.multiple},Oe("invalid",r);break;case"textarea":Xv(r,c),Oe("invalid",r)}Sf(n,c),i=null;for(var u in c)if(c.hasOwnProperty(u)){var h=c[u];u==="children"?typeof h=="string"?r.textContent!==h&&(c.suppressHydrationWarning!==!0&&Tl(r.textContent,h,e),i=["children",h]):typeof h=="number"&&r.textContent!==""+h&&(c.suppressHydrationWarning!==!0&&Tl(r.textContent,h,e),i=["children",""+h]):Ja.hasOwnProperty(u)&&h!=null&&u==="onScroll"&&Oe("scroll",r)}switch(n){case"input":wl(r),qv(r,c,!0);break;case"textarea":wl(r),Zv(r);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(r.onclick=gd)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{u=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=vS(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),n==="select"&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[pr]=t,e[oc]=r,B_(e,t,!1,!1),t.stateNode=e;e:{switch(u=_f(n,r),n){case"dialog":Oe("cancel",e),Oe("close",e),i=r;break;case"iframe":case"object":case"embed":Oe("load",e),i=r;break;case"video":case"audio":for(i=0;i<Aa.length;i++)Oe(Aa[i],e);i=r;break;case"source":Oe("error",e),i=r;break;case"img":case"image":case"link":Oe("error",e),Oe("load",e),i=r;break;case"details":Oe("toggle",e),i=r;break;case"input":Jv(e,r),i=mf(e,r),Oe("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Ve({},r,{value:void 0}),Oe("invalid",e);break;case"textarea":Xv(e,r),i=yf(e,r),Oe("invalid",e);break;default:i=r}Sf(n,i),h=i;for(c in h)if(h.hasOwnProperty(c)){var g=h[c];c==="style"?SS(e,g):c==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,g!=null&&yS(e,g)):c==="children"?typeof g=="string"?(n!=="textarea"||g!=="")&&qa(e,g):typeof g=="number"&&qa(e,""+g):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ja.hasOwnProperty(c)?g!=null&&c==="onScroll"&&Oe("scroll",e):g!=null&&hh(e,c,g,u))}switch(n){case"input":wl(e),qv(e,r,!1);break;case"textarea":wl(e),Zv(e);break;case"option":r.value!=null&&e.setAttribute("value",""+ys(r.value));break;case"select":e.multiple=!!r.multiple,c=r.value,c!=null?So(e,!!r.multiple,c,!1):r.defaultValue!=null&&So(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=gd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Nt(t),null;case 6:if(e&&t.stateNode!=null)V_(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(n=Ys(cc.current),Ys(mr.current),Rl(t)){if(r=t.stateNode,n=t.memoizedProps,r[pr]=t,(c=r.nodeValue!==n)&&(e=mn,e!==null))switch(e.tag){case 3:Tl(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Tl(r.nodeValue,n,(e.mode&1)!==0)}c&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[pr]=t,t.stateNode=r}return Nt(t),null;case 13:if(Ae(Be),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Fe&&hn!==null&&t.mode&1&&!(t.flags&128))a_(),Lo(),t.flags|=98560,c=!1;else if(c=Rl(t),r!==null&&r.dehydrated!==null){if(e===null){if(!c)throw Error(J(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(J(317));c[pr]=t}else Lo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Nt(t),c=!1}else Vn!==null&&(th(Vn),Vn=null),c=!0;if(!c)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Be.current&1?ot===0&&(ot=3):Jh())),t.updateQueue!==null&&(t.flags|=4),Nt(t),null);case 4:return Mo(),Kf(e,t),e===null&&sc(t.stateNode.containerInfo),Nt(t),null;case 10:return Lh(t.type._context),Nt(t),null;case 17:return nn(t.type)&&vd(),Nt(t),null;case 19:if(Ae(Be),c=t.memoizedState,c===null)return Nt(t),null;if(r=(t.flags&128)!==0,u=c.rendering,u===null)if(r)ba(c,!1);else{if(ot!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(u=bd(e),u!==null){for(t.flags|=128,ba(c,!1),r=u.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)c=n,e=r,c.flags&=14680066,u=c.alternate,u===null?(c.childLanes=0,c.lanes=e,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=u.childLanes,c.lanes=u.lanes,c.child=u.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=u.memoizedProps,c.memoizedState=u.memoizedState,c.updateQueue=u.updateQueue,c.type=u.type,e=u.dependencies,c.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return je(Be,Be.current&1|2),t.child}e=e.sibling}c.tail!==null&&Je()>Ao&&(t.flags|=128,r=!0,ba(c,!1),t.lanes=4194304)}else{if(!r)if(e=bd(u),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ba(c,!0),c.tail===null&&c.tailMode==="hidden"&&!u.alternate&&!Fe)return Nt(t),null}else 2*Je()-c.renderingStartTime>Ao&&n!==1073741824&&(t.flags|=128,r=!0,ba(c,!1),t.lanes=4194304);c.isBackwards?(u.sibling=t.child,t.child=u):(n=c.last,n!==null?n.sibling=u:t.child=u,c.last=u)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=Je(),t.sibling=null,n=Be.current,je(Be,r?n&1|2:n&1),t):(Nt(t),null);case 22:case 23:return Yh(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?un&1073741824&&(Nt(t),t.subtreeFlags&6&&(t.flags|=8192)):Nt(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function yk(e,t){switch(Ih(t),t.tag){case 1:return nn(t.type)&&vd(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Mo(),Ae(tn),Ae(Lt),Uh(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ah(t),null;case 13:if(Ae(Be),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(J(340));Lo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ae(Be),null;case 4:return Mo(),null;case 10:return Lh(t.type._context),null;case 22:case 23:return Yh(),null;case 24:return null;default:return null}}var Nl=!1,Pt=!1,wk=typeof WeakSet=="function"?WeakSet:Set,re=null;function go(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){He(e,t,r)}else n.current=null}function Qf(e,t,n){try{n()}catch(r){He(e,t,r)}}var zy=!1;function Sk(e,t){if(Nf=fd,e=QS(),Th(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,c=r.focusNode;r=r.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var u=0,h=-1,g=-1,S=0,p=0,C=e,R=null;t:for(;;){for(var D;C!==n||i!==0&&C.nodeType!==3||(h=u+i),C!==c||r!==0&&C.nodeType!==3||(g=u+r),C.nodeType===3&&(u+=C.nodeValue.length),(D=C.firstChild)!==null;)R=C,C=D;for(;;){if(C===e)break t;if(R===n&&++S===i&&(h=u),R===c&&++p===r&&(g=u),(D=C.nextSibling)!==null)break;C=R,R=C.parentNode}C=D}n=h===-1||g===-1?null:{start:h,end:g}}else n=null}n=n||{start:0,end:0}}else n=null;for(Pf={focusedElem:e,selectionRange:n},fd=!1,re=t;re!==null;)if(t=re,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,re=e;else for(;re!==null;){t=re;try{var B=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var $=B.memoizedProps,y=B.memoizedState,l=t.stateNode,f=l.getSnapshotBeforeUpdate(t.elementType===t.type?$:Bn(t.type,$),y);l.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(b){He(t,t.return,b)}if(e=t.sibling,e!==null){e.return=t.return,re=e;break}re=t.return}return B=zy,zy=!1,B}function Ga(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var c=i.destroy;i.destroy=void 0,c!==void 0&&Qf(t,n,c)}i=i.next}while(i!==r)}}function Bd(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Yf(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function G_(e){var t=e.alternate;t!==null&&(e.alternate=null,G_(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[pr],delete t[oc],delete t[Mf],delete t[nk],delete t[rk])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function H_(e){return e.tag===5||e.tag===3||e.tag===4}function Vy(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||H_(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Jf(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=gd));else if(r!==4&&(e=e.child,e!==null))for(Jf(e,t,n),e=e.sibling;e!==null;)Jf(e,t,n),e=e.sibling}function qf(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(qf(e,t,n),e=e.sibling;e!==null;)qf(e,t,n),e=e.sibling}var mt=null,zn=!1;function es(e,t,n){for(n=n.child;n!==null;)W_(e,t,n),n=n.sibling}function W_(e,t,n){if(hr&&typeof hr.onCommitFiberUnmount=="function")try{hr.onCommitFiberUnmount(Ld,n)}catch{}switch(n.tag){case 5:Pt||go(n,t);case 6:var r=mt,i=zn;mt=null,es(e,t,n),mt=r,zn=i,mt!==null&&(zn?(e=mt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):mt.removeChild(n.stateNode));break;case 18:mt!==null&&(zn?(e=mt,n=n.stateNode,e.nodeType===8?Fp(e.parentNode,n):e.nodeType===1&&Fp(e,n),tc(e)):Fp(mt,n.stateNode));break;case 4:r=mt,i=zn,mt=n.stateNode.containerInfo,zn=!0,es(e,t,n),mt=r,zn=i;break;case 0:case 11:case 14:case 15:if(!Pt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var c=i,u=c.destroy;c=c.tag,u!==void 0&&(c&2||c&4)&&Qf(n,t,u),i=i.next}while(i!==r)}es(e,t,n);break;case 1:if(!Pt&&(go(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(h){He(n,t,h)}es(e,t,n);break;case 21:es(e,t,n);break;case 22:n.mode&1?(Pt=(r=Pt)||n.memoizedState!==null,es(e,t,n),Pt=r):es(e,t,n);break;default:es(e,t,n)}}function Gy(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new wk),t.forEach(function(r){var i=Ik.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Fn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var c=e,u=t,h=u;e:for(;h!==null;){switch(h.tag){case 5:mt=h.stateNode,zn=!1;break e;case 3:mt=h.stateNode.containerInfo,zn=!0;break e;case 4:mt=h.stateNode.containerInfo,zn=!0;break e}h=h.return}if(mt===null)throw Error(J(160));W_(c,u,i),mt=null,zn=!1;var g=i.alternate;g!==null&&(g.return=null),i.return=null}catch(S){He(i,t,S)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)K_(t,e),t=t.sibling}function K_(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Fn(t,e),rr(e),r&4){try{Ga(3,e,e.return),Bd(3,e)}catch($){He(e,e.return,$)}try{Ga(5,e,e.return)}catch($){He(e,e.return,$)}}break;case 1:Fn(t,e),rr(e),r&512&&n!==null&&go(n,n.return);break;case 5:if(Fn(t,e),rr(e),r&512&&n!==null&&go(n,n.return),e.flags&32){var i=e.stateNode;try{qa(i,"")}catch($){He(e,e.return,$)}}if(r&4&&(i=e.stateNode,i!=null)){var c=e.memoizedProps,u=n!==null?n.memoizedProps:c,h=e.type,g=e.updateQueue;if(e.updateQueue=null,g!==null)try{h==="input"&&c.type==="radio"&&c.name!=null&&mS(i,c),_f(h,u);var S=_f(h,c);for(u=0;u<g.length;u+=2){var p=g[u],C=g[u+1];p==="style"?SS(i,C):p==="dangerouslySetInnerHTML"?yS(i,C):p==="children"?qa(i,C):hh(i,p,C,S)}switch(h){case"input":gf(i,c);break;case"textarea":gS(i,c);break;case"select":var R=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!c.multiple;var D=c.value;D!=null?So(i,!!c.multiple,D,!1):R!==!!c.multiple&&(c.defaultValue!=null?So(i,!!c.multiple,c.defaultValue,!0):So(i,!!c.multiple,c.multiple?[]:"",!1))}i[oc]=c}catch($){He(e,e.return,$)}}break;case 6:if(Fn(t,e),rr(e),r&4){if(e.stateNode===null)throw Error(J(162));i=e.stateNode,c=e.memoizedProps;try{i.nodeValue=c}catch($){He(e,e.return,$)}}break;case 3:if(Fn(t,e),rr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{tc(t.containerInfo)}catch($){He(e,e.return,$)}break;case 4:Fn(t,e),rr(e);break;case 13:Fn(t,e),rr(e),i=e.child,i.flags&8192&&(c=i.memoizedState!==null,i.stateNode.isHidden=c,!c||i.alternate!==null&&i.alternate.memoizedState!==null||(Kh=Je())),r&4&&Gy(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(Pt=(S=Pt)||p,Fn(t,e),Pt=S):Fn(t,e),rr(e),r&8192){if(S=e.memoizedState!==null,(e.stateNode.isHidden=S)&&!p&&e.mode&1)for(re=e,p=e.child;p!==null;){for(C=re=p;re!==null;){switch(R=re,D=R.child,R.tag){case 0:case 11:case 14:case 15:Ga(4,R,R.return);break;case 1:go(R,R.return);var B=R.stateNode;if(typeof B.componentWillUnmount=="function"){r=R,n=R.return;try{t=r,B.props=t.memoizedProps,B.state=t.memoizedState,B.componentWillUnmount()}catch($){He(r,n,$)}}break;case 5:go(R,R.return);break;case 22:if(R.memoizedState!==null){Wy(C);continue}}D!==null?(D.return=R,re=D):Wy(C)}p=p.sibling}e:for(p=null,C=e;;){if(C.tag===5){if(p===null){p=C;try{i=C.stateNode,S?(c=i.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(h=C.stateNode,g=C.memoizedProps.style,u=g!=null&&g.hasOwnProperty("display")?g.display:null,h.style.display=wS("display",u))}catch($){He(e,e.return,$)}}}else if(C.tag===6){if(p===null)try{C.stateNode.nodeValue=S?"":C.memoizedProps}catch($){He(e,e.return,$)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;p===C&&(p=null),C=C.return}p===C&&(p=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Fn(t,e),rr(e),r&4&&Gy(e);break;case 21:break;default:Fn(t,e),rr(e)}}function rr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(H_(n)){var r=n;break e}n=n.return}throw Error(J(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(qa(i,""),r.flags&=-33);var c=Vy(e);qf(e,c,i);break;case 3:case 4:var u=r.stateNode.containerInfo,h=Vy(e);Jf(e,h,u);break;default:throw Error(J(161))}}catch(g){He(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function _k(e,t,n){re=e,Q_(e)}function Q_(e,t,n){for(var r=(e.mode&1)!==0;re!==null;){var i=re,c=i.child;if(i.tag===22&&r){var u=i.memoizedState!==null||Nl;if(!u){var h=i.alternate,g=h!==null&&h.memoizedState!==null||Pt;h=Nl;var S=Pt;if(Nl=u,(Pt=g)&&!S)for(re=i;re!==null;)u=re,g=u.child,u.tag===22&&u.memoizedState!==null?Ky(i):g!==null?(g.return=u,re=g):Ky(i);for(;c!==null;)re=c,Q_(c),c=c.sibling;re=i,Nl=h,Pt=S}Hy(e)}else i.subtreeFlags&8772&&c!==null?(c.return=i,re=c):Hy(e)}}function Hy(e){for(;re!==null;){var t=re;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Pt||Bd(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Pt)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Bn(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var c=t.updateQueue;c!==null&&Iy(t,c,r);break;case 3:var u=t.updateQueue;if(u!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Iy(t,u,n)}break;case 5:var h=t.stateNode;if(n===null&&t.flags&4){n=h;var g=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":g.autoFocus&&n.focus();break;case"img":g.src&&(n.src=g.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var S=t.alternate;if(S!==null){var p=S.memoizedState;if(p!==null){var C=p.dehydrated;C!==null&&tc(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Pt||t.flags&512&&Yf(t)}catch(R){He(t,t.return,R)}}if(t===e){re=null;break}if(n=t.sibling,n!==null){n.return=t.return,re=n;break}re=t.return}}function Wy(e){for(;re!==null;){var t=re;if(t===e){re=null;break}var n=t.sibling;if(n!==null){n.return=t.return,re=n;break}re=t.return}}function Ky(e){for(;re!==null;){var t=re;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Bd(4,t)}catch(g){He(t,n,g)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(g){He(t,i,g)}}var c=t.return;try{Yf(t)}catch(g){He(t,c,g)}break;case 5:var u=t.return;try{Yf(t)}catch(g){He(t,u,g)}}}catch(g){He(t,t.return,g)}if(t===e){re=null;break}var h=t.sibling;if(h!==null){h.return=t.return,re=h;break}re=t.return}}var xk=Math.ceil,Td=$r.ReactCurrentDispatcher,Hh=$r.ReactCurrentOwner,Pn=$r.ReactCurrentBatchConfig,ye=0,dt=null,Ze=null,gt=0,un=0,vo=_s(0),ot=0,pc=null,di=0,zd=0,Wh=0,Ha=null,Zt=null,Kh=0,Ao=1/0,jr=null,Rd=!1,Xf=null,hs=null,Pl=!1,cs=null,Id=0,Wa=0,Zf=null,Yl=-1,Jl=0;function Vt(){return ye&6?Je():Yl!==-1?Yl:Yl=Je()}function ms(e){return e.mode&1?ye&2&&gt!==0?gt&-gt:ik.transition!==null?(Jl===0&&(Jl=PS()),Jl):(e=be,e!==0||(e=window.event,e=e===void 0?16:$S(e.type)),e):1}function Hn(e,t,n,r){if(50<Wa)throw Wa=0,Zf=null,Error(J(185));mc(e,n,r),(!(ye&2)||e!==dt)&&(e===dt&&(!(ye&2)&&(zd|=n),ot===4&&is(e,gt)),rn(e,r),n===1&&ye===0&&!(t.mode&1)&&(Ao=Je()+500,Ud&&xs()))}function rn(e,t){var n=e.callbackNode;iE(e,t);var r=pd(e,e===dt?gt:0);if(r===0)n!==null&&ny(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&ny(n),t===1)e.tag===0?sk(Qy.bind(null,e)):s_(Qy.bind(null,e)),ek(function(){!(ye&6)&&xs()}),n=null;else{switch(LS(r)){case 1:n=wh;break;case 4:n=jS;break;case 16:n=ud;break;case 536870912:n=NS;break;default:n=ud}n=nx(n,Y_.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Y_(e,t){if(Yl=-1,Jl=0,ye&6)throw Error(J(327));var n=e.callbackNode;if(Eo()&&e.callbackNode!==n)return null;var r=pd(e,e===dt?gt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=jd(e,r);else{t=r;var i=ye;ye|=2;var c=q_();(dt!==e||gt!==t)&&(jr=null,Ao=Je()+500,ii(e,t));do try{Ek();break}catch(h){J_(e,h)}while(!0);Ph(),Td.current=c,ye=i,Ze!==null?t=0:(dt=null,gt=0,t=ot)}if(t!==0){if(t===2&&(i=kf(e),i!==0&&(r=i,t=eh(e,i))),t===1)throw n=pc,ii(e,0),is(e,r),rn(e,Je()),n;if(t===6)is(e,r);else{if(i=e.current.alternate,!(r&30)&&!Ck(i)&&(t=jd(e,r),t===2&&(c=kf(e),c!==0&&(r=c,t=eh(e,c))),t===1))throw n=pc,ii(e,0),is(e,r),rn(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:Hs(e,Zt,jr);break;case 3:if(is(e,r),(r&130023424)===r&&(t=Kh+500-Je(),10<t)){if(pd(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){Vt(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Df(Hs.bind(null,e,Zt,jr),t);break}Hs(e,Zt,jr);break;case 4:if(is(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var u=31-Gn(r);c=1<<u,u=t[u],u>i&&(i=u),r&=~c}if(r=i,r=Je()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xk(r/1960))-r,10<r){e.timeoutHandle=Df(Hs.bind(null,e,Zt,jr),r);break}Hs(e,Zt,jr);break;case 5:Hs(e,Zt,jr);break;default:throw Error(J(329))}}}return rn(e,Je()),e.callbackNode===n?Y_.bind(null,e):null}function eh(e,t){var n=Ha;return e.current.memoizedState.isDehydrated&&(ii(e,t).flags|=256),e=jd(e,t),e!==2&&(t=Zt,Zt=n,t!==null&&th(t)),e}function th(e){Zt===null?Zt=e:Zt.push.apply(Zt,e)}function Ck(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],c=i.getSnapshot;i=i.value;try{if(!Kn(c(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function is(e,t){for(t&=~Wh,t&=~zd,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gn(t),r=1<<n;e[n]=-1,t&=~r}}function Qy(e){if(ye&6)throw Error(J(327));Eo();var t=pd(e,0);if(!(t&1))return rn(e,Je()),null;var n=jd(e,t);if(e.tag!==0&&n===2){var r=kf(e);r!==0&&(t=r,n=eh(e,r))}if(n===1)throw n=pc,ii(e,0),is(e,t),rn(e,Je()),n;if(n===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Hs(e,Zt,jr),rn(e,Je()),null}function Qh(e,t){var n=ye;ye|=1;try{return e(t)}finally{ye=n,ye===0&&(Ao=Je()+500,Ud&&xs())}}function ui(e){cs!==null&&cs.tag===0&&!(ye&6)&&Eo();var t=ye;ye|=1;var n=Pn.transition,r=be;try{if(Pn.transition=null,be=1,e)return e()}finally{be=r,Pn.transition=n,ye=t,!(ye&6)&&xs()}}function Yh(){un=vo.current,Ae(vo)}function ii(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,ZE(n)),Ze!==null)for(n=Ze.return;n!==null;){var r=n;switch(Ih(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&vd();break;case 3:Mo(),Ae(tn),Ae(Lt),Uh();break;case 5:Ah(r);break;case 4:Mo();break;case 13:Ae(Be);break;case 19:Ae(Be);break;case 10:Lh(r.type._context);break;case 22:case 23:Yh()}n=n.return}if(dt=e,Ze=e=gs(e.current,null),gt=un=t,ot=0,pc=null,Wh=zd=di=0,Zt=Ha=null,Qs!==null){for(t=0;t<Qs.length;t++)if(n=Qs[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,c=n.pending;if(c!==null){var u=c.next;c.next=i,r.next=u}n.pending=r}Qs=null}return e}function J_(e,t){do{var n=Ze;try{if(Ph(),Wl.current=kd,Ed){for(var r=ze.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ed=!1}if(li=0,lt=it=ze=null,Va=!1,lc=0,Hh.current=null,n===null||n.return===null){ot=1,pc=t,Ze=null;break}e:{var c=e,u=n.return,h=n,g=t;if(t=gt,h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){var S=g,p=h,C=p.tag;if(!(p.mode&1)&&(C===0||C===11||C===15)){var R=p.alternate;R?(p.updateQueue=R.updateQueue,p.memoizedState=R.memoizedState,p.lanes=R.lanes):(p.updateQueue=null,p.memoizedState=null)}var D=My(u);if(D!==null){D.flags&=-257,Oy(D,u,h,c,t),D.mode&1&&Dy(c,S,t),t=D,g=S;var B=t.updateQueue;if(B===null){var $=new Set;$.add(g),t.updateQueue=$}else B.add(g);break e}else{if(!(t&1)){Dy(c,S,t),Jh();break e}g=Error(J(426))}}else if(Fe&&h.mode&1){var y=My(u);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Oy(y,u,h,c,t),jh(Oo(g,h));break e}}c=g=Oo(g,h),ot!==4&&(ot=2),Ha===null?Ha=[c]:Ha.push(c),c=u;do{switch(c.tag){case 3:c.flags|=65536,t&=-t,c.lanes|=t;var l=L_(c,g,t);Ry(c,l);break e;case 1:h=g;var f=c.type,v=c.stateNode;if(!(c.flags&128)&&(typeof f.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(hs===null||!hs.has(v)))){c.flags|=65536,t&=-t,c.lanes|=t;var b=D_(c,h,t);Ry(c,b);break e}}c=c.return}while(c!==null)}Z_(n)}catch(P){t=P,Ze===n&&n!==null&&(Ze=n=n.return);continue}break}while(!0)}function q_(){var e=Td.current;return Td.current=kd,e===null?kd:e}function Jh(){(ot===0||ot===3||ot===2)&&(ot=4),dt===null||!(di&268435455)&&!(zd&268435455)||is(dt,gt)}function jd(e,t){var n=ye;ye|=2;var r=q_();(dt!==e||gt!==t)&&(jr=null,ii(e,t));do try{bk();break}catch(i){J_(e,i)}while(!0);if(Ph(),ye=n,Td.current=r,Ze!==null)throw Error(J(261));return dt=null,gt=0,ot}function bk(){for(;Ze!==null;)X_(Ze)}function Ek(){for(;Ze!==null&&!Jb();)X_(Ze)}function X_(e){var t=tx(e.alternate,e,un);e.memoizedProps=e.pendingProps,t===null?Z_(e):Ze=t,Hh.current=null}function Z_(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=yk(n,t),n!==null){n.flags&=32767,Ze=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ot=6,Ze=null;return}}else if(n=vk(n,t,un),n!==null){Ze=n;return}if(t=t.sibling,t!==null){Ze=t;return}Ze=t=e}while(t!==null);ot===0&&(ot=5)}function Hs(e,t,n){var r=be,i=Pn.transition;try{Pn.transition=null,be=1,kk(e,t,n,r)}finally{Pn.transition=i,be=r}return null}function kk(e,t,n,r){do Eo();while(cs!==null);if(ye&6)throw Error(J(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var c=n.lanes|n.childLanes;if(oE(e,c),e===dt&&(Ze=dt=null,gt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Pl||(Pl=!0,nx(ud,function(){return Eo(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=Pn.transition,Pn.transition=null;var u=be;be=1;var h=ye;ye|=4,Hh.current=null,Sk(e,n),K_(n,e),WE(Pf),fd=!!Nf,Pf=Nf=null,e.current=n,_k(n),qb(),ye=h,be=u,Pn.transition=c}else e.current=n;if(Pl&&(Pl=!1,cs=e,Id=i),c=e.pendingLanes,c===0&&(hs=null),eE(n.stateNode),rn(e,Je()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Rd)throw Rd=!1,e=Xf,Xf=null,e;return Id&1&&e.tag!==0&&Eo(),c=e.pendingLanes,c&1?e===Zf?Wa++:(Wa=0,Zf=e):Wa=0,xs(),null}function Eo(){if(cs!==null){var e=LS(Id),t=Pn.transition,n=be;try{if(Pn.transition=null,be=16>e?16:e,cs===null)var r=!1;else{if(e=cs,cs=null,Id=0,ye&6)throw Error(J(331));var i=ye;for(ye|=4,re=e.current;re!==null;){var c=re,u=c.child;if(re.flags&16){var h=c.deletions;if(h!==null){for(var g=0;g<h.length;g++){var S=h[g];for(re=S;re!==null;){var p=re;switch(p.tag){case 0:case 11:case 15:Ga(8,p,c)}var C=p.child;if(C!==null)C.return=p,re=C;else for(;re!==null;){p=re;var R=p.sibling,D=p.return;if(G_(p),p===S){re=null;break}if(R!==null){R.return=D,re=R;break}re=D}}}var B=c.alternate;if(B!==null){var $=B.child;if($!==null){B.child=null;do{var y=$.sibling;$.sibling=null,$=y}while($!==null)}}re=c}}if(c.subtreeFlags&2064&&u!==null)u.return=c,re=u;else e:for(;re!==null;){if(c=re,c.flags&2048)switch(c.tag){case 0:case 11:case 15:Ga(9,c,c.return)}var l=c.sibling;if(l!==null){l.return=c.return,re=l;break e}re=c.return}}var f=e.current;for(re=f;re!==null;){u=re;var v=u.child;if(u.subtreeFlags&2064&&v!==null)v.return=u,re=v;else e:for(u=f;re!==null;){if(h=re,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:Bd(9,h)}}catch(P){He(h,h.return,P)}if(h===u){re=null;break e}var b=h.sibling;if(b!==null){b.return=h.return,re=b;break e}re=h.return}}if(ye=i,xs(),hr&&typeof hr.onPostCommitFiberRoot=="function")try{hr.onPostCommitFiberRoot(Ld,e)}catch{}r=!0}return r}finally{be=n,Pn.transition=t}}return!1}function Yy(e,t,n){t=Oo(n,t),t=L_(e,t,1),e=fs(e,t,1),t=Vt(),e!==null&&(mc(e,1,t),rn(e,t))}function He(e,t,n){if(e.tag===3)Yy(e,e,n);else for(;t!==null;){if(t.tag===3){Yy(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(hs===null||!hs.has(r))){e=Oo(n,e),e=D_(t,e,1),t=fs(t,e,1),e=Vt(),t!==null&&(mc(t,1,e),rn(t,e));break}}t=t.return}}function Tk(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Vt(),e.pingedLanes|=e.suspendedLanes&n,dt===e&&(gt&n)===n&&(ot===4||ot===3&&(gt&130023424)===gt&&500>Je()-Kh?ii(e,0):Wh|=n),rn(e,t)}function ex(e,t){t===0&&(e.mode&1?(t=xl,xl<<=1,!(xl&130023424)&&(xl=4194304)):t=1);var n=Vt();e=Ar(e,t),e!==null&&(mc(e,t,n),rn(e,n))}function Rk(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),ex(e,n)}function Ik(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),ex(e,n)}var tx;tx=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||tn.current)en=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return en=!1,gk(e,t,n);en=!!(e.flags&131072)}else en=!1,Fe&&t.flags&1048576&&i_(t,Sd,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ql(e,t),e=t.pendingProps;var i=Po(t,Lt.current);bo(t,n),i=Fh(null,t,r,e,i,n);var c=Bh();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,nn(r)?(c=!0,yd(t)):c=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Mh(t),i.updater=Fd,t.stateNode=i,i._reactInternals=t,Bf(t,r,e,n),t=Gf(null,t,r,!0,c,n)):(t.tag=0,Fe&&c&&Rh(t),Bt(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ql(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=Nk(r),e=Bn(r,e),i){case 0:t=Vf(null,t,r,e,n);break e;case 1:t=$y(null,t,r,e,n);break e;case 11:t=Ay(null,t,r,e,n);break e;case 14:t=Uy(null,t,r,Bn(r.type,e),n);break e}throw Error(J(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Bn(r,i),Vf(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Bn(r,i),$y(e,t,r,i,n);case 3:e:{if(U_(t),e===null)throw Error(J(387));r=t.pendingProps,c=t.memoizedState,i=c.element,u_(e,t),Cd(t,r,null,n);var u=t.memoizedState;if(r=u.element,c.isDehydrated)if(c={element:r,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},t.updateQueue.baseState=c,t.memoizedState=c,t.flags&256){i=Oo(Error(J(423)),t),t=Fy(e,t,r,n,i);break e}else if(r!==i){i=Oo(Error(J(424)),t),t=Fy(e,t,r,n,i);break e}else for(hn=ps(t.stateNode.containerInfo.firstChild),mn=t,Fe=!0,Vn=null,n=l_(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Lo(),r===i){t=Ur(e,t,n);break e}Bt(e,t,r,n)}t=t.child}return t;case 5:return p_(t),e===null&&Uf(t),r=t.type,i=t.pendingProps,c=e!==null?e.memoizedProps:null,u=i.children,Lf(r,i)?u=null:c!==null&&Lf(r,c)&&(t.flags|=32),A_(e,t),Bt(e,t,u,n),t.child;case 6:return e===null&&Uf(t),null;case 13:return $_(e,t,n);case 4:return Oh(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Do(t,null,r,n):Bt(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Bn(r,i),Ay(e,t,r,i,n);case 7:return Bt(e,t,t.pendingProps,n),t.child;case 8:return Bt(e,t,t.pendingProps.children,n),t.child;case 12:return Bt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,c=t.memoizedProps,u=i.value,je(_d,r._currentValue),r._currentValue=u,c!==null)if(Kn(c.value,u)){if(c.children===i.children&&!tn.current){t=Ur(e,t,n);break e}}else for(c=t.child,c!==null&&(c.return=t);c!==null;){var h=c.dependencies;if(h!==null){u=c.child;for(var g=h.firstContext;g!==null;){if(g.context===r){if(c.tag===1){g=Dr(-1,n&-n),g.tag=2;var S=c.updateQueue;if(S!==null){S=S.shared;var p=S.pending;p===null?g.next=g:(g.next=p.next,p.next=g),S.pending=g}}c.lanes|=n,g=c.alternate,g!==null&&(g.lanes|=n),$f(c.return,n,t),h.lanes|=n;break}g=g.next}}else if(c.tag===10)u=c.type===t.type?null:c.child;else if(c.tag===18){if(u=c.return,u===null)throw Error(J(341));u.lanes|=n,h=u.alternate,h!==null&&(h.lanes|=n),$f(u,n,t),u=c.sibling}else u=c.child;if(u!==null)u.return=c;else for(u=c;u!==null;){if(u===t){u=null;break}if(c=u.sibling,c!==null){c.return=u.return,u=c;break}u=u.return}c=u}Bt(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,bo(t,n),i=Ln(i),r=r(i),t.flags|=1,Bt(e,t,r,n),t.child;case 14:return r=t.type,i=Bn(r,t.pendingProps),i=Bn(r.type,i),Uy(e,t,r,i,n);case 15:return M_(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Bn(r,i),Ql(e,t),t.tag=1,nn(r)?(e=!0,yd(t)):e=!1,bo(t,n),P_(t,r,i),Bf(t,r,i,n),Gf(null,t,r,!0,e,n);case 19:return F_(e,t,n);case 22:return O_(e,t,n)}throw Error(J(156,t.tag))};function nx(e,t){return IS(e,t)}function jk(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nn(e,t,n,r){return new jk(e,t,n,r)}function qh(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Nk(e){if(typeof e=="function")return qh(e)?1:0;if(e!=null){if(e=e.$$typeof,e===gh)return 11;if(e===vh)return 14}return 2}function gs(e,t){var n=e.alternate;return n===null?(n=Nn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ql(e,t,n,r,i,c){var u=2;if(r=e,typeof e=="function")qh(e)&&(u=1);else if(typeof e=="string")u=5;else e:switch(e){case oo:return oi(n.children,i,c,t);case mh:u=8,i|=8;break;case uf:return e=Nn(12,n,t,i|2),e.elementType=uf,e.lanes=c,e;case pf:return e=Nn(13,n,t,i),e.elementType=pf,e.lanes=c,e;case ff:return e=Nn(19,n,t,i),e.elementType=ff,e.lanes=c,e;case pS:return Vd(n,i,c,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case dS:u=10;break e;case uS:u=9;break e;case gh:u=11;break e;case vh:u=14;break e;case ns:u=16,r=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return t=Nn(u,n,t,i),t.elementType=e,t.type=r,t.lanes=c,t}function oi(e,t,n,r){return e=Nn(7,e,r,t),e.lanes=n,e}function Vd(e,t,n,r){return e=Nn(22,e,r,t),e.elementType=pS,e.lanes=n,e.stateNode={isHidden:!1},e}function Qp(e,t,n){return e=Nn(6,e,null,t),e.lanes=n,e}function Yp(e,t,n){return t=Nn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pk(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ip(0),this.expirationTimes=Ip(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ip(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Xh(e,t,n,r,i,c,u,h,g){return e=new Pk(e,t,n,h,g),t===1?(t=1,c===!0&&(t|=8)):t=0,c=Nn(3,null,null,t),e.current=c,c.stateNode=e,c.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mh(c),e}function Lk(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:io,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function rx(e){if(!e)return ws;e=e._reactInternals;e:{if(mi(e)!==e||e.tag!==1)throw Error(J(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(nn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(J(171))}if(e.tag===1){var n=e.type;if(nn(n))return r_(e,n,t)}return t}function sx(e,t,n,r,i,c,u,h,g){return e=Xh(n,r,!0,e,i,c,u,h,g),e.context=rx(null),n=e.current,r=Vt(),i=ms(n),c=Dr(r,i),c.callback=t??null,fs(n,c,i),e.current.lanes=i,mc(e,i,r),rn(e,r),e}function Gd(e,t,n,r){var i=t.current,c=Vt(),u=ms(i);return n=rx(n),t.context===null?t.context=n:t.pendingContext=n,t=Dr(c,u),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=fs(i,t,u),e!==null&&(Hn(e,i,u,c),Hl(e,i,u)),u}function Nd(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Jy(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Zh(e,t){Jy(e,t),(e=e.alternate)&&Jy(e,t)}function Dk(){return null}var ix=typeof reportError=="function"?reportError:function(e){console.error(e)};function em(e){this._internalRoot=e}Hd.prototype.render=em.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(J(409));Gd(e,t,null,null)};Hd.prototype.unmount=em.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ui(function(){Gd(null,e,null,null)}),t[Or]=null}};function Hd(e){this._internalRoot=e}Hd.prototype.unstable_scheduleHydration=function(e){if(e){var t=OS();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ss.length&&t!==0&&t<ss[n].priority;n++);ss.splice(n,0,e),n===0&&US(e)}};function tm(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Wd(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function qy(){}function Mk(e,t,n,r,i){if(i){if(typeof r=="function"){var c=r;r=function(){var S=Nd(u);c.call(S)}}var u=sx(t,r,e,0,null,!1,!1,"",qy);return e._reactRootContainer=u,e[Or]=u.current,sc(e.nodeType===8?e.parentNode:e),ui(),u}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var h=r;r=function(){var S=Nd(g);h.call(S)}}var g=Xh(e,0,!1,null,null,!1,!1,"",qy);return e._reactRootContainer=g,e[Or]=g.current,sc(e.nodeType===8?e.parentNode:e),ui(function(){Gd(t,g,n,r)}),g}function Kd(e,t,n,r,i){var c=n._reactRootContainer;if(c){var u=c;if(typeof i=="function"){var h=i;i=function(){var g=Nd(u);h.call(g)}}Gd(t,u,e,i)}else u=Mk(n,t,e,i,r);return Nd(u)}DS=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Oa(t.pendingLanes);n!==0&&(Sh(t,n|1),rn(t,Je()),!(ye&6)&&(Ao=Je()+500,xs()))}break;case 13:ui(function(){var r=Ar(e,1);if(r!==null){var i=Vt();Hn(r,e,1,i)}}),Zh(e,1)}};_h=function(e){if(e.tag===13){var t=Ar(e,134217728);if(t!==null){var n=Vt();Hn(t,e,134217728,n)}Zh(e,134217728)}};MS=function(e){if(e.tag===13){var t=ms(e),n=Ar(e,t);if(n!==null){var r=Vt();Hn(n,e,t,r)}Zh(e,t)}};OS=function(){return be};AS=function(e,t){var n=be;try{return be=e,t()}finally{be=n}};Cf=function(e,t,n){switch(t){case"input":if(gf(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Ad(r);if(!i)throw Error(J(90));hS(r),gf(r,i)}}}break;case"textarea":gS(e,n);break;case"select":t=n.value,t!=null&&So(e,!!n.multiple,t,!1)}};CS=Qh;bS=ui;var Ok={usingClientEntryPoint:!1,Events:[vc,uo,Ad,_S,xS,Qh]},Ea={findFiberByHostInstance:Ks,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ak={bundleType:Ea.bundleType,version:Ea.version,rendererPackageName:Ea.rendererPackageName,rendererConfig:Ea.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$r.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=TS(e),e===null?null:e.stateNode},findFiberByHostInstance:Ea.findFiberByHostInstance||Dk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ll=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ll.isDisabled&&Ll.supportsFiber)try{Ld=Ll.inject(Ak),hr=Ll}catch{}}vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ok;vn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tm(t))throw Error(J(200));return Lk(e,t,null,n)};vn.createRoot=function(e,t){if(!tm(e))throw Error(J(299));var n=!1,r="",i=ix;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Xh(e,1,!1,null,null,n,!1,r,i),e[Or]=t.current,sc(e.nodeType===8?e.parentNode:e),new em(t)};vn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=TS(t),e=e===null?null:e.stateNode,e};vn.flushSync=function(e){return ui(e)};vn.hydrate=function(e,t,n){if(!Wd(t))throw Error(J(200));return Kd(null,e,t,!0,n)};vn.hydrateRoot=function(e,t,n){if(!tm(e))throw Error(J(405));var r=n!=null&&n.hydratedSources||null,i=!1,c="",u=ix;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),t=sx(t,null,e,1,n??null,i,!1,c,u),e[Or]=t.current,sc(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Hd(t)};vn.render=function(e,t,n){if(!Wd(t))throw Error(J(200));return Kd(null,e,t,!1,n)};vn.unmountComponentAtNode=function(e){if(!Wd(e))throw Error(J(40));return e._reactRootContainer?(ui(function(){Kd(null,null,e,!1,function(){e._reactRootContainer=null,e[Or]=null})}),!0):!1};vn.unstable_batchedUpdates=Qh;vn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Wd(n))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return Kd(e,t,n,!1,r)};vn.version="18.3.1-next-f1338f8080-20240426";function ox(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ox)}catch(e){console.error(e)}}ox(),oS.exports=vn;var Uk=oS.exports,ax,Xy=Uk;ax=Xy.createRoot,Xy.hydrateRoot;var Jp={},nh={exports:{}},qp,Zy;function $k(){if(Zy)return qp;Zy=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,c=r*365.25;qp=function(p,C){C=C||{};var R=typeof p;if(R==="string"&&p.length>0)return u(p);if(R==="number"&&isFinite(p))return C.long?g(p):h(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function u(p){if(p=String(p),!(p.length>100)){var C=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(C){var R=parseFloat(C[1]),D=(C[2]||"ms").toLowerCase();switch(D){case"years":case"year":case"yrs":case"yr":case"y":return R*c;case"weeks":case"week":case"w":return R*i;case"days":case"day":case"d":return R*r;case"hours":case"hour":case"hrs":case"hr":case"h":return R*n;case"minutes":case"minute":case"mins":case"min":case"m":return R*t;case"seconds":case"second":case"secs":case"sec":case"s":return R*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return R;default:return}}}}function h(p){var C=Math.abs(p);return C>=r?Math.round(p/r)+"d":C>=n?Math.round(p/n)+"h":C>=t?Math.round(p/t)+"m":C>=e?Math.round(p/e)+"s":p+"ms"}function g(p){var C=Math.abs(p);return C>=r?S(p,C,r,"day"):C>=n?S(p,C,n,"hour"):C>=t?S(p,C,t,"minute"):C>=e?S(p,C,e,"second"):p+" ms"}function S(p,C,R,D){var B=C>=R*1.5;return Math.round(p/R)+" "+D+(B?"s":"")}return qp}function Fk(e){n.debug=n,n.default=n,n.coerce=g,n.disable=u,n.enable=i,n.enabled=h,n.humanize=$k(),n.destroy=S,Object.keys(e).forEach(p=>{n[p]=e[p]}),n.names=[],n.skips=[],n.formatters={};function t(p){let C=0;for(let R=0;R<p.length;R++)C=(C<<5)-C+p.charCodeAt(R),C|=0;return n.colors[Math.abs(C)%n.colors.length]}n.selectColor=t;function n(p){let C,R=null,D,B;function $(...y){if(!$.enabled)return;const l=$,f=Number(new Date),v=f-(C||f);l.diff=v,l.prev=C,l.curr=f,C=f,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let b=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(w,k)=>{if(w==="%%")return"%";b++;const I=n.formatters[k];if(typeof I=="function"){const O=y[b];w=I.call(l,O),y.splice(b,1),b--}return w}),n.formatArgs.call(l,y),(l.log||n.log).apply(l,y)}return $.namespace=p,$.useColors=n.useColors(),$.color=n.selectColor(p),$.extend=r,$.destroy=n.destroy,Object.defineProperty($,"enabled",{enumerable:!0,configurable:!1,get:()=>R!==null?R:(D!==n.namespaces&&(D=n.namespaces,B=n.enabled(p)),B),set:y=>{R=y}}),typeof n.init=="function"&&n.init($),$}function r(p,C){const R=n(this.namespace+(typeof C>"u"?":":C)+p);return R.log=this.log,R}function i(p){n.save(p),n.namespaces=p,n.names=[],n.skips=[];const C=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const R of C)R[0]==="-"?n.skips.push(R.slice(1)):n.names.push(R)}function c(p,C){let R=0,D=0,B=-1,$=0;for(;R<p.length;)if(D<C.length&&(C[D]===p[R]||C[D]==="*"))C[D]==="*"?(B=D,$=R,D++):(R++,D++);else if(B!==-1)D=B+1,$++,R=$;else return!1;for(;D<C.length&&C[D]==="*";)D++;return D===C.length}function u(){const p=[...n.names,...n.skips.map(C=>"-"+C)].join(",");return n.enable(""),p}function h(p){for(const C of n.skips)if(c(p,C))return!1;for(const C of n.names)if(c(p,C))return!0;return!1}function g(p){return p instanceof Error?p.stack||p.message:p}function S(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Bk=Fk;(function(e,t){var n={};t.formatArgs=i,t.save=c,t.load=u,t.useColors=r,t.storage=h(),t.destroy=(()=>{let S=!1;return()=>{S||(S=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let S;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(S=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(S[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(S){if(S[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+S[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;S.splice(1,0,p,"color: inherit");let C=0,R=0;S[0].replace(/%[a-zA-Z%]/g,D=>{D!=="%%"&&(C++,D==="%c"&&(R=C))}),S.splice(R,0,p)}t.log=console.debug||console.log||(()=>{});function c(S){try{S?t.storage.setItem("debug",S):t.storage.removeItem("debug")}catch{}}function u(){let S;try{S=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!S&&typeof process<"u"&&"env"in process&&(S=n.DEBUG),S}function h(){try{return localStorage}catch{}}e.exports=Bk(t);const{formatters:g}=e.exports;g.j=function(S){try{return JSON.stringify(S)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(nh,nh.exports);var Qd=nh.exports,cx={};Object.defineProperty(cx,"__esModule",{value:!0});var zs={},wt={};Object.defineProperty(wt,"__esModule",{value:!0});wt.Logger=void 0;const Qi=Qd,Yi="mediasoup-client";let zk=class{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=(0,Qi.default)(`${Yi}:${t}`),this._warn=(0,Qi.default)(`${Yi}:WARN:${t}`),this._error=(0,Qi.default)(`${Yi}:ERROR:${t}`)):(this._debug=(0,Qi.default)(Yi),this._warn=(0,Qi.default)(`${Yi}:WARN`),this._error=(0,Qi.default)(`${Yi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};wt.Logger=zk;var Mt={},nm={exports:{}},ko=typeof Reflect=="object"?Reflect:null,ew=ko&&typeof ko.apply=="function"?ko.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Xl;ko&&typeof ko.ownKeys=="function"?Xl=ko.ownKeys:Object.getOwnPropertySymbols?Xl=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Xl=function(t){return Object.getOwnPropertyNames(t)};function Vk(e){console&&console.warn&&console.warn(e)}var lx=Number.isNaN||function(t){return t!==t};function Te(){Te.init.call(this)}nm.exports=Te;nm.exports.once=Kk;Te.EventEmitter=Te;Te.prototype._events=void 0;Te.prototype._eventsCount=0;Te.prototype._maxListeners=void 0;var tw=10;function Yd(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Te,"defaultMaxListeners",{enumerable:!0,get:function(){return tw},set:function(e){if(typeof e!="number"||e<0||lx(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");tw=e}});Te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Te.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||lx(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function dx(e){return e._maxListeners===void 0?Te.defaultMaxListeners:e._maxListeners}Te.prototype.getMaxListeners=function(){return dx(this)};Te.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",c=this._events;if(c!==void 0)i=i&&c.error===void 0;else if(!i)return!1;if(i){var u;if(n.length>0&&(u=n[0]),u instanceof Error)throw u;var h=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw h.context=u,h}var g=c[t];if(g===void 0)return!1;if(typeof g=="function")ew(g,this,n);else for(var S=g.length,p=mx(g,S),r=0;r<S;++r)ew(p[r],this,n);return!0};function ux(e,t,n,r){var i,c,u;if(Yd(n),c=e._events,c===void 0?(c=e._events=Object.create(null),e._eventsCount=0):(c.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),c=e._events),u=c[t]),u===void 0)u=c[t]=n,++e._eventsCount;else if(typeof u=="function"?u=c[t]=r?[n,u]:[u,n]:r?u.unshift(n):u.push(n),i=dx(e),i>0&&u.length>i&&!u.warned){u.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=u.length,Vk(h)}return e}Te.prototype.addListener=function(t,n){return ux(this,t,n,!1)};Te.prototype.on=Te.prototype.addListener;Te.prototype.prependListener=function(t,n){return ux(this,t,n,!0)};function Gk(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function px(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Gk.bind(r);return i.listener=n,r.wrapFn=i,i}Te.prototype.once=function(t,n){return Yd(n),this.on(t,px(this,t,n)),this};Te.prototype.prependOnceListener=function(t,n){return Yd(n),this.prependListener(t,px(this,t,n)),this};Te.prototype.removeListener=function(t,n){var r,i,c,u,h;if(Yd(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(c=-1,u=r.length-1;u>=0;u--)if(r[u]===n||r[u].listener===n){h=r[u].listener,c=u;break}if(c<0)return this;c===0?r.shift():Hk(r,c),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,h||n)}return this};Te.prototype.off=Te.prototype.removeListener;Te.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var c=Object.keys(r),u;for(i=0;i<c.length;++i)u=c[i],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function fx(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Wk(i):mx(i,i.length)}Te.prototype.listeners=function(t){return fx(this,t,!0)};Te.prototype.rawListeners=function(t){return fx(this,t,!1)};Te.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):hx.call(e,t)};Te.prototype.listenerCount=hx;function hx(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Te.prototype.eventNames=function(){return this._eventsCount>0?Xl(this._events):[]};function mx(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function Hk(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function Wk(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Kk(e,t){return new Promise(function(n,r){function i(u){e.removeListener(t,c),r(u)}function c(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}gx(e,t,c,{once:!0}),t!=="error"&&Qk(e,i,{once:!0})})}function Qk(e,t,n){typeof e.on=="function"&&gx(e,"error",t,n)}function gx(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(c){r.once&&e.removeEventListener(t,i),n(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Yk=nm.exports;Object.defineProperty(Mt,"__esModule",{value:!0});Mt.EnhancedEventEmitter=void 0;const Jk=Yk,qk=wt,Xk=new qk.Logger("EnhancedEventEmitter");class Zk extends Jk.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(t,...n){return super.emit(t,...n)}safeEmit(t,...n){try{return super.emit(t,...n)}catch(r){Xk.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,r);try{super.emit("listenererror",t,r)}catch{}return!!super.listenerCount(t)}}on(t,n){return super.on(t,n),this}off(t,n){return super.off(t,n),this}addListener(t,n){return super.on(t,n),this}prependListener(t,n){return super.prependListener(t,n),this}once(t,n){return super.once(t,n),this}prependOnceListener(t,n){return super.prependOnceListener(t,n),this}removeListener(t,n){return super.off(t,n),this}removeAllListeners(t){return super.removeAllListeners(t),this}listenerCount(t){return super.listenerCount(t)}listeners(t){return super.listeners(t)}rawListeners(t){return super.rawListeners(t)}}Mt.EnhancedEventEmitter=Zk;var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.InvalidStateError=Dt.UnsupportedError=void 0;class rm extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,rm):this.stack=new Error(t).stack}}Dt.UnsupportedError=rm;class sm extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,sm):this.stack=new Error(t).stack}}Dt.InvalidStateError=sm;var gr={};Object.defineProperty(gr,"__esModule",{value:!0});gr.clone=e1;gr.generateRandomNumber=t1;gr.deepFreeze=vx;function e1(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function t1(){return Math.round(Math.random()*1e7)}function vx(e){const t=Reflect.ownKeys(e);for(const n of t){const r=e[n];(r&&typeof r=="object"||typeof r=="function")&&vx(r)}return Object.freeze(e)}var We={},vt={},Jd={};Object.defineProperty(Jd,"__esModule",{value:!0});Jd.Logger=void 0;const Ji=Qd,qi="h264-profile-level-id";let n1=class{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=(0,Ji.default)(`${qi}:${t}`),this._warn=(0,Ji.default)(`${qi}:WARN:${t}`),this._error=(0,Ji.default)(`${qi}:ERROR:${t}`)):(this._debug=(0,Ji.default)(qi),this._warn=(0,Ji.default)(`${qi}:WARN`),this._error=(0,Ji.default)(`${qi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};Jd.Logger=n1;Object.defineProperty(vt,"__esModule",{value:!0});vt.ProfileLevelId=vt.Level=vt.Profile=void 0;vt.parseProfileLevelId=yx;vt.profileLevelIdToString=wx;vt.profileToString=o1;vt.levelToString=a1;vt.parseSdpProfileLevelId=pi;vt.isSameProfile=c1;vt.isSameProfileAndLevel=l1;vt.generateProfileLevelIdStringForAnswer=d1;vt.supportedLevel=u1;const r1=Jd,Wn=new r1.Logger;var Re;(function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"})(Re||(vt.Profile=Re={}));var oe;(function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"})(oe||(vt.Level=oe={}));class qd{constructor(t,n){N(this,"profile");N(this,"level");this.profile=t,this.level=n}}vt.ProfileLevelId=qd;const s1=new qd(Re.ConstrainedBaseline,oe.L3_1);class Er{constructor(t){N(this,"mask");N(this,"masked_value");this.mask=~rw("x",t),this.masked_value=rw("1",t)}isMatch(t){return this.masked_value===(t&this.mask)}}class kr{constructor(t,n,r){N(this,"profile_idc");N(this,"profile_iop");N(this,"profile");this.profile_idc=t,this.profile_iop=n,this.profile=r}}const i1=[new kr(66,new Er("x1xx0000"),Re.ConstrainedBaseline),new kr(77,new Er("1xxx0000"),Re.ConstrainedBaseline),new kr(88,new Er("11xx0000"),Re.ConstrainedBaseline),new kr(66,new Er("x0xx0000"),Re.Baseline),new kr(88,new Er("10xx0000"),Re.Baseline),new kr(77,new Er("0x0x0000"),Re.Main),new kr(100,new Er("00000000"),Re.High),new kr(100,new Er("00001100"),Re.ConstrainedHigh),new kr(244,new Er("00000000"),Re.PredictiveHigh444)],nw=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:oe.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:oe.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:oe.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:oe.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:oe.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:oe.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:oe.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:oe.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:oe.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:oe.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:oe.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:oe.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:oe.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:oe.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:oe.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:oe.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:oe.L5_2}];function yx(e){if(typeof e!="string"||e.length!==6)return;const n=parseInt(e,16);if(n===0)return;const r=n&255,i=n>>8&255,c=n>>16&255;let u;switch(r){case oe.L1_1:{u=i&16?oe.L1_b:oe.L1_1;break}case oe.L1:case oe.L1_2:case oe.L1_3:case oe.L2:case oe.L2_1:case oe.L2_2:case oe.L3:case oe.L3_1:case oe.L3_2:case oe.L4:case oe.L4_1:case oe.L4_2:case oe.L5:case oe.L5_1:case oe.L5_2:{u=r;break}default:{Wn.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`);return}}for(const h of i1)if(c===h.profile_idc&&h.profile_iop.isMatch(i))return Wn.debug(`parseProfileLevelId() | result [str:${e}, profile:${h.profile}, level:${u}]`),new qd(h.profile,u);Wn.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${c}, profile_iop:${i}]`)}function wx(e){if(e.level==oe.L1_b)switch(e.profile){case Re.ConstrainedBaseline:return"42f00b";case Re.Baseline:return"42100b";case Re.Main:return"4d100b";default:{Wn.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`);return}}let t;switch(e.profile){case Re.ConstrainedBaseline:{t="42e0";break}case Re.Baseline:{t="4200";break}case Re.Main:{t="4d00";break}case Re.ConstrainedHigh:{t="640c";break}case Re.High:{t="6400";break}case Re.PredictiveHigh444:{t="f400";break}default:{Wn.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`);return}}let n=e.level.toString(16);return n.length===1&&(n=`0${n}`),`${t}${n}`}function o1(e){switch(e){case Re.ConstrainedBaseline:return"ConstrainedBaseline";case Re.Baseline:return"Baseline";case Re.Main:return"Main";case Re.ConstrainedHigh:return"ConstrainedHigh";case Re.High:return"High";case Re.PredictiveHigh444:return"PredictiveHigh444";default:{Wn.warn(`profileToString() | unrecognized profile ${e}`);return}}}function a1(e){switch(e){case oe.L1_b:return"1b";case oe.L1:return"1";case oe.L1_1:return"1.1";case oe.L1_2:return"1.2";case oe.L1_3:return"1.3";case oe.L2:return"2";case oe.L2_1:return"2.1";case oe.L2_2:return"2.2";case oe.L3:return"3";case oe.L3_1:return"3.1";case oe.L3_2:return"3.2";case oe.L4:return"4";case oe.L4_1:return"4.1";case oe.L4_2:return"4.2";case oe.L5:return"5";case oe.L5_1:return"5.1";case oe.L5_2:return"5.2";default:{Wn.warn(`levelToString() | unrecognized level ${e}`);return}}}function pi(e={}){const t=e["profile-level-id"];return t?yx(t):s1}function c1(e={},t={}){const n=pi(e),r=pi(t);return!!(n&&r&&n.profile===r.profile)}function l1(e={},t={}){const n=pi(e),r=pi(t);return!!(n&&r&&n.profile===r.profile&&n.level==r.level)}function d1(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){Wn.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const n=pi(e),r=pi(t);if(!n)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const i=sw(e)&&sw(t),c=n.level,u=r.level,h=f1(c,u),g=i?c:h;return Wn.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${n.profile}, level:${g}]`),wx(new qd(n.profile,g))}function u1(e,t){for(let r=nw.length-1;r>=0;--r){const i=nw[r];if(i.max_macroblock_frame_size*256<=e&&i.max_macroblocks_per_second<=t*i.max_macroblock_frame_size)return Wn.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${t}, level:${i.level}]`),i.level}Wn.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${t}]`)}function rw(e,t){return+(t[0]===e)<<7|+(t[1]===e)<<6|+(t[2]===e)<<5|+(t[3]===e)<<4|+(t[4]===e)<<3|+(t[5]===e)<<2|+(t[6]===e)<<1|+(t[7]===e)<<0}function p1(e,t){return e===oe.L1_b?t!==oe.L1&&t!==oe.L1_b:t===oe.L1_b?e!==oe.L1:e<t}function f1(e,t){return p1(e,t)?e:t}function sw(e={}){const t=e["level-asymmetry-allowed"];return t===!0||t===1||t==="1"}Object.defineProperty(We,"__esModule",{value:!0});We.validateAndNormalizeRtpCapabilities=y1;We.validateAndNormalizeRtpParameters=im;We.validateAndNormalizeSctpStreamParameters=w1;We.validateSctpCapabilities=S1;We.getExtendedRtpCapabilities=_1;We.getRecvRtpCapabilities=x1;We.getSendingRtpParameters=C1;We.getSendingRemoteRtpParameters=b1;We.reduceCodecs=E1;We.generateProbatorRtpParameters=k1;We.canSend=T1;We.canReceive=R1;const iw=vt,h1=gr,m1="probator",g1=1234,v1=127;function y1(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)I1(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)j1(t)}function im(e){if(typeof e!="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)N1(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)P1(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)L1(t);if(e.rtcp&&typeof e.rtcp!="object")throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),D1(e.rtcp)}function w1(e){if(typeof e!="object")throw new TypeError("params is not an object");if(typeof e.streamId!="number")throw new TypeError("missing params.streamId");let t=!1;if(typeof e.ordered=="boolean"?t=!0:e.ordered=!0,e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&typeof e.label!="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!="string")throw new TypeError("invalid params.protocol")}function S1(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!="object")throw new TypeError("missing caps.numStreams");M1(e.numStreams)}function _1(e,t,n){const r={codecs:[],headerExtensions:[]};if(n)for(const i of e.codecs??[]){if(yo(i))continue;const c=(t.codecs??[]).find(h=>rh(h,i,{strict:!0,modify:!0}));if(!c)continue;const u={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:c.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters??{},remoteParameters:c.parameters??{},rtcpFeedback:ow(i,c)};r.codecs.push(u)}else for(const i of t.codecs??[]){if(yo(i))continue;const c=(e.codecs??[]).find(h=>rh(h,i,{strict:!0,modify:!0}));if(!c)continue;const u={kind:c.kind,mimeType:c.mimeType,clockRate:c.clockRate,channels:c.channels,localPayloadType:c.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:c.parameters??{},remoteParameters:i.parameters??{},rtcpFeedback:ow(c,i)};r.codecs.push(u)}for(const i of r.codecs){const c=e.codecs.find(h=>{var g;return yo(h)&&((g=h.parameters)==null?void 0:g.apt)===i.localPayloadType}),u=t.codecs.find(h=>{var g;return yo(h)&&((g=h.parameters)==null?void 0:g.apt)===i.remotePayloadType});c&&u&&(i.localRtxPayloadType=c.preferredPayloadType,i.remoteRtxPayloadType=u.preferredPayloadType)}for(const i of t.headerExtensions){const c=e.headerExtensions.find(h=>O1(h,i));if(!c)continue;const u={kind:i.kind,uri:i.uri,sendId:c.preferredId,recvId:i.preferredId,encrypt:c.preferredEncrypt??!1,direction:"sendrecv"};switch(i.direction){case"sendrecv":{u.direction="sendrecv";break}case"recvonly":{u.direction="sendonly";break}case"sendonly":{u.direction="recvonly";break}case"inactive":{u.direction="inactive";break}}r.headerExtensions.push(u)}return r}function x1(e){const t={codecs:[],headerExtensions:[]};for(const n of e.codecs){const r={kind:n.kind,mimeType:n.mimeType,preferredPayloadType:n.remotePayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),!n.remoteRtxPayloadType)continue;const i={kind:n.kind,mimeType:`${n.kind}/rtx`,preferredPayloadType:n.remoteRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const n of e.headerExtensions){if(n.direction!=="sendrecv"&&n.direction!=="recvonly")continue;const r={kind:n.kind,uri:n.uri,preferredId:n.recvId,preferredEncrypt:n.encrypt??!1,direction:n.direction};t.headerExtensions.push(r)}return t}function C1(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const c={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(c)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}return n}function b1(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const c={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(c)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}if(n.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(n.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return n}function E1(e,t){const n=[];if(!t)n.push(e[0]),yo(e[1])&&n.push(e[1]);else{for(let r=0;r<e.length;++r)if(rh(e[r],t,{strict:!0})){n.push(e[r]),yo(e[r+1])&&n.push(e[r+1]);break}if(n.length===0)throw new TypeError("no matching codec found")}return n}function k1(e){e=h1.clone(e),im(e);const t={mid:m1,codecs:[],headerExtensions:[],encodings:[{ssrc:g1}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=v1,t.headerExtensions=e.headerExtensions,t}function T1(e,t){return(t.codecs??[]).some(n=>n.kind===e)}function R1(e,t){if(im(e),e.codecs.length===0)return!1;const n=e.codecs[0];return(t.codecs??[]).some(r=>r.preferredPayloadType===n.payloadType)}function I1(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(e.kind=n[1].toLowerCase(),typeof e.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");e.kind==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const r of Object.keys(e.parameters)){let i=e.parameters[r];if(i===void 0&&(e.parameters[r]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${i}]`);if(r==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const r of e.rtcpFeedback)Sx(r)}function Sx(e){if(typeof e!="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!="string")throw new TypeError("missing fb.type");(!e.parameter||typeof e.parameter!="string")&&(e.parameter="")}function j1(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&typeof e.direction!="string")throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function N1(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(typeof e.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");n[1].toLowerCase()==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const i of Object.keys(e.parameters)){let c=e.parameters[i];if(c===void 0&&(e.parameters[i]="",c=""),typeof c!="string"&&typeof c!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${c}]`);if(i==="apt"&&typeof c!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const i of e.rtcpFeedback)Sx(i)}function P1(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.id!="number")throw new TypeError("missing ext.id");if(e.encrypt&&typeof e.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const t of Object.keys(e.parameters)){let n=e.parameters[t];if(n===void 0&&(e.parameters[t]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError("invalid header extension parameter")}}function L1(e){if(typeof e!="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!="object")throw new TypeError("invalid encoding.rtx");if(e.rtx&&typeof e.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||typeof e.dtx!="boolean")&&(e.dtx=!1),e.scalabilityMode&&typeof e.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function D1(e){if(typeof e!="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!="string")throw new TypeError("invalid rtcp.cname");(!e.reducedSize||typeof e.reducedSize!="boolean")&&(e.reducedSize=!0)}function M1(e){if(typeof e!="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!="number")throw new TypeError("missing numStreams.MIS")}function yo(e){return e?/.+\/rtx$/i.test(e.mimeType):!1}function rh(e,t,{strict:n=!1,modify:r=!1}={}){const i=e.mimeType.toLowerCase(),c=t.mimeType.toLowerCase();if(i!==c||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(i){case"video/h264":{if(n){const u=e.parameters["packetization-mode"]??0,h=t.parameters["packetization-mode"]??0;if(u!==h||!iw.isSameProfile(e.parameters,t.parameters))return!1;let g;try{g=iw.generateProfileLevelIdStringForAnswer(e.parameters,t.parameters)}catch{return!1}r&&(g?(e.parameters["profile-level-id"]=g,t.parameters["profile-level-id"]=g):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break}case"video/vp9":{if(n){const u=e.parameters["profile-id"]??0,h=t.parameters["profile-id"]??0;if(u!==h)return!1}break}}return!0}function O1(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function ow(e,t){const n=[];for(const r of e.rtcpFeedback??[]){const i=(t.rtcpFeedback??[]).find(c=>c.type===r.type&&(c.parameter===r.parameter||!c.parameter&&!r.parameter));i&&n.push(i)}return n}var Xd={},_x={},Zd={},eu={};Object.defineProperty(eu,"__esModule",{value:!0});eu.Logger=void 0;const Xi=Qd,Zi="awaitqueue";class A1{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=Xi(`${Zi}:${t}`),this._warn=Xi(`${Zi}:WARN:${t}`),this._error=Xi(`${Zi}:ERROR:${t}`)):(this._debug=Xi(Zi),this._warn=Xi(`${Zi}:WARN`),this._error=Xi(`${Zi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}eu.Logger=A1;var fi={};Object.defineProperty(fi,"__esModule",{value:!0});fi.AwaitQueueRemovedTaskError=fi.AwaitQueueStoppedError=void 0;class om extends Error{constructor(t){super(t??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,om)}}fi.AwaitQueueStoppedError=om;class am extends Error{constructor(t){super(t??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,am)}}fi.AwaitQueueRemovedTaskError=am;Object.defineProperty(Zd,"__esModule",{value:!0});Zd.AwaitQueue=void 0;const U1=eu,Xp=fi,Tr=new U1.Logger("AwaitQueue");class $1{constructor(){N(this,"pendingTasks",new Map);N(this,"nextTaskId",0);Tr.debug("constructor()")}get size(){return this.pendingTasks.size}async push(t,n,r){if(n=n??t.name,Tr.debug(`push() [name:${n}, options:%o]`,r),typeof t!="function")throw new TypeError("given task is not a function");if(n)try{Object.defineProperty(t,"name",{value:n})}catch{}return new Promise((i,c)=>{if(n&&(r!=null&&r.removeOngoingTasksWithSameName))for(const h of this.pendingTasks.values())h.name===n&&h.reject(new Xp.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});const u={id:this.nextTaskId++,task:t,name:n,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:h=>{if(u.completed)return;u.completed=!0,this.pendingTasks.delete(u.id),Tr.debug(`resolving task [name:${u.name}]`),i(h);const[g]=this.pendingTasks.values();g&&!g.executedAt&&this.execute(g)},reject:(h,{canExecuteNextTask:g})=>{if(!u.completed&&(u.completed=!0,this.pendingTasks.delete(u.id),Tr.debug(`rejecting task [name:${u.name}]: %s`,String(h)),c(h),g)){const[S]=this.pendingTasks.values();S&&!S.executedAt&&this.execute(S)}}};this.pendingTasks.set(u.id,u),this.pendingTasks.size===1&&this.execute(u)})}stop(){Tr.debug("stop()");for(const t of this.pendingTasks.values())Tr.debug(`stop() | stopping task [name:${t.name}]`),t.reject(new Xp.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(t){Tr.debug(`remove() [taskIdx:${t}]`);const n=Array.from(this.pendingTasks.values())[t];if(!n){Tr.debug(`stop() | no task with given idx [taskIdx:${t}]`);return}n.reject(new Xp.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){const t=Date.now();let n=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:n++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:t-r.enqueuedAt,executionTime:r.executedAt?t-r.executedAt:0}))}async execute(t){if(Tr.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{const n=await t.task();t.resolve(n)}catch(n){t.reject(n,{canExecuteNextTask:!0})}}}Zd.AwaitQueue=$1;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var t=Zd;Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return t.AwaitQueue}});var n=fi;Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return n.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return n.AwaitQueueRemovedTaskError}})})(_x);var tu={};Object.defineProperty(tu,"__esModule",{value:!0});tu.Producer=void 0;const F1=wt,aw=Mt,eo=Dt,sr=new F1.Logger("Producer");class B1 extends aw.EnhancedEventEmitter{constructor({id:n,localId:r,rtpSender:i,track:c,rtpParameters:u,stopTracks:h,disableTrackOnPause:g,zeroRtpOnPause:S,appData:p}){super();N(this,"_id");N(this,"_localId");N(this,"_closed",!1);N(this,"_rtpSender");N(this,"_track");N(this,"_kind");N(this,"_rtpParameters");N(this,"_paused");N(this,"_maxSpatialLayer");N(this,"_stopTracks");N(this,"_disableTrackOnPause");N(this,"_zeroRtpOnPause");N(this,"_appData");N(this,"_observer",new aw.EnhancedEventEmitter);sr.debug("constructor()"),this._id=n,this._localId=r,this._rtpSender=i,this._track=c,this._kind=c.kind,this._rtpParameters=u,this._paused=g?!c.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=h,this._disableTrackOnPause=g,this._zeroRtpOnPause=S,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(sr.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(sr.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new eo.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(sr.debug("pause()"),this._closed){sr.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@pause",n,r)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(sr.debug("resume()"),this._closed){sr.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@resume",n,r)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:n}){if(sr.debug("replaceTrack() [track:%o]",n),this._closed){if(n&&this._stopTracks)try{n.stop()}catch{}throw new eo.InvalidStateError("closed")}else if((n==null?void 0:n.readyState)==="ended")throw new eo.InvalidStateError("track ended");if(n===this._track){sr.debug("replaceTrack() | same track, ignored");return}await new Promise((r,i)=>{this.safeEmit("@replacetrack",n,r,i)}),this.destroyTrack(),this._track=n,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(n){if(this._closed)throw new eo.InvalidStateError("closed");if(this._kind!=="video")throw new eo.UnsupportedError("not a video Producer");if(typeof n!="number")throw new TypeError("invalid spatialLayer");n!==this._maxSpatialLayer&&(await new Promise((r,i)=>{this.safeEmit("@setmaxspatiallayer",n,r,i)}).catch(()=>{}),this._maxSpatialLayer=n)}async setRtpEncodingParameters(n){if(this._closed)throw new eo.InvalidStateError("closed");if(typeof n!="object")throw new TypeError("invalid params");await new Promise((r,i)=>{this.safeEmit("@setrtpencodingparameters",n,r,i)})}onTrackEnded(){sr.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}tu.Producer=B1;var nu={};Object.defineProperty(nu,"__esModule",{value:!0});nu.Consumer=void 0;const z1=wt,cw=Mt,V1=Dt,ir=new z1.Logger("Consumer");class G1 extends cw.EnhancedEventEmitter{constructor({id:n,localId:r,producerId:i,rtpReceiver:c,track:u,rtpParameters:h,appData:g}){super();N(this,"_id");N(this,"_localId");N(this,"_producerId");N(this,"_closed",!1);N(this,"_rtpReceiver");N(this,"_track");N(this,"_rtpParameters");N(this,"_paused");N(this,"_appData");N(this,"_observer",new cw.EnhancedEventEmitter);ir.debug("constructor()"),this._id=n,this._localId=r,this._producerId=i,this._rtpReceiver=c,this._track=u,this._rtpParameters=h,this._paused=!u.enabled,this._appData=g??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(ir.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(ir.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new V1.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(ir.debug("pause()"),this._closed){ir.error("pause() | Consumer closed");return}if(this._paused){ir.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(ir.debug("resume()"),this._closed){ir.error("resume() | Consumer closed");return}if(!this._paused){ir.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){ir.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}nu.Consumer=G1;var ru={};Object.defineProperty(ru,"__esModule",{value:!0});ru.DataProducer=void 0;const H1=wt,lw=Mt,W1=Dt,Rr=new H1.Logger("DataProducer");class K1 extends lw.EnhancedEventEmitter{constructor({id:n,dataChannel:r,sctpStreamParameters:i,appData:c}){super();N(this,"_id");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new lw.EnhancedEventEmitter);Rr.debug("constructor()"),this._id=n,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=c??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._dataChannel.bufferedAmountLowThreshold=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Rr.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Rr.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(n){if(Rr.debug("send()"),this._closed)throw new W1.InvalidStateError("closed");this._dataChannel.send(n)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Rr.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,c;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?Rr.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(c=n.error)==null?void 0:c.sctpCauseCode,n.error.message):Rr.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Rr.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||Rr.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}ru.DataProducer=K1;var su={};Object.defineProperty(su,"__esModule",{value:!0});su.DataConsumer=void 0;const Q1=wt,dw=Mt,Vs=new Q1.Logger("DataConsumer");class Y1 extends dw.EnhancedEventEmitter{constructor({id:n,dataProducerId:r,dataChannel:i,sctpStreamParameters:c,appData:u}){super();N(this,"_id");N(this,"_dataProducerId");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new dw.EnhancedEventEmitter);Vs.debug("constructor()"),this._id=n,this._dataProducerId=r,this._dataChannel=i,this._sctpStreamParameters=c,this._appData=u??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(n){this._dataChannel.binaryType=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Vs.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Vs.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Vs.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,c;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?Vs.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(c=n.error)==null?void 0:c.sctpCauseCode,n.error.message):Vs.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Vs.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",n=>{this._closed||this.safeEmit("message",n.data)})}}su.DataConsumer=Y1;Object.defineProperty(Xd,"__esModule",{value:!0});Xd.Transport=void 0;const J1=_x,q1=wt,uw=Mt,st=Dt,Zp=gr,ka=We,X1=tu,Z1=nu,eT=ru,tT=su,Ye=new q1.Logger("Transport");class nT{constructor(t){N(this,"consumerOptions");N(this,"promise");N(this,"resolve");N(this,"reject");this.consumerOptions=t,this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}class rT extends uw.EnhancedEventEmitter{constructor({direction:n,id:r,iceParameters:i,iceCandidates:c,dtlsParameters:u,sctpParameters:h,iceServers:g,iceTransportPolicy:S,additionalSettings:p,appData:C,handlerFactory:R,getSendExtendedRtpCapabilities:D,recvRtpCapabilities:B,canProduceByKind:$}){super();N(this,"_id");N(this,"_closed",!1);N(this,"_direction");N(this,"_getSendExtendedRtpCapabilities");N(this,"_recvRtpCapabilities");N(this,"_canProduceByKind");N(this,"_maxSctpMessageSize");N(this,"_handler");N(this,"_iceGatheringState","new");N(this,"_connectionState","new");N(this,"_appData");N(this,"_producers",new Map);N(this,"_consumers",new Map);N(this,"_dataProducers",new Map);N(this,"_dataConsumers",new Map);N(this,"_probatorConsumerCreated",!1);N(this,"_awaitQueue",new J1.AwaitQueue);N(this,"_pendingConsumerTasks",[]);N(this,"_consumerCreationInProgress",!1);N(this,"_pendingPauseConsumers",new Map);N(this,"_consumerPauseInProgress",!1);N(this,"_pendingResumeConsumers",new Map);N(this,"_consumerResumeInProgress",!1);N(this,"_pendingCloseConsumers",new Map);N(this,"_consumerCloseInProgress",!1);N(this,"_observer",new uw.EnhancedEventEmitter);Ye.debug("constructor() [id:%s, direction:%s]",r,n),this._id=r,this._direction=n,this._getSendExtendedRtpCapabilities=D,this._recvRtpCapabilities=B,this._canProduceByKind=$,this._maxSctpMessageSize=h?h.maxMessageSize:null;const y=Zp.clone(p)??{};delete y.iceServers,delete y.iceTransportPolicy,delete y.bundlePolicy,delete y.rtcpMuxPolicy,this._handler=R.factory({direction:n,iceParameters:i,iceCandidates:c,dtlsParameters:u,sctpParameters:h,iceServers:g,iceTransportPolicy:S,additionalSettings:y,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=C??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){if(!this._closed){Ye.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const n of this._producers.values())n.transportClosed();this._producers.clear();for(const n of this._consumers.values())n.transportClosed();this._consumers.clear();for(const n of this._dataProducers.values())n.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new st.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:n}){if(Ye.debug("restartIce()"),this._closed)throw new st.InvalidStateError("closed");if(!n)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(n),"transport.restartIce()")}async updateIceServers({iceServers:n}={}){if(Ye.debug("updateIceServers()"),this._closed)throw new st.InvalidStateError("closed");if(!Array.isArray(n))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(n),"transport.updateIceServers()")}async produce({track:n,streamId:r,encodings:i,codecOptions:c,headerExtensionOptions:u,codec:h,stopTracks:g=!0,disableTrackOnPause:S=!0,zeroRtpOnPause:p=!1,onRtpSender:C,appData:R={}}={}){if(Ye.debug("produce() [track:%o]",n),this._closed)throw new st.InvalidStateError("closed");if(n){if(this._direction!=="send")throw new st.UnsupportedError("not a sending Transport");if(this._canProduceByKind[n.kind]){if(n.readyState==="ended")throw new st.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(R&&typeof R!="object")throw new TypeError("if given, appData must be an object")}else throw new st.UnsupportedError(`cannot produce ${n.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let D;if(i&&!Array.isArray(i))throw TypeError("encodings must be an array");(i==null?void 0:i.length)===0?D=void 0:i&&(D=i.map(l=>{const f={active:!0};return l.active===!1&&(f.active=!1),typeof l.dtx=="boolean"&&(f.dtx=l.dtx),typeof l.scalabilityMode=="string"&&(f.scalabilityMode=l.scalabilityMode),typeof l.scaleResolutionDownBy=="number"&&(f.scaleResolutionDownBy=l.scaleResolutionDownBy),typeof l.maxBitrate=="number"&&(f.maxBitrate=l.maxBitrate),typeof l.maxFramerate=="number"&&(f.maxFramerate=l.maxFramerate),typeof l.adaptivePtime=="boolean"&&(f.adaptivePtime=l.adaptivePtime),typeof l.priority=="string"&&(f.priority=l.priority),typeof l.networkPriority=="string"&&(f.networkPriority=l.networkPriority),f}));const{localId:B,rtpParameters:$,rtpSender:y}=await this._handler.send({track:n,streamId:r,encodings:D,codecOptions:c,headerExtensionOptions:u,codec:h,onRtpSender:C});try{ka.validateAndNormalizeRtpParameters($);const{id:l}=await new Promise((v,b)=>{this.safeEmit("produce",{kind:n.kind,rtpParameters:$,appData:R},v,b)}),f=new X1.Producer({id:l,localId:B,rtpSender:y,track:n,rtpParameters:$,stopTracks:g,disableTrackOnPause:S,zeroRtpOnPause:p,appData:R});return this._producers.set(f.id,f),this.handleProducer(f),this._observer.safeEmit("newproducer",f),f}catch(l){throw this._handler.stopSending(B).catch(()=>{}),l}},"transport.produce()").catch(D=>{if(g)try{n.stop()}catch{}throw D})}async consume({id:n,producerId:r,kind:i,rtpParameters:c,streamId:u,onRtpReceiver:h,appData:g={}}){if(Ye.debug("consume()"),this._closed)throw new st.InvalidStateError("closed");if(this._direction!=="recv")throw new st.UnsupportedError("not a receiving Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind '${i}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(g&&typeof g!="object")throw new TypeError("if given, appData must be an object");const S=Zp.clone(c);if(!ka.canReceive(S,this._recvRtpCapabilities))throw new st.UnsupportedError("cannot consume this Producer");const C=new nT({id:n,producerId:r,kind:i,rtpParameters:S,streamId:u,onRtpReceiver:h,appData:g});return this._pendingConsumerTasks.push(C),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),C.promise}async produceData({ordered:n=!0,maxPacketLifeTime:r,maxRetransmits:i,label:c="",protocol:u="",appData:h={}}={}){if(Ye.debug("produceData()"),this._closed)throw new st.InvalidStateError("closed");if(this._direction!=="send")throw new st.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object")}else throw new st.UnsupportedError("SCTP not enabled by remote Transport");return(r||i)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:g,sctpStreamParameters:S}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:u});ka.validateAndNormalizeSctpStreamParameters(S);const{id:p}=await new Promise((R,D)=>{this.safeEmit("producedata",{sctpStreamParameters:S,label:c,protocol:u,appData:h},R,D)}),C=new eT.DataProducer({id:p,dataChannel:g,sctpStreamParameters:S,appData:h});return this._dataProducers.set(C.id,C),this.handleDataProducer(C),this._observer.safeEmit("newdataproducer",C),C},"transport.produceData()")}async consumeData({id:n,dataProducerId:r,sctpStreamParameters:i,label:c="",protocol:u="",appData:h={}}){if(Ye.debug("consumeData()"),this._closed)throw new st.InvalidStateError("closed");if(this._direction!=="recv")throw new st.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object")}else throw new st.UnsupportedError("SCTP not enabled by remote Transport");const g=Zp.clone(i);return ka.validateAndNormalizeSctpStreamParameters(g),this._awaitQueue.push(async()=>{const{dataChannel:S}=await this._handler.receiveDataChannel({sctpStreamParameters:g,label:c,protocol:u}),p=new tT.DataConsumer({id:n,dataProducerId:r,dataChannel:S,sctpStreamParameters:g,appData:h});return this._dataConsumers.set(p.id,p),this.handleDataConsumer(p),this._observer.safeEmit("newdataconsumer",p),p},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){Ye.debug("createPendingConsumers() | there is no Consumer to be created");return}const n=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r;const i=[];for(const c of n){const{id:u,kind:h,rtpParameters:g,streamId:S,onRtpReceiver:p}=c.consumerOptions;i.push({trackId:u,kind:h,rtpParameters:g,streamId:S,onRtpReceiver:p})}try{const c=await this._handler.receive(i);for(let u=0;u<c.length;++u){const h=n[u],g=c[u],{id:S,producerId:p,kind:C,rtpParameters:R,appData:D}=h.consumerOptions,{localId:B,rtpReceiver:$,track:y}=g,l=new Z1.Consumer({id:S,localId:B,producerId:p,rtpReceiver:$,track:y,rtpParameters:R,appData:D});this._consumers.set(l.id,l),this.handleConsumer(l),!this._probatorConsumerCreated&&!r&&C==="video"&&(r=l),this._observer.safeEmit("newconsumer",l),h.resolve(l)}}catch(c){for(const u of n)u.reject(c)}if(r)try{const c=ka.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:c}]),Ye.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(c){Ye.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",c)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){Ye.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const n=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.pauseReceiving(r)}catch(r){Ye.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){Ye.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const n=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.resumeReceiving(r)}catch(r){Ye.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){Ye.debug("closePendingConsumers() | there is no Consumer to be closed");return}const n=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(n.map(r=>r.localId))}catch(r){Ye.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const n=this._handler;n.on("@connect",({dtlsParameters:r},i,c)=>{if(this._closed){c(new st.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:r},i,c)}),n.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(Ye.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),n.on("@icecandidateerror",r=>{Ye.warn(`ICE candidate error [url:${r.url}, localAddress:${r.address}, localPort:${r.port}]: ${r.errorCode} "${r.errorText}"`),this.safeEmit("icecandidateerror",r)}),n.on("@connectionstatechange",r=>{r!==this._connectionState&&(Ye.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(n.localId),"producer @close event").catch(r=>Ye.warn("producer.close() failed:%o",r))}),n.on("@pause",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(n.localId),"producer @pause event").then(r).catch(i)}),n.on("@resume",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(n.localId),"producer @resume event").then(r).catch(i)}),n.on("@replacetrack",(r,i,c)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(n.localId,r),"producer @replacetrack event").then(i).catch(c)}),n.on("@setmaxspatiallayer",(r,i,c)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(n.localId,r),"producer @setmaxspatiallayer event").then(i).catch(c)}),n.on("@setrtpencodingparameters",(r,i,c)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(n.localId,r),"producer @setrtpencodingparameters event").then(i).catch(c)}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new st.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(r).catch(i)})}handleConsumer(n){n.on("@close",()=>{this._consumers.delete(n.id),this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.delete(n.id),!this._closed&&(this._pendingCloseConsumers.set(n.id,n),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),n.on("@pause",()=>{this._pendingResumeConsumers.has(n.id)&&this._pendingResumeConsumers.delete(n.id),this._pendingPauseConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),n.on("@resume",()=>{this._pendingPauseConsumers.has(n.id)&&this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new st.InvalidStateError("closed"));this._handler.getReceiverStats(n.localId).then(r).catch(i)})}handleDataProducer(n){n.on("@close",()=>{this._dataProducers.delete(n.id)})}handleDataConsumer(n){n.on("@close",()=>{this._dataConsumers.delete(n.id)})}}Xd.Transport=rT;var Ta={},St={},xx={},Cx={exports:{}},pw=Cx.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(pw).forEach(function(e){var t=pw[e];t.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var cm=Cx.exports;(function(e){var t=function(h){return String(Number(h))===h?Number(h):h},n=function(h,g,S,p){if(p&&!S)g[p]=t(h[1]);else for(var C=0;C<S.length;C+=1)h[C+1]!=null&&(g[S[C]]=t(h[C+1]))},r=function(h,g,S){var p=h.name&&h.names;h.push&&!g[h.push]?g[h.push]=[]:p&&!g[h.name]&&(g[h.name]={});var C=h.push?{}:p?g[h.name]:g;n(S.match(h.reg),C,h.names,h.name),h.push&&g[h.push].push(C)},i=cm,c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(h){var g={},S=[],p=g;return h.split(/(\r\n|\r|\n)/).filter(c).forEach(function(C){var R=C[0],D=C.slice(2);R==="m"&&(S.push({rtp:[],fmtp:[]}),p=S[S.length-1]);for(var B=0;B<(i[R]||[]).length;B+=1){var $=i[R][B];if($.reg.test(D))return r($,p,D)}}),g.media=S,g};var u=function(h,g){var S=g.split(/=(.+)/,2);return S.length===2?h[S[0]]=t(S[1]):S.length===1&&g.length>1&&(h[S[0]]=void 0),h};e.parseParams=function(h){return h.split(/;\s?/).reduce(u,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(h){return h.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(h){for(var g=[],S=h.split(" ").map(t),p=0;p<S.length;p+=3)g.push({component:S[p],ip:S[p+1],port:S[p+2]});return g},e.parseImageAttributes=function(h){return h.split(" ").map(function(g){return g.substring(1,g.length-1).split(",").reduce(u,{})})},e.parseSimulcastStreamList=function(h){return h.split(";").map(function(g){return g.split(",").map(function(S){var p,C=!1;return S[0]!=="~"?p=t(S):(p=t(S.substring(1,S.length)),C=!0),{scid:p,paused:C}})})}})(xx);var ef=cm,sT=/%[sdv%]/g,iT=function(e){var t=1,n=arguments,r=n.length;return e.replace(sT,function(i){if(t>=r)return i;var c=n[t];switch(t+=1,i){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})},Ra=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var c=0;c<t.names.length;c+=1){var u=t.names[c];t.name?i.push(n[t.name][u]):i.push(n[t.names[c]])}else i.push(n[t.name]);return iT.apply(null,i)},oT=["v","o","s","i","u","e","p","c","b","t","r","z","a"],aT=["i","c","b","a"],cT=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(c){c.payloads==null&&(c.payloads="")});var n=t.outerOrder||oT,r=t.innerOrder||aT,i=[];return n.forEach(function(c){ef[c].forEach(function(u){u.name in e&&e[u.name]!=null?i.push(Ra(c,u,e)):u.push in e&&e[u.push]!=null&&e[u.push].forEach(function(h){i.push(Ra(c,u,h))})})}),e.media.forEach(function(c){i.push(Ra("m",ef.m[0],c)),r.forEach(function(u){ef[u].forEach(function(h){h.name in c&&c[h.name]!=null?i.push(Ra(u,h,c)):h.push in c&&c[h.push]!=null&&c[h.push].forEach(function(g){i.push(Ra(u,h,g))})})})}),i.join(`\r
`)+`\r
`},gi=xx,lT=cT,dT=cm;St.grammar=dT;St.write=lT;St.parse=gi.parse;St.parseParams=gi.parseParams;St.parseFmtpConfig=gi.parseFmtpConfig;St.parsePayloads=gi.parsePayloads;St.parseRemoteCandidates=gi.parseRemoteCandidates;St.parseImageAttributes=gi.parseImageAttributes;St.parseSimulcastStreamList=gi.parseSimulcastStreamList;var Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.parse=pT;const uT=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function pT(e){const t=uT.exec(e??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}var Ia={},vs={};Object.defineProperty(vs,"__esModule",{value:!0});vs.OfferMediaSection=vs.AnswerMediaSection=vs.MediaSection=void 0;const fT=St,fw=gr;class lm{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r}){N(this,"_mediaObject");if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},t&&this.setIceParameters(t),n){this._mediaObject.candidates=[];for(const i of n){const c={foundation:i.foundation,component:1,ip:i.address??i.ip,port:i.port,priority:i.priority,transport:i.protocol,type:i.type};i.tcpType&&(c.tcptype=i.tcpType),this._mediaObject.candidates.push(c)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(t){this._mediaObject.iceUfrag=t.usernameFragment,this._mediaObject.icePwd=t.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause()}close(){this.disable(),this._mediaObject.port=0,delete this._mediaObject.candidates,delete this._mediaObject.endOfCandidates,delete this._mediaObject.iceUfrag,delete this._mediaObject.icePwd,delete this._mediaObject.iceOptions,this._mediaObject.rtp=[],this._mediaObject.fmtp=[],delete this._mediaObject.rtcp,delete this._mediaObject.rtcpFb,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}vs.MediaSection=lm;class hT extends lm{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:c,offerMediaObject:u,offerRtpParameters:h,answerRtpParameters:g,codecOptions:S}){switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(u.mid),this._mediaObject.type=u.type,this._mediaObject.protocol=u.protocol,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),u.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const p of g.codecs){const C={payload:p.payloadType,codec:bx(p),rate:p.clockRate};p.channels>1&&(C.encoding=p.channels),this._mediaObject.rtp.push(C);const R=fw.clone(p.parameters)??{};let D=fw.clone(p.rtcpFeedback)??[];if(S){const{opusStereo:$,opusFec:y,opusDtx:l,opusMaxPlaybackRate:f,opusMaxAverageBitrate:v,opusPtime:b,opusNack:P,videoGoogleStartBitrate:w,videoGoogleMaxBitrate:k,videoGoogleMinBitrate:I}=S,O=h.codecs.find(L=>L.payloadType===p.payloadType);switch(p.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{$!==void 0&&(O.parameters["sprop-stereo"]=$?1:0,R.stereo=$?1:0),y!==void 0&&(O.parameters.useinbandfec=y?1:0,R.useinbandfec=y?1:0),l!==void 0&&(O.parameters.usedtx=l?1:0,R.usedtx=l?1:0),f!==void 0&&(R.maxplaybackrate=f),v!==void 0&&(R.maxaveragebitrate=v),b!==void 0&&(O.parameters.ptime=b,R.ptime=b),P||(O.rtcpFeedback=O.rtcpFeedback.filter(L=>L.type!=="nack"||L.parameter),D=D.filter(L=>L.type!=="nack"||L.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{w!==void 0&&(R["x-google-start-bitrate"]=w),k!==void 0&&(R["x-google-max-bitrate"]=k),I!==void 0&&(R["x-google-min-bitrate"]=I);break}}}const B={payload:p.payloadType,config:""};for(const $ of Object.keys(R))B.config&&(B.config+=";"),B.config+=`${$}=${R[$]}`;B.config&&this._mediaObject.fmtp.push(B);for(const $ of D)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:$.type,subtype:$.parameter})}this._mediaObject.payloads=g.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of g.headerExtensions)(u.ext??[]).some(R=>R.uri===p.uri)&&this._mediaObject.ext.push({uri:p.uri,value:p.id});if(u.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),u.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:u.simulcast.list1},this._mediaObject.rids=[];for(const p of u.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}else if(u.simulcast_03){this._mediaObject.simulcast_03={value:u.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const p of u.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof u.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):u.sctpmap&&(this._mediaObject.payloads=String(i.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(t){switch(t){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(t){var c,u;if(!((c=this._mediaObject.simulcast)!=null&&c.list1))return;const n={};for(const h of t)h.rid&&(n[h.rid]=h);const r=this._mediaObject.simulcast.list1,i=fT.parseSimulcastStreamList(r);for(const h of i)for(const g of h)g.paused=!((u=n[g.scid])!=null&&u.active);this._mediaObject.simulcast.list1=i.map(h=>h.map(g=>`${g.paused?"~":""}${g.scid}`).join(",")).join(";")}}vs.AnswerMediaSection=hT;class mT extends lm{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:c,mid:u,kind:h,offerRtpParameters:g,streamId:S,trackId:p}){var C;switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(u),this._mediaObject.type=h,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",h){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:S,appdata:p}];for(const $ of g.codecs){const y={payload:$.payloadType,codec:bx($),rate:$.clockRate};$.channels>1&&(y.encoding=$.channels),this._mediaObject.rtp.push(y);const l={payload:$.payloadType,config:""};for(const f of Object.keys($.parameters??{}))l.config&&(l.config+=";"),l.config+=`${f}=${$.parameters[f]}`;l.config&&this._mediaObject.fmtp.push(l);for(const f of $.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:$.payloadType,type:f.type,subtype:f.parameter})}this._mediaObject.payloads=g.codecs.map($=>$.payloadType).join(" "),this._mediaObject.ext=[];for(const $ of g.headerExtensions)this._mediaObject.ext.push({uri:$.uri,value:$.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const R=g.encodings[0],D=R.ssrc,B=(C=R.rtx)==null?void 0:C.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],D&&g.rtcp.cname&&this._mediaObject.ssrcs.push({id:D,attribute:"cname",value:g.rtcp.cname}),B&&(g.rtcp.cname&&this._mediaObject.ssrcs.push({id:B,attribute:"cname",value:g.rtcp.cname}),D&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${D} ${B}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize;break}}}setDtlsRole(t){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}vs.OfferMediaSection=mT;function bx(e){const n=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");return n[2]}var hw;function wc(){if(hw)return Ia;hw=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.RemoteSdp=void 0;const e=St,t=wt,n=vs,r=Ix(),i=["av1","h264"],c=new t.Logger("RemoteSdp");let u=class{constructor({iceParameters:g,iceCandidates:S,dtlsParameters:p,sctpParameters:C,plainRtpParameters:R}){N(this,"_iceParameters");N(this,"_iceCandidates");N(this,"_dtlsParameters");N(this,"_sctpParameters");N(this,"_plainRtpParameters");N(this,"_mediaSections",[]);N(this,"_midToIndex",new Map);N(this,"_firstMid");N(this,"_sdpObject");if(this._iceParameters=g,this._iceCandidates=S,this._dtlsParameters=p,this._sctpParameters=C,this._plainRtpParameters=R,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:`mediasoup-client-v${r.version}`},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",g!=null&&g.iceLite&&(this._sdpObject.icelite="ice-lite"),p){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const D=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:p.fingerprints[D-1].algorithm,hash:p.fingerprints[D-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}R&&(this._sdpObject.origin.address=R.ip,this._sdpObject.origin.ipVer=R.ipVersion)}updateIceParameters(g){c.debug("updateIceParameters() [iceParameters:%o]",g),this._iceParameters=g,this._sdpObject.icelite=g.iceLite?"ice-lite":void 0;for(const S of this._mediaSections)S.setIceParameters(g)}updateDtlsRole(g){c.debug("updateDtlsRole() [role:%s]",g),this._dtlsParameters.role=g;for(const S of this._mediaSections)S.setDtlsRole(g)}setSessionExtmapAllowMixed(){c.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let g=0;g<this._mediaSections.length;++g){const S=this._mediaSections[g];if(S.closed)return{idx:g,reuseMid:S.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:g,reuseMid:S,offerRtpParameters:p,answerRtpParameters:C,codecOptions:R}){var y;const D=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:g,offerRtpParameters:p,answerRtpParameters:C,codecOptions:R}),B=D.getObject();B.rtp.find(l=>i.includes(l.codec.toLowerCase()))||(B.ext=(y=B.ext)==null?void 0:y.filter(l=>l.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),S?this.replaceMediaSection(D,S):this._midToIndex.has(D.mid)?this.replaceMediaSection(D):this.addMediaSection(D)}receive({mid:g,kind:S,offerRtpParameters:p,streamId:C,trackId:R}){this.setSessionExtmapAllowMixed();const D=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:g,kind:S,offerRtpParameters:p,streamId:C,trackId:R}),B=this._mediaSections.find($=>$.closed);B?this.replaceMediaSection(D,B.mid):this.addMediaSection(D)}pauseMediaSection(g){this.findMediaSection(g).pause()}resumeSendingMediaSection(g){this.findMediaSection(g).resume()}resumeReceivingMediaSection(g){this.findMediaSection(g).resume()}disableMediaSection(g){this.findMediaSection(g).disable()}closeMediaSection(g){const S=this.findMediaSection(g);return g===this._firstMid?(c.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",g),this.disableMediaSection(g),!1):(S.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(g,S){const p=this.findMediaSection(g);p.muxSimulcastStreams(S),this.replaceMediaSection(p)}sendSctpAssociation({offerMediaObject:g}){const S=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:g});this.addMediaSection(S)}receiveSctpAssociation(){const g=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(g)}getSdp(){return this._sdpObject.origin.sessionVersion++,e.write(this._sdpObject)}addMediaSection(g){this._firstMid||(this._firstMid=g.mid),this._mediaSections.push(g),this._midToIndex.set(g.mid,this._mediaSections.length-1),this._sdpObject.media.push(g.getObject()),this.regenerateBundleMids()}replaceMediaSection(g,S){if(typeof S=="string"){const p=this._midToIndex.get(S);if(p===void 0)throw new Error(`no media section found for reuseMid '${S}'`);const C=this._mediaSections[p];this._mediaSections[p]=g,this._midToIndex.delete(C.mid),this._midToIndex.set(g.mid,p),this._sdpObject.media[p]=g.getObject(),this.regenerateBundleMids()}else{const p=this._midToIndex.get(g.mid);if(p===void 0)throw new Error(`no media section found with mid '${g.mid}'`);this._mediaSections[p]=g,this._sdpObject.media[p]=g.getObject()}}findMediaSection(g){const S=this._midToIndex.get(g);if(S===void 0)throw new Error(`no media section found with mid '${g}'`);return this._mediaSections[S]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(g=>!g.closed).map(g=>g.mid).join(" "))}};return Ia.RemoteSdp=u,Ia}var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.extractRtpCapabilities=gT;Qn.extractDtlsParameters=vT;Qn.getCname=yT;Qn.applyCodecParameters=wT;Qn.addHeaderExtension=ST;const Ex=St;function gT({sdpObject:e}){const t=new Map,n=new Map;for(const i of e.media){const c=i.type;switch(c){case"audio":case"video":break;default:continue}for(const u of i.rtp){const h={kind:c,mimeType:`${c}/${u.codec}`,preferredPayloadType:u.payload,clockRate:u.rate,channels:u.encoding,parameters:{},rtcpFeedback:[]};t.set(h.preferredPayloadType,h)}for(const u of i.fmtp??[]){const h=Ex.parseParams(u.config),g=t.get(u.payload);g&&(h!=null&&h.hasOwnProperty("profile-level-id")&&(h["profile-level-id"]=String(h["profile-level-id"])),g.parameters=h)}for(const u of i.rtcpFb??[]){const h={type:u.type,parameter:u.subtype};if(h.parameter||delete h.parameter,u.payload!=="*"){const g=t.get(Number(u.payload));if(!g)continue;g.rtcpFeedback.push(h)}else for(const g of t.values())g.kind===c&&!/.+\/rtx$/i.test(g.mimeType)&&g.rtcpFeedback.push(h)}for(const u of i.ext??[]){if(u["encrypt-uri"])continue;const h={kind:c,uri:u.uri,preferredId:u.value};n.set(h.preferredId,h)}}return{codecs:Array.from(t.values()),headerExtensions:Array.from(n.values())}}function vT({sdpObject:e}){let t=e.setup,n=e.fingerprint;if(!t||!n){const c=(e.media??[]).find(u=>u.port!==0);c&&(t=t??c.setup,n=n??c.fingerprint)}if(t){if(!n)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let r;switch(t){case"active":{r="client";break}case"passive":{r="server";break}case"actpass":{r="auto";break}}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function yT({offerMediaObject:e}){const t=(e.ssrcs??[]).find(n=>n.attribute==="cname");return t?t.value:""}function wT({offerRtpParameters:e,answerMediaObject:t}){var n;for(const r of e.codecs){const i=r.mimeType.toLowerCase();if(i!=="audio/opus"||!(t.rtp??[]).find(g=>g.payload===r.payloadType))continue;t.fmtp=t.fmtp??[];let u=t.fmtp.find(g=>g.payload===r.payloadType);u||(u={payload:r.payloadType,config:""},t.fmtp.push(u));const h=Ex.parseParams(u.config);switch(i){case"audio/opus":{const g=(n=r.parameters)==null?void 0:n["sprop-stereo"];g!==void 0&&(h.stereo=Number(g)?1:0);break}}u.config="";for(const g of Object.keys(h))u.config&&(u.config+=";"),u.config+=`${g}=${h[g]}`}}function ST({offerMediaObject:e,headerExtensionUri:t,headerExtensionId:n}){e.ext||(e.ext=[]),e.ext.push({uri:t,value:n})}var bs={};Object.defineProperty(bs,"__esModule",{value:!0});bs.getRtpEncodings=_T;bs.addLegacySimulcast=xT;function _T({offerMediaObject:e,codecs:t}){const n=new Set;for(const c of e.ssrcs??[]){const u=c.id;u&&n.add(u)}if(n.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const c of e.ssrcGroups??[]){if(c.semantics!=="FID")continue;const u=c.ssrcs.split(/\s+/),h=Number(u[0]),g=Number(u[1]);n.has(h)&&(n.delete(h),n.delete(g),r.set(h,g))}for(const c of n)r.set(c,void 0);const i=[];for(const[c,u]of r){const h={ssrc:c};u&&t.length>1&&(h.rtx={ssrc:u}),i.push(h)}return i}function xT({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const n=(e.ssrcs??[]).find(C=>C.attribute==="msid");if(!n)throw new Error("a=ssrc line with msid information not found");const[r,i]=n.value.split(" "),c=Number(n.id);let u;(e.ssrcGroups??[]).some(C=>{if(C.semantics!=="FID")return!1;const R=C.ssrcs.split(/\s+/);return Number(R[0])===c?(u=Number(R[1]),!0):!1});const h=(e.ssrcs??[]).find(C=>C.attribute==="cname");if(!h)throw new Error("a=ssrc line with cname information not found");const g=h.value,S=[],p=[];for(let C=0;C<t;++C)S.push(c+C),u&&p.push(u+C);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:S.join(" ")});for(const C of S)e.ssrcs.push({id:C,attribute:"cname",value:g}),e.ssrcs.push({id:C,attribute:"msid",value:`${r} ${i}`});for(let C=0;C<p.length;++C){const R=S[C],D=p[C];e.ssrcs.push({id:D,attribute:"cname",value:g}),e.ssrcs.push({id:D,attribute:"msid",value:`${r} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${R} ${D}`})}}var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.addNackSupportForOpus=CT;Fr.addHeaderExtensionSupport=bT;Fr.getMsidStreamIdAndTrackId=ET;function CT(e){var t;for(const n of e.codecs??[])(n.mimeType.toLowerCase()==="audio/opus"||n.mimeType.toLowerCase()==="audio/multiopus")&&!((t=n.rtcpFeedback)!=null&&t.some(r=>r.type==="nack"&&!r.parameter))&&(n.rtcpFeedback||(n.rtcpFeedback=[]),n.rtcpFeedback.push({type:"nack"}))}function bT(e,t){var c;let n;const r=(c=e.headerExtensions)==null?void 0:c.find(u=>u.uri===t.uri);if(r){if(r.kind===t.kind)return;n=r.preferredId}if(e.headerExtensions||(e.headerExtensions=[]),n===void 0){n=1;const u=new Set(e.headerExtensions.map(h=>h.preferredId));for(;u.has(n);)++n}const i={kind:t.kind,uri:t.uri,preferredId:n,preferredEncrypt:!1,direction:t.direction};e.headerExtensions.push(i)}function ET(e){if(!e||typeof e!="string")return{msidStreamId:void 0,msidTrackId:void 0};const[t,n]=e.trim().split(/\s+/);return t?{msidStreamId:t,msidTrackId:n}:{msidStreamId:void 0,msidTrackId:void 0}}var mw;function kT(){if(mw)return Ta;mw=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.Chrome111=void 0;const e=St,t=Mt,n=wt,r=We,i=Dt,c=Cs,u=wc(),h=Qn,g=bs,S=Fr,p=new n.Logger("Chrome111"),C="Chrome111",R={OS:1024,MIS:1024};let D=class Zl extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b,iceServers:P,iceTransportPolicy:w,additionalSettings:k,getSendExtendedRtpCapabilities:I}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=y,this._remoteSdp=new u.RemoteSdp({iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b}),this._getSendExtendedRtpCapabilities=I,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...k}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:C,factory:y=>new Zl(y),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const l=await y.createOffer();try{y.close()}catch{}y=void 0;const f=e.parse(l.sdp);return Zl.getLocalRtpCapabilities(f)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:R})}}static getLocalRtpCapabilities(y,l=[]){const f=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(f),S.addNackSupportForOpus(f);for(const v of l)S.addHeaderExtensionSupport(f,v);return f}get name(){return C}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:f,codecOptions:v,headerExtensionOptions:b,codec:P,onRtpSender:w}){if(this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),f&&f.length>1){let X=1;for(const Q of f){const ae=Q.scalabilityMode?(0,c.parse)(Q.scalabilityMode).temporalLayers:3;ae>X&&(X=ae)}f.forEach((Q,ae)=>{Q.rid=`r${ae}`,Q.scalabilityMode=`L1T${X}`})}const k=this._remoteSdp.getNextMediaSectionIdx(),I=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:f});w&&w(I.sender);let O=await this._pc.createOffer(),L=e.parse(O.sdp);L.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const F=[];F.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const q=Zl.getLocalRtpCapabilities(L,F),z=this._getSendExtendedRtpCapabilities(q),Z=r.getSendingRtpParameters(y.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,P);const te=r.getSendingRemoteRtpParameters(y.kind,z);if(te.codecs=r.reduceCodecs(te.codecs,P),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L}),b!=null&&b.absCaptureTime){const X=L.media[k.idx];h.addHeaderExtension({offerMediaObject:X,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:te.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),O={type:"offer",sdp:e.write(L)}}p.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O);const me=I.mid;Z.mid=me,L=e.parse(this._pc.localDescription.sdp);const U=L.media[k.idx];if(Z.rtcp.cname=h.getCname({offerMediaObject:U}),Z.msid=`${l??this._sendStream.id} ${y.id}`,!f)Z.encodings=g.getRtpEncodings({offerMediaObject:U,codecs:Z.codecs});else if(f.length===1){const X=g.getRtpEncodings({offerMediaObject:U,codecs:Z.codecs});Object.assign(X[0],f[0]),Z.encodings=X}else Z.encodings=f;this._remoteSdp.send({offerMediaObject:U,reuseMid:k.reuseMid,offerRtpParameters:Z,answerRtpParameters:te,codecOptions:v});const H={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",H),await this._pc.setRemoteDescription(H),this._mapMidTransceiver.set(me,I),{localId:me,rtpParameters:Z,rtpSender:I.sender}}async stopSending(y){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const f=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const f=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):p.debug("replaceTrack() [localId:%s, no track]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");await f.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{k<=l?w.active=!0:w.active=!1}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{v.encodings[k]={...w,...l}}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:f,label:v,protocol:b}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:f,protocol:b};p.debug("sendDataChannel() [options:%o]",P);const w=this._pc.createDataChannel(v,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),O=e.parse(I.sdp),L=O.media.find(q=>q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:L});const F={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._hasDataChannelMediaSection=!0}const k={streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits};return{dataChannel:w,sctpStreamParameters:k}}async receive(y){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],f=new Map;for(const k of y){const{trackId:I,kind:O,rtpParameters:L,streamId:F}=k;p.debug("receive() [trackId:%s, kind:%s]",I,O);const q=L.mid??String(this._mapMidTransceiver.size);f.set(I,q);const{msidStreamId:z}=S.getMsidStreamIdAndTrackId(L.msid);this._remoteSdp.receive({mid:q,kind:O,offerRtpParameters:L,streamId:F??z??((w=L.rtcp)==null?void 0:w.cname)??"-",trackId:I})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const k of y){const{trackId:I,onRtpReceiver:O}=k;if(O){const L=f.get(I),F=this._pc.getTransceivers().find(q=>q.mid===L);if(!F)throw new Error("transceiver not found");O(F.receiver)}}let b=await this._pc.createAnswer();const P=e.parse(b.sdp);for(const k of y){const{trackId:I,rtpParameters:O}=k,L=f.get(I),F=P.media.find(q=>String(q.mid)===L);h.applyCodecParameters({offerRtpParameters:O,answerMediaObject:F})}b={type:"answer",sdp:e.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",b),await this._pc.setLocalDescription(b);for(const k of y){const{trackId:I}=k,O=f.get(I),L=this._pc.getTransceivers().find(F=>F.mid===O);if(L)this._mapMidTransceiver.set(O,L),l.push({localId:O,track:L.receiver.track,rtpReceiver:L.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){p.debug("stopReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("pauseReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("resumeReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:f}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w}=y,k={negotiated:!0,id:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w,protocol:f};p.debug("receiveDataChannel() [options:%o]",k);const I=this._pc.createDataChannel(l,k);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const O={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const L=await this._pc.createAnswer();if(!this._transportReady){const F=e.parse(L.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:F})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setLocalDescription(L),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const f=h.extractDtlsParameters({sdpObject:l});f.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,b)=>{this.safeEmit("@connect",{dtlsParameters:f},v,b)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ta.Chrome111=D,Ta}var ja={},gw;function TT(){if(gw)return ja;gw=1,Object.defineProperty(ja,"__esModule",{value:!0}),ja.Chrome74=void 0;const e=St,t=wt,n=Mt,r=We,i=Dt,c=Cs,u=wc(),h=Qn,g=bs,S=Fr,p=new t.Logger("Chrome74"),C="Chrome74",R={OS:1024,MIS:1024};let D=class ed extends n.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b,iceServers:P,iceTransportPolicy:w,additionalSettings:k,getSendExtendedRtpCapabilities:I}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=y,this._remoteSdp=new u.RemoteSdp({iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b}),this._getSendExtendedRtpCapabilities=I,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...k}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:C,factory:y=>new ed(y),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const f=e.parse(l.sdp);return ed.getLocalRtpCapabilities(f)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:R})}}static getLocalRtpCapabilities(y,l=[]){const f=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(f),S.addNackSupportForOpus(f);for(const v of l)S.addHeaderExtensionSupport(f,v);return f}get name(){return C}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:f,codecOptions:v,headerExtensionOptions:b,codec:P}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),f&&f.length>1&&f.forEach((Q,ae)=>{Q.rid=`r${ae}`});const w=this._remoteSdp.getNextMediaSectionIdx(),k=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:f});let I=await this._pc.createOffer(),O=e.parse(I.sdp);O.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const L=[];L.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const F=ed.getLocalRtpCapabilities(O,L),q=this._getSendExtendedRtpCapabilities(F),z=r.getSendingRtpParameters(y.kind,q);z.codecs=r.reduceCodecs(z.codecs,P);const Z=r.getSendingRemoteRtpParameters(y.kind,q);Z.codecs=r.reduceCodecs(Z.codecs,P),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O});let te=!1;const me=(0,c.parse)((f??[{}])[0].scalabilityMode);let U;(f==null?void 0:f.length)===1&&me.spatialLayers>1&&z.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),te=!0,O=e.parse(I.sdp),U=O.media[w.idx],g.addLegacySimulcast({offerMediaObject:U,numStreams:me.spatialLayers}),I={type:"offer",sdp:e.write(O)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",I),b!=null&&b.absCaptureTime&&(U=O.media[w.idx],h.addHeaderExtension({offerMediaObject:U,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),I={type:"offer",sdp:e.write(O)}),await this._pc.setLocalDescription(I);const H=k.mid;if(z.mid=H,O=e.parse(this._pc.localDescription.sdp),U=O.media[w.idx],z.rtcp.cname=h.getCname({offerMediaObject:U}),z.msid=`${l??this._sendStream.id} ${y.id}`,!f)z.encodings=g.getRtpEncodings({offerMediaObject:U,codecs:z.codecs});else if(f.length===1){let Q=g.getRtpEncodings({offerMediaObject:U,codecs:z.codecs});Object.assign(Q[0],f[0]),te&&(Q=[Q[0]]),z.encodings=Q}else z.encodings=f;if(z.encodings.length>1&&(z.codecs[0].mimeType.toLowerCase()==="video/vp8"||z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of z.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${me.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:U,reuseMid:w.reuseMid,offerRtpParameters:z,answerRtpParameters:Z,codecOptions:v});const X={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",X),await this._pc.setRemoteDescription(X),this._mapMidTransceiver.set(H,k),{localId:H,rtpParameters:z,rtpSender:k.sender}}async stopSending(y){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const f=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const f=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):p.debug("replaceTrack() [localId:%s, no track]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");await f.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{k<=l?w.active=!0:w.active=!1}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{v.encodings[k]={...w,...l}}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:f,label:v,protocol:b}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:f,protocol:b};p.debug("sendDataChannel() [options:%o]",P);const w=this._pc.createDataChannel(v,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),O=e.parse(I.sdp),L=O.media.find(q=>q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:L});const F={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._hasDataChannelMediaSection=!0}const k={streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits};return{dataChannel:w,sctpStreamParameters:k}}async receive(y){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],f=new Map;for(const k of y){const{trackId:I,kind:O,rtpParameters:L,streamId:F}=k;p.debug("receive() [trackId:%s, kind:%s]",I,O);const q=L.mid??String(this._mapMidTransceiver.size);f.set(I,q);const{msidStreamId:z}=S.getMsidStreamIdAndTrackId(L.msid);this._remoteSdp.receive({mid:q,kind:O,offerRtpParameters:L,streamId:F??z??((w=L.rtcp)==null?void 0:w.cname)??"-",trackId:I})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);let b=await this._pc.createAnswer();const P=e.parse(b.sdp);for(const k of y){const{trackId:I,rtpParameters:O}=k,L=f.get(I),F=P.media.find(q=>String(q.mid)===L);h.applyCodecParameters({offerRtpParameters:O,answerMediaObject:F})}b={type:"answer",sdp:e.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",b),await this._pc.setLocalDescription(b);for(const k of y){const{trackId:I}=k,O=f.get(I),L=this._pc.getTransceivers().find(F=>F.mid===O);if(L)this._mapMidTransceiver.set(O,L),l.push({localId:O,track:L.receiver.track,rtpReceiver:L.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){p.debug("stopReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("pauseReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("resumeReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:f}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w}=y,k={negotiated:!0,id:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w,protocol:f};p.debug("receiveDataChannel() [options:%o]",k);const I=this._pc.createDataChannel(l,k);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const O={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const L=await this._pc.createAnswer();if(!this._transportReady){const F=e.parse(L.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:F})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setLocalDescription(L),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const f=h.extractDtlsParameters({sdpObject:l});f.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,b)=>{this.safeEmit("@connect",{dtlsParameters:f},v,b)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ja.Chrome74=D,ja}var Na={},vw;function RT(){if(vw)return Na;vw=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.Firefox120=void 0;const e=St,t=Mt,n=wt,r=Dt,i=We,c=Cs,u=wc(),h=Qn,g=bs,S=Fr,p=new n.Logger("Firefox120"),C="Firefox120",R={OS:16,MIS:2048};let D=class td extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b,iceServers:P,iceTransportPolicy:w,additionalSettings:k,getSendExtendedRtpCapabilities:I}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=y,this._remoteSdp=new u.RemoteSdp({iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b}),this._getSendExtendedRtpCapabilities=I,this._pc=new RTCPeerConnection({iceServers:P??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...k}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:C,factory:y=>new td(y),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const l=document.createElement("canvas");l.getContext("2d");const v=l.captureStream().getVideoTracks()[0];try{y.addTransceiver("audio",{direction:"sendrecv"}),y.addTransceiver(v,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const b=await y.createOffer();try{l.remove()}catch{}try{v.stop()}catch{}try{y.close()}catch{}y=void 0;const P=e.parse(b.sdp);return td.getLocalRtpCapabilities(P)}catch(b){try{l.remove()}catch{}try{v.stop()}catch{}try{y==null||y.close()}catch{}throw y=void 0,b}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:R})}}static getLocalRtpCapabilities(y){const l=h.extractRtpCapabilities({sdpObject:y});return i.validateAndNormalizeRtpCapabilities(l),l}get name(){return C}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){throw this.assertNotClosed(),new r.UnsupportedError("not supported")}async restartIce(y){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:f,codecOptions:v,codec:b,onRtpSender:P}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),f&&f.length>1&&f.forEach((U,H)=>{U.rid=`r${H}`});const w=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:f});P&&P(w.sender);const k=await this._pc.createOffer();let I=e.parse(k.sdp);I.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const O=td.getLocalRtpCapabilities(I),L=this._getSendExtendedRtpCapabilities(O),F=i.getSendingRtpParameters(y.kind,L);F.codecs=i.reduceCodecs(F.codecs,b);const q=i.getSendingRemoteRtpParameters(y.kind,L);q.codecs=i.reduceCodecs(q.codecs,b),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:I});const z=(0,c.parse)((f??[{}])[0].scalabilityMode);p.debug("send() | calling pc.setLocalDescription() [offer:%o]",k),await this._pc.setLocalDescription(k);const Z=w.mid;F.mid=Z,I=e.parse(this._pc.localDescription.sdp);const te=I.media[I.media.length-1];if(F.rtcp.cname=h.getCname({offerMediaObject:te}),F.msid=`${l??this._sendStream.id} ${y.id}`,!f)F.encodings=g.getRtpEncodings({offerMediaObject:te,codecs:F.codecs});else if(f.length===1){const U=g.getRtpEncodings({offerMediaObject:te,codecs:F.codecs});Object.assign(U[0],f[0]),F.encodings=U}else F.encodings=f;if(F.encodings.length>1&&(F.codecs[0].mimeType.toLowerCase()==="video/vp8"||F.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const U of F.encodings)U.scalabilityMode?U.scalabilityMode=`L1T${z.temporalLayers}`:U.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:te,offerRtpParameters:F,answerRtpParameters:q,codecOptions:v});const me={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",me),await this._pc.setRemoteDescription(me),this._mapMidTransceiver.set(Z,w),{localId:Z,rtpParameters:F,rtpSender:w.sender}}async stopSending(y){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated transceiver not found");l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.disableMediaSection(l.mid);const f=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const f=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const f=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):p.debug("replaceTrack() [localId:%s, no track]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");await f.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated transceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{k<=l?w.active=!0:w.active=!1}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{v.encodings[k]={...w,...l}}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:f,label:v,protocol:b}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:f,protocol:b};p.debug("sendDataChannel() [options:%o]",P);const w=this._pc.createDataChannel(v,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),O=e.parse(I.sdp),L=O.media.find(q=>q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:O}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:L});const F={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._hasDataChannelMediaSection=!0}const k={streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits};return{dataChannel:w,sctpStreamParameters:k}}async receive(y){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],f=new Map;for(const k of y){const{trackId:I,kind:O,rtpParameters:L,streamId:F}=k;p.debug("receive() [trackId:%s, kind:%s]",I,O);const q=L.mid??String(this._mapMidTransceiver.size);f.set(I,q);const{msidStreamId:z}=S.getMsidStreamIdAndTrackId(L.msid);this._remoteSdp.receive({mid:q,kind:O,offerRtpParameters:L,streamId:F??z??((w=L.rtcp)==null?void 0:w.cname)??"-",trackId:I})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const k of y){const{trackId:I,onRtpReceiver:O}=k;if(O){const L=f.get(I),F=this._pc.getTransceivers().find(q=>q.mid===L);if(!F)throw new Error("transceiver not found");O(F.receiver)}}let b=await this._pc.createAnswer();const P=e.parse(b.sdp);for(const k of y){const{trackId:I,rtpParameters:O}=k,L=f.get(I),F=P.media.find(q=>String(q.mid)===L);h.applyCodecParameters({offerRtpParameters:O,answerMediaObject:F}),b={type:"answer",sdp:e.write(P)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:P}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",b),await this._pc.setLocalDescription(b);for(const k of y){const{trackId:I}=k,O=f.get(I),L=this._pc.getTransceivers().find(F=>F.mid===O);if(!L)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(O,L),l.push({localId:O,track:L.receiver.track,rtpReceiver:L.receiver})}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){p.debug("stopReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("pauseReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("resumeReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async getReceiverStats(y){this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:f}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w}=y,k={negotiated:!0,id:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w,protocol:f};p.debug("receiveDataChannel() [options:%o]",k);const I=this._pc.createDataChannel(l,k);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const O={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const L=await this._pc.createAnswer();if(!this._transportReady){const F=e.parse(L.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:F})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setLocalDescription(L),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const f=h.extractDtlsParameters({sdpObject:l});f.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,b)=>{this.safeEmit("@connect",{dtlsParameters:f},v,b)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new r.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Na.Firefox120=D,Na}var Pa={},yw;function IT(){if(yw)return Pa;yw=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.Safari12=void 0;const e=St,t=Mt,n=wt,r=We,i=Dt,c=Cs,u=wc(),h=Qn,g=bs,S=Fr,p=new n.Logger("Safari12"),C="Safari12",R={OS:1024,MIS:1024};let D=class nd extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b,iceServers:P,iceTransportPolicy:w,additionalSettings:k,getSendExtendedRtpCapabilities:I}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=y,this._remoteSdp=new u.RemoteSdp({iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b}),this._getSendExtendedRtpCapabilities=I,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...k}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",O=>{this.emit("@icecandidateerror",O)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:C,factory:y=>new nd(y),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const f=e.parse(l.sdp);return nd.getLocalRtpCapabilities(f)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:R})}}static getLocalRtpCapabilities(y,l=[]){const f=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(f),S.addNackSupportForOpus(f);for(const v of l)S.addHeaderExtensionSupport(f,v);return f}get name(){return C}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:f,codecOptions:v,headerExtensionOptions:b,codec:P,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l);const k=this._remoteSdp.getNextMediaSectionIdx(),I=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream]});w&&w(I.sender);let O=await this._pc.createOffer(),L=e.parse(O.sdp);L.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const F=[];F.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const q=nd.getLocalRtpCapabilities(L,F),z=this._getSendExtendedRtpCapabilities(q),Z=r.getSendingRtpParameters(y.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,P);const te=r.getSendingRemoteRtpParameters(y.kind,z);te.codecs=r.reduceCodecs(te.codecs,P);let me;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L});const U=(0,c.parse)((f??[{}])[0].scalabilityMode);f&&f.length>1&&(p.debug("send() | enabling legacy simulcast"),L=e.parse(O.sdp),me=L.media[k.idx],g.addLegacySimulcast({offerMediaObject:me,numStreams:f.length}),O={type:"offer",sdp:e.write(L)}),b!=null&&b.absCaptureTime&&(me=L.media[k.idx],h.addHeaderExtension({offerMediaObject:me,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:te.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),O={type:"offer",sdp:e.write(L)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O);const H=I.mid;if(Z.mid=H,L=e.parse(this._pc.localDescription.sdp),me=L.media[k.idx],Z.rtcp.cname=h.getCname({offerMediaObject:me}),Z.msid=`${l??this._sendStream.id} ${y.id}`,Z.encodings=g.getRtpEncodings({offerMediaObject:me,codecs:Z.codecs}),f)for(let Q=0;Q<Z.encodings.length;++Q)f[Q]&&Object.assign(Z.encodings[Q],f[Q]);if(Z.encodings.length>1&&(Z.codecs[0].mimeType.toLowerCase()==="video/vp8"||Z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of Z.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${U.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:me,reuseMid:k.reuseMid,offerRtpParameters:Z,answerRtpParameters:te,codecOptions:v});const X={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",X),await this._pc.setRemoteDescription(X),this._mapMidTransceiver.set(H,I),{localId:H,rtpParameters:Z,rtpSender:I.sender}}async stopSending(y){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const f=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const f=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):p.debug("replaceTrack() [localId:%s, no track]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");await f.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{k<=l?w.active=!0:w.active=!1}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{v.encodings[k]={...w,...l}}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:f,label:v,protocol:b}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:f,protocol:b};p.debug("sendDataChannel() [options:%o]",P);const w=this._pc.createDataChannel(v,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),O=e.parse(I.sdp),L=O.media.find(q=>q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:L});const F={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._hasDataChannelMediaSection=!0}const k={streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits};return{dataChannel:w,sctpStreamParameters:k}}async receive(y){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],f=new Map;for(const k of y){const{trackId:I,kind:O,rtpParameters:L,streamId:F}=k;p.debug("receive() [trackId:%s, kind:%s]",I,O);const q=L.mid??String(this._mapMidTransceiver.size);f.set(I,q);const{msidStreamId:z}=S.getMsidStreamIdAndTrackId(L.msid);this._remoteSdp.receive({mid:q,kind:O,offerRtpParameters:L,streamId:F??z??((w=L.rtcp)==null?void 0:w.cname)??"-",trackId:I})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const k of y){const{trackId:I,onRtpReceiver:O}=k;if(O){const L=f.get(I),F=this._pc.getTransceivers().find(q=>q.mid===L);if(!F)throw new Error("transceiver not found");O(F.receiver)}}let b=await this._pc.createAnswer();const P=e.parse(b.sdp);for(const k of y){const{trackId:I,rtpParameters:O}=k,L=f.get(I),F=P.media.find(q=>String(q.mid)===L);h.applyCodecParameters({offerRtpParameters:O,answerMediaObject:F})}b={type:"answer",sdp:e.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",b),await this._pc.setLocalDescription(b);for(const k of y){const{trackId:I}=k,O=f.get(I),L=this._pc.getTransceivers().find(F=>F.mid===O);if(!L)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(O,L),l.push({localId:O,track:L.receiver.track,rtpReceiver:L.receiver})}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){p.debug("stopReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("pauseReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("resumeReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:f}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w}=y,k={negotiated:!0,id:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w,protocol:f};p.debug("receiveDataChannel() [options:%o]",k);const I=this._pc.createDataChannel(l,k);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const O={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const L=await this._pc.createAnswer();if(!this._transportReady){const F=e.parse(L.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:F})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setLocalDescription(L),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const f=h.extractDtlsParameters({sdpObject:l});f.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,b)=>{this.safeEmit("@connect",{dtlsParameters:f},v,b)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Pa.Safari12=D,Pa}var La={},ww;function jT(){if(ww)return La;ww=1,Object.defineProperty(La,"__esModule",{value:!0}),La.ReactNative106=void 0;const e=St,t=Mt,n=wt,r=We,i=Dt,c=Cs,u=wc(),h=Qn,g=bs,S=Fr,p=new n.Logger("ReactNative106"),C="ReactNative106",R={OS:1024,MIS:1024};let D=class rd extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b,iceServers:P,iceTransportPolicy:w,additionalSettings:k,getSendExtendedRtpCapabilities:I}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=y,this._remoteSdp=new u.RemoteSdp({iceParameters:l,iceCandidates:f,dtlsParameters:v,sctpParameters:b}),this._getSendExtendedRtpCapabilities=I,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...k}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:C,factory:y=>new rd(y),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const f=e.parse(l.sdp);return rd.getLocalRtpCapabilities(f)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:R})}}static getLocalRtpCapabilities(y,l=[]){const f=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(f),S.addNackSupportForOpus(f);for(const v of l)S.addHeaderExtensionSupport(f,v);return f}get name(){return C}close(){if(p.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:f,codecOptions:v,headerExtensionOptions:b,codec:P,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),f&&f.length>1&&f.forEach((ae,V)=>{ae.rid=`r${V}`});const k=this._remoteSdp.getNextMediaSectionIdx(),I=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:f});w&&w(I.sender);let O=await this._pc.createOffer(),L=e.parse(O.sdp);L.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const F=[];F.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const q=rd.getLocalRtpCapabilities(L,F),z=this._getSendExtendedRtpCapabilities(q),Z=r.getSendingRtpParameters(y.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,P);const te=r.getSendingRemoteRtpParameters(y.kind,z);te.codecs=r.reduceCodecs(te.codecs,P),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L});let me=!1;const U=(0,c.parse)((f??[{}])[0].scalabilityMode);let H;(f==null?void 0:f.length)===1&&U.spatialLayers>1&&Z.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),me=!0,L=e.parse(O.sdp),H=L.media[k.idx],g.addLegacySimulcast({offerMediaObject:H,numStreams:U.spatialLayers}),O={type:"offer",sdp:e.write(L)}),b!=null&&b.absCaptureTime&&(H=L.media[k.idx],h.addHeaderExtension({offerMediaObject:H,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:te.headerExtensions.find(ae=>ae.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),O={type:"offer",sdp:e.write(L)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O);let X=I.mid??void 0;if(X||p.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),Z.mid=X,L=e.parse(this._pc.localDescription.sdp),H=L.media[k.idx],Z.rtcp.cname=h.getCname({offerMediaObject:H}),Z.msid=`${l??this._sendStream.id} ${y.id}`,!f)Z.encodings=g.getRtpEncodings({offerMediaObject:H,codecs:Z.codecs});else if(f.length===1){let ae=g.getRtpEncodings({offerMediaObject:H,codecs:Z.codecs});Object.assign(ae[0],f[0]),me&&(ae=[ae[0]]),Z.encodings=ae}else Z.encodings=f;if(Z.encodings.length>1&&(Z.codecs[0].mimeType.toLowerCase()==="video/vp8"||Z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ae of Z.encodings)ae.scalabilityMode?ae.scalabilityMode=`L1T${U.temporalLayers}`:ae.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:H,reuseMid:k.reuseMid,offerRtpParameters:Z,answerRtpParameters:te,codecOptions:v});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),X||(X=I.mid,Z.mid=X),this._mapMidTransceiver.set(X,I),{localId:X,rtpParameters:Z,rtpSender:I.sender}}async stopSending(y){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const f=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const f=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const v={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):p.debug("replaceTrack() [localId:%s, no track]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");await f.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{k<=l?w.active=!0:w.active=!1}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");const v=f.sender.getParameters();v.encodings.forEach((w,k)=>{v.encodings[k]={...w,...l}}),await f.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const b=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const P={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:f,label:v,protocol:b}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:f,protocol:b};p.debug("sendDataChannel() [options:%o]",P);const w=this._pc.createDataChannel(v,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),O=e.parse(I.sdp),L=O.media.find(q=>q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:L});const F={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._hasDataChannelMediaSection=!0}const k={streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits};return{dataChannel:w,sctpStreamParameters:k}}async receive(y){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],f=new Map;for(const k of y){const{trackId:I,kind:O,rtpParameters:L,streamId:F}=k;p.debug("receive() [trackId:%s, kind:%s]",I,O);const q=L.mid??String(this._mapMidTransceiver.size);f.set(I,q);const{msidStreamId:z}=S.getMsidStreamIdAndTrackId(L.msid);this._remoteSdp.receive({mid:q,kind:O,offerRtpParameters:L,streamId:F??z??((w=L.rtcp)==null?void 0:w.cname)??"-",trackId:I})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const k of y){const{trackId:I,onRtpReceiver:O}=k;if(O){const L=f.get(I),F=this._pc.getTransceivers().find(q=>q.mid===L);if(!F)throw new Error("transceiver not found");O(F.receiver)}}let b=await this._pc.createAnswer();const P=e.parse(b.sdp);for(const k of y){const{trackId:I,rtpParameters:O}=k,L=f.get(I),F=P.media.find(q=>String(q.mid)===L);h.applyCodecParameters({offerRtpParameters:O,answerMediaObject:F})}b={type:"answer",sdp:e.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",b),await this._pc.setLocalDescription(b);for(const k of y){const{trackId:I}=k,O=f.get(I),L=this._pc.getTransceivers().find(F=>F.mid===O);if(L)this._mapMidTransceiver.set(O,L),l.push({localId:O,track:L.receiver.track,rtpReceiver:L.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){p.debug("stopReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("pauseReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){p.debug("resumeReceiving() [localId:%s]",v);const b=this._mapMidTransceiver.get(v);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const f=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",f),await this._pc.setLocalDescription(f)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:f}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w}=y,k={negotiated:!0,id:v,ordered:b,maxPacketLifeTime:P,maxRetransmits:w,protocol:f};p.debug("receiveDataChannel() [options:%o]",k);const I=this._pc.createDataChannel(l,k);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const O={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const L=await this._pc.createAnswer();if(!this._transportReady){const F=e.parse(L.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:F})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setLocalDescription(L),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const f=h.extractDtlsParameters({sdpObject:l});f.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,b)=>{this.safeEmit("@connect",{dtlsParameters:f},v,b)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return La.ReactNative106=D,La}var Sw;function NT(){if(Sw)return zs;Sw=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.Device=void 0,zs.detectDevice=R,zs.detectDeviceAsync=D;const e=wt,t=Mt,n=Dt,r=gr,i=We,c=Xd,u=kT(),h=TT(),g=RT(),S=IT(),p=jT(),C=new e.Logger("Device");function R(w,k){return C.debug("detectDevice()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!k&&typeof navigator=="object"&&(k=navigator.userAgentData),$(w,k)}async function D(w,k){return C.debug("detectDeviceAsync()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!k&&typeof navigator=="object"&&(k=navigator.userAgentData),$(w,k)}let B=class kx{constructor({handlerName:k,handlerFactory:I}={}){N(this,"_handlerFactory");N(this,"_handlerName");N(this,"_loaded",!1);N(this,"_getSendExtendedRtpCapabilities");N(this,"_recvRtpCapabilities");N(this,"_canProduceByKind",{audio:!1,video:!1});N(this,"_sctpCapabilities");N(this,"_observer",new t.EnhancedEventEmitter);if(C.debug("constructor()"),k&&I)throw new TypeError("just one of handlerName or handlerInterface can be given");if(I)this._handlerFactory=I;else{if(k)C.debug("constructor() | handler given: %s",k);else if(k=R(),k)C.debug("constructor() | detected handler: %s",k);else throw new n.UnsupportedError("device not supported");switch(k){case"Chrome111":{this._handlerFactory=u.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=h.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=g.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=S.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=p.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${k}"`)}}this._handlerName=this._handlerFactory.name}static async factory({handlerName:k,handlerFactory:I}={}){if(C.debug("factory()"),k&&I)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!k&&!I&&(k=await D(),!k))throw new n.UnsupportedError("device not supported");return new kx({handlerName:k,handlerFactory:I})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:k,preferLocalCodecsOrder:I=!1}){if(C.debug("load() [routerRtpCapabilities:%o]",k),this._loaded)throw new n.InvalidStateError("already loaded");const O=r.clone(k);i.validateAndNormalizeRtpCapabilities(O);const{getNativeRtpCapabilities:L,getNativeSctpCapabilities:F}=this._handlerFactory,q=r.clone(await L());i.validateAndNormalizeRtpCapabilities(q),C.debug("load() | got native RTP capabilities:%o",q),this._getSendExtendedRtpCapabilities=Z=>r.clone(i.getExtendedRtpCapabilities(Z,O,I));const z=i.getExtendedRtpCapabilities(q,O,!1);this._recvRtpCapabilities=i.getRecvRtpCapabilities(z),i.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),C.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=i.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=i.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await F(),i.validateSctpCapabilities(this._sctpCapabilities),C.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),C.debug("load() succeeded"),this._loaded=!0}canProduce(k){if(this._loaded){if(k!=="audio"&&k!=="video")throw new TypeError(`invalid kind "${k}"`)}else throw new n.InvalidStateError("not loaded");return this._canProduceByKind[k]}createSendTransport({id:k,iceParameters:I,iceCandidates:O,dtlsParameters:L,sctpParameters:F,iceServers:q,iceTransportPolicy:z,additionalSettings:Z,appData:te}){return C.debug("createSendTransport()"),this.createTransport({direction:"send",id:k,iceParameters:I,iceCandidates:O,dtlsParameters:L,sctpParameters:F,iceServers:q,iceTransportPolicy:z,additionalSettings:Z,appData:te})}createRecvTransport({id:k,iceParameters:I,iceCandidates:O,dtlsParameters:L,sctpParameters:F,iceServers:q,iceTransportPolicy:z,additionalSettings:Z,appData:te}){return C.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:k,iceParameters:I,iceCandidates:O,dtlsParameters:L,sctpParameters:F,iceServers:q,iceTransportPolicy:z,additionalSettings:Z,appData:te})}createTransport({direction:k,id:I,iceParameters:O,iceCandidates:L,dtlsParameters:F,sctpParameters:q,iceServers:z,iceTransportPolicy:Z,additionalSettings:te,appData:me}){if(this._loaded){if(typeof I!="string")throw new TypeError("missing id");if(typeof O!="object")throw new TypeError("missing iceParameters");if(Array.isArray(L)){if(typeof F!="object")throw new TypeError("missing dtlsParameters");if(q&&typeof q!="object")throw new TypeError("wrong sctpParameters");if(me&&typeof me!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new n.InvalidStateError("not loaded");const U=new c.Transport({direction:k,id:I,iceParameters:O,iceCandidates:L,dtlsParameters:F,sctpParameters:q,iceServers:z,iceTransportPolicy:Z,additionalSettings:te,appData:me,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",U),U}};zs.Device=B;function $(w,k){C.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',w,k);const I=y(w,k);if(I){if(I>=111)return C.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(I>=74)return C.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";C.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const O=l(w);if(O){if(O>=120)return C.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";C.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const L=f(w);if(L){if(L>=605)return C.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";C.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const F=v(w);if(F){if(F>=605)return C.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";C.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(P()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return C.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";C.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}C.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',w,k)}function y(w,k){if(C.debug("getChromiumMajorVersion()"),b(w,k)){C.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(P()){C.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(k){const O=(k.brands??[]).find(L=>L.brand==="Chromium");if(O){const L=Number(O.version);return C.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${L}`),L}}const I=w==null?void 0:w.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(I!=null&&I[1]){const O=Number(I[1]);return C.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${O}`),O}C.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function l(w){if(C.debug("getFirefoxMajorVersion()"),b(w)){C.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(P()){C.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const k=w==null?void 0:w.match(/\bFirefox\/(\w+)/i);if(k!=null&&k[1]){const I=Number(k[1]);return C.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${I}`),I}C.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function f(w){if(C.debug("getMacOSWebKitMajorVersion()"),b(w)){C.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(P()){C.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(w&&/\bSafari\b/i.test(w)&&!/\bChrome\b/i.test(w)&&!/\bChromium\b/i.test(w)&&!/\bFirefox\b/i.test(w))){C.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const I=w.match(/AppleWebKit\/(\w+)/i);if(I!=null&&I[1]){const O=Number(I[1]);return C.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${O}`),O}C.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function v(w){if(C.debug("getIOSWebKitMajorVersion()"),!b(w)){C.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(P()){C.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const k=w==null?void 0:w.match(/AppleWebKit\/(\w+)/i);if(k!=null&&k[1]){const I=Number(k[1]);return C.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${I}`),I}C.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function b(w,k){return C.debug("isIOS()"),(k==null?void 0:k.platform)==="iOS"?(C.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):k!=null&&k.platform?(C.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):w&&/iPad|iPhone|iPod/.test(w)?(C.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(C.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(C.debug("isIOS() | this is not iOS => false"),!1)}function P(){return C.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(C.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(C.debug("isReactNative() | this is not React-Native => false"),!1)}return zs}var iu={},ou={},Tx={},Js=256,sd=[],Dl;for(;Js--;)sd[Js]=(Js+256).toString(16).substring(1);function PT(){var e=0,t,n="";if(!Dl||Js+16>256){for(Dl=Array(e=256);e--;)Dl[e]=256*Math.random()|0;e=Js=0}for(;e<16;e++)t=Dl[Js+e],e==6?n+=sd[t&15|64]:e==8?n+=sd[t&63|128]:n+=sd[t],e&1&&e>1&&e<11&&(n+="-");return Js++,n}Tx.v4=PT;var au={};Object.defineProperty(au,"__esModule",{value:!0});au.FakeEventTarget=void 0;let LT=class{constructor(){N(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}};au.FakeEventTarget=LT;var cu={};Object.defineProperty(cu,"__esModule",{value:!0});cu.FakeEvent=void 0;class DT{constructor(t,n={}){N(this,"NONE",0);N(this,"CAPTURING_PHASE",1);N(this,"AT_TARGET",2);N(this,"BUBBLING_PHASE",3);N(this,"type");N(this,"bubbles");N(this,"cancelable");N(this,"defaultPrevented",!1);N(this,"composed",!1);N(this,"currentTarget",null);N(this,"eventPhase",this.NONE);N(this,"isTrusted",!0);N(this,"target",null);N(this,"timeStamp",0);N(this,"cancelBubble",!1);N(this,"returnValue",!0);N(this,"srcElement",null);this.type=t,this.bubbles=n.bubbles??!1,this.cancelable=n.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(t,n,r){}}cu.FakeEvent=DT;var dm={};Object.defineProperty(dm,"__esModule",{value:!0});dm.clone=MT;function MT(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}Object.defineProperty(ou,"__esModule",{value:!0});ou.FakeMediaStreamTrack=void 0;const _w=Tx,OT=au,to=cu,Ml=dm;var fc,To,Ro,lr,os,dr,qs,Io,Xs,jo,Zs,ei,ti,ni,ri,si;const fm=class fm extends OT.FakeEventTarget{constructor({kind:n,id:r,label:i,contentHint:c,enabled:u,muted:h,readyState:g,capabilities:S,constraints:p,settings:C,data:R}){super();ft(this,fc);ft(this,To);ft(this,Ro);ft(this,lr);ft(this,os);ft(this,dr);ft(this,qs);ft(this,Io);ft(this,Xs);ft(this,jo);ft(this,Zs);ft(this,ei,null);ft(this,ti,null);ft(this,ni,null);ft(this,ri,null);ft(this,si,null);Me(this,fc,r??(0,_w.v4)()),Me(this,To,n),Me(this,Ro,i??""),Me(this,qs,c??""),Me(this,os,u??!0),Me(this,dr,h??!1),Me(this,lr,g??"live"),Me(this,Io,S??{}),Me(this,Xs,p??{}),Me(this,jo,C??{}),Me(this,Zs,R??{})}get id(){return he(this,fc)}get kind(){return he(this,To)}get label(){return he(this,Ro)}get contentHint(){return he(this,qs)}set contentHint(n){Me(this,qs,n)}get enabled(){return he(this,os)}set enabled(n){const r=he(this,os)!==n;Me(this,os,n),r&&this.dispatchEvent(new to.FakeEvent("enabledchange"))}get muted(){return he(this,dr)}get readyState(){return he(this,lr)}get data(){return he(this,Zs)}set data(n){Me(this,Zs,n)}get onmute(){return he(this,ei)}set onmute(n){he(this,ei)&&this.removeEventListener("mute",he(this,ei)),Me(this,ei,n),n&&this.addEventListener("mute",n)}get onunmute(){return he(this,ti)}set onunmute(n){he(this,ti)&&this.removeEventListener("unmute",he(this,ti)),Me(this,ti,n),n&&this.addEventListener("unmute",n)}get onended(){return he(this,ni)}set onended(n){he(this,ni)&&this.removeEventListener("ended",he(this,ni)),Me(this,ni,n),n&&this.addEventListener("ended",n)}get onenabledchange(){return he(this,ri)}set onenabledchange(n){he(this,ri)&&this.removeEventListener("enabledchange",he(this,ri)),Me(this,ri,n),n&&this.addEventListener("enabledchange",n)}get onstopped(){return he(this,si)}set onstopped(n){he(this,si)&&this.removeEventListener("stopped",he(this,si)),Me(this,si,n),n&&this.addEventListener("stopped",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}stop(){he(this,lr)!=="ended"&&(Me(this,lr,"ended"),this.dispatchEvent(new to.FakeEvent("stopped")))}clone({id:n,data:r}={}){return new fm({id:n??(0,_w.v4)(),kind:he(this,To),label:he(this,Ro),contentHint:he(this,qs),enabled:he(this,os),muted:he(this,dr),readyState:he(this,lr),capabilities:(0,Ml.clone)(he(this,Io)),constraints:(0,Ml.clone)(he(this,Xs)),settings:(0,Ml.clone)(he(this,jo)),data:r??(0,Ml.clone)(he(this,Zs))})}getCapabilities(){return he(this,Io)}getConstraints(){return he(this,Xs)}async applyConstraints(n={}){return Me(this,Xs,n),Promise.resolve()}getSettings(){return he(this,jo)}remoteStop(){he(this,lr)!=="ended"&&(Me(this,lr,"ended"),this.dispatchEvent(new to.FakeEvent("stopped")),this.dispatchEvent(new to.FakeEvent("ended")))}remoteMute(){he(this,dr)||(Me(this,dr,!0),this.dispatchEvent(new to.FakeEvent("mute")))}remoteUnmute(){he(this,dr)&&(Me(this,dr,!1),this.dispatchEvent(new to.FakeEvent("unmute")))}};fc=new WeakMap,To=new WeakMap,Ro=new WeakMap,lr=new WeakMap,os=new WeakMap,dr=new WeakMap,qs=new WeakMap,Io=new WeakMap,Xs=new WeakMap,jo=new WeakMap,Zs=new WeakMap,ei=new WeakMap,ti=new WeakMap,ni=new WeakMap,ri=new WeakMap,si=new WeakMap;let sh=fm;ou.FakeMediaStreamTrack=sh;var lu={};Object.defineProperty(lu,"__esModule",{value:!0});lu.FakeEventTarget=void 0;class AT{constructor(){N(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}}lu.FakeEventTarget=AT;Object.defineProperty(iu,"__esModule",{value:!0});iu.FakeHandler=void 0;const UT=ou,$T=Mt,FT=wt,no=gr,tf=We,Rx=Dt,BT=lu,ht=new FT.Logger("FakeHandler"),xw="FakeHandler";class Ka extends $T.EnhancedEventEmitter{constructor({getSendExtendedRtpCapabilities:n},r){super();N(this,"_closed",!1);N(this,"_fakeParameters");N(this,"_getSendExtendedRtpCapabilities");N(this,"_cname",`CNAME-${no.generateRandomNumber()}`);N(this,"_defaultSendStreamId",`${no.generateRandomNumber()}`);N(this,"_transportReady",!1);N(this,"_nextLocalId",1);N(this,"_tracks",new Map);N(this,"_nextSctpStreamId",0);ht.debug("constructor()"),this._getSendExtendedRtpCapabilities=n,this._fakeParameters=r}static createFactory(n){return{name:xw,factory:r=>new Ka(r,n),getNativeRtpCapabilities:async()=>(ht.debug("getNativeRtpCapabilities()"),Ka.getLocalRtpCapabilities(n)),getNativeSctpCapabilities:async()=>(ht.debug("getNativeSctpCapabilities()"),n.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(n){const r=n.generateNativeRtpCapabilities();return tf.validateAndNormalizeRtpCapabilities(r),r}get name(){return xw}close(){ht.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(n){this.emit("@icegatheringstatechange",n)}setConnectionState(n){this.emit("@connectionstatechange",n)}async updateIceServers(n){this.assertNotClosed(),ht.debug("updateIceServers()")}async restartIce(n){this.assertNotClosed(),ht.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:n,streamId:r,encodings:i,codecOptions:c,codec:u}){this.assertNotClosed(),ht.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const h=Ka.getLocalRtpCapabilities(this._fakeParameters),g=this._getSendExtendedRtpCapabilities(h),S=tf.getSendingRtpParameters(n.kind,g);S.codecs=tf.reduceCodecs(S.codecs,u);const p=S.codecs.some(R=>/.+\/rtx$/i.test(R.mimeType));S.mid=`mid-${no.generateRandomNumber()}`,S.msid=`${r??"-"} ${n.id}`,i||(i=[{}]);for(const R of i)R.ssrc=no.generateRandomNumber(),p&&(R.rtx={ssrc:no.generateRandomNumber()});S.encodings=i,S.rtcp={cname:this._cname,reducedSize:!0,mux:!0},S.msid=`${r??this._defaultSendStreamId} ${n.id}`;const C=this._nextLocalId++;return this._tracks.set(C,n),{localId:String(C),rtpParameters:S}}async stopSending(n){if(ht.debug("stopSending() [localId:%s]",n),!this._closed){if(!this._tracks.has(Number(n)))throw new Error("local track not found");this._tracks.delete(Number(n))}}async pauseSending(n){this.assertNotClosed()}async resumeSending(n){this.assertNotClosed()}async replaceTrack(n,r){this.assertNotClosed(),r?ht.debug("replaceTrack() [localId:%s, track.id:%s]",n,r.id):ht.debug("replaceTrack() [localId:%s, no track]",n),this._tracks.delete(Number(n)),this._tracks.set(Number(n),r)}async setMaxSpatialLayer(n,r){this.assertNotClosed(),ht.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",n,r)}async setRtpEncodingParameters(n,r){this.assertNotClosed(),ht.debug("setRtpEncodingParameters() [localId:%s, params:%o]",n,r)}async getSenderStats(n){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:u}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),ht.debug("sendDataChannel()");const h=new Cw({id:this._nextSctpStreamId++,ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:u}),g={streamId:this._nextSctpStreamId,ordered:n,maxPacketLifeTime:r,maxRetransmits:i};return{dataChannel:h,sctpStreamParameters:g}}async receive(n){this.assertNotClosed();const r=[];for(const i of n){const{trackId:c,kind:u}=i;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),ht.debug("receive() [trackId:%s, kind:%s]",c,u);const h=this._nextLocalId++,g=new UT.FakeMediaStreamTrack({kind:u});this._tracks.set(h,g),r.push({localId:String(h),track:g})}return r}async stopReceiving(n){if(!this._closed)for(const r of n)ht.debug("stopReceiving() [localId:%s]",r),this._tracks.delete(Number(r))}async pauseReceiving(n){this.assertNotClosed()}async resumeReceiving(n){this.assertNotClosed()}async getReceiverStats(n){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:n,label:r,protocol:i}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),ht.debug("receiveDataChannel()"),{dataChannel:new Cw({id:n.streamId,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,label:r,protocol:i})}}async setupTransport({localDtlsRole:n,localSdpObject:r}){const i=no.clone(this._fakeParameters.generateLocalDtlsParameters());n&&(i.role=n),this.emit("@connectionstatechange","connecting"),await new Promise((c,u)=>this.emit("@connect",{dtlsParameters:i},c,u)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Rx.InvalidStateError("method called in a closed handler")}}iu.FakeHandler=Ka;class Cw extends BT.FakeEventTarget{constructor({id:n,ordered:r=!0,maxPacketLifeTime:i=null,maxRetransmits:c=null,label:u="",protocol:h=""}){super();N(this,"_id");N(this,"_negotiated",!0);N(this,"_ordered");N(this,"_maxPacketLifeTime");N(this,"_maxRetransmits");N(this,"_label");N(this,"_protocol");N(this,"_readyState","connecting");N(this,"_bufferedAmount",0);N(this,"_bufferedAmountLowThreshold",0);N(this,"_binaryType","arraybuffer");N(this,"_onopen",null);N(this,"_onclosing",null);N(this,"_onclose",null);N(this,"_onmessage",null);N(this,"_onbufferedamountlow",null);N(this,"_onerror",null);ht.debug(`constructor() [id:${n}, ordered:${r}, maxPacketLifeTime:${i}, maxRetransmits:${c}, label:${u}, protocol:${h}`),this._id=n,this._ordered=r,this._maxPacketLifeTime=i,this._maxRetransmits=c,this._label=u,this._protocol=h}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._bufferedAmountLowThreshold=n}get binaryType(){return this._binaryType}set binaryType(n){this._binaryType=n}get onopen(){return this._onopen}set onopen(n){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=n,n&&this.addEventListener("open",n)}get onclosing(){return this._onclosing}set onclosing(n){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=n,n&&this.addEventListener("closing",n)}get onclose(){return this._onclose}set onclose(n){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=n,n&&this.addEventListener("close",n)}get onmessage(){return this._onmessage}set onmessage(n){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=n,n&&this.addEventListener("message",n)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(n){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=n,n&&this.addEventListener("bufferedamountlow",n)}get onerror(){return this._onerror}set onerror(n){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=n,n&&this.addEventListener("error",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(n){if(this._readyState!=="open")throw new Rx.InvalidStateError("not open")}}var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});Yn.generateRouterRtpCapabilities=zT;Yn.generateNativeRtpCapabilities=VT;Yn.generateNativeSctpCapabilities=GT;Yn.generateLocalDtlsParameters=HT;Yn.generateTransportRemoteParameters=WT;Yn.generateProducerRemoteParameters=KT;Yn.generateConsumerRemoteParameters=QT;Yn.generateDataProducerRemoteParameters=YT;Yn.generateDataConsumerRemoteParameters=JT;const zt=gr;function pn(){return String(zt.generateRandomNumber())}function zT(){return zt.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function VT(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function GT(){return zt.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function HT(){return zt.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function WT(){return{id:pn(),iceParameters:zt.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:zt.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:zt.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:zt.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function KT(){return zt.deepFreeze({id:pn()})}function QT({id:e,codecMimeType:t}={}){switch(t){case"audio/opus":return{id:e??pn(),producerId:pn(),kind:"audio",rtpParameters:zt.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:e??pn(),producerId:pn(),kind:"audio",rtpParameters:zt.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:e??pn(),producerId:pn(),kind:"video",rtpParameters:zt.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:e??pn(),producerId:pn(),kind:"video",rtpParameters:zt.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${t}'`)}}function YT(){return zt.deepFreeze({id:pn()})}function JT({id:e}={}){return{id:e??pn(),dataProducerId:pn(),sctpStreamParameters:zt.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}var bw;function Ix(){return bw||(bw=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.enhancedEvents=e.ortc=e.parseScalabilityMode=e.detectDeviceAsync=e.detectDevice=e.Device=e.version=e.types=void 0;const t=Qd;e.debug=t.default,e.types=cx,e.version="3.18.6";var n=NT();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return n.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return n.detectDevice}}),Object.defineProperty(e,"detectDeviceAsync",{enumerable:!0,get:function(){return n.detectDeviceAsync}});var r=Cs;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=We,e.enhancedEvents=Mt;var i=iu;Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=Yn}(Jp)),Jp}var qT=Ix();const Ol=1e4;function XT({selfUserId:e,getSelfUserId:t,sendDispatch:n,waitForEvent:r,onLocalAudioProcessingInfo:i,onRemoteAudioAdded:c,onRemoteAudioRemoved:u,onRemoteVideoAdded:h,onRemoteVideoRemoved:g,onScreenShareStateChange:S}){const p={sessionToken:0,guildId:"",channelId:"",device:null,sendTransport:null,recvTransport:null,localAudioProducer:null,localScreenProducer:null,localStream:null,localScreenStream:null,localScreenTrackEndedHandler:null,consumersByProducerId:new Map,producerOwnerByProducerId:new Map,isMuted:!1,isDeafened:!1,audioOutputDeviceId:"",pendingAudioStartByProducerId:new Map,userAudioPrefsByUserId:new Map};function C(V={}){const W=!!(V!=null&&V.muted),ie=Number(V==null?void 0:V.volume),fe=Number.isFinite(ie)?Math.max(0,Math.min(100,ie)):100;return{muted:W,volume:fe}}function R(V,W){if(!V)return;if(p.isDeafened){V.volume=0;return}const ie=C(p.userAudioPrefsByUserId.get(W)||{});V.volume=ie.muted?0:ie.volume/100}function D(V){const W=p.pendingAudioStartByProducerId.get(V);W&&(W.cleanup(),p.pendingAudioStartByProducerId.delete(V))}function B(V,W){if(!V||!W||p.pendingAudioStartByProducerId.has(W))return;const ie=()=>{V.paused?V.play().then(()=>{D(W)}).catch(()=>{}):D(W)},fe=["pointerdown","touchstart","keydown","click"];fe.forEach(et=>window.addEventListener(et,ie,{passive:!0}));const we=window.setInterval(ie,1500);p.pendingAudioStartByProducerId.set(W,{cleanup:()=>{window.clearInterval(we),fe.forEach(et=>window.removeEventListener(et,ie))}})}function $(V){return V===p.sessionToken&&!!p.channelId}function y(V){S==null||S(!!V)}function l(){return(t==null?void 0:t())||e||""}async function f(V,W,ie=Ol){return r({type:V,match:W,timeoutMs:ie,guildId:p.guildId,channelId:p.channelId,sessionToken:p.sessionToken})}async function v(V,W=Ol){return r({type:"VOICE_TRANSPORT_CONNECTED",timeoutMs:W,guildId:p.guildId,channelId:p.channelId,sessionToken:p.sessionToken,transportId:V})}async function b(V=Ol){return r({type:"VOICE_ERROR",timeoutMs:V,guildId:p.guildId,channelId:p.channelId,sessionToken:p.sessionToken})}async function P(V,W=Ol){const ie=V(),fe=b(W).then(we=>{throw new Error(`VOICE_ERROR: ${(we==null?void 0:we.error)||"UNKNOWN"}`)});return Promise.race([ie,fe])}async function w(V,W){await n("VOICE_CREATE_TRANSPORT",{guildId:p.guildId,channelId:p.channelId,direction:V});const ie=await f("VOICE_TRANSPORT_CREATED",fe=>(fe==null?void 0:fe.direction)===V);if(!$(W))throw new Error("VOICE_SESSION_CANCELLED");return V==="send"?p.device.createSendTransport(ie.transport):p.device.createRecvTransport(ie.transport)}async function k(V,W,ie){if(!V||!p.recvTransport||!p.device||!$(ie)||p.consumersByProducerId.has(V))return;await n("VOICE_CONSUME",{guildId:p.guildId,channelId:p.channelId,transportId:p.recvTransport.id,producerId:V,rtpCapabilities:p.device.rtpCapabilities});const fe=await P(()=>f("VOICE_CONSUMED",Ee=>(Ee==null?void 0:Ee.producerId)===V));if(!$(ie))return;const we=await p.recvTransport.consume(fe),et=new MediaStream([we.track]);if(we.kind==="audio"){const Ee=document.createElement("audio");Ee.autoplay=!0,Ee.playsInline=!0,Ee.preload="auto",Ee.muted=!1,Ee.srcObject=et,Ee.style.display="none",document.body.appendChild(Ee),Ee.addEventListener("loadedmetadata",()=>{Ee.paused&&Ee.play().catch(()=>{B(Ee,V)})}),typeof Ee.setSinkId=="function"&&p.audioOutputDeviceId&&await Ee.setSinkId(p.audioOutputDeviceId).catch(()=>{}),R(Ee,W||""),await Ee.play().catch(()=>{B(Ee,V)}),p.consumersByProducerId.set(V,{consumer:we,audio:Ee,stream:et,kind:"audio",userId:W||""}),W&&p.producerOwnerByProducerId.set(V,W),c==null||c({producerId:V,guildId:p.guildId,channelId:p.channelId,userId:W,audio:Ee});return}p.consumersByProducerId.set(V,{consumer:we,stream:et,kind:we.kind,userId:W||""}),W&&p.producerOwnerByProducerId.set(V,W),h==null||h({producerId:V,userId:W,stream:et,kind:we.kind})}async function I({guildId:V,channelId:W,audioInputDeviceId:ie,noiseSuppression:fe=!0,isMuted:we=!1,isDeafened:et=!1,audioOutputDeviceId:Ee=""}){var _t,Ts;await z(),p.sessionToken+=1;const wn=p.sessionToken;p.guildId=V,p.channelId=W,p.isMuted=!!we,p.isDeafened=!!et,p.audioOutputDeviceId=Ee||"",await n("VOICE_JOIN",{guildId:V,channelId:W});const Es=await r({type:"VOICE_JOINED",match:tt=>(tt==null?void 0:tt.guildId)===V&&(tt==null?void 0:tt.channelId)===W,timeoutMs:12e3,guildId:V,channelId:W,sessionToken:wn});if(!$(wn))throw new Error("VOICE_SESSION_CANCELLED");p.device=new qT.Device,await p.device.load({routerRtpCapabilities:Es.rtpCapabilities}),p.sendTransport=await w("send",wn),p.sendTransport.on("connect",async({dtlsParameters:tt},Rs,Br)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:p.guildId,channelId:p.channelId,transportId:p.sendTransport.id,dtlsParameters:tt}),await P(()=>v(p.sendTransport.id)),Rs()}catch(zr){Br(zr)}}),p.sendTransport.on("produce",async({kind:tt,rtpParameters:Rs},Br,zr)=>{try{await n("VOICE_PRODUCE",{guildId:p.guildId,channelId:p.channelId,transportId:p.sendTransport.id,kind:tt,rtpParameters:Rs});const Mn=await P(()=>f("VOICE_PRODUCED",Ot=>(Ot==null?void 0:Ot.guildId)===p.guildId&&(Ot==null?void 0:Ot.channelId)===p.channelId&&(Ot==null?void 0:Ot.userId)===l()));Br({id:Mn.producerId})}catch(Mn){zr(Mn)}});const Jn={echoCancellation:!0,noiseSuppression:!!fe,autoGainControl:!0,...ie?{deviceId:{exact:ie}}:{}};p.localStream=await navigator.mediaDevices.getUserMedia({audio:Jn});const vr=p.localStream.getAudioTracks()[0];if(!vr)throw new Error("MIC_TRACK_NOT_FOUND");const Sn=typeof vr.getSettings=="function"?vr.getSettings():{},ks=((Ts=(_t=navigator.mediaDevices)==null?void 0:_t.getSupportedConstraints)==null?void 0:Ts.call(_t))||{};i==null||i({requested:{noiseSuppression:!!fe,echoCancellation:!0,autoGainControl:!0},applied:{noiseSuppression:typeof Sn.noiseSuppression=="boolean"?Sn.noiseSuppression:null,echoCancellation:typeof Sn.echoCancellation=="boolean"?Sn.echoCancellation:null,autoGainControl:typeof Sn.autoGainControl=="boolean"?Sn.autoGainControl:null},supported:{noiseSuppression:!!ks.noiseSuppression,echoCancellation:!!ks.echoCancellation,autoGainControl:!!ks.autoGainControl}}),p.localAudioProducer=await p.sendTransport.produce({track:vr}),p.isMuted&&(p.localAudioProducer.pause(),vr.enabled=!1),p.recvTransport=await w("recv",wn),p.recvTransport.on("connect",async({dtlsParameters:tt},Rs,Br)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:p.guildId,channelId:p.channelId,transportId:p.recvTransport.id,dtlsParameters:tt}),await P(()=>v(p.recvTransport.id)),Rs()}catch(zr){Br(zr)}});for(const tt of Es.producers||[])await k(tt.producerId,tt.userId,wn)}async function O(V){const W=p.consumersByProducerId.get(V);if(W){p.consumersByProducerId.delete(V),p.producerOwnerByProducerId.delete(V),D(V);try{W.consumer.close()}catch{}if(W.audio){try{W.audio.pause(),W.audio.srcObject=null,W.audio.remove()}catch{}u==null||u({producerId:V,userId:W.userId||""});return}g==null||g({producerId:V,userId:W.userId||""})}}function L({stopTracks:V=!1}={}){var W;if(p.localScreenStream){const ie=(W=p.localScreenStream.getVideoTracks())==null?void 0:W[0];ie&&p.localScreenTrackEndedHandler&&ie.removeEventListener("ended",p.localScreenTrackEndedHandler),V&&p.localScreenStream.getTracks().forEach(fe=>fe.stop())}p.localScreenTrackEndedHandler=null,p.localScreenStream=null,p.localScreenProducer=null,y(!1)}async function F({notifyServer:V=!0}={}){if(!p.localScreenProducer){L({stopTracks:!0});return}const W=p.localScreenProducer.id;try{p.localScreenProducer.close()}catch{}L({stopTracks:!0}),!(!V||!W||!p.guildId||!p.channelId)&&await n("VOICE_CLOSE_PRODUCER",{guildId:p.guildId,channelId:p.channelId,producerId:W}).catch(()=>{})}async function q(){var ie;if(!p.sendTransport||!p.guildId||!p.channelId)throw new Error("NOT_IN_VOICE_CHANNEL");if(p.localScreenProducer)return;if(!((ie=navigator.mediaDevices)!=null&&ie.getDisplayMedia))throw new Error("SCREEN_SHARE_NOT_SUPPORTED");const V=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}),W=V.getVideoTracks()[0];if(!W)throw V.getTracks().forEach(fe=>fe.stop()),new Error("SCREEN_TRACK_NOT_FOUND");try{const fe=await p.sendTransport.produce({track:W,appData:{source:"screen"}});p.localScreenProducer=fe,p.localScreenStream=V;const we=()=>{F().catch(()=>{})};p.localScreenTrackEndedHandler=we,W.addEventListener("ended",we),y(!0)}catch(fe){throw V.getTracks().forEach(we=>we.stop()),L({stopTracks:!1}),fe}}async function z(){var V,W,ie;p.sessionToken+=1;for(const fe of[...p.pendingAudioStartByProducerId.keys()])D(fe);for(const fe of[...p.consumersByProducerId.keys()])await O(fe);await F({notifyServer:!1}).catch(()=>{});try{(V=p.localAudioProducer)==null||V.close()}catch{}p.localAudioProducer=null,p.localStream&&(p.localStream.getTracks().forEach(fe=>fe.stop()),p.localStream=null);try{(W=p.sendTransport)==null||W.close()}catch{}p.sendTransport=null;try{(ie=p.recvTransport)==null||ie.close()}catch{}p.recvTransport=null,p.device=null,p.guildId="",p.channelId=""}async function Z(V,W){if(!(!p.channelId||!p.guildId)&&!(W!=null&&W.guildId&&W.guildId!==p.guildId)&&!(W!=null&&W.channelId&&W.channelId!==p.channelId)&&!(p.localAudioProducer&&W.producerId===p.localAudioProducer.id)&&!(p.localScreenProducer&&W.producerId===p.localScreenProducer.id)){if(V==="VOICE_NEW_PRODUCER"&&(W!=null&&W.producerId)){if(W.userId&&W.userId===l())return;await k(W.producerId,W.userId,p.sessionToken).catch(()=>{});return}if(V==="VOICE_PRODUCER_CLOSED"&&(W!=null&&W.producerId)){await O(W.producerId);return}V==="VOICE_USER_LEFT"&&(W!=null&&W.userId)&&te(W.userId)}}function te(V){if(!V)return;[...p.producerOwnerByProducerId.entries()].filter(([,ie])=>ie===V).map(([ie])=>ie).forEach(ie=>{O(ie).catch(()=>{})})}function me(V){var ie,fe;p.isMuted=!!V;const W=(fe=(ie=p.localStream)==null?void 0:ie.getAudioTracks)==null?void 0:fe.call(ie)[0];p.localAudioProducer&&(p.isMuted?p.localAudioProducer.pause():p.localAudioProducer.resume()),W&&(W.enabled=!p.isMuted)}function U(V){p.isDeafened=!!V;for(const{audio:W,userId:ie}of p.consumersByProducerId.values())W&&R(W,ie||"")}function H(V,W={}){const ie=String(V||"").trim();if(ie){p.userAudioPrefsByUserId.set(ie,C(W));for(const{audio:fe,userId:we}of p.consumersByProducerId.values())!fe||we!==ie||R(fe,ie)}}function X(V){p.audioOutputDeviceId=V||"";for(const{audio:W}of p.consumersByProducerId.values())W&&typeof W.setSinkId=="function"&&p.audioOutputDeviceId&&W.setSinkId(p.audioOutputDeviceId).catch(()=>{})}function Q(){return p.localStream}function ae(){return{guildId:p.guildId,channelId:p.channelId}}return{join:I,cleanup:z,handleGatewayDispatch:Z,closeConsumersForUser:te,setMuted:me,setDeafened:U,setUserAudioPreference:H,setAudioOutputDevice:X,startScreenShare:q,stopScreenShare:F,getLocalStream:Q,getContext:ae}}function ZT({downloadMenuRef:e,downloadsMenuOpen:t,setDownloadsMenuOpen:n,downloadTargets:r,preferredDownloadTarget:i,onOpenClient:c,onOpenTerms:u}){var h;return o.jsxs("div",{className:"landing-page",children:[o.jsxs("header",{className:"landing-header",children:[o.jsx("img",{src:"logo.png",alt:"OpenCom",className:"landing-logo"}),o.jsx("span",{className:"landing-brand",children:"OpenCom"})]}),o.jsxs("main",{className:"landing-main",children:[o.jsxs("section",{className:"landing-hero",children:[o.jsx("h1",{className:"landing-headline",children:"The best way to communicate."}),o.jsx("p",{className:"landing-sub",children:"One place for your servers, friends, and communities. Chat, voice, and stay in sync without the noise."})]}),o.jsxs("section",{className:"landing-features",children:[o.jsxs("div",{className:"landing-feature",children:[o.jsx("span",{className:"landing-feature-icon",children:""}),o.jsx("h3",{children:"Servers and channels"}),o.jsx("p",{children:"Organize conversations by topic. Create spaces that scale from a few friends to large communities."})]}),o.jsxs("div",{className:"landing-feature",children:[o.jsx("span",{className:"landing-feature-icon",children:""}),o.jsx("h3",{children:"Friends and DMs"}),o.jsx("p",{children:"Add friends, send direct messages, and see who is online. Simple and private."})]}),o.jsxs("div",{className:"landing-feature",children:[o.jsx("span",{className:"landing-feature-icon",children:""}),o.jsx("h3",{children:"Voice and presence"}),o.jsx("p",{children:"Jump into voice channels when you need to talk. Status and presence keep everyone in the loop."})]})]}),o.jsxs("section",{className:"landing-cta",children:[o.jsxs("div",{className:"landing-cta-download",ref:e,children:[o.jsx("h3",{children:"Get the desktop app"}),o.jsx("p",{className:"landing-hint",children:"Windows and Linux builds are available."}),o.jsxs("div",{className:"download-wrapper",children:[o.jsx("a",{href:(i==null?void 0:i.href)||((h=r[0])==null?void 0:h.href)||"#",className:"landing-btn landing-btn-secondary",target:"_blank",rel:"noopener noreferrer",children:i?`Download ${i.label}`:"Download"}),o.jsx("button",{type:"button",className:"landing-btn landing-btn-secondary",onClick:()=>n(g=>!g),children:"All downloads"}),t&&o.jsx("div",{className:"download-menu",children:r.map(g=>o.jsx("a",{href:g.href,className:"download-item",target:"_blank",rel:"noopener noreferrer",children:g.label},g.href))})]})]}),o.jsxs("div",{className:"landing-cta-client",children:[o.jsx("h3",{children:"Use OpenCom now"}),o.jsx("p",{className:"landing-hint",children:"Open the client in your browser. No install required."}),o.jsx("button",{type:"button",className:"landing-btn landing-btn-primary",onClick:c,children:"Open client"})]})]})]}),o.jsxs("footer",{className:"landing-footer",children:[o.jsx("p",{children:"OpenCom. One place for teams, communities, and friends."}),o.jsx("button",{type:"button",className:"link-btn",onClick:u,children:"Terms of Service"})]})]})}function eR({authMode:e,setAuthMode:t,email:n,setEmail:r,username:i,setUsername:c,password:u,setPassword:h,pendingVerificationEmail:g,status:S,onSubmit:p,onResendVerification:C,onBackHome:R,onOpenTerms:D}){return o.jsx("div",{className:"auth-shell",children:o.jsxs("div",{className:"auth-card",children:[o.jsx("button",{type:"button",className:"link-btn auth-back",onClick:R,children:"Back to home"}),o.jsx("h1",{children:"Welcome back"}),o.jsx("p",{className:"sub",children:"OpenCom keeps your teams, communities, and updates in one place."}),o.jsxs("form",{onSubmit:p,children:[o.jsxs("label",{children:["Email",o.jsx("input",{value:n,onChange:B=>r(B.target.value),type:"email",required:!0})]}),e==="register"&&o.jsxs("label",{children:["Username",o.jsx("input",{value:i,onChange:B=>c(B.target.value),required:!0})]}),o.jsxs("label",{children:["Password",o.jsx("input",{value:u,onChange:B=>h(B.target.value),type:"password",required:!0})]}),o.jsx("button",{type:"submit",children:e==="login"?"Log in":"Create account"})]}),o.jsx("button",{className:"link-btn",onClick:()=>t(e==="login"?"register":"login"),children:e==="login"?"Need an account? Register":"Have an account? Login"}),e==="login"&&o.jsx("button",{type:"button",className:"link-btn",onClick:C,children:"Resend verification email"}),g&&e==="login"&&o.jsxs("p",{className:"sub",children:["Pending verification: ",g]}),o.jsx("button",{type:"button",className:"link-btn",onClick:D,children:"Terms of Service"}),o.jsx("p",{className:"status",children:S})]})})}function tR({onBack:e}){return o.jsxs("div",{className:"legal-page",children:[o.jsxs("header",{className:"legal-header",children:[o.jsx("img",{src:"logo.png",alt:"OpenCom",className:"landing-logo"}),o.jsx("span",{className:"landing-brand",children:"OpenCom"})]}),o.jsxs("main",{className:"legal-main",children:[o.jsxs("article",{className:"legal-card",children:[o.jsx("h1",{children:"Terms of Service"}),o.jsx("p",{className:"legal-meta",children:"Last updated: February 18, 2026"}),o.jsxs("section",{children:[o.jsx("h2",{children:"1. Acceptance"}),o.jsx("p",{children:"By accessing or using OpenCom, you agree to these Terms of Service. If you do not agree, do not use the service."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"2. Eligibility and Accounts"}),o.jsx("p",{children:"You must provide accurate account information and keep your credentials secure. You are responsible for activity on your account."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"3. Acceptable Use"}),o.jsx("p",{children:"You may not use OpenCom to:"}),o.jsxs("ul",{children:[o.jsx("li",{children:"violate any law or regulation;"}),o.jsx("li",{children:"harass, threaten, exploit, or impersonate others;"}),o.jsx("li",{children:"upload malware, attempt unauthorized access, or disrupt services;"}),o.jsx("li",{children:"infringe intellectual property or privacy rights;"}),o.jsx("li",{children:"distribute spam, fraud, or deceptive content."})]})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"4. User Content"}),o.jsx("p",{children:"You retain ownership of content you submit. You grant OpenCom a worldwide, non-exclusive license to host, process, store, and display that content solely to operate and improve the service."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"5. Moderation and Enforcement"}),o.jsx("p",{children:"We may investigate reports and remove content, suspend features, or terminate accounts that violate these Terms or create legal, security, or abuse risk."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"6. Paid Features and Billing"}),o.jsx("p",{children:"Paid subscriptions and boosts may auto-renew unless canceled before renewal. Fees are generally non-refundable except where required by law."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"7. Third-Party Services"}),o.jsx("p",{children:"OpenCom may link to or integrate third-party services. We are not responsible for third-party content, terms, or data handling."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"8. Service Availability"}),o.jsx("p",{children:'OpenCom is provided on an "as is" and "as available" basis. We do not guarantee uninterrupted or error-free service.'})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"9. Limitation of Liability"}),o.jsx("p",{children:"To the fullest extent permitted by law, OpenCom and its operators are not liable for indirect, incidental, special, consequential, or punitive damages, or loss of data, profits, or goodwill."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"10. Termination"}),o.jsx("p",{children:"You may stop using OpenCom at any time. We may suspend or terminate access where necessary to enforce these Terms, prevent abuse, or comply with legal obligations."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"11. Changes to These Terms"}),o.jsx("p",{children:"We may update these Terms from time to time. Continued use after changes become effective constitutes acceptance of the revised Terms."})]}),o.jsxs("section",{children:[o.jsx("h2",{children:"12. Contact"}),o.jsxs("p",{children:["Questions about these Terms can be sent to ",o.jsx("a",{href:"mailto:don@opencom.online",children:"don@opencom.online"}),"."]})]})]}),o.jsx("div",{className:"legal-actions",children:o.jsx("button",{type:"button",className:"landing-btn landing-btn-secondary",onClick:e,children:"Back"})})]})]})}const nf="https://openapi.donskyblock.xyz".replace(/\/$/,""),ih=[{href:`${nf}/downloads/OpenCom.exe`,label:"Windows (.exe)"},{href:`${nf}/downloads/OpenCom.deb`,label:"Linux (.deb)"},{href:`${nf}/downloads/OpenCom.tar.gz`,label:"Linux (.tar.gz)"}];function nR(e=ih){return typeof navigator>"u"?e[0]||null:`${navigator.platform||""} ${navigator.userAgent||""}`.toLowerCase().includes("win")?e.find(n=>n.label.toLowerCase().includes("windows"))||e[0]||null:e.find(n=>n.label.toLowerCase().includes(".deb"))||e[0]||null}const fr="/",Ws="/login",cr="/app",wo="/terms",rf=/^[a-zA-Z0-9_-]{3,32}$/,rR=/^[a-zA-Z0-9_-]{8,96}$/;function sR(e=""){return/^\/join\/[a-zA-Z0-9_-]{3,32}\/?$/.test(e||"")}function iR(e=""){return/^\/gift\/[a-zA-Z0-9_-]{8,96}\/?$/.test(e||"")}function oR(){return typeof window>"u"?!1:new URLSearchParams(window.location.search||"").get("desktop")==="1"}function um(e=""){const t=e.replace(/\/+$/,"")||fr;return t===Ws?Ws:t===cr?cr:t===wo?wo:fr}function aR(){if(typeof window>"u")return fr;const t=(new URLSearchParams(window.location.search||"").get("route")||"").trim();return t.startsWith("/")?t:window.location.pathname||fr}function Al(){const e=um(aR());return oR()&&e===fr?cr:e}function cR(e,{replace:t=!1}={}){if(typeof window>"u")return;const n=um(e),r=window.location.hash||"";if(window.location.protocol==="file:"){const c=new URLSearchParams(window.location.search||"");n===fr?c.delete("route"):c.set("route",n);const u=`${window.location.pathname}${c.toString()?`?${c}`:""}${r}`;window.history[t?"replaceState":"pushState"]({},"",u);return}const i=`${n}${r}`;window.history[t?"replaceState":"pushState"]({},"",i)}function id(e=""){const t=(e||"").trim();if(!t)return"";if(rf.test(t))return t;const n=t.match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(n!=null&&n[1])return n[1];try{const r=new URL(t),i=(r.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(i!=null&&i[1])return i[1];const c=r.searchParams.get("join");if(c&&rf.test(c))return c;for(const h of r.searchParams.keys())if(/^join[a-zA-Z0-9_-]{3,32}$/.test(h))return h;const u=(r.hash||"").replace(/^#/,"");if(u.startsWith("join=")){const h=decodeURIComponent(u.slice(5));if(rf.test(h))return h}}catch{return""}return""}function lR(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);return e!=null&&e[1]?e[1]:id(window.location.href||"")}function oh(e=""){const t=(e||"").trim();if(!t)return"";if(rR.test(t))return t;const n=t.match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);if(n!=null&&n[1])return n[1];try{const i=(new URL(t).pathname||"").match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);if(i!=null&&i[1])return i[1]}catch{return""}return""}function dR(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);return e!=null&&e[1]?e[1]:oh(window.location.href||"")}function sf(e){return typeof window>"u"?"":`${window.location.origin}/join/${encodeURIComponent(e)}`}function Ew(e){return typeof window>"u"?"":`${window.location.origin}/gift/${encodeURIComponent(e)}`}function uR(){const e="https://openapi.donskyblock.xyz".trim();let t="";if(typeof window<"u"){const r=new URLSearchParams(window.location.search||"");t=String(r.get("coreApi")||"").trim()}const n=t||e||"https://api.opencom.online";try{const r=new URL(n);return r.protocol!=="http:"&&r.protocol!=="https:"?"https://api.opencom.online":r.toString().replace(/\/$/,"")}catch{return"https://api.opencom.online"}}const fn=uR();function Xt(e){if(!e||typeof e!="string")return null;const t=e.trim();return!t||t==="null"||t==="undefined"||t==="[object Object]"?null:(e=t,e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("users/")?`${fn.replace(/\/$/,"")}/v1/profile-images/${e}`:e.startsWith("/users/")?`${fn.replace(/\/$/,"")}/v1/profile-images${e}`:e.startsWith("/")?`${fn.replace(/\/$/,"")}${e}`:e)}function od(e={}){const t=!!String((e==null?void 0:e.bio)||"").trim();return{version:1,mode:"basic",enabled:!0,theme:{background:"linear-gradient(150deg, #16274b, #0f1a33 65%)",card:"rgba(9, 14, 28, 0.62)",text:"#dfe9ff"},elements:[{id:"banner",type:"banner",x:0,y:0,w:100,h:34,order:0},{id:"avatar",type:"avatar",x:4,y:21,w:20,h:31,order:1},{id:"name",type:"name",x:30,y:30,w:66,h:10,order:2},{id:"bio",type:"bio",x:4,y:54,w:92,h:t?30:18,order:3}],links:[],music:{url:"",autoplay:!1,loop:!0,volume:60}}}function ur(e,t,n,r){const i=Number(e);return Number.isFinite(i)?Math.max(t,Math.min(n,i)):r}function ro(e={},t){const n=od(e),r=t&&typeof t=="object"?t:{},i=r.theme&&typeof r.theme=="object"?r.theme:{},c={background:typeof i.background=="string"&&i.background.trim()?i.background.trim().slice(0,300):n.theme.background,card:typeof i.card=="string"&&i.card.trim()?i.card.trim().slice(0,120):n.theme.card,text:typeof i.text=="string"&&i.text.trim()?i.text.trim().slice(0,40):n.theme.text},h=(Array.isArray(r.elements)?r.elements:[]).filter(D=>D&&typeof D=="object").slice(0,24).map((D,B)=>{const $=String(D.type||"").toLowerCase();return["avatar","banner","name","bio","links","text"].includes($)?{id:String(D.id||`${$}-${B+1}`).slice(0,40),type:$,x:ur(D.x,0,100,$==="banner"?0:5),y:ur(D.y,0,100,$==="banner"?0:5+B*8),w:ur(D.w,1,100,$==="banner"?100:$==="avatar"?20:80),h:ur(D.h,1,100,$==="banner"?34:$==="avatar"?31:12),order:Math.max(0,Math.min(100,Number.isFinite(Number(D.order))?Math.round(Number(D.order)):B)),text:typeof D.text=="string"?D.text.slice(0,500):""}:null}).filter(Boolean),S=(Array.isArray(r.links)?r.links:[]).filter(D=>D&&typeof D=="object").slice(0,16).map((D,B)=>{const $=String(D.label||"").trim().slice(0,40),y=String(D.url||"").trim().slice(0,500);return!$||!/^https?:\/\//i.test(y)?null:{id:String(D.id||`link-${B+1}`).slice(0,40),label:$,url:y,x:ur(D.x,0,100,0),y:ur(D.y,0,100,0)}}).filter(Boolean),p=r.music&&typeof r.music=="object"?r.music:{},C=String(p.url||"").trim().slice(0,500),R={url:/^(https?:\/\/|\/|users\/)/i.test(C)?C:"",autoplay:!!p.autoplay,loop:p.loop!==!1,volume:Math.max(0,Math.min(100,Number.isFinite(Number(p.volume))?Math.round(Number(p.volume)):60))};return{version:1,mode:r.mode==="custom"?"custom":"basic",enabled:r.enabled!==!1,theme:c,elements:h.length?h:n.elements,links:S,music:R}}const Ul="opencom_custom_theme_css",$l="opencom_custom_theme_enabled",kw="opencom_self_status",Tw="opencom_pinned_dm_messages",of="opencom_active_dm",Rw="opencom_gateway_device_id",Iw="opencom_mic_gain",jw="opencom_mic_sensitivity",Nw="opencom_audio_input_device",Pw="opencom_audio_output_device",Lw="opencom_noise_suppression",Dw="opencom_voice_member_audio_prefs",pR="opencom_server_voice_gateway_prefs",Mw="opencom_last_core_gateway",Ow="opencom_last_server_gateway",ad="wss://ws.opencom.online/gateway",fR="opencom_debug_voice",Aw="opencom_client_extensions_enabled",Uw="opencom_client_extensions_dev_mode",$w="opencom_client_extensions_dev_urls",Qa="opencom_access_token",Ya="opencom_refresh_token",af="opencom_pending_invite_code",cf="opencom_pending_invite_auto_join",Fw={smile:"",grin:"",joy:"",rofl:"",wink:"",heart:"",thumbs_up:"",fire:"",tada:"",eyes:"",thinking:"",sob:""},or={MANAGE_CHANNELS:1n<<2n,MANAGE_ROLES:1n<<3n,KICK_MEMBERS:1n<<4n,BAN_MEMBERS:1n<<5n,MUTE_MEMBERS:1n<<6n,DEAFEN_MEMBERS:1n<<7n,MOVE_MEMBERS:1n<<8n,ADMINISTRATOR:1n<<60n};function hR(e){try{return typeof e=="bigint"?e:typeof e=="number"?BigInt(e):typeof e=="string"&&e.trim()?BigInt(e.trim()):0n}catch{return 0n}}function mR(){const e="".trim()==="1",t=typeof window<"u"&&localStorage.getItem(fR)==="1";return e||t}function gR(e=""){try{const t=e.split(".");if(t.length!==3)return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(n);return JSON.parse(r)}catch{return null}}async function ah(){const e=localStorage.getItem(Ya)||"";if(!e)return null;const t=await fetch(`${fn}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return null;const n=await t.json().catch(()=>null),r=n==null?void 0:n.accessToken;return r?(localStorage.setItem(Qa,r),n!=null&&n.refreshToken&&localStorage.setItem(Ya,n.refreshToken),typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-access-token-refresh",{detail:{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}})),{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}):null}async function vR(e,t){if(!t)return null;const n=localStorage.getItem(Qa)||"";if(!n)return null;const r=gR(t),i=(r==null?void 0:r.core_server_id)||(r==null?void 0:r.server_id);if(!i)return null;const c=await fetch(`${fn}/v1/servers/${encodeURIComponent(i)}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!c.ok)return null;const u=await c.json().catch(()=>null),h=u==null?void 0:u.membershipToken;return h?(typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-membership-token-refresh",{detail:{serverId:i,membershipToken:h}})),h):null}function yR(e,t){return Nx(e,t)}function pm(e){if(!e||typeof e!="string")return"";const t=e.trim();if(!t)return"";if(typeof window<"u"&&window.location.protocol==="file:"&&(t.startsWith("/")||!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(t)))return ad;try{const n=new URL(t,window.location.origin);return n.protocol!=="ws:"&&n.protocol!=="wss:"&&(n.protocol=n.protocol==="http:"?"ws:":"wss:"),n.pathname="/gateway",n.search="",n.hash="",n.toString().replace(/\/$/,"")}catch{const n=t.replace(/\/$/,"");return n.endsWith("/gateway")?n:`${n}/gateway`}}function wR(){if(typeof window>"u"||window.location.protocol==="file:")return ad;const e=window.location.hostname||"";return e==="opencom.online"||e.endsWith(".opencom.online")?ad:pm("/gateway")}function jx(){const e=[];return(n=>{const r=pm(n);r&&(e.includes(r)||e.push(r))})(wR()),e}function Bw(){return typeof window>"u"?null:window.opencomDesktopBridge||null}function SR(e,t=!1){const n=[],r=c=>{const u=pm(c);u&&(n.includes(u)||n.push(u))};for(const c of jx())r(c);return(t||"".trim()==="1")&&r(e),n}function Nx(e,t){const n=localStorage.getItem(t);if(!n)return e;const r=e.indexOf(n);return r<=0?e:[e[r],...e.slice(0,r),...e.slice(r+1)]}function _R(){const[e,t]=x.useState(localStorage.getItem(Ul)||""),[n,r]=x.useState(localStorage.getItem($l)!=="0");return x.useEffect(()=>{let i=document.getElementById("opencom-theme-style");i||(i=document.createElement("style"),i.id="opencom-theme-style",document.head.appendChild(i)),i.textContent=n?e:"",localStorage.setItem(Ul,e),localStorage.setItem($l,n?"1":"0")},[e,n]),x.useEffect(()=>{const i=u=>{var S,p;const h=String((((S=u==null?void 0:u.detail)==null?void 0:S.css)??localStorage.getItem(Ul))||""),g=((p=u==null?void 0:u.detail)==null?void 0:p.enabled)!==void 0?!!u.detail.enabled:localStorage.getItem($l)!=="0";t(h),r(g)},c=u=>{!u||u.key!==Ul&&u.key!==$l||i({})};return window.addEventListener("opencom-theme-updated",i),window.addEventListener("storage",c),()=>{window.removeEventListener("opencom-theme-updated",i),window.removeEventListener("storage",c)}},[]),[e,t,n,r]}function zw(e=[],t,n,r=null,i=null){const c=[];for(const u of e){const h=t(u),g=r?r(u):h,S=i?i(u):null,p=n(u),C=p?new Date(p):null,R=C&&!Number.isNaN(C.getTime())?C.getTime():null,D=c[c.length-1];if(D&&D.authorId===g&&R!==null&&D.lastMessageMs!==null&&R-D.lastMessageMs<=12e4){D.messages.push(u),D.lastMessageMs=R;continue}c.push({id:u.id,author:h,authorId:g,pfpUrl:S,firstMessageTime:p,lastMessageMs:R,messages:[u]})}return c}async function le(e,t={}){const n=t.__retried===!0,r={...t};delete r.__retried;const i=await fetch(`${fn}${e}`,{headers:{"Content-Type":"application/json",...r.headers||{}},...r});if(!i.ok){if(i.status===401&&!n&&e!=="/v1/auth/refresh"){const h=await ah().catch(()=>null);if(h!=null&&h.accessToken){const g={...r.headers||{},Authorization:`Bearer ${h.accessToken}`};return le(e,{...r,headers:g,__retried:!0})}}const c=await i.json().catch(()=>({})),u=new Error(c.error||`HTTP_${i.status}`);throw u.status=i.status,u}return i.json()}async function ue(e,t,n,r={}){const i=r.__retried===!0,c={...r};delete c.__retried;const u=c.body!==void 0&&c.body!==null,h=await fetch(`${e}${t}`,{headers:{...u?{"Content-Type":"application/json"}:{},Authorization:`Bearer ${n}`,...c.headers||{}},...c});if(!h.ok){if(h.status===401&&!i){const S=await vR(e,n).catch(()=>null);if(S)return ue(e,t,S,{...c,__retried:!0})}const g=await h.json().catch(()=>({}));throw new Error(g.error||`HTTP_${h.status}`)}return h.json()}function so(e,t){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function Vw(e){const t=so(e,[]);return Array.isArray(t)?t.filter(n=>typeof n=="string"&&n.trim()):[]}function Ir(e=""){const t=e.trim();if(!t)return"OC";const n=t.split(/\s+/).filter(Boolean);return n.length===1?n[0].slice(0,2).toUpperCase():`${n[0][0]||""}${n[1][0]||""}`.toUpperCase()}function lf(e=""){const t=e.match(/(?:^|\s)(@\{?)([^\s{}@]*)$/);if(!t)return null;const n=t[1]||"@",r=t[2]||"",i=e.length-n.length-r.length;return{query:r.toLowerCase(),start:i}}function xR(e=""){const t=e.trimStart();return t.startsWith("/")?(t.slice(1).split(/\s+/)[0]||"").toLowerCase():null}function CR(e=""){const t=[],n=/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|(\S+)/g;let r=n.exec(e);for(;r;)t.push((r[1]??r[2]??r[3]??"").replace(/\\(["'\\])/g,"$1")),r=n.exec(e);return t}function bR(e,t){if(t==="number"){const n=Number(e);if(Number.isNaN(n))throw new Error(`Invalid number: ${e}`);return n}if(t==="boolean"){const n=String(e).toLowerCase();if(["true","1","yes","on"].includes(n))return!0;if(["false","0","no","off"].includes(n))return!1;throw new Error(`Invalid boolean: ${e}`)}return e}function Gw(e){if(!e)return"just now";const t=new Date(e);return Number.isNaN(t.getTime())?"just now":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Hw(e=null){var t,n,r,i,c,u,h,g;return{name:(e==null?void 0:e.name)||"",details:(e==null?void 0:e.details)||"",state:(e==null?void 0:e.state)||"",largeImageUrl:(e==null?void 0:e.largeImageUrl)||"",largeImageText:(e==null?void 0:e.largeImageText)||"",smallImageUrl:(e==null?void 0:e.smallImageUrl)||"",smallImageText:(e==null?void 0:e.smallImageText)||"",button1Label:((n=(t=e==null?void 0:e.buttons)==null?void 0:t[0])==null?void 0:n.label)||"",button1Url:((i=(r=e==null?void 0:e.buttons)==null?void 0:r[0])==null?void 0:i.url)||"",button2Label:((u=(c=e==null?void 0:e.buttons)==null?void 0:c[1])==null?void 0:u.label)||"",button2Url:((g=(h=e==null?void 0:e.buttons)==null?void 0:h[1])==null?void 0:g.url)||""}}function ER(e){const t=[];return e.button1Label.trim()&&e.button1Url.trim()&&t.push({label:e.button1Label.trim(),url:e.button1Url.trim()}),e.button2Label.trim()&&e.button2Url.trim()&&t.push({label:e.button2Label.trim(),url:e.button2Url.trim()}),{name:e.name.trim()||void 0,details:e.details.trim()||void 0,state:e.state.trim()||void 0,largeImageUrl:e.largeImageUrl.trim()||void 0,largeImageText:e.largeImageText.trim()||void 0,smallImageUrl:e.smallImageUrl.trim()||void 0,smallImageText:e.smallImageText.trim()||void 0,buttons:t.length?t:void 0}}function Ww(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function Kw(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function kR(e=!1){if(!e)try{const t=new window.AudioContext,n=t.createOscillator(),r=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.value=523.25,r.type="sine",r.frequency.value=659.25,i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.12,t.currentTime+.04),i.gain.linearRampToValueAtTime(0,t.currentTime+.22),n.connect(i),r.connect(i),i.connect(t.destination),n.start(),r.start(),n.stop(t.currentTime+.22),r.stop(t.currentTime+.22),n.onended=()=>{r.onended=()=>t.close()}}catch{}}function TR(e=""){return e?e==="image/png"?".png":e==="image/jpeg"?".jpg":e==="image/gif"?".gif":e==="image/webp"?".webp":e==="image/svg+xml"?".svg":e==="image/bmp"?".bmp":e==="image/heic"?".heic":e==="video/mp4"?".mp4":e==="video/webm"?".webm":e==="application/pdf"?".pdf":".bin":".bin"}function RR(e,t="upload"){if(!e)return null;if(e.name&&e.name.trim())return e;const n=TR(e.type||""),r=`${t}-${Date.now()}${n}`;try{return new File([e],r,{type:e.type||"application/octet-stream"})}catch{return e}}function ts(e=""){const t=String(e||"").trim();return t?/^https?:\/\//i.test(t)||/^data:image\//i.test(t)||t.startsWith("/")?t:t.startsWith("users/")?`/v1/profile-images/${t}`:t:""}function Qw(e=""){const t=String(e||"");if(!t)return[];const n=/https?:\/\/[^\s<>"'`)\]]+/gi,r=new Set;let i=n.exec(t);for(;i;){const c=String(i[0]||"").trim();c&&r.add(c),i=n.exec(t)}return[...r]}function IR(){var fv,hv,ml,mv,gv,vv,yv,wv,Sv,_v,xv,Cv,bv,Ev,kv,Tv,Rv,Iv,jv,Nv,Pv,Lv,Dv,Mv,Ov,Av,Uv,$v,Fv,Bv;const e=mR(),t=(s,a={})=>{e&&console.debug(`[voice-debug] ${s}`,a)},n=localStorage.getItem(of)||"",[r,i]=x.useState(localStorage.getItem(Qa)||""),[c,u]=x.useState(localStorage.getItem(Ya)||""),[h,g]=x.useState("login"),[S,p]=x.useState(""),[C,R]=x.useState(""),[D,B]=x.useState(""),[$,y]=x.useState(""),[l,f]=x.useState(null),[v,b]=x.useState("servers"),[P,w]=x.useState(""),[k,I]=x.useState([]),[O,L]=x.useState([]),[F,q]=x.useState(""),[z,Z]=x.useState(""),[te,me]=x.useState(""),[U,H]=x.useState(null),[X,Q]=x.useState([]),[ae,V]=x.useState(""),[W,ie]=x.useState(!1),[fe,we]=x.useState(""),[et,Ee]=x.useState(""),[wn,Es]=x.useState([]),[Jn,vr]=x.useState(()=>{try{return sessionStorage.getItem(af)||""}catch{return""}}),[Sn,ks]=x.useState(()=>{try{return sessionStorage.getItem(cf)==="1"}catch{return!1}}),[_t,Ts]=x.useState([]),[tt,Rs]=x.useState(""),[Br,zr]=x.useState(""),[Mn,Ot]=x.useState("online"),[xt,yr]=x.useState([]),[xe,wr]=x.useState(n),[Sc,du]=x.useState(""),[ne,vi]=x.useState(null),[_e,_n]=x.useState({displayName:"",bio:"",pfpUrl:"",bannerUrl:""}),[ce,at]=x.useState(od({})),[Wt,Bo]=x.useState(null),[_c,hm]=x.useState(""),[Vr,Is]=x.useState(""),[uu,mm]=x.useState(!0),[gm,Px]=x.useState(100),[pu,Lx]=x.useState(()=>({width:typeof window<"u"?window.innerWidth:1280,height:typeof window<"u"?window.innerHeight:720})),fu=x.useRef({x:0,y:0}),xc=x.useRef(null),[xn,At]=x.useState({name:"",details:"",state:"",largeImageUrl:"",largeImageText:"",smallImageUrl:"",smallImageText:"",button1Label:"",button1Url:"",button2Label:"",button2Url:""}),[yi,js]=x.useState({name:"",logoUrl:"",bannerUrl:""}),[wi,hu]=x.useState(""),[Si,mu]=x.useState("https://"),[_i,zo]=x.useState(""),[gu,Vo]=x.useState(""),[vu,vm]=x.useState(""),[Cc,Dx]=x.useState(""),[ym,Mx]=x.useState(""),[yu,wm]=x.useState(""),[wu,Ox]=x.useState(!1),[Gr,Go]=x.useState(""),[sn,bc]=x.useState(null),[Su,Sm]=x.useState(""),[Ec,Ax]=x.useState("text"),[_m,xm]=x.useState(""),[Ho,Cm]=x.useState(""),[kc,_u]=x.useState({incoming:[],outgoing:[]}),[jR,Ux]=x.useState(!0),[$x,Fx]=x.useState({}),[qn,Tc]=x.useState({guildId:"",channelId:""}),[xu,bm]=x.useState(!1),[Ns,Cu]=x.useState(!1),[on,Wo]=x.useState(!1),[Kt,Ko]=x.useState(!1),[Rc,Bx]=x.useState(Number(localStorage.getItem(Iw)||100)),[xi,zx]=x.useState(Number(localStorage.getItem(jw)||50)),[Sr,Em]=x.useState(localStorage.getItem(Nw)||""),[Hr,km]=x.useState(localStorage.getItem(Pw)||""),[Ci,Vx]=x.useState(localStorage.getItem(Lw)!=="0"),[Qo,Tm]=x.useState(null),[Gx,Hx]=x.useState([]),[Wx,Kx]=x.useState([]),[On,Qx]=x.useState(localStorage.getItem(kw)||"online"),[Rm,Im]=x.useState(!1),[Ps,bu]=x.useState(""),[Wr,Yo]=x.useState(""),[Eu,Jo]=x.useState(""),[ku,Yx]=x.useState({}),[Ic,Jx]=x.useState(so(Tw,{})),[Tu,jm]=x.useState(""),[Ru,qx]=x.useState(""),[Iu,Xx]=x.useState(""),[qo,Nm]=x.useState(""),[Pm,Zx]=x.useState(""),[ju,Lm]=x.useState(""),[bi,Ei]=x.useState(!1),[ki,eC]=x.useState({x:26,y:26}),[Dm,Mm]=x.useState(!1),[jc,tC]=x.useState(!1),[Xo,Nc]=x.useState(null),[Ls,Ct]=x.useState(!1),[Ne,qe]=x.useState("profile"),[Ke,nC]=x.useState(null),[rC,Om]=x.useState(!1),[Pc,Lc]=x.useState(null),[Nu,Dc]=x.useState(""),[Zo,Pu]=x.useState(null),[Ti,Ri]=x.useState(null),[Am,Um]=x.useState(!1),[$m,Fm]=x.useState(!1),[Bm,zm]=x.useState(!1),[Vm,sC]=x.useState([]),[ea,Gm]=x.useState({}),[ta,Hm]=x.useState({}),[iC,Ii]=x.useState(!1),[ji,Lu]=x.useState("create"),[Cn,bt]=x.useState(null),[nt,an]=x.useState(null),[Qt,ct]=x.useState(null),[Ds,An]=x.useState(null),[Ms,Un]=x.useState(null),[na,Du]=x.useState(null),[Wm,Mu]=x.useState({}),[ge,Os]=x.useState(null),[As,Ou]=x.useState({}),Au=x.useRef(new Set),[oC,Km,aC,cC]=_R(),[NR,lC]=x.useState([]),[PR,LR]=x.useState({current:"",new:"",confirm:""}),[dC,Uu]=x.useState(!1),[Qm,$u]=x.useState(""),[Mc,Fu]=x.useState(""),[Ym,Bu]=x.useState(""),[uC,DR]=x.useState([{id:"current",device:"Current Device",location:"Your Location",lastActive:"Now",status:"active"}]),[Jm,MR]=x.useState({date:new Date().toISOString(),device:"Current Device",location:"Your Location"}),[pC,zu]=x.useState(""),[qm,fC]=x.useState(""),[Xm,Oc]=x.useState([]),[Zm,Vu]=x.useState(""),[hC,Gu]=x.useState(!1),[eg,Ac]=x.useState(!1),[tg,ng]=x.useState({twoFactorEnabled:!1}),[Uc,Hu]=x.useState(null),[$c,Wu]=x.useState(null),[Fc,rg]=x.useState(""),[Bc,Ni]=x.useState({}),[_r,sg]=x.useState(Al),[mC,Ku]=x.useState(!1),[Et,Qu]=x.useState(null),[zc,Vc]=x.useState(!1),[gC,Pi]=x.useState(!1),[vC,Li]=x.useState(""),[ra,Yu]=x.useState(null),[Us,Ju]=x.useState({}),[ig,qu]=x.useState({}),[og,Gc]=x.useState({}),[bn,yC]=x.useState(so(Dw,{})),[ag,wC]=x.useState(so(pR,{})),[cg,SC]=x.useState({}),[lg,Xu]=x.useState([]),[sa,_C]=x.useState(Vw(Aw)),[Di,xC]=x.useState(localStorage.getItem(Uw)==="1"),[ia,dg]=x.useState(Vw($w)),[ug,pg]=x.useState(""),[Hc,Zu]=x.useState({}),[Wc,ep]=x.useState([]),[fg,Kc]=x.useState(0),Qc=x.useRef(null),kt=x.useRef(null),En=x.useRef(null),Xe=x.useRef(null),Ut=x.useRef(null),cn=x.useRef(!1),oa=x.useRef([]),tp=x.useRef({audioCtx:null,stream:null,analyser:null,timer:null,lastSpeaking:!1}),xr=x.useRef(new Map),hg=x.useRef(""),mg=x.useRef(bn);mg.current=bn,hg.current=(l==null?void 0:l.id)||"";const $t=x.useRef(null);$t.current||($t.current=XT({getSelfUserId:()=>hg.current,sendDispatch:(s,a)=>pl(s,a),waitForEvent:Y0,onLocalAudioProcessingInfo:s=>{Tm(s||null)},onRemoteVideoAdded:({producerId:s,userId:a,stream:d})=>{!s||!d||Gc(m=>({...m,[s]:{producerId:s,userId:a||"",stream:d}}))},onRemoteAudioAdded:({guildId:s,userId:a})=>{var E,T;const d=String(a||"").trim();if(!s||!d)return;const _=(((E=mg.current)==null?void 0:E[s])||{})[d]||{muted:!1,volume:100};(T=$t.current)==null||T.setUserAudioPreference(d,_)},onRemoteVideoRemoved:({producerId:s})=>{s&&Gc(a=>{if(!a[s])return a;const d={...a};return delete d[s],d})},onScreenShareStateChange:s=>{Cu(!!s)}}));const np=x.useRef(On);np.current=On;function kn(s){var d;if(!s)return"offline";if(s===(l==null?void 0:l.id))return On;const a=String(((d=Bc[s])==null?void 0:d.status)??"offline").toLowerCase();return a==="invisible"?"offline":a}function CC(s){var a;return s?((a=Bc[s])==null?void 0:a.richPresence)??null:null}const bC={online:"Online",idle:"Idle",dnd:"Do Not Disturb",offline:"Offline",invisible:"Invisible"};function aa(s){return bC[s]||s||"Offline"}function EC(s){const a=String(s||"offline").toLowerCase();return a==="online"?"presence-online":a==="idle"?"presence-idle":a==="dnd"?"presence-dnd":"presence-offline"}function Mi({userId:s,username:a,pfpUrl:d,size:m=28}){const _=kn(s),T=String(s||a||"?").charCodeAt(0)||0,M=Xt(d);return o.jsxs("div",{className:"avatar-with-presence",style:{width:`${m}px`,height:`${m}px`},children:[M&&o.jsx("img",{src:M,alt:a,className:"avatar-presence-image",onError:A=>{var K;A.currentTarget.style.display="none";const G=(K=A.currentTarget.parentElement)==null?void 0:K.querySelector(".avatar-presence-fallback");G&&(G.style.display="grid")}}),o.jsx("div",{className:"avatar-presence-fallback",style:{background:`hsl(${Math.abs(T*7)%360}, 70%, 60%)`,display:M?"none":"grid"},children:String(a||"?").substring(0,1).toUpperCase()}),o.jsx("span",{className:`presence-indicator-dot ${EC(_)}`})]})}const ca=x.useRef(null),la=x.useRef(null),Oi=x.useRef(null),gg=x.useRef(null),Yc=x.useRef(!0),rp=x.useRef(0),sp=x.useRef(new Set),Jc=x.useRef(new Set),ip=x.useRef({}),qc=x.useRef(""),vg=x.useRef(""),Cr=x.useRef(null),op=x.useRef(null),Ai=x.useRef(""),Kr=x.useRef(""),Xc=x.useRef(""),da=x.useRef({x:0,y:0}),ap=x.useRef(null),kC=x.useMemo(()=>nR(ih),[]),yg=x.useRef(new Set),cp=x.useRef(!1),TC=x.useRef([]),wg=x.useRef([]),Zc=x.useRef(""),$s=(l==null?void 0:l.id)||"anonymous";function ua(s){const a=Cr.current;Cr.current=null,Qu(null),a&&a(s)}function lp({type:s="alert",title:a="OpenCom",message:d="",defaultValue:m="",confirmLabel:_="OK",cancelLabel:E="Cancel"}){return Cr.current&&(Cr.current(s==="confirm"?!1:null),Cr.current=null),Qu({type:s,title:a,message:String(d||""),value:String(m||""),confirmLabel:_,cancelLabel:E}),new Promise(T=>{Cr.current=T})}async function Fs(s,a=""){return lp({type:"prompt",title:"Input",message:s,defaultValue:a,confirmLabel:"Continue",cancelLabel:"Cancel"})}async function Qr(s,a="Confirm"){return!!await lp({type:"confirm",title:a,message:s,confirmLabel:"Confirm",cancelLabel:"Cancel"})}async function dp(s,a="Notice"){await lp({type:"alert",title:a,message:s,confirmLabel:"OK"})}function Tn(s,{replace:a=!1}={}){cR(s,{replace:a}),sg(Al())}x.useEffect(()=>{wg.current=k},[k]),x.useEffect(()=>{if(!Et||Et.type!=="prompt")return;const s=window.setTimeout(()=>{var a,d,m;(a=op.current)==null||a.focus(),(m=(d=op.current)==null?void 0:d.select)==null||m.call(d)},0);return()=>window.clearTimeout(s)},[Et]),x.useEffect(()=>()=>{Cr.current&&(Cr.current(null),Cr.current=null)},[]),x.useEffect(()=>{ip.current=ta||{}},[ta]),x.useEffect(()=>{const s=()=>sg(Al());return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),x.useEffect(()=>{if(typeof window>"u"||window.location.protocol==="file:"||sR(window.location.pathname||"")||iR(window.location.pathname||""))return;const s=um(window.location.pathname||"");s!==(window.location.pathname||"")&&Tn(s,{replace:!0})},[]),x.useEffect(()=>{r&&_r!==wo&&_r!==cr&&Tn(cr,{replace:!0})},[r,_r]),x.useEffect(()=>{!r||!Ls||Ne!=="billing"||(ga().catch(()=>{}),Bi().catch(()=>{}))},[r,Ls,Ne]),x.useEffect(()=>{r||_r===cr&&Tn(Ws,{replace:!0})},[r,_r]),x.useEffect(()=>{function s(d){ap.current&&!ap.current.contains(d.target)&&Ku(!1)}function a(d){d.key==="Escape"&&Ku(!1)}return document.addEventListener("mousedown",s),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",a)}},[]),x.useEffect(()=>{localStorage.setItem(Aw,JSON.stringify(sa))},[sa]),x.useEffect(()=>{try{Jn?sessionStorage.setItem(af,Jn):sessionStorage.removeItem(af)}catch{}},[Jn]),x.useEffect(()=>{try{Sn?sessionStorage.setItem(cf,"1"):sessionStorage.removeItem(cf)}catch{}},[Sn]),x.useEffect(()=>{localStorage.setItem(Uw,Di?"1":"0")},[Di]),x.useEffect(()=>{localStorage.setItem($w,JSON.stringify(ia))},[ia]),x.useEffect(()=>{const s=k.find(a=>a.id===F);if(!s){js({name:"",logoUrl:"",bannerUrl:""});return}js({name:s.name||"",logoUrl:s.logoUrl||"",bannerUrl:s.bannerUrl||""})},[F,k]),x.useEffect(()=>{if(!r||!(l!=null&&l.id)){Xu([]);return}le("/v1/extensions/catalog",{headers:{Authorization:`Bearer ${r}`}}).then(s=>Xu(s.clientExtensions||[])).catch(()=>Xu([]))},[r,l==null?void 0:l.id]),x.useEffect(()=>{const s=k.find(a=>a.id===F)||null;if(!r||!s){ep([]);return}ue(s.baseUrl,"/v1/extensions/commands",s.membershipToken).then(a=>ep(Array.isArray(a.commands)?a.commands:[])).catch(()=>ep([]))},[r,F,k]),x.useEffect(()=>{if(!r||k.length===0)return;let s=!1;const a=async()=>{try{const m=wg.current||[],_=await Promise.all(m.map(async T=>{try{const M=await le(`/v1/servers/${T.id}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});return{id:T.id,membershipToken:M.membershipToken}}catch{return null}}));if(s)return;const E=new Map(_.filter(Boolean).map(T=>[T.id,T.membershipToken]));E.size&&I(T=>T.map(M=>{const A=E.get(M.id);return A?{...M,membershipToken:A}:M}))}catch{}};a();const d=window.setInterval(a,8*60*1e3);return()=>{s=!0,window.clearInterval(d)}},[r,k.length]),x.useEffect(()=>{if(!c)return;let s=!1;const a=async()=>{const m=await ah().catch(()=>null);s||m!=null&&m.accessToken||(w("Session expired. Please sign in again."),i(""),u(""))},d=window.setInterval(a,10*60*1e3);return()=>{s=!0,window.clearInterval(d)}},[c]),x.useEffect(()=>{Kc(0)},[ae,Wc]);async function RC({extensionId:s,extensionName:a,devUrl:d}){if(d){const _=await fetch(d);if(!_.ok)throw new Error(`HTTP_${_.status}`);return _.text()}const m=await fetch(`${fn}/v1/extensions/client/${encodeURIComponent(s)}/source`,{headers:{Authorization:`Bearer ${r}`}});if(!m.ok)throw new Error(`HTTP_${m.status}`);return m.text()}async function IC({extensionId:s,extensionName:a,devUrl:d}){const m=await RC({extensionId:s,extensionName:a,devUrl:d}),_=new Blob([m],{type:"application/javascript"}),E=URL.createObjectURL(_);try{const T=await import(E),M=(T==null?void 0:T.activateClient)||(T==null?void 0:T.default);if(typeof M!="function")throw new Error("Missing activateClient export");const A={registerPanel:G=>{TC.current.push(G)},coreApi:(G,K={})=>le(G,{...K,headers:{Authorization:`Bearer ${r}`,...K.headers||{}}}),getSelf:()=>l,setStatus:w,voice:{getState:()=>({connected:!!qn.channelId,guildId:qn.guildId||"",channelId:qn.channelId||"",muted:!!on,deafened:!!Kt,screenSharing:!!Ns}),join:async G=>{const K=(Bs||[]).find(Y=>(Y==null?void 0:Y.id)===G&&(Y==null?void 0:Y.type)==="voice");if(!K)throw new Error("VOICE_CHANNEL_NOT_FOUND");await Zg(K)},leave:async()=>{await Sp()},setMuted:G=>Wo(!!G),setDeafened:G=>Ko(!!G),toggleScreenShare:async()=>{await wp()},onStateChange:G=>{if(typeof G!="function")return()=>{};const K=Y=>{try{G((Y==null?void 0:Y.detail)||{})}catch{}};return window.addEventListener("opencom-voice-state-change",K),()=>window.removeEventListener("opencom-voice-state-change",K)}}};await Promise.resolve(M(A))}finally{URL.revokeObjectURL(E)}}x.useEffect(()=>{if(!r)return;[...sa.map(a=>({id:a,extensionId:a,extensionName:a,devUrl:null})),...Di?ia.map((a,d)=>({id:`dev:${a}`,extensionId:`dev-extension-${d+1}`,extensionName:`Developer Extension ${d+1}`,devUrl:a})):[]].forEach(a=>{yg.current.has(a.id)||(yg.current.add(a.id),Zu(d=>({...d,[a.id]:"loading"})),IC(a).then(()=>Zu(d=>({...d,[a.id]:"loaded"}))).catch(d=>Zu(m=>({...m,[a.id]:`error:${d.message}`}))))})},[r,sa,Di,ia,l]);function jC(s,a){_C(d=>a?d.includes(s)?d:[...d,s]:d.filter(m=>m!==s))}function NC(){const s=ug.trim();s&&(dg(a=>a.includes(s)?a:[...a,s]),pg(""))}x.useEffect(()=>{if(!r)return;const s=new Set;((U==null?void 0:U.members)||[]).forEach(d=>d.id&&s.add(d.id)),X.forEach(d=>{const m=d.author_id||d.authorId;m&&s.add(m)}),l!=null&&l.id&&s.add(l.id);const a=[...s].filter(d=>!As[d]&&!Au.current.has(d));a.length!==0&&(a.forEach(d=>Au.current.add(d)),Promise.all(a.map(d=>fetch(`${fn}/v1/users/${d}/profile`,{headers:{Authorization:`Bearer ${r}`}}).then(m=>m.ok?m.json():null).catch(()=>null))).then(d=>{a.forEach(m=>Au.current.delete(m)),Ou(m=>{const _={...m};return a.forEach((E,T)=>{const M=d[T];M&&(M.username!=null||M.displayName!=null||M.pfpUrl!=null)&&(_[E]={username:M.username??M.displayName??E,displayName:M.displayName??M.username??E,pfpUrl:M.pfpUrl??null})}),_})}))},[r,U==null?void 0:U.members,X,l==null?void 0:l.id]),x.useEffect(()=>{!(l!=null&&l.id)||!ne||Ou(s=>({...s,[l.id]:{username:ne.username??l.username??l.id,displayName:ne.displayName??ne.username??l.username??l.id,pfpUrl:ne.pfpUrl??null}}))},[l==null?void 0:l.id,l==null?void 0:l.username,ne==null?void 0:ne.username,ne==null?void 0:ne.displayName,ne==null?void 0:ne.pfpUrl]);const j=x.useMemo(()=>k.find(s=>s.id===F)||null,[k,F]),br=x.useMemo(()=>O.find(s=>s.id===z)||null,[O,z]),Yt=x.useMemo(()=>{var s;return z||(br==null?void 0:br.id)||((s=U==null?void 0:U.guild)==null?void 0:s.id)||(j==null?void 0:j.defaultGuildId)||""},[z,br==null?void 0:br.id,(fv=U==null?void 0:U.guild)==null?void 0:fv.id,j==null?void 0:j.defaultGuildId]),Jt=qn.channelId,Ge=qn.guildId,ln=!!Jt,Yr=x.useMemo(()=>k.find(s=>s.defaultGuildId===Ge)||null,[k,Ge]),Xn=x.useMemo(()=>Yr!=null&&Yr.baseUrl&&(Yr!=null&&Yr.membershipToken)?Yr:j,[Yr,j]),Jr=!!(gC&&(j!=null&&j.id)&&vC===j.id),Bs=(U==null?void 0:U.channels)||[],Sg=x.useMemo(()=>{if(!Jt)return"";const s=Bs.find(a=>a.id===Jt);return(s==null?void 0:s.name)||Jt},[Bs,Jt]),Ui=x.useMemo(()=>Bs.find(s=>s.id===te)||null,[Bs,te]),Ue=x.useMemo(()=>xt.find(s=>s.id===xe)||null,[xt,xe]),up=x.useMemo(()=>{var m;const s=(U==null?void 0:U.roles)||[],a=new Set(((m=U==null?void 0:U.me)==null?void 0:m.roleIds)||[]);let d=0n;for(const _ of s)_&&(_.is_everyone||a.has(_.id))&&(d|=hR(_.permissions));return d},[U==null?void 0:U.roles,(hv=U==null?void 0:U.me)==null?void 0:hv.roleIds]),Ft=x.useMemo(()=>s=>(up&or.ADMINISTRATOR)===or.ADMINISTRATOR?!0:(up&s)===s,[up]),Pe=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.MANAGE_CHANNELS)||Ft(or.MANAGE_ROLES):!1,[j,Ft]),pa=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.KICK_MEMBERS):!1,[j,Ft]),qr=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.BAN_MEMBERS):!1,[j,Ft]),PC=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.MUTE_MEMBERS):!1,[j,Ft]),LC=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.DEAFEN_MEMBERS):!1,[j,Ft]),DC=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||Ft(or.MOVE_MEMBERS):!1,[j,Ft]),MC=x.useMemo(()=>j?(j.roles||[]).includes("owner")||(j.roles||[]).includes("platform_admin")||(j.roles||[]).includes("admin")||(j.roles||[]).includes("server_admin")||Ft(or.MANAGE_CHANNELS):!1,[j,Ft]),pp=pa||qr,fa=!!(Ke!=null&&Ke.active||ne!=null&&ne.boostActive||(mv=(ml=ne==null?void 0:ne.badges)==null?void 0:ml.includes)!=null&&mv.call(ml,"boost")),OC=x.useMemo(()=>Math.max(85,Math.min(130,Math.round(pu.width/1920*115))),[pu.width]),el=uu?OC:gm,AC=x.useMemo(()=>({...ne||{},displayName:typeof(_e==null?void 0:_e.displayName)=="string"?_e.displayName:(ne==null?void 0:ne.displayName)??"",bio:typeof(_e==null?void 0:_e.bio)=="string"?_e.bio:(ne==null?void 0:ne.bio)??"",pfpUrl:typeof(_e==null?void 0:_e.pfpUrl)=="string"?_e.pfpUrl:(ne==null?void 0:ne.pfpUrl)??"",bannerUrl:typeof(_e==null?void 0:_e.bannerUrl)=="string"?_e.bannerUrl:(ne==null?void 0:ne.bannerUrl)??"",fullProfile:ce}),[ne,_e,ce]),rt=x.useMemo(()=>((ce==null?void 0:ce.elements)||[]).find(s=>s.id===Vr)||null,[ce==null?void 0:ce.elements,Vr]),_g=x.useMemo(()=>k.some(s=>{const a=Array.isArray(s==null?void 0:s.roles)?s.roles:[];return a.includes("owner")||a.includes("platform_admin")||a.includes("admin")||a.includes("server_admin")}),[k]),$i=x.useMemo(()=>[...Bs||[]].filter(Boolean).sort((s,a)=>(s.position??0)-(a.position??0)),[Bs]),ha=x.useMemo(()=>$i.filter(s=>s&&s.type==="category"),[$i]),xg=x.useMemo(()=>{const s=new Map;for(const a of(U==null?void 0:U.emotes)||[]){const d=String((a==null?void 0:a.name)||"").toLowerCase();d&&s.set(d,a)}return s},[U==null?void 0:U.emotes]),tl=x.useMemo(()=>{const s=tt.trim().toLowerCase();return s?_t.filter(a=>a.username.toLowerCase().includes(s)||a.id.includes(s)):_t},[tt,_t]),Cg=x.useMemo(()=>{var d;const s=(U==null?void 0:U.members)||[];if(s.length)return s;const a=new Map;for(const m of X){const _=m.author_id||m.authorId;!_||a.has(_)||a.set(_,{id:_,username:m.username||_,status:"offline",pfp_url:m.pfp_url||null,roleIds:[]})}return l!=null&&l.id&&!a.has(l.id)&&a.set(l.id,{id:l.id,username:l.username||l.id,status:"offline",pfp_url:(ne==null?void 0:ne.pfpUrl)||null,roleIds:((d=U==null?void 0:U.me)==null?void 0:d.roleIds)||[]}),Array.from(a.values())},[U,X,l,ne]),Tt=x.useMemo(()=>Cg.map(s=>{var a,d,m;return{...s,username:((a=As[s.id])==null?void 0:a.displayName)||((d=As[s.id])==null?void 0:d.username)||s.username,pfp_url:((m=As[s.id])==null?void 0:m.pfpUrl)??s.pfp_url}}),[Cg,As]),nl=x.useMemo(()=>{const s=lf(ae);if(!s||v!=="servers")return[];const a=["everyone",...Tt.map(m=>m.username||"")].map(m=>m.trim()).filter(Boolean),d=Array.from(new Set(a));return s.query?d.filter(m=>m.toLowerCase().startsWith(s.query)).slice(0,8):d.slice(0,8)},[ae,v,Tt]),Fi=x.useMemo(()=>v!=="servers"?null:xR(ae),[ae,v]),$n=x.useMemo(()=>{if(Fi==null)return[];const s=[...Wc].sort((a,d)=>a.name.localeCompare(d.name));return Fi?s.filter(a=>a.name.toLowerCase().includes(Fi)).slice(0,10):s.slice(0,10)},[Fi,Wc]),rl=Fi!=null,UC=x.useMemo(()=>{const s=new Map;for(const a of Tt)a!=null&&a.id&&(s.set(String(a.id).toLowerCase(),a),a.username&&s.set(String(a.username).toLowerCase(),a));return s},[Tt]),ma=x.useMemo(()=>new Map(Tt.map(s=>[s.id,s.username])),[Tt]),Zn=x.useMemo(()=>{const s=(U==null?void 0:U.voiceStates)||[];if(!z)return s;const a=Us[z]||{};if(!Object.keys(a).length)return s;const d=new Map(s.map(m=>[m.userId,m]));for(const[m,_]of Object.entries(a))_!=null&&_.channelId?d.set(m,{userId:m,channelId:_.channelId,muted:!!_.muted,deafened:!!_.deafened}):d.delete(m);return Array.from(d.values())},[U==null?void 0:U.voiceStates,Us,z]),fp=x.useMemo(()=>{var a;if(!(l!=null&&l.id)||!Ge||!Jt)return!1;const s=(a=Us[Ge])==null?void 0:a[l.id];if(s!=null&&s.channelId)return s.channelId===Jt;if(z===Ge){const d=Zn.find(m=>m.userId===l.id);return(d==null?void 0:d.channelId)===Jt}return!1},[l==null?void 0:l.id,Ge,Jt,Us,z,Zn]),sl=x.useMemo(()=>{var a;const s=new Map;for(const d of Zn)!(d!=null&&d.channelId)||!(d!=null&&d.userId)||(s.has(d.channelId)||s.set(d.channelId,[]),s.get(d.channelId).push({userId:d.userId,username:ma.get(d.userId)||d.userId,pfp_url:((a=Tt.find(m=>m.id===d.userId))==null?void 0:a.pfp_url)||null,muted:!!d.muted,deafened:!!d.deafened}));return s},[Zn,ma,Tt]),bg=x.useMemo(()=>Object.values(og),[og]),$C=x.useMemo(()=>{if(!z)return{};const s=bn==null?void 0:bn[z];return s&&typeof s=="object"?s:{}},[bn,z]),Eg=x.useMemo(()=>{const s=ha.map(d=>({category:d,channels:$i.filter(m=>m.parent_id===d.id&&m.type!=="category")})),a=$i.filter(d=>!d.parent_id&&d.type!=="category");return[...s,...a.length?[{category:{id:"uncategorized",name:"Channels"},channels:a}]:[]]},[ha,$i]),FC=x.useMemo(()=>zw(X,s=>{const a=s.author_id||s.authorId;return ma.get(a)||a||"Unknown"},s=>s.created_at||s.createdAt,s=>s.author_id||s.authorId||"unknown",s=>{var d;const a=s.author_id||s.authorId;return((d=As[a])==null?void 0:d.pfpUrl)??s.pfp_url??null}),[X,ma,As]),BC=x.useMemo(()=>zw((Ue==null?void 0:Ue.messages)||[],s=>s.author||"Unknown",s=>s.createdAt,s=>s.authorId||"unknown",s=>s.pfp_url||null),[Ue]),il=x.useMemo(()=>ku[te]||[],[ku,te]),ol=x.useMemo(()=>Ic[xe]||[],[Ic,xe]),zC=x.useMemo(()=>{const s=new Map;for(const a of Zn||[])a!=null&&a.userId&&s.set(a.userId,a);return s},[Zn]);function kg(s){const a=String(s||"").trim(),d=$C[a]||{},m=Number(d.volume);return{muted:!!d.muted,volume:Number.isFinite(m)?Math.max(0,Math.min(100,m)):100}}function Tg(s,a={}){const d=String(s||"").trim();!d||!z||yC(m=>{const _=(m==null?void 0:m[z])||{},E=_[d]||{muted:!1,volume:100},T={muted:a.muted===void 0?!!E.muted:!!a.muted,volume:a.volume===void 0?Number.isFinite(Number(E.volume))?Math.max(0,Math.min(100,Number(E.volume))):100:Math.max(0,Math.min(100,Number(a.volume)))};return{...m||{},[z]:{..._,[d]:T}}})}async function VC(s){const a=kg(s),d=await Fs("Set local user volume (0-100):",String(a.volume));if(d==null)return;const m=Number(d);if(!Number.isFinite(m)){w("Invalid volume value.");return}const _=Math.max(0,Math.min(100,Math.round(m)));Tg(s,{volume:_}),w(`Local voice volume set to ${_}%.`)}const Rg=x.useMemo(()=>{if(!F)return{mode:"core",customUrl:""};const s=ag[F]||{};return{mode:s.mode==="server"?"server":"core",customUrl:typeof s.customUrl=="string"?s.customUrl:""}},[F,ag]);async function Ig(s=r){var T;if(!s)return;const[a,d,m,_]=await Promise.all([le("/v1/social/friends",{headers:{Authorization:`Bearer ${s}`}}),le("/v1/social/dms",{headers:{Authorization:`Bearer ${s}`}}),le("/v1/social/requests",{headers:{Authorization:`Bearer ${s}`}}),le("/v1/social/settings",{headers:{Authorization:`Bearer ${s}`}})]);Ts(a.friends||[]);let E=[];if(yr(M=>{const A=new Map(M.map(G=>[G.id,G]));return E=(d.dms||[]).map(G=>{var K;return{...G,messages:((K=A.get(G.id))==null?void 0:K.messages)||[]}}),E}),!E.some(M=>M.id===xe)){const M=E.find(G=>G.messages&&G.messages.length>0),A=(M==null?void 0:M.id)||((T=E[0])==null?void 0:T.id)||"";A&&(wr(A),localStorage.setItem(of,A))}_u({incoming:m.incoming||[],outgoing:m.outgoing||[]}),Ux(_.allowFriendRequests!==!1)}x.useEffect(()=>{r?localStorage.setItem(Qa,r):localStorage.removeItem(Qa)},[r]),x.useEffect(()=>{let s=!1;const a=Bw();if(!(a!=null&&a.getSession)){cp.current=!0;return}return a.getSession().then(d=>{if(s||!d)return;const m=typeof d.accessToken=="string"?d.accessToken:"",_=typeof d.refreshToken=="string"?d.refreshToken:"";m&&!r&&i(m),_&&!c&&u(_)}).catch(()=>{}).finally(()=>{cp.current=!0}),()=>{s=!0}},[]),x.useEffect(()=>{var s,a;try{(a=(s=window.opencomDesktopBridge)==null?void 0:s.setPresenceAuth)==null||a.call(s,{accessToken:r||"",coreApi:fn})}catch{}},[r]),x.useEffect(()=>{r||!c||ah().then(s=>{s!=null&&s.accessToken&&(i(s.accessToken),s.refreshToken&&u(s.refreshToken))}).catch(()=>{})},[r,c]);const jg=x.useMemo(()=>{var s;return JSON.stringify((l!=null&&l.id?(s=Bc[l.id])==null?void 0:s.richPresence:null)||null)},[l==null?void 0:l.id,Bc]);x.useEffect(()=>{if(!(l!=null&&l.id))return;let s=null;try{s=JSON.parse(jg)}catch{}At(Hw(s))},[l==null?void 0:l.id,jg]),x.useEffect(()=>{c?localStorage.setItem(Ya,c):localStorage.removeItem(Ya)},[c]),x.useEffect(()=>{const s=Bw();s!=null&&s.setSession&&cp.current&&s.setSession({accessToken:r||"",refreshToken:c||""}).catch(()=>{})},[r,c]),x.useEffect(()=>{const s=d=>{var E,T;const m=((E=d==null?void 0:d.detail)==null?void 0:E.accessToken)||"",_=((T=d==null?void 0:d.detail)==null?void 0:T.refreshToken)||"";m&&i(m),_&&u(_)},a=d=>{var E,T;const m=(E=d==null?void 0:d.detail)==null?void 0:E.serverId,_=(T=d==null?void 0:d.detail)==null?void 0:T.membershipToken;!m||!_||I(M=>M.map(A=>A.id===m?{...A,membershipToken:_}:A))};return window.addEventListener("opencom-access-token-refresh",s),window.addEventListener("opencom-membership-token-refresh",a),()=>{window.removeEventListener("opencom-access-token-refresh",s),window.removeEventListener("opencom-membership-token-refresh",a)}},[]),x.useEffect(()=>{var d;if(r)return;const s=so(`opencom_friends_${$s}`,[]),a=so(`opencom_dms_${$s}`,[]);Ts(s),yr(a),a.some(m=>m.id===xe)||wr(((d=a[0])==null?void 0:d.id)||"")},[$s,r]),x.useEffect(()=>{localStorage.setItem(`opencom_friends_${$s}`,JSON.stringify(_t))},[_t,$s]),x.useEffect(()=>{localStorage.setItem(`opencom_dms_${$s}`,JSON.stringify(xt))},[xt,$s]),x.useEffect(()=>{if(!P)return;const s=window.setTimeout(()=>w(""),4500);return()=>window.clearTimeout(s)},[P]),x.useEffect(()=>{localStorage.setItem(kw,On)},[On]),x.useEffect(()=>{localStorage.setItem(Tw,JSON.stringify(Ic))},[Ic]),x.useEffect(()=>{localStorage.setItem(Dw,JSON.stringify(bn||{}))},[bn]),x.useEffect(()=>{xe&&localStorage.setItem(of,xe),Nc(null)},[xe]),x.useEffect(()=>{const s=()=>Lx({width:window.innerWidth,height:window.innerHeight});return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),x.useEffect(()=>{if(!Dm)return;const s=d=>{const m=jc?da.current.x-d.clientX:d.clientX-da.current.x,_=jc?da.current.y-d.clientY:d.clientY-da.current.y,E=Math.max(8,Math.min(window.innerWidth-340,m)),T=Math.max(8,Math.min(window.innerHeight-280,_));eC({x:E,y:T})},a=()=>Mm(!1);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",a)}},[Dm,jc]),x.useEffect(()=>{if(!_c)return;const s=d=>{const m=xc.current;if(!m)return;const _=m.getBoundingClientRect();if(!_.width||!_.height)return;const E=(d.clientX-_.left)/_.width*100,T=(d.clientY-_.top)/_.height*100,M=Math.max(0,Math.min(100,E-fu.current.x)),A=Math.max(0,Math.min(100,T-fu.current.y));mp(_c,{x:M,y:A})},a=()=>hm("");return window.addEventListener("mousemove",s),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",a)}},[_c,ce.elements]),x.useEffect(()=>{const s=(ce==null?void 0:ce.elements)||[];if(!s.length){Vr&&Is("");return}(!Vr||!s.some(a=>a.id===Vr))&&Is(s[0].id)},[ce==null?void 0:ce.elements,Vr]),x.useEffect(()=>{const s=()=>{bt(null),an(null),ct(null),An(null),Un(null),Ls||Os(null)},a=d=>{d.key==="Escape"&&(bt(null),an(null),ct(null),An(null),Un(null),Os(null),Ct(!1))};return window.addEventListener("click",s),window.addEventListener("keydown",a),()=>{window.removeEventListener("click",s),window.removeEventListener("keydown",a)}},[Ls]),x.useEffect(()=>{const s="invert",a=d=>{if(!(d!=null&&d.key)||d.ctrlKey||d.metaKey||d.altKey)return;const m=String(d.key).toLowerCase();if(!/^[a-z]$/.test(m)){Zc.current="";return}const _=(Zc.current+m).slice(-s.length);Zc.current=_,_===s&&(tC(E=>{const T=!E;return w(T?"Easter egg enabled: profile drag is inverted.":"Easter egg disabled: profile drag restored."),T}),Zc.current="")};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),x.useEffect(()=>{const s=d=>{if(!d)return!1;const m=String(d.tagName||"").toLowerCase();return m==="input"||m==="textarea"||m==="select"||!!d.isContentEditable},a=d=>{if(!(d.ctrlKey||d.metaKey)||!d.shiftKey||s(d.target))return;const m=String(d.key||"").toLowerCase();m==="m"?(d.preventDefault(),Wo(_=>!_)):m==="d"?(d.preventDefault(),Ko(_=>!_)):m==="v"?(d.preventDefault(),ln&&wp().catch(()=>{})):m==="x"?(d.preventDefault(),ln&&Sp().catch(()=>{})):m===","&&(d.preventDefault(),Ct(!0))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[ln]),x.useEffect(()=>{!Qc.current||v!=="servers"||Qc.current.scrollTo({top:Qc.current.scrollHeight,behavior:"smooth"})},[X,v]),x.useEffect(()=>{var E,T;if(!ca.current||v!=="dms")return;const s=ca.current;if(xe!==vg.current){vg.current=xe,rp.current=((E=Ue==null?void 0:Ue.messages)==null?void 0:E.length)||0,s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Yc.current=!0;return}const d=s.scrollHeight-s.scrollTop-s.clientHeight<100,m=((T=Ue==null?void 0:Ue.messages)==null?void 0:T.length)||0,_=m>rp.current;_&&d?(s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Yc.current=!0):_&&(Yc.current=!1),rp.current=m},[Ue==null?void 0:Ue.messages,xe,v]),x.useEffect(()=>{if(!ca.current||v!=="dms")return;const s=ca.current,a=()=>{const d=s.scrollHeight-s.scrollTop-s.clientHeight<100;Yc.current=d};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[v,xe]),x.useEffect(()=>{if(!r)return;async function s(){try{const a=await le("/v1/me",{headers:{Authorization:`Bearer ${r}`}});f(a);const[d,m]=await Promise.all([le(`/v1/users/${a.id}/profile`,{headers:{Authorization:`Bearer ${r}`}}),le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})]),_=m.servers||[];vi(d),at(ro(d,d.fullProfile)),_n({displayName:d.displayName||"",bio:d.bio||"",pfpUrl:d.pfpUrl||"",bannerUrl:d.bannerUrl||""}),I(_);try{await Ig(r)}catch{}if(!_.length){q(""),Z(""),H(null),Q([]);return}_.some(E=>E.id===F)||q(_[0].id)}catch(a){const d=String((a==null?void 0:a.message)||"");if(d.includes("UNAUTHORIZED")||d.includes("HTTP_401")||d.includes("INVALID_REFRESH")||d.includes("REFRESH_")){i(""),u(""),I([]),H(null),Q([]),w("Session expired. Please sign in again.");return}w(`Session error: ${a.message}`)}}s()},[r]),x.useEffect(()=>{if(!r||!(l!=null&&l.id)){Vc(!1),kt.current&&(kt.current.close(),kt.current=null),En.current&&(clearInterval(En.current),En.current=null);return}let s=localStorage.getItem(Rw);s||(s="web-"+Math.random().toString(36).slice(2)+"-"+Date.now(),localStorage.setItem(Rw,s));let a=!1,d=!1,m=!1,_=null,E=0,T=0;const M=Nx(jx(),Mw),A=()=>{if(a)return;const K=Math.min(5e3,300*2**Math.min(T,4));T+=1,_=setTimeout(G,K)},G=()=>{if(a||d||!M.length)return;const K=M[E%M.length];E+=1;const Y=new WebSocket(K);kt.current=Y,Y.onopen=()=>{Y.send(JSON.stringify({op:"IDENTIFY",d:{accessToken:r,deviceId:s}}))},Y.onmessage=se=>{var Ce,ee,pe,$e,ke,Qe,ut,Rn,Xr;try{const Se=JSON.parse(se.data);if(Se.op==="HELLO"&&((Ce=Se.d)!=null&&Ce.heartbeat_interval)&&(En.current&&clearInterval(En.current),En.current=setInterval(()=>{var Rt;((Rt=kt.current)==null?void 0:Rt.readyState)===WebSocket.OPEN&&kt.current.send(JSON.stringify({op:"HEARTBEAT"}))},Se.d.heartbeat_interval)),Se.op==="READY"&&(d=!0,m=!0,T=0,Vc(!0),localStorage.setItem(Mw,K),w(""),((ee=kt.current)==null?void 0:ee.readyState)===WebSocket.OPEN&&kt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:On,customStatus:null}}))),Se.op==="DISPATCH"&&Se.t==="PRESENCE_SYNC_REQUEST"&&((pe=kt.current)==null?void 0:pe.readyState)===WebSocket.OPEN&&kt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:np.current,customStatus:null}})),Se.op==="DISPATCH"&&Se.t==="PRESENCE_UPDATE"&&(($e=Se.d)!=null&&$e.userId)&&Ni(Rt=>({...Rt,[Se.d.userId]:{status:Se.d.status??"offline",customStatus:Se.d.customStatus??null,richPresence:Se.d.richPresence??null}})),Se.op==="DISPATCH"&&Se.t==="SOCIAL_DM_MESSAGE_CREATE"&&((ke=Se.d)!=null&&ke.threadId)&&((ut=(Qe=Se.d)==null?void 0:Qe.message)!=null&&ut.id)){const Rt=Se.d.threadId,Le=Se.d.message;yr(er=>{const It=[...er],Zr=It.findIndex(tr=>tr.id===Rt),gl=(tr=[])=>tr.some(de=>de.id===Le.id);if(Zr>=0){const tr=It[Zr];return gl(tr.messages||[])?er:(It[Zr]={...tr,messages:[...tr.messages||[],Le]},It)}return[{id:Rt,participantId:Le.authorId===(l==null?void 0:l.id)?"unknown":Le.authorId,name:Le.authorId===(l==null?void 0:l.id)?"Unknown":Le.author||"Unknown",messages:[Le]},...It]}),Le.authorId&&Le.authorId!==(l==null?void 0:l.id)&&(kR(np.current==="dnd"),Yu({dmId:Rt,at:Date.now()}))}if(Se.op==="DISPATCH"&&Se.t==="SOCIAL_DM_MESSAGE_DELETE"&&((Rn=Se.d)!=null&&Rn.threadId)&&((Xr=Se.d)!=null&&Xr.messageId)){const Rt=Se.d.threadId,Le=Se.d.messageId;yr(er=>er.map(It=>It.id===Rt?{...It,messages:(It.messages||[]).filter(Zr=>Zr.id!==Le)}:It))}}catch{}},Y.onclose=()=>{a||(Vc(!1),kt.current=null,En.current&&(clearInterval(En.current),En.current=null),d=!1,yp("VOICE_GATEWAY_CLOSED"),A(),w(m?"Gateway disconnected. Reconnecting...":"Gateway websocket unavailable. Check DNS/TLS or set VITE_CORE_GATEWAY_URL."))},Y.onerror=()=>{}};return G(),()=>{a=!0,_&&clearTimeout(_),Vc(!1),En.current&&clearInterval(En.current),En.current=null,kt.current&&kt.current.close(),kt.current=null}},[r,l==null?void 0:l.id]),x.useEffect(()=>{var s;!r||!(l!=null&&l.id)||((s=kt.current)==null?void 0:s.readyState)!==WebSocket.OPEN||kt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:On,customStatus:null}}))},[On,r,l==null?void 0:l.id]),x.useEffect(()=>{const s=Xn;if(!(s!=null&&s.baseUrl)||!(s!=null&&s.membershipToken)){if(oa.current=[],cn.current=!1,Pi(!1),Li(""),Ut.current&&(clearInterval(Ut.current),Ut.current=null),Xe.current){try{Xe.current.close()}catch{}Xe.current=null}return}if(cg[s.id]){if(oa.current=[],cn.current=!1,Pi(!1),Li(""),Ut.current&&(clearInterval(Ut.current),Ut.current=null),Xe.current){try{Xe.current.close()}catch{}Xe.current=null}return}const a=yR(SR(s.baseUrl,!0),Ow);if(oa.current=a,!a.length){Pi(!1),Li("");return}let d=!1,m=!1,_=!1,E=null,T=0,M=0,A=null;const G=ee=>{var Qe;if(Ai.current!==s.id)return;const pe=ee.channels||[];if(H(ee),pe.some(ut=>ut.id===Kr.current&&ut.type==="text"))return;const ke=((Qe=pe.find(ut=>ut.type==="text"))==null?void 0:Qe.id)||"";me(ke)},K=()=>{if(Ai.current!==s.id)return;const ee=Xc.current;ee&&ue(s.baseUrl,`/v1/guilds/${ee}/state`,s.membershipToken).then(pe=>{d||G(pe)}).catch(()=>{})},Y=(ee=150)=>{A&&clearTimeout(A),A=setTimeout(K,ee)},se=()=>{if(d)return;const ee=Math.min(5e3,300*2**Math.min(M,4));M+=1,E=setTimeout(Ce,ee)},Ce=()=>{if(d||!a.length)return;const ee=a[T%a.length];T+=1;const pe=new WebSocket(ee);Xe.current=pe,pe.onopen=()=>{w(""),pe.send(JSON.stringify({op:"IDENTIFY",d:{membershipToken:s.membershipToken}}))},pe.onmessage=$e=>{var ke,Qe,ut,Rn,Xr,Se,Rt,Le,er,It,Zr,gl,tr;try{const de=JSON.parse($e.data);if(J0(de),de.op==="HELLO"&&((ke=de.d)!=null&&ke.heartbeat_interval)){Ut.current&&clearInterval(Ut.current),Ut.current=setInterval(()=>{var De;((De=Xe.current)==null?void 0:De.readyState)===WebSocket.OPEN&&Xe.current.send(JSON.stringify({op:"HEARTBEAT"}))},de.d.heartbeat_interval);return}if(de.op==="READY"){m=!0,_=!0,M=0,cn.current=!0,Pi(!0),Li(s.id||""),localStorage.setItem(Ow,ee),Ai.current===s.id&&Xc.current&&pe.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:Xc.current}})),Ai.current===s.id&&Kr.current&&pe.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:Kr.current}}));return}if(de.op==="ERROR"&&((Qe=de.d)!=null&&Qe.error)){if(typeof de.d.error=="string"&&de.d.error.startsWith("VOICE_UPSTREAM_UNAVAILABLE")&&(s!=null&&s.id)){SC(De=>De[s.id]?De:{...De,[s.id]:!0}),w("Realtime voice gateway unavailable for this server. Falling back to REST voice controls.");try{pe.close()}catch{}return}w(`Voice gateway error: ${de.d.error}`);return}if(de.op==="DISPATCH"&&typeof de.t=="string"){if(de.t==="MESSAGE_CREATE"){const De=((ut=de.d)==null?void 0:ut.channelId)||"",Ie=((Rn=de.d)==null?void 0:Rn.message)||null,qt=((Xr=de.d)==null?void 0:Xr.messageDelete)||null;De&&(qt!=null&&qt.id)&&De===Kr.current&&Q(pt=>pt.filter(nr=>nr.id!==qt.id)),De&&Ie&&De===Kr.current?Q(pt=>{if(pt.some(cb=>cb.id===Ie.id))return pt;const nr={id:Ie.id,author_id:Ie.authorId,authorId:Ie.authorId,content:Ie.content||"",embeds:Ie.embeds||[],linkEmbeds:Ie.linkEmbeds||[],attachments:Ie.attachments||[],mentionEveryone:!!Ie.mentionEveryone,mentions:Ie.mentions||[],created_at:Ie.createdAt,createdAt:Ie.createdAt};return[...pt,nr]}):De&&Ie&&(s!=null&&s.id)&&Mu(pt=>({...pt,[s.id]:(pt[s.id]||0)+1}));return}if(de.t==="MESSAGE_MENTION"&&(s!=null&&s.id)){const De=((Se=de.d)==null?void 0:Se.channelId)||"";(!Kr.current||De!==Kr.current)&&Mu(Ie=>({...Ie,[s.id]:(Ie[s.id]||0)+1}));return}if(de.t==="VOICE_STATE_UPDATE"&&((Rt=de.d)!=null&&Rt.guildId)&&((Le=de.d)!=null&&Le.userId)){const De=de.d.guildId,Ie=de.d.userId,qt=de.d.channelId||null;Ju(pt=>{const nr={...pt[De]||{}};return qt?nr[Ie]={guildId:De,channelId:qt,userId:Ie,muted:!!de.d.muted,deafened:!!de.d.deafened}:delete nr[Ie],{...pt,[De]:nr}})}else if(de.t==="VOICE_STATE_REMOVE"&&((er=de.d)!=null&&er.guildId)&&((It=de.d)!=null&&It.userId)){const De=de.d.guildId,Ie=de.d.userId;Ju(qt=>{var nr;if(!((nr=qt[De])!=null&&nr[Ie]))return qt;const pt={...qt[De]||{}};return delete pt[Ie],{...qt,[De]:pt}})}else if(de.t==="VOICE_SPEAKING"&&((Zr=de.d)!=null&&Zr.guildId)&&((gl=de.d)!=null&&gl.userId)){const De=de.d.guildId,Ie=de.d.userId,qt=!!de.d.speaking;qu(pt=>({...pt,[De]:{...pt[De]||{},[Ie]:qt}}))}Ai.current===s.id&&(de.t==="CHANNEL_CREATE"||de.t==="CHANNEL_UPDATE"||de.t==="CHANNEL_DELETE"||de.t==="CHANNEL_REORDER"||de.t==="ROLE_CREATE"||de.t==="ROLE_UPDATE"||de.t==="ROLE_DELETE"||de.t==="CHANNEL_OVERWRITE_UPDATE"||de.t==="CHANNEL_OVERWRITE_DELETE"||de.t==="CHANNEL_SYNC_PERMISSIONS"||de.t==="GUILD_MEMBER_UPDATE"||de.t==="GUILD_MEMBER_KICK"||de.t==="GUILD_MEMBER_BAN")&&Y(),(tr=$t.current)==null||tr.handleGatewayDispatch(de.t,de.d).catch(()=>{})}}catch{}},pe.onclose=()=>{d||(cn.current=!1,Ut.current&&(clearInterval(Ut.current),Ut.current=null),Xe.current=null,Pi(!1),Li(""),m=!1,yp("VOICE_GATEWAY_CLOSED"),se(),w(_?"Server voice gateway disconnected. Reconnecting...":"Voice gateway unavailable. Check core gateway/proxy configuration."))},pe.onerror=()=>{}};return Ce(),()=>{if(d=!0,E&&clearTimeout(E),A&&clearTimeout(A),cn.current=!1,Pi(!1),Li(""),Ut.current&&(clearInterval(Ut.current),Ut.current=null),Xe.current){try{Xe.current.close()}catch{}Xe.current=null}}},[Xn==null?void 0:Xn.id,Xn==null?void 0:Xn.baseUrl,Xn==null?void 0:Xn.membershipToken,cg]),x.useEffect(()=>{if(!z||!te||!Jr)return;const s=Xe.current;!s||s.readyState!==WebSocket.OPEN||!cn.current||(s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:z}})),s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:te}})))},[z,te,Jr]),x.useEffect(()=>{var a;if(v!=="servers"||!z||!((a=U==null?void 0:U.channels)!=null&&a.length)||!Jr)return;const s=Xe.current;if(!(!s||s.readyState!==WebSocket.OPEN||!cn.current))for(const d of U.channels)!(d!=null&&d.id)||d.type!=="text"||s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:d.id}}))},[v,z,U==null?void 0:U.channels,Jr]),x.useEffect(()=>{F&&Mu(s=>{if(!s[F])return s;const a={...s};return delete a[F],a})},[F]),x.useEffect(()=>{if(!r)return;const s=new Set;((U==null?void 0:U.members)||[]).forEach(m=>m.id&&s.add(m.id)),(_t||[]).forEach(m=>m.id&&s.add(m.id));const a=[...s];if(a.length===0)return;const d=new URLSearchParams({userIds:a.join(",")});fetch(`${fn}/v1/presence?${d}`,{headers:{Authorization:`Bearer ${r}`}}).then(m=>m.ok?m.json():{}).then(m=>{m&&typeof m=="object"&&Ni(_=>({..._,...m}))}).catch(()=>{})},[r,U==null?void 0:U.members,_t]),x.useEffect(()=>{const s=lR(),a=id(s||Jn||"");if(a){if(Gr!==a&&Go(a),Jn!==a&&vr(a),s&&!Sn&&ks(!0),!r){s&&(w("Log in to join this server invite."),Tn(Ws,{replace:!0}));return}Sn&&qc.current!==a&&(qc.current=a,ks(!1),ll(a).catch(()=>{}).finally(()=>{qc.current===a&&(qc.current="")}),_r!==cr&&Tn(cr,{replace:!0}))}},[r,Jn,Sn,Gr,_r]),x.useEffect(()=>{const s=dR();if(!s)return;Dc(s),r&&Mg(s),Tn(r?cr:Ws,{replace:!0})},[r]),x.useEffect(()=>{var d;if(!r)return;const s=[...X||[],...((d=xt.find(m=>m.id===xe))==null?void 0:d.messages)||[]],a=new Set;for(const m of s){for(const _ of Qw((m==null?void 0:m.content)||""))a.add(_);if(Array.isArray(m==null?void 0:m.linkEmbeds))for(const _ of m.linkEmbeds)_!=null&&_.url&&a.add(_.url)}for(const m of a)ea[m]===void 0&&(sp.current.has(m)||(sp.current.add(m),le(`/v1/link-preview?url=${encodeURIComponent(m)}`,{headers:{Authorization:`Bearer ${r}`}}).then(_=>{Gm(E=>({...E,[m]:_||null}))}).catch(()=>{Gm(_=>({..._,[m]:null}))}).finally(()=>{sp.current.delete(m)})))},[r,X,xt,xe,ea]),x.useEffect(()=>{if(!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken))return;const s=[];for(const a of X||[])for(const d of(a==null?void 0:a.attachments)||[])!(d!=null&&d.id)||!xp(d.contentType)||ta[d.id]||Jc.current.has(d.id)||s.push(d);for(const a of s){Jc.current.add(a.id);const d=String(a.url||""),m=d.startsWith("http")?d:`${j.baseUrl}${d.startsWith("/")?"":"/"}${d}`;fetch(m,{headers:{Authorization:`Bearer ${j.membershipToken}`}}).then(_=>_.ok?_.blob():null).then(_=>{if(!_||!xp(_.type||a.contentType||""))return;const E=URL.createObjectURL(_);Hm(T=>{const M=T[a.id];return M&&URL.revokeObjectURL(E),M?T:{...T,[a.id]:E}})}).catch(()=>{}).finally(()=>{Jc.current.delete(a.id)})}},[X,j==null?void 0:j.baseUrl,j==null?void 0:j.membershipToken,ta]),x.useEffect(()=>{const s=ip.current||{};Object.values(s).forEach(a=>{try{URL.revokeObjectURL(a)}catch{}}),Jc.current.clear(),Hm({})},[F]),x.useEffect(()=>()=>{const s=ip.current||{};Object.values(s).forEach(a=>{try{URL.revokeObjectURL(a)}catch{}})},[]),x.useEffect(()=>{if(v!=="servers"||!j){L([]),v!=="servers"&&(H(null),Q([]));return}ue(j.baseUrl,"/v1/guilds",j.membershipToken).then(s=>{const a=s||[];if(L(a),!a.length){Z(""),H(null);return}a.some(m=>m.id===z)||Z(a[0].id)}).catch(s=>{L([]),H(null),w(`Workspace list failed: ${s.message}`)})},[j,z,v]),x.useEffect(()=>{if(v!=="servers"||!j||!z)return;let s=!1;const a=()=>ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken).then(m=>{var M;if(s)return;const _=m.channels||[];if(H(m),_.some(A=>A.id===te&&A.type==="text"))return;const T=((M=_.find(A=>A.type==="text"))==null?void 0:M.id)||"";me(T)}).catch(m=>{s||(H(null),me(""),Q([]),w(`Workspace state failed: ${m.message}`))});a();const d=Jr?null:window.setInterval(a,3e3);return()=>{s=!0,d&&window.clearInterval(d)}},[j,z,v,te,Jr]),x.useEffect(()=>{v!=="dms"||!xe||!r||le(`/v1/social/dms/${xe}/messages`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{const a=s.messages||[];yr(d=>d.map(m=>m.id===xe?{...m,messages:a}:m))}).catch(()=>{})},[xe,v,r]),x.useEffect(()=>{if(v==="dms"){if(!xt.length){wr("");return}(!xe||!xt.some(s=>s.id===xe))&&wr(xt[0].id)}},[v,xt,xe]),x.useEffect(()=>{if(!ra)return;const s=setTimeout(()=>Yu(null),4e3);return()=>clearTimeout(s)},[ra]),x.useEffect(()=>{var d,m,_;const s=ln&&fp&&!!Ge&&!!cn.current&&((d=Xe.current)==null?void 0:d.readyState)===WebSocket.OPEN;if(!ln||!fp||!Ge||on||Kt||!((m=navigator.mediaDevices)!=null&&m.getUserMedia)||!s){const E=tp.current;E.timer&&clearInterval(E.timer),E.timer=null,E.stream&&E.stream!==((_=$t.current)==null?void 0:_.getLocalStream())&&E.stream.getTracks().forEach(T=>T.stop()),E.stream=null,E.audioCtx&&E.audioCtx.close().catch(()=>{}),E.audioCtx=null,E.analyser=null,E.lastSpeaking=!1,Ge&&(l!=null&&l.id)&&qu(T=>({...T,[Ge]:{...T[Ge]||{},[l.id]:!1}})),ln&&Ge&&s&&pl("VOICE_SPEAKING",{guildId:Ge,channelId:Jt,speaking:!1}).catch(()=>{});return}let a=!1;return(async()=>{var E;try{const T=((E=$t.current)==null?void 0:E.getLocalStream())||await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!!Ci,autoGainControl:!0,...Sr?{deviceId:{exact:Sr}}:{}}});if(a){T.getTracks().forEach(se=>se.stop());return}const M=new window.AudioContext,A=M.createMediaStreamSource(T),G=M.createAnalyser();G.fftSize=1024,A.connect(G);const K=tp.current;K.stream=T,K.audioCtx=M,K.analyser=G,K.lastSpeaking=!1;const Y=new Uint8Array(G.fftSize);K.timer=setInterval(()=>{var $e;G.getByteTimeDomainData(Y);let se=0;for(let ke=0;ke<Y.length;ke+=1){const Qe=(Y[ke]-128)/128;se+=Qe*Qe}const Ce=Math.sqrt(se/Y.length),ee=.01+(100-Math.max(0,Math.min(100,xi)))/100*.03,pe=Ce>ee;pe!==K.lastSpeaking&&(K.lastSpeaking=pe,Ge&&(l!=null&&l.id)&&qu(ke=>({...ke,[Ge]:{...ke[Ge]||{},[l.id]:pe}})),ln&&Ge&&cn.current&&(($e=Xe.current)==null?void 0:$e.readyState)===WebSocket.OPEN&&pl("VOICE_SPEAKING",{guildId:Ge,channelId:Jt,speaking:pe}).catch(()=>{}))},150)}catch{w("Mic speaking detection unavailable. Check microphone permissions.")}})(),()=>{var T;a=!0;const E=tp.current;E.timer&&clearInterval(E.timer),E.timer=null,E.stream&&E.stream!==((T=$t.current)==null?void 0:T.getLocalStream())&&E.stream.getTracks().forEach(M=>M.stop()),E.stream=null,E.audioCtx&&E.audioCtx.close().catch(()=>{}),E.audioCtx=null,E.analyser=null,E.lastSpeaking=!1}},[ln,fp,Ge,Jt,on,Kt,xi,Sr,Ci,l==null?void 0:l.id]),x.useEffect(()=>{localStorage.setItem(Iw,String(Rc))},[Rc]),x.useEffect(()=>{localStorage.setItem(jw,String(xi))},[xi]),x.useEffect(()=>{localStorage.setItem(Nw,Sr||"")},[Sr]),x.useEffect(()=>{localStorage.setItem(Pw,Hr||"")},[Hr]),x.useEffect(()=>{localStorage.setItem(Lw,Ci?"1":"0")},[Ci]),x.useEffect(()=>{var s;(s=$t.current)==null||s.setMuted(on)},[on]),x.useEffect(()=>{var s;(s=$t.current)==null||s.setDeafened(Kt)},[Kt]),x.useEffect(()=>{var s;(s=$t.current)==null||s.setAudioOutputDevice(Hr)},[Hr]),x.useEffect(()=>{var a;if(!z)return;const s=(bn==null?void 0:bn[z])||{};for(const[d,m]of Object.entries(s))(a=$t.current)==null||a.setUserAudioPreference(d,m)},[z,bn,Kt]),x.useEffect(()=>{ln||Tm(null)},[ln]),x.useEffect(()=>{var d;if(Ne!=="voice"||!Ls||!((d=navigator.mediaDevices)!=null&&d.enumerateDevices))return;let s=!1;return(async()=>{var m,_;try{try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch{}const E=await navigator.mediaDevices.enumerateDevices();if(s)return;const T=E.filter(A=>A.kind==="audioinput"),M=E.filter(A=>A.kind==="audiooutput");Hx(T),Kx(M),!Sr&&((m=T[0])!=null&&m.deviceId)&&Em(T[0].deviceId),!Hr&&((_=M[0])!=null&&_.deviceId)&&km(M[0].deviceId)}catch{s||w("Could not load audio devices. Check browser permissions.")}})(),()=>{s=!0}},[Ne,Ls,Sr,Hr]),x.useEffect(()=>{if(!(l!=null&&l.id))return;let s="",a="";for(const[d,m]of Object.entries(Us||{})){const _=m==null?void 0:m[l.id];if(_!=null&&_.channelId){s=d,a=_.channelId;break}}if(!a){const d=Zn.find(m=>m.userId===l.id);d!=null&&d.channelId&&(s=z||Ge||"",a=d.channelId)}Tc(d=>a?d.guildId===s&&d.channelId===a?d:{guildId:s,channelId:a}:d.guildId&&d.guildId!==z||!d.guildId&&!d.channelId?d:{guildId:"",channelId:""})},[Zn,Us,l==null?void 0:l.id,z,Ge]),x.useEffect(()=>{!r||v!=="friends"&&v!=="dms"||Ig(r).catch(()=>{})},[r,v]),Kr.current=te,Xc.current=z,Ai.current=F,x.useEffect(()=>{window.dispatchEvent(new CustomEvent("opencom-voice-state-change",{detail:{connected:!!qn.channelId,guildId:qn.guildId||"",channelId:qn.channelId||"",muted:!!on,deafened:!!Kt,screenSharing:!!Ns}}))},[qn.guildId,qn.channelId,on,Kt,Ns]),x.useEffect(()=>{if(v!=="servers"||!j||!te){v!=="servers"&&Q([]);return}let s=!1;const a=()=>ue(j.baseUrl,`/v1/channels/${te}/messages`,j.membershipToken).then(m=>{s||(w(""),Q((m.messages||[]).slice().reverse()))}).catch(m=>{var _,E;if(!s){if((_=m==null?void 0:m.message)!=null&&_.startsWith("HTTP_403")){Q([]),w("You no longer have access to that channel."),me("");return}if((E=m==null?void 0:m.message)!=null&&E.startsWith("HTTP_404")){Q([]),w("That channel no longer exists. Switching to an available channel."),me("");return}w(`Message fetch failed: ${m.message}`)}});a();const d=Jr?null:window.setInterval(a,2e3);return()=>{s=!0,d&&window.clearInterval(d)}},[j,te,v,Jr]),x.useEffect(()=>{v!=="servers"||!j||!te||Jg(te).catch(()=>{})},[v,j,te]),x.useEffect(()=>{Es([]),Oi.current&&(Oi.current.value="")},[F,te]),x.useEffect(()=>{if(v!=="servers"||!r||!z||zc)return;let s=!1;const a=()=>{const m=Array.from(new Set(((U==null?void 0:U.members)||[]).map(E=>E==null?void 0:E.id).filter(Boolean)));if(!m.length)return;const _=new URLSearchParams({userIds:m.join(",")});fetch(`${fn}/v1/presence?${_}`,{headers:{Authorization:`Bearer ${r}`}}).then(E=>E.ok?E.json():{}).then(E=>{s||!E||typeof E!="object"||Ni(T=>({...T,...E}))}).catch(()=>{})};a();const d=window.setInterval(a,3e3);return()=>{s=!0,window.clearInterval(d)}},[v,r,z,U==null?void 0:U.members,zc]),x.useEffect(()=>{if(!r||zc||v!=="friends"&&v!=="dms")return;let s=!1;const a=()=>{const m=new Set;(_t||[]).forEach(T=>(T==null?void 0:T.id)&&m.add(T.id)),(xt||[]).forEach(T=>(T==null?void 0:T.participantId)&&m.add(T.participantId));const _=[...m];if(!_.length)return;const E=new URLSearchParams({userIds:_.join(",")});fetch(`${fn}/v1/presence?${E}`,{headers:{Authorization:`Bearer ${r}`}}).then(T=>T.ok?T.json():{}).then(T=>{s||!T||typeof T!="object"||Ni(M=>({...M,...T}))}).catch(()=>{})};a();const d=window.setInterval(a,5e3);return()=>{s=!0,window.clearInterval(d)}},[r,zc,v,_t,xt]),x.useEffect(()=>{const s=new URLSearchParams(window.location.search||""),a=s.get("verifyEmailToken");a&&(Al()===fr&&Tn(Ws,{replace:!0}),w("Verifying your email..."),le("/v1/auth/verify-email",{method:"POST",body:JSON.stringify({token:a})}).then(()=>{g("login"),w("Email verified. You can now log in.")}).catch(d=>{w(`Email verification failed: ${d.message}`)}).finally(()=>{s.delete("verifyEmailToken");const d=s.toString(),m=`${window.location.pathname}${d?`?${d}`:""}${window.location.hash||""}`;window.history.replaceState({},"",m)}))},[]),x.useEffect(()=>{if(!r)return;const s=new URLSearchParams(window.location.search||""),a=s.get("boostGiftCheckout"),d=s.get("giftId"),m=s.get("session_id");if(!a)return;a==="success"&&d&&m?e0(d,m).catch(()=>{}):a==="cancel"&&w("Boost gift checkout canceled."),s.delete("boostGiftCheckout"),s.delete("giftId"),s.delete("session_id");const _=s.toString(),E=`${window.location.pathname}${_?`?${_}`:""}${window.location.hash||""}`;window.history.replaceState({},"",E)},[r]);async function GC(s){s.preventDefault(),w("Authenticating...");try{if(h==="register"){await le("/v1/auth/register",{method:"POST",body:JSON.stringify({email:S,username:C,password:D})}),y(S.trim()),g("login"),B(""),w("Account created. Check your email for a verification link before logging in.");return}const a=await le("/v1/auth/login",{method:"POST",body:JSON.stringify({email:S,password:D})});i(a.accessToken),u(a.refreshToken||""),f(a.user),y(""),w("Authenticated.")}catch(a){if((a==null?void 0:a.message)==="EMAIL_NOT_VERIFIED"){y(S.trim()),w("Auth failed: EMAIL_NOT_VERIFIED. Use the resend button below if needed.");return}if((a==null?void 0:a.message)==="SMTP_NOT_CONFIGURED"){w("Auth failed: SMTP is not configured on the API server, so verification emails cannot be sent yet.");return}if((a==null?void 0:a.message)==="SMTP_AUTH_FAILED"){w("Auth failed: SMTP auth failed. Check Zoho SMTP username/app password.");return}if((a==null?void 0:a.message)==="SMTP_CONNECTION_FAILED"){w("Auth failed: SMTP connection failed. Check server network + SMTP host/port/TLS.");return}w(`Auth failed: ${a.message}`)}}async function HC(){const s=($||S||"").trim();if(!s){w("Enter your email first, then resend verification.");return}w("Sending verification email...");try{await le("/v1/auth/resend-verification",{method:"POST",body:JSON.stringify({email:s})}),y(s),w("If the account exists and is unverified, a new verification email has been sent.")}catch(a){if((a==null?void 0:a.message)==="SMTP_NOT_CONFIGURED"){w("Resend failed: SMTP is not configured on the API server. Set SMTP_* (or Zoho SMTP envs) and restart backend.");return}if((a==null?void 0:a.message)==="SMTP_AUTH_FAILED"){w("Resend failed: SMTP auth failed. Check Zoho username and app password.");return}if((a==null?void 0:a.message)==="SMTP_CONNECTION_FAILED"){w("Resend failed: could not connect to SMTP server. Check host/port/TLS/firewall.");return}w(`Resend failed: ${a.message}`)}}async function WC(s){const d=s.trim().replace(/^\//,"").trim(),[m,..._]=d.split(/\s+/);if(!m)return!1;const E=Wc.find(G=>G.name===m);if(!E)return w(`Unknown command: /${m}`),!0;const T=Array.isArray(E.options)?E.options:[],M=CR(_.join(" ")),A={};try{T.forEach((G,K)=>{const Y=M[K];if((Y==null||Y==="")&&G.required)throw new Error(`Missing required option: ${G.name}`);Y==null||Y===""||(A[G.name]=bR(Y,G.type||"string"))})}catch(G){return w(`/${m}: ${G.message}`),!0}try{V("");const G=await ue(j.baseUrl,`/v1/extensions/commands/${encodeURIComponent(m)}/execute`,j.membershipToken,{method:"POST",body:JSON.stringify({args:A})}),K=G==null?void 0:G.result;if(K&&typeof K=="object"&&(K.content||Array.isArray(K.embeds))){await ue(j.baseUrl,`/v1/channels/${te}/messages`,j.membershipToken,{method:"POST",body:JSON.stringify({content:String(K.content||`/${m}`),embeds:Array.isArray(K.embeds)?K.embeds:[]})});const Y=await ue(j.baseUrl,`/v1/channels/${te}/messages`,j.membershipToken);Q((Y.messages||[]).slice().reverse()),w(`Executed /${m}`)}else w(`Executed /${m}${(G==null?void 0:G.result)!=null?`  ${typeof G.result=="string"?G.result:JSON.stringify(G.result)}`:""}`)}catch(G){V(s),w(`Command failed: ${G.message}`)}return!0}async function KC(s){if(!j||!z||!te||!s)return null;const a=RR(s,"attachment")||s,d=new FormData;d.append("guildId",z),d.append("channelId",te),d.append("file",a,a.name||"upload.bin");const m=await fetch(`${j.baseUrl}/v1/attachments/upload`,{method:"POST",headers:{Authorization:`Bearer ${j.membershipToken}`},body:d});if(!m.ok){const _=await m.json().catch(()=>({}));throw new Error(_.error||`HTTP_${m.status}`)}return m.json()}async function Ng(s,a="files"){const d=Array.from(s||[]).filter(Boolean);if(!d.length)return;const m=Math.max(0,10-wn.length);if(!m){w("You can attach up to 10 files per message.");return}const _=d.slice(0,m);let E=0,T=0;for(const M of _)try{const A=await KC(M);A&&(Es(G=>[...G,A]),E+=1)}catch(A){T+=1,console.warn("Attachment upload failed",A)}if(E>0&&T===0){w(`Attached ${E} file${E===1?"":"s"} from ${a}.`);return}if(E>0){w(`Attached ${E} file${E===1?"":"s"} from ${a}; ${T} failed.`);return}w(`Attachment upload failed from ${a}.`)}async function QC(s){if(!(!(s!=null&&s.url)||!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken)))try{const a=s.url.startsWith("http")?s.url:`${j.baseUrl}${s.url}`,d=await fetch(a,{headers:{Authorization:`Bearer ${j.membershipToken}`}});if(!d.ok){const T=await d.json().catch(()=>({}));throw new Error(T.error||`HTTP_${d.status}`)}const m=await d.blob(),_=URL.createObjectURL(m);if(!window.open(_,"_blank","noopener,noreferrer")){const T=document.createElement("a");T.href=_,T.download=s.fileName||"attachment",T.click()}window.setTimeout(()=>URL.revokeObjectURL(_),6e4)}catch(a){w(`Attachment open failed: ${a.message||"UNKNOWN_ERROR"}`)}}async function Pg(){if(!j||!te||!ae.trim()&&wn.length===0)return;if(ae.trimStart().startsWith("/")){await WC(ae);return}const s=`${na?`> replying to ${na.author}: ${na.content}
`:""}${ae.trim()}`;try{V(""),ie(!1),await ue(j.baseUrl,`/v1/channels/${te}/messages`,j.membershipToken,{method:"POST",body:JSON.stringify({content:s||"Attachment",attachmentIds:wn.map(d=>d.attachmentId||d.id).filter(Boolean)})});const a=await ue(j.baseUrl,`/v1/channels/${te}/messages`,j.membershipToken);Q((a.messages||[]).slice().reverse()),Du(null),Es([]),Oi.current&&(Oi.current.value="")}catch(a){V(s),w(`Send failed: ${a.message}`)}}async function Lg(){if(!Ue||!Sc.trim())return;const s=`${Xo?`> replying to ${Xo.author}: ${Xo.content}
`:""}${Sc.trim()}`;du("");try{await le(`/v1/social/dms/${Ue.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({content:s})});const a=await le(`/v1/social/dms/${Ue.id}/messages`,{headers:{Authorization:`Bearer ${r}`}});yr(d=>d.map(m=>m.id===Ue.id?{...m,messages:a.messages||[]}:m)),Nc(null)}catch(a){du(s),w(`DM send failed: ${a.message}`)}}async function YC(){const s=Br.trim();if(s)try{const a=await le("/v1/social/friends",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({username:s})});if(a.friend&&a.threadId){Ts(_=>[a.friend,..._.filter(E=>E.id!==a.friend.id)]);const m={id:a.threadId,participantId:a.friend.id,name:a.friend.username,messages:[]};yr(_=>[m,..._.filter(E=>E.id!==m.id)]),wr(m.id),w(`You're now connected with ${a.friend.username}.`)}else w("Friend request sent.");const d=await le("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}});_u({incoming:d.incoming||[],outgoing:d.outgoing||[]}),zr(""),Ot("requests")}catch(a){w(`Add friend failed: ${a.message}`)}}async function Dg(s,a){try{await le(`/v1/social/requests/${s}/${a}`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});const[d,m]=await Promise.all([le("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}}),le("/v1/social/friends",{headers:{Authorization:`Bearer ${r}`}})]);_u({incoming:d.incoming||[],outgoing:d.outgoing||[]}),Ts(m.friends||[]),w(a==="accept"?"Friend request accepted.":"Friend request declined.")}catch(d){w(`Request update failed: ${d.message}`)}}async function JC(){if(r)try{const s=await le("/v1/auth/sessions",{headers:{Authorization:`Bearer ${r}`}});lC(s.sessions||[])}catch(s){w(`Could not load sessions: ${s.message}`)}}async function ga(){if(r){Om(!0);try{const s=await le("/v1/billing/boost",{headers:{Authorization:`Bearer ${r}`}});nC(s)}catch(s){w(`Could not load billing status: ${s.message}`)}finally{Om(!1)}}}async function qC(){if(r)try{const s=await le("/v1/billing/boost/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not start checkout: ${s.message}`)}}async function XC(){if(r)try{const s=await le("/v1/billing/boost/portal",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not open billing portal: ${s.message}`)}}async function Bi(){if(r)try{const s=await le("/v1/billing/boost/gifts",{headers:{Authorization:`Bearer ${r}`}});sC(s.gifts||[])}catch(s){w(`Could not load boost gifts: ${s.message}`)}}async function ZC(){if(r){zm(!0);try{const s=await le("/v1/billing/boost/gifts/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});if(s!=null&&s.checkoutUrl){window.location.href=s.checkoutUrl;return}w("Gift checkout URL missing.")}catch(s){w(`Could not start gift checkout: ${s.message}`)}finally{zm(!1)}}}async function e0(s,a){if(!(!r||!s||!a))try{const d=await le("/v1/billing/boost/gifts/complete-purchase",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({giftId:s,sessionId:a})});d!=null&&d.giftCode&&Dc(d.giftCode),await Bi(),Ct(!0),qe("billing"),w("Boost gift purchased. Copy and send your gift link.")}catch(d){w(`Could not complete gift purchase: ${d.message}`)}}async function Mg(s){var d;if(!r)return;const a=oh(s);if(!a){w("Invalid boost gift code/link.");return}Um(!0);try{const m=await le(`/v1/billing/boost/gifts/${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${r}`}});Dc(a),Pu(m),Ri(m),Ct(!0),qe("billing"),w(`Boost gift from ${((d=m==null?void 0:m.from)==null?void 0:d.username)||"someone"} is ready to redeem.`)}catch(m){Pu(null),Ri(null),w(`Could not load boost gift: ${m.message}`)}finally{Um(!1)}}async function t0(s=Nu){if(!r)return;const a=oh(s);if(!a){w("Invalid boost gift code.");return}Fm(!0);try{const d=await le(`/v1/billing/boost/gifts/${encodeURIComponent(a)}/redeem`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});Ri(null),Pu(null),await Promise.all([ga(),Bi()]),w(`Boost gift redeemed (${(d==null?void 0:d.grantDays)||30} days).`)}catch(d){w(`Could not redeem boost gift: ${d.message}`)}finally{Fm(!1)}}function al(s="This action requires OpenCom Boost."){Lc({title:"Hold up",reason:s,cta:"Open Boost Settings"})}function n0(){Lc(null),Ct(!0),qe("billing"),ga().catch(()=>{}),Bi().catch(()=>{})}function r0(s=32){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let d="";for(let m=0;m<s;m++)d+=a.charAt(Math.floor(Math.random()*a.length));return d}function s0(s=8){const a=[];for(let d=0;d<s;d++){let m="";for(let _=0;_<4;_++)m+=Math.floor(Math.random()*1e4).toString().padStart(4,"0"),_<3&&(m+="-");a.push(m)}return a}function i0(){const s=r0(32),a=s0(8);zu(s),Oc(a),Ac(!0),Gu(!1),Vu("");const d="OpenCom",m=(l==null?void 0:l.username)||"user",_=`otpauth://totp/${d}:${m}?secret=${s}&issuer=${d}`,E=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(_)}`;fC(E),w("2FA setup initiated. Scan the QR code with your authenticator app.")}function o0(s,a){if(!s||!a)return!1;const d=s.replace(/\s/g,"").slice(0,6);if(!/^\d{6}$/.test(d))return!1;if(Xm.includes(d))return w("Backup code verified! Removing code from backups."),Oc(m=>m.filter(_=>_!==d)),!0;for(let m=-1;m<=1;m++){const _=Math.floor(Date.now()/3e4)+m;if(a0(a,_)===d)return!0}return!1}function a0(s,a){const d=c0(s),m=new ArrayBuffer(8);return new DataView(m).setBigInt64(0,BigInt(a),!1),l0(d,m)}function c0(s){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let d="";for(let _=0;_<s.length;_++){const E=a.indexOf(s[_]);E<0||(d+=E.toString(2).padStart(5,"0"))}const m=new Uint8Array(Math.floor(d.length/8));for(let _=0;_<m.length;_++)m[_]=parseInt(d.slice(_*8,(_+1)*8),2);return m}function l0(s,a){let m=new Uint8Array(64);s.length>64?(m=hp(s),m=new Uint8Array(64).map((se,Ce)=>Ce<m.length?m[Ce]:0)):m.set(s);const _=new Uint8Array(64),E=new Uint8Array(64);for(let se=0;se<64;se++)_[se]=m[se]^92,E[se]=m[se]^54;const T=new Uint8Array(E.length+a.byteLength);T.set(E),T.set(new Uint8Array(a),E.length);const M=hp(T.buffer),A=new Uint8Array(_.length+M.length);A.set(_),A.set(M,_.length);const G=hp(A.buffer),K=G[G.length-1]&15;return(((G[K]&127)<<24|(G[K+1]&255)<<16|(G[K+2]&255)<<8|G[K+3]&255)%1e6).toString().padStart(6,"0")}function hp(s){let a=new Uint8Array(s);const d=Array.from(a).map(M=>String.fromCharCode(M)).join(""),m=[1732584193,4023233417,2562383102,271733878,3285377520],_=d.length*8;let E=d.slice(0);for(E+="";E.length*8%512!==448;)E+="\0";for(let M=7;M>=0;M--)E+=String.fromCharCode(_>>>M*8&255);for(let M=0;M<E.length;M+=64){const A=Array(80);for(let ee=0;ee<16;ee++)A[ee]=E.charCodeAt(M+ee*4)<<24|E.charCodeAt(M+ee*4+1)<<16|E.charCodeAt(M+ee*4+2)<<8|E.charCodeAt(M+ee*4+3);for(let ee=16;ee<80;ee++)A[ee]=(A[ee-3]^A[ee-8]^A[ee-14]^A[ee-16])<<1|(A[ee-3]^A[ee-8]^A[ee-14]^A[ee-16])>>>31;let[G,K,Y,se,Ce]=m;for(let ee=0;ee<80;ee++){let pe,$e;ee<20?(pe=K&Y|~K&se,$e=1518500249):ee<40?(pe=K^Y^se,$e=1859775393):ee<60?(pe=K&Y|K&se|Y&se,$e=2400959708):(pe=K^Y^se,$e=3395469782);const ke=(G<<5|G>>>27)+pe+Ce+$e+A[ee]>>>0;Ce=se,se=Y,Y=K<<30|K>>>2,K=G,G=ke}m[0]=m[0]+G>>>0,m[1]=m[1]+K>>>0,m[2]=m[2]+Y>>>0,m[3]=m[3]+se>>>0,m[4]=m[4]+Ce>>>0}const T=new Uint8Array(20);for(let M=0;M<5;M++)T[M*4]=m[M]>>>24&255,T[M*4+1]=m[M]>>>16&255,T[M*4+2]=m[M]>>>8&255,T[M*4+3]=m[M]&255;return T}function d0(){if(!o0(Zm,pC)){w("Invalid token. Please check your authenticator app.");return}ng(s=>({...s,twoFactorEnabled:!0})),Gu(!0),w("2FA enabled successfully! Your backup codes have been saved."),Ac(!1)}async function u0(){await Qr("Are you sure? You will lose 2FA protection.","Disable 2FA")&&(ng(a=>({...a,twoFactorEnabled:!1})),zu(""),Oc([]),Gu(!1),Ac(!1),w("2FA has been disabled."))}async function cl(s){const a=xt.find(d=>d.participantId===s.id||d.name===s.username);if(a){wr(a.id),b("dms");return}try{const m=(await le("/v1/social/dms/open",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({friendId:s.id})})).threadId;yr(_=>_.find(T=>T.id===m)?_:[{id:m,participantId:s.id,name:s.username,messages:[]},..._]),wr(m),b("dms")}catch(d){w(`Open DM failed: ${d.message}`)}}async function Og(){try{if(await le("/v1/me/profile",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({displayName:_e.displayName||null,bio:_e.bio||null,pfpUrl:ts(_e.pfpUrl)||null,bannerUrl:ts(_e.bannerUrl)||null})}),l!=null&&l.id){const s=await le(`/v1/users/${l.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});vi(s),at(ro(s,s.fullProfile)),_n({displayName:s.displayName??"",bio:s.bio??"",pfpUrl:s.pfpUrl??"",bannerUrl:s.bannerUrl??""})}else vi(s=>({...s,..._e}));w("Profile updated.")}catch(s){const a=(s==null?void 0:s.message)||"";a.includes("INVALID_IMAGE")||a.includes("Invalid image format")?w("Invalid image URL. Use uploaded image paths (/v1/profile-images/...), users/... paths, or valid http(s) image URLs."):w(`Profile update failed: ${a}`)}}function mp(s,a){at(d=>({...d,mode:"custom",elements:(d.elements||[]).map(m=>m.id===s?{...m,...a}:m)}))}function zi(s){const a=String(s||"").toLowerCase();if(!["avatar","banner","name","bio","links","text"].includes(a))return;const d=`${a}-${Date.now()}`,m=a==="banner"?{x:0,y:0,w:100,h:34}:a==="avatar"?{x:4,y:21,w:20,h:31}:a==="name"?{x:30,y:30,w:66,h:10}:a==="bio"?{x:4,y:54,w:92,h:22}:a==="links"?{x:4,y:76,w:56,h:20}:{x:8,y:22,w:58,h:12};at(_=>{const E=(_.elements||[]).length+1;return{..._,mode:"custom",enabled:!0,elements:[..._.elements||[],{id:d,type:a,...m,order:10+E,text:a==="text"?`Custom text ${E}`:""}]}}),Is(d)}function p0(){zi("text")}function f0(s){at(a=>({...a,mode:"custom",elements:(a.elements||[]).filter(d=>d.id!==s)})),Vr===s&&Is("")}function h0(){at(s=>{const a=(s.links||[]).length+1;return{...s,mode:"custom",links:[...s.links||[],{id:`link-${Date.now()}`,label:`Link ${a}`,url:"https://",x:0,y:0}].slice(0,16)}})}function Ag(s,a){at(d=>({...d,mode:"custom",links:(d.links||[]).map(m=>m.id===s?{...m,...a}:m)}))}function m0(s){at(a=>({...a,mode:"custom",links:(a.links||[]).filter(d=>d.id!==s)}))}function g0(){at(od(ne||{})),Is("")}function Vi(s,a){const d=((ce==null?void 0:ce.elements)||[]).find(m=>m.id===s);d&&mp(s,{x:ur(a.x??d.x,0,100,d.x),y:ur(a.y??d.y,0,100,d.y),w:ur(a.w??d.w,1,100,d.w),h:ur(a.h??d.h,1,100,d.h),order:Math.max(0,Math.min(100,Number.isFinite(Number(a.order))?Number(a.order):Number(d.order||0)))})}async function v0(){if(!fa){openBoostUpsell("Boost required","Custom full profiles are a Boost perk. Without Boost you get the default profile layout.","Open billing");return}try{const s=ro(ne||{},{...ce,mode:"custom",enabled:!0}),a=await le("/v1/me/profile/full",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify(s)}),d={...ne||{},fullProfile:ro(ne||{},(a==null?void 0:a.fullProfile)||s),hasCustomFullProfile:!0};vi(d),at(d.fullProfile),w("Full profile updated.")}catch(s){const a=String((s==null?void 0:s.message)||"");a.includes("BOOST_REQUIRED")?openBoostUpsell("Boost required","Custom full profiles are a Boost perk. Activate Boost to save your layout.","Open billing"):w(`Full profile update failed: ${a}`)}}function y0(s,a){if(!xc.current)return;const d=(ce.elements||[]).find(T=>T.id===a);if(!d)return;const m=xc.current.getBoundingClientRect(),_=(s.clientX-m.left)/m.width*100,E=(s.clientY-m.top)/m.height*100;fu.current={x:_-Number(d.x||0),y:E-Number(d.y||0)},Is(a),hm(a)}async function w0(){if(!r)return;const s=ER(xn);if(!s.name&&!s.details&&!s.state&&!s.largeImageUrl&&!s.smallImageUrl&&!s.buttons){w("Add at least one rich presence field before saving.");return}try{await le("/v1/presence/rpc",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({activity:s})}),l!=null&&l.id&&Ni(a=>{var d,m;return{...a,[l.id]:{...a[l.id]||{},status:((d=a[l.id])==null?void 0:d.status)||On,customStatus:((m=a[l.id])==null?void 0:m.customStatus)??null,richPresence:s}}}),w("Rich presence updated.")}catch(a){w(`Rich presence update failed: ${a.message}`)}}async function S0(){if(r)try{await le("/v1/presence/rpc",{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),l!=null&&l.id&&Ni(s=>{var a,d;return{...s,[l.id]:{...s[l.id]||{},status:((a=s[l.id])==null?void 0:a.status)||On,customStatus:((d=s[l.id])==null?void 0:d.customStatus)??null,richPresence:null}}}),At(Hw(null)),w("Rich presence cleared.")}catch(s){w(`Clear rich presence failed: ${s.message}`)}}async function _0(){var s;if(!(!j||!Pe))try{await le(`/v1/servers/${j.id}/profile`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:((s=yi.name)==null?void 0:s.trim())||void 0,logoUrl:ts(yi.logoUrl||"")||null,bannerUrl:ts(yi.bannerUrl||"")||null})});const d=(await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];I(d),w("Server profile updated.")}catch(a){const d=(a==null?void 0:a.message)||"";d.includes("LOGO_REQUIRED")?w("Server logo is required."):d.includes("INVALID_LOGO_URL")?w("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):d.includes("INVALID_BANNER_URL")?w("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):d.includes("VALIDATION_ERROR")?w("Server profile data is invalid. Check name, logo URL, and banner URL."):w(`Server profile update failed: ${d}`)}}async function Ug(){if(!(!wi.trim()||!Si.trim()||!_i.trim()))try{await le("/v1/servers",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:wi.trim(),baseUrl:Si.trim(),logoUrl:ts(_i),bannerUrl:ts(gu)||null})}),hu(""),mu("https://"),zo(""),Vo(""),w("Server provider added.");const s=await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}});I(s.servers||[]),Ii(!1)}catch(s){const a=(s==null?void 0:s.message)||"";a.includes("LOGO_REQUIRED")?w("Server logo is required."):a.includes("INVALID_LOGO_URL")?w("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):a.includes("INVALID_BANNER_URL")?w("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):w(`Add server failed: ${a}`)}}function $g(s){F&&wC(a=>{const m={...a[F]||{mode:"core",customUrl:""},...s};return{...a,[F]:m}})}async function x0(){if(!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken)||!(Ho!=null&&Ho.trim())){w("Select a server and enter a workspace name.");return}try{const s=await ue(j.baseUrl,"/v1/guilds",j.membershipToken,{method:"POST",body:JSON.stringify({name:Ho.trim(),createDefaultVoice:!0})});Cm(""),w("Workspace created.");const a=await ue(j.baseUrl,"/v1/guilds",j.membershipToken),d=Array.isArray(a)?a:[];L(d),s!=null&&s.guildId&&d.length&&Z(s.guildId)}catch(s){w(`Create workspace failed: ${s.message}`)}}async function C0(){if(!vu)return;if((wu||yu.trim().length>0)&&Ke&&!Ke.active){al("Custom invite codes and permanent invite links require OpenCom Boost.");return}try{const a={serverId:vu,code:yu.trim()||void 0,permanent:wu},d=await le("/v1/invites",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify(a)});Dx(d.code),Mx(d.joinUrl||""),wm(""),w("Invite code generated.")}catch(a){if(String((a==null?void 0:a.message)||"").includes("BOOST_REQUIRED")){al("Custom invite codes and permanent invite links require OpenCom Boost.");return}w(`Invite failed: ${a.message}`)}}async function Fg(s=null){const a=id(s??Gr??"");if(!a){bc(null),w("Invalid invite code/link.");return}try{const d=await le(`/v1/invites/${a}`);bc(d),Go(a),vr(a),w("Invite preview loaded.")}catch(d){bc(null),w(`Invite lookup failed: ${d.message}`)}}async function ll(s=null){var d;const a=id(s||Gr||"");if(a)try{const m=await le(`/v1/invites/${a}/join`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({accept:!0})});Go(""),bc(null),vr(""),ks(!1);const _=(m==null?void 0:m.serverName)||((d=m==null?void 0:m.server)==null?void 0:d.name)||(sn==null?void 0:sn.serverName)||"";w(_?`Joined ${_}.`:"Joined server from invite.");const T=(await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];I(T);const M=m==null?void 0:m.serverId;M&&T.some(A=>A.id===M)?q(M):T.length&&q(T[0].id),Ii(!1)}catch(m){w(`Join failed: ${m.message}`)}}const Bg=1,dl=2;function zg(s=""){const a=s.split(",").map(T=>T.trim()).filter(Boolean);if(!a.length)return[];const d=((U==null?void 0:U.roles)||[]).filter(T=>!T.is_everyone),m=new Map(d.map(T=>[String(T.id).toLowerCase(),T.id])),_=new Map(d.map(T=>[String(T.name||"").toLowerCase(),T.id])),E=[];for(const T of a){const M=T.toLowerCase(),A=m.get(M)||_.get(M);A&&!E.includes(A)&&E.push(A)}return E}async function Vg(s,a=[],d=j,m=Yt){if(!d||!m||!s)return;const _=((U==null?void 0:U.roles)||[]).find(E=>E.is_everyone);if(!_)throw new Error("EVERYONE_ROLE_NOT_FOUND");await ue(d.baseUrl,`/v1/channels/${s}/overwrites`,d.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:_.id,allow:"0",deny:String(Bg)})});for(const E of a)await ue(d.baseUrl,`/v1/channels/${s}/overwrites`,d.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:E,allow:String(Bg),deny:"0"})})}async function Gg({server:s=j,guildId:a=Yt,name:d,type:m="text",parentId:_="",privateRoleIds:E=null}){if(!s||!a||!(d!=null&&d.trim()))return null;const T={name:d.trim(),type:m};m!=="category"&&_&&(T.parentId=_);const M=await ue(s.baseUrl,`/v1/guilds/${a}/channels`,s.membershipToken,{method:"POST",body:JSON.stringify(T)}),A=M==null?void 0:M.channelId;if(A&&Array.isArray(E)&&await Vg(A,E,s,a),s.id===F&&a===Yt){const G=await ue(s.baseUrl,`/v1/guilds/${a}/state`,s.membershipToken);H(G)}return A}async function Gi({server:s=j,guildId:a=Yt,fixedType:d="",fixedParentId:m=""}={}){if(!s||!a){w("No active guild selected yet. Open a channel first, then try again.");return}const _=d||(await Fs("Channel type: text, voice, or category","text")||"").trim().toLowerCase();if(!["text","voice","category"].includes(_)){w("Invalid channel type.");return}const E=_==="category"?"New Category":`new-${_}`,T=(await Fs(`Name for the new ${_}:`,E)||"").trim();if(!T)return;let M=m||"";if(_!=="category"&&!m){const G=(await Fs("Optional category name/ID (leave blank for none):","")||"").trim();if(G){const K=(ha||[]).find(Y=>Y.id===G||String(Y.name||"").toLowerCase()===G.toLowerCase());if(!K){w("Category not found.");return}M=K.id}}let A=null;if(_==="category"&&await Qr("Make this category private?","Category Privacy")){const K=((U==null?void 0:U.roles)||[]).filter(se=>!se.is_everyone).map(se=>se.name).join(", "),Y=await Fs(`Allowed roles (comma-separated names or IDs).
Available: ${K}`,"")||"";A=zg(Y)}try{await Gg({server:s,guildId:a,name:T,type:_,parentId:M,privateRoleIds:A}),w(`${_==="category"?"Category":"Channel"} created.`)}catch(G){w(`Create channel failed: ${G.message}`)}}async function b0(){if(!(!j||!Yt||!Su.trim()))try{await Gg({server:j,guildId:Yt,name:Su,type:Ec,parentId:Ec!=="category"?_m:""}),Sm(""),xm(""),w("Channel created.")}catch(s){w(`Create channel failed: ${s.message}`)}}async function E0(){if(!(!j||!z||!fe.trim()||!et.trim()))try{await ue(j.baseUrl,`/v1/guilds/${z}/emotes`,j.membershipToken,{method:"POST",body:JSON.stringify({name:fe.trim().toLowerCase(),imageUrl:et.trim()})}),we(""),Ee("");const s=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(s),w("Custom emote created.")}catch(s){w(`Create emote failed: ${s.message}`)}}async function k0(s){if(!(!j||!z||!s))try{await ue(j.baseUrl,`/v1/guilds/${z}/emotes/${s}`,j.membershipToken,{method:"DELETE"});const a=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(a),w("Custom emote removed.")}catch(a){w(`Remove emote failed: ${a.message}`)}}async function Hg(s,a){if(!(!j||!z))try{await ue(j.baseUrl,`/v1/channels/${s}`,j.membershipToken,{method:"PATCH",body:JSON.stringify({position:a})});const d=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(d)}catch(d){w(`Move channel failed: ${d.message}`)}}async function T0(s,a,d){var Ce;const m=d.findIndex(ee=>ee.id===s),_=d.findIndex(ee=>ee.id===a);if(m===-1||_===-1||m===_)return;const E=[...d],[T]=E.splice(m,1);E.splice(_,0,T);const M=(U==null?void 0:U.channels)||[],A=new Map;for(const ee of M){const pe=ee.parent_id||"__uncat__";A.has(pe)||A.set(pe,[]),A.get(pe).push(ee)}const G=((Ce=d[0])==null?void 0:Ce.parent_id)??"__uncat__",K=[],Y=[...A.keys()].sort((ee,pe)=>{const $e=A.get(ee),ke=A.get(pe),Qe=Math.min(...$e.map(Rn=>Rn.position??0)),ut=Math.min(...ke.map(Rn=>Rn.position??0));return Qe-ut});for(const ee of Y){const pe=A.get(ee),ke=ee===G?E:pe.sort((Qe,ut)=>(Qe.position??0)-(ut.position??0));K.push(...ke)}const se=K.map((ee,pe)=>(ee.position??-1)!==pe?Hg(ee.id,pe):Promise.resolve());await Promise.all(se),Hu(null)}async function R0(s,a){const d=[...ha||[]],m=d.findIndex(M=>M.id===s),_=d.findIndex(M=>M.id===a);if(m===-1||_===-1||m===_)return;const E=[...d],[T]=E.splice(m,1);E.splice(_,0,T);try{await Promise.all(E.map((M,A)=>Hg(M.id,A*100))),Wu(null)}catch(M){w(`Move category failed: ${M.message}`)}}async function I0(s,a,d){if(!(!j||!s||!a))try{const m=((U==null?void 0:U.roles)||[]).find(E=>E.is_everyone);if(d)m&&await ue(j.baseUrl,`/v1/channels/${s}/overwrites`,j.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:m.id,allow:"0",deny:String(dl)})}),await ue(j.baseUrl,`/v1/channels/${s}/overwrites`,j.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:a,allow:String(dl),deny:"0"})});else{await ue(j.baseUrl,`/v1/channels/${s}/overwrites`,j.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:a})});const E=((U==null?void 0:U.overwrites)||[]).filter(T=>T.channel_id===s&&T.target_type==="role"&&T.target_id!==a&&parseInt(T.allow,10)&dl);m&&E.length===0&&await ue(j.baseUrl,`/v1/channels/${s}/overwrites`,j.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:m.id})})}const _=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(_)}catch(m){w(`Permission update failed: ${m.message}`)}}function j0(s,a){const d=((U==null?void 0:U.overwrites)||[]).find(m=>m.channel_id===s&&m.target_type==="role"&&m.target_id===a);return d?(parseInt(d.allow,10)&dl)!==0:!1}async function N0(){if(!(!j||!z||!Tu.trim()))try{await ue(j.baseUrl,`/v1/guilds/${z}/roles`,j.membershipToken,{method:"POST",body:JSON.stringify({name:Tu.trim(),permissions:"0"})}),jm("");const s=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(s),w("Role created.")}catch(s){w(`Create role failed: ${s.message}`)}}async function P0(){if(!(!j||!z||!Iu||!Ru))try{await ue(j.baseUrl,`/v1/guilds/${z}/members/${Iu}/roles/${Ru}`,j.membershipToken,{method:"PUT",body:"{}"}),w("Role assigned.")}catch(s){w(`Assign role failed: ${s.message}`)}}async function Wg(){if(!j||!z)return;const s=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(s)}async function gp(s){if(!j||!z||!s||!pa||bi)return;const a=Tt.find(m=>m.id===s),d=(a==null?void 0:a.username)||s;if(await Qr(`Kick ${d}? They can rejoin with an invite.`,"Kick Member")){Ei(!0);try{await ue(j.baseUrl,`/v1/guilds/${z}/members/${s}/kick`,j.membershipToken,{method:"POST",body:"{}"}),await Wg(),(ge==null?void 0:ge.id)===s&&Os(null),w(`Kicked ${d}.`)}catch(m){w(`Kick failed: ${m.message}`)}finally{Ei(!1)}}}async function vp(s,a=""){if(!j||!z||!s||!qr||bi)return;const d=Tt.find(_=>_.id===s),m=(d==null?void 0:d.username)||s;if(await Qr(`Ban ${m}? This removes them and blocks rejoin until unbanned.`,"Ban Member")){Ei(!0);try{const _={};a.trim()&&(_.reason=a.trim().slice(0,256)),await ue(j.baseUrl,`/v1/guilds/${z}/members/${s}/ban`,j.membershipToken,{method:"POST",body:JSON.stringify(_)}),await Wg(),(ge==null?void 0:ge.id)===s&&Os(null),w(`Banned ${m}.`)}catch(_){w(`Ban failed: ${_.message}`)}finally{Ei(!1)}}}async function L0(s){if(!(!j||!z||!s||!qr||bi)){Ei(!0);try{await ue(j.baseUrl,`/v1/guilds/${z}/bans/${s}`,j.membershipToken,{method:"DELETE"}),w(`Unbanned ${s}.`),Lm("")}catch(a){w(`Unban failed: ${a.message}`)}finally{Ei(!1)}}}async function Kg(s,{color:a,position:d}){if(!(!j||!s))try{const m={};if(a!==void 0&&(m.color=typeof a=="string"&&a.startsWith("#")?parseInt(a.slice(1),16):a),d!==void 0&&(m.position=d),Object.keys(m).length===0)return;await ue(j.baseUrl,`/v1/roles/${s}`,j.membershipToken,{method:"PATCH",body:JSON.stringify(m)});const _=await ue(j.baseUrl,`/v1/guilds/${z}/state`,j.membershipToken);H(_),w("Role updated.")}catch(m){w(`Update role failed: ${m.message}`)}}function D0(s){s.preventDefault(),da.current=jc?{x:s.clientX+ki.x,y:s.clientY+ki.y}:{x:s.clientX-ki.x,y:s.clientY-ki.y},Mm(!0)}function M0(s){Fx(a=>({...a,[s]:!a[s]}))}function O0(s,a){s.preventDefault(),an(null),ct(null),An(null),Un(null),bt({server:a,x:s.clientX,y:s.clientY})}function A0(s,a){s.preventDefault(),bt(null),an(null),ct(null),Un(null),An({channel:a,x:s.clientX,y:s.clientY})}function U0(s,a){s.preventDefault(),bt(null),an(null),ct(null),An(null),Un({category:a,x:s.clientX,y:s.clientY})}async function $0(s,a){if(!j||!Yt)return;const d=(await Fs("Channel name:",a||"")||"").trim();!d||d===a||await ue(j.baseUrl,`/v1/channels/${s}`,j.membershipToken,{method:"PATCH",body:JSON.stringify({name:d})})}async function F0(s){if(!j||!Yt||!s)return;const a=((U==null?void 0:U.roles)||[]).filter(_=>!_.is_everyone).map(_=>_.name).join(", "),d=await Fs(`Visible to roles (comma-separated names or IDs). Leave blank to keep private for admins only.
Available: ${a}`,"");if(d==null)return;const m=zg(d);await Vg(s,m,j,Yt)}async function ul(s){if(!(!s||!Pe||!j||!Yt))try{await $0(s.id,s.name),await Qr("Configure visibility (private roles) for this channel/category?","Channel Visibility")&&await F0(s.id);const a=await ue(j.baseUrl,`/v1/guilds/${Yt}/state`,j.membershipToken);H(a),w("Channel settings updated.")}catch(a){w(`Update channel failed: ${a.message}`)}finally{An(null),Un(null)}}async function Qg(s){if(!s||!Pe||!j||!Yt)return;const a=s.type==="category"?"category":"channel";if(await Qr(`Delete ${a} "${s.name}"?`,"Delete Channel"))try{if(s.type==="category"){const m=((U==null?void 0:U.channels)||[]).filter(_=>_.parent_id===s.id);for(const _ of m)await ue(j.baseUrl,`/v1/channels/${_.id}`,j.membershipToken,{method:"PATCH",body:JSON.stringify({parentId:null})})}await ue(j.baseUrl,`/v1/channels/${s.id}`,j.membershipToken,{method:"DELETE"}),te===s.id&&me("");const d=await ue(j.baseUrl,`/v1/guilds/${Yt}/state`,j.membershipToken);H(d),w(`${a[0].toUpperCase()}${a.slice(1)} deleted.`)}catch(d){w(`Delete channel failed: ${d.message}`)}finally{An(null),Un(null)}}async function B0(s){try{await navigator.clipboard.writeText(s),w("Server ID copied.")}catch{w("Could not copy server ID.")}bt(null)}function z0(s){b("servers"),q(s),bt(null)}async function Yg(s,a){const d=k.findIndex(T=>T.id===s);if(d<0)return;const m=a==="up"?d-1:d+1;if(m<0||m>=k.length)return;const _=k.slice(),[E]=_.splice(d,1);_.splice(m,0,E),I(_),bt(null);try{await le("/v1/servers/reorder",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({serverIds:_.map(T=>T.id)})}),w("Server order updated.")}catch(T){w(`Server reorder failed: ${T.message}`)}}async function V0(s){if(!(s!=null&&s.id))return;bt(null);const a=F===s.id;a&&(q(""),Z(""),H(null),Q([]));try{if(await le(`/v1/servers/${s.id}/leave`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),s.defaultGuildId&&s.baseUrl)try{await ue(s.baseUrl,`/v1/guilds/${s.defaultGuildId}/leave`,s.membershipToken,{method:"POST",body:"{}"})}catch{}const m=(await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];I(m),a&&m.length&&q(m[0].id),w("Left server.")}catch(d){w(`Leave failed: ${d.message}`)}}async function G0(s){if(!(!(s!=null&&s.id)||!(s.roles||[]).includes("owner"))&&await Qr(`Delete "${s.name}"? This cannot be undone. All members will lose access.`,"Delete Server")){bt(null);try{await le(`/v1/servers/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});const d=(await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];I(d),F===s.id&&(q(d.length?d[0].id:""),Z(""),H(null),Q([])),w("Server deleted.")}catch(a){w(`Delete failed: ${a.message}`)}}}async function H0(s){if(!(!j||!te||!s)){try{await ue(j.baseUrl,`/v1/channels/${te}/messages/${s}`,j.membershipToken,{method:"DELETE",body:"{}"}),Q(a=>a.filter(d=>d.id!==s)),w("Message deleted.")}catch(a){w(`Delete failed: ${a.message}`)}an(null)}}async function W0(s){if(!(!xe||!s)){try{await le(`/v1/social/dms/${xe}/messages/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),yr(a=>a.map(d=>d.id===xe?{...d,messages:(d.messages||[]).filter(m=>m.id!==s)}:d)),w("DM message deleted.")}catch(a){w(`Delete failed: ${a.message}`)}an(null)}}async function Jg(s=te){if(!(!j||!s))try{const a=await ue(j.baseUrl,`/v1/channels/${s}/pins`,j.membershipToken);Yx(d=>({...d,[s]:Array.isArray(a==null?void 0:a.pins)?a.pins:[]}))}catch(a){w(`Failed to load pinned messages: ${a.message}`)}}async function K0(s){if(s!=null&&s.id){if(s.kind==="server"){if(!j||!te)return;const d=(ku[te]||[]).some(m=>m.id===s.id);try{await ue(j.baseUrl,`/v1/channels/${te}/pins/${s.id}`,j.membershipToken,{method:d?"DELETE":"PUT",body:"{}"}),await Jg(te),w("Updated pinned messages.")}catch(m){w(`Pin update failed: ${m.message}`)}return}if(s.kind==="dm"){if(!xe)return;Jx(a=>{const d=a[xe]||[],_=d.some(E=>E.id===s.id)?d.filter(E=>E.id!==s.id):[{id:s.id,author:s.author,content:s.content},...d].slice(0,50);return{...a,[xe]:_}}),w("Updated pinned messages.")}}}function Q0(s){return s!=null&&s.id?s.kind==="server"?il.some(a=>a.id===s.id):s.kind==="dm"?ol.some(a=>a.id===s.id):!1:!1}function Y0({type:s,match:a=null,timeoutMs:d=1e4,guildId:m=null,channelId:_=null,sessionToken:E=null,transportId:T=null}){return new Promise((M,A)=>{const G=s,K=xr.current.get(G)||[],Y={match:a,guildId:m,channelId:_,sessionToken:E,transportId:T,resolve:M,reject:A,timeout:setTimeout(()=>{A(new Error(`${s}_TIMEOUT`));const se=xr.current.get(G)||[];xr.current.set(G,se.filter(Ce=>Ce!==Y))},d)};K.push(Y),xr.current.set(G,K)})}function J0(s){if((s==null?void 0:s.op)!=="DISPATCH"||typeof s.t!="string")return;const a=xr.current.get(s.t);if(!(a!=null&&a.length))return;const d=s.d||{},m=s.t==="VOICE_TRANSPORT_CONNECTED",_=[];for(const E of a){const T=m?!E.guildId||d.guildId==null||d.guildId===E.guildId:!E.guildId||d.guildId===E.guildId,M=m?!E.channelId||d.channelId==null||d.channelId===E.channelId:!E.channelId||d.channelId===E.channelId,A=!m||!E.transportId||d.transportId===E.transportId,G=!E.match||E.match(d,s);if(T&&M&&A&&G){clearTimeout(E.timeout),E.resolve(d);continue}_.push(E)}_.length?xr.current.set(s.t,_):xr.current.delete(s.t)}function yp(s="VOICE_REQUEST_CANCELLED"){for(const[a,d]of xr.current.entries()){for(const m of d)clearTimeout(m.timeout),m.reject(new Error(s));xr.current.delete(a)}}async function qg(){var s;yp("VOICE_SESSION_CLEANUP"),await((s=$t.current)==null?void 0:s.cleanup()),Cu(!1),Gc({})}async function q0(s=15e3){var E,T;const a=Date.now();for(;Date.now()-a<s;){const M=Xe.current;if(M&&M.readyState===WebSocket.OPEN&&cn.current)return M;await new Promise(A=>setTimeout(A,120))}const d=(E=Xe.current)==null?void 0:E.readyState,m=d===WebSocket.CONNECTING?"CONNECTING":d===WebSocket.OPEN?"OPEN":d===WebSocket.CLOSING?"CLOSING":d===WebSocket.CLOSED?"CLOSED":"MISSING",_=(T=oa.current)!=null&&T.length?oa.current.join(","):"none";throw new Error(`VOICE_GATEWAY_UNAVAILABLE:ready=${cn.current?"1":"0"},ws=${m},candidates=${_}`)}async function pl(s,a){(await q0()).send(JSON.stringify({op:"DISPATCH",t:s,d:a}))}function X0(){const s=Xe.current,a=!!(s&&s.readyState===WebSocket.OPEN&&cn.current);if(e){const d=s==null?void 0:s.readyState,m=d===WebSocket.CONNECTING?"CONNECTING":d===WebSocket.OPEN?"OPEN":d===WebSocket.CLOSING?"CLOSING":d===WebSocket.CLOSED?"CLOSED":"MISSING";t("canUseRealtimeVoiceGateway",{usable:a,readyState:m,gatewayReady:cn.current,activeGuildId:z,activeChannelId:te})}return a}async function Z0(s){const a=s==null?void 0:s.currentTarget;if(!a)return;const d=a.requestFullscreen||a.webkitRequestFullscreen||a.msRequestFullscreen;if(typeof d!="function"){w("Fullscreen is not supported in this browser.");return}try{await d.call(a)}catch(m){w(`Could not open fullscreen: ${m.message||"FULLSCREEN_FAILED"}`)}}async function Xg(s,a,d={}){if(!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken)||!s||!a)return;const m=d.muted!==void 0,_=d.deafened!==void 0;if(!(!m&&!_))try{await ue(j.baseUrl,`/v1/channels/${s}/voice/members/${a}/state`,j.membershipToken,{method:"PATCH",body:JSON.stringify(d)});const E=[];m&&E.push(d.muted?"muted":"unmuted"),_&&E.push(d.deafened?"deafened":"undeafened"),w(`Voice member ${E.join(" and ")}.`)}catch(E){w(`Voice moderation failed: ${E.message||"VOICE_MODERATION_FAILED"}`)}}async function eb(s,a){if(!(!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken)||!s||!a))try{await ue(j.baseUrl,`/v1/channels/${s}/voice/members/${a}/disconnect`,j.membershipToken,{method:"POST"}),w("Voice member disconnected.")}catch(d){w(`Disconnect failed: ${d.message||"VOICE_DISCONNECT_FAILED"}`)}}async function Zg(s){var m;if(!(s!=null&&s.id)||!z||!(j!=null&&j.baseUrl)||!(j!=null&&j.membershipToken))return;let a=null;try{w(`Joining ${s.name}...`),await((m=$t.current)==null?void 0:m.join({guildId:z,channelId:s.id,audioInputDeviceId:Sr,noiseSuppression:Ci,isMuted:on,isDeafened:Kt,audioOutputDeviceId:Hr})),Tc({guildId:z,channelId:s.id}),w(`Joined ${s.name}.`);return}catch(_){a=_}if(!("".trim()==="1")){const E=`Voice connection failed: ${(a==null?void 0:a.message)||"VOICE_GATEWAY_UNAVAILABLE"}. Realtime voice gateway is required; set VITE_ENABLE_REST_VOICE_FALLBACK=1 only for diagnostics.`;w(E),await dp(E,"Voice Error");return}try{await ue(j.baseUrl,`/v1/channels/${s.id}/voice/join`,j.membershipToken,{method:"POST"}),Tc({guildId:z,channelId:s.id});const _=a!=null&&a.message?` (gateway fallback: ${a.message})`:"";w(`Joined ${s.name} (REST voice mode, no SFU playback).${_}`)}catch(_){const E=`Voice connection failed: ${_.message||"VOICE_JOIN_FAILED"}`;w(E),await dp(E,"Voice Error")}}async function wp(){var s,a;if(ln)try{Ns?(await((s=$t.current)==null?void 0:s.stopScreenShare()),w("Screen sharing stopped.")):(await((a=$t.current)==null?void 0:a.startScreenShare()),w("Screen sharing started."))}catch(d){const m=`Screen sharing failed: ${d.message||"SCREEN_SHARE_FAILED"}`;w(m),await dp(m,"Screen Share Error")}}async function Sp(){if(xu)return;let s=Ge,a=Jt;if(!s||!a)for(const[_,E]of Object.entries(Us||{})){const T=E==null?void 0:E[l==null?void 0:l.id];if(T!=null&&T.channelId){s=_,a=T.channelId;break}}if(!a){const _=Zn.find(E=>E.userId===(l==null?void 0:l.id));_!=null&&_.channelId&&(s=s||z||"",a=_.channelId)}const d=k.find(_=>_.defaultGuildId===s)||j||null,m=async()=>{Tc({guildId:"",channelId:""}),Cu(!1),Gc({}),Wo(!1),Ko(!1),l!=null&&l.id&&Ju(_=>{var M;let E=!1;const T={..._};for(const A of Object.keys(T)){if(!((M=T[A])!=null&&M[l.id]))continue;const G={...T[A]};delete G[l.id],T[A]=G,E=!0}return E?T:_}),await qg()};bm(!0);try{if(await m(),w("Disconnected from voice."),!s||!a){if(!(d!=null&&d.baseUrl)||!(d!=null&&d.membershipToken))return;try{await ue(d.baseUrl,"/v1/me/voice-disconnect",d.membershipToken,{method:"POST"})}catch(_){const E=`Disconnected locally. Server voice leave failed: ${_.message||"VOICE_LEAVE_FAILED"}`;w(E),console.warn(E)}return}if(X0())try{await pl("VOICE_LEAVE",{guildId:s,channelId:a});return}catch{}if(!(d!=null&&d.baseUrl)||!(d!=null&&d.membershipToken))return;try{if(a){await ue(d.baseUrl,`/v1/channels/${a}/voice/leave`,d.membershipToken,{method:"POST"});return}await ue(d.baseUrl,"/v1/me/voice-disconnect",d.membershipToken,{method:"POST"})}catch(_){const E=`Disconnected locally. Server voice leave failed: ${_.message||"VOICE_LEAVE_FAILED"}`;w(E),console.warn(E)}}finally{bm(!1)}}async function ev(){const s=Ps.trim();if(!(!s||!r||!Wr.trim()))try{const a=await le("/v1/servers/official",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:s,logoUrl:ts(Wr),bannerUrl:ts(Eu)||null})});bu(""),Yo(""),Jo(""),w("Your server was created.");const m=(await le("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];I(m),a.serverId&&m.length&&(q(a.serverId),b("servers")),Ii(!1)}catch(a){const d=(a==null?void 0:a.message)||"";d.includes("SERVER_LIMIT")?w("You already have a server."):d.includes("LOGO_REQUIRED")?w("Server logo is required."):d.includes("INVALID_LOGO_URL")?w("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):d.includes("INVALID_BANNER_URL")?w("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):d.includes("OFFICIAL_SERVER_NOT_CONFIGURED")?w("Server creation isnt set up yet. The site admin needs to set OFFICIAL_NODE_SERVER_ID on the API server (same value as NODE_SERVER_ID on the node)."):d.includes("OFFICIAL_SERVER_UNAVAILABLE")?w("Official server is unavailable. Please try again later."):w(`Failed: ${d}`)}}function tv(s,a){s.preventDefault();const d=Math.min(s.clientX,window.innerWidth-240),m=Math.min(s.clientY,window.innerHeight-180);An(null),Un(null),ct(null),an({x:d,y:m,message:{...a,pinned:Q0(a)}})}function va(s,a){if(!(a!=null&&a.id))return;s.preventDefault(),s.stopPropagation();const d=Math.min(s.clientX,window.innerWidth-250),m=Math.min(s.clientY,window.innerHeight-420);bt(null),An(null),Un(null),an(null),ct({x:d,y:m,member:a})}const Hi=25*1024*1024,nv=25*1024*1024;function _p(s){return s!=null&&s.type?s.type.startsWith("image/"):!1}function tb(s){return s!=null&&s.type?s.type.startsWith("audio/"):!1}async function fl(s,a){if(!r)throw new Error("AUTH_REQUIRED");const d=new FormData;d.append("image",s);const m=await fetch(`${fn}${a}`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:d});if(!m.ok){const _=await m.json().catch(()=>({}));throw new Error(_.error||`Upload failed: ${m.status}`)}return m.json()}async function dn(s,a,d){var _;const m=(_=s.target.files)==null?void 0:_[0];if(s.target.value="",!!m){if(!_p(m)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(m.size>Hi){w(`Image too large. Max ${Math.round(Hi/1024/1024)}MB.`);return}try{w(`Uploading ${a}...`);const E=await fl(m,"/v1/images/upload");if(!(E!=null&&E.imageUrl))throw new Error("UPLOAD_FAILED");d(E.imageUrl),w(`${a} uploaded.`)}catch(E){w((E==null?void 0:E.message)||"Upload failed.")}}}async function nb(s,a,d){var _;const m=(_=s.target.files)==null?void 0:_[0];if(s.target.value="",!!m){if(!tb(m)){w("Please choose an audio file (MP3, WAV, OGG, M4A).");return}if(m.size>nv){w(`Audio too large. Max ${Math.round(nv/1024/1024)}MB.`);return}try{w(`Uploading ${a}...`);const E=await fl(m,"/v1/media/upload");if(!(E!=null&&E.mediaUrl))throw new Error("UPLOAD_FAILED");d(E.mediaUrl),w(`${a} uploaded.`)}catch(E){w((E==null?void 0:E.message)||"Upload failed.")}}}async function rv(s){var d;const a=(d=s.target.files)==null?void 0:d[0];if(s.target.value="",!!a){if(!_p(a)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(a.size>Hi){w(`Image too large. Max ${Math.round(Hi/1024/1024)}MB.`);return}try{w("Uploading avatar");const m=await fl(a,"/v1/me/profile/pfp");_n(_=>({..._,pfpUrl:m.pfpUrl||""})),vi(ne?{...ne,pfpUrl:m.pfpUrl}:null),w("Avatar updated.")}catch(m){w(m.message||"Upload failed.")}}}async function sv(s){var d;const a=(d=s.target.files)==null?void 0:d[0];if(s.target.value="",!!a){if(!_p(a)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(a.size>Hi){w(`Image too large. Max ${Math.round(Hi/1024/1024)}MB.`);return}try{w("Uploading banner");const m=await fl(a,"/v1/me/profile/banner");_n(_=>({..._,bannerUrl:m.bannerUrl||""})),vi(ne?{...ne,bannerUrl:m.bannerUrl}:null),w("Banner updated.")}catch(m){w(m.message||"Upload failed.")}}}async function Wi(s){try{const a=await le(`/v1/users/${s.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});Ou(d=>{var m;return{...d,[s.id]:{username:a.username??((m=d[s.id])==null?void 0:m.username)??s.username,displayName:a.displayName??a.username??s.username,pfpUrl:a.pfpUrl??null}}}),Os({...a,fullProfile:ro(a,a.fullProfile),username:a.username||s.username,status:kn(s.id)||"offline",roleIds:s.roleIds||[]})}catch{Os({id:s.id,username:s.username||s.id,displayName:s.username||s.id,bio:"Profile details are private or unavailable.",badges:[],badgeDetails:[],status:kn(s.id)||"offline",platformTitle:null,createdAt:null,fullProfile:od({username:s.username||s.id}),roleIds:s.roleIds||[]})}}async function rb(s){if(!s)return;const a=String(s.id||"").trim();if(!a||!r){Bo(s);return}try{const d=await le(`/v1/users/${a}/profile`,{headers:{Authorization:`Bearer ${r}`}});Bo({...s,...d,username:d.username||s.username||a,displayName:d.displayName??s.displayName??d.username??a,fullProfile:ro(d,d.fullProfile)})}catch{Bo(s)}}function sb(s){if(s&&typeof s=="object"&&(s.bgColor||s.icon||s.name))return{icon:s.icon||"",name:s.name||String(s.id||"Badge"),bgColor:s.bgColor||"#3a4f72",fgColor:s.fgColor||"#ffffff"};const a=String((s==null?void 0:s.id)||s||"").toLowerCase();return a==="platform_owner"?{icon:"",name:"Platform Owner",bgColor:"#2d6cdf",fgColor:"#ffffff"}:a==="platform_admin"?{icon:"",name:"Platform Admin",bgColor:"#2d6cdf",fgColor:"#ffffff"}:a==="boost"?{icon:"",name:"Boost",bgColor:"#4f7ecf",fgColor:"#ffffff"}:{icon:(s==null?void 0:s.icon)||"",name:(s==null?void 0:s.name)||a||"Badge",bgColor:(s==null?void 0:s.bgColor)||"#3a4f72",fgColor:(s==null?void 0:s.fgColor)||"#ffffff"}}function iv(s,a){var m;if(!s||!a)return null;const d=String(s.type||"").toLowerCase();if(d==="banner"){const _=Xt((a.bannerUrl??(ne==null?void 0:ne.bannerUrl))||"");return _?o.jsx("img",{src:_,alt:"Banner",className:"full-profile-banner-image"}):o.jsx("div",{className:"full-profile-banner-fallback"})}if(d==="avatar"){const _=Xt((a.pfpUrl??(ne==null?void 0:ne.pfpUrl))||"");return o.jsx("div",{className:"full-profile-avatar-element",children:_?o.jsx("img",{src:_,alt:"Avatar",className:"full-profile-avatar-image"}):Ir(a.displayName||a.username||"U")})}if(d==="name")return o.jsx("strong",{children:a.displayName||a.username||"User"});if(d==="bio")return o.jsx("span",{children:a.bio||"No bio set."});if(d==="links"){const _=Array.isArray((m=a.fullProfile)==null?void 0:m.links)?a.fullProfile.links:[];return o.jsxs("div",{className:"full-profile-links-list",children:[_.length===0&&o.jsx("span",{className:"hint",children:"No links configured."}),_.map(E=>o.jsx("a",{href:E.url,target:"_blank",rel:"noreferrer",children:E.label},E.id||E.url))]})}return o.jsx("span",{children:s.text||"Custom text"})}function ov(s){var d;const a=`:${s}:`;V(m=>{const _=m||"",E=_.length>0&&!/\s$/.test(_)?" ":"";return`${_}${E}${a} `}),ie(!1),(d=la.current)==null||d.focus()}function av(s){const a=(s==null?void 0:s.content)||"",d=[],m=(T,M)=>{if(!T)return[];const A=[],G=/(\[([^\]\n]{1,200})\]\((https?:\/\/[^\s)]+)\)|https?:\/\/[^\s<>"'`]+|`([^`\n]+)`|\*\*([^*\n]+)\*\*|__([^_\n]+)__|~~([^~\n]+)~~|\*([^*\n]+)\*|_([^_\n]+)_|\n|:([a-zA-Z0-9_+-]{2,32}):)/g;let K=0,Y=G.exec(T),se=0;for(;Y;){const Ce=Y.index??0;Ce>K&&(A.push(o.jsx("span",{children:T.slice(K,Ce)},`${M}-plain-${se}`)),se+=1);const ee=Y[0]||"",pe=Y[2],$e=Y[3],ke=Y[4],Qe=Y[5],ut=Y[6],Rn=Y[7],Xr=Y[8],Se=Y[9],Rt=Y[10];if(pe&&$e)A.push(o.jsx("a",{href:$e,target:"_blank",rel:"noreferrer",children:m(pe,`${M}-md-link-label-${se}`)},`${M}-md-link-${se}`));else if(/^https?:\/\//i.test(ee))A.push(o.jsx("a",{href:ee,target:"_blank",rel:"noreferrer",children:ee},`${M}-link-${se}`));else if(ke)A.push(o.jsx("code",{className:"message-inline-code",children:ke},`${M}-code-${se}`));else if(Qe||ut){const Le=Qe||ut;A.push(o.jsx("strong",{children:m(Le,`${M}-bold-inner-${se}`)},`${M}-bold-${se}`))}else if(Rn)A.push(o.jsx("s",{children:m(Rn,`${M}-strike-inner-${se}`)},`${M}-strike-${se}`));else if(Xr||Se){const Le=Xr||Se;A.push(o.jsx("em",{children:m(Le,`${M}-italic-inner-${se}`)},`${M}-italic-${se}`))}else if(ee===`
`)A.push(o.jsx("br",{},`${M}-br-${se}`));else if(Rt){const Le=String(Rt||"").toLowerCase(),er=Fw[Le];if(er)A.push(o.jsx("span",{className:"message-emote",title:`:${Le}:`,children:er},`${M}-emote-${se}`));else if(xg.has(Le)){const It=xg.get(Le);A.push(o.jsx("img",{className:"message-custom-emote",src:It.imageUrl||It.image_url,alt:`:${Le}:`,title:`:${Le}:`},`${M}-custom-emote-${se}`))}else A.push(o.jsx("span",{children:ee},`${M}-raw-emote-${se}`))}else A.push(o.jsx("span",{children:ee},`${M}-raw-${se}`));se+=1,K=Ce+ee.length,Y=G.exec(T)}return K<T.length&&A.push(o.jsx("span",{children:T.slice(K)},`${M}-tail-${se}`)),A},_=/@\{([^}\n]{1,64})\}|@([a-zA-Z0-9_.-]{2,64})/g;let E=0;for(const T of a.matchAll(_)){const M=T.index??0,A=(T[1]||T[2]||"").trim(),G=T[0],K=M>0?a[M-1]:"";if(!(!(M===0||/\s/.test(K))||!A)){if(M>E&&d.push(...m(a.slice(E,M),`text-${E}`)),A.toLowerCase()==="everyone")d.push(o.jsx("span",{className:"message-mention",children:G},`everyone-${M}`));else{const se=UC.get(A.toLowerCase());se?d.push(o.jsxs("button",{type:"button",className:"message-mention mention-click",onClick:Ce=>{Ce.stopPropagation(),Wi(se)},children:["@",se.username||se.id]},`mention-${M}`)):d.push(o.jsx("span",{className:"message-mention",children:G},`unknown-${M}`))}E=M+G.length}}return E<a.length&&d.push(...m(a.slice(E),`tail-${E}`)),d.length?d:a}function hl(s){try{const a=new URL(String(s||""));return a.hash="",a.toString()}catch{return String(s||"")}}function xp(s=""){return/^image\//i.test(String(s||""))}function cv(s=""){const a=String(s||"").trim();if(!a)return!1;if(/^data:image\//i.test(a))return!0;try{const d=new URL(a);return/\.(png|jpe?g|gif|webp|bmp|svg|heic|avif)(?:[?#]|$)/i.test(d.pathname||"")}catch{return/\.(png|jpe?g|gif|webp|bmp|svg|heic|avif)(?:[?#]|$)/i.test(a)}}function lv(s){const a=String(s||"");if(!a)return null;if(ea[a]!==void 0)return ea[a];const d=hl(a);for(const[m,_]of Object.entries(ea))if(hl(m)===d)return _;return null}function dv(s){const a=Qw((s==null?void 0:s.content)||"");if(!a.length)return[];const d=new Set(((s==null?void 0:s.linkEmbeds)||[]).map(_=>hl(_==null?void 0:_.url))),m=[];for(const _ of a){const E=hl(_);if(!E||d.has(E))continue;const T=lv(_);T&&(!T.hasMeta&&!T.action||m.push({url:T.url||_,title:T.title||T.siteName||"Link",description:T.description||"",imageUrl:T.imageUrl||"",siteName:T.siteName||"",action:T.action||null,kind:T.kind||"",invite:T.invite||null}))}return m}function ib(s){if(!s)return"";try{const a=new Date(s);return Number.isNaN(a.getTime())?"":a.toLocaleDateString(void 0,{month:"short",year:"numeric"})}catch{return""}}function Cp(s,a){var M,A,G,K;const d=lv(s==null?void 0:s.url),m=(s==null?void 0:s.kind)==="opencom_invite"&&((M=s==null?void 0:s.invite)!=null&&M.code)?s:(d==null?void 0:d.kind)==="opencom_invite"&&((A=d==null?void 0:d.invite)!=null&&A.code)?{url:d.url||(s==null?void 0:s.url)||"",invite:d.invite}:null;if((G=m==null?void 0:m.invite)!=null&&G.code){const Y=m.invite,se=m.url||sf(Y.code),Ce=Number(Y.onlineCount||0),ee=Number(Y.memberCount||0),pe=ib(Y.serverCreatedAt),$e=Y.serverName||"Server",ke=Xt(Y.serverLogoUrl||"");return o.jsxs("div",{className:"message-invite-embed",children:[o.jsx("div",{className:"message-invite-hero",style:ke?{backgroundImage:`linear-gradient(180deg, rgba(12, 16, 27, 0.3), rgba(12, 16, 27, 0.95)), url(${ke})`}:void 0}),o.jsxs("div",{className:"message-invite-body",children:[o.jsxs("div",{className:"message-invite-header",children:[o.jsx("div",{className:"message-invite-icon",children:ke?o.jsx("img",{src:ke,alt:$e}):o.jsx("span",{children:Ir($e)})}),o.jsxs("div",{className:"message-invite-title-wrap",children:[o.jsx("strong",{children:$e}),o.jsxs("p",{className:"message-invite-stats",children:[o.jsx("span",{className:"dot online"})," ",Ce," Online",o.jsx("span",{className:"dot members"})," ",ee," Members"]}),pe&&o.jsxs("p",{className:"message-invite-established",children:["Est. ",pe]})]})]}),o.jsx("button",{type:"button",className:"message-invite-cta",onClick:Qe=>{Qe.preventDefault(),Qe.stopPropagation(),ll(Y.code)},children:"Go to Server"}),o.jsx("a",{className:"message-invite-link",href:se,target:"_blank",rel:"noreferrer",children:se})]})]},a)}const _=String((s==null?void 0:s.imageUrl)||(d==null?void 0:d.imageUrl)||"").trim(),E=!_&&cv(s==null?void 0:s.url)?String(s.url):"",T=_||E;return T?o.jsxs("a",{className:"message-image-link-embed",href:s.url,target:"_blank",rel:"noreferrer",onContextMenu:Y=>Y.stopPropagation(),children:[o.jsx("img",{src:T,alt:s.title||"Image",loading:"lazy"}),o.jsxs("div",{className:"message-image-link-meta",children:[o.jsx("strong",{children:s.title||"Image"}),o.jsx("p",{children:s.url})]})]},a):o.jsxs("a",{className:"message-embed-card",href:s.url,target:"_blank",rel:"noreferrer",children:[o.jsx("strong",{children:s.title||"Link"}),s.description&&o.jsx("p",{children:s.description}),o.jsx("p",{children:s.url}),((K=s.action)==null?void 0:K.label)&&o.jsx("small",{children:s.action.label})]},a)}function uv(s,a){const d=ta[s==null?void 0:s.id]||"",m=String((s==null?void 0:s.url)||""),_=cv(m)?m:"",E=d||_;return(xp((s==null?void 0:s.contentType)||"")||!!E)&&E?o.jsxs("div",{className:"message-image-attachment",title:"Right-click image to save",onContextMenu:M=>{M.stopPropagation()},children:[o.jsx("img",{src:E,alt:(s==null?void 0:s.fileName)||"Image attachment",loading:"lazy"}),o.jsxs("div",{className:"message-image-attachment-meta",children:[o.jsx("strong",{children:(s==null?void 0:s.fileName)||"Image"}),o.jsx("p",{children:(s==null?void 0:s.contentType)||"image"})]})]},a):o.jsxs("button",{type:"button",className:"message-embed-card message-embed-card-btn",onClick:M=>{M.stopPropagation(),QC(s)},children:[o.jsx("strong",{children:(s==null?void 0:s.fileName)||"Attachment"}),o.jsx("p",{children:(s==null?void 0:s.contentType)||"file"})]},a)}function pv(s){if(!s)return null;try{const a=new Date(s);return Number.isNaN(a.getTime())?null:a.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return null}}async function ob(s){var d;const a=(d=s.target.files)==null?void 0:d[0];a&&(Km(await a.text()),w(`Theme loaded: ${a.name}`))}function ab(){qg().catch(()=>{}),i(""),u(""),I([]),H(null),Q([]),Ct(!1),w("Logged out.")}return _r===wo?o.jsx(tR,{onBack:()=>Tn(r?cr:fr)}):r?o.jsxs("div",{className:"opencom-shell",children:[o.jsxs("aside",{className:"server-rail",children:[o.jsx("div",{className:"rail-header",title:"OpenCom",children:o.jsx("img",{src:"logo.png",alt:"OpenCom",className:"logo-img",style:{width:"100%",height:"100%",objectFit:"contain"}})}),ra&&(()=>{const s=xt.find(a=>a.id===ra.dmId);return s?o.jsxs("button",{type:"button",className:"dm-notification-popup",onClick:()=>{b("dms"),wr(ra.dmId),Yu(null)},children:[s.pfp_url?o.jsx("img",{src:Xt(s.pfp_url),alt:"",className:"dm-notification-avatar"}):o.jsx("div",{className:"dm-notification-avatar dm-notification-avatar-initials",children:Ir(s.name||s.username||"?")}),o.jsxs("span",{className:"dm-notification-text",children:["New message from ",s.name||s.username||"Someone"]})]}):null})(),o.jsx("button",{className:`server-pill nav-pill ${v==="friends"?"active":""}`,onClick:()=>b("friends"),title:"Friends",children:""}),o.jsx("button",{className:`server-pill nav-pill ${v==="dms"?"active":""}`,onClick:()=>b("dms"),title:"Direct messages",children:""}),o.jsx("button",{className:`server-pill nav-pill ${v==="profile"?"active":""}`,onClick:()=>b("profile"),title:"Profile",children:""}),o.jsxs("div",{className:"server-list",children:[k.map(s=>o.jsxs("button",{className:`server-pill ${s.id===F&&v==="servers"?"active":""}`,title:s.name,onClick:()=>{b("servers"),q(s.id),Z(""),H(null),Q([])},onContextMenu:a=>O0(a,s),children:[s.logoUrl?o.jsx("img",{src:Xt(s.logoUrl),alt:s.name,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"inherit"}}):Ir(s.name),(Wm[s.id]||0)>0&&o.jsx("span",{className:"server-pill-ping-badge",children:Wm[s.id]})]},s.id)),o.jsx("button",{className:"server-pill",title:"Create or join a server",onClick:()=>Ii(!0),children:""})]})]}),o.jsxs("aside",{className:`channel-sidebar ${ln?"voice-connected":""}`,children:[o.jsxs("header",{className:"sidebar-header",style:j!=null&&j.bannerUrl?{backgroundImage:`linear-gradient(rgba(10,16,30,0.72), rgba(10,16,30,0.86)), url(${Xt(j.bannerUrl)})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[o.jsx("h2",{children:v==="servers"?(j==null?void 0:j.name)||"No server":v.toUpperCase()}),o.jsx("small",{children:v==="servers"?(br==null?void 0:br.name)||"Choose a channel":"Unified communication hub"})]}),v==="servers"&&o.jsx(o.Fragment,{children:o.jsxs("section",{className:"sidebar-block channels-container",children:[Eg.map(({category:s,channels:a})=>{const d=$x[s.id];return o.jsxs("div",{className:"category-block",children:[o.jsxs("div",{className:"category-header-row",children:[o.jsxs("button",{className:`category-header ${$c===s.id?"channel-dragging":""}`,draggable:Pe&&s.id!=="uncategorized",onDragStart:()=>Pe&&s.id!=="uncategorized"&&Wu(s.id),onDragOver:m=>{m.preventDefault(),s.id!=="uncategorized"&&m.currentTarget.classList.add("channel-drop-target")},onDragLeave:m=>m.currentTarget.classList.remove("channel-drop-target"),onDrop:m=>{m.preventDefault(),m.currentTarget.classList.remove("channel-drop-target"),Pe&&$c&&s.id!=="uncategorized"&&$c!==s.id&&R0($c,s.id)},onDragEnd:()=>Wu(null),onClick:()=>M0(s.id),onContextMenu:m=>s.id!=="uncategorized"&&Pe&&U0(m,s),children:[o.jsx("span",{className:"chevron",children:d?"":""}),s.name]}),Pe&&s.id!=="uncategorized"&&o.jsxs("div",{className:"category-actions",children:[o.jsx("button",{type:"button",className:"channel-action-btn",title:"Create channel in category",onClick:m=>{m.stopPropagation(),Gi({fixedType:"text",fixedParentId:s.id})},children:""}),o.jsx("button",{type:"button",className:"channel-action-btn",title:"Category settings",onClick:m=>{m.stopPropagation(),ul(s)},children:""})]})]}),!d&&o.jsx("div",{className:"category-items",children:a.map(m=>{var _,E;return o.jsxs("div",{children:[o.jsxs("div",{className:"channel-row-wrap",children:[o.jsxs("button",{className:`channel-row ${m.id===te?"active":""} ${Uc===m.id?"channel-dragging":""}`,draggable:Pe,onDragStart:()=>Pe&&Hu(m.id),onDragOver:T=>{T.preventDefault(),T.currentTarget.classList.add("channel-drop-target")},onDragLeave:T=>T.currentTarget.classList.remove("channel-drop-target"),onDrop:T=>{T.preventDefault(),T.currentTarget.classList.remove("channel-drop-target"),Pe&&Uc&&Uc!==m.id&&T0(Uc,m.id,a)},onDragEnd:()=>Hu(null),onContextMenu:T=>Pe&&A0(T,m),onClick:()=>{if(m.type==="text"){me(m.id);return}m.type==="voice"&&Zg(m)},children:[o.jsx("span",{className:"channel-hash",children:m.type==="voice"?"":"#"}),o.jsxs("span",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:0},children:[o.jsx("span",{children:m.name}),m.type==="voice"&&(((_=sl.get(m.id))==null?void 0:_.length)||0)>0&&o.jsxs("span",{className:"hint",style:{fontSize:"11px"},children:[sl.get(m.id).length," connected"]})]})]}),Pe&&o.jsx("button",{type:"button",className:"channel-action-btn channel-row-cog",title:"Channel settings",onClick:T=>{T.stopPropagation(),ul(m)},children:""})]}),m.type==="voice"&&(((E=sl.get(m.id))==null?void 0:E.length)||0)>0&&o.jsx("div",{className:"voice-channel-members",children:sl.get(m.id).map(T=>{var A;const M=!!((A=ig[z])!=null&&A[T.userId]);return o.jsx("div",{className:"voice-channel-member-row",onContextMenu:G=>va(G,T),children:o.jsxs("div",{className:"voice-channel-member-main",children:[o.jsx("div",{className:`avatar member-avatar vc-avatar ${M?"speaking":""}`,children:T.pfp_url?o.jsx("img",{src:Xt(T.pfp_url),alt:T.username,className:"avatar-image"}):Ir(T.username)}),o.jsx("span",{className:"voice-channel-member-name",children:T.username}),o.jsx("span",{className:"voice-channel-member-icons",children:T.deafened?"":T.muted?"":""})]})},`${m.id}-${T.userId}`)})})]},m.id)})})]},s.id)}),!Eg.length&&o.jsx("p",{className:"hint",children:"No channels available. Create one in Settings."})]})}),v==="dms"&&o.jsxs("section",{className:"sidebar-block channels-container",children:[xt.map(s=>o.jsxs("button",{className:`channel-row dm-sidebar-row ${s.id===xe?"active":""}`,onClick:()=>wr(s.id),title:`DM ${s.name}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[Mi({userId:s.participantId||s.id,username:s.name,pfpUrl:s.pfp_url,size:28}),o.jsx("span",{className:"channel-hash",children:"@"}),o.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:s.name})]},s.id)),!xt.length&&o.jsx("p",{className:"hint",children:"Add friends to open direct message threads."})]}),v==="friends"&&o.jsxs("section",{className:"sidebar-block channels-container friend-sidebar-list",children:[_t.map(s=>o.jsxs("button",{className:"friend-row friend-sidebar-row",onClick:()=>cl(s),title:`Open ${s.username}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[Mi({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:28}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("strong",{children:s.username}),o.jsx("span",{className:"hint",children:aa(kn(s.id))})]})]},s.id)),!_t.length&&o.jsx("p",{className:"hint",children:"No friends yet. Use the Add Friend tab in the main panel."})]}),v==="profile"&&ne&&o.jsx("section",{className:"sidebar-block channels-container",children:o.jsxs("div",{className:"profile-preview",style:{backgroundImage:ne!=null&&ne.bannerUrl?`url(${Xt(ne.bannerUrl)})`:void 0},children:[o.jsx("div",{className:"avatar",children:Ir(ne.displayName||ne.username||"User")}),o.jsx("strong",{children:ne.displayName||ne.username}),o.jsxs("span",{children:["@",ne.username]}),o.jsx("small",{children:ne.platformTitle||"OpenCom Member"})]})}),o.jsxs("footer",{className:"self-card",children:[ln&&o.jsxs("div",{className:"voice-widget",children:[o.jsxs("div",{className:"voice-top",children:[o.jsx("strong",{children:"Voice Connected"}),o.jsx("span",{title:Sg,children:Sg})]}),o.jsxs("div",{className:"voice-actions voice-actions-modern",children:[o.jsx("button",{className:`voice-action-pill ${on?"active danger":""}`,title:on?"Unmute":"Mute",onClick:()=>Wo(s=>!s),children:on?"":""}),o.jsx("button",{className:`voice-action-pill ${Kt?"active danger":""}`,title:Kt?"Undeafen":"Deafen",onClick:()=>Ko(s=>!s),children:Kt?"":""}),o.jsx("button",{className:`voice-action-pill ${Ns?"active":""}`,title:Ns?"Stop screen share":"Start screen share",onClick:wp,children:Ns?"":""}),o.jsx("button",{className:"voice-action-pill danger",title:"Disconnect from voice",onClick:Sp,disabled:xu,children:xu?"":""}),o.jsx("button",{className:"voice-action-pill",title:"Voice settings",onClick:()=>{Ct(!0),qe("voice")},children:""})]}),!!bg.length&&o.jsx("div",{className:"voice-screen-grid",children:bg.map(s=>o.jsxs("div",{className:"voice-screen-tile",children:[o.jsx("video",{autoPlay:!0,playsInline:!0,title:"Click to view fullscreen",onClick:Z0,ref:a=>{!a||!s.stream||a.srcObject!==s.stream&&(a.srcObject=s.stream)}}),o.jsx("span",{children:ma.get(s.userId)||s.userId||"Screen Share"})]},s.producerId))})]}),o.jsxs("div",{className:"user-row",children:[Mi({userId:l==null?void 0:l.id,username:(l==null?void 0:l.username)||"OpenCom User",pfpUrl:ne==null?void 0:ne.pfpUrl,size:36}),o.jsxs("div",{className:"user-meta",children:[o.jsx("strong",{children:l==null?void 0:l.username}),o.jsx("span",{children:Pe?"Owner":"Member"})]}),o.jsxs("select",{className:"status-select",value:On,onChange:s=>Qx(s.target.value),title:"Your status",children:[o.jsx("option",{value:"online",children:"Online"}),o.jsx("option",{value:"idle",children:"Idle"}),o.jsx("option",{value:"dnd",children:"Do Not Disturb"}),o.jsx("option",{value:"invisible",children:"Invisible"})]}),o.jsxs("div",{className:"user-controls",children:[o.jsx("button",{className:`icon-btn ${on?"danger":"ghost"}`,onClick:()=>Wo(s=>!s),children:on?"":""}),o.jsx("button",{className:`icon-btn ${Kt?"danger":"ghost"}`,onClick:()=>Ko(s=>!s),children:Kt?"":""}),o.jsx("button",{className:"icon-btn ghost",onClick:()=>{Ct(!0),qe("profile")},children:""})]})]})]})]}),o.jsxs("main",{className:"chat-pane",children:[v==="servers"&&k.length===0&&o.jsxs("div",{className:"create-server-empty",style:{padding:"2rem",maxWidth:"420px",margin:"auto"},children:[o.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Create your server"}),o.jsx("p",{className:"hint",style:{marginBottom:"1rem"},children:"You get one server hosted by us. Name it and start customising channels and roles."}),o.jsx("input",{type:"text",value:Ps,onChange:s=>bu(s.target.value),placeholder:"Server name",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),o.jsx("input",{type:"text",value:Wr,onChange:s=>Yo(s.target.value),placeholder:"Logo URL (.png/.jpg/.webp/.svg)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Logo",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server logo",Yo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("input",{type:"text",value:Eu,onChange:s=>Jo(s.target.value),placeholder:"Banner URL (optional)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server banner",Jo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("button",{onClick:ev,disabled:!Ps.trim()||!Wr.trim(),children:"Create your server"})]}),v==="servers"&&k.length>0&&o.jsxs("div",{className:"chat-layout",children:[o.jsxs("section",{className:"chat-main",children:[o.jsxs("header",{className:"chat-header",children:[o.jsxs("h3",{children:[o.jsx("span",{className:"channel-hash",children:"#"})," ",(Ui==null?void 0:Ui.name)||"updates"]}),o.jsxs("div",{className:"chat-actions",children:[o.jsx("button",{className:"icon-btn ghost",title:"Pinned messages",onClick:()=>Im(s=>!s),children:""}),o.jsx("button",{className:"icon-btn ghost",title:"Threads",children:""}),o.jsx("button",{className:"icon-btn ghost",title:"Notifications",children:""}),o.jsx("button",{className:"icon-btn ghost",title:"Members",children:""}),o.jsx("input",{className:"search-input",placeholder:`Search ${(j==null?void 0:j.name)||"server"}`}),o.jsx("button",{className:"ghost",onClick:()=>{Ct(!0),qe("server")},children:"Open settings"})]})]}),Rm&&il.length>0&&o.jsx("div",{className:"pinned-strip",children:il.slice(0,3).map(s=>o.jsxs("div",{className:"pinned-item",children:[o.jsx("strong",{children:s.author}),o.jsx("span",{children:s.content})]},s.id))}),o.jsxs("div",{className:"messages",ref:Qc,children:[(()=>{let s="";return FC.map(a=>{const d=Tt.find(A=>A.id===a.authorId),_=((U==null?void 0:U.roles)||[]).filter(A=>((d==null?void 0:d.roleIds)||[]).includes(A.id)).sort((A,G)=>(G.position??0)-(A.position??0))[0],E=(_==null?void 0:_.color)!=null&&_.color!==""?typeof _.color=="number"?`#${Number(_.color).toString(16).padStart(6,"0")}`:_.color:null,T=Ww(a.firstMessageTime),M=!!T&&T!==s;return T&&(s=T),o.jsxs("div",{children:[M&&o.jsx("div",{className:"message-date-divider",children:o.jsx("span",{children:Kw(a.firstMessageTime)})}),o.jsxs("article",{className:"msg grouped-msg",children:[o.jsx("div",{className:"msg-avatar",children:a.pfpUrl?o.jsx("img",{src:Xt(a.pfpUrl),alt:a.author}):Ir(a.author||"User")}),o.jsxs("div",{className:"msg-body",children:[o.jsxs("strong",{className:"msg-author",children:[o.jsx("button",{className:"name-btn",style:E?{color:E}:void 0,onClick:()=>Wi({id:a.authorId,username:a.author,status:kn(a.authorId),pfp_url:a.pfpUrl}),onContextMenu:A=>va(A,{id:a.authorId,username:a.author,pfp_url:a.pfpUrl,roleIds:(d==null?void 0:d.roleIds)||[]}),children:a.author}),_&&o.jsx("span",{className:"msg-role-tag",children:_.name}),o.jsx("span",{className:"msg-time",children:Gw(a.firstMessageTime)})]}),a.messages.map(A=>{const G=dv(A);return o.jsxs("div",{onContextMenu:K=>tv(K,{id:A.id,kind:"server",author:a.author,content:A.content,mine:(A.author_id||A.authorId)===(l==null?void 0:l.id)}),children:[o.jsxs("p",{children:[il.some(K=>K.id===A.id)?" ":"",av(A)]}),Array.isArray(A==null?void 0:A.embeds)&&A.embeds.length>0&&o.jsx("div",{className:"message-embeds",children:A.embeds.map((K,Y)=>{var se;return o.jsxs("div",{className:"message-embed-card",children:[K.title&&o.jsx("strong",{children:K.title}),K.description&&o.jsx("p",{children:K.description}),K.url&&o.jsx("a",{href:K.url,target:"_blank",rel:"noreferrer",children:K.url}),((se=K.footer)==null?void 0:se.text)&&o.jsx("small",{children:K.footer.text})]},`${A.id}-embed-${Y}`)})}),Array.isArray(A==null?void 0:A.linkEmbeds)&&A.linkEmbeds.length>0&&o.jsx("div",{className:"message-embeds",children:A.linkEmbeds.map((K,Y)=>Cp(K,`${A.id}-link-${Y}`))}),G.length>0&&o.jsx("div",{className:"message-embeds",children:G.map((K,Y)=>Cp(K,`${A.id}-derived-link-${Y}`))}),Array.isArray(A==null?void 0:A.attachments)&&A.attachments.length>0&&o.jsx("div",{className:"message-embeds",children:A.attachments.map((K,Y)=>uv(K,`${A.id}-att-${Y}`))})]},A.id)})]})]})]},`group-wrap-${a.id}`)})})(),!X.length&&o.jsx("p",{className:"empty",children:"No messages yet. Start the conversation."})]}),na&&o.jsxs("div",{className:"reply-banner",children:[o.jsxs("span",{children:["Replying to ",na.author]}),o.jsx("button",{className:"ghost",onClick:()=>Du(null),children:"Cancel"})]}),o.jsxs("footer",{className:"composer server-composer",onClick:()=>{var s;return(s=la.current)==null?void 0:s.focus()},children:[o.jsx("button",{className:"ghost composer-icon",onClick:s=>{var a;s.stopPropagation(),(a=Oi.current)==null||a.click()},children:""}),o.jsx("input",{ref:Oi,type:"file",multiple:!0,style:{display:"none"},onChange:async s=>{const a=Array.from(s.target.files||[]);await Ng(a,"file picker")}}),o.jsxs("div",{className:"composer-input-wrap",children:[wn.length>0&&o.jsx("div",{className:"mention-suggestions",children:wn.map((s,a)=>o.jsxs("div",{className:"mention-suggestion",style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[o.jsx("span",{children:s.fileName||"attachment"}),o.jsx("button",{type:"button",className:"ghost",onClick:d=>{d.stopPropagation(),Es(m=>m.filter((_,E)=>E!==a))},children:"Remove"})]},`pending-att-${a}`))}),o.jsx("textarea",{ref:la,value:ae,onChange:s=>V(s.target.value),onPaste:s=>{var d;const a=Array.from(((d=s.clipboardData)==null?void 0:d.files)||[]).filter(m=>m&&m.size>0);a.length&&(s.preventDefault(),Ng(a,"clipboard").catch(()=>{}))},placeholder:`Message #${(Ui==null?void 0:Ui.name)||"channel"}`,onKeyDown:s=>{if(s.key==="ArrowDown"&&$n.length>0){s.preventDefault(),Kc(a=>(a+1)%$n.length);return}if(s.key==="ArrowUp"&&$n.length>0){s.preventDefault(),Kc(a=>(a-1+$n.length)%$n.length);return}if(s.key==="Escape"&&rl){s.preventDefault(),V("");return}if((s.key==="Tab"||s.key==="Enter"&&!s.shiftKey)&&$n.length>0){s.preventDefault();const a=$n[Math.min(fg,$n.length-1)]||$n[0];if(!a)return;V(`/${a.name} `);return}if(s.key==="Enter"&&!s.shiftKey){s.preventDefault(),Pg();return}if(s.key==="Tab"&&nl.length){s.preventDefault();const a=lf(ae);if(!a)return;const d=nl[0],m=ae.slice(0,a.start);V(`${m}@{${d}} `)}}}),rl&&o.jsxs("div",{className:"slash-command-suggestions",children:[o.jsxs("div",{className:"slash-command-header",children:["COMMANDS MATCHING /",(Fi||"").toUpperCase()]}),$n.length===0?o.jsx("div",{className:"slash-command-empty",children:"No commands found for this server."}):$n.map((s,a)=>o.jsxs("button",{type:"button",className:`slash-command-item ${a===fg?"active":""}`,onClick:d=>{var m;d.stopPropagation(),V(`/${s.name} `),Kc(a),(m=la.current)==null||m.focus()},children:[o.jsxs("div",{children:[o.jsxs("strong",{children:["/",s.name]}),o.jsx("p",{children:s.description||"No description provided."})]}),o.jsx("span",{children:s.extensionName||s.extensionId})]},s.name))]}),nl.length>0&&!rl&&o.jsx("div",{className:"mention-suggestions",children:nl.map(s=>o.jsxs("button",{type:"button",className:"mention-suggestion",onClick:a=>{var _;a.stopPropagation();const d=lf(ae);if(!d)return;const m=ae.slice(0,d.start);V(`${m}@{${s}} `),(_=la.current)==null||_.focus()},children:["@",s]},s))}),W&&!rl&&o.jsxs("div",{className:"emote-picker",children:[Object.entries(Fw).map(([s,a])=>o.jsxs("button",{type:"button",className:"emote-item",onClick:d=>{d.stopPropagation(),ov(s)},title:`:${s}:`,children:[o.jsx("span",{children:a}),o.jsxs("small",{children:[":",s,":"]})]},s)),((U==null?void 0:U.emotes)||[]).map(s=>o.jsxs("button",{type:"button",className:"emote-item",onClick:a=>{a.stopPropagation(),ov(String(s.name||"").toLowerCase())},title:`:${s.name}:`,children:[o.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:`:${s.name}:`}),o.jsxs("small",{children:[":",s.name,":"]})]},s.id||s.name))]})]}),o.jsx("button",{className:"ghost composer-icon",onClick:s=>{s.stopPropagation(),ie(a=>!a)},title:"Open emotes",children:""}),o.jsx("button",{className:"send-btn",onClick:Pg,disabled:!te||!ae.trim()&&wn.length===0,children:"Send"})]})]}),o.jsxs("aside",{className:"members-pane",children:[o.jsxs("h4",{children:["Members  ",Tt.length]}),(()=>{const s=new Map(((U==null?void 0:U.roles)||[]).map(E=>[E.id,E])),a=E=>(E.roleIds||[]).map(M=>s.get(M)).filter(Boolean).sort((M,A)=>(A.position??0)-(M.position??0))[0]||null,d=new Map;for(const E of Tt){const T=a(E),M=(T==null?void 0:T.id)??"__none__";d.has(M)||d.set(M,{role:T,members:[]}),d.get(M).members.push(E)}const m={id:"__none__",name:"No role",position:-1,color:null},_=Array.from(d.entries()).map(([E,{role:T,members:M}])=>({role:T||m,members:M}));return _.sort((E,T)=>(T.role.position??0)-(E.role.position??0)),_.map(({role:E,members:T})=>{const M=E.color!=null&&E.color!==""?typeof E.color=="number"?`#${Number(E.color).toString(16).padStart(6,"0")}`:E.color:null;return o.jsxs("div",{className:"members-role-section",children:[o.jsx("div",{className:"members-role-label",style:M?{color:M}:void 0,children:E.name}),T.map(A=>{var ee;const G=a(A),K=(G==null?void 0:G.color)!=null&&G.color!==""?typeof G.color=="number"?`#${Number(G.color).toString(16).padStart(6,"0")}`:G.color:null,Y=Zn.find(pe=>pe.userId===A.id),Ce=!!((Y==null?void 0:Y.channelId)&&Y.channelId===Jt)&&!!((ee=ig[z])!=null&&ee[A.id]);return o.jsxs("button",{className:"member-row",title:`View ${A.username}`,onClick:pe=>{pe.stopPropagation(),Wi(A)},onContextMenu:pe=>va(pe,A),children:[o.jsx("div",{className:Ce?"speaking":"",children:Mi({userId:A.id,username:A.username,pfpUrl:A.pfp_url,size:32})}),o.jsxs("div",{children:[o.jsx("strong",{style:K?{color:K}:void 0,children:A.username}),o.jsx("span",{children:Y?`${Y.deafened?"":Y.muted?"":""} In voice`:aa(kn(A.id))})]})]},A.id)})]},E.id)})})(),!Tt.length&&o.jsx("p",{className:"hint",children:"No visible members yet."})]})]}),v==="dms"&&o.jsxs("section",{className:"chat-main",children:[o.jsxs("header",{className:"chat-header dm-header-actions",children:[o.jsx("h3",{children:Ue?`@ ${Ue.name}`:"Direct Messages"}),o.jsx("div",{className:"chat-actions",children:o.jsx("button",{className:"icon-btn ghost",onClick:()=>Im(s=>!s),title:"Pinned DMs",children:""})})]}),Rm&&ol.length>0&&o.jsx("div",{className:"pinned-strip",children:ol.slice(0,3).map(s=>o.jsxs("div",{className:"pinned-item",children:[o.jsx("strong",{children:s.author}),o.jsx("span",{children:s.content})]},s.id))}),o.jsxs("div",{className:"messages",ref:ca,children:[(()=>{let s="";return BC.map(a=>{const d=Ww(a.firstMessageTime),m=!!d&&d!==s;return d&&(s=d),o.jsxs("div",{children:[m&&o.jsx("div",{className:"message-date-divider",children:o.jsx("span",{children:Kw(a.firstMessageTime)})}),o.jsxs("article",{className:"msg dm-msg grouped-msg",children:[o.jsx("div",{className:"msg-avatar",children:a.pfpUrl?o.jsx("img",{src:Xt(a.pfpUrl),alt:a.author}):Ir(a.author)}),o.jsxs("div",{className:"msg-body",children:[o.jsxs("strong",{className:"msg-author",children:[o.jsx("button",{className:"name-btn",onClick:()=>Wi({id:a.authorId,username:a.author,status:kn(a.authorId),pfp_url:a.pfpUrl}),onContextMenu:_=>va(_,{id:a.authorId,username:a.author,pfp_url:a.pfpUrl}),children:a.author}),o.jsx("span",{className:"msg-time",children:Gw(a.firstMessageTime)})]}),a.messages.map(_=>{const E=dv(_);return o.jsxs("div",{onContextMenu:T=>tv(T,{id:_.id,kind:"dm",author:_.author,content:_.content,mine:_.authorId===(l==null?void 0:l.id)}),children:[o.jsxs("p",{children:[ol.some(T=>T.id===_.id)?" ":"",av(_)]}),E.length>0&&o.jsx("div",{className:"message-embeds",children:E.map((T,M)=>Cp(T,`${_.id}-dm-derived-link-${M}`))}),Array.isArray(_==null?void 0:_.attachments)&&_.attachments.length>0&&o.jsx("div",{className:"message-embeds",children:_.attachments.map((T,M)=>uv(T,`${_.id}-dm-att-${M}`))})]},_.id)})]})]})]},`dm-group-wrap-${a.id}`)})})(),!Ue&&o.jsx("p",{className:"empty",children:"Select a DM on the left."})]}),Xo&&o.jsxs("div",{className:"reply-banner",children:[o.jsxs("span",{children:["Replying to ",Xo.author]}),o.jsx("button",{className:"ghost",onClick:()=>Nc(null),children:"Cancel"})]}),o.jsxs("footer",{className:"composer dm-composer",onClick:()=>{var s;return(s=gg.current)==null?void 0:s.focus()},children:[o.jsx("textarea",{ref:gg,value:Sc,onChange:s=>du(s.target.value),placeholder:`Message ${(Ue==null?void 0:Ue.name)||"friend"}`,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Lg())}}),o.jsx("button",{className:"send-btn",onClick:Lg,disabled:!Ue||!Sc.trim(),children:"Send"})]})]}),v==="friends"&&o.jsxs("div",{className:"friends-surface",children:[o.jsxs("section",{className:"friends-main",children:[o.jsxs("header",{className:"friends-header",children:[o.jsx("h3",{children:"Friends"}),o.jsxs("div",{className:"friends-tabs",children:[o.jsx("button",{className:Mn==="online"?"active":"ghost",onClick:()=>Ot("online"),children:"Online"}),o.jsx("button",{className:Mn==="all"?"active":"ghost",onClick:()=>Ot("all"),children:"All"}),o.jsx("button",{className:Mn==="add"?"active":"ghost",onClick:()=>Ot("add"),children:"Add Friend"}),o.jsx("button",{className:Mn==="requests"?"active":"ghost",onClick:()=>Ot("requests"),children:"Requests"})]})]}),o.jsx("input",{placeholder:"Search friends",value:tt,onChange:s=>Rs(s.target.value)}),Mn==="add"&&o.jsxs("div",{className:"friend-add-card",children:[o.jsx("h4",{children:"Add Friend"}),o.jsx("p",{className:"hint",children:"Type the username and send your request instantly."}),o.jsxs("div",{className:"friend-add-row",children:[o.jsx("input",{placeholder:"Username",value:Br,onChange:s=>zr(s.target.value)}),o.jsx("button",{onClick:YC,children:"Send Request"})]})]}),Mn==="requests"&&o.jsxs("div",{className:"friend-add-card",children:[o.jsx("h4",{children:"Friend Requests"}),kc.incoming.map(s=>o.jsxs("div",{className:"friend-row",children:[o.jsxs("div",{className:"friend-meta",children:[o.jsx("strong",{children:s.username}),o.jsx("span",{children:"Incoming request"})]}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{onClick:()=>Dg(s.id,"accept"),children:"Accept"}),o.jsx("button",{className:"ghost",onClick:()=>Dg(s.id,"decline"),children:"Decline"})]})]},s.id)),kc.outgoing.map(s=>o.jsx("div",{className:"friend-row",children:o.jsxs("div",{className:"friend-meta",children:[o.jsx("strong",{children:s.username}),o.jsx("span",{children:"Pending"})]})},s.id)),!kc.incoming.length&&!kc.outgoing.length&&o.jsx("p",{className:"hint",children:"No pending friend requests."})]}),(Mn==="online"?tl.filter(s=>kn(s.id)!=="offline"):tl).map(s=>o.jsxs("div",{className:"friend-row",children:[o.jsxs("div",{className:"friend-row-main",children:[Mi({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:32}),o.jsxs("div",{className:"friend-meta",children:[o.jsx("strong",{children:s.username}),o.jsx("span",{children:aa(kn(s.id))})]})]}),o.jsx("button",{className:"ghost",onClick:a=>{a.stopPropagation(),cl(s)},children:"Message"})]},s.id))]}),o.jsxs("aside",{className:"active-now",children:[o.jsx("h4",{children:"Active Now"}),tl.slice(0,5).map(s=>o.jsx("button",{className:"active-card",onClick:a=>{a.stopPropagation(),Wi(s)},children:o.jsxs("div",{className:"friend-row-main",children:[Mi({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:30}),o.jsxs("div",{className:"friend-meta",children:[o.jsx("strong",{children:s.username}),o.jsx("span",{children:kn(s.id)==="online"?"Available now":aa(kn(s.id))})]})]})},`active-${s.id}`)),!tl.length&&o.jsx("p",{className:"hint",children:"When friends are active, they will appear here."})]})]}),v==="profile"&&o.jsxs("div",{className:"profile-studio profile-studio-full-page",style:{fontSize:`${Math.max(.8,Math.min(1.5,el/100))}rem`},children:[o.jsxs("section",{className:"profile-studio-header card",children:[o.jsxs("div",{children:[o.jsx("h3",{children:"Profile Studio"}),o.jsx("p",{className:"hint",children:"Full-page profile builder with drag and drop editing."})]}),o.jsxs("div",{className:"profile-studio-scale",children:[o.jsxs("label",{children:["UI Scale (",el,"%)",o.jsx("input",{type:"range",min:80,max:150,value:uu?el:gm,onChange:s=>{mm(!1),Px(Number(s.target.value))}})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:uu,onChange:s=>mm(s.target.checked)})," Auto scale for my resolution"]})]}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{type:"button",className:"ghost",onClick:g0,children:"Reset"}),o.jsx("button",{type:"button",onClick:v0,children:"Save Full Profile"})]})]}),o.jsxs("section",{className:"profile-studio-layout",children:[o.jsxs("aside",{className:"card profile-studio-panel",children:[o.jsx("h4",{children:"Identity"}),o.jsxs("label",{children:["Display Name",o.jsx("input",{value:_e.displayName,onChange:s=>_n(a=>({...a,displayName:s.target.value}))})]}),o.jsxs("label",{children:["Bio",o.jsx("textarea",{rows:3,value:_e.bio,onChange:s=>_n(a=>({...a,bio:s.target.value}))})]}),o.jsxs("label",{children:["Avatar URL",o.jsx("input",{value:_e.pfpUrl,onChange:s=>_n(a=>({...a,pfpUrl:s.target.value}))})]}),o.jsxs("label",{children:["Upload Avatar",o.jsx("input",{type:"file",accept:"image/*",onChange:rv})]}),o.jsxs("label",{children:["Banner URL",o.jsx("input",{value:_e.bannerUrl,onChange:s=>_n(a=>({...a,bannerUrl:s.target.value}))})]}),o.jsxs("label",{children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:sv})]}),o.jsx("button",{type:"button",onClick:Og,children:"Save Identity"}),o.jsx("h4",{children:"Add Elements"}),o.jsxs("div",{className:"profile-studio-tool-grid",children:[o.jsx("button",{type:"button",className:"ghost",onClick:()=>zi("avatar"),children:"Avatar"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>zi("banner"),children:"Banner"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>zi("name"),children:"Name"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>zi("bio"),children:"Bio"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>zi("links"),children:"Links"}),o.jsx("button",{type:"button",className:"ghost",onClick:p0,children:"Text"})]}),!fa&&o.jsx("p",{className:"hint",children:"Boost is required to save custom layouts."})]}),o.jsxs("section",{className:"card profile-studio-canvas-wrap",children:[o.jsxs("div",{className:"profile-studio-canvas-head",children:[o.jsx("h4",{children:"Canvas"}),o.jsx("p",{className:"hint",children:"Drag elements directly to place them."})]}),o.jsxs("div",{ref:xc,className:`full-profile-canvas profile-studio-canvas ${fa?"":"locked"}`,style:{background:((gv=ce==null?void 0:ce.theme)==null?void 0:gv.background)||"linear-gradient(150deg, #16274b, #0f1a33 65%)",color:((vv=ce==null?void 0:ce.theme)==null?void 0:vv.text)||"#dfe9ff",minHeight:`${Math.max(420,Math.min(900,Math.round((pu.height-320)*Math.max(.86,Math.min(1.2,el/100)))))}px`},children:[o.jsx("div",{className:"full-profile-canvas-card",style:{background:((yv=ce==null?void 0:ce.theme)==null?void 0:yv.card)||"rgba(9, 14, 28, 0.62)"},children:((ce==null?void 0:ce.elements)||[]).slice().sort((s,a)=>(s.order??0)-(a.order??0)).map(s=>o.jsx("div",{className:`full-profile-element full-profile-element-${s.type} ${_c===s.id?"dragging":""} ${Vr===s.id?"selected":""}`,style:{left:`${s.x}%`,top:`${s.y}%`,width:`${s.w}%`,height:`${s.h}%`},onMouseDown:a=>{fa&&y0(a,s.id)},onClick:()=>Is(s.id),children:iv(s,AC)},s.id))}),!fa&&o.jsxs("div",{className:"full-profile-lock-overlay",children:[o.jsx("p",{children:"Boost required for full customization."}),o.jsx("button",{type:"button",onClick:()=>openBoostUpsell("Boost required","Custom full profiles are a Boost perk.","Open billing"),children:"See Boost"})]})]})]}),o.jsxs("aside",{className:"card profile-studio-panel",children:[o.jsx("h4",{children:"Inspector"}),rt?o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"hint",children:["Editing: ",o.jsx("strong",{children:rt.type})]}),rt.type==="text"&&o.jsxs("label",{children:["Text",o.jsx("input",{value:rt.text||"",onChange:s=>mp(rt.id,{text:s.target.value})})]}),o.jsxs("label",{children:["X",o.jsx("input",{type:"range",min:0,max:100,value:Math.round(rt.x),onChange:s=>Vi(rt.id,{x:s.target.value})})]}),o.jsxs("label",{children:["Y",o.jsx("input",{type:"range",min:0,max:100,value:Math.round(rt.y),onChange:s=>Vi(rt.id,{y:s.target.value})})]}),o.jsxs("label",{children:["Width",o.jsx("input",{type:"range",min:1,max:100,value:Math.round(rt.w),onChange:s=>Vi(rt.id,{w:s.target.value})})]}),o.jsxs("label",{children:["Height",o.jsx("input",{type:"range",min:1,max:100,value:Math.round(rt.h),onChange:s=>Vi(rt.id,{h:s.target.value})})]}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{type:"button",className:"ghost",onClick:()=>Vi(rt.id,{order:Number(rt.order||0)+1}),children:"Bring Forward"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>Vi(rt.id,{order:Number(rt.order||0)-1}),children:"Send Back"}),rt.type==="text"&&o.jsx("button",{type:"button",className:"danger",onClick:()=>f0(rt.id),children:"Remove"})]})]}):o.jsx("p",{className:"hint",children:"Select an element on the canvas."}),o.jsx("h4",{children:"Theme"}),o.jsxs("label",{children:["Canvas Background",o.jsx("input",{value:((wv=ce==null?void 0:ce.theme)==null?void 0:wv.background)||"",onChange:s=>at(a=>({...a,mode:"custom",theme:{...a.theme||{},background:s.target.value}}))})]}),o.jsxs("label",{children:["Card Surface",o.jsx("input",{value:((Sv=ce==null?void 0:ce.theme)==null?void 0:Sv.card)||"",onChange:s=>at(a=>({...a,mode:"custom",theme:{...a.theme||{},card:s.target.value}}))})]}),o.jsxs("label",{children:["Text Color",o.jsx("input",{value:((_v=ce==null?void 0:ce.theme)==null?void 0:_v.text)||"",onChange:s=>at(a=>({...a,mode:"custom",theme:{...a.theme||{},text:s.target.value}}))})]}),o.jsx("h4",{children:"Links"}),((ce==null?void 0:ce.links)||[]).map(s=>o.jsxs("div",{className:"full-profile-link-editor",children:[o.jsx("input",{value:s.label||"",placeholder:"Label",onChange:a=>Ag(s.id,{label:a.target.value})}),o.jsx("input",{value:s.url||"",placeholder:"https://...",onChange:a=>Ag(s.id,{url:a.target.value})}),o.jsx("button",{type:"button",className:"danger",onClick:()=>m0(s.id),children:"Remove"})]},s.id)),o.jsx("button",{type:"button",className:"ghost",onClick:h0,children:"Add Link"}),o.jsx("h4",{children:"Profile Music"}),o.jsxs("label",{children:["Music URL (MP3/WAV/OGG/M4A)",o.jsx("input",{value:((xv=ce==null?void 0:ce.music)==null?void 0:xv.url)||"",placeholder:"https://... or /v1/profile-images/users/...",onChange:s=>at(a=>({...a,mode:"custom",music:{...a.music||{},url:s.target.value}}))})]}),o.jsxs("label",{children:["Upload Music",o.jsx("input",{type:"file",accept:"audio/mpeg,audio/mp3,audio/wav,audio/x-wav,audio/ogg,audio/mp4,audio/x-m4a",onChange:s=>nb(s,"profile music",a=>at(d=>({...d,mode:"custom",music:{...d.music||{},url:a}})))})]}),o.jsxs("label",{children:["Volume (",Math.max(0,Math.min(100,Number(((Cv=ce==null?void 0:ce.music)==null?void 0:Cv.volume)??60))),"%)",o.jsx("input",{type:"range",min:0,max:100,value:Math.max(0,Math.min(100,Number(((bv=ce==null?void 0:ce.music)==null?void 0:bv.volume)??60))),onChange:s=>at(a=>({...a,mode:"custom",music:{...a.music||{},volume:Number(s.target.value)}}))})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!((Ev=ce==null?void 0:ce.music)!=null&&Ev.autoplay),onChange:s=>at(a=>({...a,mode:"custom",music:{...a.music||{},autoplay:s.target.checked}}))})," Autoplay when opened"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:((kv=ce==null?void 0:ce.music)==null?void 0:kv.loop)!==!1,onChange:s=>at(a=>({...a,mode:"custom",music:{...a.music||{},loop:s.target.checked}}))})," Loop track"]})]})]})]})]}),nt&&o.jsxs("div",{className:"server-context-menu",style:{top:nt.y,left:nt.x},onClick:s=>s.stopPropagation(),children:[nt.message.kind==="server"&&o.jsx("button",{onClick:()=>{Du({author:nt.message.author,content:nt.message.content}),an(null)},children:"Reply"}),nt.message.kind==="dm"&&o.jsx("button",{onClick:()=>{Nc({author:nt.message.author,content:nt.message.content}),an(null)},children:"Reply"}),o.jsx("button",{onClick:()=>{K0(nt.message),an(null)},children:nt.message.pinned?"Unpin":"Pin"}),nt.message.kind==="dm"&&o.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(nt.message.content||""),w("Copied message text.")}catch{w("Could not copy message text.")}an(null)},children:"Copy Text"}),(nt.message.mine||MC)&&nt.message.kind==="server"&&o.jsx("button",{className:"danger",onClick:()=>H0(nt.message.id),children:"Delete"}),nt.message.mine&&nt.message.kind==="dm"&&o.jsx("button",{className:"danger",onClick:()=>W0(nt.message.id),children:"Delete"})]}),Qt&&o.jsxs("div",{className:"server-context-menu",style:{top:Qt.y,left:Qt.x},onClick:s=>s.stopPropagation(),children:[(()=>{var m;const s=(m=Qt.member)==null?void 0:m.id,a=s?zC.get(s):null,d=kg(s);return o.jsxs(o.Fragment,{children:[(a==null?void 0:a.channelId)&&o.jsxs("button",{className:"ghost",disabled:!0,children:["In voice: ",a.channelId]}),o.jsx("button",{onClick:()=>{Tg(s,{muted:!d.muted}),w(d.muted?"Local voice unmuted for member.":"Local voice muted for member."),ct(null)},children:d.muted?"Local Unmute":"Local Mute"}),o.jsxs("button",{onClick:async()=>{await VC(s),ct(null)},children:["Local Volume (",d.volume,"%)"]}),(a==null?void 0:a.channelId)&&s!==(l==null?void 0:l.id)&&PC&&o.jsx("button",{className:a.muted?"danger":"ghost",onClick:async()=>{await Xg(a.channelId,s,{muted:!a.muted}),ct(null)},children:a.muted?"Server Unmute":"Server Mute"}),(a==null?void 0:a.channelId)&&s!==(l==null?void 0:l.id)&&LC&&o.jsx("button",{className:a.deafened?"danger":"ghost",onClick:async()=>{await Xg(a.channelId,s,{deafened:!a.deafened}),ct(null)},children:a.deafened?"Server Undeafen":"Server Deafen"}),(a==null?void 0:a.channelId)&&s!==(l==null?void 0:l.id)&&DC&&o.jsx("button",{className:"danger",onClick:async()=>{await eb(a.channelId,s),ct(null)},children:"Disconnect From VC"})]})})(),o.jsx("button",{onClick:()=>{Wi(Qt.member),ct(null)},children:"View Profile"}),o.jsx("button",{onClick:()=>{cl({id:Qt.member.id,username:Qt.member.username||Qt.member.id}),ct(null)},children:"Message"}),o.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(Qt.member.id||""),w("User ID copied.")}catch{w("Could not copy user ID.")}ct(null)},children:"Copy User ID"}),pa&&Qt.member.id!==(l==null?void 0:l.id)&&o.jsx("button",{className:"danger",onClick:async()=>{await gp(Qt.member.id),ct(null)},children:"Kick Member"}),qr&&Qt.member.id!==(l==null?void 0:l.id)&&o.jsx("button",{className:"danger",onClick:async()=>{await vp(Qt.member.id,""),ct(null)},children:"Ban Member"}),pp&&o.jsx("button",{onClick:()=>{Nm(Qt.member.id||""),Ct(!0),qe("moderation"),ct(null)},children:"Open Moderation Panel"})]}),Cn&&o.jsxs("div",{className:"server-context-menu",style:{top:Cn.y,left:Cn.x},onClick:s=>s.stopPropagation(),children:[o.jsx("button",{onClick:()=>z0(Cn.server.id),children:"Open Server"}),Pe&&Cn.server.id===F&&!!Yt&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{Gi({fixedType:"text"}),bt(null)},children:"Create Text Channel"}),o.jsx("button",{onClick:()=>{Gi({fixedType:"voice"}),bt(null)},children:"Create Voice Channel"}),o.jsx("button",{onClick:()=>{Gi({fixedType:"category"}),bt(null)},children:"Create Category"})]}),o.jsx("button",{onClick:()=>Yg(Cn.server.id,"up"),children:"Move Up"}),o.jsx("button",{onClick:()=>Yg(Cn.server.id,"down"),children:"Move Down"}),o.jsx("button",{onClick:()=>{vm(Cn.server.id),Ct(!0),qe("invites"),bt(null)},children:"Create Invite"}),o.jsx("button",{onClick:()=>B0(Cn.server.id),children:"Copy Server ID"}),o.jsx("button",{onClick:()=>{Ct(!0),qe("server"),bt(null)},children:"Server Settings"}),o.jsx("button",{className:"danger",onClick:()=>V0(Cn.server),children:"Leave Server"}),(Cn.server.roles||[]).includes("owner")&&o.jsx("button",{className:"danger",onClick:()=>G0(Cn.server),children:"Delete Server"})]}),Ds&&o.jsxs("div",{className:"server-context-menu",style:{top:Ds.y,left:Ds.x},onClick:s=>s.stopPropagation(),children:[Pe&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>ul(Ds.channel),children:"Edit Channel"}),o.jsx("button",{onClick:()=>{rg(Ds.channel.id),Ct(!0),qe("server"),An(null)},children:"Permissions"})]}),o.jsx("button",{onClick:()=>{me(Ds.channel.id),An(null)},children:"Open"}),Pe&&o.jsx("button",{className:"danger",onClick:()=>Qg(Ds.channel),children:"Delete"})]}),Ms&&o.jsx("div",{className:"server-context-menu",style:{top:Ms.y,left:Ms.x},onClick:s=>s.stopPropagation(),children:Pe&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{Gi({fixedType:"text",fixedParentId:Ms.category.id}),Un(null)},children:"Create Text Channel"}),o.jsx("button",{onClick:()=>{Gi({fixedType:"voice",fixedParentId:Ms.category.id}),Un(null)},children:"Create Voice Channel"}),o.jsx("button",{onClick:()=>ul(Ms.category),children:"Edit Category"}),o.jsx("button",{className:"danger",onClick:()=>Qg(Ms.category),children:"Delete Category"})]})}),iC&&o.jsx("div",{className:"settings-overlay",onClick:()=>Ii(!1),children:o.jsxs("div",{className:"add-server-modal",onClick:s=>s.stopPropagation(),children:[o.jsxs("header",{className:"add-server-modal-header",children:[o.jsx("h3",{style:{margin:0},children:"Create or join a server"}),o.jsxs("div",{className:"add-server-tabs",children:[o.jsx("button",{type:"button",className:ji==="join"?"active":"ghost",onClick:()=>Lu("join"),children:"Join"}),o.jsx("button",{type:"button",className:ji==="custom"?"active":"ghost",onClick:()=>Lu("custom"),children:"Add host"}),o.jsx("button",{type:"button",className:ji==="create"?"active":"ghost",onClick:()=>Lu("create"),children:"Create yours"}),_g&&o.jsx("a",{href:"/server-admin.html",target:"_blank",rel:"noopener noreferrer",className:"add-server-admin-link",onClick:s=>s.stopPropagation(),children:" Admin"})]})]}),o.jsxs("div",{className:"add-server-content",children:[ji==="join"&&o.jsxs("section",{className:"card",children:[o.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Paste an invite code or full join link. Invite links are previewed and need explicit accept."}),o.jsx("input",{placeholder:"Invite code or join link",value:Gr??"",onChange:s=>Go(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsxs("div",{className:"row-actions",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[o.jsx("button",{className:"ghost",onClick:Fg,children:"Preview"}),o.jsx("button",{onClick:()=>ll(Jn||Gr),children:"Accept Invite"})]}),sn&&o.jsxs("p",{className:"hint",style:{marginTop:"0.5rem"},children:["Invite: ",sn.code,"  Server: ",sn.serverName||sn.server_id,"  Uses: ",sn.uses]})]}),ji==="custom"&&o.jsxs("section",{className:"card",children:[o.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Connect to a server node by URL (self-hosted or provider)."}),o.jsx("input",{placeholder:"Server name",value:wi??"",onChange:s=>hu(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsx("input",{placeholder:"https://node.example.com",value:Si??"https://",onChange:s=>mu(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:_i??"",onChange:s=>zo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server logo",zo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("input",{placeholder:"Banner URL (optional)",value:gu??"",onChange:s=>Vo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server banner",Vo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("button",{onClick:Ug,disabled:!wi.trim()||!Si.trim()||!_i.trim(),children:"Add Server"})]}),ji==="create"&&o.jsxs("section",{className:"card",children:[o.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"One server hosted by usname it and customize channels and roles."}),o.jsx("input",{placeholder:"Server name",value:Ps??"",onChange:s=>bu(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Wr??"",onChange:s=>Yo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server logo",Yo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("input",{placeholder:"Banner URL (optional)",value:Eu??"",onChange:s=>Jo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),o.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server banner",Jo),style:{width:"100%",marginTop:"0.35rem"}})]}),o.jsx("button",{onClick:ev,disabled:!(Ps!=null&&Ps.trim())||!(Wr!=null&&Wr.trim()),children:"Create your server"})]})]}),o.jsx("button",{type:"button",className:"danger",style:{width:"100%",marginTop:"0.5rem"},onClick:()=>Ii(!1),children:"Close"})]})}),ge&&o.jsxs("div",{className:"member-profile-popout",style:{right:ki.x,bottom:ki.y},onClick:s=>s.stopPropagation(),onContextMenu:s=>va(s,ge),children:[o.jsx("div",{className:"popout-drag-handle",onMouseDown:D0,children:"Drag"}),o.jsx("div",{className:"popout-banner",style:{backgroundImage:ge.bannerUrl?`url(${Xt(ge.bannerUrl)})`:void 0}}),o.jsxs("div",{className:"popout-content",children:[o.jsx("div",{className:"avatar popout-avatar",children:ge.pfpUrl?o.jsx("img",{src:Xt(ge.pfpUrl),alt:"Profile avatar",className:"avatar-image"}):Ir(ge.displayName||ge.username||"User")}),o.jsx("h4",{children:ge.displayName||ge.username}),o.jsxs("p",{className:"hint",children:["@",ge.username,"  ",aa(kn(ge==null?void 0:ge.id)||(ge==null?void 0:ge.status)||"offline")]}),ge.platformTitle&&o.jsx("p",{className:"hint",children:ge.platformTitle}),pv(ge.createdAt)&&o.jsxs("p",{className:"hint",children:["Account created: ",pv(ge.createdAt)]}),Array.isArray(ge.badgeDetails)&&ge.badgeDetails.length>0&&o.jsx("div",{className:"popout-roles",children:ge.badgeDetails.map((s,a)=>{const d=sb(s);return o.jsx("span",{className:"popout-role-tag",title:d.name,style:{backgroundColor:d.bgColor,color:d.fgColor,borderColor:d.bgColor},children:d.icon},`${s.id||s.name||"badge"}-${a}`)})}),((Tv=ge.roleIds)==null?void 0:Tv.length)>0&&(U==null?void 0:U.roles)&&o.jsx("div",{className:"popout-roles",children:(U.roles||[]).filter(s=>(ge.roleIds||[]).includes(s.id)&&!s.is_everyone).sort((s,a)=>(a.position??0)-(s.position??0)).map(s=>{const a=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return o.jsx("span",{className:"popout-role-tag",style:{backgroundColor:a+"22",color:a,borderColor:a},children:s.name},s.id)})}),o.jsx("p",{children:ge.bio||"No bio set."}),(()=>{const s=CC(ge.id);return s?o.jsxs("div",{className:"message-embed-card",style:{marginTop:"8px",marginBottom:"8px"},children:[s.largeImageUrl&&o.jsx("img",{src:s.largeImageUrl,alt:s.largeImageText||"Activity",style:{width:"100%",borderRadius:"8px",marginBottom:"6px"}}),o.jsx("strong",{children:s.name||"Activity"}),s.details&&o.jsx("p",{children:s.details}),s.state&&o.jsx("p",{children:s.state}),Array.isArray(s.buttons)&&s.buttons.length>0&&o.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"6px"},children:s.buttons.map((a,d)=>o.jsx("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"ghost",style:{padding:"4px 8px",borderRadius:"8px",border:"1px solid var(--border-subtle)",textDecoration:"none",color:"var(--text-soft)"},children:a.label},`${a.url}-${d}`))})]}):null})(),o.jsxs("div",{className:"popout-actions",children:[o.jsx("button",{className:"ghost",onClick:()=>cl({id:ge.id,username:ge.username}),children:"Message"}),o.jsx("button",{className:"ghost",onClick:()=>rb(ge),children:"View Full Profile"}),pa&&ge.id!==(l==null?void 0:l.id)&&o.jsx("button",{className:"ghost",onClick:()=>gp(ge.id),children:"Kick"}),qr&&ge.id!==(l==null?void 0:l.id)&&o.jsx("button",{className:"danger",onClick:()=>vp(ge.id,""),children:"Ban"}),o.jsx("button",{onClick:()=>Os(null),children:"Close"})]})]})]}),Wt&&o.jsx("div",{className:"settings-overlay",onClick:()=>Bo(null),children:o.jsxs("div",{className:"full-profile-viewer-fullscreen",onClick:s=>s.stopPropagation(),children:[o.jsxs("div",{className:"full-profile-viewer-head",children:[o.jsxs("h3",{children:[Wt.displayName||Wt.username,"'s Full Profile"]}),o.jsx("button",{className:"danger",onClick:()=>Bo(null),children:"Close"})]}),o.jsx("div",{className:"full-profile-canvas full-profile-canvas-readonly full-profile-viewer-canvas",style:{background:((Iv=(Rv=Wt.fullProfile)==null?void 0:Rv.theme)==null?void 0:Iv.background)||"linear-gradient(150deg, #16274b, #0f1a33 65%)",color:((Nv=(jv=Wt.fullProfile)==null?void 0:jv.theme)==null?void 0:Nv.text)||"#dfe9ff"},children:o.jsx("div",{className:"full-profile-canvas-card",style:{background:((Lv=(Pv=Wt.fullProfile)==null?void 0:Pv.theme)==null?void 0:Lv.card)||"rgba(9, 14, 28, 0.62)"},children:(((Dv=Wt.fullProfile)==null?void 0:Dv.elements)||[]).slice().sort((s,a)=>(s.order??0)-(a.order??0)).map(s=>o.jsx("div",{className:`full-profile-element full-profile-element-${s.type}`,style:{left:`${s.x}%`,top:`${s.y}%`,width:`${s.w}%`,height:`${s.h}%`},children:iv(s,Wt)},s.id))})}),((Ov=(Mv=Wt.fullProfile)==null?void 0:Mv.music)==null?void 0:Ov.url)&&o.jsxs("div",{className:"full-profile-viewer-audio",children:[o.jsx("strong",{children:"Profile Music"}),o.jsx("audio",{controls:!0,src:Xt(Wt.fullProfile.music.url)||Wt.fullProfile.music.url,autoPlay:!!Wt.fullProfile.music.autoplay,loop:Wt.fullProfile.music.loop!==!1,preload:"metadata",style:{width:"100%"},onLoadedMetadata:s=>{var a,d;try{s.currentTarget.volume=Math.max(0,Math.min(1,Number(((d=(a=Wt.fullProfile)==null?void 0:a.music)==null?void 0:d.volume)??60)/100))}catch{}}})]})]})}),Et&&o.jsx("div",{className:"settings-overlay",onClick:()=>ua(Et.type==="confirm"?!1:null),children:o.jsxs("div",{className:"add-server-modal opencom-dialog-modal",onClick:s=>s.stopPropagation(),children:[o.jsx("h3",{children:Et.title}),o.jsx("p",{className:"hint opencom-dialog-message",children:Et.message}),Et.type==="prompt"&&o.jsx("input",{ref:op,value:Et.value,onChange:s=>Qu(a=>a&&{...a,value:s.target.value}),onKeyDown:s=>{s.key==="Escape"&&(s.preventDefault(),ua(null)),s.key==="Enter"&&(s.preventDefault(),ua(Et.value))}}),o.jsxs("div",{className:"row-actions opencom-dialog-actions",children:[Et.type!=="alert"&&o.jsx("button",{className:"ghost",onClick:()=>ua(Et.type==="confirm"?!1:null),children:Et.cancelLabel||"Cancel"}),o.jsx("button",{onClick:()=>ua(Et.type==="prompt"?Et.value:!0),children:Et.confirmLabel||"OK"})]})]})}),Pc&&o.jsx("div",{className:"settings-overlay",onClick:()=>Lc(null),children:o.jsxs("div",{className:"add-server-modal boost-upsell-modal",onClick:s=>s.stopPropagation(),children:[o.jsx("h3",{children:Pc.title}),o.jsx("p",{className:"hint",children:Pc.reason}),o.jsxs("div",{className:"row-actions boost-actions",children:[o.jsx("button",{onClick:n0,children:Pc.cta}),o.jsx("button",{className:"ghost",onClick:()=>Lc(null),children:"Maybe later"})]})]})}),Ti&&o.jsx("div",{className:"settings-overlay",onClick:()=>Ri(null),children:o.jsxs("div",{className:"add-server-modal boost-upsell-modal",onClick:s=>s.stopPropagation(),children:[o.jsx("h3",{children:"Redeem Boost Gift?"}),o.jsxs("p",{className:"hint",children:[o.jsx("strong",{children:((Av=Ti.from)==null?void 0:Av.username)||"Someone"})," sent you ",Ti.grantDays||30," days of Boost."]}),o.jsxs("p",{className:"hint",children:["This gift expires on ",Ti.expiresAt?new Date(Ti.expiresAt).toLocaleDateString():"soon","."]}),o.jsxs("div",{className:"row-actions boost-actions",children:[o.jsx("button",{onClick:()=>t0(Ti.code),disabled:$m,children:$m?"Redeeming":"Accept Gift"}),o.jsx("button",{className:"ghost",onClick:()=>Ri(null),children:"Not now"})]})]})}),Ls&&o.jsx("div",{className:"settings-overlay",onClick:()=>Ct(!1),children:o.jsxs("div",{className:"settings-panel",onClick:s=>s.stopPropagation(),children:[o.jsxs("aside",{className:"settings-nav",children:[o.jsx("h3",{children:"Settings"}),o.jsx("button",{className:Ne==="profile"?"active":"ghost",onClick:()=>qe("profile"),children:"Profile"}),o.jsx("button",{className:Ne==="security"?"active":"ghost",onClick:()=>{qe("security"),JC()},children:" Security"}),o.jsx("button",{className:Ne==="billing"?"active":"ghost",onClick:()=>{qe("billing"),ga(),Bi()},children:" Billing"}),o.jsx("button",{className:Ne==="server"?"active":"ghost",onClick:()=>qe("server"),children:"Server"}),o.jsx("button",{className:Ne==="roles"?"active":"ghost",onClick:()=>qe("roles"),children:"Roles"}),pp&&o.jsx("button",{className:Ne==="moderation"?"active":"ghost",onClick:()=>qe("moderation"),children:"Moderation"}),o.jsx("button",{className:Ne==="invites"?"active":"ghost",onClick:()=>qe("invites"),children:"Invites"}),o.jsx("button",{className:Ne==="appearance"?"active":"ghost",onClick:()=>qe("appearance"),children:"Appearance"}),o.jsx("button",{className:Ne==="extensions"?"active":"ghost",onClick:()=>qe("extensions"),children:"Extensions"}),o.jsx("button",{className:Ne==="voice"?"active":"ghost",onClick:()=>qe("voice"),children:"Voice"}),_g&&o.jsx("a",{href:"/server-admin.html",target:"_blank",style:{display:"block",padding:"var(--space-sm) var(--space-md)",background:"rgba(149, 168, 205, 0.12)",border:"1px solid rgba(125, 164, 255, 0.25)",borderRadius:"calc(var(--radius) * 0.9)",color:"var(--text-main)",textDecoration:"none",textAlign:"center",fontWeight:"500",cursor:"pointer",fontSize:"0.95em"},children:" Server Admin Panel"}),o.jsx("button",{className:"danger",onClick:()=>Ct(!1),children:"Close"}),o.jsx("button",{className:"danger",onClick:ab,children:"Log out"})]}),o.jsxs("section",{className:"settings-content",children:[Ne==="profile"&&o.jsxs("div",{className:"card",children:[o.jsx("h4",{children:"Profile Settings"}),o.jsxs("label",{children:["Display Name",o.jsx("input",{value:_e.displayName,onChange:s=>_n(a=>({...a,displayName:s.target.value}))})]}),o.jsxs("label",{children:["Bio",o.jsx("textarea",{rows:4,value:_e.bio,onChange:s=>_n(a=>({...a,bio:s.target.value}))})]}),o.jsxs("label",{children:["Avatar URL",o.jsx("input",{value:_e.pfpUrl,onChange:s=>_n(a=>({...a,pfpUrl:s.target.value}))})]}),o.jsxs("label",{children:["Upload Avatar",o.jsx("input",{type:"file",accept:"image/*",onChange:rv})]}),o.jsxs("label",{children:["Banner URL",o.jsx("input",{value:_e.bannerUrl,onChange:s=>_n(a=>({...a,bannerUrl:s.target.value}))})]}),o.jsxs("label",{children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:sv})]}),o.jsx("button",{onClick:Og,children:"Save Profile"}),o.jsx("hr",{style:{borderColor:"var(--border-subtle)",width:"100%"}}),o.jsx("h4",{children:"Full Profile Studio"}),o.jsx("p",{className:"hint",children:"Use the dedicated Profile page for drag-and-drop full profile customization."}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>{Ct(!1),b("profile")},children:"Open Profile Studio"}),o.jsx("hr",{style:{borderColor:"var(--border-subtle)",width:"100%"}}),o.jsx("h4",{children:"Rich Presence (RPC-style)"}),o.jsx("p",{className:"hint",children:"No app ID needed. Set activity text, image URLs, and optional buttons."}),o.jsxs("label",{children:["Activity Name",o.jsx("input",{value:xn.name,onChange:s=>At(a=>({...a,name:s.target.value})),placeholder:"Playing OpenCom"})]}),o.jsxs("label",{children:["Details",o.jsx("input",{value:xn.details,onChange:s=>At(a=>({...a,details:s.target.value})),placeholder:"In a voice channel"})]}),o.jsxs("label",{children:["State",o.jsx("input",{value:xn.state,onChange:s=>At(a=>({...a,state:s.target.value})),placeholder:"With friends"})]}),o.jsxs("label",{children:["Large Image URL",o.jsx("input",{value:xn.largeImageUrl,onChange:s=>At(a=>({...a,largeImageUrl:s.target.value})),placeholder:"https://..."})]}),o.jsxs("label",{children:["Upload Large Image",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"large image",a=>At(d=>({...d,largeImageUrl:a})))})]}),o.jsxs("label",{children:["Large Image Text",o.jsx("input",{value:xn.largeImageText,onChange:s=>At(a=>({...a,largeImageText:s.target.value})),placeholder:"Tooltip text"})]}),o.jsxs("label",{children:["Small Image URL",o.jsx("input",{value:xn.smallImageUrl,onChange:s=>At(a=>({...a,smallImageUrl:s.target.value})),placeholder:"https://..."})]}),o.jsxs("label",{children:["Upload Small Image",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"small image",a=>At(d=>({...d,smallImageUrl:a})))})]}),o.jsxs("label",{children:["Small Image Text",o.jsx("input",{value:xn.smallImageText,onChange:s=>At(a=>({...a,smallImageText:s.target.value})),placeholder:"Tooltip text"})]}),o.jsxs("label",{children:["Button 1 Label",o.jsx("input",{value:xn.button1Label,onChange:s=>At(a=>({...a,button1Label:s.target.value})),placeholder:"Watch"})]}),o.jsxs("label",{children:["Button 1 URL",o.jsx("input",{value:xn.button1Url,onChange:s=>At(a=>({...a,button1Url:s.target.value})),placeholder:"https://..."})]}),o.jsxs("label",{children:["Button 2 Label",o.jsx("input",{value:xn.button2Label,onChange:s=>At(a=>({...a,button2Label:s.target.value})),placeholder:"Join"})]}),o.jsxs("label",{children:["Button 2 URL",o.jsx("input",{value:xn.button2Url,onChange:s=>At(a=>({...a,button2Url:s.target.value})),placeholder:"https://..."})]}),o.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[o.jsx("button",{onClick:w0,children:"Save Rich Presence"}),o.jsx("button",{className:"ghost",onClick:S0,children:"Clear"})]})]}),Ne==="server"&&o.jsxs(o.Fragment,{children:[j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Server Branding"}),o.jsx("input",{placeholder:"Server name",value:yi.name??"",onChange:s=>js(a=>({...a,name:s.target.value}))}),o.jsx("input",{placeholder:"Logo URL",value:yi.logoUrl??"",onChange:s=>js(a=>({...a,logoUrl:s.target.value}))}),o.jsxs("label",{children:["Upload Logo",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server logo",a=>js(d=>({...d,logoUrl:a})))})]}),o.jsx("input",{placeholder:"Banner URL",value:yi.bannerUrl??"",onChange:s=>js(a=>({...a,bannerUrl:s.target.value}))}),o.jsxs("label",{children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server banner",a=>js(d=>({...d,bannerUrl:a})))})]}),o.jsx("button",{onClick:_0,children:"Save Server Profile"})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Add Server Provider"}),o.jsx("input",{placeholder:"Server name",value:wi??"",onChange:s=>hu(s.target.value)}),o.jsx("input",{placeholder:"https://node.provider.tld",value:Si??"https://",onChange:s=>mu(s.target.value)}),o.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:_i??"",onChange:s=>zo(s.target.value)}),o.jsxs("label",{children:["Upload Logo",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server logo",zo)})]}),o.jsx("input",{placeholder:"Banner URL (optional)",value:gu??"",onChange:s=>Vo(s.target.value)}),o.jsxs("label",{children:["Upload Banner",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"server banner",Vo)})]}),o.jsx("button",{onClick:Ug,disabled:!wi.trim()||!Si.trim()||!_i.trim(),children:"Add Server"})]}),j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Voice Gateway Routing"}),o.jsx("p",{className:"hint",children:"Default is OpenCom core gateway. Switch to self-hosted to reduce latency for your server."}),o.jsxs("label",{children:["Voice Gateway Mode",o.jsxs("select",{value:Rg.mode,onChange:s=>$g({mode:s.target.value==="server"?"server":"core"}),children:[o.jsx("option",{value:"core",children:"OpenCom Core (default)"}),o.jsx("option",{value:"server",children:"Self-hosted/Server-first"})]})]}),o.jsxs("label",{children:["Optional custom gateway URL",o.jsx("input",{placeholder:"https://gateway.yourserver.tld",value:Rg.customUrl,onChange:s=>$g({customUrl:s.target.value})})]}),o.jsx("p",{className:"hint",children:"Client fallback order follows this mode and automatically tries the other gateways if one fails."})]}),j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Create Workspace"}),o.jsx("input",{placeholder:"Workspace name",value:Ho??"",onChange:s=>Cm(s.target.value)}),o.jsx("button",{onClick:x0,children:"Create Workspace"})]}),j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Create Channel"}),o.jsx("input",{placeholder:"New channel/category",value:Su??"",onChange:s=>Sm(s.target.value)}),o.jsxs("select",{value:Ec??"text",onChange:s=>Ax(s.target.value),children:[o.jsx("option",{value:"text",children:"Text Channel"}),o.jsx("option",{value:"voice",children:"Voice Channel"}),o.jsx("option",{value:"category",children:"Category"})]}),Ec!=="category"&&o.jsxs("select",{value:_m??"",onChange:s=>xm(s.target.value),children:[o.jsx("option",{value:"",children:"No category"}),(ha||[]).map(s=>o.jsx("option",{value:(s==null?void 0:s.id)??"",children:(s==null?void 0:s.name)??"Category"},(s==null?void 0:s.id)??""))]}),o.jsx("button",{onClick:b0,children:"Create Channel"})]}),j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Custom Emotes"}),o.jsxs("p",{className:"hint",children:["Use emotes in chat with ",o.jsx("code",{children:":name:"}),"."]}),o.jsx("input",{placeholder:"Emote name (example: hype)",value:fe,onChange:s=>we(s.target.value)}),o.jsx("input",{placeholder:"Emote image URL (.png/.gif/.webp/.svg)",value:et,onChange:s=>Ee(s.target.value)}),o.jsxs("label",{children:["Upload Emote Image",o.jsx("input",{type:"file",accept:"image/*",onChange:s=>dn(s,"emote image",Ee)})]}),o.jsx("button",{onClick:E0,children:"Create Emote"}),o.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:((U==null?void 0:U.emotes)||[]).map(s=>o.jsxs("li",{children:[o.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[o.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:s.name}),o.jsxs("code",{children:[":",s.name,":"]})]}),o.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>k0(s.id),children:"Remove"})]},s.id))})]}),j&&Pe&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Channel permissions"}),o.jsx("p",{className:"hint",children:"Choose a channel and set which roles can send messages there. By default everyone can send."}),o.jsxs("select",{value:Fc,onChange:s=>rg(s.target.value),children:[o.jsx("option",{value:"",children:"Select channel"}),($i||[]).filter(s=>s.type==="text").map(s=>o.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]}),Fc&&o.jsx("ul",{className:"channel-perms-role-list",children:((U==null?void 0:U.roles)||[]).filter(s=>!s.is_everyone).sort((s,a)=>(a.position??0)-(s.position??0)).map(s=>o.jsx("li",{children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:j0(Fc,s.id),onChange:a=>I0(Fc,s.id,a.target.checked)}),o.jsx("span",{className:"channel-perms-role-name",style:{color:s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5"},children:s.name}),o.jsx("span",{className:"hint",children:" can send here"})]})},s.id))})]}),Ne==="server"&&!j&&k.length>0&&o.jsx("p",{className:"hint",children:"Select a server from the sidebar to manage workspaces and channels."})]}),Ne==="roles"&&Pe&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Create Role"}),o.jsx("input",{placeholder:"Role name",value:Tu,onChange:s=>jm(s.target.value)}),o.jsx("button",{onClick:N0,children:"Create Role"})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Edit Roles (colour & hierarchy)"}),o.jsx("p",{className:"hint",children:"Higher position = higher in the list. Colours show in member list and chat."}),o.jsx("ul",{className:"role-edit-list",children:((U==null?void 0:U.roles)||[]).filter(s=>!s.is_everyone).sort((s,a)=>(a.position??0)-(s.position??0)).map(s=>{const a=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return o.jsxs("li",{className:"role-edit-row",children:[o.jsx("span",{className:"role-edit-name",style:{color:a},children:s.name}),o.jsx("input",{type:"color",value:a,onChange:d=>Kg(s.id,{color:d.target.value}),title:"Role colour"}),o.jsxs("label",{children:["Position ",o.jsx("input",{type:"number",min:0,value:s.position??0,onChange:d=>Kg(s.id,{position:parseInt(d.target.value,10)||0})})]})]},s.id)})})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Assign Role"}),o.jsxs("select",{value:Iu,onChange:s=>Xx(s.target.value),children:[o.jsx("option",{value:"",children:"Select member"}),Tt.map(s=>o.jsx("option",{value:s.id,children:s.username},s.id))]}),o.jsxs("select",{value:Ru,onChange:s=>qx(s.target.value),children:[o.jsx("option",{value:"",children:"Select role"}),((U==null?void 0:U.roles)||[]).filter(s=>!s.is_everyone).map(s=>o.jsx("option",{value:s.id,children:s.name},s.id))]}),o.jsx("button",{onClick:P0,children:"Assign Role"})]})]}),Ne==="moderation"&&pp&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Member moderation"}),o.jsx("p",{className:"hint",children:"Kick removes a member from this guild. Ban removes and blocks rejoin until unbanned."}),o.jsxs("select",{value:qo,onChange:s=>Nm(s.target.value),children:[o.jsx("option",{value:"",children:"Select member"}),Tt.filter(s=>s.id!==(l==null?void 0:l.id)).map(s=>o.jsx("option",{value:s.id,children:s.username},s.id))]}),qr&&o.jsx("input",{placeholder:"Ban reason (optional)",value:Pm,onChange:s=>Zx(s.target.value)}),o.jsxs("div",{className:"row-actions",children:[pa&&o.jsx("button",{disabled:!qo||bi,onClick:()=>gp(qo),children:"Kick Member"}),qr&&o.jsx("button",{className:"danger",disabled:!qo||bi,onClick:()=>vp(qo,Pm),children:"Ban Member"})]})]}),qr&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Unban user"}),o.jsx("p",{className:"hint",children:"Paste a user ID and remove their ban record."}),o.jsx("input",{placeholder:"User ID to unban",value:ju,onChange:s=>Lm(s.target.value)}),o.jsx("button",{disabled:!ju.trim()||bi,onClick:()=>L0(ju.trim()),children:"Unban User"})]})]}),Ne==="invites"&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Join Server"}),o.jsx("input",{placeholder:"Paste invite code or join link",value:Gr,onChange:s=>Go(s.target.value)}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{className:"ghost",onClick:Fg,children:"Preview"}),o.jsx("button",{onClick:()=>ll(Jn||Gr),children:"Accept Invite"})]}),sn&&o.jsxs("p",{className:"hint",children:["Invite: ",sn.code,"  Server: ",sn.serverName||sn.server_id,"  Uses: ",sn.uses]})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Create Invite"}),o.jsxs("p",{className:"hint",children:["Boost perk: custom code + permanent invite links (example: ",o.jsx("code",{children:"/join/Open"}),")."]}),o.jsxs("select",{value:vu,onChange:s=>vm(s.target.value),children:[o.jsx("option",{value:"",children:"Select server"}),k.map(s=>o.jsx("option",{value:s.id,children:s.name},s.id))]}),o.jsx("input",{placeholder:"Custom code (Boost perk, optional)",value:yu,onChange:s=>wm(s.target.value),onFocus:()=>{Ke&&!Ke.active&&al("Custom invite codes require OpenCom Boost.")}}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:wu,onChange:s=>{if(s.target.checked&&Ke&&!Ke.active){al("Permanent invite links require OpenCom Boost.");return}Ox(s.target.checked)}}),"Permanent invite (Boost perk)"]}),o.jsx("button",{onClick:C0,children:"Generate Invite"}),Cc&&o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"hint",children:["Code: ",o.jsx("code",{children:Cc})]}),o.jsx("p",{className:"hint",children:"Invite link (share this):"}),o.jsxs("div",{className:"invite-link-row",children:[o.jsx("input",{readOnly:!0,className:"invite-link-input",value:ym||sf(Cc)}),o.jsx("button",{type:"button",onClick:()=>{const s=ym||sf(Cc);navigator.clipboard.writeText(s).then(()=>w("Invite link copied.")).catch(()=>w("Could not copy."))},children:"Copy link"})]})]})]})]}),Ne==="extensions"&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Client Extensions"}),o.jsx("p",{className:"hint",children:"Enable reviewed client-only extensions from the catalog. Extensions run in your client session."}),lg.length?o.jsx("ul",{className:"channel-perms-role-list",children:lg.map(s=>{const a=sa.includes(s.id);return o.jsxs("li",{children:[o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a,onChange:d=>jC(s.id,d.target.checked)}),o.jsx("strong",{children:s.name}),o.jsxs("span",{className:"hint",children:["  ",s.id,"  ",s.version||"0.1.0"]}),o.jsx("span",{className:"hint",style:{marginLeft:"6px",color:a?"#4ec97e":"#f0a4a4"},children:a?"Enabled":"Disabled"})]}),s.description&&o.jsx("p",{className:"hint",style:{margin:"4px 0 0 24px"},children:s.description}),Hc[s.id]&&o.jsxs("p",{className:"hint",style:{margin:"2px 0 0 24px"},children:["Status: ",Hc[s.id]]})]},s.id)})}):o.jsx("p",{className:"hint",children:"No client extensions found in the catalog."})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Developer Mode"}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:Di,onChange:s=>xC(s.target.checked)}),"Enable local/testing extension URLs"]}),o.jsx("p",{className:"hint",children:"Use this while developing extensions. Add one URL per extension entry script."}),Di&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"row-actions",style:{marginTop:"8px"},children:[o.jsx("input",{placeholder:"http://localhost:5174/my-extension.js",value:ug,onChange:s=>pg(s.target.value),style:{flex:1}}),o.jsx("button",{onClick:NC,children:"Add URL"})]}),o.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:ia.map(s=>o.jsxs("li",{children:[o.jsx("span",{style:{wordBreak:"break-all"},children:s}),o.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>dg(a=>a.filter(d=>d!==s)),children:"Remove"}),Hc[`dev:${s}`]&&o.jsxs("p",{className:"hint",style:{margin:"4px 0 0 0"},children:["Status: ",Hc[`dev:${s}`]]})]},s))})]})]})]}),Ne==="appearance"&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Custom CSS Theme"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:aC,onChange:s=>cC(s.target.checked)})," Enable custom CSS"]}),o.jsx("input",{type:"file",accept:"text/css,.css",onChange:ob}),o.jsx("textarea",{value:oC,onChange:s=>Km(s.target.value),rows:10,placeholder:"Paste custom CSS"}),o.jsxs("div",{className:"row-actions",style:{width:"100%",marginTop:"0.5rem"},children:[o.jsx("button",{type:"button",className:"ghost",onClick:()=>window.open("/theme-catalog.html","_blank","noopener,noreferrer"),children:"Open Theme Catalogue"}),o.jsx("button",{type:"button",className:"ghost",onClick:()=>window.open("/theme-creator.html","_blank","noopener,noreferrer"),children:"Open Theme Creator"})]})]}),Ne==="voice"&&o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Voice Settings"}),o.jsxs("label",{children:["Input Device",o.jsxs("select",{value:Sr,onChange:s=>Em(s.target.value),children:[o.jsx("option",{value:"",children:"System default"}),Gx.map(s=>o.jsx("option",{value:s.deviceId,children:s.label||`Microphone ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),o.jsxs("label",{children:["Output Device",o.jsxs("select",{value:Hr,onChange:s=>km(s.target.value),children:[o.jsx("option",{value:"",children:"System default"}),Wx.map(s=>o.jsx("option",{value:s.deviceId,children:s.label||`Speaker ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),o.jsxs("label",{children:["Microphone Gain (",Rc,"%)",o.jsx("input",{type:"range",min:"0",max:"200",step:"5",value:Rc,onChange:s=>Bx(Number(s.target.value))})]}),o.jsxs("label",{children:["Mic Sensitivity (",xi,"%)",o.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:xi,onChange:s=>zx(Number(s.target.value))})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:Ci,onChange:s=>Vx(s.target.checked)})," ","Noise Suppression"]}),Qo&&o.jsxs("p",{className:"hint",children:["Noise suppression requested: ",(Uv=Qo.requested)!=null&&Uv.noiseSuppression?"On":"Off","  ","applied: ",(($v=Qo.applied)==null?void 0:$v.noiseSuppression)==null?"Unknown":Qo.applied.noiseSuppression?"On":"Off",(Fv=Qo.supported)!=null&&Fv.noiseSuppression?"":" (not supported by this browser/device)"]}),o.jsx("p",{className:"hint",children:"Hotkeys: Ctrl/Cmd+Shift+M mute, Ctrl/Cmd+Shift+D deafen, Ctrl/Cmd+Shift+V screen share, Ctrl/Cmd+Shift+X disconnect, Ctrl/Cmd+Shift+, settings."}),o.jsx("p",{className:"hint",children:"Tip: allow microphone permissions so device names show properly."})]}),Ne==="billing"&&o.jsxs("section",{className:"card boost-card",children:[o.jsxs("div",{className:"boost-hero",children:[o.jsx("span",{className:`boost-pill ${Ke!=null&&Ke.active?"active":""}`,children:Ke!=null&&Ke.active?"BOOST ACTIVE":"BOOST INACTIVE"}),o.jsx("h4",{children:"OpenCom Boost"}),o.jsx("p",{className:"hint",children:"Unlock custom invite codes, permanent invite links, and higher limits."})]}),o.jsxs("div",{className:"boost-grid",children:[o.jsxs("div",{className:"boost-price",children:[o.jsx("strong",{children:"10"}),o.jsx("span",{children:"/ month"})]}),o.jsxs("ul",{className:"boost-perks",children:[o.jsx("li",{children:"Custom invite code slugs"}),o.jsx("li",{children:"Permanent invite links"}),o.jsx("li",{children:"100MB upload limit"}),o.jsx("li",{children:"Unlimited servers"})]})]}),rC&&o.jsx("p",{className:"hint",children:"Loading billing status"}),Ke&&o.jsxs("p",{className:"hint",children:["Status: ",Ke.active?"Active":"Inactive",Ke.currentPeriodEnd?`  Renews ${new Date(Ke.currentPeriodEnd).toLocaleDateString()}`:""]}),Ke&&!Ke.stripeConfigured&&o.jsx("p",{className:"hint",children:"Stripe is not configured on this server yet."}),o.jsxs("div",{className:"row-actions boost-actions",children:[o.jsx("button",{onClick:qC,children:"Get Boost"}),o.jsx("button",{className:"ghost",onClick:XC,children:"Manage"}),o.jsx("button",{className:"ghost",onClick:ga,children:"Refresh"})]}),o.jsx("hr",{className:"boost-divider"}),o.jsxs("div",{className:"boost-gift-head",children:[o.jsx("h5",{children:"Gift Boost (1 month)"}),o.jsx("p",{className:"hint",children:"Buy a one-month gift link and send it to a friend."})]}),o.jsxs("div",{className:"row-actions boost-actions boost-gift-actions",children:[o.jsx("button",{onClick:ZC,disabled:Bm,children:Bm?"Opening checkout":"Buy Gift (10)"}),o.jsx("button",{className:"ghost",onClick:Bi,children:"Refresh Gifts"})]}),o.jsxs("div",{className:"invite-link-row",children:[o.jsx("input",{className:"invite-link-input",placeholder:"Paste boost gift link or code",value:Nu,onChange:s=>Dc(s.target.value)}),o.jsx("button",{type:"button",onClick:()=>Mg(Nu),disabled:Am,children:Am?"Checking":"Preview"})]}),Zo&&o.jsxs("div",{className:"boost-gift-preview",children:[o.jsxs("p",{className:"hint",children:["Gift from ",o.jsx("strong",{children:((Bv=Zo.from)==null?void 0:Bv.username)||"someone"}),"  ",Zo.grantDays," day(s)"]}),o.jsxs("p",{className:"hint",children:["Expires ",new Date(Zo.expiresAt).toLocaleDateString()]}),o.jsx("button",{onClick:()=>Ri(Zo),children:"Redeem Gift"})]}),Vm.length>0&&o.jsxs("div",{className:"boost-gift-list",children:[o.jsx("p",{className:"hint",children:"Your recent gifts"}),Vm.slice(0,5).map(s=>o.jsxs("div",{className:"boost-gift-row",children:[o.jsx("span",{children:s.status.toUpperCase()}),o.jsx("input",{readOnly:!0,value:s.joinUrl||Ew(s.code)}),o.jsx("button",{type:"button",onClick:()=>{const a=s.joinUrl||Ew(s.code);navigator.clipboard.writeText(a).then(()=>w("Gift link copied.")).catch(()=>w("Could not copy gift link."))},children:"Copy"})]},s.id))]})]}),Ne==="security"&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{className:"card security-card",children:[o.jsx("h4",{children:" Account Security"}),o.jsxs("div",{className:"security-info",children:[o.jsxs("p",{className:"hint",children:["Last login: ",new Date(Jm.date).toLocaleString()]}),o.jsxs("p",{className:"hint",children:["Device: ",Jm.device]})]})]}),o.jsxs("section",{className:"card security-card",children:[o.jsx("h4",{children:" Change Password"}),dC?o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Current Password",o.jsx("input",{type:"password",value:Qm,onChange:s=>$u(s.target.value)})]}),o.jsxs("label",{children:["New Password",o.jsx("input",{type:"password",value:Mc,onChange:s=>Fu(s.target.value)})]}),o.jsxs("label",{children:["Confirm Password",o.jsx("input",{type:"password",value:Ym,onChange:s=>Bu(s.target.value)})]}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{className:"ghost",onClick:()=>{Uu(!1),$u(""),Fu(""),Bu("")},children:"Cancel"}),o.jsx("button",{onClick:async()=>{if(Mc!==Ym){w("Passwords do not match.");return}if(Mc.length<8){w("Password must be at least 8 characters.");return}try{await le("/v1/auth/password",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({currentPassword:Qm,newPassword:Mc})}),w("Password changed successfully."),Uu(!1),$u(""),Fu(""),Bu("")}catch(s){w(`Could not change password: ${s.message}`)}},children:"Update Password"})]})]}):o.jsx("button",{onClick:()=>Uu(!0),children:"Change Password"})]}),o.jsxs("section",{className:"card security-card",children:[o.jsx("h4",{children:" Two-Factor Authentication"}),o.jsx("p",{className:"hint",children:"Secure your account with an additional authentication layer"}),!tg.twoFactorEnabled&&!eg&&o.jsx("button",{onClick:i0,children:"Enable 2FA"}),eg&&!hC&&o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"hint",style:{marginTop:"var(--space-sm)",fontWeight:600},children:" Step 1: Scan QR Code"}),o.jsx("p",{className:"hint",children:"Scan this QR code with an authenticator app (Google Authenticator, Authy, Microsoft Authenticator, etc.):"}),qm&&o.jsx("img",{src:qm,alt:"2FA QR Code",style:{width:"200px",height:"200px",border:"2px solid rgba(125, 164, 255, 0.3)",borderRadius:"var(--radius)",margin:"var(--space-sm) 0",background:"#fff",padding:"0.5em"}}),o.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 2: Verify Token"}),o.jsx("p",{className:"hint",children:"Enter a 6-digit code from your authenticator app:"}),o.jsx("input",{type:"text",placeholder:"000000",value:Zm,onChange:s=>Vu(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:"6",style:{textAlign:"center",fontSize:"1.2em",letterSpacing:"0.3em",fontFamily:"monospace"}}),o.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 3: Save Backup Codes"}),o.jsx("p",{className:"hint",children:"Save these backup codes somewhere safe. You can use them to regain access if you lose your authenticator."}),o.jsx("code",{style:{display:"block",background:"var(--bg-input)",padding:"var(--space-sm)",borderRadius:"calc(var(--radius)*0.8)",fontSize:"0.85em",marginBottom:"var(--space-sm)",whiteSpace:"pre-wrap",wordBreak:"break-all",fontFamily:"monospace",lineHeight:"1.8"},children:Xm.map(s=>`${s}
`).join("")}),o.jsxs("div",{className:"row-actions",children:[o.jsx("button",{className:"ghost",onClick:()=>{Ac(!1),zu(""),Oc([]),Vu("")},children:"Cancel"}),o.jsx("button",{onClick:d0,children:"Verify & Enable 2FA"})]})]}),tg.twoFactorEnabled&&o.jsxs(o.Fragment,{children:[o.jsx("p",{style:{color:"var(--green)",fontWeight:600,marginTop:"var(--space-sm)"},children:" 2FA is enabled"}),o.jsx("p",{className:"hint",children:"Your account is protected with two-factor authentication. Your backup codes are stored securely."}),o.jsx("button",{className:"danger",onClick:u0,style:{marginTop:"var(--space-sm)"},children:"Disable 2FA"})]})]}),o.jsxs("section",{className:"card security-card",children:[o.jsx("h4",{children:" Active Sessions"}),o.jsx("p",{className:"hint",children:"Devices where you're logged in. Sign out of any session you don't recognize."}),uC.map(s=>o.jsxs("div",{className:"session-item",children:[o.jsxs("div",{className:"session-info",children:[o.jsx("strong",{children:s.device}),o.jsx("span",{className:"hint",children:s.location}),o.jsxs("span",{className:"hint",children:["Last active: ",s.lastActive]})]}),o.jsx("button",{className:s.status==="active"?"ghost":"danger",onClick:()=>w(`Session ${s.device} would be signed out.`),children:s.status==="active"?"Current":"Sign Out"})]},s.id))]}),o.jsxs("section",{className:"card security-card danger-card",children:[o.jsx("h4",{children:" Danger Zone"}),o.jsx("p",{className:"hint",children:"Irreversible actions. Proceed with caution."}),o.jsx("button",{className:"danger",onClick:async()=>{await Qr("Are you absolutely sure? This cannot be undone.","Delete Account")&&w("Account deletion request submitted for review.")},children:"Delete Account Permanently"})]}),o.jsxs("section",{className:"card",children:[o.jsx("h4",{children:"Security Privacy"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox"})," Log out of all other sessions"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox"})," Show security alerts"]}),o.jsx("button",{onClick:()=>w("Privacy settings saved."),children:"Save Security Settings"})]})]}),o.jsx("p",{className:"status",children:P})]})]})})]}):_r===fr?o.jsx(ZT,{downloadMenuRef:ap,downloadsMenuOpen:mC,setDownloadsMenuOpen:Ku,downloadTargets:ih,preferredDownloadTarget:kC,onOpenClient:()=>Tn(Ws),onOpenTerms:()=>Tn(wo)}):o.jsx(eR,{authMode:h,setAuthMode:g,email:S,setEmail:p,username:C,setUsername:R,password:D,setPassword:B,pendingVerificationEmail:$,status:P,onSubmit:GC,onResendVerification:HC,onBackHome:()=>Tn(fr),onOpenTerms:()=>Tn(wo)})}ax(document.getElementById("root")).render(o.jsx(Tb.StrictMode,{children:o.jsx(IR,{})}));
