var lx=Object.defineProperty;var ug=e=>{throw TypeError(e)};var dx=(e,t,n)=>t in e?lx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>dx(e,typeof t!="symbol"?t+"":t,n),pg=(e,t,n)=>t.has(e)||ug("Cannot "+n);var le=(e,t,n)=>(pg(e,t,"read from private field"),n?n.call(e):t.get(e)),rt=(e,t,n)=>t.has(e)?ug("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ie=(e,t,n,r)=>(pg(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function ux(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var yy={exports:{}},Fl={},wy={exports:{}},fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ia=Symbol.for("react.element"),px=Symbol.for("react.portal"),fx=Symbol.for("react.fragment"),hx=Symbol.for("react.strict_mode"),mx=Symbol.for("react.profiler"),gx=Symbol.for("react.provider"),vx=Symbol.for("react.context"),yx=Symbol.for("react.forward_ref"),wx=Symbol.for("react.suspense"),_x=Symbol.for("react.memo"),Sx=Symbol.for("react.lazy"),fg=Symbol.iterator;function Cx(e){return e===null||typeof e!="object"?null:(e=fg&&e[fg]||e["@@iterator"],typeof e=="function"?e:null)}var _y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Sy=Object.assign,Cy={};function io(e,t,n){this.props=e,this.context=t,this.refs=Cy,this.updater=n||_y}io.prototype.isReactComponent={};io.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};io.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function xy(){}xy.prototype=io.prototype;function uf(e,t,n){this.props=e,this.context=t,this.refs=Cy,this.updater=n||_y}var pf=uf.prototype=new xy;pf.constructor=uf;Sy(pf,io.prototype);pf.isPureReactComponent=!0;var hg=Array.isArray,by=Object.prototype.hasOwnProperty,ff={current:null},Ey={key:!0,ref:!0,__self:!0,__source:!0};function ky(e,t,n){var r,i={},o=null,d=null;if(t!=null)for(r in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(o=""+t.key),t)by.call(t,r)&&!Ey.hasOwnProperty(r)&&(i[r]=t[r]);var h=arguments.length-2;if(h===1)i.children=n;else if(1<h){for(var m=Array(h),g=0;g<h;g++)m[g]=arguments[g+2];i.children=m}if(e&&e.defaultProps)for(r in h=e.defaultProps,h)i[r]===void 0&&(i[r]=h[r]);return{$$typeof:Ia,type:e,key:o,ref:d,props:i,_owner:ff.current}}function xx(e,t){return{$$typeof:Ia,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function hf(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ia}function bx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var mg=/\/+/g;function ku(e,t){return typeof e=="object"&&e!==null&&e.key!=null?bx(""+e.key):t.toString(36)}function Yc(e,t,n,r,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(o){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case Ia:case px:d=!0}}if(d)return d=e,i=i(d),e=r===""?"."+ku(d,0):r,hg(i)?(n="",e!=null&&(n=e.replace(mg,"$&/")+"/"),Yc(i,t,n,"",function(g){return g})):i!=null&&(hf(i)&&(i=xx(i,n+(!i.key||d&&d.key===i.key?"":(""+i.key).replace(mg,"$&/")+"/")+e)),t.push(i)),1;if(d=0,r=r===""?".":r+":",hg(e))for(var h=0;h<e.length;h++){o=e[h];var m=r+ku(o,h);d+=Yc(o,t,n,m,i)}else if(m=Cx(e),typeof m=="function")for(e=m.call(e),h=0;!(o=e.next()).done;)o=o.value,m=r+ku(o,h++),d+=Yc(o,t,n,m,i);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function Rc(e,t,n){if(e==null)return e;var r=[],i=0;return Yc(e,r,"","",function(o){return t.call(n,o,i++)}),r}function Ex(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Nt={current:null},Jc={transition:null},kx={ReactCurrentDispatcher:Nt,ReactCurrentBatchConfig:Jc,ReactCurrentOwner:ff};function Ty(){throw Error("act(...) is not supported in production builds of React.")}fe.Children={map:Rc,forEach:function(e,t,n){Rc(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Rc(e,function(){t++}),t},toArray:function(e){return Rc(e,function(t){return t})||[]},only:function(e){if(!hf(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};fe.Component=io;fe.Fragment=fx;fe.Profiler=mx;fe.PureComponent=uf;fe.StrictMode=hx;fe.Suspense=wx;fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kx;fe.act=Ty;fe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Sy({},e.props),i=e.key,o=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,d=ff.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var h=e.type.defaultProps;for(m in t)by.call(t,m)&&!Ey.hasOwnProperty(m)&&(r[m]=t[m]===void 0&&h!==void 0?h[m]:t[m])}var m=arguments.length-2;if(m===1)r.children=n;else if(1<m){h=Array(m);for(var g=0;g<m;g++)h[g]=arguments[g+2];r.children=h}return{$$typeof:Ia,type:e.type,key:i,ref:o,props:r,_owner:d}};fe.createContext=function(e){return e={$$typeof:vx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gx,_context:e},e.Consumer=e};fe.createElement=ky;fe.createFactory=function(e){var t=ky.bind(null,e);return t.type=e,t};fe.createRef=function(){return{current:null}};fe.forwardRef=function(e){return{$$typeof:yx,render:e}};fe.isValidElement=hf;fe.lazy=function(e){return{$$typeof:Sx,_payload:{_status:-1,_result:e},_init:Ex}};fe.memo=function(e,t){return{$$typeof:_x,type:e,compare:t===void 0?null:t}};fe.startTransition=function(e){var t=Jc.transition;Jc.transition={};try{e()}finally{Jc.transition=t}};fe.unstable_act=Ty;fe.useCallback=function(e,t){return Nt.current.useCallback(e,t)};fe.useContext=function(e){return Nt.current.useContext(e)};fe.useDebugValue=function(){};fe.useDeferredValue=function(e){return Nt.current.useDeferredValue(e)};fe.useEffect=function(e,t){return Nt.current.useEffect(e,t)};fe.useId=function(){return Nt.current.useId()};fe.useImperativeHandle=function(e,t,n){return Nt.current.useImperativeHandle(e,t,n)};fe.useInsertionEffect=function(e,t){return Nt.current.useInsertionEffect(e,t)};fe.useLayoutEffect=function(e,t){return Nt.current.useLayoutEffect(e,t)};fe.useMemo=function(e,t){return Nt.current.useMemo(e,t)};fe.useReducer=function(e,t,n){return Nt.current.useReducer(e,t,n)};fe.useRef=function(e){return Nt.current.useRef(e)};fe.useState=function(e){return Nt.current.useState(e)};fe.useSyncExternalStore=function(e,t,n){return Nt.current.useSyncExternalStore(e,t,n)};fe.useTransition=function(){return Nt.current.useTransition()};fe.version="18.3.1";wy.exports=fe;var b=wy.exports;const Tx=ux(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rx=b,Ix=Symbol.for("react.element"),Nx=Symbol.for("react.fragment"),jx=Object.prototype.hasOwnProperty,Px=Rx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dx={key:!0,ref:!0,__self:!0,__source:!0};function Ry(e,t,n){var r,i={},o=null,d=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(d=t.ref);for(r in t)jx.call(t,r)&&!Dx.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:Ix,type:e,key:o,ref:d,props:i,_owner:Px.current}}Fl.Fragment=Nx;Fl.jsx=Ry;Fl.jsxs=Ry;yy.exports=Fl;var a=yy.exports,Iy={exports:{}},Zt={},Ny={exports:{}},jy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,$){var V=L.length;L.push($);e:for(;0<V;){var J=V-1>>>1,oe=L[J];if(0<i(oe,$))L[J]=$,L[V]=oe,V=J;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var $=L[0],V=L.pop();if(V!==$){L[0]=V;e:for(var J=0,oe=L.length,et=oe>>>1;J<et;){var ue=2*(J+1)-1,Dn=L[ue],tn=ue+1,nn=L[tn];if(0>i(Dn,V))tn<oe&&0>i(nn,Dn)?(L[J]=nn,L[tn]=V,J=tn):(L[J]=Dn,L[ue]=V,J=ue);else if(tn<oe&&0>i(nn,V))L[J]=nn,L[tn]=V,J=tn;else break e}}return $}function i(L,$){var V=L.sortIndex-$.sortIndex;return V!==0?V:L.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var d=Date,h=d.now();e.unstable_now=function(){return d.now()-h}}var m=[],g=[],f=1,S=null,T=3,A=!1,G=!1,B=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(L){for(var $=n(g);$!==null;){if($.callback===null)r(g);else if($.startTime<=L)r(g),$.sortIndex=$.expirationTime,t(m,$);else break;$=n(g)}}function x(L){if(B=!1,v(L),!G)if(n(m)!==null)G=!0,de(j);else{var $=n(g);$!==null&&F(x,$.startTime-L)}}function j(L,$){G=!1,B&&(B=!1,l(R),R=-1),A=!0;var V=T;try{for(v($),S=n(m);S!==null&&(!(S.expirationTime>$)||L&&!z());){var J=S.callback;if(typeof J=="function"){S.callback=null,T=S.priorityLevel;var oe=J(S.expirationTime<=$);$=e.unstable_now(),typeof oe=="function"?S.callback=oe:S===n(m)&&r(m),v($)}else r(m);S=n(m)}if(S!==null)var et=!0;else{var ue=n(g);ue!==null&&F(x,ue.startTime-$),et=!1}return et}finally{S=null,T=V,A=!1}}var _=!1,E=null,R=-1,M=5,P=-1;function z(){return!(e.unstable_now()-P<M)}function Y(){if(E!==null){var L=e.unstable_now();P=L;var $=!0;try{$=E(!0,L)}finally{$?H():(_=!1,E=null)}}else _=!1}var H;if(typeof p=="function")H=function(){p(Y)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ne=X.port2;X.port1.onmessage=Y,H=function(){ne.postMessage(null)}}else H=function(){y(Y,0)};function de(L){E=L,_||(_=!0,H())}function F(L,$){R=y(function(){L(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){G||A||(G=!0,de(j))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return T},e.unstable_getFirstCallbackNode=function(){return n(m)},e.unstable_next=function(L){switch(T){case 1:case 2:case 3:var $=3;break;default:$=T}var V=T;T=$;try{return L()}finally{T=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,$){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var V=T;T=L;try{return $()}finally{T=V}},e.unstable_scheduleCallback=function(L,$,V){var J=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?J+V:J):V=J,L){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=V+oe,L={id:f++,callback:$,priorityLevel:L,startTime:V,expirationTime:oe,sortIndex:-1},V>J?(L.sortIndex=V,t(g,L),n(m)===null&&L===n(g)&&(B?(l(R),R=-1):B=!0,F(x,V-J))):(L.sortIndex=oe,t(m,L),G||A||(G=!0,de(j))),L},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(L){var $=T;return function(){var V=T;T=$;try{return L.apply(this,arguments)}finally{T=V}}}})(jy);Ny.exports=jy;var Lx=Ny.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mx=b,Xt=Lx;function Q(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Py=new Set,ua={};function Bs(e,t){Xi(e,t),Xi(e+"Capture",t)}function Xi(e,t){for(ua[e]=t,e=0;e<t.length;e++)Py.add(t[e])}var fr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),up=Object.prototype.hasOwnProperty,Ox=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gg={},vg={};function Ax(e){return up.call(vg,e)?!0:up.call(gg,e)?!1:Ox.test(e)?vg[e]=!0:(gg[e]=!0,!1)}function $x(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Ux(e,t,n,r){if(t===null||typeof t>"u"||$x(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function jt(e,t,n,r,i,o,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=d}var ct={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ct[e]=new jt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ct[t]=new jt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ct[e]=new jt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ct[e]=new jt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ct[e]=new jt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ct[e]=new jt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ct[e]=new jt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ct[e]=new jt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ct[e]=new jt(e,5,!1,e.toLowerCase(),null,!1,!1)});var mf=/[\-:]([a-z])/g;function gf(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(mf,gf);ct[t]=new jt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(mf,gf);ct[t]=new jt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(mf,gf);ct[t]=new jt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ct[e]=new jt(e,1,!1,e.toLowerCase(),null,!1,!1)});ct.xlinkHref=new jt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ct[e]=new jt(e,1,!1,e.toLowerCase(),null,!0,!0)});function vf(e,t,n,r){var i=ct.hasOwnProperty(t)?ct[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Ux(t,n,i,r)&&(n=null),r||i===null?Ax(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var vr=Mx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ic=Symbol.for("react.element"),Ri=Symbol.for("react.portal"),Ii=Symbol.for("react.fragment"),yf=Symbol.for("react.strict_mode"),pp=Symbol.for("react.profiler"),Dy=Symbol.for("react.provider"),Ly=Symbol.for("react.context"),wf=Symbol.for("react.forward_ref"),fp=Symbol.for("react.suspense"),hp=Symbol.for("react.suspense_list"),_f=Symbol.for("react.memo"),Pr=Symbol.for("react.lazy"),My=Symbol.for("react.offscreen"),yg=Symbol.iterator;function Do(e){return e===null||typeof e!="object"?null:(e=yg&&e[yg]||e["@@iterator"],typeof e=="function"?e:null)}var Ae=Object.assign,Tu;function Yo(e){if(Tu===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Tu=t&&t[1]||""}return`
`+Tu+e}var Ru=!1;function Iu(e,t){if(!e||Ru)return"";Ru=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(g){var r=g}Reflect.construct(e,[],t)}else{try{t.call()}catch(g){r=g}e.call(t.prototype)}else{try{throw Error()}catch(g){r=g}e()}}catch(g){if(g&&r&&typeof g.stack=="string"){for(var i=g.stack.split(`
`),o=r.stack.split(`
`),d=i.length-1,h=o.length-1;1<=d&&0<=h&&i[d]!==o[h];)h--;for(;1<=d&&0<=h;d--,h--)if(i[d]!==o[h]){if(d!==1||h!==1)do if(d--,h--,0>h||i[d]!==o[h]){var m=`
`+i[d].replace(" at new "," at ");return e.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",e.displayName)),m}while(1<=d&&0<=h);break}}}finally{Ru=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Yo(e):""}function Fx(e){switch(e.tag){case 5:return Yo(e.type);case 16:return Yo("Lazy");case 13:return Yo("Suspense");case 19:return Yo("SuspenseList");case 0:case 2:case 15:return e=Iu(e.type,!1),e;case 11:return e=Iu(e.type.render,!1),e;case 1:return e=Iu(e.type,!0),e;default:return""}}function mp(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ii:return"Fragment";case Ri:return"Portal";case pp:return"Profiler";case yf:return"StrictMode";case fp:return"Suspense";case hp:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ly:return(e.displayName||"Context")+".Consumer";case Dy:return(e._context.displayName||"Context")+".Provider";case wf:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case _f:return t=e.displayName||null,t!==null?t:mp(e.type)||"Memo";case Pr:t=e._payload,e=e._init;try{return mp(e(t))}catch{}}return null}function zx(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mp(t);case 8:return t===yf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Kr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Oy(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bx(e){var t=Oy(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(d){r=""+d,o.call(this,d)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(d){r=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Nc(e){e._valueTracker||(e._valueTracker=Bx(e))}function Ay(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Oy(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function gl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function gp(e,t){var n=t.checked;return Ae({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function wg(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Kr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function $y(e,t){t=t.checked,t!=null&&vf(e,"checked",t,!1)}function vp(e,t){$y(e,t);var n=Kr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?yp(e,t.type,n):t.hasOwnProperty("defaultValue")&&yp(e,t.type,Kr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function _g(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function yp(e,t,n){(t!=="number"||gl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Jo=Array.isArray;function zi(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Kr(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function wp(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Q(91));return Ae({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Sg(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Q(92));if(Jo(n)){if(1<n.length)throw Error(Q(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Kr(n)}}function Uy(e,t){var n=Kr(t.value),r=Kr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Cg(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Fy(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _p(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Fy(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var jc,zy=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(jc=jc||document.createElement("div"),jc.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=jc.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function pa(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Zo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vx=["Webkit","ms","Moz","O"];Object.keys(Zo).forEach(function(e){Vx.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Zo[t]=Zo[e]})});function By(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Zo.hasOwnProperty(e)&&Zo[e]?(""+t).trim():t+"px"}function Vy(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=By(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var Gx=Ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sp(e,t){if(t){if(Gx[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Q(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Q(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Q(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Q(62))}}function Cp(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xp=null;function Sf(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var bp=null,Bi=null,Vi=null;function xg(e){if(e=Pa(e)){if(typeof bp!="function")throw Error(Q(280));var t=e.stateNode;t&&(t=Hl(t),bp(e.stateNode,e.type,t))}}function Gy(e){Bi?Vi?Vi.push(e):Vi=[e]:Bi=e}function Hy(){if(Bi){var e=Bi,t=Vi;if(Vi=Bi=null,xg(e),t)for(e=0;e<t.length;e++)xg(t[e])}}function Wy(e,t){return e(t)}function Qy(){}var Nu=!1;function Ky(e,t,n){if(Nu)return e(t,n);Nu=!0;try{return Wy(e,t,n)}finally{Nu=!1,(Bi!==null||Vi!==null)&&(Qy(),Hy())}}function fa(e,t){var n=e.stateNode;if(n===null)return null;var r=Hl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Q(231,t,typeof n));return n}var Ep=!1;if(fr)try{var Lo={};Object.defineProperty(Lo,"passive",{get:function(){Ep=!0}}),window.addEventListener("test",Lo,Lo),window.removeEventListener("test",Lo,Lo)}catch{Ep=!1}function Hx(e,t,n,r,i,o,d,h,m){var g=Array.prototype.slice.call(arguments,3);try{t.apply(n,g)}catch(f){this.onError(f)}}var ea=!1,vl=null,yl=!1,kp=null,Wx={onError:function(e){ea=!0,vl=e}};function Qx(e,t,n,r,i,o,d,h,m){ea=!1,vl=null,Hx.apply(Wx,arguments)}function Kx(e,t,n,r,i,o,d,h,m){if(Qx.apply(this,arguments),ea){if(ea){var g=vl;ea=!1,vl=null}else throw Error(Q(198));yl||(yl=!0,kp=g)}}function Vs(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Yy(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function bg(e){if(Vs(e)!==e)throw Error(Q(188))}function Yx(e){var t=e.alternate;if(!t){if(t=Vs(e),t===null)throw Error(Q(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return bg(i),e;if(o===r)return bg(i),t;o=o.sibling}throw Error(Q(188))}if(n.return!==r.return)n=i,r=o;else{for(var d=!1,h=i.child;h;){if(h===n){d=!0,n=i,r=o;break}if(h===r){d=!0,r=i,n=o;break}h=h.sibling}if(!d){for(h=o.child;h;){if(h===n){d=!0,n=o,r=i;break}if(h===r){d=!0,r=o,n=i;break}h=h.sibling}if(!d)throw Error(Q(189))}}if(n.alternate!==r)throw Error(Q(190))}if(n.tag!==3)throw Error(Q(188));return n.stateNode.current===n?e:t}function Jy(e){return e=Yx(e),e!==null?qy(e):null}function qy(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=qy(e);if(t!==null)return t;e=e.sibling}return null}var Xy=Xt.unstable_scheduleCallback,Eg=Xt.unstable_cancelCallback,Jx=Xt.unstable_shouldYield,qx=Xt.unstable_requestPaint,Be=Xt.unstable_now,Xx=Xt.unstable_getCurrentPriorityLevel,Cf=Xt.unstable_ImmediatePriority,Zy=Xt.unstable_UserBlockingPriority,wl=Xt.unstable_NormalPriority,Zx=Xt.unstable_LowPriority,ew=Xt.unstable_IdlePriority,zl=null,Wn=null;function e0(e){if(Wn&&typeof Wn.onCommitFiberRoot=="function")try{Wn.onCommitFiberRoot(zl,e,void 0,(e.current.flags&128)===128)}catch{}}var Tn=Math.clz32?Math.clz32:r0,t0=Math.log,n0=Math.LN2;function r0(e){return e>>>=0,e===0?32:31-(t0(e)/n0|0)|0}var Pc=64,Dc=4194304;function qo(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function _l(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,d=n&268435455;if(d!==0){var h=d&~i;h!==0?r=qo(h):(o&=d,o!==0&&(r=qo(o)))}else d=n&~i,d!==0?r=qo(d):o!==0&&(r=qo(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,o=t&-t,i>=o||i===16&&(o&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Tn(t),i=1<<n,r|=e[n],t&=~i;return r}function s0(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function i0(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var d=31-Tn(o),h=1<<d,m=i[d];m===-1?(!(h&n)||h&r)&&(i[d]=s0(h,t)):m<=t&&(e.expiredLanes|=h),o&=~h}}function Tp(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tw(){var e=Pc;return Pc<<=1,!(Pc&4194240)&&(Pc=64),e}function ju(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Na(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Tn(t),e[t]=n}function o0(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Tn(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}function xf(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Tn(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var we=0;function nw(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var rw,bf,sw,iw,ow,Rp=!1,Lc=[],Ur=null,Fr=null,zr=null,ha=new Map,ma=new Map,Lr=[],a0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kg(e,t){switch(e){case"focusin":case"focusout":Ur=null;break;case"dragenter":case"dragleave":Fr=null;break;case"mouseover":case"mouseout":zr=null;break;case"pointerover":case"pointerout":ha.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ma.delete(t.pointerId)}}function Mo(e,t,n,r,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},t!==null&&(t=Pa(t),t!==null&&bf(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function c0(e,t,n,r,i){switch(t){case"focusin":return Ur=Mo(Ur,e,t,n,r,i),!0;case"dragenter":return Fr=Mo(Fr,e,t,n,r,i),!0;case"mouseover":return zr=Mo(zr,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return ha.set(o,Mo(ha.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,ma.set(o,Mo(ma.get(o)||null,e,t,n,r,i)),!0}return!1}function aw(e){var t=Ss(e.target);if(t!==null){var n=Vs(t);if(n!==null){if(t=n.tag,t===13){if(t=Yy(n),t!==null){e.blockedOn=t,ow(e.priority,function(){sw(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function qc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ip(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);xp=r,n.target.dispatchEvent(r),xp=null}else return t=Pa(n),t!==null&&bf(t),e.blockedOn=n,!1;t.shift()}return!0}function Tg(e,t,n){qc(e)&&n.delete(t)}function l0(){Rp=!1,Ur!==null&&qc(Ur)&&(Ur=null),Fr!==null&&qc(Fr)&&(Fr=null),zr!==null&&qc(zr)&&(zr=null),ha.forEach(Tg),ma.forEach(Tg)}function Oo(e,t){e.blockedOn===t&&(e.blockedOn=null,Rp||(Rp=!0,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,l0)))}function ga(e){function t(i){return Oo(i,e)}if(0<Lc.length){Oo(Lc[0],e);for(var n=1;n<Lc.length;n++){var r=Lc[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Ur!==null&&Oo(Ur,e),Fr!==null&&Oo(Fr,e),zr!==null&&Oo(zr,e),ha.forEach(t),ma.forEach(t),n=0;n<Lr.length;n++)r=Lr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Lr.length&&(n=Lr[0],n.blockedOn===null);)aw(n),n.blockedOn===null&&Lr.shift()}var Gi=vr.ReactCurrentBatchConfig,Sl=!0;function d0(e,t,n,r){var i=we,o=Gi.transition;Gi.transition=null;try{we=1,Ef(e,t,n,r)}finally{we=i,Gi.transition=o}}function u0(e,t,n,r){var i=we,o=Gi.transition;Gi.transition=null;try{we=4,Ef(e,t,n,r)}finally{we=i,Gi.transition=o}}function Ef(e,t,n,r){if(Sl){var i=Ip(e,t,n,r);if(i===null)zu(e,t,r,Cl,n),kg(e,r);else if(c0(i,e,t,n,r))r.stopPropagation();else if(kg(e,r),t&4&&-1<a0.indexOf(e)){for(;i!==null;){var o=Pa(i);if(o!==null&&rw(o),o=Ip(e,t,n,r),o===null&&zu(e,t,r,Cl,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else zu(e,t,r,null,n)}}var Cl=null;function Ip(e,t,n,r){if(Cl=null,e=Sf(r),e=Ss(e),e!==null)if(t=Vs(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Yy(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Cl=e,null}function cw(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xx()){case Cf:return 1;case Zy:return 4;case wl:case Zx:return 16;case ew:return 536870912;default:return 16}default:return 16}}var Ar=null,kf=null,Xc=null;function lw(){if(Xc)return Xc;var e,t=kf,n=t.length,r,i="value"in Ar?Ar.value:Ar.textContent,o=i.length;for(e=0;e<n&&t[e]===i[e];e++);var d=n-e;for(r=1;r<=d&&t[n-r]===i[o-r];r++);return Xc=i.slice(e,1<r?1-r:void 0)}function Zc(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Mc(){return!0}function Rg(){return!1}function en(e){function t(n,r,i,o,d){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=d,this.currentTarget=null;for(var h in e)e.hasOwnProperty(h)&&(n=e[h],this[h]=n?n(o):o[h]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Mc:Rg,this.isPropagationStopped=Rg,this}return Ae(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Mc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Mc)},persist:function(){},isPersistent:Mc}),t}var oo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tf=en(oo),ja=Ae({},oo,{view:0,detail:0}),p0=en(ja),Pu,Du,Ao,Bl=Ae({},ja,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rf,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ao&&(Ao&&e.type==="mousemove"?(Pu=e.screenX-Ao.screenX,Du=e.screenY-Ao.screenY):Du=Pu=0,Ao=e),Pu)},movementY:function(e){return"movementY"in e?e.movementY:Du}}),Ig=en(Bl),f0=Ae({},Bl,{dataTransfer:0}),h0=en(f0),m0=Ae({},ja,{relatedTarget:0}),Lu=en(m0),g0=Ae({},oo,{animationName:0,elapsedTime:0,pseudoElement:0}),v0=en(g0),y0=Ae({},oo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),w0=en(y0),_0=Ae({},oo,{data:0}),Ng=en(_0),S0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},C0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function b0(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=x0[e])?!!t[e]:!1}function Rf(){return b0}var E0=Ae({},ja,{key:function(e){if(e.key){var t=S0[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zc(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?C0[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rf,charCode:function(e){return e.type==="keypress"?Zc(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zc(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),k0=en(E0),T0=Ae({},Bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),jg=en(T0),R0=Ae({},ja,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rf}),I0=en(R0),N0=Ae({},oo,{propertyName:0,elapsedTime:0,pseudoElement:0}),j0=en(N0),P0=Ae({},Bl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),D0=en(P0),L0=[9,13,27,32],If=fr&&"CompositionEvent"in window,ta=null;fr&&"documentMode"in document&&(ta=document.documentMode);var M0=fr&&"TextEvent"in window&&!ta,dw=fr&&(!If||ta&&8<ta&&11>=ta),Pg=" ",Dg=!1;function uw(e,t){switch(e){case"keyup":return L0.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pw(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ni=!1;function O0(e,t){switch(e){case"compositionend":return pw(t);case"keypress":return t.which!==32?null:(Dg=!0,Pg);case"textInput":return e=t.data,e===Pg&&Dg?null:e;default:return null}}function A0(e,t){if(Ni)return e==="compositionend"||!If&&uw(e,t)?(e=lw(),Xc=kf=Ar=null,Ni=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return dw&&t.locale!=="ko"?null:t.data;default:return null}}var $0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lg(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!$0[e.type]:t==="textarea"}function fw(e,t,n,r){Gy(r),t=xl(t,"onChange"),0<t.length&&(n=new Tf("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var na=null,va=null;function U0(e){bw(e,0)}function Vl(e){var t=Di(e);if(Ay(t))return e}function F0(e,t){if(e==="change")return t}var hw=!1;if(fr){var Mu;if(fr){var Ou="oninput"in document;if(!Ou){var Mg=document.createElement("div");Mg.setAttribute("oninput","return;"),Ou=typeof Mg.oninput=="function"}Mu=Ou}else Mu=!1;hw=Mu&&(!document.documentMode||9<document.documentMode)}function Og(){na&&(na.detachEvent("onpropertychange",mw),va=na=null)}function mw(e){if(e.propertyName==="value"&&Vl(va)){var t=[];fw(t,va,e,Sf(e)),Ky(U0,t)}}function z0(e,t,n){e==="focusin"?(Og(),na=t,va=n,na.attachEvent("onpropertychange",mw)):e==="focusout"&&Og()}function B0(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Vl(va)}function V0(e,t){if(e==="click")return Vl(t)}function G0(e,t){if(e==="input"||e==="change")return Vl(t)}function H0(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Nn=typeof Object.is=="function"?Object.is:H0;function ya(e,t){if(Nn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!up.call(t,i)||!Nn(e[i],t[i]))return!1}return!0}function Ag(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $g(e,t){var n=Ag(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ag(n)}}function gw(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?gw(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function vw(){for(var e=window,t=gl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=gl(e.document)}return t}function Nf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function W0(e){var t=vw(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&gw(n.ownerDocument.documentElement,n)){if(r!==null&&Nf(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=$g(n,o);var d=$g(n,r);i&&d&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Q0=fr&&"documentMode"in document&&11>=document.documentMode,ji=null,Np=null,ra=null,jp=!1;function Ug(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;jp||ji==null||ji!==gl(r)||(r=ji,"selectionStart"in r&&Nf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ra&&ya(ra,r)||(ra=r,r=xl(Np,"onSelect"),0<r.length&&(t=new Tf("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ji)))}function Oc(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Pi={animationend:Oc("Animation","AnimationEnd"),animationiteration:Oc("Animation","AnimationIteration"),animationstart:Oc("Animation","AnimationStart"),transitionend:Oc("Transition","TransitionEnd")},Au={},yw={};fr&&(yw=document.createElement("div").style,"AnimationEvent"in window||(delete Pi.animationend.animation,delete Pi.animationiteration.animation,delete Pi.animationstart.animation),"TransitionEvent"in window||delete Pi.transitionend.transition);function Gl(e){if(Au[e])return Au[e];if(!Pi[e])return e;var t=Pi[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in yw)return Au[e]=t[n];return e}var ww=Gl("animationend"),_w=Gl("animationiteration"),Sw=Gl("animationstart"),Cw=Gl("transitionend"),xw=new Map,Fg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jr(e,t){xw.set(e,t),Bs(t,[e])}for(var $u=0;$u<Fg.length;$u++){var Uu=Fg[$u],K0=Uu.toLowerCase(),Y0=Uu[0].toUpperCase()+Uu.slice(1);Jr(K0,"on"+Y0)}Jr(ww,"onAnimationEnd");Jr(_w,"onAnimationIteration");Jr(Sw,"onAnimationStart");Jr("dblclick","onDoubleClick");Jr("focusin","onFocus");Jr("focusout","onBlur");Jr(Cw,"onTransitionEnd");Xi("onMouseEnter",["mouseout","mouseover"]);Xi("onMouseLeave",["mouseout","mouseover"]);Xi("onPointerEnter",["pointerout","pointerover"]);Xi("onPointerLeave",["pointerout","pointerover"]);Bs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),J0=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xo));function zg(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Kx(r,t,void 0,e),e.currentTarget=null}function bw(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var d=r.length-1;0<=d;d--){var h=r[d],m=h.instance,g=h.currentTarget;if(h=h.listener,m!==o&&i.isPropagationStopped())break e;zg(i,h,g),o=m}else for(d=0;d<r.length;d++){if(h=r[d],m=h.instance,g=h.currentTarget,h=h.listener,m!==o&&i.isPropagationStopped())break e;zg(i,h,g),o=m}}}if(yl)throw e=kp,yl=!1,kp=null,e}function Ne(e,t){var n=t[Op];n===void 0&&(n=t[Op]=new Set);var r=e+"__bubble";n.has(r)||(Ew(t,e,2,!1),n.add(r))}function Fu(e,t,n){var r=0;t&&(r|=4),Ew(n,e,r,t)}var Ac="_reactListening"+Math.random().toString(36).slice(2);function wa(e){if(!e[Ac]){e[Ac]=!0,Py.forEach(function(n){n!=="selectionchange"&&(J0.has(n)||Fu(n,!1,e),Fu(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ac]||(t[Ac]=!0,Fu("selectionchange",!1,t))}}function Ew(e,t,n,r){switch(cw(t)){case 1:var i=d0;break;case 4:i=u0;break;default:i=Ef}n=i.bind(null,t,n,e),i=void 0,!Ep||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function zu(e,t,n,r,i){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var d=r.tag;if(d===3||d===4){var h=r.stateNode.containerInfo;if(h===i||h.nodeType===8&&h.parentNode===i)break;if(d===4)for(d=r.return;d!==null;){var m=d.tag;if((m===3||m===4)&&(m=d.stateNode.containerInfo,m===i||m.nodeType===8&&m.parentNode===i))return;d=d.return}for(;h!==null;){if(d=Ss(h),d===null)return;if(m=d.tag,m===5||m===6){r=o=d;continue e}h=h.parentNode}}r=r.return}Ky(function(){var g=o,f=Sf(n),S=[];e:{var T=xw.get(e);if(T!==void 0){var A=Tf,G=e;switch(e){case"keypress":if(Zc(n)===0)break e;case"keydown":case"keyup":A=k0;break;case"focusin":G="focus",A=Lu;break;case"focusout":G="blur",A=Lu;break;case"beforeblur":case"afterblur":A=Lu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Ig;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=h0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=I0;break;case ww:case _w:case Sw:A=v0;break;case Cw:A=j0;break;case"scroll":A=p0;break;case"wheel":A=D0;break;case"copy":case"cut":case"paste":A=w0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=jg}var B=(t&4)!==0,y=!B&&e==="scroll",l=B?T!==null?T+"Capture":null:T;B=[];for(var p=g,v;p!==null;){v=p;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,l!==null&&(x=fa(p,l),x!=null&&B.push(_a(p,x,v)))),y)break;p=p.return}0<B.length&&(T=new A(T,G,null,n,f),S.push({event:T,listeners:B}))}}if(!(t&7)){e:{if(T=e==="mouseover"||e==="pointerover",A=e==="mouseout"||e==="pointerout",T&&n!==xp&&(G=n.relatedTarget||n.fromElement)&&(Ss(G)||G[hr]))break e;if((A||T)&&(T=f.window===f?f:(T=f.ownerDocument)?T.defaultView||T.parentWindow:window,A?(G=n.relatedTarget||n.toElement,A=g,G=G?Ss(G):null,G!==null&&(y=Vs(G),G!==y||G.tag!==5&&G.tag!==6)&&(G=null)):(A=null,G=g),A!==G)){if(B=Ig,x="onMouseLeave",l="onMouseEnter",p="mouse",(e==="pointerout"||e==="pointerover")&&(B=jg,x="onPointerLeave",l="onPointerEnter",p="pointer"),y=A==null?T:Di(A),v=G==null?T:Di(G),T=new B(x,p+"leave",A,n,f),T.target=y,T.relatedTarget=v,x=null,Ss(f)===g&&(B=new B(l,p+"enter",G,n,f),B.target=v,B.relatedTarget=y,x=B),y=x,A&&G)t:{for(B=A,l=G,p=0,v=B;v;v=mi(v))p++;for(v=0,x=l;x;x=mi(x))v++;for(;0<p-v;)B=mi(B),p--;for(;0<v-p;)l=mi(l),v--;for(;p--;){if(B===l||l!==null&&B===l.alternate)break t;B=mi(B),l=mi(l)}B=null}else B=null;A!==null&&Bg(S,T,A,B,!1),G!==null&&y!==null&&Bg(S,y,G,B,!0)}}e:{if(T=g?Di(g):window,A=T.nodeName&&T.nodeName.toLowerCase(),A==="select"||A==="input"&&T.type==="file")var j=F0;else if(Lg(T))if(hw)j=G0;else{j=B0;var _=z0}else(A=T.nodeName)&&A.toLowerCase()==="input"&&(T.type==="checkbox"||T.type==="radio")&&(j=V0);if(j&&(j=j(e,g))){fw(S,j,n,f);break e}_&&_(e,T,g),e==="focusout"&&(_=T._wrapperState)&&_.controlled&&T.type==="number"&&yp(T,"number",T.value)}switch(_=g?Di(g):window,e){case"focusin":(Lg(_)||_.contentEditable==="true")&&(ji=_,Np=g,ra=null);break;case"focusout":ra=Np=ji=null;break;case"mousedown":jp=!0;break;case"contextmenu":case"mouseup":case"dragend":jp=!1,Ug(S,n,f);break;case"selectionchange":if(Q0)break;case"keydown":case"keyup":Ug(S,n,f)}var E;if(If)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Ni?uw(e,n)&&(R="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(dw&&n.locale!=="ko"&&(Ni||R!=="onCompositionStart"?R==="onCompositionEnd"&&Ni&&(E=lw()):(Ar=f,kf="value"in Ar?Ar.value:Ar.textContent,Ni=!0)),_=xl(g,R),0<_.length&&(R=new Ng(R,e,null,n,f),S.push({event:R,listeners:_}),E?R.data=E:(E=pw(n),E!==null&&(R.data=E)))),(E=M0?O0(e,n):A0(e,n))&&(g=xl(g,"onBeforeInput"),0<g.length&&(f=new Ng("onBeforeInput","beforeinput",null,n,f),S.push({event:f,listeners:g}),f.data=E))}bw(S,t)})}function _a(e,t,n){return{instance:e,listener:t,currentTarget:n}}function xl(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=fa(e,n),o!=null&&r.unshift(_a(e,o,i)),o=fa(e,t),o!=null&&r.push(_a(e,o,i))),e=e.return}return r}function mi(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Bg(e,t,n,r,i){for(var o=t._reactName,d=[];n!==null&&n!==r;){var h=n,m=h.alternate,g=h.stateNode;if(m!==null&&m===r)break;h.tag===5&&g!==null&&(h=g,i?(m=fa(n,o),m!=null&&d.unshift(_a(n,m,h))):i||(m=fa(n,o),m!=null&&d.push(_a(n,m,h)))),n=n.return}d.length!==0&&e.push({event:t,listeners:d})}var q0=/\r\n?/g,X0=/\u0000|\uFFFD/g;function Vg(e){return(typeof e=="string"?e:""+e).replace(q0,`
`).replace(X0,"")}function $c(e,t,n){if(t=Vg(t),Vg(e)!==t&&n)throw Error(Q(425))}function bl(){}var Pp=null,Dp=null;function Lp(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Mp=typeof setTimeout=="function"?setTimeout:void 0,Z0=typeof clearTimeout=="function"?clearTimeout:void 0,Gg=typeof Promise=="function"?Promise:void 0,eb=typeof queueMicrotask=="function"?queueMicrotask:typeof Gg<"u"?function(e){return Gg.resolve(null).then(e).catch(tb)}:Mp;function tb(e){setTimeout(function(){throw e})}function Bu(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),ga(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);ga(t)}function Br(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Hg(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ao=Math.random().toString(36).slice(2),Hn="__reactFiber$"+ao,Sa="__reactProps$"+ao,hr="__reactContainer$"+ao,Op="__reactEvents$"+ao,nb="__reactListeners$"+ao,rb="__reactHandles$"+ao;function Ss(e){var t=e[Hn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[hr]||n[Hn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Hg(e);e!==null;){if(n=e[Hn])return n;e=Hg(e)}return t}e=n,n=e.parentNode}return null}function Pa(e){return e=e[Hn]||e[hr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Di(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Q(33))}function Hl(e){return e[Sa]||null}var Ap=[],Li=-1;function qr(e){return{current:e}}function je(e){0>Li||(e.current=Ap[Li],Ap[Li]=null,Li--)}function be(e,t){Li++,Ap[Li]=e.current,e.current=t}var Yr={},St=qr(Yr),$t=qr(!1),Ms=Yr;function Zi(e,t){var n=e.type.contextTypes;if(!n)return Yr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ut(e){return e=e.childContextTypes,e!=null}function El(){je($t),je(St)}function Wg(e,t,n){if(St.current!==Yr)throw Error(Q(168));be(St,t),be($t,n)}function kw(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(Q(108,zx(e)||"Unknown",i));return Ae({},n,r)}function kl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Yr,Ms=St.current,be(St,e),be($t,$t.current),!0}function Qg(e,t,n){var r=e.stateNode;if(!r)throw Error(Q(169));n?(e=kw(e,t,Ms),r.__reactInternalMemoizedMergedChildContext=e,je($t),je(St),be(St,e)):je($t),be($t,n)}var ar=null,Wl=!1,Vu=!1;function Tw(e){ar===null?ar=[e]:ar.push(e)}function sb(e){Wl=!0,Tw(e)}function Xr(){if(!Vu&&ar!==null){Vu=!0;var e=0,t=we;try{var n=ar;for(we=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}ar=null,Wl=!1}catch(i){throw ar!==null&&(ar=ar.slice(e+1)),Xy(Cf,Xr),i}finally{we=t,Vu=!1}}return null}var Mi=[],Oi=0,Tl=null,Rl=0,un=[],pn=0,Os=null,lr=1,dr="";function ys(e,t){Mi[Oi++]=Rl,Mi[Oi++]=Tl,Tl=e,Rl=t}function Rw(e,t,n){un[pn++]=lr,un[pn++]=dr,un[pn++]=Os,Os=e;var r=lr;e=dr;var i=32-Tn(r)-1;r&=~(1<<i),n+=1;var o=32-Tn(t)+i;if(30<o){var d=i-i%5;o=(r&(1<<d)-1).toString(32),r>>=d,i-=d,lr=1<<32-Tn(t)+i|n<<i|r,dr=o+e}else lr=1<<o|n<<i|r,dr=e}function jf(e){e.return!==null&&(ys(e,1),Rw(e,1,0))}function Pf(e){for(;e===Tl;)Tl=Mi[--Oi],Mi[Oi]=null,Rl=Mi[--Oi],Mi[Oi]=null;for(;e===Os;)Os=un[--pn],un[pn]=null,dr=un[--pn],un[pn]=null,lr=un[--pn],un[pn]=null}var qt=null,Jt=null,Le=!1,kn=null;function Iw(e,t){var n=fn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Kg(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,qt=e,Jt=Br(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,qt=e,Jt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Os!==null?{id:lr,overflow:dr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=fn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,qt=e,Jt=null,!0):!1;default:return!1}}function $p(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Up(e){if(Le){var t=Jt;if(t){var n=t;if(!Kg(e,t)){if($p(e))throw Error(Q(418));t=Br(n.nextSibling);var r=qt;t&&Kg(e,t)?Iw(r,n):(e.flags=e.flags&-4097|2,Le=!1,qt=e)}}else{if($p(e))throw Error(Q(418));e.flags=e.flags&-4097|2,Le=!1,qt=e}}}function Yg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;qt=e}function Uc(e){if(e!==qt)return!1;if(!Le)return Yg(e),Le=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Lp(e.type,e.memoizedProps)),t&&(t=Jt)){if($p(e))throw Nw(),Error(Q(418));for(;t;)Iw(e,t),t=Br(t.nextSibling)}if(Yg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Q(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Jt=Br(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Jt=null}}else Jt=qt?Br(e.stateNode.nextSibling):null;return!0}function Nw(){for(var e=Jt;e;)e=Br(e.nextSibling)}function eo(){Jt=qt=null,Le=!1}function Df(e){kn===null?kn=[e]:kn.push(e)}var ib=vr.ReactCurrentBatchConfig;function $o(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Q(309));var r=n.stateNode}if(!r)throw Error(Q(147,e));var i=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(d){var h=i.refs;d===null?delete h[o]:h[o]=d},t._stringRef=o,t)}if(typeof e!="string")throw Error(Q(284));if(!n._owner)throw Error(Q(290,e))}return e}function Fc(e,t){throw e=Object.prototype.toString.call(t),Error(Q(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Jg(e){var t=e._init;return t(e._payload)}function jw(e){function t(l,p){if(e){var v=l.deletions;v===null?(l.deletions=[p],l.flags|=16):v.push(p)}}function n(l,p){if(!e)return null;for(;p!==null;)t(l,p),p=p.sibling;return null}function r(l,p){for(l=new Map;p!==null;)p.key!==null?l.set(p.key,p):l.set(p.index,p),p=p.sibling;return l}function i(l,p){return l=Wr(l,p),l.index=0,l.sibling=null,l}function o(l,p,v){return l.index=v,e?(v=l.alternate,v!==null?(v=v.index,v<p?(l.flags|=2,p):v):(l.flags|=2,p)):(l.flags|=1048576,p)}function d(l){return e&&l.alternate===null&&(l.flags|=2),l}function h(l,p,v,x){return p===null||p.tag!==6?(p=Ju(v,l.mode,x),p.return=l,p):(p=i(p,v),p.return=l,p)}function m(l,p,v,x){var j=v.type;return j===Ii?f(l,p,v.props.children,x,v.key):p!==null&&(p.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Pr&&Jg(j)===p.type)?(x=i(p,v.props),x.ref=$o(l,p,v),x.return=l,x):(x=ol(v.type,v.key,v.props,null,l.mode,x),x.ref=$o(l,p,v),x.return=l,x)}function g(l,p,v,x){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=qu(v,l.mode,x),p.return=l,p):(p=i(p,v.children||[]),p.return=l,p)}function f(l,p,v,x,j){return p===null||p.tag!==7?(p=Ls(v,l.mode,x,j),p.return=l,p):(p=i(p,v),p.return=l,p)}function S(l,p,v){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Ju(""+p,l.mode,v),p.return=l,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ic:return v=ol(p.type,p.key,p.props,null,l.mode,v),v.ref=$o(l,null,p),v.return=l,v;case Ri:return p=qu(p,l.mode,v),p.return=l,p;case Pr:var x=p._init;return S(l,x(p._payload),v)}if(Jo(p)||Do(p))return p=Ls(p,l.mode,v,null),p.return=l,p;Fc(l,p)}return null}function T(l,p,v,x){var j=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return j!==null?null:h(l,p,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ic:return v.key===j?m(l,p,v,x):null;case Ri:return v.key===j?g(l,p,v,x):null;case Pr:return j=v._init,T(l,p,j(v._payload),x)}if(Jo(v)||Do(v))return j!==null?null:f(l,p,v,x,null);Fc(l,v)}return null}function A(l,p,v,x,j){if(typeof x=="string"&&x!==""||typeof x=="number")return l=l.get(v)||null,h(p,l,""+x,j);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ic:return l=l.get(x.key===null?v:x.key)||null,m(p,l,x,j);case Ri:return l=l.get(x.key===null?v:x.key)||null,g(p,l,x,j);case Pr:var _=x._init;return A(l,p,v,_(x._payload),j)}if(Jo(x)||Do(x))return l=l.get(v)||null,f(p,l,x,j,null);Fc(p,x)}return null}function G(l,p,v,x){for(var j=null,_=null,E=p,R=p=0,M=null;E!==null&&R<v.length;R++){E.index>R?(M=E,E=null):M=E.sibling;var P=T(l,E,v[R],x);if(P===null){E===null&&(E=M);break}e&&E&&P.alternate===null&&t(l,E),p=o(P,p,R),_===null?j=P:_.sibling=P,_=P,E=M}if(R===v.length)return n(l,E),Le&&ys(l,R),j;if(E===null){for(;R<v.length;R++)E=S(l,v[R],x),E!==null&&(p=o(E,p,R),_===null?j=E:_.sibling=E,_=E);return Le&&ys(l,R),j}for(E=r(l,E);R<v.length;R++)M=A(E,l,R,v[R],x),M!==null&&(e&&M.alternate!==null&&E.delete(M.key===null?R:M.key),p=o(M,p,R),_===null?j=M:_.sibling=M,_=M);return e&&E.forEach(function(z){return t(l,z)}),Le&&ys(l,R),j}function B(l,p,v,x){var j=Do(v);if(typeof j!="function")throw Error(Q(150));if(v=j.call(v),v==null)throw Error(Q(151));for(var _=j=null,E=p,R=p=0,M=null,P=v.next();E!==null&&!P.done;R++,P=v.next()){E.index>R?(M=E,E=null):M=E.sibling;var z=T(l,E,P.value,x);if(z===null){E===null&&(E=M);break}e&&E&&z.alternate===null&&t(l,E),p=o(z,p,R),_===null?j=z:_.sibling=z,_=z,E=M}if(P.done)return n(l,E),Le&&ys(l,R),j;if(E===null){for(;!P.done;R++,P=v.next())P=S(l,P.value,x),P!==null&&(p=o(P,p,R),_===null?j=P:_.sibling=P,_=P);return Le&&ys(l,R),j}for(E=r(l,E);!P.done;R++,P=v.next())P=A(E,l,R,P.value,x),P!==null&&(e&&P.alternate!==null&&E.delete(P.key===null?R:P.key),p=o(P,p,R),_===null?j=P:_.sibling=P,_=P);return e&&E.forEach(function(Y){return t(l,Y)}),Le&&ys(l,R),j}function y(l,p,v,x){if(typeof v=="object"&&v!==null&&v.type===Ii&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ic:e:{for(var j=v.key,_=p;_!==null;){if(_.key===j){if(j=v.type,j===Ii){if(_.tag===7){n(l,_.sibling),p=i(_,v.props.children),p.return=l,l=p;break e}}else if(_.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Pr&&Jg(j)===_.type){n(l,_.sibling),p=i(_,v.props),p.ref=$o(l,_,v),p.return=l,l=p;break e}n(l,_);break}else t(l,_);_=_.sibling}v.type===Ii?(p=Ls(v.props.children,l.mode,x,v.key),p.return=l,l=p):(x=ol(v.type,v.key,v.props,null,l.mode,x),x.ref=$o(l,p,v),x.return=l,l=x)}return d(l);case Ri:e:{for(_=v.key;p!==null;){if(p.key===_)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){n(l,p.sibling),p=i(p,v.children||[]),p.return=l,l=p;break e}else{n(l,p);break}else t(l,p);p=p.sibling}p=qu(v,l.mode,x),p.return=l,l=p}return d(l);case Pr:return _=v._init,y(l,p,_(v._payload),x)}if(Jo(v))return G(l,p,v,x);if(Do(v))return B(l,p,v,x);Fc(l,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,p!==null&&p.tag===6?(n(l,p.sibling),p=i(p,v),p.return=l,l=p):(n(l,p),p=Ju(v,l.mode,x),p.return=l,l=p),d(l)):n(l,p)}return y}var to=jw(!0),Pw=jw(!1),Il=qr(null),Nl=null,Ai=null,Lf=null;function Mf(){Lf=Ai=Nl=null}function Of(e){var t=Il.current;je(Il),e._currentValue=t}function Fp(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Hi(e,t){Nl=e,Lf=Ai=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(At=!0),e.firstContext=null)}function mn(e){var t=e._currentValue;if(Lf!==e)if(e={context:e,memoizedValue:t,next:null},Ai===null){if(Nl===null)throw Error(Q(308));Ai=e,Nl.dependencies={lanes:0,firstContext:e}}else Ai=Ai.next=e;return t}var Cs=null;function Af(e){Cs===null?Cs=[e]:Cs.push(e)}function Dw(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,Af(t)):(n.next=i.next,i.next=n),t.interleaved=n,mr(e,r)}function mr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Dr=!1;function $f(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lw(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ur(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,me&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,mr(e,n)}return i=r.interleaved,i===null?(t.next=t,Af(r)):(t.next=i.next,i.next=t),r.interleaved=t,mr(e,n)}function el(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,xf(e,n)}}function qg(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=d:o=o.next=d,n=n.next}while(n!==null);o===null?i=o=t:o=o.next=t}else i=o=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function jl(e,t,n,r){var i=e.updateQueue;Dr=!1;var o=i.firstBaseUpdate,d=i.lastBaseUpdate,h=i.shared.pending;if(h!==null){i.shared.pending=null;var m=h,g=m.next;m.next=null,d===null?o=g:d.next=g,d=m;var f=e.alternate;f!==null&&(f=f.updateQueue,h=f.lastBaseUpdate,h!==d&&(h===null?f.firstBaseUpdate=g:h.next=g,f.lastBaseUpdate=m))}if(o!==null){var S=i.baseState;d=0,f=g=m=null,h=o;do{var T=h.lane,A=h.eventTime;if((r&T)===T){f!==null&&(f=f.next={eventTime:A,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var G=e,B=h;switch(T=t,A=n,B.tag){case 1:if(G=B.payload,typeof G=="function"){S=G.call(A,S,T);break e}S=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=B.payload,T=typeof G=="function"?G.call(A,S,T):G,T==null)break e;S=Ae({},S,T);break e;case 2:Dr=!0}}h.callback!==null&&h.lane!==0&&(e.flags|=64,T=i.effects,T===null?i.effects=[h]:T.push(h))}else A={eventTime:A,lane:T,tag:h.tag,payload:h.payload,callback:h.callback,next:null},f===null?(g=f=A,m=S):f=f.next=A,d|=T;if(h=h.next,h===null){if(h=i.shared.pending,h===null)break;T=h,h=T.next,T.next=null,i.lastBaseUpdate=T,i.shared.pending=null}}while(!0);if(f===null&&(m=S),i.baseState=m,i.firstBaseUpdate=g,i.lastBaseUpdate=f,t=i.shared.interleaved,t!==null){i=t;do d|=i.lane,i=i.next;while(i!==t)}else o===null&&(i.shared.lanes=0);$s|=d,e.lanes=d,e.memoizedState=S}}function Xg(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Q(191,i));i.call(r)}}}var Da={},Qn=qr(Da),Ca=qr(Da),xa=qr(Da);function xs(e){if(e===Da)throw Error(Q(174));return e}function Uf(e,t){switch(be(xa,t),be(Ca,e),be(Qn,Da),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_p(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_p(t,e)}je(Qn),be(Qn,t)}function no(){je(Qn),je(Ca),je(xa)}function Mw(e){xs(xa.current);var t=xs(Qn.current),n=_p(t,e.type);t!==n&&(be(Ca,e),be(Qn,n))}function Ff(e){Ca.current===e&&(je(Qn),je(Ca))}var Me=qr(0);function Pl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gu=[];function zf(){for(var e=0;e<Gu.length;e++)Gu[e]._workInProgressVersionPrimary=null;Gu.length=0}var tl=vr.ReactCurrentDispatcher,Hu=vr.ReactCurrentBatchConfig,As=0,Oe=null,Ye=null,Xe=null,Dl=!1,sa=!1,ba=0,ob=0;function yt(){throw Error(Q(321))}function Bf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Nn(e[n],t[n]))return!1;return!0}function Vf(e,t,n,r,i,o){if(As=o,Oe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,tl.current=e===null||e.memoizedState===null?db:ub,e=n(r,i),sa){o=0;do{if(sa=!1,ba=0,25<=o)throw Error(Q(301));o+=1,Xe=Ye=null,t.updateQueue=null,tl.current=pb,e=n(r,i)}while(sa)}if(tl.current=Ll,t=Ye!==null&&Ye.next!==null,As=0,Xe=Ye=Oe=null,Dl=!1,t)throw Error(Q(300));return e}function Gf(){var e=ba!==0;return ba=0,e}function Bn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xe===null?Oe.memoizedState=Xe=e:Xe=Xe.next=e,Xe}function gn(){if(Ye===null){var e=Oe.alternate;e=e!==null?e.memoizedState:null}else e=Ye.next;var t=Xe===null?Oe.memoizedState:Xe.next;if(t!==null)Xe=t,Ye=e;else{if(e===null)throw Error(Q(310));Ye=e,e={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},Xe===null?Oe.memoizedState=Xe=e:Xe=Xe.next=e}return Xe}function Ea(e,t){return typeof t=="function"?t(e):t}function Wu(e){var t=gn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=Ye,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var d=i.next;i.next=o.next,o.next=d}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var h=d=null,m=null,g=o;do{var f=g.lane;if((As&f)===f)m!==null&&(m=m.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),r=g.hasEagerState?g.eagerState:e(r,g.action);else{var S={lane:f,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};m===null?(h=m=S,d=r):m=m.next=S,Oe.lanes|=f,$s|=f}g=g.next}while(g!==null&&g!==o);m===null?d=r:m.next=h,Nn(r,t.memoizedState)||(At=!0),t.memoizedState=r,t.baseState=d,t.baseQueue=m,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do o=i.lane,Oe.lanes|=o,$s|=o,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Qu(e){var t=gn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(i!==null){n.pending=null;var d=i=i.next;do o=e(o,d.action),d=d.next;while(d!==i);Nn(o,t.memoizedState)||(At=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ow(){}function Aw(e,t){var n=Oe,r=gn(),i=t(),o=!Nn(r.memoizedState,i);if(o&&(r.memoizedState=i,At=!0),r=r.queue,Hf(Fw.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||Xe!==null&&Xe.memoizedState.tag&1){if(n.flags|=2048,ka(9,Uw.bind(null,n,r,i,t),void 0,null),Ze===null)throw Error(Q(349));As&30||$w(n,t,i)}return i}function $w(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Oe.updateQueue,t===null?(t={lastEffect:null,stores:null},Oe.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Uw(e,t,n,r){t.value=n,t.getSnapshot=r,zw(t)&&Bw(e)}function Fw(e,t,n){return n(function(){zw(t)&&Bw(e)})}function zw(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Nn(e,n)}catch{return!0}}function Bw(e){var t=mr(e,1);t!==null&&Rn(t,e,1,-1)}function Zg(e){var t=Bn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:e},t.queue=e,e=e.dispatch=lb.bind(null,Oe,e),[t.memoizedState,e]}function ka(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Oe.updateQueue,t===null?(t={lastEffect:null,stores:null},Oe.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Vw(){return gn().memoizedState}function nl(e,t,n,r){var i=Bn();Oe.flags|=e,i.memoizedState=ka(1|t,n,void 0,r===void 0?null:r)}function Ql(e,t,n,r){var i=gn();r=r===void 0?null:r;var o=void 0;if(Ye!==null){var d=Ye.memoizedState;if(o=d.destroy,r!==null&&Bf(r,d.deps)){i.memoizedState=ka(t,n,o,r);return}}Oe.flags|=e,i.memoizedState=ka(1|t,n,o,r)}function ev(e,t){return nl(8390656,8,e,t)}function Hf(e,t){return Ql(2048,8,e,t)}function Gw(e,t){return Ql(4,2,e,t)}function Hw(e,t){return Ql(4,4,e,t)}function Ww(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Qw(e,t,n){return n=n!=null?n.concat([e]):null,Ql(4,4,Ww.bind(null,t,e),n)}function Wf(){}function Kw(e,t){var n=gn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Bf(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Yw(e,t){var n=gn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Bf(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jw(e,t,n){return As&21?(Nn(n,t)||(n=tw(),Oe.lanes|=n,$s|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,At=!0),e.memoizedState=n)}function ab(e,t){var n=we;we=n!==0&&4>n?n:4,e(!0);var r=Hu.transition;Hu.transition={};try{e(!1),t()}finally{we=n,Hu.transition=r}}function qw(){return gn().memoizedState}function cb(e,t,n){var r=Hr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xw(e))Zw(t,n);else if(n=Dw(e,t,n,r),n!==null){var i=It();Rn(n,e,r,i),e_(n,t,r)}}function lb(e,t,n){var r=Hr(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xw(e))Zw(t,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var d=t.lastRenderedState,h=o(d,n);if(i.hasEagerState=!0,i.eagerState=h,Nn(h,d)){var m=t.interleaved;m===null?(i.next=i,Af(t)):(i.next=m.next,m.next=i),t.interleaved=i;return}}catch{}finally{}n=Dw(e,t,i,r),n!==null&&(i=It(),Rn(n,e,r,i),e_(n,t,r))}}function Xw(e){var t=e.alternate;return e===Oe||t!==null&&t===Oe}function Zw(e,t){sa=Dl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function e_(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,xf(e,n)}}var Ll={readContext:mn,useCallback:yt,useContext:yt,useEffect:yt,useImperativeHandle:yt,useInsertionEffect:yt,useLayoutEffect:yt,useMemo:yt,useReducer:yt,useRef:yt,useState:yt,useDebugValue:yt,useDeferredValue:yt,useTransition:yt,useMutableSource:yt,useSyncExternalStore:yt,useId:yt,unstable_isNewReconciler:!1},db={readContext:mn,useCallback:function(e,t){return Bn().memoizedState=[e,t===void 0?null:t],e},useContext:mn,useEffect:ev,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,nl(4194308,4,Ww.bind(null,t,e),n)},useLayoutEffect:function(e,t){return nl(4194308,4,e,t)},useInsertionEffect:function(e,t){return nl(4,2,e,t)},useMemo:function(e,t){var n=Bn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Bn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=cb.bind(null,Oe,e),[r.memoizedState,e]},useRef:function(e){var t=Bn();return e={current:e},t.memoizedState=e},useState:Zg,useDebugValue:Wf,useDeferredValue:function(e){return Bn().memoizedState=e},useTransition:function(){var e=Zg(!1),t=e[0];return e=ab.bind(null,e[1]),Bn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Oe,i=Bn();if(Le){if(n===void 0)throw Error(Q(407));n=n()}else{if(n=t(),Ze===null)throw Error(Q(349));As&30||$w(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,ev(Fw.bind(null,r,o,e),[e]),r.flags|=2048,ka(9,Uw.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Bn(),t=Ze.identifierPrefix;if(Le){var n=dr,r=lr;n=(r&~(1<<32-Tn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=ba++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=ob++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ub={readContext:mn,useCallback:Kw,useContext:mn,useEffect:Hf,useImperativeHandle:Qw,useInsertionEffect:Gw,useLayoutEffect:Hw,useMemo:Yw,useReducer:Wu,useRef:Vw,useState:function(){return Wu(Ea)},useDebugValue:Wf,useDeferredValue:function(e){var t=gn();return Jw(t,Ye.memoizedState,e)},useTransition:function(){var e=Wu(Ea)[0],t=gn().memoizedState;return[e,t]},useMutableSource:Ow,useSyncExternalStore:Aw,useId:qw,unstable_isNewReconciler:!1},pb={readContext:mn,useCallback:Kw,useContext:mn,useEffect:Hf,useImperativeHandle:Qw,useInsertionEffect:Gw,useLayoutEffect:Hw,useMemo:Yw,useReducer:Qu,useRef:Vw,useState:function(){return Qu(Ea)},useDebugValue:Wf,useDeferredValue:function(e){var t=gn();return Ye===null?t.memoizedState=e:Jw(t,Ye.memoizedState,e)},useTransition:function(){var e=Qu(Ea)[0],t=gn().memoizedState;return[e,t]},useMutableSource:Ow,useSyncExternalStore:Aw,useId:qw,unstable_isNewReconciler:!1};function bn(e,t){if(e&&e.defaultProps){t=Ae({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function zp(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ae({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Kl={isMounted:function(e){return(e=e._reactInternals)?Vs(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=It(),i=Hr(e),o=ur(r,i);o.payload=t,n!=null&&(o.callback=n),t=Vr(e,o,i),t!==null&&(Rn(t,e,i,r),el(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=It(),i=Hr(e),o=ur(r,i);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=Vr(e,o,i),t!==null&&(Rn(t,e,i,r),el(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=It(),r=Hr(e),i=ur(n,r);i.tag=2,t!=null&&(i.callback=t),t=Vr(e,i,r),t!==null&&(Rn(t,e,r,n),el(t,e,r))}};function tv(e,t,n,r,i,o,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,d):t.prototype&&t.prototype.isPureReactComponent?!ya(n,r)||!ya(i,o):!0}function t_(e,t,n){var r=!1,i=Yr,o=t.contextType;return typeof o=="object"&&o!==null?o=mn(o):(i=Ut(t)?Ms:St.current,r=t.contextTypes,o=(r=r!=null)?Zi(e,i):Yr),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Kl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function nv(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Kl.enqueueReplaceState(t,t.state,null)}function Bp(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},$f(e);var o=t.contextType;typeof o=="object"&&o!==null?i.context=mn(o):(o=Ut(t)?Ms:St.current,i.context=Zi(e,o)),i.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(zp(e,t,o,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Kl.enqueueReplaceState(i,i.state,null),jl(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function ro(e,t){try{var n="",r=t;do n+=Fx(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:i,digest:null}}function Ku(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Vp(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fb=typeof WeakMap=="function"?WeakMap:Map;function n_(e,t,n){n=ur(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ol||(Ol=!0,Zp=r),Vp(e,t)},n}function r_(e,t,n){n=ur(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Vp(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Vp(e,t),typeof r!="function"&&(Gr===null?Gr=new Set([this]):Gr.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),n}function rv(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new fb;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Tb.bind(null,e,t,n),t.then(e,e))}function sv(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function iv(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=ur(-1,1),t.tag=2,Vr(n,t,1))),n.lanes|=1),e)}var hb=vr.ReactCurrentOwner,At=!1;function Tt(e,t,n,r){t.child=e===null?Pw(t,null,n,r):to(t,e.child,n,r)}function ov(e,t,n,r,i){n=n.render;var o=t.ref;return Hi(t,i),r=Vf(e,t,n,r,o,i),n=Gf(),e!==null&&!At?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,gr(e,t,i)):(Le&&n&&jf(t),t.flags|=1,Tt(e,t,r,i),t.child)}function av(e,t,n,r,i){if(e===null){var o=n.type;return typeof o=="function"&&!eh(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,s_(e,t,o,r,i)):(e=ol(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&i)){var d=o.memoizedProps;if(n=n.compare,n=n!==null?n:ya,n(d,r)&&e.ref===t.ref)return gr(e,t,i)}return t.flags|=1,e=Wr(o,r),e.ref=t.ref,e.return=t,t.child=e}function s_(e,t,n,r,i){if(e!==null){var o=e.memoizedProps;if(ya(o,r)&&e.ref===t.ref)if(At=!1,t.pendingProps=r=o,(e.lanes&i)!==0)e.flags&131072&&(At=!0);else return t.lanes=e.lanes,gr(e,t,i)}return Gp(e,t,n,r,i)}function i_(e,t,n){var r=t.pendingProps,i=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},be(Ui,Qt),Qt|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,be(Ui,Qt),Qt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,be(Ui,Qt),Qt|=r}else o!==null?(r=o.baseLanes|n,t.memoizedState=null):r=n,be(Ui,Qt),Qt|=r;return Tt(e,t,i,n),t.child}function o_(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Gp(e,t,n,r,i){var o=Ut(n)?Ms:St.current;return o=Zi(t,o),Hi(t,i),n=Vf(e,t,n,r,o,i),r=Gf(),e!==null&&!At?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,gr(e,t,i)):(Le&&r&&jf(t),t.flags|=1,Tt(e,t,n,i),t.child)}function cv(e,t,n,r,i){if(Ut(n)){var o=!0;kl(t)}else o=!1;if(Hi(t,i),t.stateNode===null)rl(e,t),t_(t,n,r),Bp(t,n,r,i),r=!0;else if(e===null){var d=t.stateNode,h=t.memoizedProps;d.props=h;var m=d.context,g=n.contextType;typeof g=="object"&&g!==null?g=mn(g):(g=Ut(n)?Ms:St.current,g=Zi(t,g));var f=n.getDerivedStateFromProps,S=typeof f=="function"||typeof d.getSnapshotBeforeUpdate=="function";S||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==r||m!==g)&&nv(t,d,r,g),Dr=!1;var T=t.memoizedState;d.state=T,jl(t,r,d,i),m=t.memoizedState,h!==r||T!==m||$t.current||Dr?(typeof f=="function"&&(zp(t,n,f,r),m=t.memoizedState),(h=Dr||tv(t,n,h,r,T,m,g))?(S||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=m),d.props=r,d.state=m,d.context=g,r=h):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{d=t.stateNode,Lw(e,t),h=t.memoizedProps,g=t.type===t.elementType?h:bn(t.type,h),d.props=g,S=t.pendingProps,T=d.context,m=n.contextType,typeof m=="object"&&m!==null?m=mn(m):(m=Ut(n)?Ms:St.current,m=Zi(t,m));var A=n.getDerivedStateFromProps;(f=typeof A=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==S||T!==m)&&nv(t,d,r,m),Dr=!1,T=t.memoizedState,d.state=T,jl(t,r,d,i);var G=t.memoizedState;h!==S||T!==G||$t.current||Dr?(typeof A=="function"&&(zp(t,n,A,r),G=t.memoizedState),(g=Dr||tv(t,n,g,r,T,G,m)||!1)?(f||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(r,G,m),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(r,G,m)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=G),d.props=r,d.state=G,d.context=m,r=g):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),r=!1)}return Hp(e,t,n,r,o,i)}function Hp(e,t,n,r,i,o){o_(e,t);var d=(t.flags&128)!==0;if(!r&&!d)return i&&Qg(t,n,!1),gr(e,t,o);r=t.stateNode,hb.current=t;var h=d&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&d?(t.child=to(t,e.child,null,o),t.child=to(t,null,h,o)):Tt(e,t,h,o),t.memoizedState=r.state,i&&Qg(t,n,!0),t.child}function a_(e){var t=e.stateNode;t.pendingContext?Wg(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Wg(e,t.context,!1),Uf(e,t.containerInfo)}function lv(e,t,n,r,i){return eo(),Df(i),t.flags|=256,Tt(e,t,n,r),t.child}var Wp={dehydrated:null,treeContext:null,retryLane:0};function Qp(e){return{baseLanes:e,cachePool:null,transitions:null}}function c_(e,t,n){var r=t.pendingProps,i=Me.current,o=!1,d=(t.flags&128)!==0,h;if((h=d)||(h=e!==null&&e.memoizedState===null?!1:(i&2)!==0),h?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),be(Me,i&1),e===null)return Up(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=r.children,e=r.fallback,o?(r=t.mode,o=t.child,d={mode:"hidden",children:d},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=d):o=ql(d,r,0,null),e=Ls(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Qp(n),t.memoizedState=Wp,e):Qf(t,d));if(i=e.memoizedState,i!==null&&(h=i.dehydrated,h!==null))return mb(e,t,d,r,h,i,n);if(o){o=r.fallback,d=t.mode,i=e.child,h=i.sibling;var m={mode:"hidden",children:r.children};return!(d&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=m,t.deletions=null):(r=Wr(i,m),r.subtreeFlags=i.subtreeFlags&14680064),h!==null?o=Wr(h,o):(o=Ls(o,d,n,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,d=e.child.memoizedState,d=d===null?Qp(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},o.memoizedState=d,o.childLanes=e.childLanes&~n,t.memoizedState=Wp,r}return o=e.child,e=o.sibling,r=Wr(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Qf(e,t){return t=ql({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function zc(e,t,n,r){return r!==null&&Df(r),to(t,e.child,null,n),e=Qf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function mb(e,t,n,r,i,o,d){if(n)return t.flags&256?(t.flags&=-257,r=Ku(Error(Q(422))),zc(e,t,d,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=ql({mode:"visible",children:r.children},i,0,null),o=Ls(o,i,d,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&to(t,e.child,null,d),t.child.memoizedState=Qp(d),t.memoizedState=Wp,o);if(!(t.mode&1))return zc(e,t,d,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var h=r.dgst;return r=h,o=Error(Q(419)),r=Ku(o,r,void 0),zc(e,t,d,r)}if(h=(d&e.childLanes)!==0,At||h){if(r=Ze,r!==null){switch(d&-d){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|d)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,mr(e,i),Rn(r,e,i,-1))}return Zf(),r=Ku(Error(Q(421))),zc(e,t,d,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=Rb.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,Jt=Br(i.nextSibling),qt=t,Le=!0,kn=null,e!==null&&(un[pn++]=lr,un[pn++]=dr,un[pn++]=Os,lr=e.id,dr=e.overflow,Os=t),t=Qf(t,r.children),t.flags|=4096,t)}function dv(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Fp(e.return,t,n)}function Yu(e,t,n,r,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function l_(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Tt(e,t,r.children,n),r=Me.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&dv(e,n,t);else if(e.tag===19)dv(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(be(Me,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Pl(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Yu(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Pl(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Yu(t,!0,n,null,o);break;case"together":Yu(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function rl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function gr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),$s|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Q(153));if(t.child!==null){for(e=t.child,n=Wr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Wr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function gb(e,t,n){switch(t.tag){case 3:a_(t),eo();break;case 5:Mw(t);break;case 1:Ut(t.type)&&kl(t);break;case 4:Uf(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;be(Il,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(be(Me,Me.current&1),t.flags|=128,null):n&t.child.childLanes?c_(e,t,n):(be(Me,Me.current&1),e=gr(e,t,n),e!==null?e.sibling:null);be(Me,Me.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return l_(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),be(Me,Me.current),r)break;return null;case 22:case 23:return t.lanes=0,i_(e,t,n)}return gr(e,t,n)}var d_,Kp,u_,p_;d_=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Kp=function(){};u_=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,xs(Qn.current);var o=null;switch(n){case"input":i=gp(e,i),r=gp(e,r),o=[];break;case"select":i=Ae({},i,{value:void 0}),r=Ae({},r,{value:void 0}),o=[];break;case"textarea":i=wp(e,i),r=wp(e,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=bl)}Sp(n,r);var d;n=null;for(g in i)if(!r.hasOwnProperty(g)&&i.hasOwnProperty(g)&&i[g]!=null)if(g==="style"){var h=i[g];for(d in h)h.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else g!=="dangerouslySetInnerHTML"&&g!=="children"&&g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(ua.hasOwnProperty(g)?o||(o=[]):(o=o||[]).push(g,null));for(g in r){var m=r[g];if(h=i!=null?i[g]:void 0,r.hasOwnProperty(g)&&m!==h&&(m!=null||h!=null))if(g==="style")if(h){for(d in h)!h.hasOwnProperty(d)||m&&m.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in m)m.hasOwnProperty(d)&&h[d]!==m[d]&&(n||(n={}),n[d]=m[d])}else n||(o||(o=[]),o.push(g,n)),n=m;else g==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,h=h?h.__html:void 0,m!=null&&h!==m&&(o=o||[]).push(g,m)):g==="children"?typeof m!="string"&&typeof m!="number"||(o=o||[]).push(g,""+m):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&(ua.hasOwnProperty(g)?(m!=null&&g==="onScroll"&&Ne("scroll",e),o||h===m||(o=[])):(o=o||[]).push(g,m))}n&&(o=o||[]).push("style",n);var g=o;(t.updateQueue=g)&&(t.flags|=4)}};p_=function(e,t,n,r){n!==r&&(t.flags|=4)};function Uo(e,t){if(!Le)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function wt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function vb(e,t,n){var r=t.pendingProps;switch(Pf(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(t),null;case 1:return Ut(t.type)&&El(),wt(t),null;case 3:return r=t.stateNode,no(),je($t),je(St),zf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Uc(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,kn!==null&&(nf(kn),kn=null))),Kp(e,t),wt(t),null;case 5:Ff(t);var i=xs(xa.current);if(n=t.type,e!==null&&t.stateNode!=null)u_(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Q(166));return wt(t),null}if(e=xs(Qn.current),Uc(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[Hn]=t,r[Sa]=o,e=(t.mode&1)!==0,n){case"dialog":Ne("cancel",r),Ne("close",r);break;case"iframe":case"object":case"embed":Ne("load",r);break;case"video":case"audio":for(i=0;i<Xo.length;i++)Ne(Xo[i],r);break;case"source":Ne("error",r);break;case"img":case"image":case"link":Ne("error",r),Ne("load",r);break;case"details":Ne("toggle",r);break;case"input":wg(r,o),Ne("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ne("invalid",r);break;case"textarea":Sg(r,o),Ne("invalid",r)}Sp(n,o),i=null;for(var d in o)if(o.hasOwnProperty(d)){var h=o[d];d==="children"?typeof h=="string"?r.textContent!==h&&(o.suppressHydrationWarning!==!0&&$c(r.textContent,h,e),i=["children",h]):typeof h=="number"&&r.textContent!==""+h&&(o.suppressHydrationWarning!==!0&&$c(r.textContent,h,e),i=["children",""+h]):ua.hasOwnProperty(d)&&h!=null&&d==="onScroll"&&Ne("scroll",r)}switch(n){case"input":Nc(r),_g(r,o,!0);break;case"textarea":Nc(r),Cg(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=bl)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{d=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Fy(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=d.createElement(n,{is:r.is}):(e=d.createElement(n),n==="select"&&(d=e,r.multiple?d.multiple=!0:r.size&&(d.size=r.size))):e=d.createElementNS(e,n),e[Hn]=t,e[Sa]=r,d_(e,t,!1,!1),t.stateNode=e;e:{switch(d=Cp(n,r),n){case"dialog":Ne("cancel",e),Ne("close",e),i=r;break;case"iframe":case"object":case"embed":Ne("load",e),i=r;break;case"video":case"audio":for(i=0;i<Xo.length;i++)Ne(Xo[i],e);i=r;break;case"source":Ne("error",e),i=r;break;case"img":case"image":case"link":Ne("error",e),Ne("load",e),i=r;break;case"details":Ne("toggle",e),i=r;break;case"input":wg(e,r),i=gp(e,r),Ne("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Ae({},r,{value:void 0}),Ne("invalid",e);break;case"textarea":Sg(e,r),i=wp(e,r),Ne("invalid",e);break;default:i=r}Sp(n,i),h=i;for(o in h)if(h.hasOwnProperty(o)){var m=h[o];o==="style"?Vy(e,m):o==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&zy(e,m)):o==="children"?typeof m=="string"?(n!=="textarea"||m!=="")&&pa(e,m):typeof m=="number"&&pa(e,""+m):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ua.hasOwnProperty(o)?m!=null&&o==="onScroll"&&Ne("scroll",e):m!=null&&vf(e,o,m,d))}switch(n){case"input":Nc(e),_g(e,r,!1);break;case"textarea":Nc(e),Cg(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Kr(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?zi(e,!!r.multiple,o,!1):r.defaultValue!=null&&zi(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=bl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return wt(t),null;case 6:if(e&&t.stateNode!=null)p_(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Q(166));if(n=xs(xa.current),xs(Qn.current),Uc(t)){if(r=t.stateNode,n=t.memoizedProps,r[Hn]=t,(o=r.nodeValue!==n)&&(e=qt,e!==null))switch(e.tag){case 3:$c(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&$c(r.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Hn]=t,t.stateNode=r}return wt(t),null;case 13:if(je(Me),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Le&&Jt!==null&&t.mode&1&&!(t.flags&128))Nw(),eo(),t.flags|=98560,o=!1;else if(o=Uc(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(Q(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Q(317));o[Hn]=t}else eo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wt(t),o=!1}else kn!==null&&(nf(kn),kn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Me.current&1?Je===0&&(Je=3):Zf())),t.updateQueue!==null&&(t.flags|=4),wt(t),null);case 4:return no(),Kp(e,t),e===null&&wa(t.stateNode.containerInfo),wt(t),null;case 10:return Of(t.type._context),wt(t),null;case 17:return Ut(t.type)&&El(),wt(t),null;case 19:if(je(Me),o=t.memoizedState,o===null)return wt(t),null;if(r=(t.flags&128)!==0,d=o.rendering,d===null)if(r)Uo(o,!1);else{if(Je!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=Pl(e),d!==null){for(t.flags|=128,Uo(o,!1),r=d.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)o=n,e=r,o.flags&=14680066,d=o.alternate,d===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=d.childLanes,o.lanes=d.lanes,o.child=d.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=d.memoizedProps,o.memoizedState=d.memoizedState,o.updateQueue=d.updateQueue,o.type=d.type,e=d.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return be(Me,Me.current&1|2),t.child}e=e.sibling}o.tail!==null&&Be()>so&&(t.flags|=128,r=!0,Uo(o,!1),t.lanes=4194304)}else{if(!r)if(e=Pl(d),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Uo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!d.alternate&&!Le)return wt(t),null}else 2*Be()-o.renderingStartTime>so&&n!==1073741824&&(t.flags|=128,r=!0,Uo(o,!1),t.lanes=4194304);o.isBackwards?(d.sibling=t.child,t.child=d):(n=o.last,n!==null?n.sibling=d:t.child=d,o.last=d)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Be(),t.sibling=null,n=Me.current,be(Me,r?n&1|2:n&1),t):(wt(t),null);case 22:case 23:return Xf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Qt&1073741824&&(wt(t),t.subtreeFlags&6&&(t.flags|=8192)):wt(t),null;case 24:return null;case 25:return null}throw Error(Q(156,t.tag))}function yb(e,t){switch(Pf(t),t.tag){case 1:return Ut(t.type)&&El(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return no(),je($t),je(St),zf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ff(t),null;case 13:if(je(Me),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Q(340));eo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return je(Me),null;case 4:return no(),null;case 10:return Of(t.type._context),null;case 22:case 23:return Xf(),null;case 24:return null;default:return null}}var Bc=!1,_t=!1,wb=typeof WeakSet=="function"?WeakSet:Set,ee=null;function $i(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){$e(e,t,r)}else n.current=null}function Yp(e,t,n){try{n()}catch(r){$e(e,t,r)}}var uv=!1;function _b(e,t){if(Pp=Sl,e=vw(),Nf(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var d=0,h=-1,m=-1,g=0,f=0,S=e,T=null;t:for(;;){for(var A;S!==n||i!==0&&S.nodeType!==3||(h=d+i),S!==o||r!==0&&S.nodeType!==3||(m=d+r),S.nodeType===3&&(d+=S.nodeValue.length),(A=S.firstChild)!==null;)T=S,S=A;for(;;){if(S===e)break t;if(T===n&&++g===i&&(h=d),T===o&&++f===r&&(m=d),(A=S.nextSibling)!==null)break;S=T,T=S.parentNode}S=A}n=h===-1||m===-1?null:{start:h,end:m}}else n=null}n=n||{start:0,end:0}}else n=null;for(Dp={focusedElem:e,selectionRange:n},Sl=!1,ee=t;ee!==null;)if(t=ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ee=e;else for(;ee!==null;){t=ee;try{var G=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var B=G.memoizedProps,y=G.memoizedState,l=t.stateNode,p=l.getSnapshotBeforeUpdate(t.elementType===t.type?B:bn(t.type,B),y);l.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(x){$e(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,ee=e;break}ee=t.return}return G=uv,uv=!1,G}function ia(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&Yp(t,n,o)}i=i.next}while(i!==r)}}function Yl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Jp(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function f_(e){var t=e.alternate;t!==null&&(e.alternate=null,f_(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Hn],delete t[Sa],delete t[Op],delete t[nb],delete t[rb])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function h_(e){return e.tag===5||e.tag===3||e.tag===4}function pv(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||h_(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qp(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=bl));else if(r!==4&&(e=e.child,e!==null))for(qp(e,t,n),e=e.sibling;e!==null;)qp(e,t,n),e=e.sibling}function Xp(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Xp(e,t,n),e=e.sibling;e!==null;)Xp(e,t,n),e=e.sibling}var it=null,En=!1;function Ir(e,t,n){for(n=n.child;n!==null;)m_(e,t,n),n=n.sibling}function m_(e,t,n){if(Wn&&typeof Wn.onCommitFiberUnmount=="function")try{Wn.onCommitFiberUnmount(zl,n)}catch{}switch(n.tag){case 5:_t||$i(n,t);case 6:var r=it,i=En;it=null,Ir(e,t,n),it=r,En=i,it!==null&&(En?(e=it,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):it.removeChild(n.stateNode));break;case 18:it!==null&&(En?(e=it,n=n.stateNode,e.nodeType===8?Bu(e.parentNode,n):e.nodeType===1&&Bu(e,n),ga(e)):Bu(it,n.stateNode));break;case 4:r=it,i=En,it=n.stateNode.containerInfo,En=!0,Ir(e,t,n),it=r,En=i;break;case 0:case 11:case 14:case 15:if(!_t&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,d=o.destroy;o=o.tag,d!==void 0&&(o&2||o&4)&&Yp(n,t,d),i=i.next}while(i!==r)}Ir(e,t,n);break;case 1:if(!_t&&($i(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(h){$e(n,t,h)}Ir(e,t,n);break;case 21:Ir(e,t,n);break;case 22:n.mode&1?(_t=(r=_t)||n.memoizedState!==null,Ir(e,t,n),_t=r):Ir(e,t,n);break;default:Ir(e,t,n)}}function fv(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new wb),t.forEach(function(r){var i=Ib.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Cn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,d=t,h=d;e:for(;h!==null;){switch(h.tag){case 5:it=h.stateNode,En=!1;break e;case 3:it=h.stateNode.containerInfo,En=!0;break e;case 4:it=h.stateNode.containerInfo,En=!0;break e}h=h.return}if(it===null)throw Error(Q(160));m_(o,d,i),it=null,En=!1;var m=i.alternate;m!==null&&(m.return=null),i.return=null}catch(g){$e(i,t,g)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)g_(t,e),t=t.sibling}function g_(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Cn(t,e),Un(e),r&4){try{ia(3,e,e.return),Yl(3,e)}catch(B){$e(e,e.return,B)}try{ia(5,e,e.return)}catch(B){$e(e,e.return,B)}}break;case 1:Cn(t,e),Un(e),r&512&&n!==null&&$i(n,n.return);break;case 5:if(Cn(t,e),Un(e),r&512&&n!==null&&$i(n,n.return),e.flags&32){var i=e.stateNode;try{pa(i,"")}catch(B){$e(e,e.return,B)}}if(r&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,d=n!==null?n.memoizedProps:o,h=e.type,m=e.updateQueue;if(e.updateQueue=null,m!==null)try{h==="input"&&o.type==="radio"&&o.name!=null&&$y(i,o),Cp(h,d);var g=Cp(h,o);for(d=0;d<m.length;d+=2){var f=m[d],S=m[d+1];f==="style"?Vy(i,S):f==="dangerouslySetInnerHTML"?zy(i,S):f==="children"?pa(i,S):vf(i,f,S,g)}switch(h){case"input":vp(i,o);break;case"textarea":Uy(i,o);break;case"select":var T=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?zi(i,!!o.multiple,A,!1):T!==!!o.multiple&&(o.defaultValue!=null?zi(i,!!o.multiple,o.defaultValue,!0):zi(i,!!o.multiple,o.multiple?[]:"",!1))}i[Sa]=o}catch(B){$e(e,e.return,B)}}break;case 6:if(Cn(t,e),Un(e),r&4){if(e.stateNode===null)throw Error(Q(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(B){$e(e,e.return,B)}}break;case 3:if(Cn(t,e),Un(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ga(t.containerInfo)}catch(B){$e(e,e.return,B)}break;case 4:Cn(t,e),Un(e);break;case 13:Cn(t,e),Un(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Jf=Be())),r&4&&fv(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(_t=(g=_t)||f,Cn(t,e),_t=g):Cn(t,e),Un(e),r&8192){if(g=e.memoizedState!==null,(e.stateNode.isHidden=g)&&!f&&e.mode&1)for(ee=e,f=e.child;f!==null;){for(S=ee=f;ee!==null;){switch(T=ee,A=T.child,T.tag){case 0:case 11:case 14:case 15:ia(4,T,T.return);break;case 1:$i(T,T.return);var G=T.stateNode;if(typeof G.componentWillUnmount=="function"){r=T,n=T.return;try{t=r,G.props=t.memoizedProps,G.state=t.memoizedState,G.componentWillUnmount()}catch(B){$e(r,n,B)}}break;case 5:$i(T,T.return);break;case 22:if(T.memoizedState!==null){mv(S);continue}}A!==null?(A.return=T,ee=A):mv(S)}f=f.sibling}e:for(f=null,S=e;;){if(S.tag===5){if(f===null){f=S;try{i=S.stateNode,g?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(h=S.stateNode,m=S.memoizedProps.style,d=m!=null&&m.hasOwnProperty("display")?m.display:null,h.style.display=By("display",d))}catch(B){$e(e,e.return,B)}}}else if(S.tag===6){if(f===null)try{S.stateNode.nodeValue=g?"":S.memoizedProps}catch(B){$e(e,e.return,B)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===e)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===e)break e;for(;S.sibling===null;){if(S.return===null||S.return===e)break e;f===S&&(f=null),S=S.return}f===S&&(f=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:Cn(t,e),Un(e),r&4&&fv(e);break;case 21:break;default:Cn(t,e),Un(e)}}function Un(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(h_(n)){var r=n;break e}n=n.return}throw Error(Q(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(pa(i,""),r.flags&=-33);var o=pv(e);Xp(e,o,i);break;case 3:case 4:var d=r.stateNode.containerInfo,h=pv(e);qp(e,h,d);break;default:throw Error(Q(161))}}catch(m){$e(e,e.return,m)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Sb(e,t,n){ee=e,v_(e)}function v_(e,t,n){for(var r=(e.mode&1)!==0;ee!==null;){var i=ee,o=i.child;if(i.tag===22&&r){var d=i.memoizedState!==null||Bc;if(!d){var h=i.alternate,m=h!==null&&h.memoizedState!==null||_t;h=Bc;var g=_t;if(Bc=d,(_t=m)&&!g)for(ee=i;ee!==null;)d=ee,m=d.child,d.tag===22&&d.memoizedState!==null?gv(i):m!==null?(m.return=d,ee=m):gv(i);for(;o!==null;)ee=o,v_(o),o=o.sibling;ee=i,Bc=h,_t=g}hv(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ee=o):hv(e)}}function hv(e){for(;ee!==null;){var t=ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:_t||Yl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!_t)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:bn(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Xg(t,o,r);break;case 3:var d=t.updateQueue;if(d!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Xg(t,d,n)}break;case 5:var h=t.stateNode;if(n===null&&t.flags&4){n=h;var m=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&n.focus();break;case"img":m.src&&(n.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var g=t.alternate;if(g!==null){var f=g.memoizedState;if(f!==null){var S=f.dehydrated;S!==null&&ga(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}_t||t.flags&512&&Jp(t)}catch(T){$e(t,t.return,T)}}if(t===e){ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,ee=n;break}ee=t.return}}function mv(e){for(;ee!==null;){var t=ee;if(t===e){ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ee=n;break}ee=t.return}}function gv(e){for(;ee!==null;){var t=ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Yl(4,t)}catch(m){$e(t,n,m)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(m){$e(t,i,m)}}var o=t.return;try{Jp(t)}catch(m){$e(t,o,m)}break;case 5:var d=t.return;try{Jp(t)}catch(m){$e(t,d,m)}}}catch(m){$e(t,t.return,m)}if(t===e){ee=null;break}var h=t.sibling;if(h!==null){h.return=t.return,ee=h;break}ee=t.return}}var Cb=Math.ceil,Ml=vr.ReactCurrentDispatcher,Kf=vr.ReactCurrentOwner,hn=vr.ReactCurrentBatchConfig,me=0,Ze=null,We=null,ot=0,Qt=0,Ui=qr(0),Je=0,Ta=null,$s=0,Jl=0,Yf=0,oa=null,Ot=null,Jf=0,so=1/0,or=null,Ol=!1,Zp=null,Gr=null,Vc=!1,$r=null,Al=0,aa=0,ef=null,sl=-1,il=0;function It(){return me&6?Be():sl!==-1?sl:sl=Be()}function Hr(e){return e.mode&1?me&2&&ot!==0?ot&-ot:ib.transition!==null?(il===0&&(il=tw()),il):(e=we,e!==0||(e=window.event,e=e===void 0?16:cw(e.type)),e):1}function Rn(e,t,n,r){if(50<aa)throw aa=0,ef=null,Error(Q(185));Na(e,n,r),(!(me&2)||e!==Ze)&&(e===Ze&&(!(me&2)&&(Jl|=n),Je===4&&Mr(e,ot)),Ft(e,r),n===1&&me===0&&!(t.mode&1)&&(so=Be()+500,Wl&&Xr()))}function Ft(e,t){var n=e.callbackNode;i0(e,t);var r=_l(e,e===Ze?ot:0);if(r===0)n!==null&&Eg(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Eg(n),t===1)e.tag===0?sb(vv.bind(null,e)):Tw(vv.bind(null,e)),eb(function(){!(me&6)&&Xr()}),n=null;else{switch(nw(r)){case 1:n=Cf;break;case 4:n=Zy;break;case 16:n=wl;break;case 536870912:n=ew;break;default:n=wl}n=E_(n,y_.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function y_(e,t){if(sl=-1,il=0,me&6)throw Error(Q(327));var n=e.callbackNode;if(Wi()&&e.callbackNode!==n)return null;var r=_l(e,e===Ze?ot:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=$l(e,r);else{t=r;var i=me;me|=2;var o=__();(Ze!==e||ot!==t)&&(or=null,so=Be()+500,Ds(e,t));do try{Eb();break}catch(h){w_(e,h)}while(!0);Mf(),Ml.current=o,me=i,We!==null?t=0:(Ze=null,ot=0,t=Je)}if(t!==0){if(t===2&&(i=Tp(e),i!==0&&(r=i,t=tf(e,i))),t===1)throw n=Ta,Ds(e,0),Mr(e,r),Ft(e,Be()),n;if(t===6)Mr(e,r);else{if(i=e.current.alternate,!(r&30)&&!xb(i)&&(t=$l(e,r),t===2&&(o=Tp(e),o!==0&&(r=o,t=tf(e,o))),t===1))throw n=Ta,Ds(e,0),Mr(e,r),Ft(e,Be()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(Q(345));case 2:ws(e,Ot,or);break;case 3:if(Mr(e,r),(r&130023424)===r&&(t=Jf+500-Be(),10<t)){if(_l(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){It(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Mp(ws.bind(null,e,Ot,or),t);break}ws(e,Ot,or);break;case 4:if(Mr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var d=31-Tn(r);o=1<<d,d=t[d],d>i&&(i=d),r&=~o}if(r=i,r=Be()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cb(r/1960))-r,10<r){e.timeoutHandle=Mp(ws.bind(null,e,Ot,or),r);break}ws(e,Ot,or);break;case 5:ws(e,Ot,or);break;default:throw Error(Q(329))}}}return Ft(e,Be()),e.callbackNode===n?y_.bind(null,e):null}function tf(e,t){var n=oa;return e.current.memoizedState.isDehydrated&&(Ds(e,t).flags|=256),e=$l(e,t),e!==2&&(t=Ot,Ot=n,t!==null&&nf(t)),e}function nf(e){Ot===null?Ot=e:Ot.push.apply(Ot,e)}function xb(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Nn(o(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Mr(e,t){for(t&=~Yf,t&=~Jl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Tn(t),r=1<<n;e[n]=-1,t&=~r}}function vv(e){if(me&6)throw Error(Q(327));Wi();var t=_l(e,0);if(!(t&1))return Ft(e,Be()),null;var n=$l(e,t);if(e.tag!==0&&n===2){var r=Tp(e);r!==0&&(t=r,n=tf(e,r))}if(n===1)throw n=Ta,Ds(e,0),Mr(e,t),Ft(e,Be()),n;if(n===6)throw Error(Q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ws(e,Ot,or),Ft(e,Be()),null}function qf(e,t){var n=me;me|=1;try{return e(t)}finally{me=n,me===0&&(so=Be()+500,Wl&&Xr())}}function Us(e){$r!==null&&$r.tag===0&&!(me&6)&&Wi();var t=me;me|=1;var n=hn.transition,r=we;try{if(hn.transition=null,we=1,e)return e()}finally{we=r,hn.transition=n,me=t,!(me&6)&&Xr()}}function Xf(){Qt=Ui.current,je(Ui)}function Ds(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Z0(n)),We!==null)for(n=We.return;n!==null;){var r=n;switch(Pf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&El();break;case 3:no(),je($t),je(St),zf();break;case 5:Ff(r);break;case 4:no();break;case 13:je(Me);break;case 19:je(Me);break;case 10:Of(r.type._context);break;case 22:case 23:Xf()}n=n.return}if(Ze=e,We=e=Wr(e.current,null),ot=Qt=t,Je=0,Ta=null,Yf=Jl=$s=0,Ot=oa=null,Cs!==null){for(t=0;t<Cs.length;t++)if(n=Cs[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var d=o.next;o.next=i,r.next=d}n.pending=r}Cs=null}return e}function w_(e,t){do{var n=We;try{if(Mf(),tl.current=Ll,Dl){for(var r=Oe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Dl=!1}if(As=0,Xe=Ye=Oe=null,sa=!1,ba=0,Kf.current=null,n===null||n.return===null){Je=1,Ta=t,We=null;break}e:{var o=e,d=n.return,h=n,m=t;if(t=ot,h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var g=m,f=h,S=f.tag;if(!(f.mode&1)&&(S===0||S===11||S===15)){var T=f.alternate;T?(f.updateQueue=T.updateQueue,f.memoizedState=T.memoizedState,f.lanes=T.lanes):(f.updateQueue=null,f.memoizedState=null)}var A=sv(d);if(A!==null){A.flags&=-257,iv(A,d,h,o,t),A.mode&1&&rv(o,g,t),t=A,m=g;var G=t.updateQueue;if(G===null){var B=new Set;B.add(m),t.updateQueue=B}else G.add(m);break e}else{if(!(t&1)){rv(o,g,t),Zf();break e}m=Error(Q(426))}}else if(Le&&h.mode&1){var y=sv(d);if(y!==null){!(y.flags&65536)&&(y.flags|=256),iv(y,d,h,o,t),Df(ro(m,h));break e}}o=m=ro(m,h),Je!==4&&(Je=2),oa===null?oa=[o]:oa.push(o),o=d;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var l=n_(o,m,t);qg(o,l);break e;case 1:h=m;var p=o.type,v=o.stateNode;if(!(o.flags&128)&&(typeof p.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Gr===null||!Gr.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t;var x=r_(o,h,t);qg(o,x);break e}}o=o.return}while(o!==null)}C_(n)}catch(j){t=j,We===n&&n!==null&&(We=n=n.return);continue}break}while(!0)}function __(){var e=Ml.current;return Ml.current=Ll,e===null?Ll:e}function Zf(){(Je===0||Je===3||Je===2)&&(Je=4),Ze===null||!($s&268435455)&&!(Jl&268435455)||Mr(Ze,ot)}function $l(e,t){var n=me;me|=2;var r=__();(Ze!==e||ot!==t)&&(or=null,Ds(e,t));do try{bb();break}catch(i){w_(e,i)}while(!0);if(Mf(),me=n,Ml.current=r,We!==null)throw Error(Q(261));return Ze=null,ot=0,Je}function bb(){for(;We!==null;)S_(We)}function Eb(){for(;We!==null&&!Jx();)S_(We)}function S_(e){var t=b_(e.alternate,e,Qt);e.memoizedProps=e.pendingProps,t===null?C_(e):We=t,Kf.current=null}function C_(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=yb(n,t),n!==null){n.flags&=32767,We=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Je=6,We=null;return}}else if(n=vb(n,t,Qt),n!==null){We=n;return}if(t=t.sibling,t!==null){We=t;return}We=t=e}while(t!==null);Je===0&&(Je=5)}function ws(e,t,n){var r=we,i=hn.transition;try{hn.transition=null,we=1,kb(e,t,n,r)}finally{hn.transition=i,we=r}return null}function kb(e,t,n,r){do Wi();while($r!==null);if(me&6)throw Error(Q(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Q(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(o0(e,o),e===Ze&&(We=Ze=null,ot=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Vc||(Vc=!0,E_(wl,function(){return Wi(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=hn.transition,hn.transition=null;var d=we;we=1;var h=me;me|=4,Kf.current=null,_b(e,n),g_(n,e),W0(Dp),Sl=!!Pp,Dp=Pp=null,e.current=n,Sb(n),qx(),me=h,we=d,hn.transition=o}else e.current=n;if(Vc&&(Vc=!1,$r=e,Al=i),o=e.pendingLanes,o===0&&(Gr=null),e0(n.stateNode),Ft(e,Be()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ol)throw Ol=!1,e=Zp,Zp=null,e;return Al&1&&e.tag!==0&&Wi(),o=e.pendingLanes,o&1?e===ef?aa++:(aa=0,ef=e):aa=0,Xr(),null}function Wi(){if($r!==null){var e=nw(Al),t=hn.transition,n=we;try{if(hn.transition=null,we=16>e?16:e,$r===null)var r=!1;else{if(e=$r,$r=null,Al=0,me&6)throw Error(Q(331));var i=me;for(me|=4,ee=e.current;ee!==null;){var o=ee,d=o.child;if(ee.flags&16){var h=o.deletions;if(h!==null){for(var m=0;m<h.length;m++){var g=h[m];for(ee=g;ee!==null;){var f=ee;switch(f.tag){case 0:case 11:case 15:ia(8,f,o)}var S=f.child;if(S!==null)S.return=f,ee=S;else for(;ee!==null;){f=ee;var T=f.sibling,A=f.return;if(f_(f),f===g){ee=null;break}if(T!==null){T.return=A,ee=T;break}ee=A}}}var G=o.alternate;if(G!==null){var B=G.child;if(B!==null){G.child=null;do{var y=B.sibling;B.sibling=null,B=y}while(B!==null)}}ee=o}}if(o.subtreeFlags&2064&&d!==null)d.return=o,ee=d;else e:for(;ee!==null;){if(o=ee,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ia(9,o,o.return)}var l=o.sibling;if(l!==null){l.return=o.return,ee=l;break e}ee=o.return}}var p=e.current;for(ee=p;ee!==null;){d=ee;var v=d.child;if(d.subtreeFlags&2064&&v!==null)v.return=d,ee=v;else e:for(d=p;ee!==null;){if(h=ee,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:Yl(9,h)}}catch(j){$e(h,h.return,j)}if(h===d){ee=null;break e}var x=h.sibling;if(x!==null){x.return=h.return,ee=x;break e}ee=h.return}}if(me=i,Xr(),Wn&&typeof Wn.onPostCommitFiberRoot=="function")try{Wn.onPostCommitFiberRoot(zl,e)}catch{}r=!0}return r}finally{we=n,hn.transition=t}}return!1}function yv(e,t,n){t=ro(n,t),t=n_(e,t,1),e=Vr(e,t,1),t=It(),e!==null&&(Na(e,1,t),Ft(e,t))}function $e(e,t,n){if(e.tag===3)yv(e,e,n);else for(;t!==null;){if(t.tag===3){yv(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Gr===null||!Gr.has(r))){e=ro(n,e),e=r_(t,e,1),t=Vr(t,e,1),e=It(),t!==null&&(Na(t,1,e),Ft(t,e));break}}t=t.return}}function Tb(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=It(),e.pingedLanes|=e.suspendedLanes&n,Ze===e&&(ot&n)===n&&(Je===4||Je===3&&(ot&130023424)===ot&&500>Be()-Jf?Ds(e,0):Yf|=n),Ft(e,t)}function x_(e,t){t===0&&(e.mode&1?(t=Dc,Dc<<=1,!(Dc&130023424)&&(Dc=4194304)):t=1);var n=It();e=mr(e,t),e!==null&&(Na(e,t,n),Ft(e,n))}function Rb(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),x_(e,n)}function Ib(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Q(314))}r!==null&&r.delete(t),x_(e,n)}var b_;b_=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||$t.current)At=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return At=!1,gb(e,t,n);At=!!(e.flags&131072)}else At=!1,Le&&t.flags&1048576&&Rw(t,Rl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;rl(e,t),e=t.pendingProps;var i=Zi(t,St.current);Hi(t,n),i=Vf(null,t,r,e,i,n);var o=Gf();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ut(r)?(o=!0,kl(t)):o=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,$f(t),i.updater=Kl,t.stateNode=i,i._reactInternals=t,Bp(t,r,e,n),t=Hp(null,t,r,!0,o,n)):(t.tag=0,Le&&o&&jf(t),Tt(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(rl(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=jb(r),e=bn(r,e),i){case 0:t=Gp(null,t,r,e,n);break e;case 1:t=cv(null,t,r,e,n);break e;case 11:t=ov(null,t,r,e,n);break e;case 14:t=av(null,t,r,bn(r.type,e),n);break e}throw Error(Q(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:bn(r,i),Gp(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:bn(r,i),cv(e,t,r,i,n);case 3:e:{if(a_(t),e===null)throw Error(Q(387));r=t.pendingProps,o=t.memoizedState,i=o.element,Lw(e,t),jl(t,r,null,n);var d=t.memoizedState;if(r=d.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){i=ro(Error(Q(423)),t),t=lv(e,t,r,n,i);break e}else if(r!==i){i=ro(Error(Q(424)),t),t=lv(e,t,r,n,i);break e}else for(Jt=Br(t.stateNode.containerInfo.firstChild),qt=t,Le=!0,kn=null,n=Pw(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(eo(),r===i){t=gr(e,t,n);break e}Tt(e,t,r,n)}t=t.child}return t;case 5:return Mw(t),e===null&&Up(t),r=t.type,i=t.pendingProps,o=e!==null?e.memoizedProps:null,d=i.children,Lp(r,i)?d=null:o!==null&&Lp(r,o)&&(t.flags|=32),o_(e,t),Tt(e,t,d,n),t.child;case 6:return e===null&&Up(t),null;case 13:return c_(e,t,n);case 4:return Uf(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=to(t,null,r,n):Tt(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:bn(r,i),ov(e,t,r,i,n);case 7:return Tt(e,t,t.pendingProps,n),t.child;case 8:return Tt(e,t,t.pendingProps.children,n),t.child;case 12:return Tt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,d=i.value,be(Il,r._currentValue),r._currentValue=d,o!==null)if(Nn(o.value,d)){if(o.children===i.children&&!$t.current){t=gr(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var h=o.dependencies;if(h!==null){d=o.child;for(var m=h.firstContext;m!==null;){if(m.context===r){if(o.tag===1){m=ur(-1,n&-n),m.tag=2;var g=o.updateQueue;if(g!==null){g=g.shared;var f=g.pending;f===null?m.next=m:(m.next=f.next,f.next=m),g.pending=m}}o.lanes|=n,m=o.alternate,m!==null&&(m.lanes|=n),Fp(o.return,n,t),h.lanes|=n;break}m=m.next}}else if(o.tag===10)d=o.type===t.type?null:o.child;else if(o.tag===18){if(d=o.return,d===null)throw Error(Q(341));d.lanes|=n,h=d.alternate,h!==null&&(h.lanes|=n),Fp(d,n,t),d=o.sibling}else d=o.child;if(d!==null)d.return=o;else for(d=o;d!==null;){if(d===t){d=null;break}if(o=d.sibling,o!==null){o.return=d.return,d=o;break}d=d.return}o=d}Tt(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Hi(t,n),i=mn(i),r=r(i),t.flags|=1,Tt(e,t,r,n),t.child;case 14:return r=t.type,i=bn(r,t.pendingProps),i=bn(r.type,i),av(e,t,r,i,n);case 15:return s_(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:bn(r,i),rl(e,t),t.tag=1,Ut(r)?(e=!0,kl(t)):e=!1,Hi(t,n),t_(t,r,i),Bp(t,r,i,n),Hp(null,t,r,!0,e,n);case 19:return l_(e,t,n);case 22:return i_(e,t,n)}throw Error(Q(156,t.tag))};function E_(e,t){return Xy(e,t)}function Nb(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(e,t,n,r){return new Nb(e,t,n,r)}function eh(e){return e=e.prototype,!(!e||!e.isReactComponent)}function jb(e){if(typeof e=="function")return eh(e)?1:0;if(e!=null){if(e=e.$$typeof,e===wf)return 11;if(e===_f)return 14}return 2}function Wr(e,t){var n=e.alternate;return n===null?(n=fn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ol(e,t,n,r,i,o){var d=2;if(r=e,typeof e=="function")eh(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case Ii:return Ls(n.children,i,o,t);case yf:d=8,i|=8;break;case pp:return e=fn(12,n,t,i|2),e.elementType=pp,e.lanes=o,e;case fp:return e=fn(13,n,t,i),e.elementType=fp,e.lanes=o,e;case hp:return e=fn(19,n,t,i),e.elementType=hp,e.lanes=o,e;case My:return ql(n,i,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Dy:d=10;break e;case Ly:d=9;break e;case wf:d=11;break e;case _f:d=14;break e;case Pr:d=16,r=null;break e}throw Error(Q(130,e==null?e:typeof e,""))}return t=fn(d,n,t,i),t.elementType=e,t.type=r,t.lanes=o,t}function Ls(e,t,n,r){return e=fn(7,e,r,t),e.lanes=n,e}function ql(e,t,n,r){return e=fn(22,e,r,t),e.elementType=My,e.lanes=n,e.stateNode={isHidden:!1},e}function Ju(e,t,n){return e=fn(6,e,null,t),e.lanes=n,e}function qu(e,t,n){return t=fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pb(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ju(0),this.expirationTimes=ju(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ju(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function th(e,t,n,r,i,o,d,h,m){return e=new Pb(e,t,n,h,m),t===1?(t=1,o===!0&&(t|=8)):t=0,o=fn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},$f(o),e}function Db(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ri,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function k_(e){if(!e)return Yr;e=e._reactInternals;e:{if(Vs(e)!==e||e.tag!==1)throw Error(Q(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ut(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Q(171))}if(e.tag===1){var n=e.type;if(Ut(n))return kw(e,n,t)}return t}function T_(e,t,n,r,i,o,d,h,m){return e=th(n,r,!0,e,i,o,d,h,m),e.context=k_(null),n=e.current,r=It(),i=Hr(n),o=ur(r,i),o.callback=t??null,Vr(n,o,i),e.current.lanes=i,Na(e,i,r),Ft(e,r),e}function Xl(e,t,n,r){var i=t.current,o=It(),d=Hr(i);return n=k_(n),t.context===null?t.context=n:t.pendingContext=n,t=ur(o,d),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Vr(i,t,d),e!==null&&(Rn(e,i,d,o),el(e,i,d)),d}function Ul(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function wv(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function nh(e,t){wv(e,t),(e=e.alternate)&&wv(e,t)}function Lb(){return null}var R_=typeof reportError=="function"?reportError:function(e){console.error(e)};function rh(e){this._internalRoot=e}Zl.prototype.render=rh.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Q(409));Xl(e,t,null,null)};Zl.prototype.unmount=rh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Us(function(){Xl(null,e,null,null)}),t[hr]=null}};function Zl(e){this._internalRoot=e}Zl.prototype.unstable_scheduleHydration=function(e){if(e){var t=iw();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lr.length&&t!==0&&t<Lr[n].priority;n++);Lr.splice(n,0,e),n===0&&aw(e)}};function sh(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ed(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function _v(){}function Mb(e,t,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var g=Ul(d);o.call(g)}}var d=T_(t,r,e,0,null,!1,!1,"",_v);return e._reactRootContainer=d,e[hr]=d.current,wa(e.nodeType===8?e.parentNode:e),Us(),d}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var h=r;r=function(){var g=Ul(m);h.call(g)}}var m=th(e,0,!1,null,null,!1,!1,"",_v);return e._reactRootContainer=m,e[hr]=m.current,wa(e.nodeType===8?e.parentNode:e),Us(function(){Xl(t,m,n,r)}),m}function td(e,t,n,r,i){var o=n._reactRootContainer;if(o){var d=o;if(typeof i=="function"){var h=i;i=function(){var m=Ul(d);h.call(m)}}Xl(t,d,e,i)}else d=Mb(n,t,e,i,r);return Ul(d)}rw=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=qo(t.pendingLanes);n!==0&&(xf(t,n|1),Ft(t,Be()),!(me&6)&&(so=Be()+500,Xr()))}break;case 13:Us(function(){var r=mr(e,1);if(r!==null){var i=It();Rn(r,e,1,i)}}),nh(e,1)}};bf=function(e){if(e.tag===13){var t=mr(e,134217728);if(t!==null){var n=It();Rn(t,e,134217728,n)}nh(e,134217728)}};sw=function(e){if(e.tag===13){var t=Hr(e),n=mr(e,t);if(n!==null){var r=It();Rn(n,e,t,r)}nh(e,t)}};iw=function(){return we};ow=function(e,t){var n=we;try{return we=e,t()}finally{we=n}};bp=function(e,t,n){switch(t){case"input":if(vp(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Hl(r);if(!i)throw Error(Q(90));Ay(r),vp(r,i)}}}break;case"textarea":Uy(e,n);break;case"select":t=n.value,t!=null&&zi(e,!!n.multiple,t,!1)}};Wy=qf;Qy=Us;var Ob={usingClientEntryPoint:!1,Events:[Pa,Di,Hl,Gy,Hy,qf]},Fo={findFiberByHostInstance:Ss,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ab={bundleType:Fo.bundleType,version:Fo.version,rendererPackageName:Fo.rendererPackageName,rendererConfig:Fo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Jy(e),e===null?null:e.stateNode},findFiberByHostInstance:Fo.findFiberByHostInstance||Lb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gc.isDisabled&&Gc.supportsFiber)try{zl=Gc.inject(Ab),Wn=Gc}catch{}}Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ob;Zt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sh(t))throw Error(Q(200));return Db(e,t,null,n)};Zt.createRoot=function(e,t){if(!sh(e))throw Error(Q(299));var n=!1,r="",i=R_;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=th(e,1,!1,null,null,n,!1,r,i),e[hr]=t.current,wa(e.nodeType===8?e.parentNode:e),new rh(t)};Zt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Q(188)):(e=Object.keys(e).join(","),Error(Q(268,e)));return e=Jy(t),e=e===null?null:e.stateNode,e};Zt.flushSync=function(e){return Us(e)};Zt.hydrate=function(e,t,n){if(!ed(t))throw Error(Q(200));return td(null,e,t,!0,n)};Zt.hydrateRoot=function(e,t,n){if(!sh(e))throw Error(Q(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",d=R_;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),t=T_(t,null,e,1,n??null,i,!1,o,d),e[hr]=t.current,wa(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Zl(t)};Zt.render=function(e,t,n){if(!ed(t))throw Error(Q(200));return td(null,e,t,!1,n)};Zt.unmountComponentAtNode=function(e){if(!ed(e))throw Error(Q(40));return e._reactRootContainer?(Us(function(){td(null,null,e,!1,function(){e._reactRootContainer=null,e[hr]=null})}),!0):!1};Zt.unstable_batchedUpdates=qf;Zt.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ed(n))throw Error(Q(200));if(e==null||e._reactInternals===void 0)throw Error(Q(38));return td(e,t,n,!1,r)};Zt.version="18.3.1-next-f1338f8080-20240426";function I_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(I_)}catch(e){console.error(e)}}I_(),Iy.exports=Zt;var $b=Iy.exports,N_,Sv=$b;N_=Sv.createRoot,Sv.hydrateRoot;var Xu={},rf={exports:{}},Zu,Cv;function Ub(){if(Cv)return Zu;Cv=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,o=r*365.25;Zu=function(f,S){S=S||{};var T=typeof f;if(T==="string"&&f.length>0)return d(f);if(T==="number"&&isFinite(f))return S.long?m(f):h(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function d(f){if(f=String(f),!(f.length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(S){var T=parseFloat(S[1]),A=(S[2]||"ms").toLowerCase();switch(A){case"years":case"year":case"yrs":case"yr":case"y":return T*o;case"weeks":case"week":case"w":return T*i;case"days":case"day":case"d":return T*r;case"hours":case"hour":case"hrs":case"hr":case"h":return T*n;case"minutes":case"minute":case"mins":case"min":case"m":return T*t;case"seconds":case"second":case"secs":case"sec":case"s":return T*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return T;default:return}}}}function h(f){var S=Math.abs(f);return S>=r?Math.round(f/r)+"d":S>=n?Math.round(f/n)+"h":S>=t?Math.round(f/t)+"m":S>=e?Math.round(f/e)+"s":f+"ms"}function m(f){var S=Math.abs(f);return S>=r?g(f,S,r,"day"):S>=n?g(f,S,n,"hour"):S>=t?g(f,S,t,"minute"):S>=e?g(f,S,e,"second"):f+" ms"}function g(f,S,T,A){var G=S>=T*1.5;return Math.round(f/T)+" "+A+(G?"s":"")}return Zu}function Fb(e){n.debug=n,n.default=n,n.coerce=m,n.disable=d,n.enable=i,n.enabled=h,n.humanize=Ub(),n.destroy=g,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let S=0;for(let T=0;T<f.length;T++)S=(S<<5)-S+f.charCodeAt(T),S|=0;return n.colors[Math.abs(S)%n.colors.length]}n.selectColor=t;function n(f){let S,T=null,A,G;function B(...y){if(!B.enabled)return;const l=B,p=Number(new Date),v=p-(S||p);l.diff=v,l.prev=S,l.curr=p,S=p,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let x=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(_,E)=>{if(_==="%%")return"%";x++;const R=n.formatters[E];if(typeof R=="function"){const M=y[x];_=R.call(l,M),y.splice(x,1),x--}return _}),n.formatArgs.call(l,y),(l.log||n.log).apply(l,y)}return B.namespace=f,B.useColors=n.useColors(),B.color=n.selectColor(f),B.extend=r,B.destroy=n.destroy,Object.defineProperty(B,"enabled",{enumerable:!0,configurable:!1,get:()=>T!==null?T:(A!==n.namespaces&&(A=n.namespaces,G=n.enabled(f)),G),set:y=>{T=y}}),typeof n.init=="function"&&n.init(B),B}function r(f,S){const T=n(this.namespace+(typeof S>"u"?":":S)+f);return T.log=this.log,T}function i(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];const S=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const T of S)T[0]==="-"?n.skips.push(T.slice(1)):n.names.push(T)}function o(f,S){let T=0,A=0,G=-1,B=0;for(;T<f.length;)if(A<S.length&&(S[A]===f[T]||S[A]==="*"))S[A]==="*"?(G=A,B=T,A++):(T++,A++);else if(G!==-1)A=G+1,B++,T=B;else return!1;for(;A<S.length&&S[A]==="*";)A++;return A===S.length}function d(){const f=[...n.names,...n.skips.map(S=>"-"+S)].join(",");return n.enable(""),f}function h(f){for(const S of n.skips)if(o(f,S))return!1;for(const S of n.names)if(o(f,S))return!0;return!1}function m(f){return f instanceof Error?f.stack||f.message:f}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var zb=Fb;(function(e,t){var n={};t.formatArgs=i,t.save=o,t.load=d,t.useColors=r,t.storage=h(),t.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;g.splice(1,0,f,"color: inherit");let S=0,T=0;g[0].replace(/%[a-zA-Z%]/g,A=>{A!=="%%"&&(S++,A==="%c"&&(T=S))}),g.splice(T,0,f)}t.log=console.debug||console.log||(()=>{});function o(g){try{g?t.storage.setItem("debug",g):t.storage.removeItem("debug")}catch{}}function d(){let g;try{g=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=n.DEBUG),g}function h(){try{return localStorage}catch{}}e.exports=zb(t);const{formatters:m}=e.exports;m.j=function(g){try{return JSON.stringify(g)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}})(rf,rf.exports);var nd=rf.exports,j_={};Object.defineProperty(j_,"__esModule",{value:!0});var gs={},lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.Logger=void 0;const gi=nd,vi="mediasoup-client";let Bb=class{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=(0,gi.default)(`${vi}:${t}`),this._warn=(0,gi.default)(`${vi}:WARN:${t}`),this._error=(0,gi.default)(`${vi}:ERROR:${t}`)):(this._debug=(0,gi.default)(vi),this._warn=(0,gi.default)(`${vi}:WARN`),this._error=(0,gi.default)(`${vi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};lt.Logger=Bb;var xt={},ih={exports:{}},Qi=typeof Reflect=="object"?Reflect:null,xv=Qi&&typeof Qi.apply=="function"?Qi.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},al;Qi&&typeof Qi.ownKeys=="function"?al=Qi.ownKeys:Object.getOwnPropertySymbols?al=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:al=function(t){return Object.getOwnPropertyNames(t)};function Vb(e){console&&console.warn&&console.warn(e)}var P_=Number.isNaN||function(t){return t!==t};function Se(){Se.init.call(this)}ih.exports=Se;ih.exports.once=Qb;Se.EventEmitter=Se;Se.prototype._events=void 0;Se.prototype._eventsCount=0;Se.prototype._maxListeners=void 0;var bv=10;function rd(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Se,"defaultMaxListeners",{enumerable:!0,get:function(){return bv},set:function(e){if(typeof e!="number"||e<0||P_(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");bv=e}});Se.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Se.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||P_(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function D_(e){return e._maxListeners===void 0?Se.defaultMaxListeners:e._maxListeners}Se.prototype.getMaxListeners=function(){return D_(this)};Se.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var d;if(n.length>0&&(d=n[0]),d instanceof Error)throw d;var h=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw h.context=d,h}var m=o[t];if(m===void 0)return!1;if(typeof m=="function")xv(m,this,n);else for(var g=m.length,f=$_(m,g),r=0;r<g;++r)xv(f[r],this,n);return!0};function L_(e,t,n,r){var i,o,d;if(rd(n),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),d=o[t]),d===void 0)d=o[t]=n,++e._eventsCount;else if(typeof d=="function"?d=o[t]=r?[n,d]:[d,n]:r?d.unshift(n):d.push(n),i=D_(e),i>0&&d.length>i&&!d.warned){d.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=d.length,Vb(h)}return e}Se.prototype.addListener=function(t,n){return L_(this,t,n,!1)};Se.prototype.on=Se.prototype.addListener;Se.prototype.prependListener=function(t,n){return L_(this,t,n,!0)};function Gb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function M_(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Gb.bind(r);return i.listener=n,r.wrapFn=i,i}Se.prototype.once=function(t,n){return rd(n),this.on(t,M_(this,t,n)),this};Se.prototype.prependOnceListener=function(t,n){return rd(n),this.prependListener(t,M_(this,t,n)),this};Se.prototype.removeListener=function(t,n){var r,i,o,d,h;if(rd(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(o=-1,d=r.length-1;d>=0;d--)if(r[d]===n||r[d].listener===n){h=r[d].listener,o=d;break}if(o<0)return this;o===0?r.shift():Hb(r,o),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,h||n)}return this};Se.prototype.off=Se.prototype.removeListener;Se.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),d;for(i=0;i<o.length;++i)d=o[i],d!=="removeListener"&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function O_(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Wb(i):$_(i,i.length)}Se.prototype.listeners=function(t){return O_(this,t,!0)};Se.prototype.rawListeners=function(t){return O_(this,t,!1)};Se.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):A_.call(e,t)};Se.prototype.listenerCount=A_;function A_(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Se.prototype.eventNames=function(){return this._eventsCount>0?al(this._events):[]};function $_(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function Hb(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function Wb(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Qb(e,t){return new Promise(function(n,r){function i(d){e.removeListener(t,o),r(d)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}U_(e,t,o,{once:!0}),t!=="error"&&Kb(e,i,{once:!0})})}function Kb(e,t,n){typeof e.on=="function"&&U_(e,"error",t,n)}function U_(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Yb=ih.exports;Object.defineProperty(xt,"__esModule",{value:!0});xt.EnhancedEventEmitter=void 0;const Jb=Yb,qb=lt,Xb=new qb.Logger("EnhancedEventEmitter");class Zb extends Jb.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(t,...n){return super.emit(t,...n)}safeEmit(t,...n){try{return super.emit(t,...n)}catch(r){Xb.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,r);try{super.emit("listenererror",t,r)}catch{}return!!super.listenerCount(t)}}on(t,n){return super.on(t,n),this}off(t,n){return super.off(t,n),this}addListener(t,n){return super.on(t,n),this}prependListener(t,n){return super.prependListener(t,n),this}once(t,n){return super.once(t,n),this}prependOnceListener(t,n){return super.prependOnceListener(t,n),this}removeListener(t,n){return super.off(t,n),this}removeAllListeners(t){return super.removeAllListeners(t),this}listenerCount(t){return super.listenerCount(t)}listeners(t){return super.listeners(t)}rawListeners(t){return super.rawListeners(t)}}xt.EnhancedEventEmitter=Zb;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.InvalidStateError=Ct.UnsupportedError=void 0;class oh extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,oh):this.stack=new Error(t).stack}}Ct.UnsupportedError=oh;class ah extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,ah):this.stack=new Error(t).stack}}Ct.InvalidStateError=ah;var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.clone=eE;Kn.generateRandomNumber=tE;Kn.deepFreeze=F_;function eE(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function tE(){return Math.round(Math.random()*1e7)}function F_(e){const t=Reflect.ownKeys(e);for(const n of t){const r=e[n];(r&&typeof r=="object"||typeof r=="function")&&F_(r)}return Object.freeze(e)}var Ue={},at={},sd={};Object.defineProperty(sd,"__esModule",{value:!0});sd.Logger=void 0;const yi=nd,wi="h264-profile-level-id";let nE=class{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=(0,yi.default)(`${wi}:${t}`),this._warn=(0,yi.default)(`${wi}:WARN:${t}`),this._error=(0,yi.default)(`${wi}:ERROR:${t}`)):(this._debug=(0,yi.default)(wi),this._warn=(0,yi.default)(`${wi}:WARN`),this._error=(0,yi.default)(`${wi}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};sd.Logger=nE;Object.defineProperty(at,"__esModule",{value:!0});at.ProfileLevelId=at.Level=at.Profile=void 0;at.parseProfileLevelId=z_;at.profileLevelIdToString=B_;at.profileToString=oE;at.levelToString=aE;at.parseSdpProfileLevelId=Fs;at.isSameProfile=cE;at.isSameProfileAndLevel=lE;at.generateProfileLevelIdStringForAnswer=dE;at.supportedLevel=uE;const rE=sd,In=new rE.Logger;var Ce;(function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"})(Ce||(at.Profile=Ce={}));var re;(function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"})(re||(at.Level=re={}));class id{constructor(t,n){N(this,"profile");N(this,"level");this.profile=t,this.level=n}}at.ProfileLevelId=id;const sE=new id(Ce.ConstrainedBaseline,re.L3_1);class nr{constructor(t){N(this,"mask");N(this,"masked_value");this.mask=~kv("x",t),this.masked_value=kv("1",t)}isMatch(t){return this.masked_value===(t&this.mask)}}class rr{constructor(t,n,r){N(this,"profile_idc");N(this,"profile_iop");N(this,"profile");this.profile_idc=t,this.profile_iop=n,this.profile=r}}const iE=[new rr(66,new nr("x1xx0000"),Ce.ConstrainedBaseline),new rr(77,new nr("1xxx0000"),Ce.ConstrainedBaseline),new rr(88,new nr("11xx0000"),Ce.ConstrainedBaseline),new rr(66,new nr("x0xx0000"),Ce.Baseline),new rr(88,new nr("10xx0000"),Ce.Baseline),new rr(77,new nr("0x0x0000"),Ce.Main),new rr(100,new nr("00000000"),Ce.High),new rr(100,new nr("00001100"),Ce.ConstrainedHigh),new rr(244,new nr("00000000"),Ce.PredictiveHigh444)],Ev=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:re.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:re.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:re.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:re.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:re.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:re.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:re.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:re.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:re.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:re.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:re.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:re.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:re.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:re.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:re.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:re.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:re.L5_2}];function z_(e){if(typeof e!="string"||e.length!==6)return;const n=parseInt(e,16);if(n===0)return;const r=n&255,i=n>>8&255,o=n>>16&255;let d;switch(r){case re.L1_1:{d=i&16?re.L1_b:re.L1_1;break}case re.L1:case re.L1_2:case re.L1_3:case re.L2:case re.L2_1:case re.L2_2:case re.L3:case re.L3_1:case re.L3_2:case re.L4:case re.L4_1:case re.L4_2:case re.L5:case re.L5_1:case re.L5_2:{d=r;break}default:{In.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`);return}}for(const h of iE)if(o===h.profile_idc&&h.profile_iop.isMatch(i))return In.debug(`parseProfileLevelId() | result [str:${e}, profile:${h.profile}, level:${d}]`),new id(h.profile,d);In.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${o}, profile_iop:${i}]`)}function B_(e){if(e.level==re.L1_b)switch(e.profile){case Ce.ConstrainedBaseline:return"42f00b";case Ce.Baseline:return"42100b";case Ce.Main:return"4d100b";default:{In.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`);return}}let t;switch(e.profile){case Ce.ConstrainedBaseline:{t="42e0";break}case Ce.Baseline:{t="4200";break}case Ce.Main:{t="4d00";break}case Ce.ConstrainedHigh:{t="640c";break}case Ce.High:{t="6400";break}case Ce.PredictiveHigh444:{t="f400";break}default:{In.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`);return}}let n=e.level.toString(16);return n.length===1&&(n=`0${n}`),`${t}${n}`}function oE(e){switch(e){case Ce.ConstrainedBaseline:return"ConstrainedBaseline";case Ce.Baseline:return"Baseline";case Ce.Main:return"Main";case Ce.ConstrainedHigh:return"ConstrainedHigh";case Ce.High:return"High";case Ce.PredictiveHigh444:return"PredictiveHigh444";default:{In.warn(`profileToString() | unrecognized profile ${e}`);return}}}function aE(e){switch(e){case re.L1_b:return"1b";case re.L1:return"1";case re.L1_1:return"1.1";case re.L1_2:return"1.2";case re.L1_3:return"1.3";case re.L2:return"2";case re.L2_1:return"2.1";case re.L2_2:return"2.2";case re.L3:return"3";case re.L3_1:return"3.1";case re.L3_2:return"3.2";case re.L4:return"4";case re.L4_1:return"4.1";case re.L4_2:return"4.2";case re.L5:return"5";case re.L5_1:return"5.1";case re.L5_2:return"5.2";default:{In.warn(`levelToString() | unrecognized level ${e}`);return}}}function Fs(e={}){const t=e["profile-level-id"];return t?z_(t):sE}function cE(e={},t={}){const n=Fs(e),r=Fs(t);return!!(n&&r&&n.profile===r.profile)}function lE(e={},t={}){const n=Fs(e),r=Fs(t);return!!(n&&r&&n.profile===r.profile&&n.level==r.level)}function dE(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){In.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const n=Fs(e),r=Fs(t);if(!n)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const i=Tv(e)&&Tv(t),o=n.level,d=r.level,h=fE(o,d),m=i?o:h;return In.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${n.profile}, level:${m}]`),B_(new id(n.profile,m))}function uE(e,t){for(let r=Ev.length-1;r>=0;--r){const i=Ev[r];if(i.max_macroblock_frame_size*256<=e&&i.max_macroblocks_per_second<=t*i.max_macroblock_frame_size)return In.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${t}, level:${i.level}]`),i.level}In.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${t}]`)}function kv(e,t){return+(t[0]===e)<<7|+(t[1]===e)<<6|+(t[2]===e)<<5|+(t[3]===e)<<4|+(t[4]===e)<<3|+(t[5]===e)<<2|+(t[6]===e)<<1|+(t[7]===e)<<0}function pE(e,t){return e===re.L1_b?t!==re.L1&&t!==re.L1_b:t===re.L1_b?e!==re.L1:e<t}function fE(e,t){return pE(e,t)?e:t}function Tv(e={}){const t=e["level-asymmetry-allowed"];return t===!0||t===1||t==="1"}Object.defineProperty(Ue,"__esModule",{value:!0});Ue.validateAndNormalizeRtpCapabilities=yE;Ue.validateAndNormalizeRtpParameters=ch;Ue.validateAndNormalizeSctpStreamParameters=wE;Ue.validateSctpCapabilities=_E;Ue.getExtendedRtpCapabilities=SE;Ue.getRecvRtpCapabilities=CE;Ue.getSendingRtpParameters=xE;Ue.getSendingRemoteRtpParameters=bE;Ue.reduceCodecs=EE;Ue.generateProbatorRtpParameters=kE;Ue.canSend=TE;Ue.canReceive=RE;const Rv=at,hE=Kn,mE="probator",gE=1234,vE=127;function yE(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)IE(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)NE(t)}function ch(e){if(typeof e!="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)jE(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)PE(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)DE(t);if(e.rtcp&&typeof e.rtcp!="object")throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),LE(e.rtcp)}function wE(e){if(typeof e!="object")throw new TypeError("params is not an object");if(typeof e.streamId!="number")throw new TypeError("missing params.streamId");let t=!1;if(typeof e.ordered=="boolean"?t=!0:e.ordered=!0,e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&typeof e.label!="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!="string")throw new TypeError("invalid params.protocol")}function _E(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!="object")throw new TypeError("missing caps.numStreams");ME(e.numStreams)}function SE(e,t,n){const r={codecs:[],headerExtensions:[]};if(n)for(const i of e.codecs??[]){if(Fi(i))continue;const o=(t.codecs??[]).find(h=>sf(h,i,{strict:!0,modify:!0}));if(!o)continue;const d={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:o.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters??{},remoteParameters:o.parameters??{},rtcpFeedback:Iv(i,o)};r.codecs.push(d)}else for(const i of t.codecs??[]){if(Fi(i))continue;const o=(e.codecs??[]).find(h=>sf(h,i,{strict:!0,modify:!0}));if(!o)continue;const d={kind:o.kind,mimeType:o.mimeType,clockRate:o.clockRate,channels:o.channels,localPayloadType:o.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:o.parameters??{},remoteParameters:i.parameters??{},rtcpFeedback:Iv(o,i)};r.codecs.push(d)}for(const i of r.codecs){const o=e.codecs.find(h=>{var m;return Fi(h)&&((m=h.parameters)==null?void 0:m.apt)===i.localPayloadType}),d=t.codecs.find(h=>{var m;return Fi(h)&&((m=h.parameters)==null?void 0:m.apt)===i.remotePayloadType});o&&d&&(i.localRtxPayloadType=o.preferredPayloadType,i.remoteRtxPayloadType=d.preferredPayloadType)}for(const i of t.headerExtensions){const o=e.headerExtensions.find(h=>OE(h,i));if(!o)continue;const d={kind:i.kind,uri:i.uri,sendId:o.preferredId,recvId:i.preferredId,encrypt:o.preferredEncrypt??!1,direction:"sendrecv"};switch(i.direction){case"sendrecv":{d.direction="sendrecv";break}case"recvonly":{d.direction="sendonly";break}case"sendonly":{d.direction="recvonly";break}case"inactive":{d.direction="inactive";break}}r.headerExtensions.push(d)}return r}function CE(e){const t={codecs:[],headerExtensions:[]};for(const n of e.codecs){const r={kind:n.kind,mimeType:n.mimeType,preferredPayloadType:n.remotePayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),!n.remoteRtxPayloadType)continue;const i={kind:n.kind,mimeType:`${n.kind}/rtx`,preferredPayloadType:n.remoteRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const n of e.headerExtensions){if(n.direction!=="sendrecv"&&n.direction!=="recvonly")continue;const r={kind:n.kind,uri:n.uri,preferredId:n.recvId,preferredEncrypt:n.encrypt??!1,direction:n.direction};t.headerExtensions.push(r)}return t}function xE(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const o={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(o)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}return n}function bE(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const o={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(o)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}if(n.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(n.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return n}function EE(e,t){const n=[];if(!t)n.push(e[0]),Fi(e[1])&&n.push(e[1]);else{for(let r=0;r<e.length;++r)if(sf(e[r],t,{strict:!0})){n.push(e[r]),Fi(e[r+1])&&n.push(e[r+1]);break}if(n.length===0)throw new TypeError("no matching codec found")}return n}function kE(e){e=hE.clone(e),ch(e);const t={mid:mE,codecs:[],headerExtensions:[],encodings:[{ssrc:gE}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=vE,t.headerExtensions=e.headerExtensions,t}function TE(e,t){return(t.codecs??[]).some(n=>n.kind===e)}function RE(e,t){if(ch(e),e.codecs.length===0)return!1;const n=e.codecs[0];return(t.codecs??[]).some(r=>r.preferredPayloadType===n.payloadType)}function IE(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(e.kind=n[1].toLowerCase(),typeof e.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");e.kind==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const r of Object.keys(e.parameters)){let i=e.parameters[r];if(i===void 0&&(e.parameters[r]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${i}]`);if(r==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const r of e.rtcpFeedback)V_(r)}function V_(e){if(typeof e!="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!="string")throw new TypeError("missing fb.type");(!e.parameter||typeof e.parameter!="string")&&(e.parameter="")}function NE(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&typeof e.direction!="string")throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function jE(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(typeof e.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");n[1].toLowerCase()==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const i of Object.keys(e.parameters)){let o=e.parameters[i];if(o===void 0&&(e.parameters[i]="",o=""),typeof o!="string"&&typeof o!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${o}]`);if(i==="apt"&&typeof o!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const i of e.rtcpFeedback)V_(i)}function PE(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.id!="number")throw new TypeError("missing ext.id");if(e.encrypt&&typeof e.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const t of Object.keys(e.parameters)){let n=e.parameters[t];if(n===void 0&&(e.parameters[t]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError("invalid header extension parameter")}}function DE(e){if(typeof e!="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!="object")throw new TypeError("invalid encoding.rtx");if(e.rtx&&typeof e.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||typeof e.dtx!="boolean")&&(e.dtx=!1),e.scalabilityMode&&typeof e.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function LE(e){if(typeof e!="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!="string")throw new TypeError("invalid rtcp.cname");(!e.reducedSize||typeof e.reducedSize!="boolean")&&(e.reducedSize=!0)}function ME(e){if(typeof e!="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!="number")throw new TypeError("missing numStreams.MIS")}function Fi(e){return e?/.+\/rtx$/i.test(e.mimeType):!1}function sf(e,t,{strict:n=!1,modify:r=!1}={}){const i=e.mimeType.toLowerCase(),o=t.mimeType.toLowerCase();if(i!==o||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(i){case"video/h264":{if(n){const d=e.parameters["packetization-mode"]??0,h=t.parameters["packetization-mode"]??0;if(d!==h||!Rv.isSameProfile(e.parameters,t.parameters))return!1;let m;try{m=Rv.generateProfileLevelIdStringForAnswer(e.parameters,t.parameters)}catch{return!1}r&&(m?(e.parameters["profile-level-id"]=m,t.parameters["profile-level-id"]=m):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break}case"video/vp9":{if(n){const d=e.parameters["profile-id"]??0,h=t.parameters["profile-id"]??0;if(d!==h)return!1}break}}return!0}function OE(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function Iv(e,t){const n=[];for(const r of e.rtcpFeedback??[]){const i=(t.rtcpFeedback??[]).find(o=>o.type===r.type&&(o.parameter===r.parameter||!o.parameter&&!r.parameter));i&&n.push(i)}return n}var od={},G_={},ad={},cd={};Object.defineProperty(cd,"__esModule",{value:!0});cd.Logger=void 0;const _i=nd,Si="awaitqueue";class AE{constructor(t){N(this,"_debug");N(this,"_warn");N(this,"_error");t?(this._debug=_i(`${Si}:${t}`),this._warn=_i(`${Si}:WARN:${t}`),this._error=_i(`${Si}:ERROR:${t}`)):(this._debug=_i(Si),this._warn=_i(`${Si}:WARN`),this._error=_i(`${Si}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}cd.Logger=AE;var zs={};Object.defineProperty(zs,"__esModule",{value:!0});zs.AwaitQueueRemovedTaskError=zs.AwaitQueueStoppedError=void 0;class lh extends Error{constructor(t){super(t??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,lh)}}zs.AwaitQueueStoppedError=lh;class dh extends Error{constructor(t){super(t??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,dh)}}zs.AwaitQueueRemovedTaskError=dh;Object.defineProperty(ad,"__esModule",{value:!0});ad.AwaitQueue=void 0;const $E=cd,ep=zs,sr=new $E.Logger("AwaitQueue");class UE{constructor(){N(this,"pendingTasks",new Map);N(this,"nextTaskId",0);sr.debug("constructor()")}get size(){return this.pendingTasks.size}async push(t,n,r){if(n=n??t.name,sr.debug(`push() [name:${n}, options:%o]`,r),typeof t!="function")throw new TypeError("given task is not a function");if(n)try{Object.defineProperty(t,"name",{value:n})}catch{}return new Promise((i,o)=>{if(n&&(r!=null&&r.removeOngoingTasksWithSameName))for(const h of this.pendingTasks.values())h.name===n&&h.reject(new ep.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});const d={id:this.nextTaskId++,task:t,name:n,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:h=>{if(d.completed)return;d.completed=!0,this.pendingTasks.delete(d.id),sr.debug(`resolving task [name:${d.name}]`),i(h);const[m]=this.pendingTasks.values();m&&!m.executedAt&&this.execute(m)},reject:(h,{canExecuteNextTask:m})=>{if(!d.completed&&(d.completed=!0,this.pendingTasks.delete(d.id),sr.debug(`rejecting task [name:${d.name}]: %s`,String(h)),o(h),m)){const[g]=this.pendingTasks.values();g&&!g.executedAt&&this.execute(g)}}};this.pendingTasks.set(d.id,d),this.pendingTasks.size===1&&this.execute(d)})}stop(){sr.debug("stop()");for(const t of this.pendingTasks.values())sr.debug(`stop() | stopping task [name:${t.name}]`),t.reject(new ep.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(t){sr.debug(`remove() [taskIdx:${t}]`);const n=Array.from(this.pendingTasks.values())[t];if(!n){sr.debug(`stop() | no task with given idx [taskIdx:${t}]`);return}n.reject(new ep.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){const t=Date.now();let n=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:n++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:t-r.enqueuedAt,executionTime:r.executedAt?t-r.executedAt:0}))}async execute(t){if(sr.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{const n=await t.task();t.resolve(n)}catch(n){t.reject(n,{canExecuteNextTask:!0})}}}ad.AwaitQueue=UE;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var t=ad;Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return t.AwaitQueue}});var n=zs;Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return n.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return n.AwaitQueueRemovedTaskError}})})(G_);var ld={};Object.defineProperty(ld,"__esModule",{value:!0});ld.Producer=void 0;const FE=lt,Nv=xt,Ci=Ct,Fn=new FE.Logger("Producer");class zE extends Nv.EnhancedEventEmitter{constructor({id:n,localId:r,rtpSender:i,track:o,rtpParameters:d,stopTracks:h,disableTrackOnPause:m,zeroRtpOnPause:g,appData:f}){super();N(this,"_id");N(this,"_localId");N(this,"_closed",!1);N(this,"_rtpSender");N(this,"_track");N(this,"_kind");N(this,"_rtpParameters");N(this,"_paused");N(this,"_maxSpatialLayer");N(this,"_stopTracks");N(this,"_disableTrackOnPause");N(this,"_zeroRtpOnPause");N(this,"_appData");N(this,"_observer",new Nv.EnhancedEventEmitter);Fn.debug("constructor()"),this._id=n,this._localId=r,this._rtpSender=i,this._track=o,this._kind=o.kind,this._rtpParameters=d,this._paused=m?!o.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=h,this._disableTrackOnPause=m,this._zeroRtpOnPause=g,this._appData=f??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Fn.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Fn.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Ci.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(Fn.debug("pause()"),this._closed){Fn.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@pause",n,r)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(Fn.debug("resume()"),this._closed){Fn.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@resume",n,r)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:n}){if(Fn.debug("replaceTrack() [track:%o]",n),this._closed){if(n&&this._stopTracks)try{n.stop()}catch{}throw new Ci.InvalidStateError("closed")}else if((n==null?void 0:n.readyState)==="ended")throw new Ci.InvalidStateError("track ended");if(n===this._track){Fn.debug("replaceTrack() | same track, ignored");return}await new Promise((r,i)=>{this.safeEmit("@replacetrack",n,r,i)}),this.destroyTrack(),this._track=n,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(n){if(this._closed)throw new Ci.InvalidStateError("closed");if(this._kind!=="video")throw new Ci.UnsupportedError("not a video Producer");if(typeof n!="number")throw new TypeError("invalid spatialLayer");n!==this._maxSpatialLayer&&(await new Promise((r,i)=>{this.safeEmit("@setmaxspatiallayer",n,r,i)}).catch(()=>{}),this._maxSpatialLayer=n)}async setRtpEncodingParameters(n){if(this._closed)throw new Ci.InvalidStateError("closed");if(typeof n!="object")throw new TypeError("invalid params");await new Promise((r,i)=>{this.safeEmit("@setrtpencodingparameters",n,r,i)})}onTrackEnded(){Fn.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}ld.Producer=zE;var dd={};Object.defineProperty(dd,"__esModule",{value:!0});dd.Consumer=void 0;const BE=lt,jv=xt,VE=Ct,zn=new BE.Logger("Consumer");class GE extends jv.EnhancedEventEmitter{constructor({id:n,localId:r,producerId:i,rtpReceiver:o,track:d,rtpParameters:h,appData:m}){super();N(this,"_id");N(this,"_localId");N(this,"_producerId");N(this,"_closed",!1);N(this,"_rtpReceiver");N(this,"_track");N(this,"_rtpParameters");N(this,"_paused");N(this,"_appData");N(this,"_observer",new jv.EnhancedEventEmitter);zn.debug("constructor()"),this._id=n,this._localId=r,this._producerId=i,this._rtpReceiver=o,this._track=d,this._rtpParameters=h,this._paused=!d.enabled,this._appData=m??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(zn.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(zn.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new VE.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(zn.debug("pause()"),this._closed){zn.error("pause() | Consumer closed");return}if(this._paused){zn.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(zn.debug("resume()"),this._closed){zn.error("resume() | Consumer closed");return}if(!this._paused){zn.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){zn.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}dd.Consumer=GE;var ud={};Object.defineProperty(ud,"__esModule",{value:!0});ud.DataProducer=void 0;const HE=lt,Pv=xt,WE=Ct,ir=new HE.Logger("DataProducer");class QE extends Pv.EnhancedEventEmitter{constructor({id:n,dataChannel:r,sctpStreamParameters:i,appData:o}){super();N(this,"_id");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new Pv.EnhancedEventEmitter);ir.debug("constructor()"),this._id=n,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=o??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._dataChannel.bufferedAmountLowThreshold=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(ir.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(ir.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(n){if(ir.debug("send()"),this._closed)throw new WE.InvalidStateError("closed");this._dataChannel.send(n)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(ir.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,o;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?ir.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(o=n.error)==null?void 0:o.sctpCauseCode,n.error.message):ir.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(ir.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||ir.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}ud.DataProducer=QE;var pd={};Object.defineProperty(pd,"__esModule",{value:!0});pd.DataConsumer=void 0;const KE=lt,Dv=xt,vs=new KE.Logger("DataConsumer");class YE extends Dv.EnhancedEventEmitter{constructor({id:n,dataProducerId:r,dataChannel:i,sctpStreamParameters:o,appData:d}){super();N(this,"_id");N(this,"_dataProducerId");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new Dv.EnhancedEventEmitter);vs.debug("constructor()"),this._id=n,this._dataProducerId=r,this._dataChannel=i,this._sctpStreamParameters=o,this._appData=d??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(n){this._dataChannel.binaryType=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(vs.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(vs.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(vs.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,o;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?vs.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(o=n.error)==null?void 0:o.sctpCauseCode,n.error.message):vs.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(vs.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",n=>{this._closed||this.safeEmit("message",n.data)})}}pd.DataConsumer=YE;Object.defineProperty(od,"__esModule",{value:!0});od.Transport=void 0;const JE=G_,qE=lt,Lv=xt,Ke=Ct,tp=Kn,zo=Ue,XE=ld,ZE=dd,ek=ud,tk=pd,ze=new qE.Logger("Transport");class nk{constructor(t){N(this,"consumerOptions");N(this,"promise");N(this,"resolve");N(this,"reject");this.consumerOptions=t,this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}class rk extends Lv.EnhancedEventEmitter{constructor({direction:n,id:r,iceParameters:i,iceCandidates:o,dtlsParameters:d,sctpParameters:h,iceServers:m,iceTransportPolicy:g,additionalSettings:f,appData:S,handlerFactory:T,getSendExtendedRtpCapabilities:A,recvRtpCapabilities:G,canProduceByKind:B}){super();N(this,"_id");N(this,"_closed",!1);N(this,"_direction");N(this,"_getSendExtendedRtpCapabilities");N(this,"_recvRtpCapabilities");N(this,"_canProduceByKind");N(this,"_maxSctpMessageSize");N(this,"_handler");N(this,"_iceGatheringState","new");N(this,"_connectionState","new");N(this,"_appData");N(this,"_producers",new Map);N(this,"_consumers",new Map);N(this,"_dataProducers",new Map);N(this,"_dataConsumers",new Map);N(this,"_probatorConsumerCreated",!1);N(this,"_awaitQueue",new JE.AwaitQueue);N(this,"_pendingConsumerTasks",[]);N(this,"_consumerCreationInProgress",!1);N(this,"_pendingPauseConsumers",new Map);N(this,"_consumerPauseInProgress",!1);N(this,"_pendingResumeConsumers",new Map);N(this,"_consumerResumeInProgress",!1);N(this,"_pendingCloseConsumers",new Map);N(this,"_consumerCloseInProgress",!1);N(this,"_observer",new Lv.EnhancedEventEmitter);ze.debug("constructor() [id:%s, direction:%s]",r,n),this._id=r,this._direction=n,this._getSendExtendedRtpCapabilities=A,this._recvRtpCapabilities=G,this._canProduceByKind=B,this._maxSctpMessageSize=h?h.maxMessageSize:null;const y=tp.clone(f)??{};delete y.iceServers,delete y.iceTransportPolicy,delete y.bundlePolicy,delete y.rtcpMuxPolicy,this._handler=T.factory({direction:n,iceParameters:i,iceCandidates:o,dtlsParameters:d,sctpParameters:h,iceServers:m,iceTransportPolicy:g,additionalSettings:y,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=S??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){if(!this._closed){ze.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const n of this._producers.values())n.transportClosed();this._producers.clear();for(const n of this._consumers.values())n.transportClosed();this._consumers.clear();for(const n of this._dataProducers.values())n.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new Ke.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:n}){if(ze.debug("restartIce()"),this._closed)throw new Ke.InvalidStateError("closed");if(!n)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(n),"transport.restartIce()")}async updateIceServers({iceServers:n}={}){if(ze.debug("updateIceServers()"),this._closed)throw new Ke.InvalidStateError("closed");if(!Array.isArray(n))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(n),"transport.updateIceServers()")}async produce({track:n,streamId:r,encodings:i,codecOptions:o,headerExtensionOptions:d,codec:h,stopTracks:m=!0,disableTrackOnPause:g=!0,zeroRtpOnPause:f=!1,onRtpSender:S,appData:T={}}={}){if(ze.debug("produce() [track:%o]",n),this._closed)throw new Ke.InvalidStateError("closed");if(n){if(this._direction!=="send")throw new Ke.UnsupportedError("not a sending Transport");if(this._canProduceByKind[n.kind]){if(n.readyState==="ended")throw new Ke.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(T&&typeof T!="object")throw new TypeError("if given, appData must be an object")}else throw new Ke.UnsupportedError(`cannot produce ${n.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let A;if(i&&!Array.isArray(i))throw TypeError("encodings must be an array");(i==null?void 0:i.length)===0?A=void 0:i&&(A=i.map(l=>{const p={active:!0};return l.active===!1&&(p.active=!1),typeof l.dtx=="boolean"&&(p.dtx=l.dtx),typeof l.scalabilityMode=="string"&&(p.scalabilityMode=l.scalabilityMode),typeof l.scaleResolutionDownBy=="number"&&(p.scaleResolutionDownBy=l.scaleResolutionDownBy),typeof l.maxBitrate=="number"&&(p.maxBitrate=l.maxBitrate),typeof l.maxFramerate=="number"&&(p.maxFramerate=l.maxFramerate),typeof l.adaptivePtime=="boolean"&&(p.adaptivePtime=l.adaptivePtime),typeof l.priority=="string"&&(p.priority=l.priority),typeof l.networkPriority=="string"&&(p.networkPriority=l.networkPriority),p}));const{localId:G,rtpParameters:B,rtpSender:y}=await this._handler.send({track:n,streamId:r,encodings:A,codecOptions:o,headerExtensionOptions:d,codec:h,onRtpSender:S});try{zo.validateAndNormalizeRtpParameters(B);const{id:l}=await new Promise((v,x)=>{this.safeEmit("produce",{kind:n.kind,rtpParameters:B,appData:T},v,x)}),p=new XE.Producer({id:l,localId:G,rtpSender:y,track:n,rtpParameters:B,stopTracks:m,disableTrackOnPause:g,zeroRtpOnPause:f,appData:T});return this._producers.set(p.id,p),this.handleProducer(p),this._observer.safeEmit("newproducer",p),p}catch(l){throw this._handler.stopSending(G).catch(()=>{}),l}},"transport.produce()").catch(A=>{if(m)try{n.stop()}catch{}throw A})}async consume({id:n,producerId:r,kind:i,rtpParameters:o,streamId:d,onRtpReceiver:h,appData:m={}}){if(ze.debug("consume()"),this._closed)throw new Ke.InvalidStateError("closed");if(this._direction!=="recv")throw new Ke.UnsupportedError("not a receiving Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind '${i}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(m&&typeof m!="object")throw new TypeError("if given, appData must be an object");const g=tp.clone(o);if(!zo.canReceive(g,this._recvRtpCapabilities))throw new Ke.UnsupportedError("cannot consume this Producer");const S=new nk({id:n,producerId:r,kind:i,rtpParameters:g,streamId:d,onRtpReceiver:h,appData:m});return this._pendingConsumerTasks.push(S),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),S.promise}async produceData({ordered:n=!0,maxPacketLifeTime:r,maxRetransmits:i,label:o="",protocol:d="",appData:h={}}={}){if(ze.debug("produceData()"),this._closed)throw new Ke.InvalidStateError("closed");if(this._direction!=="send")throw new Ke.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object")}else throw new Ke.UnsupportedError("SCTP not enabled by remote Transport");return(r||i)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:m,sctpStreamParameters:g}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:d});zo.validateAndNormalizeSctpStreamParameters(g);const{id:f}=await new Promise((T,A)=>{this.safeEmit("producedata",{sctpStreamParameters:g,label:o,protocol:d,appData:h},T,A)}),S=new ek.DataProducer({id:f,dataChannel:m,sctpStreamParameters:g,appData:h});return this._dataProducers.set(S.id,S),this.handleDataProducer(S),this._observer.safeEmit("newdataproducer",S),S},"transport.produceData()")}async consumeData({id:n,dataProducerId:r,sctpStreamParameters:i,label:o="",protocol:d="",appData:h={}}){if(ze.debug("consumeData()"),this._closed)throw new Ke.InvalidStateError("closed");if(this._direction!=="recv")throw new Ke.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object")}else throw new Ke.UnsupportedError("SCTP not enabled by remote Transport");const m=tp.clone(i);return zo.validateAndNormalizeSctpStreamParameters(m),this._awaitQueue.push(async()=>{const{dataChannel:g}=await this._handler.receiveDataChannel({sctpStreamParameters:m,label:o,protocol:d}),f=new tk.DataConsumer({id:n,dataProducerId:r,dataChannel:g,sctpStreamParameters:m,appData:h});return this._dataConsumers.set(f.id,f),this.handleDataConsumer(f),this._observer.safeEmit("newdataconsumer",f),f},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){ze.debug("createPendingConsumers() | there is no Consumer to be created");return}const n=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r;const i=[];for(const o of n){const{id:d,kind:h,rtpParameters:m,streamId:g,onRtpReceiver:f}=o.consumerOptions;i.push({trackId:d,kind:h,rtpParameters:m,streamId:g,onRtpReceiver:f})}try{const o=await this._handler.receive(i);for(let d=0;d<o.length;++d){const h=n[d],m=o[d],{id:g,producerId:f,kind:S,rtpParameters:T,appData:A}=h.consumerOptions,{localId:G,rtpReceiver:B,track:y}=m,l=new ZE.Consumer({id:g,localId:G,producerId:f,rtpReceiver:B,track:y,rtpParameters:T,appData:A});this._consumers.set(l.id,l),this.handleConsumer(l),!this._probatorConsumerCreated&&!r&&S==="video"&&(r=l),this._observer.safeEmit("newconsumer",l),h.resolve(l)}}catch(o){for(const d of n)d.reject(o)}if(r)try{const o=zo.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:o}]),ze.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(o){ze.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",o)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){ze.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const n=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.pauseReceiving(r)}catch(r){ze.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){ze.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const n=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.resumeReceiving(r)}catch(r){ze.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){ze.debug("closePendingConsumers() | there is no Consumer to be closed");return}const n=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(n.map(r=>r.localId))}catch(r){ze.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const n=this._handler;n.on("@connect",({dtlsParameters:r},i,o)=>{if(this._closed){o(new Ke.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:r},i,o)}),n.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(ze.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),n.on("@icecandidateerror",r=>{ze.warn(`ICE candidate error [url:${r.url}, localAddress:${r.address}, localPort:${r.port}]: ${r.errorCode} "${r.errorText}"`),this.safeEmit("icecandidateerror",r)}),n.on("@connectionstatechange",r=>{r!==this._connectionState&&(ze.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(n.localId),"producer @close event").catch(r=>ze.warn("producer.close() failed:%o",r))}),n.on("@pause",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(n.localId),"producer @pause event").then(r).catch(i)}),n.on("@resume",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(n.localId),"producer @resume event").then(r).catch(i)}),n.on("@replacetrack",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(n.localId,r),"producer @replacetrack event").then(i).catch(o)}),n.on("@setmaxspatiallayer",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(n.localId,r),"producer @setmaxspatiallayer event").then(i).catch(o)}),n.on("@setrtpencodingparameters",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(n.localId,r),"producer @setrtpencodingparameters event").then(i).catch(o)}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new Ke.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(r).catch(i)})}handleConsumer(n){n.on("@close",()=>{this._consumers.delete(n.id),this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.delete(n.id),!this._closed&&(this._pendingCloseConsumers.set(n.id,n),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),n.on("@pause",()=>{this._pendingResumeConsumers.has(n.id)&&this._pendingResumeConsumers.delete(n.id),this._pendingPauseConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),n.on("@resume",()=>{this._pendingPauseConsumers.has(n.id)&&this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new Ke.InvalidStateError("closed"));this._handler.getReceiverStats(n.localId).then(r).catch(i)})}handleDataProducer(n){n.on("@close",()=>{this._dataProducers.delete(n.id)})}handleDataConsumer(n){n.on("@close",()=>{this._dataConsumers.delete(n.id)})}}od.Transport=rk;var Bo={},dt={},H_={},W_={exports:{}},Mv=W_.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Mv).forEach(function(e){var t=Mv[e];t.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var uh=W_.exports;(function(e){var t=function(h){return String(Number(h))===h?Number(h):h},n=function(h,m,g,f){if(f&&!g)m[f]=t(h[1]);else for(var S=0;S<g.length;S+=1)h[S+1]!=null&&(m[g[S]]=t(h[S+1]))},r=function(h,m,g){var f=h.name&&h.names;h.push&&!m[h.push]?m[h.push]=[]:f&&!m[h.name]&&(m[h.name]={});var S=h.push?{}:f?m[h.name]:m;n(g.match(h.reg),S,h.names,h.name),h.push&&m[h.push].push(S)},i=uh,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(h){var m={},g=[],f=m;return h.split(/(\r\n|\r|\n)/).filter(o).forEach(function(S){var T=S[0],A=S.slice(2);T==="m"&&(g.push({rtp:[],fmtp:[]}),f=g[g.length-1]);for(var G=0;G<(i[T]||[]).length;G+=1){var B=i[T][G];if(B.reg.test(A))return r(B,f,A)}}),m.media=g,m};var d=function(h,m){var g=m.split(/=(.+)/,2);return g.length===2?h[g[0]]=t(g[1]):g.length===1&&m.length>1&&(h[g[0]]=void 0),h};e.parseParams=function(h){return h.split(/;\s?/).reduce(d,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(h){return h.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(h){for(var m=[],g=h.split(" ").map(t),f=0;f<g.length;f+=3)m.push({component:g[f],ip:g[f+1],port:g[f+2]});return m},e.parseImageAttributes=function(h){return h.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(d,{})})},e.parseSimulcastStreamList=function(h){return h.split(";").map(function(m){return m.split(",").map(function(g){var f,S=!1;return g[0]!=="~"?f=t(g):(f=t(g.substring(1,g.length)),S=!0),{scid:f,paused:S}})})}})(H_);var np=uh,sk=/%[sdv%]/g,ik=function(e){var t=1,n=arguments,r=n.length;return e.replace(sk,function(i){if(t>=r)return i;var o=n[t];switch(t+=1,i){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},Vo=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var o=0;o<t.names.length;o+=1){var d=t.names[o];t.name?i.push(n[t.name][d]):i.push(n[t.names[o]])}else i.push(n[t.name]);return ik.apply(null,i)},ok=["v","o","s","i","u","e","p","c","b","t","r","z","a"],ak=["i","c","b","a"],ck=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(o){o.payloads==null&&(o.payloads="")});var n=t.outerOrder||ok,r=t.innerOrder||ak,i=[];return n.forEach(function(o){np[o].forEach(function(d){d.name in e&&e[d.name]!=null?i.push(Vo(o,d,e)):d.push in e&&e[d.push]!=null&&e[d.push].forEach(function(h){i.push(Vo(o,d,h))})})}),e.media.forEach(function(o){i.push(Vo("m",np.m[0],o)),r.forEach(function(d){np[d].forEach(function(h){h.name in o&&o[h.name]!=null?i.push(Vo(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(m){i.push(Vo(d,h,m))})})})}),i.join(`\r
`)+`\r
`},Gs=H_,lk=ck,dk=uh;dt.grammar=dk;dt.write=lk;dt.parse=Gs.parse;dt.parseParams=Gs.parseParams;dt.parseFmtpConfig=Gs.parseFmtpConfig;dt.parsePayloads=Gs.parsePayloads;dt.parseRemoteCandidates=Gs.parseRemoteCandidates;dt.parseImageAttributes=Gs.parseImageAttributes;dt.parseSimulcastStreamList=Gs.parseSimulcastStreamList;var Zr={};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.parse=pk;const uk=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function pk(e){const t=uk.exec(e??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}var Go={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.OfferMediaSection=Qr.AnswerMediaSection=Qr.MediaSection=void 0;const fk=dt,Ov=Kn;class ph{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r}){N(this,"_mediaObject");if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},t&&this.setIceParameters(t),n){this._mediaObject.candidates=[];for(const i of n){const o={foundation:i.foundation,component:1,ip:i.address??i.ip,port:i.port,priority:i.priority,transport:i.protocol,type:i.type};i.tcpType&&(o.tcptype=i.tcpType),this._mediaObject.candidates.push(o)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(t){this._mediaObject.iceUfrag=t.usernameFragment,this._mediaObject.icePwd=t.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause()}close(){this.disable(),this._mediaObject.port=0,delete this._mediaObject.candidates,delete this._mediaObject.endOfCandidates,delete this._mediaObject.iceUfrag,delete this._mediaObject.icePwd,delete this._mediaObject.iceOptions,this._mediaObject.rtp=[],this._mediaObject.fmtp=[],delete this._mediaObject.rtcp,delete this._mediaObject.rtcpFb,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}Qr.MediaSection=ph;class hk extends ph{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:o,offerMediaObject:d,offerRtpParameters:h,answerRtpParameters:m,codecOptions:g}){switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(d.mid),this._mediaObject.type=d.type,this._mediaObject.protocol=d.protocol,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),d.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const f of m.codecs){const S={payload:f.payloadType,codec:Q_(f),rate:f.clockRate};f.channels>1&&(S.encoding=f.channels),this._mediaObject.rtp.push(S);const T=Ov.clone(f.parameters)??{};let A=Ov.clone(f.rtcpFeedback)??[];if(g){const{opusStereo:B,opusFec:y,opusDtx:l,opusMaxPlaybackRate:p,opusMaxAverageBitrate:v,opusPtime:x,opusNack:j,videoGoogleStartBitrate:_,videoGoogleMaxBitrate:E,videoGoogleMinBitrate:R}=g,M=h.codecs.find(P=>P.payloadType===f.payloadType);switch(f.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{B!==void 0&&(M.parameters["sprop-stereo"]=B?1:0,T.stereo=B?1:0),y!==void 0&&(M.parameters.useinbandfec=y?1:0,T.useinbandfec=y?1:0),l!==void 0&&(M.parameters.usedtx=l?1:0,T.usedtx=l?1:0),p!==void 0&&(T.maxplaybackrate=p),v!==void 0&&(T.maxaveragebitrate=v),x!==void 0&&(M.parameters.ptime=x,T.ptime=x),j||(M.rtcpFeedback=M.rtcpFeedback.filter(P=>P.type!=="nack"||P.parameter),A=A.filter(P=>P.type!=="nack"||P.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{_!==void 0&&(T["x-google-start-bitrate"]=_),E!==void 0&&(T["x-google-max-bitrate"]=E),R!==void 0&&(T["x-google-min-bitrate"]=R);break}}}const G={payload:f.payloadType,config:""};for(const B of Object.keys(T))G.config&&(G.config+=";"),G.config+=`${B}=${T[B]}`;G.config&&this._mediaObject.fmtp.push(G);for(const B of A)this._mediaObject.rtcpFb.push({payload:f.payloadType,type:B.type,subtype:B.parameter})}this._mediaObject.payloads=m.codecs.map(f=>f.payloadType).join(" "),this._mediaObject.ext=[];for(const f of m.headerExtensions)(d.ext??[]).some(T=>T.uri===f.uri)&&this._mediaObject.ext.push({uri:f.uri,value:f.id});if(d.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),d.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:d.simulcast.list1},this._mediaObject.rids=[];for(const f of d.rids??[])f.direction==="send"&&this._mediaObject.rids.push({id:f.id,direction:"recv"})}else if(d.simulcast_03){this._mediaObject.simulcast_03={value:d.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const f of d.rids??[])f.direction==="send"&&this._mediaObject.rids.push({id:f.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof d.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):d.sctpmap&&(this._mediaObject.payloads=String(i.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(t){switch(t){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(t){var o,d;if(!((o=this._mediaObject.simulcast)!=null&&o.list1))return;const n={};for(const h of t)h.rid&&(n[h.rid]=h);const r=this._mediaObject.simulcast.list1,i=fk.parseSimulcastStreamList(r);for(const h of i)for(const m of h)m.paused=!((d=n[m.scid])!=null&&d.active);this._mediaObject.simulcast.list1=i.map(h=>h.map(m=>`${m.paused?"~":""}${m.scid}`).join(",")).join(";")}}Qr.AnswerMediaSection=hk;class mk extends ph{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:o,mid:d,kind:h,offerRtpParameters:m,streamId:g,trackId:f}){var S;switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(d),this._mediaObject.type=h,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",h){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:g,appdata:f}];for(const B of m.codecs){const y={payload:B.payloadType,codec:Q_(B),rate:B.clockRate};B.channels>1&&(y.encoding=B.channels),this._mediaObject.rtp.push(y);const l={payload:B.payloadType,config:""};for(const p of Object.keys(B.parameters??{}))l.config&&(l.config+=";"),l.config+=`${p}=${B.parameters[p]}`;l.config&&this._mediaObject.fmtp.push(l);for(const p of B.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:B.payloadType,type:p.type,subtype:p.parameter})}this._mediaObject.payloads=m.codecs.map(B=>B.payloadType).join(" "),this._mediaObject.ext=[];for(const B of m.headerExtensions)this._mediaObject.ext.push({uri:B.uri,value:B.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const T=m.encodings[0],A=T.ssrc,G=(S=T.rtx)==null?void 0:S.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],A&&m.rtcp.cname&&this._mediaObject.ssrcs.push({id:A,attribute:"cname",value:m.rtcp.cname}),G&&(m.rtcp.cname&&this._mediaObject.ssrcs.push({id:G,attribute:"cname",value:m.rtcp.cname}),A&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${A} ${G}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize;break}}}setDtlsRole(t){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}Qr.OfferMediaSection=mk;function Q_(e){const n=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");return n[2]}var Av;function La(){if(Av)return Go;Av=1,Object.defineProperty(Go,"__esModule",{value:!0}),Go.RemoteSdp=void 0;const e=dt,t=lt,n=Qr,r=X_(),i=["av1","h264"],o=new t.Logger("RemoteSdp");let d=class{constructor({iceParameters:m,iceCandidates:g,dtlsParameters:f,sctpParameters:S,plainRtpParameters:T}){N(this,"_iceParameters");N(this,"_iceCandidates");N(this,"_dtlsParameters");N(this,"_sctpParameters");N(this,"_plainRtpParameters");N(this,"_mediaSections",[]);N(this,"_midToIndex",new Map);N(this,"_firstMid");N(this,"_sdpObject");if(this._iceParameters=m,this._iceCandidates=g,this._dtlsParameters=f,this._sctpParameters=S,this._plainRtpParameters=T,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:`mediasoup-client-v${r.version}`},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",m!=null&&m.iceLite&&(this._sdpObject.icelite="ice-lite"),f){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const A=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:f.fingerprints[A-1].algorithm,hash:f.fingerprints[A-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}T&&(this._sdpObject.origin.address=T.ip,this._sdpObject.origin.ipVer=T.ipVersion)}updateIceParameters(m){o.debug("updateIceParameters() [iceParameters:%o]",m),this._iceParameters=m,this._sdpObject.icelite=m.iceLite?"ice-lite":void 0;for(const g of this._mediaSections)g.setIceParameters(m)}updateDtlsRole(m){o.debug("updateDtlsRole() [role:%s]",m),this._dtlsParameters.role=m;for(const g of this._mediaSections)g.setDtlsRole(m)}setSessionExtmapAllowMixed(){o.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let m=0;m<this._mediaSections.length;++m){const g=this._mediaSections[m];if(g.closed)return{idx:m,reuseMid:g.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:m,reuseMid:g,offerRtpParameters:f,answerRtpParameters:S,codecOptions:T}){var y;const A=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:m,offerRtpParameters:f,answerRtpParameters:S,codecOptions:T}),G=A.getObject();G.rtp.find(l=>i.includes(l.codec.toLowerCase()))||(G.ext=(y=G.ext)==null?void 0:y.filter(l=>l.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),g?this.replaceMediaSection(A,g):this._midToIndex.has(A.mid)?this.replaceMediaSection(A):this.addMediaSection(A)}receive({mid:m,kind:g,offerRtpParameters:f,streamId:S,trackId:T}){this.setSessionExtmapAllowMixed();const A=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:m,kind:g,offerRtpParameters:f,streamId:S,trackId:T}),G=this._mediaSections.find(B=>B.closed);G?this.replaceMediaSection(A,G.mid):this.addMediaSection(A)}pauseMediaSection(m){this.findMediaSection(m).pause()}resumeSendingMediaSection(m){this.findMediaSection(m).resume()}resumeReceivingMediaSection(m){this.findMediaSection(m).resume()}disableMediaSection(m){this.findMediaSection(m).disable()}closeMediaSection(m){const g=this.findMediaSection(m);return m===this._firstMid?(o.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",m),this.disableMediaSection(m),!1):(g.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(m,g){const f=this.findMediaSection(m);f.muxSimulcastStreams(g),this.replaceMediaSection(f)}sendSctpAssociation({offerMediaObject:m}){const g=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:m});this.addMediaSection(g)}receiveSctpAssociation(){const m=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(m)}getSdp(){return this._sdpObject.origin.sessionVersion++,e.write(this._sdpObject)}addMediaSection(m){this._firstMid||(this._firstMid=m.mid),this._mediaSections.push(m),this._midToIndex.set(m.mid,this._mediaSections.length-1),this._sdpObject.media.push(m.getObject()),this.regenerateBundleMids()}replaceMediaSection(m,g){if(typeof g=="string"){const f=this._midToIndex.get(g);if(f===void 0)throw new Error(`no media section found for reuseMid '${g}'`);const S=this._mediaSections[f];this._mediaSections[f]=m,this._midToIndex.delete(S.mid),this._midToIndex.set(m.mid,f),this._sdpObject.media[f]=m.getObject(),this.regenerateBundleMids()}else{const f=this._midToIndex.get(m.mid);if(f===void 0)throw new Error(`no media section found with mid '${m.mid}'`);this._mediaSections[f]=m,this._sdpObject.media[f]=m.getObject()}}findMediaSection(m){const g=this._midToIndex.get(m);if(g===void 0)throw new Error(`no media section found with mid '${m}'`);return this._mediaSections[g]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(m=>!m.closed).map(m=>m.mid).join(" "))}};return Go.RemoteSdp=d,Go}var jn={};Object.defineProperty(jn,"__esModule",{value:!0});jn.extractRtpCapabilities=gk;jn.extractDtlsParameters=vk;jn.getCname=yk;jn.applyCodecParameters=wk;jn.addHeaderExtension=_k;const K_=dt;function gk({sdpObject:e}){const t=new Map,n=new Map;for(const i of e.media){const o=i.type;switch(o){case"audio":case"video":break;default:continue}for(const d of i.rtp){const h={kind:o,mimeType:`${o}/${d.codec}`,preferredPayloadType:d.payload,clockRate:d.rate,channels:d.encoding,parameters:{},rtcpFeedback:[]};t.set(h.preferredPayloadType,h)}for(const d of i.fmtp??[]){const h=K_.parseParams(d.config),m=t.get(d.payload);m&&(h!=null&&h.hasOwnProperty("profile-level-id")&&(h["profile-level-id"]=String(h["profile-level-id"])),m.parameters=h)}for(const d of i.rtcpFb??[]){const h={type:d.type,parameter:d.subtype};if(h.parameter||delete h.parameter,d.payload!=="*"){const m=t.get(Number(d.payload));if(!m)continue;m.rtcpFeedback.push(h)}else for(const m of t.values())m.kind===o&&!/.+\/rtx$/i.test(m.mimeType)&&m.rtcpFeedback.push(h)}for(const d of i.ext??[]){if(d["encrypt-uri"])continue;const h={kind:o,uri:d.uri,preferredId:d.value};n.set(h.preferredId,h)}}return{codecs:Array.from(t.values()),headerExtensions:Array.from(n.values())}}function vk({sdpObject:e}){let t=e.setup,n=e.fingerprint;if(!t||!n){const o=(e.media??[]).find(d=>d.port!==0);o&&(t=t??o.setup,n=n??o.fingerprint)}if(t){if(!n)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let r;switch(t){case"active":{r="client";break}case"passive":{r="server";break}case"actpass":{r="auto";break}}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function yk({offerMediaObject:e}){const t=(e.ssrcs??[]).find(n=>n.attribute==="cname");return t?t.value:""}function wk({offerRtpParameters:e,answerMediaObject:t}){var n;for(const r of e.codecs){const i=r.mimeType.toLowerCase();if(i!=="audio/opus"||!(t.rtp??[]).find(m=>m.payload===r.payloadType))continue;t.fmtp=t.fmtp??[];let d=t.fmtp.find(m=>m.payload===r.payloadType);d||(d={payload:r.payloadType,config:""},t.fmtp.push(d));const h=K_.parseParams(d.config);switch(i){case"audio/opus":{const m=(n=r.parameters)==null?void 0:n["sprop-stereo"];m!==void 0&&(h.stereo=Number(m)?1:0);break}}d.config="";for(const m of Object.keys(h))d.config&&(d.config+=";"),d.config+=`${m}=${h[m]}`}}function _k({offerMediaObject:e,headerExtensionUri:t,headerExtensionId:n}){e.ext||(e.ext=[]),e.ext.push({uri:t,value:n})}var es={};Object.defineProperty(es,"__esModule",{value:!0});es.getRtpEncodings=Sk;es.addLegacySimulcast=Ck;function Sk({offerMediaObject:e,codecs:t}){const n=new Set;for(const o of e.ssrcs??[]){const d=o.id;d&&n.add(d)}if(n.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const o of e.ssrcGroups??[]){if(o.semantics!=="FID")continue;const d=o.ssrcs.split(/\s+/),h=Number(d[0]),m=Number(d[1]);n.has(h)&&(n.delete(h),n.delete(m),r.set(h,m))}for(const o of n)r.set(o,void 0);const i=[];for(const[o,d]of r){const h={ssrc:o};d&&t.length>1&&(h.rtx={ssrc:d}),i.push(h)}return i}function Ck({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const n=(e.ssrcs??[]).find(S=>S.attribute==="msid");if(!n)throw new Error("a=ssrc line with msid information not found");const[r,i]=n.value.split(" "),o=Number(n.id);let d;(e.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const T=S.ssrcs.split(/\s+/);return Number(T[0])===o?(d=Number(T[1]),!0):!1});const h=(e.ssrcs??[]).find(S=>S.attribute==="cname");if(!h)throw new Error("a=ssrc line with cname information not found");const m=h.value,g=[],f=[];for(let S=0;S<t;++S)g.push(o+S),d&&f.push(d+S);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:g.join(" ")});for(const S of g)e.ssrcs.push({id:S,attribute:"cname",value:m}),e.ssrcs.push({id:S,attribute:"msid",value:`${r} ${i}`});for(let S=0;S<f.length;++S){const T=g[S],A=f[S];e.ssrcs.push({id:A,attribute:"cname",value:m}),e.ssrcs.push({id:A,attribute:"msid",value:`${r} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${T} ${A}`})}}var yr={};Object.defineProperty(yr,"__esModule",{value:!0});yr.addNackSupportForOpus=xk;yr.addHeaderExtensionSupport=bk;yr.getMsidStreamIdAndTrackId=Ek;function xk(e){var t;for(const n of e.codecs??[])(n.mimeType.toLowerCase()==="audio/opus"||n.mimeType.toLowerCase()==="audio/multiopus")&&!((t=n.rtcpFeedback)!=null&&t.some(r=>r.type==="nack"&&!r.parameter))&&(n.rtcpFeedback||(n.rtcpFeedback=[]),n.rtcpFeedback.push({type:"nack"}))}function bk(e,t){var o;let n;const r=(o=e.headerExtensions)==null?void 0:o.find(d=>d.uri===t.uri);if(r){if(r.kind===t.kind)return;n=r.preferredId}if(e.headerExtensions||(e.headerExtensions=[]),n===void 0){n=1;const d=new Set(e.headerExtensions.map(h=>h.preferredId));for(;d.has(n);)++n}const i={kind:t.kind,uri:t.uri,preferredId:n,preferredEncrypt:!1,direction:t.direction};e.headerExtensions.push(i)}function Ek(e){if(!e||typeof e!="string")return{msidStreamId:void 0,msidTrackId:void 0};const[t,n]=e.trim().split(/\s+/);return t?{msidStreamId:t,msidTrackId:n}:{msidStreamId:void 0,msidTrackId:void 0}}var $v;function kk(){if($v)return Bo;$v=1,Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.Chrome111=void 0;const e=dt,t=xt,n=lt,r=Ue,i=Ct,o=Zr,d=La(),h=jn,m=es,g=yr,f=new n.Logger("Chrome111"),S="Chrome111",T={OS:1024,MIS:1024};let A=class cl extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x,iceServers:j,iceTransportPolicy:_,additionalSettings:E,getSendExtendedRtpCapabilities:R}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});f.debug("constructor()"),this._direction=y,this._remoteSdp=new d.RemoteSdp({iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x}),this._getSendExtendedRtpCapabilities=R,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:j??[],iceTransportPolicy:_??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...E}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:y=>new cl(y),getNativeRtpCapabilities:async()=>{f.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const l=await y.createOffer();try{y.close()}catch{}y=void 0;const p=e.parse(l.sdp);return cl.getLocalRtpCapabilities(p)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(f.debug("getNativeSctpCapabilities()"),{numStreams:T})}}static getLocalRtpCapabilities(y,l=[]){const p=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(p),g.addNackSupportForOpus(p);for(const v of l)g.addHeaderExtensionSupport(p,v);return p}get name(){return S}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),f.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:p,codecOptions:v,headerExtensionOptions:x,codec:j,onRtpSender:_}){if(this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),p&&p.length>1){let $=1;for(const V of p){const J=V.scalabilityMode?(0,o.parse)(V.scalabilityMode).temporalLayers:3;J>$&&($=J)}p.forEach((V,J)=>{V.rid=`r${J}`,V.scalabilityMode=`L1T${$}`})}const E=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:p});_&&_(R.sender);let M=await this._pc.createOffer(),P=e.parse(M.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const z=[];z.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const Y=cl.getLocalRtpCapabilities(P,z),H=this._getSendExtendedRtpCapabilities(Y),X=r.getSendingRtpParameters(y.kind,H);X.codecs=r.reduceCodecs(X.codecs,j);const ne=r.getSendingRemoteRtpParameters(y.kind,H);if(ne.codecs=r.reduceCodecs(ne.codecs,j),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),x!=null&&x.absCaptureTime){const $=P.media[E.idx];h.addHeaderExtension({offerMediaObject:$,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:ne.headerExtensions.find(V=>V.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),M={type:"offer",sdp:e.write(P)}}f.debug("send() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M);const de=R.mid;X.mid=de,P=e.parse(this._pc.localDescription.sdp);const F=P.media[E.idx];if(X.rtcp.cname=h.getCname({offerMediaObject:F}),X.msid=`${l??this._sendStream.id} ${y.id}`,!p)X.encodings=m.getRtpEncodings({offerMediaObject:F,codecs:X.codecs});else if(p.length===1){const $=m.getRtpEncodings({offerMediaObject:F,codecs:X.codecs});Object.assign($[0],p[0]),X.encodings=$}else X.encodings=p;this._remoteSdp.send({offerMediaObject:F,reuseMid:E.reuseMid,offerRtpParameters:X,answerRtpParameters:ne,codecOptions:v});const L={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._mapMidTransceiver.set(de,R),{localId:de,rtpParameters:X,rtpSender:R.sender}}async stopSending(y){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const p=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const p=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?f.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):f.debug("replaceTrack() [localId:%s, no track]",y);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");await p.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{E<=l?_.active=!0:_.active=!1}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{v.encodings[E]={..._,...l}}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:p,label:v,protocol:x}){this.assertNotClosed(),this.assertSendDirection();const j={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:p,protocol:x};f.debug("sendDataChannel() [options:%o]",j);const _=this._pc.createDataChannel(v,j);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),M=e.parse(R.sdp),P=M.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:M}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const z={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",z),await this._pc.setRemoteDescription(z),this._hasDataChannelMediaSection=!0}const E={streamId:j.id,ordered:j.ordered,maxPacketLifeTime:j.maxPacketLifeTime,maxRetransmits:j.maxRetransmits};return{dataChannel:_,sctpStreamParameters:E}}async receive(y){var _;this.assertNotClosed(),this.assertRecvDirection();const l=[],p=new Map;for(const E of y){const{trackId:R,kind:M,rtpParameters:P,streamId:z}=E;f.debug("receive() [trackId:%s, kind:%s]",R,M);const Y=P.mid??String(this._mapMidTransceiver.size);p.set(R,Y);const{msidStreamId:H}=g.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:Y,kind:M,offerRtpParameters:P,streamId:z??H??((_=P.rtcp)==null?void 0:_.cname)??"-",trackId:R})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const E of y){const{trackId:R,onRtpReceiver:M}=E;if(M){const P=p.get(R),z=this._pc.getTransceivers().find(Y=>Y.mid===P);if(!z)throw new Error("transceiver not found");M(z.receiver)}}let x=await this._pc.createAnswer();const j=e.parse(x.sdp);for(const E of y){const{trackId:R,rtpParameters:M}=E,P=p.get(R),z=j.media.find(Y=>String(Y.mid)===P);h.applyCodecParameters({offerRtpParameters:M,answerMediaObject:z})}x={type:"answer",sdp:e.write(j)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",x),await this._pc.setLocalDescription(x);for(const E of y){const{trackId:R}=E,M=p.get(R),P=this._pc.getTransceivers().find(z=>z.mid===M);if(P)this._mapMidTransceiver.set(M,P),l.push({localId:M,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){f.debug("stopReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(x.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("pauseReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("resumeReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:p}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_}=y,E={negotiated:!0,id:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_,protocol:p};f.debug("receiveDataChannel() [options:%o]",E);const R=this._pc.createDataChannel(l,E);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const P=await this._pc.createAnswer();if(!this._transportReady){const z=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:z})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const p=h.extractDtlsParameters({sdpObject:l});p.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,x)=>{this.safeEmit("@connect",{dtlsParameters:p},v,x)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Bo.Chrome111=A,Bo}var Ho={},Uv;function Tk(){if(Uv)return Ho;Uv=1,Object.defineProperty(Ho,"__esModule",{value:!0}),Ho.Chrome74=void 0;const e=dt,t=lt,n=xt,r=Ue,i=Ct,o=Zr,d=La(),h=jn,m=es,g=yr,f=new t.Logger("Chrome74"),S="Chrome74",T={OS:1024,MIS:1024};let A=class ll extends n.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x,iceServers:j,iceTransportPolicy:_,additionalSettings:E,getSendExtendedRtpCapabilities:R}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});f.debug("constructor()"),this._direction=y,this._remoteSdp=new d.RemoteSdp({iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x}),this._getSendExtendedRtpCapabilities=R,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:j??[],iceTransportPolicy:_??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...E}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:y=>new ll(y),getNativeRtpCapabilities:async()=>{f.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const p=e.parse(l.sdp);return ll.getLocalRtpCapabilities(p)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(f.debug("getNativeSctpCapabilities()"),{numStreams:T})}}static getLocalRtpCapabilities(y,l=[]){const p=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(p),g.addNackSupportForOpus(p);for(const v of l)g.addHeaderExtensionSupport(p,v);return p}get name(){return S}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),f.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:p,codecOptions:v,headerExtensionOptions:x,codec:j}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),p&&p.length>1&&p.forEach((V,J)=>{V.rid=`r${J}`});const _=this._remoteSdp.getNextMediaSectionIdx(),E=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:p});let R=await this._pc.createOffer(),M=e.parse(R.sdp);M.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const P=[];P.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const z=ll.getLocalRtpCapabilities(M,P),Y=this._getSendExtendedRtpCapabilities(z),H=r.getSendingRtpParameters(y.kind,Y);H.codecs=r.reduceCodecs(H.codecs,j);const X=r.getSendingRemoteRtpParameters(y.kind,Y);X.codecs=r.reduceCodecs(X.codecs,j),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:M});let ne=!1;const de=(0,o.parse)((p??[{}])[0].scalabilityMode);let F;(p==null?void 0:p.length)===1&&de.spatialLayers>1&&H.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),ne=!0,M=e.parse(R.sdp),F=M.media[_.idx],m.addLegacySimulcast({offerMediaObject:F,numStreams:de.spatialLayers}),R={type:"offer",sdp:e.write(M)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",R),x!=null&&x.absCaptureTime&&(F=M.media[_.idx],h.addHeaderExtension({offerMediaObject:F,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:X.headerExtensions.find(V=>V.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),R={type:"offer",sdp:e.write(M)}),await this._pc.setLocalDescription(R);const L=E.mid;if(H.mid=L,M=e.parse(this._pc.localDescription.sdp),F=M.media[_.idx],H.rtcp.cname=h.getCname({offerMediaObject:F}),H.msid=`${l??this._sendStream.id} ${y.id}`,!p)H.encodings=m.getRtpEncodings({offerMediaObject:F,codecs:H.codecs});else if(p.length===1){let V=m.getRtpEncodings({offerMediaObject:F,codecs:H.codecs});Object.assign(V[0],p[0]),ne&&(V=[V[0]]),H.encodings=V}else H.encodings=p;if(H.encodings.length>1&&(H.codecs[0].mimeType.toLowerCase()==="video/vp8"||H.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const V of H.encodings)V.scalabilityMode?V.scalabilityMode=`L1T${de.temporalLayers}`:V.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:F,reuseMid:_.reuseMid,offerRtpParameters:H,answerRtpParameters:X,codecOptions:v});const $={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",$),await this._pc.setRemoteDescription($),this._mapMidTransceiver.set(L,E),{localId:L,rtpParameters:H,rtpSender:E.sender}}async stopSending(y){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const p=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const p=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?f.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):f.debug("replaceTrack() [localId:%s, no track]",y);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");await p.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{E<=l?_.active=!0:_.active=!1}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{v.encodings[E]={..._,...l}}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:p,label:v,protocol:x}){this.assertNotClosed(),this.assertSendDirection();const j={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:p,protocol:x};f.debug("sendDataChannel() [options:%o]",j);const _=this._pc.createDataChannel(v,j);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),M=e.parse(R.sdp),P=M.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:M}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const z={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",z),await this._pc.setRemoteDescription(z),this._hasDataChannelMediaSection=!0}const E={streamId:j.id,ordered:j.ordered,maxPacketLifeTime:j.maxPacketLifeTime,maxRetransmits:j.maxRetransmits};return{dataChannel:_,sctpStreamParameters:E}}async receive(y){var _;this.assertNotClosed(),this.assertRecvDirection();const l=[],p=new Map;for(const E of y){const{trackId:R,kind:M,rtpParameters:P,streamId:z}=E;f.debug("receive() [trackId:%s, kind:%s]",R,M);const Y=P.mid??String(this._mapMidTransceiver.size);p.set(R,Y);const{msidStreamId:H}=g.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:Y,kind:M,offerRtpParameters:P,streamId:z??H??((_=P.rtcp)==null?void 0:_.cname)??"-",trackId:R})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);let x=await this._pc.createAnswer();const j=e.parse(x.sdp);for(const E of y){const{trackId:R,rtpParameters:M}=E,P=p.get(R),z=j.media.find(Y=>String(Y.mid)===P);h.applyCodecParameters({offerRtpParameters:M,answerMediaObject:z})}x={type:"answer",sdp:e.write(j)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",x),await this._pc.setLocalDescription(x);for(const E of y){const{trackId:R}=E,M=p.get(R),P=this._pc.getTransceivers().find(z=>z.mid===M);if(P)this._mapMidTransceiver.set(M,P),l.push({localId:M,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){f.debug("stopReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(x.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("pauseReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("resumeReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:p}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_}=y,E={negotiated:!0,id:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_,protocol:p};f.debug("receiveDataChannel() [options:%o]",E);const R=this._pc.createDataChannel(l,E);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const P=await this._pc.createAnswer();if(!this._transportReady){const z=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:z})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const p=h.extractDtlsParameters({sdpObject:l});p.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,x)=>{this.safeEmit("@connect",{dtlsParameters:p},v,x)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ho.Chrome74=A,Ho}var Wo={},Fv;function Rk(){if(Fv)return Wo;Fv=1,Object.defineProperty(Wo,"__esModule",{value:!0}),Wo.Firefox120=void 0;const e=dt,t=xt,n=lt,r=Ct,i=Ue,o=Zr,d=La(),h=jn,m=es,g=yr,f=new n.Logger("Firefox120"),S="Firefox120",T={OS:16,MIS:2048};let A=class dl extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x,iceServers:j,iceTransportPolicy:_,additionalSettings:E,getSendExtendedRtpCapabilities:R}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});f.debug("constructor()"),this._direction=y,this._remoteSdp=new d.RemoteSdp({iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x}),this._getSendExtendedRtpCapabilities=R,this._pc=new RTCPeerConnection({iceServers:j??[],iceTransportPolicy:_??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...E}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:y=>new dl(y),getNativeRtpCapabilities:async()=>{f.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const l=document.createElement("canvas");l.getContext("2d");const v=l.captureStream().getVideoTracks()[0];try{y.addTransceiver("audio",{direction:"sendrecv"}),y.addTransceiver(v,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const x=await y.createOffer();try{l.remove()}catch{}try{v.stop()}catch{}try{y.close()}catch{}y=void 0;const j=e.parse(x.sdp);return dl.getLocalRtpCapabilities(j)}catch(x){try{l.remove()}catch{}try{v.stop()}catch{}try{y==null||y.close()}catch{}throw y=void 0,x}},getNativeSctpCapabilities:async()=>(f.debug("getNativeSctpCapabilities()"),{numStreams:T})}}static getLocalRtpCapabilities(y){const l=h.extractRtpCapabilities({sdpObject:y});return i.validateAndNormalizeRtpCapabilities(l),l}get name(){return S}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){throw this.assertNotClosed(),new r.UnsupportedError("not supported")}async restartIce(y){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:p,codecOptions:v,codec:x,onRtpSender:j}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),p&&p.length>1&&p.forEach((F,L)=>{F.rid=`r${L}`});const _=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:p});j&&j(_.sender);const E=await this._pc.createOffer();let R=e.parse(E.sdp);R.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const M=dl.getLocalRtpCapabilities(R),P=this._getSendExtendedRtpCapabilities(M),z=i.getSendingRtpParameters(y.kind,P);z.codecs=i.reduceCodecs(z.codecs,x);const Y=i.getSendingRemoteRtpParameters(y.kind,P);Y.codecs=i.reduceCodecs(Y.codecs,x),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:R});const H=(0,o.parse)((p??[{}])[0].scalabilityMode);f.debug("send() | calling pc.setLocalDescription() [offer:%o]",E),await this._pc.setLocalDescription(E);const X=_.mid;z.mid=X,R=e.parse(this._pc.localDescription.sdp);const ne=R.media[R.media.length-1];if(z.rtcp.cname=h.getCname({offerMediaObject:ne}),z.msid=`${l??this._sendStream.id} ${y.id}`,!p)z.encodings=m.getRtpEncodings({offerMediaObject:ne,codecs:z.codecs});else if(p.length===1){const F=m.getRtpEncodings({offerMediaObject:ne,codecs:z.codecs});Object.assign(F[0],p[0]),z.encodings=F}else z.encodings=p;if(z.encodings.length>1&&(z.codecs[0].mimeType.toLowerCase()==="video/vp8"||z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const F of z.encodings)F.scalabilityMode?F.scalabilityMode=`L1T${H.temporalLayers}`:F.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ne,offerRtpParameters:z,answerRtpParameters:Y,codecOptions:v});const de={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",de),await this._pc.setRemoteDescription(de),this._mapMidTransceiver.set(X,_),{localId:X,rtpParameters:z,rtpSender:_.sender}}async stopSending(y){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",y),this._closed)return;const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated transceiver not found");l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.disableMediaSection(l.mid);const p=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const p=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const p=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?f.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):f.debug("replaceTrack() [localId:%s, no track]",y);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");await p.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated transceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{E<=l?_.active=!0:_.active=!1}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{v.encodings[E]={..._,...l}}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:p,label:v,protocol:x}){this.assertNotClosed(),this.assertSendDirection();const j={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:p,protocol:x};f.debug("sendDataChannel() [options:%o]",j);const _=this._pc.createDataChannel(v,j);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),M=e.parse(R.sdp),P=M.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const z={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",z),await this._pc.setRemoteDescription(z),this._hasDataChannelMediaSection=!0}const E={streamId:j.id,ordered:j.ordered,maxPacketLifeTime:j.maxPacketLifeTime,maxRetransmits:j.maxRetransmits};return{dataChannel:_,sctpStreamParameters:E}}async receive(y){var _;this.assertNotClosed(),this.assertRecvDirection();const l=[],p=new Map;for(const E of y){const{trackId:R,kind:M,rtpParameters:P,streamId:z}=E;f.debug("receive() [trackId:%s, kind:%s]",R,M);const Y=P.mid??String(this._mapMidTransceiver.size);p.set(R,Y);const{msidStreamId:H}=g.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:Y,kind:M,offerRtpParameters:P,streamId:z??H??((_=P.rtcp)==null?void 0:_.cname)??"-",trackId:R})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const E of y){const{trackId:R,onRtpReceiver:M}=E;if(M){const P=p.get(R),z=this._pc.getTransceivers().find(Y=>Y.mid===P);if(!z)throw new Error("transceiver not found");M(z.receiver)}}let x=await this._pc.createAnswer();const j=e.parse(x.sdp);for(const E of y){const{trackId:R,rtpParameters:M}=E,P=p.get(R),z=j.media.find(Y=>String(Y.mid)===P);h.applyCodecParameters({offerRtpParameters:M,answerMediaObject:z}),x={type:"answer",sdp:e.write(j)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:j}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",x),await this._pc.setLocalDescription(x);for(const E of y){const{trackId:R}=E,M=p.get(R),P=this._pc.getTransceivers().find(z=>z.mid===M);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,P),l.push({localId:M,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){f.debug("stopReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(x.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("pauseReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("resumeReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async getReceiverStats(y){this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:p}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_}=y,E={negotiated:!0,id:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_,protocol:p};f.debug("receiveDataChannel() [options:%o]",E);const R=this._pc.createDataChannel(l,E);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const P=await this._pc.createAnswer();if(!this._transportReady){const z=e.parse(P.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:z})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const p=h.extractDtlsParameters({sdpObject:l});p.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,x)=>{this.safeEmit("@connect",{dtlsParameters:p},v,x)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new r.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Wo.Firefox120=A,Wo}var Qo={},zv;function Ik(){if(zv)return Qo;zv=1,Object.defineProperty(Qo,"__esModule",{value:!0}),Qo.Safari12=void 0;const e=dt,t=xt,n=lt,r=Ue,i=Ct,o=Zr,d=La(),h=jn,m=es,g=yr,f=new n.Logger("Safari12"),S="Safari12",T={OS:1024,MIS:1024};let A=class ul extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x,iceServers:j,iceTransportPolicy:_,additionalSettings:E,getSendExtendedRtpCapabilities:R}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});f.debug("constructor()"),this._direction=y,this._remoteSdp=new d.RemoteSdp({iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x}),this._getSendExtendedRtpCapabilities=R,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:j??[],iceTransportPolicy:_??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...E}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",M=>{this.emit("@icecandidateerror",M)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:y=>new ul(y),getNativeRtpCapabilities:async()=>{f.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const p=e.parse(l.sdp);return ul.getLocalRtpCapabilities(p)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(f.debug("getNativeSctpCapabilities()"),{numStreams:T})}}static getLocalRtpCapabilities(y,l=[]){const p=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(p),g.addNackSupportForOpus(p);for(const v of l)g.addHeaderExtensionSupport(p,v);return p}get name(){return S}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),f.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:p,codecOptions:v,headerExtensionOptions:x,codec:j,onRtpSender:_}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l);const E=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream]});_&&_(R.sender);let M=await this._pc.createOffer(),P=e.parse(M.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const z=[];z.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const Y=ul.getLocalRtpCapabilities(P,z),H=this._getSendExtendedRtpCapabilities(Y),X=r.getSendingRtpParameters(y.kind,H);X.codecs=r.reduceCodecs(X.codecs,j);const ne=r.getSendingRemoteRtpParameters(y.kind,H);ne.codecs=r.reduceCodecs(ne.codecs,j);let de;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});const F=(0,o.parse)((p??[{}])[0].scalabilityMode);p&&p.length>1&&(f.debug("send() | enabling legacy simulcast"),P=e.parse(M.sdp),de=P.media[E.idx],m.addLegacySimulcast({offerMediaObject:de,numStreams:p.length}),M={type:"offer",sdp:e.write(P)}),x!=null&&x.absCaptureTime&&(de=P.media[E.idx],h.addHeaderExtension({offerMediaObject:de,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:ne.headerExtensions.find(V=>V.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),M={type:"offer",sdp:e.write(P)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M);const L=R.mid;if(X.mid=L,P=e.parse(this._pc.localDescription.sdp),de=P.media[E.idx],X.rtcp.cname=h.getCname({offerMediaObject:de}),X.msid=`${l??this._sendStream.id} ${y.id}`,X.encodings=m.getRtpEncodings({offerMediaObject:de,codecs:X.codecs}),p)for(let V=0;V<X.encodings.length;++V)p[V]&&Object.assign(X.encodings[V],p[V]);if(X.encodings.length>1&&(X.codecs[0].mimeType.toLowerCase()==="video/vp8"||X.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const V of X.encodings)V.scalabilityMode?V.scalabilityMode=`L1T${F.temporalLayers}`:V.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:de,reuseMid:E.reuseMid,offerRtpParameters:X,answerRtpParameters:ne,codecOptions:v});const $={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",$),await this._pc.setRemoteDescription($),this._mapMidTransceiver.set(L,R),{localId:L,rtpParameters:X,rtpSender:R.sender}}async stopSending(y){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const p=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const p=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?f.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):f.debug("replaceTrack() [localId:%s, no track]",y);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");await p.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{E<=l?_.active=!0:_.active=!1}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{v.encodings[E]={..._,...l}}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:p,label:v,protocol:x}){this.assertNotClosed(),this.assertSendDirection();const j={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:p,protocol:x};f.debug("sendDataChannel() [options:%o]",j);const _=this._pc.createDataChannel(v,j);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),M=e.parse(R.sdp),P=M.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:M}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const z={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",z),await this._pc.setRemoteDescription(z),this._hasDataChannelMediaSection=!0}const E={streamId:j.id,ordered:j.ordered,maxPacketLifeTime:j.maxPacketLifeTime,maxRetransmits:j.maxRetransmits};return{dataChannel:_,sctpStreamParameters:E}}async receive(y){var _;this.assertNotClosed(),this.assertRecvDirection();const l=[],p=new Map;for(const E of y){const{trackId:R,kind:M,rtpParameters:P,streamId:z}=E;f.debug("receive() [trackId:%s, kind:%s]",R,M);const Y=P.mid??String(this._mapMidTransceiver.size);p.set(R,Y);const{msidStreamId:H}=g.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:Y,kind:M,offerRtpParameters:P,streamId:z??H??((_=P.rtcp)==null?void 0:_.cname)??"-",trackId:R})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const E of y){const{trackId:R,onRtpReceiver:M}=E;if(M){const P=p.get(R),z=this._pc.getTransceivers().find(Y=>Y.mid===P);if(!z)throw new Error("transceiver not found");M(z.receiver)}}let x=await this._pc.createAnswer();const j=e.parse(x.sdp);for(const E of y){const{trackId:R,rtpParameters:M}=E,P=p.get(R),z=j.media.find(Y=>String(Y.mid)===P);h.applyCodecParameters({offerRtpParameters:M,answerMediaObject:z})}x={type:"answer",sdp:e.write(j)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",x),await this._pc.setLocalDescription(x);for(const E of y){const{trackId:R}=E,M=p.get(R),P=this._pc.getTransceivers().find(z=>z.mid===M);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,P),l.push({localId:M,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){f.debug("stopReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(x.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("pauseReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("resumeReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:p}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_}=y,E={negotiated:!0,id:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_,protocol:p};f.debug("receiveDataChannel() [options:%o]",E);const R=this._pc.createDataChannel(l,E);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const P=await this._pc.createAnswer();if(!this._transportReady){const z=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:z})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const p=h.extractDtlsParameters({sdpObject:l});p.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,x)=>{this.safeEmit("@connect",{dtlsParameters:p},v,x)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Qo.Safari12=A,Qo}var Ko={},Bv;function Nk(){if(Bv)return Ko;Bv=1,Object.defineProperty(Ko,"__esModule",{value:!0}),Ko.ReactNative106=void 0;const e=dt,t=xt,n=lt,r=Ue,i=Ct,o=Zr,d=La(),h=jn,m=es,g=yr,f=new n.Logger("ReactNative106"),S="ReactNative106",T={OS:1024,MIS:1024};let A=class pl extends t.EnhancedEventEmitter{constructor({direction:y,iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x,iceServers:j,iceTransportPolicy:_,additionalSettings:E,getSendExtendedRtpCapabilities:R}){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_getSendExtendedRtpCapabilities");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1);N(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});N(this,"onIceCandidateError",y=>{this.emit("@icecandidateerror",y)});N(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});N(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});f.debug("constructor()"),this._direction=y,this._remoteSdp=new d.RemoteSdp({iceParameters:l,iceCandidates:p,dtlsParameters:v,sctpParameters:x}),this._getSendExtendedRtpCapabilities=R,v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:j??[],iceTransportPolicy:_??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...E}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:y=>new pl(y),getNativeRtpCapabilities:async()=>{f.debug("getNativeRtpCapabilities()");let y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const l=await y.createOffer();try{y.close()}catch{}y=void 0;const p=e.parse(l.sdp);return pl.getLocalRtpCapabilities(p)}catch(l){try{y==null||y.close()}catch{}throw y=void 0,l}},getNativeSctpCapabilities:async()=>(f.debug("getNativeSctpCapabilities()"),{numStreams:T})}}static getLocalRtpCapabilities(y,l=[]){const p=h.extractRtpCapabilities({sdpObject:y});r.validateAndNormalizeRtpCapabilities(p),g.addNackSupportForOpus(p);for(const v of l)g.addHeaderExtensionSupport(p,v);return p}get name(){return S}close(){if(f.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(y){this.assertNotClosed(),f.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=y,this._pc.setConfiguration(l)}async restartIce(y){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const p={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:y,streamId:l,encodings:p,codecOptions:v,headerExtensionOptions:x,codec:j,onRtpSender:_}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s, streamId:%s]",y.kind,y.id,l),p&&p.length>1&&p.forEach((J,oe)=>{J.rid=`r${oe}`});const E=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream],sendEncodings:p});_&&_(R.sender);let M=await this._pc.createOffer(),P=e.parse(M.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const z=[];z.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:y.kind,direction:"sendonly"});const Y=pl.getLocalRtpCapabilities(P,z),H=this._getSendExtendedRtpCapabilities(Y),X=r.getSendingRtpParameters(y.kind,H);X.codecs=r.reduceCodecs(X.codecs,j);const ne=r.getSendingRemoteRtpParameters(y.kind,H);ne.codecs=r.reduceCodecs(ne.codecs,j),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});let de=!1;const F=(0,o.parse)((p??[{}])[0].scalabilityMode);let L;(p==null?void 0:p.length)===1&&F.spatialLayers>1&&X.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),de=!0,P=e.parse(M.sdp),L=P.media[E.idx],m.addLegacySimulcast({offerMediaObject:L,numStreams:F.spatialLayers}),M={type:"offer",sdp:e.write(P)}),x!=null&&x.absCaptureTime&&(L=P.media[E.idx],h.addHeaderExtension({offerMediaObject:L,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:ne.headerExtensions.find(J=>J.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),M={type:"offer",sdp:e.write(P)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M);let $=R.mid??void 0;if($||f.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),X.mid=$,P=e.parse(this._pc.localDescription.sdp),L=P.media[E.idx],X.rtcp.cname=h.getCname({offerMediaObject:L}),X.msid=`${l??this._sendStream.id} ${y.id}`,!p)X.encodings=m.getRtpEncodings({offerMediaObject:L,codecs:X.codecs});else if(p.length===1){let J=m.getRtpEncodings({offerMediaObject:L,codecs:X.codecs});Object.assign(J[0],p[0]),de&&(J=[J[0]]),X.encodings=J}else X.encodings=p;if(X.encodings.length>1&&(X.codecs[0].mimeType.toLowerCase()==="video/vp8"||X.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const J of X.encodings)J.scalabilityMode?J.scalabilityMode=`L1T${F.temporalLayers}`:J.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:E.reuseMid,offerRtpParameters:X,answerRtpParameters:ne,codecOptions:v});const V={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",V),await this._pc.setRemoteDescription(V),$||($=R.mid,X.mid=$),this._mapMidTransceiver.set($,R),{localId:$,rtpParameters:X,rtpSender:R.sender}}async stopSending(y){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const v=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.delete(y)}async pauseSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(y);const p=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async resumeSending(y){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",y);const l=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const p=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async replaceTrack(y,l){this.assertNotClosed(),this.assertSendDirection(),l?f.debug("replaceTrack() [localId:%s, track.id:%s]",y,l.id):f.debug("replaceTrack() [localId:%s, no track]",y);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");await p.sender.replaceTrack(l)}async setMaxSpatialLayer(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{E<=l?_.active=!0:_.active=!1}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async setRtpEncodingParameters(y,l){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,l);const p=this._mapMidTransceiver.get(y);if(!p)throw new Error("associated RTCRtpTransceiver not found");const v=p.sender.getParameters();v.encodings.forEach((_,E)=>{v.encodings[E]={..._,...l}}),await p.sender.setParameters(v),this._remoteSdp.muxMediaSectionSimulcast(y,v.encodings);const x=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const j={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j)}async getSenderStats(y){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:y,maxPacketLifeTime:l,maxRetransmits:p,label:v,protocol:x}){this.assertNotClosed(),this.assertSendDirection();const j={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:l,maxRetransmits:p,protocol:x};f.debug("sendDataChannel() [options:%o]",j);const _=this._pc.createDataChannel(v,j);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),M=e.parse(R.sdp),P=M.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:M}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const z={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",z),await this._pc.setRemoteDescription(z),this._hasDataChannelMediaSection=!0}const E={streamId:j.id,ordered:j.ordered,maxPacketLifeTime:j.maxPacketLifeTime,maxRetransmits:j.maxRetransmits};return{dataChannel:_,sctpStreamParameters:E}}async receive(y){var _;this.assertNotClosed(),this.assertRecvDirection();const l=[],p=new Map;for(const E of y){const{trackId:R,kind:M,rtpParameters:P,streamId:z}=E;f.debug("receive() [trackId:%s, kind:%s]",R,M);const Y=P.mid??String(this._mapMidTransceiver.size);p.set(R,Y);const{msidStreamId:H}=g.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:Y,kind:M,offerRtpParameters:P,streamId:z??H??((_=P.rtcp)==null?void 0:_.cname)??"-",trackId:R})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);for(const E of y){const{trackId:R,onRtpReceiver:M}=E;if(M){const P=p.get(R),z=this._pc.getTransceivers().find(Y=>Y.mid===P);if(!z)throw new Error("transceiver not found");M(z.receiver)}}let x=await this._pc.createAnswer();const j=e.parse(x.sdp);for(const E of y){const{trackId:R,rtpParameters:M}=E,P=p.get(R),z=j.media.find(Y=>String(Y.mid)===P);h.applyCodecParameters({offerRtpParameters:M,answerMediaObject:z})}x={type:"answer",sdp:e.write(j)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",x),await this._pc.setLocalDescription(x);for(const E of y){const{trackId:R}=E,M=p.get(R),P=this._pc.getTransceivers().find(z=>z.mid===M);if(P)this._mapMidTransceiver.set(M,P),l.push({localId:M,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(y){if(this.assertRecvDirection(),this._closed)return;for(const v of y){f.debug("stopReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(x.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);for(const v of y)this._mapMidTransceiver.delete(v)}async pauseReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("pauseReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="inactive",this._remoteSdp.pauseMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async resumeReceiving(y){this.assertNotClosed(),this.assertRecvDirection();for(const v of y){f.debug("resumeReceiving() [localId:%s]",v);const x=this._mapMidTransceiver.get(v);if(!x)throw new Error("associated RTCRtpTransceiver not found");x.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(v)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const p=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p)}async getReceiverStats(y){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(y);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:y,label:l,protocol:p}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_}=y,E={negotiated:!0,id:v,ordered:x,maxPacketLifeTime:j,maxRetransmits:_,protocol:p};f.debug("receiveDataChannel() [options:%o]",E);const R=this._pc.createDataChannel(l,E);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const P=await this._pc.createAnswer();if(!this._transportReady){const z=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:z})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:y,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const p=h.extractDtlsParameters({sdpObject:l});p.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),await new Promise((v,x)=>{this.safeEmit("@connect",{dtlsParameters:p},v,x)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ko.ReactNative106=A,Ko}var Vv;function jk(){if(Vv)return gs;Vv=1,Object.defineProperty(gs,"__esModule",{value:!0}),gs.Device=void 0,gs.detectDevice=T,gs.detectDeviceAsync=A;const e=lt,t=xt,n=Ct,r=Kn,i=Ue,o=od,d=kk(),h=Tk(),m=Rk(),g=Ik(),f=Nk(),S=new e.Logger("Device");function T(_,E){return S.debug("detectDevice()"),!_&&typeof navigator=="object"&&(_=navigator.userAgent),!E&&typeof navigator=="object"&&(E=navigator.userAgentData),B(_,E)}async function A(_,E){return S.debug("detectDeviceAsync()"),!_&&typeof navigator=="object"&&(_=navigator.userAgent),!E&&typeof navigator=="object"&&(E=navigator.userAgentData),B(_,E)}let G=class Y_{constructor({handlerName:E,handlerFactory:R}={}){N(this,"_handlerFactory");N(this,"_handlerName");N(this,"_loaded",!1);N(this,"_getSendExtendedRtpCapabilities");N(this,"_recvRtpCapabilities");N(this,"_canProduceByKind",{audio:!1,video:!1});N(this,"_sctpCapabilities");N(this,"_observer",new t.EnhancedEventEmitter);if(S.debug("constructor()"),E&&R)throw new TypeError("just one of handlerName or handlerInterface can be given");if(R)this._handlerFactory=R;else{if(E)S.debug("constructor() | handler given: %s",E);else if(E=T(),E)S.debug("constructor() | detected handler: %s",E);else throw new n.UnsupportedError("device not supported");switch(E){case"Chrome111":{this._handlerFactory=d.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=h.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=m.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=g.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=f.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${E}"`)}}this._handlerName=this._handlerFactory.name}static async factory({handlerName:E,handlerFactory:R}={}){if(S.debug("factory()"),E&&R)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!E&&!R&&(E=await A(),!E))throw new n.UnsupportedError("device not supported");return new Y_({handlerName:E,handlerFactory:R})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:E,preferLocalCodecsOrder:R=!1}){if(S.debug("load() [routerRtpCapabilities:%o]",E),this._loaded)throw new n.InvalidStateError("already loaded");const M=r.clone(E);i.validateAndNormalizeRtpCapabilities(M);const{getNativeRtpCapabilities:P,getNativeSctpCapabilities:z}=this._handlerFactory,Y=r.clone(await P());i.validateAndNormalizeRtpCapabilities(Y),S.debug("load() | got native RTP capabilities:%o",Y),this._getSendExtendedRtpCapabilities=X=>r.clone(i.getExtendedRtpCapabilities(X,M,R));const H=i.getExtendedRtpCapabilities(Y,M,!1);this._recvRtpCapabilities=i.getRecvRtpCapabilities(H),i.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),S.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=i.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=i.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await z(),i.validateSctpCapabilities(this._sctpCapabilities),S.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),S.debug("load() succeeded"),this._loaded=!0}canProduce(E){if(this._loaded){if(E!=="audio"&&E!=="video")throw new TypeError(`invalid kind "${E}"`)}else throw new n.InvalidStateError("not loaded");return this._canProduceByKind[E]}createSendTransport({id:E,iceParameters:R,iceCandidates:M,dtlsParameters:P,sctpParameters:z,iceServers:Y,iceTransportPolicy:H,additionalSettings:X,appData:ne}){return S.debug("createSendTransport()"),this.createTransport({direction:"send",id:E,iceParameters:R,iceCandidates:M,dtlsParameters:P,sctpParameters:z,iceServers:Y,iceTransportPolicy:H,additionalSettings:X,appData:ne})}createRecvTransport({id:E,iceParameters:R,iceCandidates:M,dtlsParameters:P,sctpParameters:z,iceServers:Y,iceTransportPolicy:H,additionalSettings:X,appData:ne}){return S.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:E,iceParameters:R,iceCandidates:M,dtlsParameters:P,sctpParameters:z,iceServers:Y,iceTransportPolicy:H,additionalSettings:X,appData:ne})}createTransport({direction:E,id:R,iceParameters:M,iceCandidates:P,dtlsParameters:z,sctpParameters:Y,iceServers:H,iceTransportPolicy:X,additionalSettings:ne,appData:de}){if(this._loaded){if(typeof R!="string")throw new TypeError("missing id");if(typeof M!="object")throw new TypeError("missing iceParameters");if(Array.isArray(P)){if(typeof z!="object")throw new TypeError("missing dtlsParameters");if(Y&&typeof Y!="object")throw new TypeError("wrong sctpParameters");if(de&&typeof de!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new n.InvalidStateError("not loaded");const F=new o.Transport({direction:E,id:R,iceParameters:M,iceCandidates:P,dtlsParameters:z,sctpParameters:Y,iceServers:H,iceTransportPolicy:X,additionalSettings:ne,appData:de,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",F),F}};gs.Device=G;function B(_,E){S.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',_,E);const R=y(_,E);if(R){if(R>=111)return S.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(R>=74)return S.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";S.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const M=l(_);if(M){if(M>=120)return S.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";S.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const P=p(_);if(P){if(P>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const z=v(_);if(z){if(z>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(j()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return S.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";S.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}S.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',_,E)}function y(_,E){if(S.debug("getChromiumMajorVersion()"),x(_,E)){S.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(j()){S.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(E){const M=(E.brands??[]).find(P=>P.brand==="Chromium");if(M){const P=Number(M.version);return S.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${P}`),P}}const R=_==null?void 0:_.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(R!=null&&R[1]){const M=Number(R[1]);return S.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${M}`),M}S.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function l(_){if(S.debug("getFirefoxMajorVersion()"),x(_)){S.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(j()){S.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const E=_==null?void 0:_.match(/\bFirefox\/(\w+)/i);if(E!=null&&E[1]){const R=Number(E[1]);return S.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${R}`),R}S.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function p(_){if(S.debug("getMacOSWebKitMajorVersion()"),x(_)){S.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(j()){S.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(_&&/\bSafari\b/i.test(_)&&!/\bChrome\b/i.test(_)&&!/\bChromium\b/i.test(_)&&!/\bFirefox\b/i.test(_))){S.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const R=_.match(/AppleWebKit\/(\w+)/i);if(R!=null&&R[1]){const M=Number(R[1]);return S.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${M}`),M}S.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function v(_){if(S.debug("getIOSWebKitMajorVersion()"),!x(_)){S.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(j()){S.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const E=_==null?void 0:_.match(/AppleWebKit\/(\w+)/i);if(E!=null&&E[1]){const R=Number(E[1]);return S.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${R}`),R}S.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function x(_,E){return S.debug("isIOS()"),(E==null?void 0:E.platform)==="iOS"?(S.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):E!=null&&E.platform?(S.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):_&&/iPad|iPhone|iPod/.test(_)?(S.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(S.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(S.debug("isIOS() | this is not iOS => false"),!1)}function j(){return S.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(S.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(S.debug("isReactNative() | this is not React-Native => false"),!1)}return gs}var fd={},hd={},J_={},bs=256,fl=[],Hc;for(;bs--;)fl[bs]=(bs+256).toString(16).substring(1);function Pk(){var e=0,t,n="";if(!Hc||bs+16>256){for(Hc=Array(e=256);e--;)Hc[e]=256*Math.random()|0;e=bs=0}for(;e<16;e++)t=Hc[bs+e],e==6?n+=fl[t&15|64]:e==8?n+=fl[t&63|128]:n+=fl[t],e&1&&e>1&&e<11&&(n+="-");return bs++,n}J_.v4=Pk;var md={};Object.defineProperty(md,"__esModule",{value:!0});md.FakeEventTarget=void 0;let Dk=class{constructor(){N(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}};md.FakeEventTarget=Dk;var gd={};Object.defineProperty(gd,"__esModule",{value:!0});gd.FakeEvent=void 0;class Lk{constructor(t,n={}){N(this,"NONE",0);N(this,"CAPTURING_PHASE",1);N(this,"AT_TARGET",2);N(this,"BUBBLING_PHASE",3);N(this,"type");N(this,"bubbles");N(this,"cancelable");N(this,"defaultPrevented",!1);N(this,"composed",!1);N(this,"currentTarget",null);N(this,"eventPhase",this.NONE);N(this,"isTrusted",!0);N(this,"target",null);N(this,"timeStamp",0);N(this,"cancelBubble",!1);N(this,"returnValue",!0);N(this,"srcElement",null);this.type=t,this.bubbles=n.bubbles??!1,this.cancelable=n.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(t,n,r){}}gd.FakeEvent=Lk;var fh={};Object.defineProperty(fh,"__esModule",{value:!0});fh.clone=Mk;function Mk(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}Object.defineProperty(hd,"__esModule",{value:!0});hd.FakeMediaStreamTrack=void 0;const Gv=J_,Ok=md,xi=gd,Wc=fh;var Ra,Ki,Yi,Vn,Or,Gn,Es,Ji,ks,qi,Ts,Rs,Is,Ns,js,Ps;const gh=class gh extends Ok.FakeEventTarget{constructor({kind:n,id:r,label:i,contentHint:o,enabled:d,muted:h,readyState:m,capabilities:g,constraints:f,settings:S,data:T}){super();rt(this,Ra);rt(this,Ki);rt(this,Yi);rt(this,Vn);rt(this,Or);rt(this,Gn);rt(this,Es);rt(this,Ji);rt(this,ks);rt(this,qi);rt(this,Ts);rt(this,Rs,null);rt(this,Is,null);rt(this,Ns,null);rt(this,js,null);rt(this,Ps,null);Ie(this,Ra,r??(0,Gv.v4)()),Ie(this,Ki,n),Ie(this,Yi,i??""),Ie(this,Es,o??""),Ie(this,Or,d??!0),Ie(this,Gn,h??!1),Ie(this,Vn,m??"live"),Ie(this,Ji,g??{}),Ie(this,ks,f??{}),Ie(this,qi,S??{}),Ie(this,Ts,T??{})}get id(){return le(this,Ra)}get kind(){return le(this,Ki)}get label(){return le(this,Yi)}get contentHint(){return le(this,Es)}set contentHint(n){Ie(this,Es,n)}get enabled(){return le(this,Or)}set enabled(n){const r=le(this,Or)!==n;Ie(this,Or,n),r&&this.dispatchEvent(new xi.FakeEvent("enabledchange"))}get muted(){return le(this,Gn)}get readyState(){return le(this,Vn)}get data(){return le(this,Ts)}set data(n){Ie(this,Ts,n)}get onmute(){return le(this,Rs)}set onmute(n){le(this,Rs)&&this.removeEventListener("mute",le(this,Rs)),Ie(this,Rs,n),n&&this.addEventListener("mute",n)}get onunmute(){return le(this,Is)}set onunmute(n){le(this,Is)&&this.removeEventListener("unmute",le(this,Is)),Ie(this,Is,n),n&&this.addEventListener("unmute",n)}get onended(){return le(this,Ns)}set onended(n){le(this,Ns)&&this.removeEventListener("ended",le(this,Ns)),Ie(this,Ns,n),n&&this.addEventListener("ended",n)}get onenabledchange(){return le(this,js)}set onenabledchange(n){le(this,js)&&this.removeEventListener("enabledchange",le(this,js)),Ie(this,js,n),n&&this.addEventListener("enabledchange",n)}get onstopped(){return le(this,Ps)}set onstopped(n){le(this,Ps)&&this.removeEventListener("stopped",le(this,Ps)),Ie(this,Ps,n),n&&this.addEventListener("stopped",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}stop(){le(this,Vn)!=="ended"&&(Ie(this,Vn,"ended"),this.dispatchEvent(new xi.FakeEvent("stopped")))}clone({id:n,data:r}={}){return new gh({id:n??(0,Gv.v4)(),kind:le(this,Ki),label:le(this,Yi),contentHint:le(this,Es),enabled:le(this,Or),muted:le(this,Gn),readyState:le(this,Vn),capabilities:(0,Wc.clone)(le(this,Ji)),constraints:(0,Wc.clone)(le(this,ks)),settings:(0,Wc.clone)(le(this,qi)),data:r??(0,Wc.clone)(le(this,Ts))})}getCapabilities(){return le(this,Ji)}getConstraints(){return le(this,ks)}async applyConstraints(n={}){return Ie(this,ks,n),Promise.resolve()}getSettings(){return le(this,qi)}remoteStop(){le(this,Vn)!=="ended"&&(Ie(this,Vn,"ended"),this.dispatchEvent(new xi.FakeEvent("stopped")),this.dispatchEvent(new xi.FakeEvent("ended")))}remoteMute(){le(this,Gn)||(Ie(this,Gn,!0),this.dispatchEvent(new xi.FakeEvent("mute")))}remoteUnmute(){le(this,Gn)&&(Ie(this,Gn,!1),this.dispatchEvent(new xi.FakeEvent("unmute")))}};Ra=new WeakMap,Ki=new WeakMap,Yi=new WeakMap,Vn=new WeakMap,Or=new WeakMap,Gn=new WeakMap,Es=new WeakMap,Ji=new WeakMap,ks=new WeakMap,qi=new WeakMap,Ts=new WeakMap,Rs=new WeakMap,Is=new WeakMap,Ns=new WeakMap,js=new WeakMap,Ps=new WeakMap;let of=gh;hd.FakeMediaStreamTrack=of;var vd={};Object.defineProperty(vd,"__esModule",{value:!0});vd.FakeEventTarget=void 0;class Ak{constructor(){N(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}}vd.FakeEventTarget=Ak;Object.defineProperty(fd,"__esModule",{value:!0});fd.FakeHandler=void 0;const $k=hd,Uk=xt,Fk=lt,bi=Kn,rp=Ue,q_=Ct,zk=vd,st=new Fk.Logger("FakeHandler"),Hv="FakeHandler";class ca extends Uk.EnhancedEventEmitter{constructor({getSendExtendedRtpCapabilities:n},r){super();N(this,"_closed",!1);N(this,"_fakeParameters");N(this,"_getSendExtendedRtpCapabilities");N(this,"_cname",`CNAME-${bi.generateRandomNumber()}`);N(this,"_defaultSendStreamId",`${bi.generateRandomNumber()}`);N(this,"_transportReady",!1);N(this,"_nextLocalId",1);N(this,"_tracks",new Map);N(this,"_nextSctpStreamId",0);st.debug("constructor()"),this._getSendExtendedRtpCapabilities=n,this._fakeParameters=r}static createFactory(n){return{name:Hv,factory:r=>new ca(r,n),getNativeRtpCapabilities:async()=>(st.debug("getNativeRtpCapabilities()"),ca.getLocalRtpCapabilities(n)),getNativeSctpCapabilities:async()=>(st.debug("getNativeSctpCapabilities()"),n.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(n){const r=n.generateNativeRtpCapabilities();return rp.validateAndNormalizeRtpCapabilities(r),r}get name(){return Hv}close(){st.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(n){this.emit("@icegatheringstatechange",n)}setConnectionState(n){this.emit("@connectionstatechange",n)}async updateIceServers(n){this.assertNotClosed(),st.debug("updateIceServers()")}async restartIce(n){this.assertNotClosed(),st.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:n,streamId:r,encodings:i,codecOptions:o,codec:d}){this.assertNotClosed(),st.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const h=ca.getLocalRtpCapabilities(this._fakeParameters),m=this._getSendExtendedRtpCapabilities(h),g=rp.getSendingRtpParameters(n.kind,m);g.codecs=rp.reduceCodecs(g.codecs,d);const f=g.codecs.some(T=>/.+\/rtx$/i.test(T.mimeType));g.mid=`mid-${bi.generateRandomNumber()}`,g.msid=`${r??"-"} ${n.id}`,i||(i=[{}]);for(const T of i)T.ssrc=bi.generateRandomNumber(),f&&(T.rtx={ssrc:bi.generateRandomNumber()});g.encodings=i,g.rtcp={cname:this._cname,reducedSize:!0,mux:!0},g.msid=`${r??this._defaultSendStreamId} ${n.id}`;const S=this._nextLocalId++;return this._tracks.set(S,n),{localId:String(S),rtpParameters:g}}async stopSending(n){if(st.debug("stopSending() [localId:%s]",n),!this._closed){if(!this._tracks.has(Number(n)))throw new Error("local track not found");this._tracks.delete(Number(n))}}async pauseSending(n){this.assertNotClosed()}async resumeSending(n){this.assertNotClosed()}async replaceTrack(n,r){this.assertNotClosed(),r?st.debug("replaceTrack() [localId:%s, track.id:%s]",n,r.id):st.debug("replaceTrack() [localId:%s, no track]",n),this._tracks.delete(Number(n)),this._tracks.set(Number(n),r)}async setMaxSpatialLayer(n,r){this.assertNotClosed(),st.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",n,r)}async setRtpEncodingParameters(n,r){this.assertNotClosed(),st.debug("setRtpEncodingParameters() [localId:%s, params:%o]",n,r)}async getSenderStats(n){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:d}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),st.debug("sendDataChannel()");const h=new Wv({id:this._nextSctpStreamId++,ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:d}),m={streamId:this._nextSctpStreamId,ordered:n,maxPacketLifeTime:r,maxRetransmits:i};return{dataChannel:h,sctpStreamParameters:m}}async receive(n){this.assertNotClosed();const r=[];for(const i of n){const{trackId:o,kind:d}=i;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),st.debug("receive() [trackId:%s, kind:%s]",o,d);const h=this._nextLocalId++,m=new $k.FakeMediaStreamTrack({kind:d});this._tracks.set(h,m),r.push({localId:String(h),track:m})}return r}async stopReceiving(n){if(!this._closed)for(const r of n)st.debug("stopReceiving() [localId:%s]",r),this._tracks.delete(Number(r))}async pauseReceiving(n){this.assertNotClosed()}async resumeReceiving(n){this.assertNotClosed()}async getReceiverStats(n){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:n,label:r,protocol:i}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),st.debug("receiveDataChannel()"),{dataChannel:new Wv({id:n.streamId,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,label:r,protocol:i})}}async setupTransport({localDtlsRole:n,localSdpObject:r}){const i=bi.clone(this._fakeParameters.generateLocalDtlsParameters());n&&(i.role=n),this.emit("@connectionstatechange","connecting"),await new Promise((o,d)=>this.emit("@connect",{dtlsParameters:i},o,d)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new q_.InvalidStateError("method called in a closed handler")}}fd.FakeHandler=ca;class Wv extends zk.FakeEventTarget{constructor({id:n,ordered:r=!0,maxPacketLifeTime:i=null,maxRetransmits:o=null,label:d="",protocol:h=""}){super();N(this,"_id");N(this,"_negotiated",!0);N(this,"_ordered");N(this,"_maxPacketLifeTime");N(this,"_maxRetransmits");N(this,"_label");N(this,"_protocol");N(this,"_readyState","connecting");N(this,"_bufferedAmount",0);N(this,"_bufferedAmountLowThreshold",0);N(this,"_binaryType","arraybuffer");N(this,"_onopen",null);N(this,"_onclosing",null);N(this,"_onclose",null);N(this,"_onmessage",null);N(this,"_onbufferedamountlow",null);N(this,"_onerror",null);st.debug(`constructor() [id:${n}, ordered:${r}, maxPacketLifeTime:${i}, maxRetransmits:${o}, label:${d}, protocol:${h}`),this._id=n,this._ordered=r,this._maxPacketLifeTime=i,this._maxRetransmits=o,this._label=d,this._protocol=h}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._bufferedAmountLowThreshold=n}get binaryType(){return this._binaryType}set binaryType(n){this._binaryType=n}get onopen(){return this._onopen}set onopen(n){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=n,n&&this.addEventListener("open",n)}get onclosing(){return this._onclosing}set onclosing(n){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=n,n&&this.addEventListener("closing",n)}get onclose(){return this._onclose}set onclose(n){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=n,n&&this.addEventListener("close",n)}get onmessage(){return this._onmessage}set onmessage(n){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=n,n&&this.addEventListener("message",n)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(n){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=n,n&&this.addEventListener("bufferedamountlow",n)}get onerror(){return this._onerror}set onerror(n){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=n,n&&this.addEventListener("error",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(n){if(this._readyState!=="open")throw new q_.InvalidStateError("not open")}}var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});Pn.generateRouterRtpCapabilities=Bk;Pn.generateNativeRtpCapabilities=Vk;Pn.generateNativeSctpCapabilities=Gk;Pn.generateLocalDtlsParameters=Hk;Pn.generateTransportRemoteParameters=Wk;Pn.generateProducerRemoteParameters=Qk;Pn.generateConsumerRemoteParameters=Kk;Pn.generateDataProducerRemoteParameters=Yk;Pn.generateDataConsumerRemoteParameters=Jk;const Rt=Kn;function Kt(){return String(Rt.generateRandomNumber())}function Bk(){return Rt.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function Vk(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function Gk(){return Rt.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function Hk(){return Rt.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function Wk(){return{id:Kt(),iceParameters:Rt.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:Rt.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:Rt.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:Rt.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function Qk(){return Rt.deepFreeze({id:Kt()})}function Kk({id:e,codecMimeType:t}={}){switch(t){case"audio/opus":return{id:e??Kt(),producerId:Kt(),kind:"audio",rtpParameters:Rt.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:e??Kt(),producerId:Kt(),kind:"audio",rtpParameters:Rt.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:e??Kt(),producerId:Kt(),kind:"video",rtpParameters:Rt.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:e??Kt(),producerId:Kt(),kind:"video",rtpParameters:Rt.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${t}'`)}}function Yk(){return Rt.deepFreeze({id:Kt()})}function Jk({id:e}={}){return{id:e??Kt(),dataProducerId:Kt(),sctpStreamParameters:Rt.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}var Qv;function X_(){return Qv||(Qv=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.enhancedEvents=e.ortc=e.parseScalabilityMode=e.detectDeviceAsync=e.detectDevice=e.Device=e.version=e.types=void 0;const t=nd;e.debug=t.default,e.types=j_,e.version="3.18.6";var n=jk();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return n.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return n.detectDevice}}),Object.defineProperty(e,"detectDeviceAsync",{enumerable:!0,get:function(){return n.detectDeviceAsync}});var r=Zr;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=Ue,e.enhancedEvents=xt;var i=fd;Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=Pn}(Xu)),Xu}var qk=X_();const Qc=1e4;function Xk({selfUserId:e,getSelfUserId:t,sendDispatch:n,waitForEvent:r,onRemoteAudioAdded:i,onRemoteAudioRemoved:o,onRemoteVideoAdded:d,onRemoteVideoRemoved:h,onScreenShareStateChange:m}){const g={sessionToken:0,guildId:"",channelId:"",device:null,sendTransport:null,recvTransport:null,localAudioProducer:null,localScreenProducer:null,localStream:null,localScreenStream:null,localScreenTrackEndedHandler:null,consumersByProducerId:new Map,producerOwnerByProducerId:new Map,isMuted:!1,isDeafened:!1,audioOutputDeviceId:"",pendingAudioStartByProducerId:new Map};function f(L){const $=g.pendingAudioStartByProducerId.get(L);$&&($.cleanup(),g.pendingAudioStartByProducerId.delete(L))}function S(L,$){if(!L||!$||g.pendingAudioStartByProducerId.has($))return;const V=()=>{L.paused?L.play().then(()=>{f($)}).catch(()=>{}):f($)},J=["pointerdown","touchstart","keydown","click"];J.forEach(et=>window.addEventListener(et,V,{passive:!0}));const oe=window.setInterval(V,1500);g.pendingAudioStartByProducerId.set($,{cleanup:()=>{window.clearInterval(oe),J.forEach(et=>window.removeEventListener(et,V))}})}function T(L){return L===g.sessionToken&&!!g.channelId}function A(L){m==null||m(!!L)}function G(){return(t==null?void 0:t())||e||""}async function B(L,$,V=Qc){return r({type:L,match:$,timeoutMs:V,guildId:g.guildId,channelId:g.channelId,sessionToken:g.sessionToken})}async function y(L,$=Qc){return r({type:"VOICE_TRANSPORT_CONNECTED",timeoutMs:$,guildId:g.guildId,channelId:g.channelId,sessionToken:g.sessionToken,transportId:L})}async function l(L=Qc){return r({type:"VOICE_ERROR",timeoutMs:L,guildId:g.guildId,channelId:g.channelId,sessionToken:g.sessionToken})}async function p(L,$=Qc){const V=L(),J=l($).then(oe=>{throw new Error(`VOICE_ERROR: ${(oe==null?void 0:oe.error)||"UNKNOWN"}`)});return Promise.race([V,J])}async function v(L,$){await n("VOICE_CREATE_TRANSPORT",{guildId:g.guildId,channelId:g.channelId,direction:L});const V=await B("VOICE_TRANSPORT_CREATED",J=>(J==null?void 0:J.direction)===L);if(!T($))throw new Error("VOICE_SESSION_CANCELLED");return L==="send"?g.device.createSendTransport(V.transport):g.device.createRecvTransport(V.transport)}async function x(L,$,V){if(!L||!g.recvTransport||!g.device||!T(V)||g.consumersByProducerId.has(L))return;await n("VOICE_CONSUME",{guildId:g.guildId,channelId:g.channelId,transportId:g.recvTransport.id,producerId:L,rtpCapabilities:g.device.rtpCapabilities});const J=await p(()=>B("VOICE_CONSUMED",ue=>(ue==null?void 0:ue.producerId)===L));if(!T(V))return;const oe=await g.recvTransport.consume(J),et=new MediaStream([oe.track]);if(oe.kind==="audio"){const ue=document.createElement("audio");ue.autoplay=!0,ue.playsInline=!0,ue.preload="auto",ue.muted=!1,ue.srcObject=et,ue.style.display="none",document.body.appendChild(ue),ue.addEventListener("loadedmetadata",()=>{ue.paused&&ue.play().catch(()=>{S(ue,L)})}),typeof ue.setSinkId=="function"&&g.audioOutputDeviceId&&await ue.setSinkId(g.audioOutputDeviceId).catch(()=>{}),ue.volume=g.isDeafened?0:1,await ue.play().catch(()=>{S(ue,L)}),g.consumersByProducerId.set(L,{consumer:oe,audio:ue,stream:et,kind:"audio",userId:$||""}),$&&g.producerOwnerByProducerId.set(L,$),i==null||i({producerId:L,userId:$,audio:ue});return}g.consumersByProducerId.set(L,{consumer:oe,stream:et,kind:oe.kind,userId:$||""}),$&&g.producerOwnerByProducerId.set(L,$),d==null||d({producerId:L,userId:$,stream:et,kind:oe.kind})}async function j({guildId:L,channelId:$,audioInputDeviceId:V,isMuted:J=!1,isDeafened:oe=!1,audioOutputDeviceId:et=""}){await P(),g.sessionToken+=1;const ue=g.sessionToken;g.guildId=L,g.channelId=$,g.isMuted=!!J,g.isDeafened=!!oe,g.audioOutputDeviceId=et||"",await n("VOICE_JOIN",{guildId:L,channelId:$});const Dn=await r({type:"VOICE_JOINED",match:Qe=>(Qe==null?void 0:Qe.guildId)===L&&(Qe==null?void 0:Qe.channelId)===$,timeoutMs:12e3,guildId:L,channelId:$,sessionToken:ue});if(!T(ue))throw new Error("VOICE_SESSION_CANCELLED");g.device=new qk.Device,await g.device.load({routerRtpCapabilities:Dn.rtpCapabilities}),g.sendTransport=await v("send",ue),g.sendTransport.on("connect",async({dtlsParameters:Qe},rn,Ln)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:g.guildId,channelId:g.channelId,transportId:g.sendTransport.id,dtlsParameters:Qe}),await p(()=>y(g.sendTransport.id)),rn()}catch(Pt){Ln(Pt)}}),g.sendTransport.on("produce",async({kind:Qe,rtpParameters:rn},Ln,Pt)=>{try{await n("VOICE_PRODUCE",{guildId:g.guildId,channelId:g.channelId,transportId:g.sendTransport.id,kind:Qe,rtpParameters:rn});const ts=await p(()=>B("VOICE_PRODUCED",bt=>(bt==null?void 0:bt.guildId)===g.guildId&&(bt==null?void 0:bt.channelId)===g.channelId&&(bt==null?void 0:bt.userId)===G()));Ln({id:ts.producerId})}catch(ts){Pt(ts)}});const tn={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,...V?{deviceId:{exact:V}}:{}};g.localStream=await navigator.mediaDevices.getUserMedia({audio:tn});const nn=g.localStream.getAudioTracks()[0];if(!nn)throw new Error("MIC_TRACK_NOT_FOUND");g.localAudioProducer=await g.sendTransport.produce({track:nn}),g.isMuted&&(g.localAudioProducer.pause(),nn.enabled=!1),g.recvTransport=await v("recv",ue),g.recvTransport.on("connect",async({dtlsParameters:Qe},rn,Ln)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:g.guildId,channelId:g.channelId,transportId:g.recvTransport.id,dtlsParameters:Qe}),await p(()=>y(g.recvTransport.id)),rn()}catch(Pt){Ln(Pt)}});for(const Qe of Dn.producers||[])await x(Qe.producerId,Qe.userId,ue)}async function _(L){const $=g.consumersByProducerId.get(L);if($){g.consumersByProducerId.delete(L),g.producerOwnerByProducerId.delete(L),f(L);try{$.consumer.close()}catch{}if($.audio){try{$.audio.pause(),$.audio.srcObject=null,$.audio.remove()}catch{}o==null||o({producerId:L,userId:$.userId||""});return}h==null||h({producerId:L,userId:$.userId||""})}}function E({stopTracks:L=!1}={}){var $;if(g.localScreenStream){const V=($=g.localScreenStream.getVideoTracks())==null?void 0:$[0];V&&g.localScreenTrackEndedHandler&&V.removeEventListener("ended",g.localScreenTrackEndedHandler),L&&g.localScreenStream.getTracks().forEach(J=>J.stop())}g.localScreenTrackEndedHandler=null,g.localScreenStream=null,g.localScreenProducer=null,A(!1)}async function R({notifyServer:L=!0}={}){if(!g.localScreenProducer){E({stopTracks:!0});return}const $=g.localScreenProducer.id;try{g.localScreenProducer.close()}catch{}E({stopTracks:!0}),!(!L||!$||!g.guildId||!g.channelId)&&await n("VOICE_CLOSE_PRODUCER",{guildId:g.guildId,channelId:g.channelId,producerId:$}).catch(()=>{})}async function M(){var V;if(!g.sendTransport||!g.guildId||!g.channelId)throw new Error("NOT_IN_VOICE_CHANNEL");if(g.localScreenProducer)return;if(!((V=navigator.mediaDevices)!=null&&V.getDisplayMedia))throw new Error("SCREEN_SHARE_NOT_SUPPORTED");const L=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}),$=L.getVideoTracks()[0];if(!$)throw L.getTracks().forEach(J=>J.stop()),new Error("SCREEN_TRACK_NOT_FOUND");try{const J=await g.sendTransport.produce({track:$,appData:{source:"screen"}});g.localScreenProducer=J,g.localScreenStream=L;const oe=()=>{R().catch(()=>{})};g.localScreenTrackEndedHandler=oe,$.addEventListener("ended",oe),A(!0)}catch(J){throw L.getTracks().forEach(oe=>oe.stop()),E({stopTracks:!1}),J}}async function P(){var L,$,V;g.sessionToken+=1;for(const J of[...g.pendingAudioStartByProducerId.keys()])f(J);for(const J of[...g.consumersByProducerId.keys()])await _(J);await R({notifyServer:!1}).catch(()=>{});try{(L=g.localAudioProducer)==null||L.close()}catch{}g.localAudioProducer=null,g.localStream&&(g.localStream.getTracks().forEach(J=>J.stop()),g.localStream=null);try{($=g.sendTransport)==null||$.close()}catch{}g.sendTransport=null;try{(V=g.recvTransport)==null||V.close()}catch{}g.recvTransport=null,g.device=null,g.guildId="",g.channelId=""}async function z(L,$){if(!(!g.channelId||!g.guildId)&&!($!=null&&$.guildId&&$.guildId!==g.guildId)&&!($!=null&&$.channelId&&$.channelId!==g.channelId)&&!(g.localAudioProducer&&$.producerId===g.localAudioProducer.id)&&!(g.localScreenProducer&&$.producerId===g.localScreenProducer.id)){if(L==="VOICE_NEW_PRODUCER"&&($!=null&&$.producerId)){if($.userId&&$.userId===G())return;await x($.producerId,$.userId,g.sessionToken).catch(()=>{});return}if(L==="VOICE_PRODUCER_CLOSED"&&($!=null&&$.producerId)){await _($.producerId);return}L==="VOICE_USER_LEFT"&&($!=null&&$.userId)&&Y($.userId)}}function Y(L){if(!L)return;[...g.producerOwnerByProducerId.entries()].filter(([,V])=>V===L).map(([V])=>V).forEach(V=>{_(V).catch(()=>{})})}function H(L){var V,J;g.isMuted=!!L;const $=(J=(V=g.localStream)==null?void 0:V.getAudioTracks)==null?void 0:J.call(V)[0];g.localAudioProducer&&(g.isMuted?g.localAudioProducer.pause():g.localAudioProducer.resume()),$&&($.enabled=!g.isMuted)}function X(L){g.isDeafened=!!L;for(const{audio:$}of g.consumersByProducerId.values())$&&($.volume=g.isDeafened?0:1)}function ne(L){g.audioOutputDeviceId=L||"";for(const{audio:$}of g.consumersByProducerId.values())$&&typeof $.setSinkId=="function"&&g.audioOutputDeviceId&&$.setSinkId(g.audioOutputDeviceId).catch(()=>{})}function de(){return g.localStream}function F(){return{guildId:g.guildId,channelId:g.channelId}}return{join:j,cleanup:P,handleGatewayDispatch:z,closeConsumersForUser:Y,setMuted:H,setDeafened:X,setAudioOutputDevice:ne,startScreenShare:M,stopScreenShare:R,getLocalStream:de,getContext:F}}function Zk({downloadMenuRef:e,downloadsMenuOpen:t,setDownloadsMenuOpen:n,downloadTargets:r,preferredDownloadTarget:i,onOpenClient:o}){var d;return a.jsxs("div",{className:"landing-page",children:[a.jsxs("header",{className:"landing-header",children:[a.jsx("img",{src:"logo.png",alt:"OpenCom",className:"landing-logo"}),a.jsx("span",{className:"landing-brand",children:"OpenCom"})]}),a.jsxs("main",{className:"landing-main",children:[a.jsxs("section",{className:"landing-hero",children:[a.jsx("h1",{className:"landing-headline",children:"The best way to communicate."}),a.jsx("p",{className:"landing-sub",children:"One place for your servers, friends, and communities. Chat, voice, and stay in sync without the noise."})]}),a.jsxs("section",{className:"landing-features",children:[a.jsxs("div",{className:"landing-feature",children:[a.jsx("span",{className:"landing-feature-icon",children:""}),a.jsx("h3",{children:"Servers and channels"}),a.jsx("p",{children:"Organize conversations by topic. Create spaces that scale from a few friends to large communities."})]}),a.jsxs("div",{className:"landing-feature",children:[a.jsx("span",{className:"landing-feature-icon",children:""}),a.jsx("h3",{children:"Friends and DMs"}),a.jsx("p",{children:"Add friends, send direct messages, and see who is online. Simple and private."})]}),a.jsxs("div",{className:"landing-feature",children:[a.jsx("span",{className:"landing-feature-icon",children:""}),a.jsx("h3",{children:"Voice and presence"}),a.jsx("p",{children:"Jump into voice channels when you need to talk. Status and presence keep everyone in the loop."})]})]}),a.jsxs("section",{className:"landing-cta",children:[a.jsxs("div",{className:"landing-cta-download",ref:e,children:[a.jsx("h3",{children:"Get the desktop app"}),a.jsx("p",{className:"landing-hint",children:"Windows and Linux builds are available."}),a.jsxs("div",{className:"download-wrapper",children:[a.jsx("a",{href:(i==null?void 0:i.href)||((d=r[0])==null?void 0:d.href)||"#",className:"landing-btn landing-btn-secondary",target:"_blank",rel:"noopener noreferrer",children:i?`Download ${i.label}`:"Download"}),a.jsx("button",{type:"button",className:"landing-btn landing-btn-secondary",onClick:()=>n(h=>!h),children:"All downloads"}),t&&a.jsx("div",{className:"download-menu",children:r.map(h=>a.jsx("a",{href:h.href,className:"download-item",target:"_blank",rel:"noopener noreferrer",children:h.label},h.href))})]})]}),a.jsxs("div",{className:"landing-cta-client",children:[a.jsx("h3",{children:"Use OpenCom now"}),a.jsx("p",{className:"landing-hint",children:"Open the client in your browser. No install required."}),a.jsx("button",{type:"button",className:"landing-btn landing-btn-primary",onClick:o,children:"Open client"})]})]})]}),a.jsx("footer",{className:"landing-footer",children:a.jsx("p",{children:"OpenCom. One place for teams, communities, and friends."})})]})}function e1({authMode:e,setAuthMode:t,email:n,setEmail:r,username:i,setUsername:o,password:d,setPassword:h,pendingVerificationEmail:m,status:g,onSubmit:f,onResendVerification:S,onBackHome:T}){return a.jsx("div",{className:"auth-shell",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("button",{type:"button",className:"link-btn auth-back",onClick:T,children:"Back to home"}),a.jsx("h1",{children:"Welcome back"}),a.jsx("p",{className:"sub",children:"OpenCom keeps your teams, communities, and updates in one place."}),a.jsxs("form",{onSubmit:f,children:[a.jsxs("label",{children:["Email",a.jsx("input",{value:n,onChange:A=>r(A.target.value),type:"email",required:!0})]}),e==="register"&&a.jsxs("label",{children:["Username",a.jsx("input",{value:i,onChange:A=>o(A.target.value),required:!0})]}),a.jsxs("label",{children:["Password",a.jsx("input",{value:d,onChange:A=>h(A.target.value),type:"password",required:!0})]}),a.jsx("button",{type:"submit",children:e==="login"?"Log in":"Create account"})]}),a.jsx("button",{className:"link-btn",onClick:()=>t(e==="login"?"register":"login"),children:e==="login"?"Need an account? Register":"Have an account? Login"}),e==="login"&&a.jsx("button",{type:"button",className:"link-btn",onClick:S,children:"Resend verification email"}),m&&e==="login"&&a.jsxs("p",{className:"sub",children:["Pending verification: ",m]}),a.jsx("p",{className:"status",children:g})]})})}const sp="https://openapi.donskyblock.xyz".replace(/\/$/,""),af=[{href:`${sp}/downloads/OpenCom.exe`,label:"Windows (.exe)"},{href:`${sp}/downloads/OpenCom.deb`,label:"Linux (.deb)"},{href:`${sp}/downloads/OpenCom.tar.gz`,label:"Linux (.tar.gz)"}];function t1(e=af){return typeof navigator>"u"?e[0]||null:`${navigator.platform||""} ${navigator.userAgent||""}`.toLowerCase().includes("win")?e.find(n=>n.label.toLowerCase().includes("windows"))||e[0]||null:e.find(n=>n.label.toLowerCase().includes(".deb"))||e[0]||null}const pr="/",_s="/login",cr="/app",ip=/^[a-zA-Z0-9_-]{3,32}$/,n1=/^[a-zA-Z0-9_-]{8,96}$/;function r1(e=""){return/^\/join\/[a-zA-Z0-9_-]{3,32}\/?$/.test(e||"")}function s1(e=""){return/^\/gift\/[a-zA-Z0-9_-]{8,96}\/?$/.test(e||"")}function i1(){return typeof window>"u"?!1:new URLSearchParams(window.location.search||"").get("desktop")==="1"}function hh(e=""){const t=e.replace(/\/+$/,"")||pr;return t===_s?_s:t===cr?cr:pr}function o1(){if(typeof window>"u")return pr;const t=(new URLSearchParams(window.location.search||"").get("route")||"").trim();return t.startsWith("/")?t:window.location.pathname||pr}function Kc(){const e=hh(o1());return i1()&&e===pr?cr:e}function a1(e,{replace:t=!1}={}){if(typeof window>"u")return;const n=hh(e),r=window.location.hash||"";if(window.location.protocol==="file:"){const o=new URLSearchParams(window.location.search||"");n===pr?o.delete("route"):o.set("route",n);const d=`${window.location.pathname}${o.toString()?`?${o}`:""}${r}`;window.history[t?"replaceState":"pushState"]({},"",d);return}const i=`${n}${r}`;window.history[t?"replaceState":"pushState"]({},"",i)}function hl(e=""){const t=(e||"").trim();if(!t)return"";if(ip.test(t))return t;const n=t.match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(n!=null&&n[1])return n[1];try{const r=new URL(t),i=(r.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(i!=null&&i[1])return i[1];const o=r.searchParams.get("join");if(o&&ip.test(o))return o;for(const h of r.searchParams.keys())if(/^join[a-zA-Z0-9_-]{3,32}$/.test(h))return h;const d=(r.hash||"").replace(/^#/,"");if(d.startsWith("join=")){const h=decodeURIComponent(d.slice(5));if(ip.test(h))return h}}catch{return""}return""}function c1(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);return e!=null&&e[1]?e[1]:hl(window.location.href||"")}function cf(e=""){const t=(e||"").trim();if(!t)return"";if(n1.test(t))return t;const n=t.match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);if(n!=null&&n[1])return n[1];try{const i=(new URL(t).pathname||"").match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);if(i!=null&&i[1])return i[1]}catch{return""}return""}function l1(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/gift\/([a-zA-Z0-9_-]{8,96})\/?$/);return e!=null&&e[1]?e[1]:cf(window.location.href||"")}function op(e){return typeof window>"u"?"":`${window.location.origin}/join/${encodeURIComponent(e)}`}function Kv(e){return typeof window>"u"?"":`${window.location.origin}/gift/${encodeURIComponent(e)}`}function d1(){const e="https://openapi.donskyblock.xyz".trim();let t="";if(typeof window<"u"){const r=new URLSearchParams(window.location.search||"");t=String(r.get("coreApi")||"").trim()}const n=t||e||"https://api.opencom.online";try{const r=new URL(n);return r.protocol!=="http:"&&r.protocol!=="https:"?"https://api.opencom.online":r.toString().replace(/\/$/,"")}catch{return"https://api.opencom.online"}}const Yt=d1();function xn(e){return!e||typeof e!="string"?null:e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("users/")?`${Yt.replace(/\/$/,"")}/v1/profile-images/${e}`:e.startsWith("/users/")?`${Yt.replace(/\/$/,"")}/v1/profile-images${e}`:e.startsWith("/")?`${Yt.replace(/\/$/,"")}${e}`:e}const Yv="opencom_custom_theme_css",Jv="opencom_custom_theme_enabled",qv="opencom_self_status",Xv="opencom_pinned_server_messages",Zv="opencom_pinned_dm_messages",ap="opencom_active_dm",ey="opencom_gateway_device_id",ty="opencom_mic_gain",ny="opencom_mic_sensitivity",ry="opencom_audio_input_device",sy="opencom_audio_output_device",u1="opencom_server_voice_gateway_prefs",iy="opencom_last_core_gateway",oy="opencom_last_server_gateway",ml="wss://ws.opencom.online/gateway",p1="opencom_debug_voice",ay="opencom_client_extensions_enabled",cy="opencom_client_extensions_dev_mode",ly="opencom_client_extensions_dev_urls",la="opencom_access_token",da="opencom_refresh_token",cp="opencom_pending_invite_code",lp="opencom_pending_invite_auto_join",dy={smile:"",grin:"",joy:"",rofl:"",wink:"",heart:"",thumbs_up:"",fire:"",tada:"",eyes:"",thinking:"",sob:""},Ei={MANAGE_CHANNELS:1n<<2n,MANAGE_ROLES:1n<<3n,KICK_MEMBERS:1n<<4n,BAN_MEMBERS:1n<<5n,ADMINISTRATOR:1n<<60n};function f1(e){try{return typeof e=="bigint"?e:typeof e=="number"?BigInt(e):typeof e=="string"&&e.trim()?BigInt(e.trim()):0n}catch{return 0n}}function h1(){const e="".trim()==="1",t=typeof window<"u"&&localStorage.getItem(p1)==="1";return e||t}function m1(e=""){try{const t=e.split(".");if(t.length!==3)return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(n);return JSON.parse(r)}catch{return null}}async function lf(){const e=localStorage.getItem(da)||"";if(!e)return null;const t=await fetch(`${Yt}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return null;const n=await t.json().catch(()=>null),r=n==null?void 0:n.accessToken;return r?(localStorage.setItem(la,r),n!=null&&n.refreshToken&&localStorage.setItem(da,n.refreshToken),typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-access-token-refresh",{detail:{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}})),{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}):null}async function g1(e,t){if(!t)return null;const n=localStorage.getItem(la)||"";if(!n)return null;const r=m1(t),i=(r==null?void 0:r.core_server_id)||(r==null?void 0:r.server_id);if(!i)return null;const o=await fetch(`${Yt}/v1/servers/${encodeURIComponent(i)}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)return null;const d=await o.json().catch(()=>null),h=d==null?void 0:d.membershipToken;return h?(typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-membership-token-refresh",{detail:{serverId:i,membershipToken:h}})),h):null}function v1(e,t){return eS(e,t)}function mh(e){if(!e||typeof e!="string")return"";const t=e.trim();if(!t)return"";if(typeof window<"u"&&window.location.protocol==="file:"&&(t.startsWith("/")||!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(t)))return ml;try{const n=new URL(t,window.location.origin);return n.protocol!=="ws:"&&n.protocol!=="wss:"&&(n.protocol=n.protocol==="http:"?"ws:":"wss:"),n.pathname="/gateway",n.search="",n.hash="",n.toString().replace(/\/$/,"")}catch{const n=t.replace(/\/$/,"");return n.endsWith("/gateway")?n:`${n}/gateway`}}function y1(){if(typeof window>"u"||window.location.protocol==="file:")return ml;const e=window.location.hostname||"";return e==="opencom.online"||e.endsWith(".opencom.online")?ml:mh("/gateway")}function Z_(){const e=[];return(n=>{const r=mh(n);r&&(e.includes(r)||e.push(r))})(y1()),e}function df(){return typeof window>"u"?null:window.opencomDesktopBridge||null}async function ki(e,t=""){const n=df();if(n!=null&&n.prompt)try{return await n.prompt(e,t,"OpenCom")}catch{}return typeof window>"u"||typeof window.prompt!="function"?null:window.prompt(e,t)}function w1(e,t=!1){const n=[],r=o=>{const d=mh(o);d&&(n.includes(d)||n.push(d))};for(const o of Z_())r(o);return(t||"".trim()==="1")&&r(e),n}function eS(e,t){const n=localStorage.getItem(t);if(!n)return e;const r=e.indexOf(n);return r<=0?e:[e[r],...e.slice(0,r),...e.slice(r+1)]}function _1(){const[e,t]=b.useState(localStorage.getItem(Yv)||""),[n,r]=b.useState(localStorage.getItem(Jv)!=="0");return b.useEffect(()=>{let i=document.getElementById("opencom-theme-style");i||(i=document.createElement("style"),i.id="opencom-theme-style",document.head.appendChild(i)),i.textContent=n?e:"",localStorage.setItem(Yv,e),localStorage.setItem(Jv,n?"1":"0")},[e,n]),[e,t,n,r]}function uy(e=[],t,n,r=null,i=null){const o=[];for(const d of e){const h=t(d),m=r?r(d):h,g=i?i(d):null,f=n(d),S=f?new Date(f):null,T=S&&!Number.isNaN(S.getTime())?S.getTime():null,A=o[o.length-1];if(A&&A.authorId===m&&T!==null&&A.lastMessageMs!==null&&T-A.lastMessageMs<=12e4){A.messages.push(d),A.lastMessageMs=T;continue}o.push({id:d.id,author:h,authorId:m,pfpUrl:g,firstMessageTime:f,lastMessageMs:T,messages:[d]})}return o}async function se(e,t={}){const n=t.__retried===!0,r={...t};delete r.__retried;const i=await fetch(`${Yt}${e}`,{headers:{"Content-Type":"application/json",...r.headers||{}},...r});if(!i.ok){if(i.status===401&&!n&&e!=="/v1/auth/refresh"){const h=await lf().catch(()=>null);if(h!=null&&h.accessToken){const m={...r.headers||{},Authorization:`Bearer ${h.accessToken}`};return se(e,{...r,headers:m,__retried:!0})}}const o=await i.json().catch(()=>({})),d=new Error(o.error||`HTTP_${i.status}`);throw d.status=i.status,d}return i.json()}async function ce(e,t,n,r={}){const i=r.__retried===!0,o={...r};delete o.__retried;const d=o.body!==void 0&&o.body!==null,h=await fetch(`${e}${t}`,{headers:{...d?{"Content-Type":"application/json"}:{},Authorization:`Bearer ${n}`,...o.headers||{}},...o});if(!h.ok){if(h.status===401&&!i){const g=await g1(e,n).catch(()=>null);if(g)return ce(e,t,g,{...o,__retried:!0})}const m=await h.json().catch(()=>({}));throw new Error(m.error||`HTTP_${h.status}`)}return h.json()}function Ti(e,t){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function py(e){const t=Ti(e,[]);return Array.isArray(t)?t.filter(n=>typeof n=="string"&&n.trim()):[]}function Nr(e=""){const t=e.trim();if(!t)return"OC";const n=t.split(/\s+/).filter(Boolean);return n.length===1?n[0].slice(0,2).toUpperCase():`${n[0][0]||""}${n[1][0]||""}`.toUpperCase()}function dp(e=""){const t=e.match(/(?:^|\s)(@\{?)([^\s{}@]*)$/);if(!t)return null;const n=t[1]||"@",r=t[2]||"",i=e.length-n.length-r.length;return{query:r.toLowerCase(),start:i}}function S1(e=""){const t=e.trimStart();return t.startsWith("/")?(t.slice(1).split(/\s+/)[0]||"").toLowerCase():null}function C1(e=""){const t=[],n=/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|(\S+)/g;let r=n.exec(e);for(;r;)t.push((r[1]??r[2]??r[3]??"").replace(/\\(["'\\])/g,"$1")),r=n.exec(e);return t}function x1(e,t){if(t==="number"){const n=Number(e);if(Number.isNaN(n))throw new Error(`Invalid number: ${e}`);return n}if(t==="boolean"){const n=String(e).toLowerCase();if(["true","1","yes","on"].includes(n))return!0;if(["false","0","no","off"].includes(n))return!1;throw new Error(`Invalid boolean: ${e}`)}return e}function fy(e){if(!e)return"just now";const t=new Date(e);return Number.isNaN(t.getTime())?"just now":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function hy(e=null){var t,n,r,i,o,d,h,m;return{name:(e==null?void 0:e.name)||"",details:(e==null?void 0:e.details)||"",state:(e==null?void 0:e.state)||"",largeImageUrl:(e==null?void 0:e.largeImageUrl)||"",largeImageText:(e==null?void 0:e.largeImageText)||"",smallImageUrl:(e==null?void 0:e.smallImageUrl)||"",smallImageText:(e==null?void 0:e.smallImageText)||"",button1Label:((n=(t=e==null?void 0:e.buttons)==null?void 0:t[0])==null?void 0:n.label)||"",button1Url:((i=(r=e==null?void 0:e.buttons)==null?void 0:r[0])==null?void 0:i.url)||"",button2Label:((d=(o=e==null?void 0:e.buttons)==null?void 0:o[1])==null?void 0:d.label)||"",button2Url:((m=(h=e==null?void 0:e.buttons)==null?void 0:h[1])==null?void 0:m.url)||""}}function b1(e){const t=[];return e.button1Label.trim()&&e.button1Url.trim()&&t.push({label:e.button1Label.trim(),url:e.button1Url.trim()}),e.button2Label.trim()&&e.button2Url.trim()&&t.push({label:e.button2Label.trim(),url:e.button2Url.trim()}),{name:e.name.trim()||void 0,details:e.details.trim()||void 0,state:e.state.trim()||void 0,largeImageUrl:e.largeImageUrl.trim()||void 0,largeImageText:e.largeImageText.trim()||void 0,smallImageUrl:e.smallImageUrl.trim()||void 0,smallImageText:e.smallImageText.trim()||void 0,buttons:t.length?t:void 0}}function my(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function gy(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function E1(e=!1){if(!e)try{const t=new window.AudioContext,n=t.createOscillator(),r=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.value=523.25,r.type="sine",r.frequency.value=659.25,i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.12,t.currentTime+.04),i.gain.linearRampToValueAtTime(0,t.currentTime+.22),n.connect(i),r.connect(i),i.connect(t.destination),n.start(),r.start(),n.stop(t.currentTime+.22),r.stop(t.currentTime+.22),n.onended=()=>{r.onended=()=>t.close()}}catch{}}function k1(e=""){return e?e==="image/png"?".png":e==="image/jpeg"?".jpg":e==="image/gif"?".gif":e==="image/webp"?".webp":e==="image/svg+xml"?".svg":e==="image/bmp"?".bmp":e==="image/heic"?".heic":e==="video/mp4"?".mp4":e==="video/webm"?".webm":e==="application/pdf"?".pdf":".bin":".bin"}function T1(e,t="upload"){if(!e)return null;if(e.name&&e.name.trim())return e;const n=k1(e.type||""),r=`${t}-${Date.now()}${n}`;try{return new File([e],r,{type:e.type||"application/octet-stream"})}catch{return e}}function jr(e=""){const t=String(e||"").trim();return t?/^https?:\/\//i.test(t)||/^data:image\//i.test(t)||t.startsWith("/")?t:t.startsWith("users/")?`/v1/profile-images/${t}`:t:""}function vy(e=""){const t=String(e||"");if(!t)return[];const n=/https?:\/\/[^\s<>"'`)\]]+/gi,r=new Set;let i=n.exec(t);for(;i;){const o=String(i[0]||"").trim();o&&r.add(o),i=n.exec(t)}return[...r]}function R1(){var og,ag,cg,lg,dg;const e=h1(),t=(s,c={})=>{e&&console.debug(`[voice-debug] ${s}`,c)},n=localStorage.getItem(ap)||"",[r,i]=b.useState(localStorage.getItem(la)||""),[o,d]=b.useState(localStorage.getItem(da)||""),[h,m]=b.useState("login"),[g,f]=b.useState(""),[S,T]=b.useState(""),[A,G]=b.useState(""),[B,y]=b.useState(""),[l,p]=b.useState(null),[v,x]=b.useState("servers"),[j,_]=b.useState(""),[E,R]=b.useState([]),[M,P]=b.useState([]),[z,Y]=b.useState(""),[H,X]=b.useState(""),[ne,de]=b.useState(""),[F,L]=b.useState(null),[$,V]=b.useState([]),[J,oe]=b.useState(""),[et,ue]=b.useState(!1),[Dn,tn]=b.useState(""),[nn,Qe]=b.useState(""),[rn,Ln]=b.useState([]),[Pt,ts]=b.useState(()=>{try{return sessionStorage.getItem(cp)||""}catch{return""}}),[bt,yd]=b.useState(()=>{try{return sessionStorage.getItem(lp)==="1"}catch{return!1}}),[vn,Ma]=b.useState([]),[wd,tS]=b.useState(""),[vh,yh]=b.useState(""),[ns,co]=b.useState("online"),[ut,Yn]=b.useState([]),[ve,Jn]=b.useState(n),[Oa,_d]=b.useState(""),[he,lo]=b.useState(null),[qn,wr]=b.useState({displayName:"",bio:"",pfpUrl:"",bannerUrl:""}),[sn,Et]=b.useState({name:"",details:"",state:"",largeImageUrl:"",largeImageText:"",smallImageUrl:"",smallImageText:"",button1Label:"",button1Url:"",button2Label:"",button2Url:""}),[Hs,rs]=b.useState({name:"",logoUrl:"",bannerUrl:""}),[Ws,Sd]=b.useState(""),[Qs,Cd]=b.useState("https://"),[Ks,uo]=b.useState(""),[xd,po]=b.useState(""),[bd,wh]=b.useState(""),[Aa,nS]=b.useState(""),[_h,rS]=b.useState(""),[Ed,Sh]=b.useState(""),[kd,sS]=b.useState(!1),[_r,fo]=b.useState(""),[Mn,$a]=b.useState(null),[Td,Ch]=b.useState(""),[Ua,iS]=b.useState("text"),[xh,bh]=b.useState(""),[ho,Eh]=b.useState(""),[Fa,Rd]=b.useState({incoming:[],outgoing:[]}),[I1,oS]=b.useState(!0),[aS,cS]=b.useState({}),[kh,za]=b.useState({guildId:"",channelId:""}),[Id,Th]=b.useState(!1),[Rh,Nd]=b.useState(!1),[ss,Ih]=b.useState(!1),[is,Nh]=b.useState(!1),[Ba,lS]=b.useState(Number(localStorage.getItem(ty)||100)),[Ys,dS]=b.useState(Number(localStorage.getItem(ny)||50)),[Xn,jh]=b.useState(localStorage.getItem(ry)||""),[Sr,Ph]=b.useState(localStorage.getItem(sy)||""),[uS,pS]=b.useState([]),[fS,hS]=b.useState([]),[yn,mS]=b.useState(localStorage.getItem(qv)||"online"),[Dh,Lh]=b.useState(!1),[os,jd]=b.useState(""),[Cr,mo]=b.useState(""),[Pd,go]=b.useState(""),[Va,gS]=b.useState(Ti(Xv,{})),[Ga,vS]=b.useState(Ti(Zv,{})),[Dd,Mh]=b.useState(""),[Ld,yS]=b.useState(""),[Md,wS]=b.useState(""),[vo,Oh]=b.useState(""),[Ah,_S]=b.useState(""),[Od,$h]=b.useState(""),[Js,qs]=b.useState(!1),[Ha,SS]=b.useState({x:26,y:26}),[Uh,Fh]=b.useState(!1),[as,zt]=b.useState(!1),[Ee,Ve]=b.useState("profile"),[qe,CS]=b.useState(null),[xS,zh]=b.useState(!1),[Wa,Qa]=b.useState(null),[Ad,Ka]=b.useState(""),[yo,$d]=b.useState(null),[Xs,Zs]=b.useState(null),[Bh,Vh]=b.useState(!1),[Gh,Hh]=b.useState(!1),[Wh,Qh]=b.useState(!1),[Kh,bS]=b.useState([]),[wo,Yh]=b.useState({}),[_o,Jh]=b.useState({}),[ES,ei]=b.useState(!1),[ti,Ud]=b.useState("create"),[on,pt]=b.useState(null),[ft,an]=b.useState(null),[Bt,Vt]=b.useState(null),[cs,wn]=b.useState(null),[ls,_n]=b.useState(null),[So,Fd]=b.useState(null),[qh,zd]=b.useState({}),[pe,ds]=b.useState(null),[us,Bd]=b.useState({}),Vd=b.useRef(new Set),[kS,Xh,TS,RS]=_1(),[N1,IS]=b.useState([]),[j1,P1]=b.useState({current:"",new:"",confirm:""}),[NS,Gd]=b.useState(!1),[Zh,Hd]=b.useState(""),[Ya,Wd]=b.useState(""),[em,Qd]=b.useState(""),[jS,D1]=b.useState([{id:"current",device:"Current Device",location:"Your Location",lastActive:"Now",status:"active"}]),[tm,L1]=b.useState({date:new Date().toISOString(),device:"Current Device",location:"Your Location"}),[PS,Kd]=b.useState(""),[nm,DS]=b.useState(""),[rm,Ja]=b.useState([]),[sm,Yd]=b.useState(""),[LS,Jd]=b.useState(!1),[im,qa]=b.useState(!1),[om,am]=b.useState({twoFactorEnabled:!1}),[Xa,qd]=b.useState(null),[Za,Xd]=b.useState(null),[ec,cm]=b.useState(""),[tc,ni]=b.useState({}),[ps,lm]=b.useState(Kc),[MS,Zd]=b.useState(!1),[nc,rc]=b.useState(!1),[sc,ri]=b.useState(!1),[Co,eu]=b.useState(null),[fs,tu]=b.useState({}),[dm,nu]=b.useState({}),[um,ic]=b.useState({}),[pm,OS]=b.useState(Ti(u1,{})),[fm,AS]=b.useState({}),[hm,ru]=b.useState([]),[xo,$S]=b.useState(py(ay)),[si,US]=b.useState(localStorage.getItem(cy)==="1"),[bo,mm]=b.useState(py(ly)),[gm,vm]=b.useState(""),[oc,su]=b.useState({}),[ac,iu]=b.useState([]),[ym,cc]=b.useState(0),lc=b.useRef(null),ht=b.useRef(null),cn=b.useRef(null),Ge=b.useRef(null),kt=b.useRef(null),Gt=b.useRef(!1),Eo=b.useRef([]),ou=b.useRef({audioCtx:null,stream:null,analyser:null,timer:null,lastSpeaking:!1}),Zn=b.useRef(new Map),wm=b.useRef("");wm.current=(l==null?void 0:l.id)||"";const Ht=b.useRef(null);Ht.current||(Ht.current=Xk({getSelfUserId:()=>wm.current,sendDispatch:(s,c)=>Ec(s,c),waitForEvent:JC,onRemoteVideoAdded:({producerId:s,userId:c,stream:u})=>{!s||!u||ic(w=>({...w,[s]:{producerId:s,userId:c||"",stream:u}}))},onRemoteVideoRemoved:({producerId:s})=>{s&&ic(c=>{if(!c[s])return c;const u={...c};return delete u[s],u})},onScreenShareStateChange:s=>{Nd(!!s)}}));const au=b.useRef(yn);au.current=yn;function ln(s){var u;if(!s)return"offline";if(s===(l==null?void 0:l.id))return yn;const c=String(((u=tc[s])==null?void 0:u.status)??"offline").toLowerCase();return c==="invisible"?"offline":c}function FS(s){var c;return s?((c=tc[s])==null?void 0:c.richPresence)??null:null}const zS={online:"Online",idle:"Idle",dnd:"Do Not Disturb",offline:"Offline",invisible:"Invisible"};function ko(s){return zS[s]||s||"Offline"}function BS(s){const c=String(s||"offline").toLowerCase();return c==="online"?"presence-online":c==="idle"?"presence-idle":c==="dnd"?"presence-dnd":"presence-offline"}function ii({userId:s,username:c,pfpUrl:u,size:w=28}){const C=ln(s),I=String(s||c||"?").charCodeAt(0)||0;return a.jsxs("div",{className:"avatar-with-presence",style:{width:`${w}px`,height:`${w}px`},children:[u?a.jsx("img",{src:xn(u),alt:c,className:"avatar-presence-image"}):a.jsx("div",{className:"avatar-presence-fallback",style:{background:`hsl(${Math.abs(I*7)%360}, 70%, 60%)`},children:String(c||"?").substring(0,1).toUpperCase()}),a.jsx("span",{className:`presence-indicator-dot ${BS(C)}`})]})}const To=b.useRef(null),Ro=b.useRef(null),oi=b.useRef(null),_m=b.useRef(null),dc=b.useRef(!0),cu=b.useRef(0),lu=b.useRef(new Set),uc=b.useRef(new Set),du=b.useRef({}),pc=b.useRef(""),Sm=b.useRef(""),xr=b.useRef(""),fc=b.useRef(""),uu=b.useRef({x:0,y:0}),pu=b.useRef(null),VS=b.useMemo(()=>t1(af),[]),Cm=b.useRef(new Set),fu=b.useRef(!1),GS=b.useRef([]),xm=b.useRef([]),hs=(l==null?void 0:l.id)||"anonymous";function er(s,{replace:c=!1}={}){a1(s,{replace:c}),lm(Kc())}b.useEffect(()=>{xm.current=E},[E]),b.useEffect(()=>{du.current=_o||{}},[_o]),b.useEffect(()=>{const s=()=>lm(Kc());return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),b.useEffect(()=>{if(typeof window>"u"||window.location.protocol==="file:"||r1(window.location.pathname||"")||s1(window.location.pathname||""))return;const s=hh(window.location.pathname||"");s!==(window.location.pathname||"")&&er(s,{replace:!0})},[]),b.useEffect(()=>{r&&ps!==cr&&er(cr,{replace:!0})},[r,ps]),b.useEffect(()=>{!r||!as||Ee!=="billing"||(Po().catch(()=>{}),ui().catch(()=>{}))},[r,as,Ee]),b.useEffect(()=>{r||ps===cr&&er(_s,{replace:!0})},[r,ps]),b.useEffect(()=>{function s(u){pu.current&&!pu.current.contains(u.target)&&Zd(!1)}function c(u){u.key==="Escape"&&Zd(!1)}return document.addEventListener("mousedown",s),document.addEventListener("keydown",c),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",c)}},[]),b.useEffect(()=>{localStorage.setItem(ay,JSON.stringify(xo))},[xo]),b.useEffect(()=>{try{Pt?sessionStorage.setItem(cp,Pt):sessionStorage.removeItem(cp)}catch{}},[Pt]),b.useEffect(()=>{try{bt?sessionStorage.setItem(lp,"1"):sessionStorage.removeItem(lp)}catch{}},[bt]),b.useEffect(()=>{localStorage.setItem(cy,si?"1":"0")},[si]),b.useEffect(()=>{localStorage.setItem(ly,JSON.stringify(bo))},[bo]),b.useEffect(()=>{const s=E.find(c=>c.id===z);if(!s){rs({name:"",logoUrl:"",bannerUrl:""});return}rs({name:s.name||"",logoUrl:s.logoUrl||"",bannerUrl:s.bannerUrl||""})},[z,E]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){ru([]);return}se("/v1/extensions/catalog",{headers:{Authorization:`Bearer ${r}`}}).then(s=>ru(s.clientExtensions||[])).catch(()=>ru([]))},[r,l==null?void 0:l.id]),b.useEffect(()=>{const s=E.find(c=>c.id===z)||null;if(!r||!s){iu([]);return}ce(s.baseUrl,"/v1/extensions/commands",s.membershipToken).then(c=>iu(Array.isArray(c.commands)?c.commands:[])).catch(()=>iu([]))},[r,z,E]),b.useEffect(()=>{if(!r||E.length===0)return;let s=!1;const c=async()=>{try{const w=xm.current||[],C=await Promise.all(w.map(async I=>{try{const O=await se(`/v1/servers/${I.id}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});return{id:I.id,membershipToken:O.membershipToken}}catch{return null}}));if(s)return;const k=new Map(C.filter(Boolean).map(I=>[I.id,I.membershipToken]));k.size&&R(I=>I.map(O=>{const U=k.get(O.id);return U?{...O,membershipToken:U}:O}))}catch{}};c();const u=window.setInterval(c,8*60*1e3);return()=>{s=!0,window.clearInterval(u)}},[r,E.length]),b.useEffect(()=>{if(!o)return;let s=!1;const c=async()=>{const w=await lf().catch(()=>null);s||w!=null&&w.accessToken||(_("Session expired. Please sign in again."),i(""),d(""))},u=window.setInterval(c,10*60*1e3);return()=>{s=!0,window.clearInterval(u)}},[o]),b.useEffect(()=>{cc(0)},[J,ac]);async function HS({extensionId:s,extensionName:c,devUrl:u}){if(u){const C=await fetch(u);if(!C.ok)throw new Error(`HTTP_${C.status}`);return C.text()}const w=await fetch(`${Yt}/v1/extensions/client/${encodeURIComponent(s)}/source`,{headers:{Authorization:`Bearer ${r}`}});if(!w.ok)throw new Error(`HTTP_${w.status}`);return w.text()}async function WS({extensionId:s,extensionName:c,devUrl:u}){const w=await HS({extensionId:s,extensionName:c,devUrl:u}),C=new Blob([w],{type:"application/javascript"}),k=URL.createObjectURL(C);try{const I=await import(k),O=(I==null?void 0:I.activateClient)||(I==null?void 0:I.default);if(typeof O!="function")throw new Error("Missing activateClient export");const U={registerPanel:W=>{GS.current.push(W)},coreApi:(W,K={})=>se(W,{...K,headers:{Authorization:`Bearer ${r}`,...K.headers||{}}}),getSelf:()=>l,setStatus:_};await Promise.resolve(O(U))}finally{URL.revokeObjectURL(k)}}b.useEffect(()=>{if(!r)return;[...xo.map(c=>({id:c,extensionId:c,extensionName:c,devUrl:null})),...si?bo.map((c,u)=>({id:`dev:${c}`,extensionId:`dev-extension-${u+1}`,extensionName:`Developer Extension ${u+1}`,devUrl:c})):[]].forEach(c=>{Cm.current.has(c.id)||(Cm.current.add(c.id),su(u=>({...u,[c.id]:"loading"})),WS(c).then(()=>su(u=>({...u,[c.id]:"loaded"}))).catch(u=>su(w=>({...w,[c.id]:`error:${u.message}`}))))})},[r,xo,si,bo,l]);function QS(s,c){$S(u=>c?u.includes(s)?u:[...u,s]:u.filter(w=>w!==s))}function KS(){const s=gm.trim();s&&(mm(c=>c.includes(s)?c:[...c,s]),vm(""))}b.useEffect(()=>{if(!r)return;const s=new Set;((F==null?void 0:F.members)||[]).forEach(u=>u.id&&s.add(u.id)),$.forEach(u=>{const w=u.author_id||u.authorId;w&&s.add(w)}),l!=null&&l.id&&s.add(l.id);const c=[...s].filter(u=>!us[u]&&!Vd.current.has(u));c.length!==0&&(c.forEach(u=>Vd.current.add(u)),Promise.all(c.map(u=>fetch(`${Yt}/v1/users/${u}/profile`,{headers:{Authorization:`Bearer ${r}`}}).then(w=>w.ok?w.json():null).catch(()=>null))).then(u=>{c.forEach(w=>Vd.current.delete(w)),Bd(w=>{const C={...w};return c.forEach((k,I)=>{const O=u[I];O&&(O.username!=null||O.displayName!=null||O.pfpUrl!=null)&&(C[k]={username:O.username??O.displayName??k,displayName:O.displayName??O.username??k,pfpUrl:O.pfpUrl??null})}),C})}))},[r,F==null?void 0:F.members,$,l==null?void 0:l.id]),b.useEffect(()=>{!(l!=null&&l.id)||!he||Bd(s=>({...s,[l.id]:{username:he.username??l.username??l.id,displayName:he.displayName??he.username??l.username??l.id,pfpUrl:he.pfpUrl??null}}))},[l==null?void 0:l.id,l==null?void 0:l.username,he==null?void 0:he.username,he==null?void 0:he.displayName,he==null?void 0:he.pfpUrl]);const D=b.useMemo(()=>E.find(s=>s.id===z)||null,[E,z]),tr=b.useMemo(()=>M.find(s=>s.id===H)||null,[M,H]),Dt=b.useMemo(()=>{var s;return H||(tr==null?void 0:tr.id)||((s=F==null?void 0:F.guild)==null?void 0:s.id)||(D==null?void 0:D.defaultGuildId)||""},[H,tr==null?void 0:tr.id,(og=F==null?void 0:F.guild)==null?void 0:og.id,D==null?void 0:D.defaultGuildId]),Lt=kh.channelId,He=kh.guildId,br=!!Lt,ai=(F==null?void 0:F.channels)||[],bm=b.useMemo(()=>{if(!Lt)return"";const s=ai.find(c=>c.id===Lt);return(s==null?void 0:s.name)||Lt},[ai,Lt]),ci=b.useMemo(()=>ai.find(s=>s.id===ne)||null,[ai,ne]),Pe=b.useMemo(()=>ut.find(s=>s.id===ve)||null,[ut,ve]),hu=b.useMemo(()=>{var w;const s=(F==null?void 0:F.roles)||[],c=new Set(((w=F==null?void 0:F.me)==null?void 0:w.roleIds)||[]);let u=0n;for(const C of s)C&&(C.is_everyone||c.has(C.id))&&(u|=f1(C.permissions));return u},[F==null?void 0:F.roles,(ag=F==null?void 0:F.me)==null?void 0:ag.roleIds]),ms=b.useMemo(()=>s=>(hu&Ei.ADMINISTRATOR)===Ei.ADMINISTRATOR?!0:(hu&s)===s,[hu]),ke=b.useMemo(()=>D?(D.roles||[]).includes("owner")||(D.roles||[]).includes("platform_admin")||ms(Ei.MANAGE_CHANNELS)||ms(Ei.MANAGE_ROLES):!1,[D,ms]),Io=b.useMemo(()=>D?(D.roles||[]).includes("owner")||(D.roles||[]).includes("platform_admin")||ms(Ei.KICK_MEMBERS):!1,[D,ms]),Er=b.useMemo(()=>D?(D.roles||[]).includes("owner")||(D.roles||[]).includes("platform_admin")||ms(Ei.BAN_MEMBERS):!1,[D,ms]),mu=Io||Er,li=b.useMemo(()=>[...ai||[]].filter(Boolean).sort((s,c)=>(s.position??0)-(c.position??0)),[ai]),No=b.useMemo(()=>li.filter(s=>s&&s.type==="category"),[li]),Em=b.useMemo(()=>{const s=new Map;for(const c of(F==null?void 0:F.emotes)||[]){const u=String((c==null?void 0:c.name)||"").toLowerCase();u&&s.set(u,c)}return s},[F==null?void 0:F.emotes]),hc=b.useMemo(()=>{const s=wd.trim().toLowerCase();return s?vn.filter(c=>c.username.toLowerCase().includes(s)||c.id.includes(s)):vn},[wd,vn]),km=b.useMemo(()=>{var u;const s=(F==null?void 0:F.members)||[];if(s.length)return s;const c=new Map;for(const w of $){const C=w.author_id||w.authorId;!C||c.has(C)||c.set(C,{id:C,username:w.username||C,status:"offline",pfp_url:w.pfp_url||null,roleIds:[]})}return l!=null&&l.id&&!c.has(l.id)&&c.set(l.id,{id:l.id,username:l.username||l.id,status:"offline",pfp_url:(he==null?void 0:he.pfpUrl)||null,roleIds:((u=F==null?void 0:F.me)==null?void 0:u.roleIds)||[]}),Array.from(c.values())},[F,$,l,he]),mt=b.useMemo(()=>km.map(s=>{var c,u,w;return{...s,username:((c=us[s.id])==null?void 0:c.displayName)||((u=us[s.id])==null?void 0:u.username)||s.username,pfp_url:((w=us[s.id])==null?void 0:w.pfpUrl)??s.pfp_url}}),[km,us]),mc=b.useMemo(()=>{const s=dp(J);if(!s||v!=="servers")return[];const c=["everyone",...mt.map(w=>w.username||"")].map(w=>w.trim()).filter(Boolean),u=Array.from(new Set(c));return s.query?u.filter(w=>w.toLowerCase().startsWith(s.query)).slice(0,8):u.slice(0,8)},[J,v,mt]),di=b.useMemo(()=>v!=="servers"?null:S1(J),[J,v]),Sn=b.useMemo(()=>{if(di==null)return[];const s=[...ac].sort((c,u)=>c.name.localeCompare(u.name));return di?s.filter(c=>c.name.toLowerCase().includes(di)).slice(0,10):s.slice(0,10)},[di,ac]),gc=di!=null,YS=b.useMemo(()=>{const s=new Map;for(const c of mt)c!=null&&c.id&&(s.set(String(c.id).toLowerCase(),c),c.username&&s.set(String(c.username).toLowerCase(),c));return s},[mt]),jo=b.useMemo(()=>new Map(mt.map(s=>[s.id,s.username])),[mt]),kr=b.useMemo(()=>{const s=(F==null?void 0:F.voiceStates)||[];if(!H)return s;const c=fs[H]||{};if(!Object.keys(c).length)return s;const u=new Map(s.map(w=>[w.userId,w]));for(const[w,C]of Object.entries(c))C!=null&&C.channelId?u.set(w,{userId:w,channelId:C.channelId,muted:!!C.muted,deafened:!!C.deafened}):u.delete(w);return Array.from(u.values())},[F==null?void 0:F.voiceStates,fs,H]),gu=b.useMemo(()=>{var c;if(!(l!=null&&l.id)||!He||!Lt)return!1;const s=(c=fs[He])==null?void 0:c[l.id];if(s!=null&&s.channelId)return s.channelId===Lt;if(H===He){const u=kr.find(w=>w.userId===l.id);return(u==null?void 0:u.channelId)===Lt}return!1},[l==null?void 0:l.id,He,Lt,fs,H,kr]),vc=b.useMemo(()=>{var c;const s=new Map;for(const u of kr)!(u!=null&&u.channelId)||!(u!=null&&u.userId)||(s.has(u.channelId)||s.set(u.channelId,[]),s.get(u.channelId).push({userId:u.userId,username:jo.get(u.userId)||u.userId,pfp_url:((c=mt.find(w=>w.id===u.userId))==null?void 0:c.pfp_url)||null,muted:!!u.muted,deafened:!!u.deafened}));return s},[kr,jo,mt]),Tm=b.useMemo(()=>Object.values(um),[um]),Rm=b.useMemo(()=>{const s=No.map(u=>({category:u,channels:li.filter(w=>w.parent_id===u.id&&w.type!=="category")})),c=li.filter(u=>!u.parent_id&&u.type!=="category");return[...s,...c.length?[{category:{id:"uncategorized",name:"Channels"},channels:c}]:[]]},[No,li]),JS=b.useMemo(()=>uy($,s=>{const c=s.author_id||s.authorId;return jo.get(c)||c||"Unknown"},s=>s.created_at||s.createdAt,s=>s.author_id||s.authorId||"unknown",s=>{var u;const c=s.author_id||s.authorId;return((u=us[c])==null?void 0:u.pfpUrl)??s.pfp_url??null}),[$,jo,us]),qS=b.useMemo(()=>uy((Pe==null?void 0:Pe.messages)||[],s=>s.author||"Unknown",s=>s.createdAt,s=>s.authorId||"unknown",s=>s.pfp_url||null),[Pe]),yc=b.useMemo(()=>Va[ne]||[],[Va,ne]),wc=b.useMemo(()=>Ga[ve]||[],[Ga,ve]),Im=b.useMemo(()=>{if(!z)return{mode:"core",customUrl:""};const s=pm[z]||{};return{mode:s.mode==="server"?"server":"core",customUrl:typeof s.customUrl=="string"?s.customUrl:""}},[z,pm]);async function Nm(s=r){var I;if(!s)return;const[c,u,w,C]=await Promise.all([se("/v1/social/friends",{headers:{Authorization:`Bearer ${s}`}}),se("/v1/social/dms",{headers:{Authorization:`Bearer ${s}`}}),se("/v1/social/requests",{headers:{Authorization:`Bearer ${s}`}}),se("/v1/social/settings",{headers:{Authorization:`Bearer ${s}`}})]);Ma(c.friends||[]);let k=[];if(Yn(O=>{const U=new Map(O.map(W=>[W.id,W]));return k=(u.dms||[]).map(W=>{var K;return{...W,messages:((K=U.get(W.id))==null?void 0:K.messages)||[]}}),k}),!k.some(O=>O.id===ve)){const O=k.find(W=>W.messages&&W.messages.length>0),U=(O==null?void 0:O.id)||((I=k[0])==null?void 0:I.id)||"";U&&(Jn(U),localStorage.setItem(ap,U))}Rd({incoming:w.incoming||[],outgoing:w.outgoing||[]}),oS(C.allowFriendRequests!==!1)}b.useEffect(()=>{r?localStorage.setItem(la,r):localStorage.removeItem(la)},[r]),b.useEffect(()=>{let s=!1;const c=df();if(!(c!=null&&c.getSession)){fu.current=!0;return}return c.getSession().then(u=>{if(s||!u)return;const w=typeof u.accessToken=="string"?u.accessToken:"",C=typeof u.refreshToken=="string"?u.refreshToken:"";w&&!r&&i(w),C&&!o&&d(C)}).catch(()=>{}).finally(()=>{fu.current=!0}),()=>{s=!0}},[]),b.useEffect(()=>{var s,c;try{(c=(s=window.opencomDesktopBridge)==null?void 0:s.setPresenceAuth)==null||c.call(s,{accessToken:r||"",coreApi:Yt})}catch{}},[r]),b.useEffect(()=>{r||!o||lf().then(s=>{s!=null&&s.accessToken&&(i(s.accessToken),s.refreshToken&&d(s.refreshToken))}).catch(()=>{})},[r,o]);const jm=b.useMemo(()=>{var s;return JSON.stringify((l!=null&&l.id?(s=tc[l.id])==null?void 0:s.richPresence:null)||null)},[l==null?void 0:l.id,tc]);b.useEffect(()=>{if(!(l!=null&&l.id))return;let s=null;try{s=JSON.parse(jm)}catch{}Et(hy(s))},[l==null?void 0:l.id,jm]),b.useEffect(()=>{o?localStorage.setItem(da,o):localStorage.removeItem(da)},[o]),b.useEffect(()=>{const s=df();s!=null&&s.setSession&&fu.current&&s.setSession({accessToken:r||"",refreshToken:o||""}).catch(()=>{})},[r,o]),b.useEffect(()=>{const s=u=>{var k,I;const w=((k=u==null?void 0:u.detail)==null?void 0:k.accessToken)||"",C=((I=u==null?void 0:u.detail)==null?void 0:I.refreshToken)||"";w&&i(w),C&&d(C)},c=u=>{var k,I;const w=(k=u==null?void 0:u.detail)==null?void 0:k.serverId,C=(I=u==null?void 0:u.detail)==null?void 0:I.membershipToken;!w||!C||R(O=>O.map(U=>U.id===w?{...U,membershipToken:C}:U))};return window.addEventListener("opencom-access-token-refresh",s),window.addEventListener("opencom-membership-token-refresh",c),()=>{window.removeEventListener("opencom-access-token-refresh",s),window.removeEventListener("opencom-membership-token-refresh",c)}},[]),b.useEffect(()=>{var u;if(r)return;const s=Ti(`opencom_friends_${hs}`,[]),c=Ti(`opencom_dms_${hs}`,[]);Ma(s),Yn(c),c.some(w=>w.id===ve)||Jn(((u=c[0])==null?void 0:u.id)||"")},[hs,r]),b.useEffect(()=>{localStorage.setItem(`opencom_friends_${hs}`,JSON.stringify(vn))},[vn,hs]),b.useEffect(()=>{localStorage.setItem(`opencom_dms_${hs}`,JSON.stringify(ut))},[ut,hs]),b.useEffect(()=>{if(!j)return;const s=window.setTimeout(()=>_(""),4500);return()=>window.clearTimeout(s)},[j]),b.useEffect(()=>{localStorage.setItem(qv,yn)},[yn]),b.useEffect(()=>{localStorage.setItem(Xv,JSON.stringify(Va))},[Va]),b.useEffect(()=>{localStorage.setItem(Zv,JSON.stringify(Ga))},[Ga]),b.useEffect(()=>{ve&&localStorage.setItem(ap,ve)},[ve]),b.useEffect(()=>{if(!Uh)return;const s=u=>{const w=Math.max(8,Math.min(window.innerWidth-340,u.clientX-uu.current.x)),C=Math.max(8,Math.min(window.innerHeight-280,u.clientY-uu.current.y));SS({x:w,y:C})},c=()=>Fh(!1);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",c),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",c)}},[Uh]),b.useEffect(()=>{const s=()=>{pt(null),an(null),Vt(null),wn(null),_n(null),as||ds(null)},c=u=>{u.key==="Escape"&&(pt(null),an(null),Vt(null),wn(null),_n(null),ds(null),zt(!1))};return window.addEventListener("click",s),window.addEventListener("keydown",c),()=>{window.removeEventListener("click",s),window.removeEventListener("keydown",c)}},[as]),b.useEffect(()=>{!lc.current||v!=="servers"||lc.current.scrollTo({top:lc.current.scrollHeight,behavior:"smooth"})},[$,v]),b.useEffect(()=>{var k,I;if(!To.current||v!=="dms")return;const s=To.current;if(ve!==Sm.current){Sm.current=ve,cu.current=((k=Pe==null?void 0:Pe.messages)==null?void 0:k.length)||0,s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),dc.current=!0;return}const u=s.scrollHeight-s.scrollTop-s.clientHeight<100,w=((I=Pe==null?void 0:Pe.messages)==null?void 0:I.length)||0,C=w>cu.current;C&&u?(s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),dc.current=!0):C&&(dc.current=!1),cu.current=w},[Pe==null?void 0:Pe.messages,ve,v]),b.useEffect(()=>{if(!To.current||v!=="dms")return;const s=To.current,c=()=>{const u=s.scrollHeight-s.scrollTop-s.clientHeight<100;dc.current=u};return s.addEventListener("scroll",c),()=>s.removeEventListener("scroll",c)},[v,ve]),b.useEffect(()=>{if(!r)return;async function s(){try{const c=await se("/v1/me",{headers:{Authorization:`Bearer ${r}`}});p(c);const[u,w]=await Promise.all([se(`/v1/users/${c.id}/profile`,{headers:{Authorization:`Bearer ${r}`}}),se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})]),C=w.servers||[];lo(u),wr({displayName:u.displayName||"",bio:u.bio||"",pfpUrl:u.pfpUrl||"",bannerUrl:u.bannerUrl||""}),R(C);try{await Nm(r)}catch{}if(!C.length){Y(""),X(""),L(null),V([]);return}C.some(k=>k.id===z)||Y(C[0].id)}catch(c){const u=String((c==null?void 0:c.message)||"");if(u.includes("UNAUTHORIZED")||u.includes("HTTP_401")||u.includes("INVALID_REFRESH")||u.includes("REFRESH_")){i(""),d(""),R([]),L(null),V([]),_("Session expired. Please sign in again.");return}_(`Session error: ${c.message}`)}}s()},[r]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){rc(!1),ht.current&&(ht.current.close(),ht.current=null),cn.current&&(clearInterval(cn.current),cn.current=null);return}let s=localStorage.getItem(ey);s||(s="web-"+Math.random().toString(36).slice(2)+"-"+Date.now(),localStorage.setItem(ey,s));let c=!1,u=!1,w=!1,C=null,k=0,I=0;const O=eS(Z_(),iy),U=()=>{if(c)return;const K=Math.min(5e3,300*2**Math.min(I,4));I+=1,C=setTimeout(W,K)},W=()=>{if(c||u||!O.length)return;const K=O[k%O.length];k+=1;const q=new WebSocket(K);ht.current=q,q.onopen=()=>{q.send(JSON.stringify({op:"IDENTIFY",d:{accessToken:r,deviceId:s}}))},q.onmessage=te=>{var ye,Z,ae,De,_e,Fe,tt,dn,Tr;try{const ge=JSON.parse(te.data);if(ge.op==="HELLO"&&((ye=ge.d)!=null&&ye.heartbeat_interval)&&(cn.current&&clearInterval(cn.current),cn.current=setInterval(()=>{var gt;((gt=ht.current)==null?void 0:gt.readyState)===WebSocket.OPEN&&ht.current.send(JSON.stringify({op:"HEARTBEAT"}))},ge.d.heartbeat_interval)),ge.op==="READY"&&(u=!0,w=!0,I=0,rc(!0),localStorage.setItem(iy,K),_(""),((Z=ht.current)==null?void 0:Z.readyState)===WebSocket.OPEN&&ht.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:yn,customStatus:null}}))),ge.op==="DISPATCH"&&ge.t==="PRESENCE_SYNC_REQUEST"&&((ae=ht.current)==null?void 0:ae.readyState)===WebSocket.OPEN&&ht.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:au.current,customStatus:null}})),ge.op==="DISPATCH"&&ge.t==="PRESENCE_UPDATE"&&((De=ge.d)!=null&&De.userId)&&ni(gt=>({...gt,[ge.d.userId]:{status:ge.d.status??"offline",customStatus:ge.d.customStatus??null,richPresence:ge.d.richPresence??null}})),ge.op==="DISPATCH"&&ge.t==="SOCIAL_DM_MESSAGE_CREATE"&&((_e=ge.d)!=null&&_e.threadId)&&((tt=(Fe=ge.d)==null?void 0:Fe.message)!=null&&tt.id)){const gt=ge.d.threadId,Te=ge.d.message;Yn(On=>{const vt=[...On],Rr=vt.findIndex(An=>An.id===gt),Tc=(An=[])=>An.some(ie=>ie.id===Te.id);if(Rr>=0){const An=vt[Rr];return Tc(An.messages||[])?On:(vt[Rr]={...An,messages:[...An.messages||[],Te]},vt)}return[{id:gt,participantId:Te.authorId===(l==null?void 0:l.id)?"unknown":Te.authorId,name:Te.authorId===(l==null?void 0:l.id)?"Unknown":Te.author||"Unknown",messages:[Te]},...vt]}),Te.authorId&&Te.authorId!==(l==null?void 0:l.id)&&(E1(au.current==="dnd"),eu({dmId:gt,at:Date.now()}))}if(ge.op==="DISPATCH"&&ge.t==="SOCIAL_DM_MESSAGE_DELETE"&&((dn=ge.d)!=null&&dn.threadId)&&((Tr=ge.d)!=null&&Tr.messageId)){const gt=ge.d.threadId,Te=ge.d.messageId;Yn(On=>On.map(vt=>vt.id===gt?{...vt,messages:(vt.messages||[]).filter(Rr=>Rr.id!==Te)}:vt))}}catch{}},q.onclose=()=>{c||(rc(!1),ht.current=null,cn.current&&(clearInterval(cn.current),cn.current=null),u=!1,_u("VOICE_GATEWAY_CLOSED"),U(),_(w?"Gateway disconnected. Reconnecting...":"Gateway websocket unavailable. Check DNS/TLS or set VITE_CORE_GATEWAY_URL."))},q.onerror=()=>{}};return W(),()=>{c=!0,C&&clearTimeout(C),rc(!1),cn.current&&clearInterval(cn.current),cn.current=null,ht.current&&ht.current.close(),ht.current=null}},[r,l==null?void 0:l.id]),b.useEffect(()=>{var s;!r||!(l!=null&&l.id)||((s=ht.current)==null?void 0:s.readyState)!==WebSocket.OPEN||ht.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:yn,customStatus:null}}))},[yn,r,l==null?void 0:l.id]),b.useEffect(()=>{const s=D;if(!(s!=null&&s.baseUrl)||!(s!=null&&s.membershipToken)){if(Eo.current=[],Gt.current=!1,ri(!1),kt.current&&(clearInterval(kt.current),kt.current=null),Ge.current){try{Ge.current.close()}catch{}Ge.current=null}return}if(fm[s.id]){if(Eo.current=[],Gt.current=!1,ri(!1),kt.current&&(clearInterval(kt.current),kt.current=null),Ge.current){try{Ge.current.close()}catch{}Ge.current=null}return}const c=v1(w1(s.baseUrl,!0),oy);if(Eo.current=c,!c.length){ri(!1);return}let u=!1,w=!1,C=!1,k=null,I=0,O=0,U=null;const W=Z=>{var Fe;const ae=Z.channels||[];if(L(Z),ae.some(tt=>tt.id===xr.current&&tt.type==="text"))return;const _e=((Fe=ae.find(tt=>tt.type==="text"))==null?void 0:Fe.id)||"";de(_e)},K=()=>{const Z=fc.current;Z&&ce(s.baseUrl,`/v1/guilds/${Z}/state`,s.membershipToken).then(ae=>{u||W(ae)}).catch(()=>{})},q=(Z=150)=>{U&&clearTimeout(U),U=setTimeout(K,Z)},te=()=>{if(u)return;const Z=Math.min(5e3,300*2**Math.min(O,4));O+=1,k=setTimeout(ye,Z)},ye=()=>{if(u||!c.length)return;const Z=c[I%c.length];I+=1;const ae=new WebSocket(Z);Ge.current=ae,ae.onopen=()=>{_(""),ae.send(JSON.stringify({op:"IDENTIFY",d:{membershipToken:s.membershipToken}}))},ae.onmessage=De=>{var _e,Fe,tt,dn,Tr,ge,gt,Te,On,vt,Rr,Tc,An;try{const ie=JSON.parse(De.data);if(qC(ie),ie.op==="HELLO"&&((_e=ie.d)!=null&&_e.heartbeat_interval)){kt.current&&clearInterval(kt.current),kt.current=setInterval(()=>{var Re;((Re=Ge.current)==null?void 0:Re.readyState)===WebSocket.OPEN&&Ge.current.send(JSON.stringify({op:"HEARTBEAT"}))},ie.d.heartbeat_interval);return}if(ie.op==="READY"){w=!0,C=!0,O=0,Gt.current=!0,ri(!0),localStorage.setItem(oy,Z),fc.current&&ae.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:fc.current}})),xr.current&&ae.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:xr.current}}));return}if(ie.op==="ERROR"&&((Fe=ie.d)!=null&&Fe.error)){if(typeof ie.d.error=="string"&&ie.d.error.startsWith("VOICE_UPSTREAM_UNAVAILABLE")&&(s!=null&&s.id)){AS(Re=>Re[s.id]?Re:{...Re,[s.id]:!0}),_("Realtime voice gateway unavailable for this server. Falling back to REST voice controls.");try{ae.close()}catch{}return}_(`Voice gateway error: ${ie.d.error}`);return}if(ie.op==="DISPATCH"&&typeof ie.t=="string"){if(ie.t==="MESSAGE_CREATE"){const Re=((tt=ie.d)==null?void 0:tt.channelId)||"",xe=((dn=ie.d)==null?void 0:dn.message)||null,Mt=((Tr=ie.d)==null?void 0:Tr.messageDelete)||null;Re&&(Mt!=null&&Mt.id)&&Re===xr.current&&V(nt=>nt.filter($n=>$n.id!==Mt.id)),Re&&xe&&Re===xr.current?V(nt=>{if(nt.some(cx=>cx.id===xe.id))return nt;const $n={id:xe.id,author_id:xe.authorId,authorId:xe.authorId,content:xe.content||"",embeds:xe.embeds||[],linkEmbeds:xe.linkEmbeds||[],attachments:xe.attachments||[],mentionEveryone:!!xe.mentionEveryone,mentions:xe.mentions||[],created_at:xe.createdAt,createdAt:xe.createdAt};return[...nt,$n]}):Re&&xe&&(s!=null&&s.id)&&zd(nt=>({...nt,[s.id]:(nt[s.id]||0)+1}));return}if(ie.t==="MESSAGE_MENTION"&&(s!=null&&s.id)){const Re=((ge=ie.d)==null?void 0:ge.channelId)||"";(!xr.current||Re!==xr.current)&&zd(xe=>({...xe,[s.id]:(xe[s.id]||0)+1}));return}if(ie.t==="VOICE_STATE_UPDATE"&&((gt=ie.d)!=null&&gt.guildId)&&((Te=ie.d)!=null&&Te.userId)){const Re=ie.d.guildId,xe=ie.d.userId,Mt=ie.d.channelId||null;tu(nt=>{const $n={...nt[Re]||{}};return Mt?$n[xe]={guildId:Re,channelId:Mt,userId:xe,muted:!!ie.d.muted,deafened:!!ie.d.deafened}:delete $n[xe],{...nt,[Re]:$n}})}else if(ie.t==="VOICE_STATE_REMOVE"&&((On=ie.d)!=null&&On.guildId)&&((vt=ie.d)!=null&&vt.userId)){const Re=ie.d.guildId,xe=ie.d.userId;tu(Mt=>{var $n;if(!(($n=Mt[Re])!=null&&$n[xe]))return Mt;const nt={...Mt[Re]||{}};return delete nt[xe],{...Mt,[Re]:nt}})}else if(ie.t==="VOICE_SPEAKING"&&((Rr=ie.d)!=null&&Rr.guildId)&&((Tc=ie.d)!=null&&Tc.userId)){const Re=ie.d.guildId,xe=ie.d.userId,Mt=!!ie.d.speaking;nu(nt=>({...nt,[Re]:{...nt[Re]||{},[xe]:Mt}}))}(ie.t==="CHANNEL_CREATE"||ie.t==="CHANNEL_UPDATE"||ie.t==="CHANNEL_DELETE"||ie.t==="CHANNEL_REORDER"||ie.t==="ROLE_CREATE"||ie.t==="ROLE_UPDATE"||ie.t==="ROLE_DELETE"||ie.t==="CHANNEL_OVERWRITE_UPDATE"||ie.t==="CHANNEL_OVERWRITE_DELETE"||ie.t==="CHANNEL_SYNC_PERMISSIONS"||ie.t==="GUILD_MEMBER_UPDATE"||ie.t==="GUILD_MEMBER_KICK"||ie.t==="GUILD_MEMBER_BAN")&&q(),(An=Ht.current)==null||An.handleGatewayDispatch(ie.t,ie.d).catch(()=>{})}}catch{}},ae.onclose=()=>{u||(Gt.current=!1,kt.current&&(clearInterval(kt.current),kt.current=null),Ge.current=null,ri(!1),w=!1,_u("VOICE_GATEWAY_CLOSED"),te(),_(C?"Server voice gateway disconnected. Reconnecting...":"Voice gateway unavailable. Check core gateway/proxy configuration."))},ae.onerror=()=>{}};return ye(),()=>{if(u=!0,k&&clearTimeout(k),U&&clearTimeout(U),Gt.current=!1,ri(!1),kt.current&&(clearInterval(kt.current),kt.current=null),Ge.current){try{Ge.current.close()}catch{}Ge.current=null}}},[D==null?void 0:D.id,D==null?void 0:D.baseUrl,D==null?void 0:D.membershipToken,fm]),b.useEffect(()=>{if(!H||!ne)return;const s=Ge.current;!s||s.readyState!==WebSocket.OPEN||!Gt.current||(s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:H}})),s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:ne}})))},[H,ne]),b.useEffect(()=>{var c;if(v!=="servers"||!H||!((c=F==null?void 0:F.channels)!=null&&c.length))return;const s=Ge.current;if(!(!s||s.readyState!==WebSocket.OPEN||!Gt.current))for(const u of F.channels)!(u!=null&&u.id)||u.type!=="text"||s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:u.id}}))},[v,H,F==null?void 0:F.channels]),b.useEffect(()=>{z&&zd(s=>{if(!s[z])return s;const c={...s};return delete c[z],c})},[z]),b.useEffect(()=>{if(!r)return;const s=new Set;((F==null?void 0:F.members)||[]).forEach(w=>w.id&&s.add(w.id)),(vn||[]).forEach(w=>w.id&&s.add(w.id));const c=[...s];if(c.length===0)return;const u=new URLSearchParams({userIds:c.join(",")});fetch(`${Yt}/v1/presence?${u}`,{headers:{Authorization:`Bearer ${r}`}}).then(w=>w.ok?w.json():{}).then(w=>{w&&typeof w=="object"&&ni(C=>({...C,...w}))}).catch(()=>{})},[r,F==null?void 0:F.members,vn]),b.useEffect(()=>{const s=c1(),c=hl(s||Pt||"");if(c){if(_r!==c&&fo(c),Pt!==c&&ts(c),s&&!bt&&yd(!0),!r){s&&(_("Log in to join this server invite."),er(_s,{replace:!0}));return}bt&&pc.current!==c&&(pc.current=c,yd(!1),Cc(c).catch(()=>{}).finally(()=>{pc.current===c&&(pc.current="")}),ps!==cr&&er(cr,{replace:!0}))}},[r,Pt,bt,_r,ps]),b.useEffect(()=>{const s=l1();if(!s)return;Ka(s),r&&Am(s),er(r?cr:_s,{replace:!0})},[r]),b.useEffect(()=>{var u;if(!r)return;const s=[...$||[],...((u=ut.find(w=>w.id===ve))==null?void 0:u.messages)||[]],c=new Set;for(const w of s){for(const C of vy((w==null?void 0:w.content)||""))c.add(C);if(Array.isArray(w==null?void 0:w.linkEmbeds))for(const C of w.linkEmbeds)C!=null&&C.url&&c.add(C.url)}for(const w of c)wo[w]===void 0&&(lu.current.has(w)||(lu.current.add(w),se(`/v1/link-preview?url=${encodeURIComponent(w)}`,{headers:{Authorization:`Bearer ${r}`}}).then(C=>{Yh(k=>({...k,[w]:C||null}))}).catch(()=>{Yh(C=>({...C,[w]:null}))}).finally(()=>{lu.current.delete(w)})))},[r,$,ut,ve,wo]),b.useEffect(()=>{if(!(D!=null&&D.baseUrl)||!(D!=null&&D.membershipToken))return;const s=[];for(const c of $||[])for(const u of(c==null?void 0:c.attachments)||[])!(u!=null&&u.id)||!bu(u.contentType)||_o[u.id]||uc.current.has(u.id)||s.push(u);for(const c of s){uc.current.add(c.id);const u=String(c.url||""),w=u.startsWith("http")?u:`${D.baseUrl}${u.startsWith("/")?"":"/"}${u}`;fetch(w,{headers:{Authorization:`Bearer ${D.membershipToken}`}}).then(C=>C.ok?C.blob():null).then(C=>{if(!C||!bu(C.type||c.contentType||""))return;const k=URL.createObjectURL(C);Jh(I=>{const O=I[c.id];return O&&URL.revokeObjectURL(k),O?I:{...I,[c.id]:k}})}).catch(()=>{}).finally(()=>{uc.current.delete(c.id)})}},[$,D==null?void 0:D.baseUrl,D==null?void 0:D.membershipToken,_o]),b.useEffect(()=>{const s=du.current||{};Object.values(s).forEach(c=>{try{URL.revokeObjectURL(c)}catch{}}),uc.current.clear(),Jh({})},[z]),b.useEffect(()=>()=>{const s=du.current||{};Object.values(s).forEach(c=>{try{URL.revokeObjectURL(c)}catch{}})},[]),b.useEffect(()=>{if(v!=="servers"||!D){P([]),v!=="servers"&&(L(null),V([]));return}ce(D.baseUrl,"/v1/guilds",D.membershipToken).then(s=>{const c=s||[];if(P(c),!c.length){X(""),L(null);return}c.some(w=>w.id===H)||X(c[0].id)}).catch(s=>{P([]),L(null),_(`Workspace list failed: ${s.message}`)})},[D,H,v]),b.useEffect(()=>{if(v!=="servers"||!D||!H)return;let s=!1;const c=()=>ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken).then(w=>{var O;if(s)return;const C=w.channels||[];if(L(w),C.some(U=>U.id===ne&&U.type==="text"))return;const I=((O=C.find(U=>U.type==="text"))==null?void 0:O.id)||"";de(I)}).catch(w=>{s||(L(null),de(""),V([]),_(`Workspace state failed: ${w.message}`))});c();const u=sc?null:window.setInterval(c,3e3);return()=>{s=!0,u&&window.clearInterval(u)}},[D,H,v,ne,sc]),b.useEffect(()=>{v!=="dms"||!ve||!r||se(`/v1/social/dms/${ve}/messages`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{const c=s.messages||[];Yn(u=>u.map(w=>w.id===ve?{...w,messages:c}:w))}).catch(()=>{})},[ve,v,r]),b.useEffect(()=>{if(v==="dms"){if(!ut.length){Jn("");return}(!ve||!ut.some(s=>s.id===ve))&&Jn(ut[0].id)}},[v,ut,ve]),b.useEffect(()=>{if(!Co)return;const s=setTimeout(()=>eu(null),4e3);return()=>clearTimeout(s)},[Co]),b.useEffect(()=>{var u,w,C;const s=br&&gu&&!!He&&!!Gt.current&&((u=Ge.current)==null?void 0:u.readyState)===WebSocket.OPEN;if(!br||!gu||!He||ss||is||!((w=navigator.mediaDevices)!=null&&w.getUserMedia)||!s){const k=ou.current;k.timer&&clearInterval(k.timer),k.timer=null,k.stream&&k.stream!==((C=Ht.current)==null?void 0:C.getLocalStream())&&k.stream.getTracks().forEach(I=>I.stop()),k.stream=null,k.audioCtx&&k.audioCtx.close().catch(()=>{}),k.audioCtx=null,k.analyser=null,k.lastSpeaking=!1,He&&(l!=null&&l.id)&&nu(I=>({...I,[He]:{...I[He]||{},[l.id]:!1}})),br&&He&&s&&Ec("VOICE_SPEAKING",{guildId:He,channelId:Lt,speaking:!1}).catch(()=>{});return}let c=!1;return(async()=>{var k;try{const I=((k=Ht.current)==null?void 0:k.getLocalStream())||await navigator.mediaDevices.getUserMedia({audio:Xn?{deviceId:{exact:Xn}}:!0});if(c){I.getTracks().forEach(te=>te.stop());return}const O=new window.AudioContext,U=O.createMediaStreamSource(I),W=O.createAnalyser();W.fftSize=1024,U.connect(W);const K=ou.current;K.stream=I,K.audioCtx=O,K.analyser=W,K.lastSpeaking=!1;const q=new Uint8Array(W.fftSize);K.timer=setInterval(()=>{var De;W.getByteTimeDomainData(q);let te=0;for(let _e=0;_e<q.length;_e+=1){const Fe=(q[_e]-128)/128;te+=Fe*Fe}const ye=Math.sqrt(te/q.length),Z=.01+(100-Math.max(0,Math.min(100,Ys)))/100*.03,ae=ye>Z;ae!==K.lastSpeaking&&(K.lastSpeaking=ae,He&&(l!=null&&l.id)&&nu(_e=>({..._e,[He]:{..._e[He]||{},[l.id]:ae}})),br&&He&&Gt.current&&((De=Ge.current)==null?void 0:De.readyState)===WebSocket.OPEN&&Ec("VOICE_SPEAKING",{guildId:He,channelId:Lt,speaking:ae}).catch(()=>{}))},150)}catch{_("Mic speaking detection unavailable. Check microphone permissions.")}})(),()=>{var I;c=!0;const k=ou.current;k.timer&&clearInterval(k.timer),k.timer=null,k.stream&&k.stream!==((I=Ht.current)==null?void 0:I.getLocalStream())&&k.stream.getTracks().forEach(O=>O.stop()),k.stream=null,k.audioCtx&&k.audioCtx.close().catch(()=>{}),k.audioCtx=null,k.analyser=null,k.lastSpeaking=!1}},[br,gu,He,Lt,ss,is,Ys,Xn,l==null?void 0:l.id]),b.useEffect(()=>{localStorage.setItem(ty,String(Ba))},[Ba]),b.useEffect(()=>{localStorage.setItem(ny,String(Ys))},[Ys]),b.useEffect(()=>{localStorage.setItem(ry,Xn||"")},[Xn]),b.useEffect(()=>{localStorage.setItem(sy,Sr||"")},[Sr]),b.useEffect(()=>{var s;(s=Ht.current)==null||s.setMuted(ss)},[ss]),b.useEffect(()=>{var s;(s=Ht.current)==null||s.setDeafened(is)},[is]),b.useEffect(()=>{var s;(s=Ht.current)==null||s.setAudioOutputDevice(Sr)},[Sr]),b.useEffect(()=>{var u;if(Ee!=="voice"||!as||!((u=navigator.mediaDevices)!=null&&u.enumerateDevices))return;let s=!1;return(async()=>{var w,C;try{try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch{}const k=await navigator.mediaDevices.enumerateDevices();if(s)return;const I=k.filter(U=>U.kind==="audioinput"),O=k.filter(U=>U.kind==="audiooutput");pS(I),hS(O),!Xn&&((w=I[0])!=null&&w.deviceId)&&jh(I[0].deviceId),!Sr&&((C=O[0])!=null&&C.deviceId)&&Ph(O[0].deviceId)}catch{s||_("Could not load audio devices. Check browser permissions.")}})(),()=>{s=!0}},[Ee,as,Xn,Sr]),b.useEffect(()=>{if(!(l!=null&&l.id))return;let s="",c="";for(const[u,w]of Object.entries(fs||{})){const C=w==null?void 0:w[l.id];if(C!=null&&C.channelId){s=u,c=C.channelId;break}}if(!c){const u=kr.find(w=>w.userId===l.id);u!=null&&u.channelId&&(s=H||He||"",c=u.channelId)}za(u=>c?u.guildId===s&&u.channelId===c?u:{guildId:s,channelId:c}:u.guildId&&u.guildId!==H||!u.guildId&&!u.channelId?u:{guildId:"",channelId:""})},[kr,fs,l==null?void 0:l.id,H,He]),b.useEffect(()=>{!r||v!=="friends"&&v!=="dms"||Nm(r).catch(()=>{})},[r,v]),xr.current=ne,fc.current=H,b.useEffect(()=>{if(v!=="servers"||!D||!ne){v!=="servers"&&V([]);return}let s=!1;const c=()=>ce(D.baseUrl,`/v1/channels/${ne}/messages`,D.membershipToken).then(w=>{s||(_(""),V((w.messages||[]).slice().reverse()))}).catch(w=>{var C,k;if(!s){if((C=w==null?void 0:w.message)!=null&&C.startsWith("HTTP_403")){V([]),_("You no longer have access to that channel."),de("");return}if((k=w==null?void 0:w.message)!=null&&k.startsWith("HTTP_404")){V([]),_("That channel no longer exists. Switching to an available channel."),de("");return}_(`Message fetch failed: ${w.message}`)}});c();const u=sc?null:window.setInterval(c,2e3);return()=>{s=!0,u&&window.clearInterval(u)}},[D,ne,v,sc]),b.useEffect(()=>{Ln([]),oi.current&&(oi.current.value="")},[z,ne]),b.useEffect(()=>{if(v!=="servers"||!r||!H||nc)return;let s=!1;const c=()=>{const w=Array.from(new Set(((F==null?void 0:F.members)||[]).map(k=>k==null?void 0:k.id).filter(Boolean)));if(!w.length)return;const C=new URLSearchParams({userIds:w.join(",")});fetch(`${Yt}/v1/presence?${C}`,{headers:{Authorization:`Bearer ${r}`}}).then(k=>k.ok?k.json():{}).then(k=>{s||!k||typeof k!="object"||ni(I=>({...I,...k}))}).catch(()=>{})};c();const u=window.setInterval(c,3e3);return()=>{s=!0,window.clearInterval(u)}},[v,r,H,F==null?void 0:F.members,nc]),b.useEffect(()=>{if(!r||nc||v!=="friends"&&v!=="dms")return;let s=!1;const c=()=>{const w=new Set;(vn||[]).forEach(I=>(I==null?void 0:I.id)&&w.add(I.id)),(ut||[]).forEach(I=>(I==null?void 0:I.participantId)&&w.add(I.participantId));const C=[...w];if(!C.length)return;const k=new URLSearchParams({userIds:C.join(",")});fetch(`${Yt}/v1/presence?${k}`,{headers:{Authorization:`Bearer ${r}`}}).then(I=>I.ok?I.json():{}).then(I=>{s||!I||typeof I!="object"||ni(O=>({...O,...I}))}).catch(()=>{})};c();const u=window.setInterval(c,5e3);return()=>{s=!0,window.clearInterval(u)}},[r,nc,v,vn,ut]),b.useEffect(()=>{const s=new URLSearchParams(window.location.search||""),c=s.get("verifyEmailToken");c&&(Kc()===pr&&er(_s,{replace:!0}),_("Verifying your email..."),se("/v1/auth/verify-email",{method:"POST",body:JSON.stringify({token:c})}).then(()=>{m("login"),_("Email verified. You can now log in.")}).catch(u=>{_(`Email verification failed: ${u.message}`)}).finally(()=>{s.delete("verifyEmailToken");const u=s.toString(),w=`${window.location.pathname}${u?`?${u}`:""}${window.location.hash||""}`;window.history.replaceState({},"",w)}))},[]),b.useEffect(()=>{if(!r)return;const s=new URLSearchParams(window.location.search||""),c=s.get("boostGiftCheckout"),u=s.get("giftId"),w=s.get("session_id");if(!c)return;c==="success"&&u&&w?aC(u,w).catch(()=>{}):c==="cancel"&&_("Boost gift checkout canceled."),s.delete("boostGiftCheckout"),s.delete("giftId"),s.delete("session_id");const C=s.toString(),k=`${window.location.pathname}${C?`?${C}`:""}${window.location.hash||""}`;window.history.replaceState({},"",k)},[r]);async function XS(s){s.preventDefault(),_("Authenticating...");try{if(h==="register"){await se("/v1/auth/register",{method:"POST",body:JSON.stringify({email:g,username:S,password:A})}),y(g.trim()),m("login"),G(""),_("Account created. Check your email for a verification link before logging in.");return}const c=await se("/v1/auth/login",{method:"POST",body:JSON.stringify({email:g,password:A})});i(c.accessToken),d(c.refreshToken||""),p(c.user),y(""),_("Authenticated.")}catch(c){if((c==null?void 0:c.message)==="EMAIL_NOT_VERIFIED"){y(g.trim()),_("Auth failed: EMAIL_NOT_VERIFIED. Use the resend button below if needed.");return}if((c==null?void 0:c.message)==="SMTP_NOT_CONFIGURED"){_("Auth failed: SMTP is not configured on the API server, so verification emails cannot be sent yet.");return}if((c==null?void 0:c.message)==="SMTP_AUTH_FAILED"){_("Auth failed: SMTP auth failed. Check Zoho SMTP username/app password.");return}if((c==null?void 0:c.message)==="SMTP_CONNECTION_FAILED"){_("Auth failed: SMTP connection failed. Check server network + SMTP host/port/TLS.");return}_(`Auth failed: ${c.message}`)}}async function ZS(){const s=(B||g||"").trim();if(!s){_("Enter your email first, then resend verification.");return}_("Sending verification email...");try{await se("/v1/auth/resend-verification",{method:"POST",body:JSON.stringify({email:s})}),y(s),_("If the account exists and is unverified, a new verification email has been sent.")}catch(c){if((c==null?void 0:c.message)==="SMTP_NOT_CONFIGURED"){_("Resend failed: SMTP is not configured on the API server. Set SMTP_* (or Zoho SMTP envs) and restart backend.");return}if((c==null?void 0:c.message)==="SMTP_AUTH_FAILED"){_("Resend failed: SMTP auth failed. Check Zoho username and app password.");return}if((c==null?void 0:c.message)==="SMTP_CONNECTION_FAILED"){_("Resend failed: could not connect to SMTP server. Check host/port/TLS/firewall.");return}_(`Resend failed: ${c.message}`)}}async function eC(s){const u=s.trim().replace(/^\//,"").trim(),[w,...C]=u.split(/\s+/);if(!w)return!1;const k=ac.find(W=>W.name===w);if(!k)return _(`Unknown command: /${w}`),!0;const I=Array.isArray(k.options)?k.options:[],O=C1(C.join(" ")),U={};try{I.forEach((W,K)=>{const q=O[K];if((q==null||q==="")&&W.required)throw new Error(`Missing required option: ${W.name}`);q==null||q===""||(U[W.name]=x1(q,W.type||"string"))})}catch(W){return _(`/${w}: ${W.message}`),!0}try{oe("");const W=await ce(D.baseUrl,`/v1/extensions/commands/${encodeURIComponent(w)}/execute`,D.membershipToken,{method:"POST",body:JSON.stringify({args:U})}),K=W==null?void 0:W.result;if(K&&typeof K=="object"&&(K.content||Array.isArray(K.embeds))){await ce(D.baseUrl,`/v1/channels/${ne}/messages`,D.membershipToken,{method:"POST",body:JSON.stringify({content:String(K.content||`/${w}`),embeds:Array.isArray(K.embeds)?K.embeds:[]})});const q=await ce(D.baseUrl,`/v1/channels/${ne}/messages`,D.membershipToken);V((q.messages||[]).slice().reverse()),_(`Executed /${w}`)}else _(`Executed /${w}${(W==null?void 0:W.result)!=null?`  ${typeof W.result=="string"?W.result:JSON.stringify(W.result)}`:""}`)}catch(W){oe(s),_(`Command failed: ${W.message}`)}return!0}async function tC(s){if(!D||!H||!ne||!s)return null;const c=T1(s,"attachment")||s,u=new FormData;u.append("guildId",H),u.append("channelId",ne),u.append("file",c,c.name||"upload.bin");const w=await fetch(`${D.baseUrl}/v1/attachments/upload`,{method:"POST",headers:{Authorization:`Bearer ${D.membershipToken}`},body:u});if(!w.ok){const C=await w.json().catch(()=>({}));throw new Error(C.error||`HTTP_${w.status}`)}return w.json()}async function Pm(s,c="files"){const u=Array.from(s||[]).filter(Boolean);if(!u.length)return;const w=Math.max(0,10-rn.length);if(!w){_("You can attach up to 10 files per message.");return}const C=u.slice(0,w);let k=0,I=0;for(const O of C)try{const U=await tC(O);U&&(Ln(W=>[...W,U]),k+=1)}catch(U){I+=1,console.warn("Attachment upload failed",U)}if(k>0&&I===0){_(`Attached ${k} file${k===1?"":"s"} from ${c}.`);return}if(k>0){_(`Attached ${k} file${k===1?"":"s"} from ${c}; ${I} failed.`);return}_(`Attachment upload failed from ${c}.`)}async function Dm(s){if(!(!(s!=null&&s.url)||!(D!=null&&D.baseUrl)||!(D!=null&&D.membershipToken)))try{const c=s.url.startsWith("http")?s.url:`${D.baseUrl}${s.url}`,u=await fetch(c,{headers:{Authorization:`Bearer ${D.membershipToken}`}});if(!u.ok){const I=await u.json().catch(()=>({}));throw new Error(I.error||`HTTP_${u.status}`)}const w=await u.blob(),C=URL.createObjectURL(w);if(!window.open(C,"_blank","noopener,noreferrer")){const I=document.createElement("a");I.href=C,I.download=s.fileName||"attachment",I.click()}window.setTimeout(()=>URL.revokeObjectURL(C),6e4)}catch(c){_(`Attachment open failed: ${c.message||"UNKNOWN_ERROR"}`)}}async function Lm(){if(!D||!ne||!J.trim()&&rn.length===0)return;if(J.trimStart().startsWith("/")){await eC(J);return}const s=`${So?`> replying to ${So.author}: ${So.content}
`:""}${J.trim()}`;try{oe(""),ue(!1),await ce(D.baseUrl,`/v1/channels/${ne}/messages`,D.membershipToken,{method:"POST",body:JSON.stringify({content:s||"Attachment",attachmentIds:rn.map(u=>u.attachmentId||u.id).filter(Boolean)})});const c=await ce(D.baseUrl,`/v1/channels/${ne}/messages`,D.membershipToken);V((c.messages||[]).slice().reverse()),Fd(null),Ln([]),oi.current&&(oi.current.value="")}catch(c){oe(s),_(`Send failed: ${c.message}`)}}async function Mm(){if(!Pe||!Oa.trim())return;const s=Oa.trim();_d("");try{await se(`/v1/social/dms/${Pe.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({content:s})});const c=await se(`/v1/social/dms/${Pe.id}/messages`,{headers:{Authorization:`Bearer ${r}`}});Yn(u=>u.map(w=>w.id===Pe.id?{...w,messages:c.messages||[]}:w))}catch(c){_d(s),_(`DM send failed: ${c.message}`)}}async function nC(){const s=vh.trim();if(s)try{const c=await se("/v1/social/friends",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({username:s})});if(c.friend&&c.threadId){Ma(C=>[c.friend,...C.filter(k=>k.id!==c.friend.id)]);const w={id:c.threadId,participantId:c.friend.id,name:c.friend.username,messages:[]};Yn(C=>[w,...C.filter(k=>k.id!==w.id)]),Jn(w.id),_(`You're now connected with ${c.friend.username}.`)}else _("Friend request sent.");const u=await se("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}});Rd({incoming:u.incoming||[],outgoing:u.outgoing||[]}),yh(""),co("requests")}catch(c){_(`Add friend failed: ${c.message}`)}}async function Om(s,c){try{await se(`/v1/social/requests/${s}/${c}`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});const[u,w]=await Promise.all([se("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}}),se("/v1/social/friends",{headers:{Authorization:`Bearer ${r}`}})]);Rd({incoming:u.incoming||[],outgoing:u.outgoing||[]}),Ma(w.friends||[]),_(c==="accept"?"Friend request accepted.":"Friend request declined.")}catch(u){_(`Request update failed: ${u.message}`)}}async function rC(){if(r)try{const s=await se("/v1/auth/sessions",{headers:{Authorization:`Bearer ${r}`}});IS(s.sessions||[])}catch(s){_(`Could not load sessions: ${s.message}`)}}async function Po(){if(r){zh(!0);try{const s=await se("/v1/billing/boost",{headers:{Authorization:`Bearer ${r}`}});CS(s)}catch(s){_(`Could not load billing status: ${s.message}`)}finally{zh(!1)}}}async function sC(){if(r)try{const s=await se("/v1/billing/boost/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){_(`Could not start checkout: ${s.message}`)}}async function iC(){if(r)try{const s=await se("/v1/billing/boost/portal",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){_(`Could not open billing portal: ${s.message}`)}}async function ui(){if(r)try{const s=await se("/v1/billing/boost/gifts",{headers:{Authorization:`Bearer ${r}`}});bS(s.gifts||[])}catch(s){_(`Could not load boost gifts: ${s.message}`)}}async function oC(){if(r){Qh(!0);try{const s=await se("/v1/billing/boost/gifts/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});if(s!=null&&s.checkoutUrl){window.location.href=s.checkoutUrl;return}_("Gift checkout URL missing.")}catch(s){_(`Could not start gift checkout: ${s.message}`)}finally{Qh(!1)}}}async function aC(s,c){if(!(!r||!s||!c))try{const u=await se("/v1/billing/boost/gifts/complete-purchase",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({giftId:s,sessionId:c})});u!=null&&u.giftCode&&Ka(u.giftCode),await ui(),zt(!0),Ve("billing"),_("Boost gift purchased. Copy and send your gift link.")}catch(u){_(`Could not complete gift purchase: ${u.message}`)}}async function Am(s){var u;if(!r)return;const c=cf(s);if(!c){_("Invalid boost gift code/link.");return}Vh(!0);try{const w=await se(`/v1/billing/boost/gifts/${encodeURIComponent(c)}`,{headers:{Authorization:`Bearer ${r}`}});Ka(c),$d(w),Zs(w),zt(!0),Ve("billing"),_(`Boost gift from ${((u=w==null?void 0:w.from)==null?void 0:u.username)||"someone"} is ready to redeem.`)}catch(w){$d(null),Zs(null),_(`Could not load boost gift: ${w.message}`)}finally{Vh(!1)}}async function cC(s=Ad){if(!r)return;const c=cf(s);if(!c){_("Invalid boost gift code.");return}Hh(!0);try{const u=await se(`/v1/billing/boost/gifts/${encodeURIComponent(c)}/redeem`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});Zs(null),$d(null),await Promise.all([Po(),ui()]),_(`Boost gift redeemed (${(u==null?void 0:u.grantDays)||30} days).`)}catch(u){_(`Could not redeem boost gift: ${u.message}`)}finally{Hh(!1)}}function _c(s="This action requires OpenCom Boost."){Qa({title:"Hold up",reason:s,cta:"Open Boost Settings"})}function lC(){Qa(null),zt(!0),Ve("billing"),Po().catch(()=>{}),ui().catch(()=>{})}function dC(s=32){const c="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let u="";for(let w=0;w<s;w++)u+=c.charAt(Math.floor(Math.random()*c.length));return u}function uC(s=8){const c=[];for(let u=0;u<s;u++){let w="";for(let C=0;C<4;C++)w+=Math.floor(Math.random()*1e4).toString().padStart(4,"0"),C<3&&(w+="-");c.push(w)}return c}function pC(){const s=dC(32),c=uC(8);Kd(s),Ja(c),qa(!0),Jd(!1),Yd("");const u="OpenCom",w=(l==null?void 0:l.username)||"user",C=`otpauth://totp/${u}:${w}?secret=${s}&issuer=${u}`,k=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(C)}`;DS(k),_("2FA setup initiated. Scan the QR code with your authenticator app.")}function fC(s,c){if(!s||!c)return!1;const u=s.replace(/\s/g,"").slice(0,6);if(!/^\d{6}$/.test(u))return!1;if(rm.includes(u))return _("Backup code verified! Removing code from backups."),Ja(w=>w.filter(C=>C!==u)),!0;for(let w=-1;w<=1;w++){const C=Math.floor(Date.now()/3e4)+w;if(hC(c,C)===u)return!0}return!1}function hC(s,c){const u=mC(s),w=new ArrayBuffer(8);return new DataView(w).setBigInt64(0,BigInt(c),!1),gC(u,w)}function mC(s){const c="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let u="";for(let C=0;C<s.length;C++){const k=c.indexOf(s[C]);k<0||(u+=k.toString(2).padStart(5,"0"))}const w=new Uint8Array(Math.floor(u.length/8));for(let C=0;C<w.length;C++)w[C]=parseInt(u.slice(C*8,(C+1)*8),2);return w}function gC(s,c){let w=new Uint8Array(64);s.length>64?(w=vu(s),w=new Uint8Array(64).map((te,ye)=>ye<w.length?w[ye]:0)):w.set(s);const C=new Uint8Array(64),k=new Uint8Array(64);for(let te=0;te<64;te++)C[te]=w[te]^92,k[te]=w[te]^54;const I=new Uint8Array(k.length+c.byteLength);I.set(k),I.set(new Uint8Array(c),k.length);const O=vu(I.buffer),U=new Uint8Array(C.length+O.length);U.set(C),U.set(O,C.length);const W=vu(U.buffer),K=W[W.length-1]&15;return(((W[K]&127)<<24|(W[K+1]&255)<<16|(W[K+2]&255)<<8|W[K+3]&255)%1e6).toString().padStart(6,"0")}function vu(s){let c=new Uint8Array(s);const u=Array.from(c).map(O=>String.fromCharCode(O)).join(""),w=[1732584193,4023233417,2562383102,271733878,3285377520],C=u.length*8;let k=u.slice(0);for(k+="";k.length*8%512!==448;)k+="\0";for(let O=7;O>=0;O--)k+=String.fromCharCode(C>>>O*8&255);for(let O=0;O<k.length;O+=64){const U=Array(80);for(let Z=0;Z<16;Z++)U[Z]=k.charCodeAt(O+Z*4)<<24|k.charCodeAt(O+Z*4+1)<<16|k.charCodeAt(O+Z*4+2)<<8|k.charCodeAt(O+Z*4+3);for(let Z=16;Z<80;Z++)U[Z]=(U[Z-3]^U[Z-8]^U[Z-14]^U[Z-16])<<1|(U[Z-3]^U[Z-8]^U[Z-14]^U[Z-16])>>>31;let[W,K,q,te,ye]=w;for(let Z=0;Z<80;Z++){let ae,De;Z<20?(ae=K&q|~K&te,De=1518500249):Z<40?(ae=K^q^te,De=1859775393):Z<60?(ae=K&q|K&te|q&te,De=2400959708):(ae=K^q^te,De=3395469782);const _e=(W<<5|W>>>27)+ae+ye+De+U[Z]>>>0;ye=te,te=q,q=K<<30|K>>>2,K=W,W=_e}w[0]=w[0]+W>>>0,w[1]=w[1]+K>>>0,w[2]=w[2]+q>>>0,w[3]=w[3]+te>>>0,w[4]=w[4]+ye>>>0}const I=new Uint8Array(20);for(let O=0;O<5;O++)I[O*4]=w[O]>>>24&255,I[O*4+1]=w[O]>>>16&255,I[O*4+2]=w[O]>>>8&255,I[O*4+3]=w[O]&255;return I}function vC(){if(!fC(sm,PS)){_("Invalid token. Please check your authenticator app.");return}am(s=>({...s,twoFactorEnabled:!0})),Jd(!0),_("2FA enabled successfully! Your backup codes have been saved."),qa(!1)}function yC(){window.confirm("Are you sure? You will lose 2FA protection.")&&(am(s=>({...s,twoFactorEnabled:!1})),Kd(""),Ja([]),Jd(!1),qa(!1),_("2FA has been disabled."))}async function Sc(s){const c=ut.find(u=>u.participantId===s.id||u.name===s.username);if(c){Jn(c.id),x("dms");return}try{const w=(await se("/v1/social/dms/open",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({friendId:s.id})})).threadId;Yn(C=>C.find(I=>I.id===w)?C:[{id:w,participantId:s.id,name:s.username,messages:[]},...C]),Jn(w),x("dms")}catch(u){_(`Open DM failed: ${u.message}`)}}async function wC(){try{if(await se("/v1/me/profile",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({displayName:qn.displayName||null,bio:qn.bio||null,pfpUrl:jr(qn.pfpUrl)||null,bannerUrl:jr(qn.bannerUrl)||null})}),l!=null&&l.id){const s=await se(`/v1/users/${l.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});lo(s),wr({displayName:s.displayName??"",bio:s.bio??"",pfpUrl:s.pfpUrl??"",bannerUrl:s.bannerUrl??""})}else lo(s=>({...s,...qn}));_("Profile updated.")}catch(s){const c=(s==null?void 0:s.message)||"";c.includes("INVALID_IMAGE")||c.includes("Invalid image format")?_("Invalid image URL. Use uploaded image paths (/v1/profile-images/...), users/... paths, or valid http(s) image URLs."):_(`Profile update failed: ${c}`)}}async function _C(){if(!r)return;const s=b1(sn);if(!s.name&&!s.details&&!s.state&&!s.largeImageUrl&&!s.smallImageUrl&&!s.buttons){_("Add at least one rich presence field before saving.");return}try{await se("/v1/presence/rpc",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({activity:s})}),l!=null&&l.id&&ni(c=>{var u,w;return{...c,[l.id]:{...c[l.id]||{},status:((u=c[l.id])==null?void 0:u.status)||yn,customStatus:((w=c[l.id])==null?void 0:w.customStatus)??null,richPresence:s}}}),_("Rich presence updated.")}catch(c){_(`Rich presence update failed: ${c.message}`)}}async function SC(){if(r)try{await se("/v1/presence/rpc",{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),l!=null&&l.id&&ni(s=>{var c,u;return{...s,[l.id]:{...s[l.id]||{},status:((c=s[l.id])==null?void 0:c.status)||yn,customStatus:((u=s[l.id])==null?void 0:u.customStatus)??null,richPresence:null}}}),Et(hy(null)),_("Rich presence cleared.")}catch(s){_(`Clear rich presence failed: ${s.message}`)}}async function CC(){var s;if(!(!D||!ke))try{await se(`/v1/servers/${D.id}/profile`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:((s=Hs.name)==null?void 0:s.trim())||void 0,logoUrl:jr(Hs.logoUrl||"")||null,bannerUrl:jr(Hs.bannerUrl||"")||null})});const u=(await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(u),_("Server profile updated.")}catch(c){const u=(c==null?void 0:c.message)||"";u.includes("LOGO_REQUIRED")?_("Server logo is required."):u.includes("INVALID_LOGO_URL")?_("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):u.includes("INVALID_BANNER_URL")?_("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):u.includes("VALIDATION_ERROR")?_("Server profile data is invalid. Check name, logo URL, and banner URL."):_(`Server profile update failed: ${u}`)}}async function $m(){if(!(!Ws.trim()||!Qs.trim()||!Ks.trim()))try{await se("/v1/servers",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:Ws.trim(),baseUrl:Qs.trim(),logoUrl:jr(Ks),bannerUrl:jr(xd)||null})}),Sd(""),Cd("https://"),uo(""),po(""),_("Server provider added.");const s=await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}});R(s.servers||[]),ei(!1)}catch(s){const c=(s==null?void 0:s.message)||"";c.includes("LOGO_REQUIRED")?_("Server logo is required."):c.includes("INVALID_LOGO_URL")?_("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):c.includes("INVALID_BANNER_URL")?_("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):_(`Add server failed: ${c}`)}}function Um(s){z&&OS(c=>{const w={...c[z]||{mode:"core",customUrl:""},...s};return{...c,[z]:w}})}async function xC(){if(!(D!=null&&D.baseUrl)||!(D!=null&&D.membershipToken)||!(ho!=null&&ho.trim())){_("Select a server and enter a workspace name.");return}try{const s=await ce(D.baseUrl,"/v1/guilds",D.membershipToken,{method:"POST",body:JSON.stringify({name:ho.trim(),createDefaultVoice:!0})});Eh(""),_("Workspace created.");const c=await ce(D.baseUrl,"/v1/guilds",D.membershipToken),u=Array.isArray(c)?c:[];P(u),s!=null&&s.guildId&&u.length&&X(s.guildId)}catch(s){_(`Create workspace failed: ${s.message}`)}}async function bC(){if(!bd)return;if((kd||Ed.trim().length>0)&&qe&&!qe.active){_c("Custom invite codes and permanent invite links require OpenCom Boost.");return}try{const c={serverId:bd,code:Ed.trim()||void 0,permanent:kd},u=await se("/v1/invites",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify(c)});nS(u.code),rS(u.joinUrl||""),Sh(""),_("Invite code generated.")}catch(c){if(String((c==null?void 0:c.message)||"").includes("BOOST_REQUIRED")){_c("Custom invite codes and permanent invite links require OpenCom Boost.");return}_(`Invite failed: ${c.message}`)}}async function Fm(s=null){const c=hl(s??_r??"");if(!c){$a(null),_("Invalid invite code/link.");return}try{const u=await se(`/v1/invites/${c}`);$a(u),fo(c),ts(c),_("Invite preview loaded.")}catch(u){$a(null),_(`Invite lookup failed: ${u.message}`)}}async function Cc(s=null){const c=hl(s||_r||"");if(c)try{const u=await se(`/v1/invites/${c}/join`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({accept:!0})});fo(""),$a(null),ts(""),yd(!1),_("Joined server from invite.");const C=(await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(C);const k=u==null?void 0:u.serverId;k&&C.some(I=>I.id===k)?Y(k):C.length&&Y(C[0].id),ei(!1)}catch(u){_(`Join failed: ${u.message}`)}}const zm=1,xc=2;function Bm(s=""){const c=s.split(",").map(I=>I.trim()).filter(Boolean);if(!c.length)return[];const u=((F==null?void 0:F.roles)||[]).filter(I=>!I.is_everyone),w=new Map(u.map(I=>[String(I.id).toLowerCase(),I.id])),C=new Map(u.map(I=>[String(I.name||"").toLowerCase(),I.id])),k=[];for(const I of c){const O=I.toLowerCase(),U=w.get(O)||C.get(O);U&&!k.includes(U)&&k.push(U)}return k}async function Vm(s,c=[],u=D,w=Dt){if(!u||!w||!s)return;const C=((F==null?void 0:F.roles)||[]).find(k=>k.is_everyone);if(!C)throw new Error("EVERYONE_ROLE_NOT_FOUND");await ce(u.baseUrl,`/v1/channels/${s}/overwrites`,u.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:C.id,allow:"0",deny:String(zm)})});for(const k of c)await ce(u.baseUrl,`/v1/channels/${s}/overwrites`,u.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:k,allow:String(zm),deny:"0"})})}async function Gm({server:s=D,guildId:c=Dt,name:u,type:w="text",parentId:C="",privateRoleIds:k=null}){if(!s||!c||!(u!=null&&u.trim()))return null;const I={name:u.trim(),type:w};w!=="category"&&C&&(I.parentId=C);const O=await ce(s.baseUrl,`/v1/guilds/${c}/channels`,s.membershipToken,{method:"POST",body:JSON.stringify(I)}),U=O==null?void 0:O.channelId;if(U&&Array.isArray(k)&&await Vm(U,k,s,c),s.id===z&&c===Dt){const W=await ce(s.baseUrl,`/v1/guilds/${c}/state`,s.membershipToken);L(W)}return U}async function pi({server:s=D,guildId:c=Dt,fixedType:u="",fixedParentId:w=""}={}){if(!s||!c){_("No active guild selected yet. Open a channel first, then try again.");return}const C=u||(await ki("Channel type: text, voice, or category","text")||"").trim().toLowerCase();if(!["text","voice","category"].includes(C)){_("Invalid channel type.");return}const k=C==="category"?"New Category":`new-${C}`,I=(await ki(`Name for the new ${C}:`,k)||"").trim();if(!I)return;let O=w||"";if(C!=="category"&&!w){const W=(await ki("Optional category name/ID (leave blank for none):","")||"").trim();if(W){const K=(No||[]).find(q=>q.id===W||String(q.name||"").toLowerCase()===W.toLowerCase());if(!K){_("Category not found.");return}O=K.id}}let U=null;if(C==="category"&&window.confirm("Make this category private?")){const K=((F==null?void 0:F.roles)||[]).filter(te=>!te.is_everyone).map(te=>te.name).join(", "),q=await ki(`Allowed roles (comma-separated names or IDs).
Available: ${K}`,"")||"";U=Bm(q)}try{await Gm({server:s,guildId:c,name:I,type:C,parentId:O,privateRoleIds:U}),_(`${C==="category"?"Category":"Channel"} created.`)}catch(W){_(`Create channel failed: ${W.message}`)}}async function EC(){if(!(!D||!Dt||!Td.trim()))try{await Gm({server:D,guildId:Dt,name:Td,type:Ua,parentId:Ua!=="category"?xh:""}),Ch(""),bh(""),_("Channel created.")}catch(s){_(`Create channel failed: ${s.message}`)}}async function kC(){if(!(!D||!H||!Dn.trim()||!nn.trim()))try{await ce(D.baseUrl,`/v1/guilds/${H}/emotes`,D.membershipToken,{method:"POST",body:JSON.stringify({name:Dn.trim().toLowerCase(),imageUrl:nn.trim()})}),tn(""),Qe("");const s=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(s),_("Custom emote created.")}catch(s){_(`Create emote failed: ${s.message}`)}}async function TC(s){if(!(!D||!H||!s))try{await ce(D.baseUrl,`/v1/guilds/${H}/emotes/${s}`,D.membershipToken,{method:"DELETE"});const c=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(c),_("Custom emote removed.")}catch(c){_(`Remove emote failed: ${c.message}`)}}async function Hm(s,c){if(!(!D||!H))try{await ce(D.baseUrl,`/v1/channels/${s}`,D.membershipToken,{method:"PATCH",body:JSON.stringify({position:c})});const u=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(u)}catch(u){_(`Move channel failed: ${u.message}`)}}async function RC(s,c,u){var ye;const w=u.findIndex(Z=>Z.id===s),C=u.findIndex(Z=>Z.id===c);if(w===-1||C===-1||w===C)return;const k=[...u],[I]=k.splice(w,1);k.splice(C,0,I);const O=(F==null?void 0:F.channels)||[],U=new Map;for(const Z of O){const ae=Z.parent_id||"__uncat__";U.has(ae)||U.set(ae,[]),U.get(ae).push(Z)}const W=((ye=u[0])==null?void 0:ye.parent_id)??"__uncat__",K=[],q=[...U.keys()].sort((Z,ae)=>{const De=U.get(Z),_e=U.get(ae),Fe=Math.min(...De.map(dn=>dn.position??0)),tt=Math.min(..._e.map(dn=>dn.position??0));return Fe-tt});for(const Z of q){const ae=U.get(Z),_e=Z===W?k:ae.sort((Fe,tt)=>(Fe.position??0)-(tt.position??0));K.push(..._e)}const te=K.map((Z,ae)=>(Z.position??-1)!==ae?Hm(Z.id,ae):Promise.resolve());await Promise.all(te),qd(null)}async function IC(s,c){const u=[...No||[]],w=u.findIndex(O=>O.id===s),C=u.findIndex(O=>O.id===c);if(w===-1||C===-1||w===C)return;const k=[...u],[I]=k.splice(w,1);k.splice(C,0,I);try{await Promise.all(k.map((O,U)=>Hm(O.id,U*100))),Xd(null)}catch(O){_(`Move category failed: ${O.message}`)}}async function NC(s,c,u){if(!(!D||!s||!c))try{const w=((F==null?void 0:F.roles)||[]).find(k=>k.is_everyone);if(u)w&&await ce(D.baseUrl,`/v1/channels/${s}/overwrites`,D.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:w.id,allow:"0",deny:String(xc)})}),await ce(D.baseUrl,`/v1/channels/${s}/overwrites`,D.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:c,allow:String(xc),deny:"0"})});else{await ce(D.baseUrl,`/v1/channels/${s}/overwrites`,D.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:c})});const k=((F==null?void 0:F.overwrites)||[]).filter(I=>I.channel_id===s&&I.target_type==="role"&&I.target_id!==c&&parseInt(I.allow,10)&xc);w&&k.length===0&&await ce(D.baseUrl,`/v1/channels/${s}/overwrites`,D.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:w.id})})}const C=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(C)}catch(w){_(`Permission update failed: ${w.message}`)}}function jC(s,c){const u=((F==null?void 0:F.overwrites)||[]).find(w=>w.channel_id===s&&w.target_type==="role"&&w.target_id===c);return u?(parseInt(u.allow,10)&xc)!==0:!1}async function PC(){if(!(!D||!H||!Dd.trim()))try{await ce(D.baseUrl,`/v1/guilds/${H}/roles`,D.membershipToken,{method:"POST",body:JSON.stringify({name:Dd.trim(),permissions:"0"})}),Mh("");const s=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(s),_("Role created.")}catch(s){_(`Create role failed: ${s.message}`)}}async function DC(){if(!(!D||!H||!Md||!Ld))try{await ce(D.baseUrl,`/v1/guilds/${H}/members/${Md}/roles/${Ld}`,D.membershipToken,{method:"PUT",body:"{}"}),_("Role assigned.")}catch(s){_(`Assign role failed: ${s.message}`)}}async function Wm(){if(!D||!H)return;const s=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(s)}async function yu(s){if(!D||!H||!s||!Io||Js)return;const c=mt.find(w=>w.id===s),u=(c==null?void 0:c.username)||s;if(window.confirm(`Kick ${u}? They can rejoin with an invite.`)){qs(!0);try{await ce(D.baseUrl,`/v1/guilds/${H}/members/${s}/kick`,D.membershipToken,{method:"POST",body:"{}"}),await Wm(),(pe==null?void 0:pe.id)===s&&ds(null),_(`Kicked ${u}.`)}catch(w){_(`Kick failed: ${w.message}`)}finally{qs(!1)}}}async function wu(s,c=""){if(!D||!H||!s||!Er||Js)return;const u=mt.find(C=>C.id===s),w=(u==null?void 0:u.username)||s;if(window.confirm(`Ban ${w}? This removes them and blocks rejoin until unbanned.`)){qs(!0);try{const C={};c.trim()&&(C.reason=c.trim().slice(0,256)),await ce(D.baseUrl,`/v1/guilds/${H}/members/${s}/ban`,D.membershipToken,{method:"POST",body:JSON.stringify(C)}),await Wm(),(pe==null?void 0:pe.id)===s&&ds(null),_(`Banned ${w}.`)}catch(C){_(`Ban failed: ${C.message}`)}finally{qs(!1)}}}async function LC(s){if(!(!D||!H||!s||!Er||Js)){qs(!0);try{await ce(D.baseUrl,`/v1/guilds/${H}/bans/${s}`,D.membershipToken,{method:"DELETE"}),_(`Unbanned ${s}.`),$h("")}catch(c){_(`Unban failed: ${c.message}`)}finally{qs(!1)}}}async function Qm(s,{color:c,position:u}){if(!(!D||!s))try{const w={};if(c!==void 0&&(w.color=typeof c=="string"&&c.startsWith("#")?parseInt(c.slice(1),16):c),u!==void 0&&(w.position=u),Object.keys(w).length===0)return;await ce(D.baseUrl,`/v1/roles/${s}`,D.membershipToken,{method:"PATCH",body:JSON.stringify(w)});const C=await ce(D.baseUrl,`/v1/guilds/${H}/state`,D.membershipToken);L(C),_("Role updated.")}catch(w){_(`Update role failed: ${w.message}`)}}function MC(s){s.preventDefault(),uu.current={x:s.clientX-Ha.x,y:s.clientY-Ha.y},Fh(!0)}function OC(s){cS(c=>({...c,[s]:!c[s]}))}function AC(s,c){s.preventDefault(),an(null),Vt(null),wn(null),_n(null),pt({server:c,x:s.clientX,y:s.clientY})}function $C(s,c){s.preventDefault(),pt(null),an(null),Vt(null),_n(null),wn({channel:c,x:s.clientX,y:s.clientY})}function UC(s,c){s.preventDefault(),pt(null),an(null),Vt(null),wn(null),_n({category:c,x:s.clientX,y:s.clientY})}async function FC(s,c){if(!D||!Dt)return;const u=(await ki("Channel name:",c||"")||"").trim();!u||u===c||await ce(D.baseUrl,`/v1/channels/${s}`,D.membershipToken,{method:"PATCH",body:JSON.stringify({name:u})})}async function zC(s){if(!D||!Dt||!s)return;const c=((F==null?void 0:F.roles)||[]).filter(C=>!C.is_everyone).map(C=>C.name).join(", "),u=await ki(`Visible to roles (comma-separated names or IDs). Leave blank to keep private for admins only.
Available: ${c}`,"");if(u==null)return;const w=Bm(u);await Vm(s,w,D,Dt)}async function bc(s){if(!(!s||!ke||!D||!Dt))try{await FC(s.id,s.name),window.confirm("Configure visibility (private roles) for this channel/category?")&&await zC(s.id);const c=await ce(D.baseUrl,`/v1/guilds/${Dt}/state`,D.membershipToken);L(c),_("Channel settings updated.")}catch(c){_(`Update channel failed: ${c.message}`)}finally{wn(null),_n(null)}}async function Km(s){if(!s||!ke||!D||!Dt)return;const c=s.type==="category"?"category":"channel";if(window.confirm(`Delete ${c} "${s.name}"?`))try{if(s.type==="category"){const w=((F==null?void 0:F.channels)||[]).filter(C=>C.parent_id===s.id);for(const C of w)await ce(D.baseUrl,`/v1/channels/${C.id}`,D.membershipToken,{method:"PATCH",body:JSON.stringify({parentId:null})})}await ce(D.baseUrl,`/v1/channels/${s.id}`,D.membershipToken,{method:"DELETE"}),ne===s.id&&de("");const u=await ce(D.baseUrl,`/v1/guilds/${Dt}/state`,D.membershipToken);L(u),_(`${c[0].toUpperCase()}${c.slice(1)} deleted.`)}catch(u){_(`Delete channel failed: ${u.message}`)}finally{wn(null),_n(null)}}async function BC(s){try{await navigator.clipboard.writeText(s),_("Server ID copied.")}catch{_("Could not copy server ID.")}pt(null)}function VC(s){x("servers"),Y(s),pt(null)}async function Ym(s,c){const u=E.findIndex(I=>I.id===s);if(u<0)return;const w=c==="up"?u-1:u+1;if(w<0||w>=E.length)return;const C=E.slice(),[k]=C.splice(u,1);C.splice(w,0,k),R(C),pt(null);try{await se("/v1/servers/reorder",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({serverIds:C.map(I=>I.id)})}),_("Server order updated.")}catch(I){_(`Server reorder failed: ${I.message}`)}}async function GC(s){if(!(s!=null&&s.id))return;pt(null);const c=z===s.id;c&&(Y(""),X(""),L(null),V([]));try{if(await se(`/v1/servers/${s.id}/leave`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),s.defaultGuildId&&s.baseUrl)try{await ce(s.baseUrl,`/v1/guilds/${s.defaultGuildId}/leave`,s.membershipToken,{method:"POST",body:"{}"})}catch{}const w=(await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(w),c&&w.length&&Y(w[0].id),_("Left server.")}catch(u){_(`Leave failed: ${u.message}`)}}async function HC(s){if(!(!(s!=null&&s.id)||!(s.roles||[]).includes("owner"))&&window.confirm(`Delete "${s.name}"? This cannot be undone. All members will lose access.`)){pt(null);try{await se(`/v1/servers/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});const u=(await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(u),z===s.id&&(Y(u.length?u[0].id:""),X(""),L(null),V([])),_("Server deleted.")}catch(c){_(`Delete failed: ${c.message}`)}}}async function WC(s){if(!(!D||!ne||!s)){try{await ce(D.baseUrl,`/v1/channels/${ne}/messages/${s}`,D.membershipToken,{method:"DELETE",body:"{}"}),V(c=>c.filter(u=>u.id!==s)),_("Message deleted.")}catch(c){_(`Delete failed: ${c.message}`)}an(null)}}async function QC(s){if(!(!ve||!s)){try{await se(`/v1/social/dms/${ve}/messages/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),Yn(c=>c.map(u=>u.id===ve?{...u,messages:(u.messages||[]).filter(w=>w.id!==s)}:u)),_("DM message deleted.")}catch(c){_(`Delete failed: ${c.message}`)}an(null)}}function KC(s){if(s!=null&&s.id){if(s.kind==="server"){if(!ne)return;gS(c=>{const u=c[ne]||[],C=u.some(k=>k.id===s.id)?u.filter(k=>k.id!==s.id):[{id:s.id,author:s.author,content:s.content},...u].slice(0,50);return{...c,[ne]:C}}),_("Updated pinned messages.");return}if(s.kind==="dm"){if(!ve)return;vS(c=>{const u=c[ve]||[],C=u.some(k=>k.id===s.id)?u.filter(k=>k.id!==s.id):[{id:s.id,author:s.author,content:s.content},...u].slice(0,50);return{...c,[ve]:C}}),_("Updated pinned messages.")}}}function YC(s){return s!=null&&s.id?s.kind==="server"?yc.some(c=>c.id===s.id):s.kind==="dm"?wc.some(c=>c.id===s.id):!1:!1}function JC({type:s,match:c=null,timeoutMs:u=1e4,guildId:w=null,channelId:C=null,sessionToken:k=null,transportId:I=null}){return new Promise((O,U)=>{const W=s,K=Zn.current.get(W)||[],q={match:c,guildId:w,channelId:C,sessionToken:k,transportId:I,resolve:O,reject:U,timeout:setTimeout(()=>{U(new Error(`${s}_TIMEOUT`));const te=Zn.current.get(W)||[];Zn.current.set(W,te.filter(ye=>ye!==q))},u)};K.push(q),Zn.current.set(W,K)})}function qC(s){if((s==null?void 0:s.op)!=="DISPATCH"||typeof s.t!="string")return;const c=Zn.current.get(s.t);if(!(c!=null&&c.length))return;const u=s.d||{},w=s.t==="VOICE_TRANSPORT_CONNECTED",C=[];for(const k of c){const I=w?!k.guildId||u.guildId==null||u.guildId===k.guildId:!k.guildId||u.guildId===k.guildId,O=w?!k.channelId||u.channelId==null||u.channelId===k.channelId:!k.channelId||u.channelId===k.channelId,U=!w||!k.transportId||u.transportId===k.transportId,W=!k.match||k.match(u,s);if(I&&O&&U&&W){clearTimeout(k.timeout),k.resolve(u);continue}C.push(k)}C.length?Zn.current.set(s.t,C):Zn.current.delete(s.t)}function _u(s="VOICE_REQUEST_CANCELLED"){for(const[c,u]of Zn.current.entries()){for(const w of u)clearTimeout(w.timeout),w.reject(new Error(s));Zn.current.delete(c)}}async function Jm(){var s;_u("VOICE_SESSION_CLEANUP"),await((s=Ht.current)==null?void 0:s.cleanup()),Nd(!1),ic({})}async function XC(s=15e3){var k,I;const c=Date.now();for(;Date.now()-c<s;){const O=Ge.current;if(O&&O.readyState===WebSocket.OPEN&&Gt.current)return O;await new Promise(U=>setTimeout(U,120))}const u=(k=Ge.current)==null?void 0:k.readyState,w=u===WebSocket.CONNECTING?"CONNECTING":u===WebSocket.OPEN?"OPEN":u===WebSocket.CLOSING?"CLOSING":u===WebSocket.CLOSED?"CLOSED":"MISSING",C=(I=Eo.current)!=null&&I.length?Eo.current.join(","):"none";throw new Error(`VOICE_GATEWAY_UNAVAILABLE:ready=${Gt.current?"1":"0"},ws=${w},candidates=${C}`)}async function Ec(s,c){(await XC()).send(JSON.stringify({op:"DISPATCH",t:s,d:c}))}function ZC(){const s=Ge.current,c=!!(s&&s.readyState===WebSocket.OPEN&&Gt.current);if(e){const u=s==null?void 0:s.readyState,w=u===WebSocket.CONNECTING?"CONNECTING":u===WebSocket.OPEN?"OPEN":u===WebSocket.CLOSING?"CLOSING":u===WebSocket.CLOSED?"CLOSED":"MISSING";t("canUseRealtimeVoiceGateway",{usable:c,readyState:w,gatewayReady:Gt.current,activeGuildId:H,activeChannelId:ne})}return c}async function ex(s){var w;if(!(s!=null&&s.id)||!H||!(D!=null&&D.baseUrl)||!(D!=null&&D.membershipToken))return;let c=null;try{_(`Joining ${s.name}...`),await((w=Ht.current)==null?void 0:w.join({guildId:H,channelId:s.id,audioInputDeviceId:Xn,isMuted:ss,isDeafened:is,audioOutputDeviceId:Sr})),za({guildId:H,channelId:s.id}),_(`Joined ${s.name}.`);return}catch(C){c=C}if(!("".trim()==="1")){const k=`Voice connection failed: ${(c==null?void 0:c.message)||"VOICE_GATEWAY_UNAVAILABLE"}. Realtime voice gateway is required; set VITE_ENABLE_REST_VOICE_FALLBACK=1 only for diagnostics.`;_(k),window.alert(k);return}try{await ce(D.baseUrl,`/v1/channels/${s.id}/voice/join`,D.membershipToken,{method:"POST"}),za({guildId:H,channelId:s.id});const C=c!=null&&c.message?` (gateway fallback: ${c.message})`:"";_(`Joined ${s.name} (REST voice mode, no SFU playback).${C}`)}catch(C){const k=`Voice connection failed: ${C.message||"VOICE_JOIN_FAILED"}`;_(k),window.alert(k)}}async function tx(){var s,c;if(br)try{Rh?(await((s=Ht.current)==null?void 0:s.stopScreenShare()),_("Screen sharing stopped.")):(await((c=Ht.current)==null?void 0:c.startScreenShare()),_("Screen sharing started."))}catch(u){const w=`Screen sharing failed: ${u.message||"SCREEN_SHARE_FAILED"}`;_(w),window.alert(w)}}async function nx(){if(Id)return;let s=He,c=Lt;if(!s||!c)for(const[C,k]of Object.entries(fs||{})){const I=k==null?void 0:k[l==null?void 0:l.id];if(I!=null&&I.channelId){s=C,c=I.channelId;break}}if(!c){const C=kr.find(k=>k.userId===(l==null?void 0:l.id));C!=null&&C.channelId&&(s=s||H||"",c=C.channelId)}const u=E.find(C=>C.defaultGuildId===s)||D||null,w=async()=>{za({guildId:"",channelId:""}),Nd(!1),ic({}),Ih(!1),Nh(!1),l!=null&&l.id&&tu(C=>{var O;let k=!1;const I={...C};for(const U of Object.keys(I)){if(!((O=I[U])!=null&&O[l.id]))continue;const W={...I[U]};delete W[l.id],I[U]=W,k=!0}return k?I:C}),await Jm()};Th(!0);try{if(await w(),_("Disconnected from voice."),!s||!c){if(!(u!=null&&u.baseUrl)||!(u!=null&&u.membershipToken))return;try{await ce(u.baseUrl,"/v1/me/voice-disconnect",u.membershipToken,{method:"POST"})}catch(C){const k=`Disconnected locally. Server voice leave failed: ${C.message||"VOICE_LEAVE_FAILED"}`;_(k),console.warn(k)}return}if(ZC())try{await Ec("VOICE_LEAVE",{guildId:s,channelId:c});return}catch{}if(!(u!=null&&u.baseUrl)||!(u!=null&&u.membershipToken))return;try{if(c){await ce(u.baseUrl,`/v1/channels/${c}/voice/leave`,u.membershipToken,{method:"POST"});return}await ce(u.baseUrl,"/v1/me/voice-disconnect",u.membershipToken,{method:"POST"})}catch(C){const k=`Disconnected locally. Server voice leave failed: ${C.message||"VOICE_LEAVE_FAILED"}`;_(k),console.warn(k)}}finally{Th(!1)}}async function qm(){const s=os.trim();if(!(!s||!r||!Cr.trim()))try{const c=await se("/v1/servers/official",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:s,logoUrl:jr(Cr),bannerUrl:jr(Pd)||null})});jd(""),mo(""),go(""),_("Your server was created.");const w=(await se("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(w),c.serverId&&w.length&&(Y(c.serverId),x("servers")),ei(!1)}catch(c){const u=(c==null?void 0:c.message)||"";u.includes("SERVER_LIMIT")?_("You already have a server."):u.includes("LOGO_REQUIRED")?_("Server logo is required."):u.includes("INVALID_LOGO_URL")?_("Invalid server logo URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):u.includes("INVALID_BANNER_URL")?_("Invalid server banner URL. Use uploaded paths (/v1/profile-images/... or users/...) or valid http(s) URLs."):u.includes("OFFICIAL_SERVER_NOT_CONFIGURED")?_("Server creation isnt set up yet. The site admin needs to set OFFICIAL_NODE_SERVER_ID on the API server (same value as NODE_SERVER_ID on the node)."):u.includes("OFFICIAL_SERVER_UNAVAILABLE")?_("Official server is unavailable. Please try again later."):_(`Failed: ${u}`)}}function Xm(s,c){s.preventDefault();const u=Math.min(s.clientX,window.innerWidth-240),w=Math.min(s.clientY,window.innerHeight-180);wn(null),_n(null),Vt(null),an({x:u,y:w,message:{...c,pinned:YC(c)}})}function Su(s,c){if(!(c!=null&&c.id))return;s.preventDefault(),s.stopPropagation();const u=Math.min(s.clientX,window.innerWidth-250),w=Math.min(s.clientY,window.innerHeight-220);pt(null),wn(null),_n(null),an(null),Vt({x:u,y:w,member:c})}const fi=25*1024*1024;function Cu(s){return s!=null&&s.type?s.type.startsWith("image/"):!1}async function xu(s,c){if(!r)throw new Error("AUTH_REQUIRED");const u=new FormData;u.append("image",s);const w=await fetch(`${Yt}${c}`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:u});if(!w.ok){const C=await w.json().catch(()=>({}));throw new Error(C.error||`Upload failed: ${w.status}`)}return w.json()}async function Wt(s,c,u){var C;const w=(C=s.target.files)==null?void 0:C[0];if(s.target.value="",!!w){if(!Cu(w)){_("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(w.size>fi){_(`Image too large. Max ${Math.round(fi/1024/1024)}MB.`);return}try{_(`Uploading ${c}...`);const k=await xu(w,"/v1/images/upload");if(!(k!=null&&k.imageUrl))throw new Error("UPLOAD_FAILED");u(k.imageUrl),_(`${c} uploaded.`)}catch(k){_((k==null?void 0:k.message)||"Upload failed.")}}}async function rx(s){var u;const c=(u=s.target.files)==null?void 0:u[0];if(s.target.value="",!!c){if(!Cu(c)){_("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(c.size>fi){_(`Image too large. Max ${Math.round(fi/1024/1024)}MB.`);return}try{_("Uploading avatar");const w=await xu(c,"/v1/me/profile/pfp");wr(C=>({...C,pfpUrl:w.pfpUrl||""})),lo(he?{...he,pfpUrl:w.pfpUrl}:null),_("Avatar updated.")}catch(w){_(w.message||"Upload failed.")}}}async function sx(s){var u;const c=(u=s.target.files)==null?void 0:u[0];if(s.target.value="",!!c){if(!Cu(c)){_("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(c.size>fi){_(`Image too large. Max ${Math.round(fi/1024/1024)}MB.`);return}try{_("Uploading banner");const w=await xu(c,"/v1/me/profile/banner");wr(C=>({...C,bannerUrl:w.bannerUrl||""})),lo(he?{...he,bannerUrl:w.bannerUrl}:null),_("Banner updated.")}catch(w){_(w.message||"Upload failed.")}}}async function hi(s){try{const c=await se(`/v1/users/${s.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});Bd(u=>{var w;return{...u,[s.id]:{username:c.username??((w=u[s.id])==null?void 0:w.username)??s.username,displayName:c.displayName??c.username??s.username,pfpUrl:c.pfpUrl??null}}}),ds({...c,username:c.username||s.username,status:ln(s.id)||"offline",roleIds:s.roleIds||[]})}catch{ds({id:s.id,username:s.username||s.id,displayName:s.username||s.id,bio:"Profile details are private or unavailable.",badges:[],badgeDetails:[],status:ln(s.id)||"offline",platformTitle:null,createdAt:null,roleIds:s.roleIds||[]})}}function ix(s){if(s&&typeof s=="object"&&(s.bgColor||s.icon||s.name))return{icon:s.icon||"",name:s.name||String(s.id||"Badge"),bgColor:s.bgColor||"#3a4f72",fgColor:s.fgColor||"#ffffff"};const c=String((s==null?void 0:s.id)||s||"").toLowerCase();return c==="platform_owner"?{icon:"",name:"Platform Owner",bgColor:"#2d6cdf",fgColor:"#ffffff"}:c==="platform_admin"?{icon:"",name:"Platform Admin",bgColor:"#2d6cdf",fgColor:"#ffffff"}:c==="boost"?{icon:"",name:"Boost",bgColor:"#4f7ecf",fgColor:"#ffffff"}:{icon:(s==null?void 0:s.icon)||"",name:(s==null?void 0:s.name)||c||"Badge",bgColor:(s==null?void 0:s.bgColor)||"#3a4f72",fgColor:(s==null?void 0:s.fgColor)||"#ffffff"}}function Zm(s){var u;const c=`:${s}:`;oe(w=>{const C=w||"",k=C.length>0&&!/\s$/.test(C)?" ":"";return`${C}${k}${c} `}),ue(!1),(u=Ro.current)==null||u.focus()}function eg(s){const c=(s==null?void 0:s.content)||"",u=[],w=(I,O)=>{if(!I)return[];const U=[],W=/(\[([^\]\n]{1,200})\]\((https?:\/\/[^\s)]+)\)|https?:\/\/[^\s<>"'`]+|`([^`\n]+)`|\*\*([^*\n]+)\*\*|__([^_\n]+)__|~~([^~\n]+)~~|\*([^*\n]+)\*|_([^_\n]+)_|\n|:([a-zA-Z0-9_+-]{2,32}):)/g;let K=0,q=W.exec(I),te=0;for(;q;){const ye=q.index??0;ye>K&&(U.push(a.jsx("span",{children:I.slice(K,ye)},`${O}-plain-${te}`)),te+=1);const Z=q[0]||"",ae=q[2],De=q[3],_e=q[4],Fe=q[5],tt=q[6],dn=q[7],Tr=q[8],ge=q[9],gt=q[10];if(ae&&De)U.push(a.jsx("a",{href:De,target:"_blank",rel:"noreferrer",children:w(ae,`${O}-md-link-label-${te}`)},`${O}-md-link-${te}`));else if(/^https?:\/\//i.test(Z))U.push(a.jsx("a",{href:Z,target:"_blank",rel:"noreferrer",children:Z},`${O}-link-${te}`));else if(_e)U.push(a.jsx("code",{className:"message-inline-code",children:_e},`${O}-code-${te}`));else if(Fe||tt){const Te=Fe||tt;U.push(a.jsx("strong",{children:w(Te,`${O}-bold-inner-${te}`)},`${O}-bold-${te}`))}else if(dn)U.push(a.jsx("s",{children:w(dn,`${O}-strike-inner-${te}`)},`${O}-strike-${te}`));else if(Tr||ge){const Te=Tr||ge;U.push(a.jsx("em",{children:w(Te,`${O}-italic-inner-${te}`)},`${O}-italic-${te}`))}else if(Z===`
`)U.push(a.jsx("br",{},`${O}-br-${te}`));else if(gt){const Te=String(gt||"").toLowerCase(),On=dy[Te];if(On)U.push(a.jsx("span",{className:"message-emote",title:`:${Te}:`,children:On},`${O}-emote-${te}`));else if(Em.has(Te)){const vt=Em.get(Te);U.push(a.jsx("img",{className:"message-custom-emote",src:vt.imageUrl||vt.image_url,alt:`:${Te}:`,title:`:${Te}:`},`${O}-custom-emote-${te}`))}else U.push(a.jsx("span",{children:Z},`${O}-raw-emote-${te}`))}else U.push(a.jsx("span",{children:Z},`${O}-raw-${te}`));te+=1,K=ye+Z.length,q=W.exec(I)}return K<I.length&&U.push(a.jsx("span",{children:I.slice(K)},`${O}-tail-${te}`)),U},C=/@\{([^}\n]{1,64})\}|@([a-zA-Z0-9_.-]{2,64})/g;let k=0;for(const I of c.matchAll(C)){const O=I.index??0,U=(I[1]||I[2]||"").trim(),W=I[0],K=O>0?c[O-1]:"";if(!(!(O===0||/\s/.test(K))||!U)){if(O>k&&u.push(...w(c.slice(k,O),`text-${k}`)),U.toLowerCase()==="everyone")u.push(a.jsx("span",{className:"message-mention",children:W},`everyone-${O}`));else{const te=YS.get(U.toLowerCase());te?u.push(a.jsxs("button",{type:"button",className:"message-mention mention-click",onClick:ye=>{ye.stopPropagation(),hi(te)},children:["@",te.username||te.id]},`mention-${O}`)):u.push(a.jsx("span",{className:"message-mention",children:W},`unknown-${O}`))}k=O+W.length}}return k<c.length&&u.push(...w(c.slice(k),`tail-${k}`)),u.length?u:c}function kc(s){try{const c=new URL(String(s||""));return c.hash="",c.toString()}catch{return String(s||"")}}function bu(s=""){return/^image\//i.test(String(s||""))}function tg(s=""){const c=String(s||"").trim();if(!c)return!1;if(/^data:image\//i.test(c))return!0;try{const u=new URL(c);return/\.(png|jpe?g|gif|webp|bmp|svg|heic|avif)(?:[?#]|$)/i.test(u.pathname||"")}catch{return/\.(png|jpe?g|gif|webp|bmp|svg|heic|avif)(?:[?#]|$)/i.test(c)}}function ng(s){const c=String(s||"");if(!c)return null;if(wo[c]!==void 0)return wo[c];const u=kc(c);for(const[w,C]of Object.entries(wo))if(kc(w)===u)return C;return null}function rg(s){const c=vy((s==null?void 0:s.content)||"");if(!c.length)return[];const u=new Set(((s==null?void 0:s.linkEmbeds)||[]).map(C=>kc(C==null?void 0:C.url))),w=[];for(const C of c){const k=kc(C);if(!k||u.has(k))continue;const I=ng(C);I&&(!I.hasMeta&&!I.action||w.push({url:I.url||C,title:I.title||I.siteName||"Link",description:I.description||"",imageUrl:I.imageUrl||"",siteName:I.siteName||"",action:I.action||null,kind:I.kind||"",invite:I.invite||null}))}return w}function ox(s){if(!s)return"";try{const c=new Date(s);return Number.isNaN(c.getTime())?"":c.toLocaleDateString(void 0,{month:"short",year:"numeric"})}catch{return""}}function Eu(s,c){var O,U,W,K;const u=ng(s==null?void 0:s.url),w=(s==null?void 0:s.kind)==="opencom_invite"&&((O=s==null?void 0:s.invite)!=null&&O.code)?s:(u==null?void 0:u.kind)==="opencom_invite"&&((U=u==null?void 0:u.invite)!=null&&U.code)?{url:u.url||(s==null?void 0:s.url)||"",invite:u.invite}:null;if((W=w==null?void 0:w.invite)!=null&&W.code){const q=w.invite,te=w.url||op(q.code),ye=Number(q.onlineCount||0),Z=Number(q.memberCount||0),ae=ox(q.serverCreatedAt),De=q.serverName||"Server",_e=xn(q.serverLogoUrl||"");return a.jsxs("div",{className:"message-invite-embed",children:[a.jsx("div",{className:"message-invite-hero",style:_e?{backgroundImage:`linear-gradient(180deg, rgba(12, 16, 27, 0.3), rgba(12, 16, 27, 0.95)), url(${_e})`}:void 0}),a.jsxs("div",{className:"message-invite-body",children:[a.jsxs("div",{className:"message-invite-header",children:[a.jsx("div",{className:"message-invite-icon",children:_e?a.jsx("img",{src:_e,alt:De}):a.jsx("span",{children:Nr(De)})}),a.jsxs("div",{className:"message-invite-title-wrap",children:[a.jsx("strong",{children:De}),a.jsxs("p",{className:"message-invite-stats",children:[a.jsx("span",{className:"dot online"})," ",ye," Online",a.jsx("span",{className:"dot members"})," ",Z," Members"]}),ae&&a.jsxs("p",{className:"message-invite-established",children:["Est. ",ae]})]})]}),a.jsx("button",{type:"button",className:"message-invite-cta",onClick:Fe=>{Fe.preventDefault(),Fe.stopPropagation(),Cc(q.code)},children:"Go to Server"}),a.jsx("a",{className:"message-invite-link",href:te,target:"_blank",rel:"noreferrer",children:te})]})]},c)}const C=String((s==null?void 0:s.imageUrl)||(u==null?void 0:u.imageUrl)||"").trim(),k=!C&&tg(s==null?void 0:s.url)?String(s.url):"",I=C||k;return I?a.jsxs("a",{className:"message-image-link-embed",href:s.url,target:"_blank",rel:"noreferrer",children:[a.jsx("img",{src:I,alt:s.title||"Image",loading:"lazy"}),a.jsxs("div",{className:"message-image-link-meta",children:[a.jsx("strong",{children:s.title||"Image"}),a.jsx("p",{children:s.url})]})]},c):a.jsxs("a",{className:"message-embed-card",href:s.url,target:"_blank",rel:"noreferrer",children:[a.jsx("strong",{children:s.title||"Link"}),s.description&&a.jsx("p",{children:s.description}),a.jsx("p",{children:s.url}),((K=s.action)==null?void 0:K.label)&&a.jsx("small",{children:s.action.label})]},c)}function sg(s,c){const u=_o[s==null?void 0:s.id]||"",w=String((s==null?void 0:s.url)||""),C=tg(w)?w:"",k=u||C;return(bu((s==null?void 0:s.contentType)||"")||!!k)&&k?a.jsxs("button",{type:"button",className:"message-image-attachment",onClick:O=>{O.stopPropagation(),Dm(s)},children:[a.jsx("img",{src:k,alt:(s==null?void 0:s.fileName)||"Image attachment",loading:"lazy"}),a.jsxs("div",{className:"message-image-attachment-meta",children:[a.jsx("strong",{children:(s==null?void 0:s.fileName)||"Image"}),a.jsx("p",{children:(s==null?void 0:s.contentType)||"image"})]})]},c):a.jsxs("button",{type:"button",className:"message-embed-card message-embed-card-btn",onClick:O=>{O.stopPropagation(),Dm(s)},children:[a.jsx("strong",{children:(s==null?void 0:s.fileName)||"Attachment"}),a.jsx("p",{children:(s==null?void 0:s.contentType)||"file"})]},c)}function ig(s){if(!s)return null;try{const c=new Date(s);return Number.isNaN(c.getTime())?null:c.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return null}}async function ax(s){var u;const c=(u=s.target.files)==null?void 0:u[0];c&&(Xh(await c.text()),_(`Theme loaded: ${c.name}`))}return r?a.jsxs("div",{className:"opencom-shell",children:[a.jsxs("aside",{className:"server-rail",children:[a.jsx("div",{className:"rail-header",title:"OpenCom",children:a.jsx("img",{src:"logo.png",alt:"OpenCom",className:"logo-img",style:{width:"100%",height:"100%",objectFit:"contain"}})}),Co&&(()=>{const s=ut.find(c=>c.id===Co.dmId);return s?a.jsxs("button",{type:"button",className:"dm-notification-popup",onClick:()=>{x("dms"),Jn(Co.dmId),eu(null)},children:[s.pfp_url?a.jsx("img",{src:xn(s.pfp_url),alt:"",className:"dm-notification-avatar"}):a.jsx("div",{className:"dm-notification-avatar dm-notification-avatar-initials",children:Nr(s.name||s.username||"?")}),a.jsxs("span",{className:"dm-notification-text",children:["New message from ",s.name||s.username||"Someone"]})]}):null})(),a.jsx("button",{className:`server-pill nav-pill ${v==="friends"?"active":""}`,onClick:()=>x("friends"),title:"Friends",children:""}),a.jsx("button",{className:`server-pill nav-pill ${v==="dms"?"active":""}`,onClick:()=>x("dms"),title:"Direct messages",children:""}),a.jsx("button",{className:`server-pill nav-pill ${v==="profile"?"active":""}`,onClick:()=>x("profile"),title:"Profile",children:""}),a.jsxs("div",{className:"server-list",children:[E.map(s=>a.jsxs("button",{className:`server-pill ${s.id===z&&v==="servers"?"active":""}`,title:s.name,onClick:()=>{x("servers"),Y(s.id),X(""),L(null),V([])},onContextMenu:c=>AC(c,s),children:[s.logoUrl?a.jsx("img",{src:xn(s.logoUrl),alt:s.name,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"inherit"}}):Nr(s.name),(qh[s.id]||0)>0&&a.jsx("span",{className:"server-pill-ping-badge",children:qh[s.id]})]},s.id)),a.jsx("button",{className:"server-pill",title:"Create or join a server",onClick:()=>ei(!0),children:""})]})]}),a.jsxs("aside",{className:`channel-sidebar ${br?"voice-connected":""}`,children:[a.jsxs("header",{className:"sidebar-header",style:D!=null&&D.bannerUrl?{backgroundImage:`linear-gradient(rgba(10,16,30,0.72), rgba(10,16,30,0.86)), url(${xn(D.bannerUrl)})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[a.jsx("h2",{children:v==="servers"?(D==null?void 0:D.name)||"No server":v.toUpperCase()}),a.jsx("small",{children:v==="servers"?(tr==null?void 0:tr.name)||"Choose a channel":"Unified communication hub"})]}),v==="servers"&&a.jsx(a.Fragment,{children:a.jsxs("section",{className:"sidebar-block channels-container",children:[Rm.map(({category:s,channels:c})=>{const u=aS[s.id];return a.jsxs("div",{className:"category-block",children:[a.jsxs("div",{className:"category-header-row",children:[a.jsxs("button",{className:`category-header ${Za===s.id?"channel-dragging":""}`,draggable:ke&&s.id!=="uncategorized",onDragStart:()=>ke&&s.id!=="uncategorized"&&Xd(s.id),onDragOver:w=>{w.preventDefault(),s.id!=="uncategorized"&&w.currentTarget.classList.add("channel-drop-target")},onDragLeave:w=>w.currentTarget.classList.remove("channel-drop-target"),onDrop:w=>{w.preventDefault(),w.currentTarget.classList.remove("channel-drop-target"),ke&&Za&&s.id!=="uncategorized"&&Za!==s.id&&IC(Za,s.id)},onDragEnd:()=>Xd(null),onClick:()=>OC(s.id),onContextMenu:w=>s.id!=="uncategorized"&&ke&&UC(w,s),children:[a.jsx("span",{className:"chevron",children:u?"":""}),s.name]}),ke&&s.id!=="uncategorized"&&a.jsxs("div",{className:"category-actions",children:[a.jsx("button",{type:"button",className:"channel-action-btn",title:"Create channel in category",onClick:w=>{w.stopPropagation(),pi({fixedType:"text",fixedParentId:s.id})},children:""}),a.jsx("button",{type:"button",className:"channel-action-btn",title:"Category settings",onClick:w=>{w.stopPropagation(),bc(s)},children:""})]})]}),!u&&a.jsx("div",{className:"category-items",children:c.map(w=>{var C,k;return a.jsxs("div",{children:[a.jsxs("div",{className:"channel-row-wrap",children:[a.jsxs("button",{className:`channel-row ${w.id===ne?"active":""} ${Xa===w.id?"channel-dragging":""}`,draggable:ke,onDragStart:()=>ke&&qd(w.id),onDragOver:I=>{I.preventDefault(),I.currentTarget.classList.add("channel-drop-target")},onDragLeave:I=>I.currentTarget.classList.remove("channel-drop-target"),onDrop:I=>{I.preventDefault(),I.currentTarget.classList.remove("channel-drop-target"),ke&&Xa&&Xa!==w.id&&RC(Xa,w.id,c)},onDragEnd:()=>qd(null),onContextMenu:I=>ke&&$C(I,w),onClick:()=>{if(w.type==="text"){de(w.id);return}w.type==="voice"&&ex(w)},children:[a.jsx("span",{className:"channel-hash",children:w.type==="voice"?"":"#"}),a.jsxs("span",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:0},children:[a.jsx("span",{children:w.name}),w.type==="voice"&&(((C=vc.get(w.id))==null?void 0:C.length)||0)>0&&a.jsxs("span",{className:"hint",style:{fontSize:"11px"},children:[vc.get(w.id).length," connected"]})]})]}),ke&&a.jsx("button",{type:"button",className:"channel-action-btn channel-row-cog",title:"Channel settings",onClick:I=>{I.stopPropagation(),bc(w)},children:""})]}),w.type==="voice"&&(((k=vc.get(w.id))==null?void 0:k.length)||0)>0&&a.jsx("div",{className:"voice-channel-members",children:vc.get(w.id).map(I=>{var U;const O=!!((U=dm[H])!=null&&U[I.userId]);return a.jsxs("div",{className:"voice-channel-member-row",children:[a.jsx("div",{className:`avatar member-avatar vc-avatar ${O?"speaking":""}`,children:I.pfp_url?a.jsx("img",{src:xn(I.pfp_url),alt:I.username,className:"avatar-image"}):Nr(I.username)}),a.jsx("span",{className:"voice-channel-member-name",children:I.username}),a.jsx("span",{className:"voice-channel-member-icons",children:I.deafened?"":I.muted?"":""})]},`${w.id}-${I.userId}`)})})]},w.id)})})]},s.id)}),!Rm.length&&a.jsx("p",{className:"hint",children:"No channels available. Create one in Settings."})]})}),v==="dms"&&a.jsxs("section",{className:"sidebar-block channels-container",children:[ut.map(s=>a.jsxs("button",{className:`channel-row dm-sidebar-row ${s.id===ve?"active":""}`,onClick:()=>Jn(s.id),title:`DM ${s.name}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[ii({userId:s.participantId||s.id,username:s.name,pfpUrl:s.pfp_url,size:28}),a.jsx("span",{className:"channel-hash",children:"@"}),a.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:s.name})]},s.id)),!ut.length&&a.jsx("p",{className:"hint",children:"Add friends to open direct message threads."})]}),v==="friends"&&a.jsxs("section",{className:"sidebar-block channels-container friend-sidebar-list",children:[vn.map(s=>a.jsxs("button",{className:"friend-row friend-sidebar-row",onClick:()=>Sc(s),title:`Open ${s.username}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[ii({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:28}),a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsx("strong",{children:s.username}),a.jsx("span",{className:"hint",children:ko(ln(s.id))})]})]},s.id)),!vn.length&&a.jsx("p",{className:"hint",children:"No friends yet. Use the Add Friend tab in the main panel."})]}),v==="profile"&&he&&a.jsx("section",{className:"sidebar-block channels-container",children:a.jsxs("div",{className:"profile-preview",style:{backgroundImage:he!=null&&he.bannerUrl?`url(${xn(he.bannerUrl)})`:void 0},children:[a.jsx("div",{className:"avatar",children:Nr(he.displayName||he.username||"User")}),a.jsx("strong",{children:he.displayName||he.username}),a.jsxs("span",{children:["@",he.username]}),a.jsx("small",{children:he.platformTitle||"OpenCom Member"})]})}),a.jsxs("footer",{className:"self-card",children:[br&&a.jsxs("div",{className:"voice-widget",children:[a.jsxs("div",{className:"voice-top",children:[a.jsx("strong",{children:"Voice connected"}),a.jsx("span",{title:bm,children:bm})]}),a.jsxs("div",{className:"voice-actions",children:[a.jsx("button",{className:"ghost",onClick:tx,children:Rh?"Stop Share":"Share Screen"}),a.jsx("button",{className:"danger",onClick:nx,disabled:Id,children:Id?"Disconnecting...":"Disconnect"})]}),!!Tm.length&&a.jsx("div",{className:"voice-screen-grid",children:Tm.map(s=>a.jsxs("div",{className:"voice-screen-tile",children:[a.jsx("video",{autoPlay:!0,playsInline:!0,ref:c=>{!c||!s.stream||c.srcObject!==s.stream&&(c.srcObject=s.stream)}}),a.jsx("span",{children:jo.get(s.userId)||s.userId||"Screen Share"})]},s.producerId))}),a.jsx("p",{className:"hint",children:"Voice controls moved to Settings  Voice."})]}),a.jsxs("div",{className:"user-row",children:[ii({userId:l==null?void 0:l.id,username:(l==null?void 0:l.username)||"OpenCom User",pfpUrl:he==null?void 0:he.pfpUrl,size:36}),a.jsxs("div",{className:"user-meta",children:[a.jsx("strong",{children:l==null?void 0:l.username}),a.jsx("span",{children:ke?"Owner":"Member"})]}),a.jsxs("select",{className:"status-select",value:yn,onChange:s=>mS(s.target.value),title:"Your status",children:[a.jsx("option",{value:"online",children:"Online"}),a.jsx("option",{value:"idle",children:"Idle"}),a.jsx("option",{value:"dnd",children:"Do Not Disturb"}),a.jsx("option",{value:"invisible",children:"Invisible"})]}),a.jsxs("div",{className:"user-controls",children:[a.jsx("button",{className:`icon-btn ${ss?"danger":"ghost"}`,onClick:()=>Ih(s=>!s),children:ss?"":""}),a.jsx("button",{className:`icon-btn ${is?"danger":"ghost"}`,onClick:()=>Nh(s=>!s),children:is?"":""}),a.jsx("button",{className:"icon-btn ghost",onClick:()=>{zt(!0),Ve("profile")},children:""}),a.jsx("button",{className:"icon-btn danger",onClick:()=>{Jm().catch(()=>{}),i(""),d(""),R([]),L(null),V([])},children:""})]})]})]})]}),a.jsxs("main",{className:"chat-pane",children:[v==="servers"&&E.length===0&&a.jsxs("div",{className:"create-server-empty",style:{padding:"2rem",maxWidth:"420px",margin:"auto"},children:[a.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Create your server"}),a.jsx("p",{className:"hint",style:{marginBottom:"1rem"},children:"You get one server hosted by us. Name it and start customising channels and roles."}),a.jsx("input",{type:"text",value:os,onChange:s=>jd(s.target.value),placeholder:"Server name",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),a.jsx("input",{type:"text",value:Cr,onChange:s=>mo(s.target.value),placeholder:"Logo URL (.png/.jpg/.webp/.svg)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Logo",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server logo",mo),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("input",{type:"text",value:Pd,onChange:s=>go(s.target.value),placeholder:"Banner URL (optional)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server banner",go),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("button",{onClick:qm,disabled:!os.trim()||!Cr.trim(),children:"Create your server"})]}),v==="servers"&&E.length>0&&a.jsxs("div",{className:"chat-layout",children:[a.jsxs("section",{className:"chat-main",children:[a.jsxs("header",{className:"chat-header",children:[a.jsxs("h3",{children:[a.jsx("span",{className:"channel-hash",children:"#"})," ",(ci==null?void 0:ci.name)||"updates"]}),a.jsxs("div",{className:"chat-actions",children:[a.jsx("button",{className:"icon-btn ghost",title:"Pinned messages",onClick:()=>Lh(s=>!s),children:""}),a.jsx("button",{className:"icon-btn ghost",title:"Threads",children:""}),a.jsx("button",{className:"icon-btn ghost",title:"Notifications",children:""}),a.jsx("button",{className:"icon-btn ghost",title:"Members",children:""}),a.jsx("input",{className:"search-input",placeholder:`Search ${(D==null?void 0:D.name)||"server"}`}),a.jsx("button",{className:"ghost",onClick:()=>{zt(!0),Ve("server")},children:"Open settings"})]})]}),Dh&&yc.length>0&&a.jsx("div",{className:"pinned-strip",children:yc.slice(0,3).map(s=>a.jsxs("div",{className:"pinned-item",children:[a.jsx("strong",{children:s.author}),a.jsx("span",{children:s.content})]},s.id))}),a.jsxs("div",{className:"messages",ref:lc,children:[(()=>{let s="";return JS.map(c=>{const u=mt.find(U=>U.id===c.authorId),C=((F==null?void 0:F.roles)||[]).filter(U=>((u==null?void 0:u.roleIds)||[]).includes(U.id)).sort((U,W)=>(W.position??0)-(U.position??0))[0],k=(C==null?void 0:C.color)!=null&&C.color!==""?typeof C.color=="number"?`#${Number(C.color).toString(16).padStart(6,"0")}`:C.color:null,I=my(c.firstMessageTime),O=!!I&&I!==s;return I&&(s=I),a.jsxs("div",{children:[O&&a.jsx("div",{className:"message-date-divider",children:a.jsx("span",{children:gy(c.firstMessageTime)})}),a.jsxs("article",{className:"msg grouped-msg",children:[a.jsx("div",{className:"msg-avatar",children:c.pfpUrl?a.jsx("img",{src:xn(c.pfpUrl),alt:c.author}):Nr(c.author||"User")}),a.jsxs("div",{className:"msg-body",children:[a.jsxs("strong",{className:"msg-author",children:[a.jsx("button",{className:"name-btn",style:k?{color:k}:void 0,onClick:()=>hi({id:c.authorId,username:c.author,status:ln(c.authorId),pfp_url:c.pfpUrl}),onContextMenu:U=>Su(U,{id:c.authorId,username:c.author,pfp_url:c.pfpUrl,roleIds:(u==null?void 0:u.roleIds)||[]}),children:c.author}),C&&a.jsx("span",{className:"msg-role-tag",children:C.name}),a.jsx("span",{className:"msg-time",children:fy(c.firstMessageTime)})]}),c.messages.map(U=>{const W=rg(U);return a.jsxs("div",{onContextMenu:K=>Xm(K,{id:U.id,kind:"server",author:c.author,content:U.content,mine:(U.author_id||U.authorId)===(l==null?void 0:l.id)}),children:[a.jsxs("p",{children:[yc.some(K=>K.id===U.id)?" ":"",eg(U)]}),Array.isArray(U==null?void 0:U.embeds)&&U.embeds.length>0&&a.jsx("div",{className:"message-embeds",children:U.embeds.map((K,q)=>{var te;return a.jsxs("div",{className:"message-embed-card",children:[K.title&&a.jsx("strong",{children:K.title}),K.description&&a.jsx("p",{children:K.description}),K.url&&a.jsx("a",{href:K.url,target:"_blank",rel:"noreferrer",children:K.url}),((te=K.footer)==null?void 0:te.text)&&a.jsx("small",{children:K.footer.text})]},`${U.id}-embed-${q}`)})}),Array.isArray(U==null?void 0:U.linkEmbeds)&&U.linkEmbeds.length>0&&a.jsx("div",{className:"message-embeds",children:U.linkEmbeds.map((K,q)=>Eu(K,`${U.id}-link-${q}`))}),W.length>0&&a.jsx("div",{className:"message-embeds",children:W.map((K,q)=>Eu(K,`${U.id}-derived-link-${q}`))}),Array.isArray(U==null?void 0:U.attachments)&&U.attachments.length>0&&a.jsx("div",{className:"message-embeds",children:U.attachments.map((K,q)=>sg(K,`${U.id}-att-${q}`))})]},U.id)})]})]})]},`group-wrap-${c.id}`)})})(),!$.length&&a.jsx("p",{className:"empty",children:"No messages yet. Start the conversation."})]}),So&&a.jsxs("div",{className:"reply-banner",children:[a.jsxs("span",{children:["Replying to ",So.author]}),a.jsx("button",{className:"ghost",onClick:()=>Fd(null),children:"Cancel"})]}),a.jsxs("footer",{className:"composer server-composer",onClick:()=>{var s;return(s=Ro.current)==null?void 0:s.focus()},children:[a.jsx("button",{className:"ghost composer-icon",onClick:s=>{var c;s.stopPropagation(),(c=oi.current)==null||c.click()},children:""}),a.jsx("input",{ref:oi,type:"file",multiple:!0,style:{display:"none"},onChange:async s=>{const c=Array.from(s.target.files||[]);await Pm(c,"file picker")}}),a.jsxs("div",{className:"composer-input-wrap",children:[rn.length>0&&a.jsx("div",{className:"mention-suggestions",children:rn.map((s,c)=>a.jsxs("div",{className:"mention-suggestion",style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[a.jsx("span",{children:s.fileName||"attachment"}),a.jsx("button",{type:"button",className:"ghost",onClick:u=>{u.stopPropagation(),Ln(w=>w.filter((C,k)=>k!==c))},children:"Remove"})]},`pending-att-${c}`))}),a.jsx("textarea",{ref:Ro,value:J,onChange:s=>oe(s.target.value),onPaste:s=>{var u;const c=Array.from(((u=s.clipboardData)==null?void 0:u.files)||[]).filter(w=>w&&w.size>0);c.length&&(s.preventDefault(),Pm(c,"clipboard").catch(()=>{}))},placeholder:`Message #${(ci==null?void 0:ci.name)||"channel"}`,onKeyDown:s=>{if(s.key==="ArrowDown"&&Sn.length>0){s.preventDefault(),cc(c=>(c+1)%Sn.length);return}if(s.key==="ArrowUp"&&Sn.length>0){s.preventDefault(),cc(c=>(c-1+Sn.length)%Sn.length);return}if(s.key==="Escape"&&gc){s.preventDefault(),oe("");return}if((s.key==="Tab"||s.key==="Enter"&&!s.shiftKey)&&Sn.length>0){s.preventDefault();const c=Sn[Math.min(ym,Sn.length-1)]||Sn[0];if(!c)return;oe(`/${c.name} `);return}if(s.key==="Enter"&&!s.shiftKey){s.preventDefault(),Lm();return}if(s.key==="Tab"&&mc.length){s.preventDefault();const c=dp(J);if(!c)return;const u=mc[0],w=J.slice(0,c.start);oe(`${w}@{${u}} `)}}}),gc&&a.jsxs("div",{className:"slash-command-suggestions",children:[a.jsxs("div",{className:"slash-command-header",children:["COMMANDS MATCHING /",(di||"").toUpperCase()]}),Sn.length===0?a.jsx("div",{className:"slash-command-empty",children:"No commands found for this server."}):Sn.map((s,c)=>a.jsxs("button",{type:"button",className:`slash-command-item ${c===ym?"active":""}`,onClick:u=>{var w;u.stopPropagation(),oe(`/${s.name} `),cc(c),(w=Ro.current)==null||w.focus()},children:[a.jsxs("div",{children:[a.jsxs("strong",{children:["/",s.name]}),a.jsx("p",{children:s.description||"No description provided."})]}),a.jsx("span",{children:s.extensionName||s.extensionId})]},s.name))]}),mc.length>0&&!gc&&a.jsx("div",{className:"mention-suggestions",children:mc.map(s=>a.jsxs("button",{type:"button",className:"mention-suggestion",onClick:c=>{var C;c.stopPropagation();const u=dp(J);if(!u)return;const w=J.slice(0,u.start);oe(`${w}@{${s}} `),(C=Ro.current)==null||C.focus()},children:["@",s]},s))}),et&&!gc&&a.jsxs("div",{className:"emote-picker",children:[Object.entries(dy).map(([s,c])=>a.jsxs("button",{type:"button",className:"emote-item",onClick:u=>{u.stopPropagation(),Zm(s)},title:`:${s}:`,children:[a.jsx("span",{children:c}),a.jsxs("small",{children:[":",s,":"]})]},s)),((F==null?void 0:F.emotes)||[]).map(s=>a.jsxs("button",{type:"button",className:"emote-item",onClick:c=>{c.stopPropagation(),Zm(String(s.name||"").toLowerCase())},title:`:${s.name}:`,children:[a.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:`:${s.name}:`}),a.jsxs("small",{children:[":",s.name,":"]})]},s.id||s.name))]})]}),a.jsx("button",{className:"ghost composer-icon",onClick:s=>{s.stopPropagation(),ue(c=>!c)},title:"Open emotes",children:""}),a.jsx("button",{className:"send-btn",onClick:Lm,disabled:!ne||!J.trim()&&rn.length===0,children:"Send"})]})]}),a.jsxs("aside",{className:"members-pane",children:[a.jsxs("h4",{children:["Members  ",mt.length]}),(()=>{const s=new Map(((F==null?void 0:F.roles)||[]).map(k=>[k.id,k])),c=k=>(k.roleIds||[]).map(O=>s.get(O)).filter(Boolean).sort((O,U)=>(U.position??0)-(O.position??0))[0]||null,u=new Map;for(const k of mt){const I=c(k),O=(I==null?void 0:I.id)??"__none__";u.has(O)||u.set(O,{role:I,members:[]}),u.get(O).members.push(k)}const w={id:"__none__",name:"No role",position:-1,color:null},C=Array.from(u.entries()).map(([k,{role:I,members:O}])=>({role:I||w,members:O}));return C.sort((k,I)=>(I.role.position??0)-(k.role.position??0)),C.map(({role:k,members:I})=>{const O=k.color!=null&&k.color!==""?typeof k.color=="number"?`#${Number(k.color).toString(16).padStart(6,"0")}`:k.color:null;return a.jsxs("div",{className:"members-role-section",children:[a.jsx("div",{className:"members-role-label",style:O?{color:O}:void 0,children:k.name}),I.map(U=>{var Z;const W=c(U),K=(W==null?void 0:W.color)!=null&&W.color!==""?typeof W.color=="number"?`#${Number(W.color).toString(16).padStart(6,"0")}`:W.color:null,q=kr.find(ae=>ae.userId===U.id),ye=!!((q==null?void 0:q.channelId)&&q.channelId===Lt)&&!!((Z=dm[H])!=null&&Z[U.id]);return a.jsxs("button",{className:"member-row",title:`View ${U.username}`,onClick:ae=>{ae.stopPropagation(),hi(U)},onContextMenu:ae=>Su(ae,U),children:[a.jsx("div",{className:ye?"speaking":"",children:ii({userId:U.id,username:U.username,pfpUrl:U.pfp_url,size:32})}),a.jsxs("div",{children:[a.jsx("strong",{style:K?{color:K}:void 0,children:U.username}),a.jsx("span",{children:q?`${q.deafened?"":q.muted?"":""} In voice`:ko(ln(U.id))})]})]},U.id)})]},k.id)})})(),!mt.length&&a.jsx("p",{className:"hint",children:"No visible members yet."})]})]}),v==="dms"&&a.jsxs("section",{className:"chat-main",children:[a.jsxs("header",{className:"chat-header dm-header-actions",children:[a.jsx("h3",{children:Pe?`@ ${Pe.name}`:"Direct Messages"}),a.jsx("div",{className:"chat-actions",children:a.jsx("button",{className:"icon-btn ghost",onClick:()=>Lh(s=>!s),title:"Pinned DMs",children:""})})]}),Dh&&wc.length>0&&a.jsx("div",{className:"pinned-strip",children:wc.slice(0,3).map(s=>a.jsxs("div",{className:"pinned-item",children:[a.jsx("strong",{children:s.author}),a.jsx("span",{children:s.content})]},s.id))}),a.jsxs("div",{className:"messages",ref:To,children:[(()=>{let s="";return qS.map(c=>{const u=my(c.firstMessageTime),w=!!u&&u!==s;return u&&(s=u),a.jsxs("div",{children:[w&&a.jsx("div",{className:"message-date-divider",children:a.jsx("span",{children:gy(c.firstMessageTime)})}),a.jsxs("article",{className:"msg dm-msg grouped-msg",children:[a.jsx("div",{className:"msg-avatar",children:c.pfpUrl?a.jsx("img",{src:xn(c.pfpUrl),alt:c.author}):Nr(c.author)}),a.jsxs("div",{className:"msg-body",children:[a.jsxs("strong",{className:"msg-author",children:[a.jsx("button",{className:"name-btn",onClick:()=>hi({id:c.authorId,username:c.author,status:ln(c.authorId),pfp_url:c.pfpUrl}),onContextMenu:C=>Su(C,{id:c.authorId,username:c.author,pfp_url:c.pfpUrl}),children:c.author}),a.jsx("span",{className:"msg-time",children:fy(c.firstMessageTime)})]}),c.messages.map(C=>{const k=rg(C);return a.jsxs("div",{onContextMenu:I=>Xm(I,{id:C.id,kind:"dm",author:C.author,content:C.content,mine:C.authorId===(l==null?void 0:l.id)}),children:[a.jsxs("p",{children:[wc.some(I=>I.id===C.id)?" ":"",eg(C)]}),k.length>0&&a.jsx("div",{className:"message-embeds",children:k.map((I,O)=>Eu(I,`${C.id}-dm-derived-link-${O}`))}),Array.isArray(C==null?void 0:C.attachments)&&C.attachments.length>0&&a.jsx("div",{className:"message-embeds",children:C.attachments.map((I,O)=>sg(I,`${C.id}-dm-att-${O}`))})]},C.id)})]})]})]},`dm-group-wrap-${c.id}`)})})(),!Pe&&a.jsx("p",{className:"empty",children:"Select a DM on the left."})]}),a.jsxs("footer",{className:"composer dm-composer",onClick:()=>{var s;return(s=_m.current)==null?void 0:s.focus()},children:[a.jsx("textarea",{ref:_m,value:Oa,onChange:s=>_d(s.target.value),placeholder:`Message ${(Pe==null?void 0:Pe.name)||"friend"}`,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Mm())}}),a.jsx("button",{className:"send-btn",onClick:Mm,disabled:!Pe||!Oa.trim(),children:"Send"})]})]}),v==="friends"&&a.jsxs("div",{className:"friends-surface",children:[a.jsxs("section",{className:"friends-main",children:[a.jsxs("header",{className:"friends-header",children:[a.jsx("h3",{children:"Friends"}),a.jsxs("div",{className:"friends-tabs",children:[a.jsx("button",{className:ns==="online"?"active":"ghost",onClick:()=>co("online"),children:"Online"}),a.jsx("button",{className:ns==="all"?"active":"ghost",onClick:()=>co("all"),children:"All"}),a.jsx("button",{className:ns==="add"?"active":"ghost",onClick:()=>co("add"),children:"Add Friend"}),a.jsx("button",{className:ns==="requests"?"active":"ghost",onClick:()=>co("requests"),children:"Requests"})]})]}),a.jsx("input",{placeholder:"Search friends",value:wd,onChange:s=>tS(s.target.value)}),ns==="add"&&a.jsxs("div",{className:"friend-add-card",children:[a.jsx("h4",{children:"Add Friend"}),a.jsx("p",{className:"hint",children:"Type the username and send your request instantly."}),a.jsxs("div",{className:"friend-add-row",children:[a.jsx("input",{placeholder:"Username",value:vh,onChange:s=>yh(s.target.value)}),a.jsx("button",{onClick:nC,children:"Send Request"})]})]}),ns==="requests"&&a.jsxs("div",{className:"friend-add-card",children:[a.jsx("h4",{children:"Friend Requests"}),Fa.incoming.map(s=>a.jsxs("div",{className:"friend-row",children:[a.jsxs("div",{className:"friend-meta",children:[a.jsx("strong",{children:s.username}),a.jsx("span",{children:"Incoming request"})]}),a.jsxs("div",{className:"row-actions",children:[a.jsx("button",{onClick:()=>Om(s.id,"accept"),children:"Accept"}),a.jsx("button",{className:"ghost",onClick:()=>Om(s.id,"decline"),children:"Decline"})]})]},s.id)),Fa.outgoing.map(s=>a.jsx("div",{className:"friend-row",children:a.jsxs("div",{className:"friend-meta",children:[a.jsx("strong",{children:s.username}),a.jsx("span",{children:"Pending"})]})},s.id)),!Fa.incoming.length&&!Fa.outgoing.length&&a.jsx("p",{className:"hint",children:"No pending friend requests."})]}),(ns==="online"?hc.filter(s=>ln(s.id)!=="offline"):hc).map(s=>a.jsxs("div",{className:"friend-row",children:[a.jsxs("div",{className:"friend-row-main",children:[ii({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:32}),a.jsxs("div",{className:"friend-meta",children:[a.jsx("strong",{children:s.username}),a.jsx("span",{children:ko(ln(s.id))})]})]}),a.jsx("button",{className:"ghost",onClick:c=>{c.stopPropagation(),Sc(s)},children:"Message"})]},s.id))]}),a.jsxs("aside",{className:"active-now",children:[a.jsx("h4",{children:"Active Now"}),hc.slice(0,5).map(s=>a.jsx("button",{className:"active-card",onClick:c=>{c.stopPropagation(),hi(s)},children:a.jsxs("div",{className:"friend-row-main",children:[ii({userId:s.id,username:s.username,pfpUrl:s.pfp_url,size:30}),a.jsxs("div",{className:"friend-meta",children:[a.jsx("strong",{children:s.username}),a.jsx("span",{children:ln(s.id)==="online"?"Available now":ko(ln(s.id))})]})]})},`active-${s.id}`)),!hc.length&&a.jsx("p",{className:"hint",children:"When friends are active, they will appear here."})]})]}),v==="profile"&&a.jsxs("div",{className:"social-panel",children:[a.jsx("h3",{children:"Your Profile"}),a.jsx("p",{className:"hint",children:"Manage your public details and account appearance in Settings."}),a.jsx("button",{onClick:()=>{zt(!0),Ve("profile")},children:"Open Profile Settings"})]})]}),ft&&a.jsxs("div",{className:"server-context-menu",style:{top:ft.y,left:ft.x},onClick:s=>s.stopPropagation(),children:[ft.message.kind==="server"&&a.jsx("button",{onClick:()=>{Fd({author:ft.message.author,content:ft.message.content}),an(null)},children:"Reply"}),a.jsx("button",{onClick:()=>{KC(ft.message),an(null)},children:ft.message.pinned?"Unpin":"Pin"}),ft.message.kind==="dm"&&a.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(ft.message.content||""),_("Copied message text.")}catch{_("Could not copy message text.")}an(null)},children:"Copy Text"}),ft.message.mine&&ft.message.kind==="server"&&a.jsx("button",{className:"danger",onClick:()=>WC(ft.message.id),children:"Delete"}),ft.message.mine&&ft.message.kind==="dm"&&a.jsx("button",{className:"danger",onClick:()=>QC(ft.message.id),children:"Delete"})]}),Bt&&a.jsxs("div",{className:"server-context-menu",style:{top:Bt.y,left:Bt.x},onClick:s=>s.stopPropagation(),children:[a.jsx("button",{onClick:()=>{hi(Bt.member),Vt(null)},children:"View Profile"}),a.jsx("button",{onClick:()=>{Sc({id:Bt.member.id,username:Bt.member.username||Bt.member.id}),Vt(null)},children:"Message"}),a.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(Bt.member.id||""),_("User ID copied.")}catch{_("Could not copy user ID.")}Vt(null)},children:"Copy User ID"}),Io&&Bt.member.id!==(l==null?void 0:l.id)&&a.jsx("button",{className:"danger",onClick:async()=>{await yu(Bt.member.id),Vt(null)},children:"Kick Member"}),Er&&Bt.member.id!==(l==null?void 0:l.id)&&a.jsx("button",{className:"danger",onClick:async()=>{await wu(Bt.member.id,""),Vt(null)},children:"Ban Member"}),mu&&a.jsx("button",{onClick:()=>{Oh(Bt.member.id||""),zt(!0),Ve("moderation"),Vt(null)},children:"Open Moderation Panel"})]}),on&&a.jsxs("div",{className:"server-context-menu",style:{top:on.y,left:on.x},onClick:s=>s.stopPropagation(),children:[a.jsx("button",{onClick:()=>VC(on.server.id),children:"Open Server"}),ke&&on.server.id===z&&!!Dt&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{pi({fixedType:"text"}),pt(null)},children:"Create Text Channel"}),a.jsx("button",{onClick:()=>{pi({fixedType:"voice"}),pt(null)},children:"Create Voice Channel"}),a.jsx("button",{onClick:()=>{pi({fixedType:"category"}),pt(null)},children:"Create Category"})]}),a.jsx("button",{onClick:()=>Ym(on.server.id,"up"),children:"Move Up"}),a.jsx("button",{onClick:()=>Ym(on.server.id,"down"),children:"Move Down"}),a.jsx("button",{onClick:()=>{wh(on.server.id),zt(!0),Ve("invites"),pt(null)},children:"Create Invite"}),a.jsx("button",{onClick:()=>BC(on.server.id),children:"Copy Server ID"}),a.jsx("button",{onClick:()=>{zt(!0),Ve("server"),pt(null)},children:"Server Settings"}),a.jsx("button",{className:"danger",onClick:()=>GC(on.server),children:"Leave Server"}),(on.server.roles||[]).includes("owner")&&a.jsx("button",{className:"danger",onClick:()=>HC(on.server),children:"Delete Server"})]}),cs&&a.jsxs("div",{className:"server-context-menu",style:{top:cs.y,left:cs.x},onClick:s=>s.stopPropagation(),children:[ke&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>bc(cs.channel),children:"Edit Channel"}),a.jsx("button",{onClick:()=>{cm(cs.channel.id),zt(!0),Ve("server"),wn(null)},children:"Permissions"})]}),a.jsx("button",{onClick:()=>{de(cs.channel.id),wn(null)},children:"Open"}),ke&&a.jsx("button",{className:"danger",onClick:()=>Km(cs.channel),children:"Delete"})]}),ls&&a.jsx("div",{className:"server-context-menu",style:{top:ls.y,left:ls.x},onClick:s=>s.stopPropagation(),children:ke&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{pi({fixedType:"text",fixedParentId:ls.category.id}),_n(null)},children:"Create Text Channel"}),a.jsx("button",{onClick:()=>{pi({fixedType:"voice",fixedParentId:ls.category.id}),_n(null)},children:"Create Voice Channel"}),a.jsx("button",{onClick:()=>bc(ls.category),children:"Edit Category"}),a.jsx("button",{className:"danger",onClick:()=>Km(ls.category),children:"Delete Category"})]})}),ES&&a.jsx("div",{className:"settings-overlay",onClick:()=>ei(!1),children:a.jsxs("div",{className:"add-server-modal",onClick:s=>s.stopPropagation(),children:[a.jsxs("header",{className:"add-server-modal-header",children:[a.jsx("h3",{style:{margin:0},children:"Create or join a server"}),a.jsxs("div",{className:"add-server-tabs",children:[a.jsx("button",{type:"button",className:ti==="join"?"active":"ghost",onClick:()=>Ud("join"),children:"Join"}),a.jsx("button",{type:"button",className:ti==="custom"?"active":"ghost",onClick:()=>Ud("custom"),children:"Add host"}),a.jsx("button",{type:"button",className:ti==="create"?"active":"ghost",onClick:()=>Ud("create"),children:"Create yours"}),E.some(s=>{var c,u;return(u=(c=s==null?void 0:s.roles)==null?void 0:c.includes)==null?void 0:u.call(c,"owner")})&&a.jsx("a",{href:"/server-admin.html",target:"_blank",rel:"noopener noreferrer",className:"add-server-admin-link",onClick:s=>s.stopPropagation(),children:" Admin"})]})]}),a.jsxs("div",{className:"add-server-content",children:[ti==="join"&&a.jsxs("section",{className:"card",children:[a.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Paste an invite code or full join link. Invite links are previewed and need explicit accept."}),a.jsx("input",{placeholder:"Invite code or join link",value:_r??"",onChange:s=>fo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("div",{className:"row-actions",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[a.jsx("button",{className:"ghost",onClick:Fm,children:"Preview"}),a.jsx("button",{onClick:()=>Cc(Pt||_r),children:"Accept Invite"})]}),Mn&&a.jsxs("p",{className:"hint",style:{marginTop:"0.5rem"},children:["Invite: ",Mn.code,"  Server: ",Mn.serverName||Mn.server_id,"  Uses: ",Mn.uses]})]}),ti==="custom"&&a.jsxs("section",{className:"card",children:[a.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Connect to a server node by URL (self-hosted or provider)."}),a.jsx("input",{placeholder:"Server name",value:Ws??"",onChange:s=>Sd(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsx("input",{placeholder:"https://node.example.com",value:Qs??"https://",onChange:s=>Cd(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Ks??"",onChange:s=>uo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server logo",uo),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("input",{placeholder:"Banner URL (optional)",value:xd??"",onChange:s=>po(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server banner",po),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("button",{onClick:$m,disabled:!Ws.trim()||!Qs.trim()||!Ks.trim(),children:"Add Server"})]}),ti==="create"&&a.jsxs("section",{className:"card",children:[a.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"One server hosted by usname it and customize channels and roles."}),a.jsx("input",{placeholder:"Server name",value:os??"",onChange:s=>jd(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Cr??"",onChange:s=>mo(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server logo",mo),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("input",{placeholder:"Banner URL (optional)",value:Pd??"",onChange:s=>go(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server banner",go),style:{width:"100%",marginTop:"0.35rem"}})]}),a.jsx("button",{onClick:qm,disabled:!(os!=null&&os.trim())||!(Cr!=null&&Cr.trim()),children:"Create your server"})]})]}),a.jsx("button",{type:"button",className:"ghost",style:{width:"100%",marginTop:"0.5rem"},onClick:()=>ei(!1),children:"Close"})]})}),pe&&a.jsxs("div",{className:"member-profile-popout",style:{right:Ha.x,bottom:Ha.y},onClick:s=>s.stopPropagation(),children:[a.jsx("div",{className:"popout-drag-handle",onMouseDown:MC,children:"Drag"}),a.jsx("div",{className:"popout-banner",style:{backgroundImage:pe.bannerUrl?`url(${xn(pe.bannerUrl)})`:void 0}}),a.jsxs("div",{className:"popout-content",children:[a.jsx("div",{className:"avatar popout-avatar",children:pe.pfpUrl?a.jsx("img",{src:xn(pe.pfpUrl),alt:"Profile avatar",className:"avatar-image"}):Nr(pe.displayName||pe.username||"User")}),a.jsx("h4",{children:pe.displayName||pe.username}),a.jsxs("p",{className:"hint",children:["@",pe.username,"  ",ko(ln(pe==null?void 0:pe.id)||(pe==null?void 0:pe.status)||"offline")]}),pe.platformTitle&&a.jsx("p",{className:"hint",children:pe.platformTitle}),ig(pe.createdAt)&&a.jsxs("p",{className:"hint",children:["Account created: ",ig(pe.createdAt)]}),Array.isArray(pe.badgeDetails)&&pe.badgeDetails.length>0&&a.jsx("div",{className:"popout-roles",children:pe.badgeDetails.map((s,c)=>{const u=ix(s);return a.jsx("span",{className:"popout-role-tag",title:u.name,style:{backgroundColor:u.bgColor,color:u.fgColor,borderColor:u.bgColor},children:u.icon},`${s.id||s.name||"badge"}-${c}`)})}),((cg=pe.roleIds)==null?void 0:cg.length)>0&&(F==null?void 0:F.roles)&&a.jsx("div",{className:"popout-roles",children:(F.roles||[]).filter(s=>(pe.roleIds||[]).includes(s.id)&&!s.is_everyone).sort((s,c)=>(c.position??0)-(s.position??0)).map(s=>{const c=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return a.jsx("span",{className:"popout-role-tag",style:{backgroundColor:c+"22",color:c,borderColor:c},children:s.name},s.id)})}),a.jsx("p",{children:pe.bio||"No bio set."}),(()=>{const s=FS(pe.id);return s?a.jsxs("div",{className:"message-embed-card",style:{marginTop:"8px",marginBottom:"8px"},children:[s.largeImageUrl&&a.jsx("img",{src:s.largeImageUrl,alt:s.largeImageText||"Activity",style:{width:"100%",borderRadius:"8px",marginBottom:"6px"}}),a.jsx("strong",{children:s.name||"Activity"}),s.details&&a.jsx("p",{children:s.details}),s.state&&a.jsx("p",{children:s.state}),Array.isArray(s.buttons)&&s.buttons.length>0&&a.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"6px"},children:s.buttons.map((c,u)=>a.jsx("a",{href:c.url,target:"_blank",rel:"noreferrer",className:"ghost",style:{padding:"4px 8px",borderRadius:"8px",border:"1px solid var(--border-subtle)",textDecoration:"none",color:"var(--text-soft)"},children:c.label},`${c.url}-${u}`))})]}):null})(),a.jsxs("div",{className:"popout-actions",children:[a.jsx("button",{className:"ghost",onClick:()=>Sc({id:pe.id,username:pe.username}),children:"Message"}),Io&&pe.id!==(l==null?void 0:l.id)&&a.jsx("button",{className:"ghost",onClick:()=>yu(pe.id),children:"Kick"}),Er&&pe.id!==(l==null?void 0:l.id)&&a.jsx("button",{className:"danger",onClick:()=>wu(pe.id,""),children:"Ban"}),a.jsx("button",{onClick:()=>ds(null),children:"Close"})]})]})]}),Wa&&a.jsx("div",{className:"settings-overlay",onClick:()=>Qa(null),children:a.jsxs("div",{className:"add-server-modal boost-upsell-modal",onClick:s=>s.stopPropagation(),children:[a.jsx("h3",{children:Wa.title}),a.jsx("p",{className:"hint",children:Wa.reason}),a.jsxs("div",{className:"row-actions boost-actions",children:[a.jsx("button",{onClick:lC,children:Wa.cta}),a.jsx("button",{className:"ghost",onClick:()=>Qa(null),children:"Maybe later"})]})]})}),Xs&&a.jsx("div",{className:"settings-overlay",onClick:()=>Zs(null),children:a.jsxs("div",{className:"add-server-modal boost-upsell-modal",onClick:s=>s.stopPropagation(),children:[a.jsx("h3",{children:"Redeem Boost Gift?"}),a.jsxs("p",{className:"hint",children:[a.jsx("strong",{children:((lg=Xs.from)==null?void 0:lg.username)||"Someone"})," sent you ",Xs.grantDays||30," days of Boost."]}),a.jsxs("p",{className:"hint",children:["This gift expires on ",Xs.expiresAt?new Date(Xs.expiresAt).toLocaleDateString():"soon","."]}),a.jsxs("div",{className:"row-actions boost-actions",children:[a.jsx("button",{onClick:()=>cC(Xs.code),disabled:Gh,children:Gh?"Redeeming":"Accept Gift"}),a.jsx("button",{className:"ghost",onClick:()=>Zs(null),children:"Not now"})]})]})}),as&&a.jsx("div",{className:"settings-overlay",onClick:()=>zt(!1),children:a.jsxs("div",{className:"settings-panel",onClick:s=>s.stopPropagation(),children:[a.jsxs("aside",{className:"settings-nav",children:[a.jsx("h3",{children:"Settings"}),a.jsx("button",{className:Ee==="profile"?"active":"ghost",onClick:()=>Ve("profile"),children:"Profile"}),a.jsx("button",{className:Ee==="security"?"active":"ghost",onClick:()=>{Ve("security"),rC()},children:" Security"}),a.jsx("button",{className:Ee==="billing"?"active":"ghost",onClick:()=>{Ve("billing"),Po(),ui()},children:" Billing"}),a.jsx("button",{className:Ee==="server"?"active":"ghost",onClick:()=>Ve("server"),children:"Server"}),a.jsx("button",{className:Ee==="roles"?"active":"ghost",onClick:()=>Ve("roles"),children:"Roles"}),mu&&a.jsx("button",{className:Ee==="moderation"?"active":"ghost",onClick:()=>Ve("moderation"),children:"Moderation"}),a.jsx("button",{className:Ee==="invites"?"active":"ghost",onClick:()=>Ve("invites"),children:"Invites"}),a.jsx("button",{className:Ee==="appearance"?"active":"ghost",onClick:()=>Ve("appearance"),children:"Appearance"}),a.jsx("button",{className:Ee==="extensions"?"active":"ghost",onClick:()=>Ve("extensions"),children:"Extensions"}),a.jsx("button",{className:Ee==="voice"?"active":"ghost",onClick:()=>Ve("voice"),children:"Voice"}),E.some(s=>s.roles.includes("owner"))&&a.jsx("a",{href:"/server-admin.html",target:"_blank",style:{display:"block",padding:"var(--space-sm) var(--space-md)",background:"rgba(149, 168, 205, 0.12)",border:"1px solid rgba(125, 164, 255, 0.25)",borderRadius:"calc(var(--radius) * 0.9)",color:"var(--text-main)",textDecoration:"none",textAlign:"center",fontWeight:"500",cursor:"pointer",fontSize:"0.95em"},children:" Server Admin Panel"}),a.jsx("button",{className:"ghost",onClick:()=>zt(!1),children:"Close"})]}),a.jsxs("section",{className:"settings-content",children:[Ee==="profile"&&a.jsxs("div",{className:"card",children:[a.jsx("h4",{children:"Profile Settings"}),a.jsxs("label",{children:["Display Name",a.jsx("input",{value:qn.displayName,onChange:s=>wr(c=>({...c,displayName:s.target.value}))})]}),a.jsxs("label",{children:["Bio",a.jsx("textarea",{rows:4,value:qn.bio,onChange:s=>wr(c=>({...c,bio:s.target.value}))})]}),a.jsxs("label",{children:["Avatar URL",a.jsx("input",{value:qn.pfpUrl,onChange:s=>wr(c=>({...c,pfpUrl:s.target.value}))})]}),a.jsxs("label",{children:["Upload Avatar",a.jsx("input",{type:"file",accept:"image/*",onChange:rx})]}),a.jsxs("label",{children:["Banner URL",a.jsx("input",{value:qn.bannerUrl,onChange:s=>wr(c=>({...c,bannerUrl:s.target.value}))})]}),a.jsxs("label",{children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:sx})]}),a.jsx("button",{onClick:wC,children:"Save Profile"}),a.jsx("hr",{style:{borderColor:"var(--border-subtle)",width:"100%"}}),a.jsx("h4",{children:"Rich Presence (RPC-style)"}),a.jsx("p",{className:"hint",children:"No app ID needed. Set activity text, image URLs, and optional buttons."}),a.jsxs("label",{children:["Activity Name",a.jsx("input",{value:sn.name,onChange:s=>Et(c=>({...c,name:s.target.value})),placeholder:"Playing OpenCom"})]}),a.jsxs("label",{children:["Details",a.jsx("input",{value:sn.details,onChange:s=>Et(c=>({...c,details:s.target.value})),placeholder:"In a voice channel"})]}),a.jsxs("label",{children:["State",a.jsx("input",{value:sn.state,onChange:s=>Et(c=>({...c,state:s.target.value})),placeholder:"With friends"})]}),a.jsxs("label",{children:["Large Image URL",a.jsx("input",{value:sn.largeImageUrl,onChange:s=>Et(c=>({...c,largeImageUrl:s.target.value})),placeholder:"https://..."})]}),a.jsxs("label",{children:["Upload Large Image",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"large image",c=>Et(u=>({...u,largeImageUrl:c})))})]}),a.jsxs("label",{children:["Large Image Text",a.jsx("input",{value:sn.largeImageText,onChange:s=>Et(c=>({...c,largeImageText:s.target.value})),placeholder:"Tooltip text"})]}),a.jsxs("label",{children:["Small Image URL",a.jsx("input",{value:sn.smallImageUrl,onChange:s=>Et(c=>({...c,smallImageUrl:s.target.value})),placeholder:"https://..."})]}),a.jsxs("label",{children:["Upload Small Image",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"small image",c=>Et(u=>({...u,smallImageUrl:c})))})]}),a.jsxs("label",{children:["Small Image Text",a.jsx("input",{value:sn.smallImageText,onChange:s=>Et(c=>({...c,smallImageText:s.target.value})),placeholder:"Tooltip text"})]}),a.jsxs("label",{children:["Button 1 Label",a.jsx("input",{value:sn.button1Label,onChange:s=>Et(c=>({...c,button1Label:s.target.value})),placeholder:"Watch"})]}),a.jsxs("label",{children:["Button 1 URL",a.jsx("input",{value:sn.button1Url,onChange:s=>Et(c=>({...c,button1Url:s.target.value})),placeholder:"https://..."})]}),a.jsxs("label",{children:["Button 2 Label",a.jsx("input",{value:sn.button2Label,onChange:s=>Et(c=>({...c,button2Label:s.target.value})),placeholder:"Join"})]}),a.jsxs("label",{children:["Button 2 URL",a.jsx("input",{value:sn.button2Url,onChange:s=>Et(c=>({...c,button2Url:s.target.value})),placeholder:"https://..."})]}),a.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[a.jsx("button",{onClick:_C,children:"Save Rich Presence"}),a.jsx("button",{className:"ghost",onClick:SC,children:"Clear"})]})]}),Ee==="server"&&a.jsxs(a.Fragment,{children:[D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Server Branding"}),a.jsx("input",{placeholder:"Server name",value:Hs.name??"",onChange:s=>rs(c=>({...c,name:s.target.value}))}),a.jsx("input",{placeholder:"Logo URL",value:Hs.logoUrl??"",onChange:s=>rs(c=>({...c,logoUrl:s.target.value}))}),a.jsxs("label",{children:["Upload Logo",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server logo",c=>rs(u=>({...u,logoUrl:c})))})]}),a.jsx("input",{placeholder:"Banner URL",value:Hs.bannerUrl??"",onChange:s=>rs(c=>({...c,bannerUrl:s.target.value}))}),a.jsxs("label",{children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server banner",c=>rs(u=>({...u,bannerUrl:c})))})]}),a.jsx("button",{onClick:CC,children:"Save Server Profile"})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Add Server Provider"}),a.jsx("input",{placeholder:"Server name",value:Ws??"",onChange:s=>Sd(s.target.value)}),a.jsx("input",{placeholder:"https://node.provider.tld",value:Qs??"https://",onChange:s=>Cd(s.target.value)}),a.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Ks??"",onChange:s=>uo(s.target.value)}),a.jsxs("label",{children:["Upload Logo",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server logo",uo)})]}),a.jsx("input",{placeholder:"Banner URL (optional)",value:xd??"",onChange:s=>po(s.target.value)}),a.jsxs("label",{children:["Upload Banner",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"server banner",po)})]}),a.jsx("button",{onClick:$m,disabled:!Ws.trim()||!Qs.trim()||!Ks.trim(),children:"Add Server"})]}),D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Voice Gateway Routing"}),a.jsx("p",{className:"hint",children:"Default is OpenCom core gateway. Switch to self-hosted to reduce latency for your server."}),a.jsxs("label",{children:["Voice Gateway Mode",a.jsxs("select",{value:Im.mode,onChange:s=>Um({mode:s.target.value==="server"?"server":"core"}),children:[a.jsx("option",{value:"core",children:"OpenCom Core (default)"}),a.jsx("option",{value:"server",children:"Self-hosted/Server-first"})]})]}),a.jsxs("label",{children:["Optional custom gateway URL",a.jsx("input",{placeholder:"https://gateway.yourserver.tld",value:Im.customUrl,onChange:s=>Um({customUrl:s.target.value})})]}),a.jsx("p",{className:"hint",children:"Client fallback order follows this mode and automatically tries the other gateways if one fails."})]}),D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Create Workspace"}),a.jsx("input",{placeholder:"Workspace name",value:ho??"",onChange:s=>Eh(s.target.value)}),a.jsx("button",{onClick:xC,children:"Create Workspace"})]}),D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Create Channel"}),a.jsx("input",{placeholder:"New channel/category",value:Td??"",onChange:s=>Ch(s.target.value)}),a.jsxs("select",{value:Ua??"text",onChange:s=>iS(s.target.value),children:[a.jsx("option",{value:"text",children:"Text Channel"}),a.jsx("option",{value:"voice",children:"Voice Channel"}),a.jsx("option",{value:"category",children:"Category"})]}),Ua!=="category"&&a.jsxs("select",{value:xh??"",onChange:s=>bh(s.target.value),children:[a.jsx("option",{value:"",children:"No category"}),(No||[]).map(s=>a.jsx("option",{value:(s==null?void 0:s.id)??"",children:(s==null?void 0:s.name)??"Category"},(s==null?void 0:s.id)??""))]}),a.jsx("button",{onClick:EC,children:"Create Channel"})]}),D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Custom Emotes"}),a.jsxs("p",{className:"hint",children:["Use emotes in chat with ",a.jsx("code",{children:":name:"}),"."]}),a.jsx("input",{placeholder:"Emote name (example: hype)",value:Dn,onChange:s=>tn(s.target.value)}),a.jsx("input",{placeholder:"Emote image URL (.png/.gif/.webp/.svg)",value:nn,onChange:s=>Qe(s.target.value)}),a.jsxs("label",{children:["Upload Emote Image",a.jsx("input",{type:"file",accept:"image/*",onChange:s=>Wt(s,"emote image",Qe)})]}),a.jsx("button",{onClick:kC,children:"Create Emote"}),a.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:((F==null?void 0:F.emotes)||[]).map(s=>a.jsxs("li",{children:[a.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[a.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:s.name}),a.jsxs("code",{children:[":",s.name,":"]})]}),a.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>TC(s.id),children:"Remove"})]},s.id))})]}),D&&ke&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Channel permissions"}),a.jsx("p",{className:"hint",children:"Choose a channel and set which roles can send messages there. By default everyone can send."}),a.jsxs("select",{value:ec,onChange:s=>cm(s.target.value),children:[a.jsx("option",{value:"",children:"Select channel"}),(li||[]).filter(s=>s.type==="text").map(s=>a.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]}),ec&&a.jsx("ul",{className:"channel-perms-role-list",children:((F==null?void 0:F.roles)||[]).filter(s=>!s.is_everyone).sort((s,c)=>(c.position??0)-(s.position??0)).map(s=>a.jsx("li",{children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:jC(ec,s.id),onChange:c=>NC(ec,s.id,c.target.checked)}),a.jsx("span",{className:"channel-perms-role-name",style:{color:s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5"},children:s.name}),a.jsx("span",{className:"hint",children:" can send here"})]})},s.id))})]}),Ee==="server"&&!D&&E.length>0&&a.jsx("p",{className:"hint",children:"Select a server from the sidebar to manage workspaces and channels."})]}),Ee==="roles"&&ke&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Create Role"}),a.jsx("input",{placeholder:"Role name",value:Dd,onChange:s=>Mh(s.target.value)}),a.jsx("button",{onClick:PC,children:"Create Role"})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Edit Roles (colour & hierarchy)"}),a.jsx("p",{className:"hint",children:"Higher position = higher in the list. Colours show in member list and chat."}),a.jsx("ul",{className:"role-edit-list",children:((F==null?void 0:F.roles)||[]).filter(s=>!s.is_everyone).sort((s,c)=>(c.position??0)-(s.position??0)).map(s=>{const c=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return a.jsxs("li",{className:"role-edit-row",children:[a.jsx("span",{className:"role-edit-name",style:{color:c},children:s.name}),a.jsx("input",{type:"color",value:c,onChange:u=>Qm(s.id,{color:u.target.value}),title:"Role colour"}),a.jsxs("label",{children:["Position ",a.jsx("input",{type:"number",min:0,value:s.position??0,onChange:u=>Qm(s.id,{position:parseInt(u.target.value,10)||0})})]})]},s.id)})})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Assign Role"}),a.jsxs("select",{value:Md,onChange:s=>wS(s.target.value),children:[a.jsx("option",{value:"",children:"Select member"}),mt.map(s=>a.jsx("option",{value:s.id,children:s.username},s.id))]}),a.jsxs("select",{value:Ld,onChange:s=>yS(s.target.value),children:[a.jsx("option",{value:"",children:"Select role"}),((F==null?void 0:F.roles)||[]).filter(s=>!s.is_everyone).map(s=>a.jsx("option",{value:s.id,children:s.name},s.id))]}),a.jsx("button",{onClick:DC,children:"Assign Role"})]})]}),Ee==="moderation"&&mu&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Member moderation"}),a.jsx("p",{className:"hint",children:"Kick removes a member from this guild. Ban removes and blocks rejoin until unbanned."}),a.jsxs("select",{value:vo,onChange:s=>Oh(s.target.value),children:[a.jsx("option",{value:"",children:"Select member"}),mt.filter(s=>s.id!==(l==null?void 0:l.id)).map(s=>a.jsx("option",{value:s.id,children:s.username},s.id))]}),Er&&a.jsx("input",{placeholder:"Ban reason (optional)",value:Ah,onChange:s=>_S(s.target.value)}),a.jsxs("div",{className:"row-actions",children:[Io&&a.jsx("button",{disabled:!vo||Js,onClick:()=>yu(vo),children:"Kick Member"}),Er&&a.jsx("button",{className:"danger",disabled:!vo||Js,onClick:()=>wu(vo,Ah),children:"Ban Member"})]})]}),Er&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Unban user"}),a.jsx("p",{className:"hint",children:"Paste a user ID and remove their ban record."}),a.jsx("input",{placeholder:"User ID to unban",value:Od,onChange:s=>$h(s.target.value)}),a.jsx("button",{disabled:!Od.trim()||Js,onClick:()=>LC(Od.trim()),children:"Unban User"})]})]}),Ee==="invites"&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Join Server"}),a.jsx("input",{placeholder:"Paste invite code or join link",value:_r,onChange:s=>fo(s.target.value)}),a.jsxs("div",{className:"row-actions",children:[a.jsx("button",{className:"ghost",onClick:Fm,children:"Preview"}),a.jsx("button",{onClick:()=>Cc(Pt||_r),children:"Accept Invite"})]}),Mn&&a.jsxs("p",{className:"hint",children:["Invite: ",Mn.code,"  Server: ",Mn.serverName||Mn.server_id,"  Uses: ",Mn.uses]})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Create Invite"}),a.jsxs("p",{className:"hint",children:["Boost perk: custom code + permanent invite links (example: ",a.jsx("code",{children:"/join/Open"}),")."]}),a.jsxs("select",{value:bd,onChange:s=>wh(s.target.value),children:[a.jsx("option",{value:"",children:"Select server"}),E.map(s=>a.jsx("option",{value:s.id,children:s.name},s.id))]}),a.jsx("input",{placeholder:"Custom code (Boost perk, optional)",value:Ed,onChange:s=>Sh(s.target.value),onFocus:()=>{qe&&!qe.active&&_c("Custom invite codes require OpenCom Boost.")}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("input",{type:"checkbox",checked:kd,onChange:s=>{if(s.target.checked&&qe&&!qe.active){_c("Permanent invite links require OpenCom Boost.");return}sS(s.target.checked)}}),"Permanent invite (Boost perk)"]}),a.jsx("button",{onClick:bC,children:"Generate Invite"}),Aa&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"hint",children:["Code: ",a.jsx("code",{children:Aa})]}),a.jsx("p",{className:"hint",children:"Invite link (share this):"}),a.jsxs("div",{className:"invite-link-row",children:[a.jsx("input",{readOnly:!0,className:"invite-link-input",value:_h||op(Aa)}),a.jsx("button",{type:"button",onClick:()=>{const s=_h||op(Aa);navigator.clipboard.writeText(s).then(()=>_("Invite link copied.")).catch(()=>_("Could not copy."))},children:"Copy link"})]})]})]})]}),Ee==="extensions"&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Client Extensions"}),a.jsx("p",{className:"hint",children:"Enable reviewed client-only extensions from the catalog. Extensions run in your client session."}),hm.length?a.jsx("ul",{className:"channel-perms-role-list",children:hm.map(s=>{const c=xo.includes(s.id);return a.jsxs("li",{children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:c,onChange:u=>QS(s.id,u.target.checked)}),a.jsx("strong",{children:s.name}),a.jsxs("span",{className:"hint",children:["  ",s.id,"  ",s.version||"0.1.0"]}),a.jsx("span",{className:"hint",style:{marginLeft:"6px",color:c?"#4ec97e":"#f0a4a4"},children:c?"Enabled":"Disabled"})]}),s.description&&a.jsx("p",{className:"hint",style:{margin:"4px 0 0 24px"},children:s.description}),oc[s.id]&&a.jsxs("p",{className:"hint",style:{margin:"2px 0 0 24px"},children:["Status: ",oc[s.id]]})]},s.id)})}):a.jsx("p",{className:"hint",children:"No client extensions found in the catalog."})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Developer Mode"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("input",{type:"checkbox",checked:si,onChange:s=>US(s.target.checked)}),"Enable local/testing extension URLs"]}),a.jsx("p",{className:"hint",children:"Use this while developing extensions. Add one URL per extension entry script."}),si&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"row-actions",style:{marginTop:"8px"},children:[a.jsx("input",{placeholder:"http://localhost:5174/my-extension.js",value:gm,onChange:s=>vm(s.target.value),style:{flex:1}}),a.jsx("button",{onClick:KS,children:"Add URL"})]}),a.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:bo.map(s=>a.jsxs("li",{children:[a.jsx("span",{style:{wordBreak:"break-all"},children:s}),a.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>mm(c=>c.filter(u=>u!==s)),children:"Remove"}),oc[`dev:${s}`]&&a.jsxs("p",{className:"hint",style:{margin:"4px 0 0 0"},children:["Status: ",oc[`dev:${s}`]]})]},s))})]})]})]}),Ee==="appearance"&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Custom CSS Theme"}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:TS,onChange:s=>RS(s.target.checked)})," Enable custom CSS"]}),a.jsx("input",{type:"file",accept:"text/css,.css",onChange:ax}),a.jsx("textarea",{value:kS,onChange:s=>Xh(s.target.value),rows:10,placeholder:"Paste custom CSS"})]}),Ee==="voice"&&a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Voice Settings"}),a.jsxs("label",{children:["Input Device",a.jsxs("select",{value:Xn,onChange:s=>jh(s.target.value),children:[a.jsx("option",{value:"",children:"System default"}),uS.map(s=>a.jsx("option",{value:s.deviceId,children:s.label||`Microphone ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),a.jsxs("label",{children:["Output Device",a.jsxs("select",{value:Sr,onChange:s=>Ph(s.target.value),children:[a.jsx("option",{value:"",children:"System default"}),fS.map(s=>a.jsx("option",{value:s.deviceId,children:s.label||`Speaker ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),a.jsxs("label",{children:["Microphone Gain (",Ba,"%)",a.jsx("input",{type:"range",min:"0",max:"200",step:"5",value:Ba,onChange:s=>lS(Number(s.target.value))})]}),a.jsxs("label",{children:["Mic Sensitivity (",Ys,"%)",a.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Ys,onChange:s=>dS(Number(s.target.value))})]}),a.jsx("p",{className:"hint",children:"Tip: allow microphone permissions so device names show properly."})]}),Ee==="billing"&&a.jsxs("section",{className:"card boost-card",children:[a.jsxs("div",{className:"boost-hero",children:[a.jsx("span",{className:`boost-pill ${qe!=null&&qe.active?"active":""}`,children:qe!=null&&qe.active?"BOOST ACTIVE":"BOOST INACTIVE"}),a.jsx("h4",{children:"OpenCom Boost"}),a.jsx("p",{className:"hint",children:"Unlock custom invite codes, permanent invite links, and higher limits."})]}),a.jsxs("div",{className:"boost-grid",children:[a.jsxs("div",{className:"boost-price",children:[a.jsx("strong",{children:"10"}),a.jsx("span",{children:"/ month"})]}),a.jsxs("ul",{className:"boost-perks",children:[a.jsx("li",{children:"Custom invite code slugs"}),a.jsx("li",{children:"Permanent invite links"}),a.jsx("li",{children:"100MB upload limit"}),a.jsx("li",{children:"Unlimited servers"})]})]}),xS&&a.jsx("p",{className:"hint",children:"Loading billing status"}),qe&&a.jsxs("p",{className:"hint",children:["Status: ",qe.active?"Active":"Inactive",qe.currentPeriodEnd?`  Renews ${new Date(qe.currentPeriodEnd).toLocaleDateString()}`:""]}),qe&&!qe.stripeConfigured&&a.jsx("p",{className:"hint",children:"Stripe is not configured on this server yet."}),a.jsxs("div",{className:"row-actions boost-actions",children:[a.jsx("button",{onClick:sC,children:"Get Boost"}),a.jsx("button",{className:"ghost",onClick:iC,children:"Manage"}),a.jsx("button",{className:"ghost",onClick:Po,children:"Refresh"})]}),a.jsx("hr",{className:"boost-divider"}),a.jsxs("div",{className:"boost-gift-head",children:[a.jsx("h5",{children:"Gift Boost (1 month)"}),a.jsx("p",{className:"hint",children:"Buy a one-month gift link and send it to a friend."})]}),a.jsxs("div",{className:"row-actions boost-actions boost-gift-actions",children:[a.jsx("button",{onClick:oC,disabled:Wh,children:Wh?"Opening checkout":"Buy Gift (10)"}),a.jsx("button",{className:"ghost",onClick:ui,children:"Refresh Gifts"})]}),a.jsxs("div",{className:"invite-link-row",children:[a.jsx("input",{className:"invite-link-input",placeholder:"Paste boost gift link or code",value:Ad,onChange:s=>Ka(s.target.value)}),a.jsx("button",{type:"button",onClick:()=>Am(Ad),disabled:Bh,children:Bh?"Checking":"Preview"})]}),yo&&a.jsxs("div",{className:"boost-gift-preview",children:[a.jsxs("p",{className:"hint",children:["Gift from ",a.jsx("strong",{children:((dg=yo.from)==null?void 0:dg.username)||"someone"}),"  ",yo.grantDays," day(s)"]}),a.jsxs("p",{className:"hint",children:["Expires ",new Date(yo.expiresAt).toLocaleDateString()]}),a.jsx("button",{onClick:()=>Zs(yo),children:"Redeem Gift"})]}),Kh.length>0&&a.jsxs("div",{className:"boost-gift-list",children:[a.jsx("p",{className:"hint",children:"Your recent gifts"}),Kh.slice(0,5).map(s=>a.jsxs("div",{className:"boost-gift-row",children:[a.jsx("span",{children:s.status.toUpperCase()}),a.jsx("input",{readOnly:!0,value:s.joinUrl||Kv(s.code)}),a.jsx("button",{type:"button",onClick:()=>{const c=s.joinUrl||Kv(s.code);navigator.clipboard.writeText(c).then(()=>_("Gift link copied.")).catch(()=>_("Could not copy gift link."))},children:"Copy"})]},s.id))]})]}),Ee==="security"&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"card security-card",children:[a.jsx("h4",{children:" Account Security"}),a.jsxs("div",{className:"security-info",children:[a.jsxs("p",{className:"hint",children:["Last login: ",new Date(tm.date).toLocaleString()]}),a.jsxs("p",{className:"hint",children:["Device: ",tm.device]})]})]}),a.jsxs("section",{className:"card security-card",children:[a.jsx("h4",{children:" Change Password"}),NS?a.jsxs(a.Fragment,{children:[a.jsxs("label",{children:["Current Password",a.jsx("input",{type:"password",value:Zh,onChange:s=>Hd(s.target.value)})]}),a.jsxs("label",{children:["New Password",a.jsx("input",{type:"password",value:Ya,onChange:s=>Wd(s.target.value)})]}),a.jsxs("label",{children:["Confirm Password",a.jsx("input",{type:"password",value:em,onChange:s=>Qd(s.target.value)})]}),a.jsxs("div",{className:"row-actions",children:[a.jsx("button",{className:"ghost",onClick:()=>{Gd(!1),Hd(""),Wd(""),Qd("")},children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(Ya!==em){_("Passwords do not match.");return}if(Ya.length<8){_("Password must be at least 8 characters.");return}try{await se("/v1/auth/password",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({currentPassword:Zh,newPassword:Ya})}),_("Password changed successfully."),Gd(!1),Hd(""),Wd(""),Qd("")}catch(s){_(`Could not change password: ${s.message}`)}},children:"Update Password"})]})]}):a.jsx("button",{onClick:()=>Gd(!0),children:"Change Password"})]}),a.jsxs("section",{className:"card security-card",children:[a.jsx("h4",{children:" Two-Factor Authentication"}),a.jsx("p",{className:"hint",children:"Secure your account with an additional authentication layer"}),!om.twoFactorEnabled&&!im&&a.jsx("button",{onClick:pC,children:"Enable 2FA"}),im&&!LS&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"hint",style:{marginTop:"var(--space-sm)",fontWeight:600},children:" Step 1: Scan QR Code"}),a.jsx("p",{className:"hint",children:"Scan this QR code with an authenticator app (Google Authenticator, Authy, Microsoft Authenticator, etc.):"}),nm&&a.jsx("img",{src:nm,alt:"2FA QR Code",style:{width:"200px",height:"200px",border:"2px solid rgba(125, 164, 255, 0.3)",borderRadius:"var(--radius)",margin:"var(--space-sm) 0",background:"#fff",padding:"0.5em"}}),a.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 2: Verify Token"}),a.jsx("p",{className:"hint",children:"Enter a 6-digit code from your authenticator app:"}),a.jsx("input",{type:"text",placeholder:"000000",value:sm,onChange:s=>Yd(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:"6",style:{textAlign:"center",fontSize:"1.2em",letterSpacing:"0.3em",fontFamily:"monospace"}}),a.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 3: Save Backup Codes"}),a.jsx("p",{className:"hint",children:"Save these backup codes somewhere safe. You can use them to regain access if you lose your authenticator."}),a.jsx("code",{style:{display:"block",background:"var(--bg-input)",padding:"var(--space-sm)",borderRadius:"calc(var(--radius)*0.8)",fontSize:"0.85em",marginBottom:"var(--space-sm)",whiteSpace:"pre-wrap",wordBreak:"break-all",fontFamily:"monospace",lineHeight:"1.8"},children:rm.map(s=>`${s}
`).join("")}),a.jsxs("div",{className:"row-actions",children:[a.jsx("button",{className:"ghost",onClick:()=>{qa(!1),Kd(""),Ja([]),Yd("")},children:"Cancel"}),a.jsx("button",{onClick:vC,children:"Verify & Enable 2FA"})]})]}),om.twoFactorEnabled&&a.jsxs(a.Fragment,{children:[a.jsx("p",{style:{color:"var(--green)",fontWeight:600,marginTop:"var(--space-sm)"},children:" 2FA is enabled"}),a.jsx("p",{className:"hint",children:"Your account is protected with two-factor authentication. Your backup codes are stored securely."}),a.jsx("button",{className:"danger",onClick:yC,style:{marginTop:"var(--space-sm)"},children:"Disable 2FA"})]})]}),a.jsxs("section",{className:"card security-card",children:[a.jsx("h4",{children:" Active Sessions"}),a.jsx("p",{className:"hint",children:"Devices where you're logged in. Sign out of any session you don't recognize."}),jS.map(s=>a.jsxs("div",{className:"session-item",children:[a.jsxs("div",{className:"session-info",children:[a.jsx("strong",{children:s.device}),a.jsx("span",{className:"hint",children:s.location}),a.jsxs("span",{className:"hint",children:["Last active: ",s.lastActive]})]}),a.jsx("button",{className:s.status==="active"?"ghost":"danger",onClick:()=>_(`Session ${s.device} would be signed out.`),children:s.status==="active"?"Current":"Sign Out"})]},s.id))]}),a.jsxs("section",{className:"card security-card danger-card",children:[a.jsx("h4",{children:" Danger Zone"}),a.jsx("p",{className:"hint",children:"Irreversible actions. Proceed with caution."}),a.jsx("button",{className:"danger",onClick:()=>{window.confirm("Are you absolutely sure? This cannot be undone.")&&_("Account deletion request submitted for review.")},children:"Delete Account Permanently"})]}),a.jsxs("section",{className:"card",children:[a.jsx("h4",{children:"Security Privacy"}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox"})," Log out of all other sessions"]}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox"})," Show security alerts"]}),a.jsx("button",{onClick:()=>_("Privacy settings saved."),children:"Save Security Settings"})]})]}),a.jsx("p",{className:"status",children:j})]})]})})]}):ps===pr?a.jsx(Zk,{downloadMenuRef:pu,downloadsMenuOpen:MS,setDownloadsMenuOpen:Zd,downloadTargets:af,preferredDownloadTarget:VS,onOpenClient:()=>er(_s)}):a.jsx(e1,{authMode:h,setAuthMode:m,email:g,setEmail:f,username:S,setUsername:T,password:A,setPassword:G,pendingVerificationEmail:B,status:j,onSubmit:XS,onResendVerification:ZS,onBackHome:()=>er(pr)})}N_(document.getElementById("root")).render(a.jsx(Tx.StrictMode,{children:a.jsx(R1,{})}));
