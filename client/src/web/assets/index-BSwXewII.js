var YS=Object.defineProperty;var tm=e=>{throw TypeError(e)};var JS=(e,t,n)=>t in e?YS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>JS(e,typeof t!="symbol"?t+"":t,n),nm=(e,t,n)=>t.has(e)||tm("Cannot "+n);var oe=(e,t,n)=>(nm(e,t,"read from private field"),n?n.call(e):t.get(e)),Ke=(e,t,n)=>t.has(e)?tm("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ce=(e,t,n,r)=>(nm(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function qS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ov={exports:{}},il={},cv={exports:{}},ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var no=Symbol.for("react.element"),XS=Symbol.for("react.portal"),ZS=Symbol.for("react.fragment"),eC=Symbol.for("react.strict_mode"),tC=Symbol.for("react.profiler"),nC=Symbol.for("react.provider"),rC=Symbol.for("react.context"),sC=Symbol.for("react.forward_ref"),iC=Symbol.for("react.suspense"),aC=Symbol.for("react.memo"),oC=Symbol.for("react.lazy"),rm=Symbol.iterator;function cC(e){return e===null||typeof e!="object"?null:(e=rm&&e[rm]||e["@@iterator"],typeof e=="function"?e:null)}var lv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dv=Object.assign,uv={};function Di(e,t,n){this.props=e,this.context=t,this.refs=uv,this.updater=n||lv}Di.prototype.isReactComponent={};Di.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Di.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function pv(){}pv.prototype=Di.prototype;function mp(e,t,n){this.props=e,this.context=t,this.refs=uv,this.updater=n||lv}var gp=mp.prototype=new pv;gp.constructor=mp;dv(gp,Di.prototype);gp.isPureReactComponent=!0;var sm=Array.isArray,fv=Object.prototype.hasOwnProperty,vp={current:null},hv={key:!0,ref:!0,__self:!0,__source:!0};function mv(e,t,n){var r,i={},a=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)fv.call(t,r)&&!hv.hasOwnProperty(r)&&(i[r]=t[r]);var f=arguments.length-2;if(f===1)i.children=n;else if(1<f){for(var m=Array(f),_=0;_<f;_++)m[_]=arguments[_+2];i.children=m}if(e&&e.defaultProps)for(r in f=e.defaultProps,f)i[r]===void 0&&(i[r]=f[r]);return{$$typeof:no,type:e,key:a,ref:o,props:i,_owner:vp.current}}function lC(e,t){return{$$typeof:no,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function yp(e){return typeof e=="object"&&e!==null&&e.$$typeof===no}function dC(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var im=/\/+/g;function Ld(e,t){return typeof e=="object"&&e!==null&&e.key!=null?dC(""+e.key):t.toString(36)}function mc(e,t,n,r,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case no:case XS:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Ld(o,0):r,sm(i)?(n="",e!=null&&(n=e.replace(im,"$&/")+"/"),mc(i,t,n,"",function(_){return _})):i!=null&&(yp(i)&&(i=lC(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(im,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",sm(e))for(var f=0;f<e.length;f++){a=e[f];var m=r+Ld(a,f);o+=mc(a,t,n,m,i)}else if(m=cC(e),typeof m=="function")for(e=m.call(e),f=0;!(a=e.next()).done;)a=a.value,m=r+Ld(a,f++),o+=mc(a,t,n,m,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ko(e,t,n){if(e==null)return e;var r=[],i=0;return mc(e,r,"","",function(a){return t.call(n,a,i++)}),r}function uC(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var gt={current:null},gc={transition:null},pC={ReactCurrentDispatcher:gt,ReactCurrentBatchConfig:gc,ReactCurrentOwner:vp};function gv(){throw Error("act(...) is not supported in production builds of React.")}ue.Children={map:Ko,forEach:function(e,t,n){Ko(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ko(e,function(){t++}),t},toArray:function(e){return Ko(e,function(t){return t})||[]},only:function(e){if(!yp(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ue.Component=Di;ue.Fragment=ZS;ue.Profiler=tC;ue.PureComponent=mp;ue.StrictMode=eC;ue.Suspense=iC;ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pC;ue.act=gv;ue.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=dv({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=vp.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var f=e.type.defaultProps;for(m in t)fv.call(t,m)&&!hv.hasOwnProperty(m)&&(r[m]=t[m]===void 0&&f!==void 0?f[m]:t[m])}var m=arguments.length-2;if(m===1)r.children=n;else if(1<m){f=Array(m);for(var _=0;_<m;_++)f[_]=arguments[_+2];r.children=f}return{$$typeof:no,type:e.type,key:i,ref:a,props:r,_owner:o}};ue.createContext=function(e){return e={$$typeof:rC,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:nC,_context:e},e.Consumer=e};ue.createElement=mv;ue.createFactory=function(e){var t=mv.bind(null,e);return t.type=e,t};ue.createRef=function(){return{current:null}};ue.forwardRef=function(e){return{$$typeof:sC,render:e}};ue.isValidElement=yp;ue.lazy=function(e){return{$$typeof:oC,_payload:{_status:-1,_result:e},_init:uC}};ue.memo=function(e,t){return{$$typeof:aC,type:e,compare:t===void 0?null:t}};ue.startTransition=function(e){var t=gc.transition;gc.transition={};try{e()}finally{gc.transition=t}};ue.unstable_act=gv;ue.useCallback=function(e,t){return gt.current.useCallback(e,t)};ue.useContext=function(e){return gt.current.useContext(e)};ue.useDebugValue=function(){};ue.useDeferredValue=function(e){return gt.current.useDeferredValue(e)};ue.useEffect=function(e,t){return gt.current.useEffect(e,t)};ue.useId=function(){return gt.current.useId()};ue.useImperativeHandle=function(e,t,n){return gt.current.useImperativeHandle(e,t,n)};ue.useInsertionEffect=function(e,t){return gt.current.useInsertionEffect(e,t)};ue.useLayoutEffect=function(e,t){return gt.current.useLayoutEffect(e,t)};ue.useMemo=function(e,t){return gt.current.useMemo(e,t)};ue.useReducer=function(e,t,n){return gt.current.useReducer(e,t,n)};ue.useRef=function(e){return gt.current.useRef(e)};ue.useState=function(e){return gt.current.useState(e)};ue.useSyncExternalStore=function(e,t,n){return gt.current.useSyncExternalStore(e,t,n)};ue.useTransition=function(){return gt.current.useTransition()};ue.version="18.3.1";cv.exports=ue;var b=cv.exports;const fC=qS(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hC=b,mC=Symbol.for("react.element"),gC=Symbol.for("react.fragment"),vC=Object.prototype.hasOwnProperty,yC=hC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wC={key:!0,ref:!0,__self:!0,__source:!0};function vv(e,t,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)vC.call(t,r)&&!wC.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:mC,type:e,key:a,ref:o,props:i,_owner:yC.current}}il.Fragment=gC;il.jsx=vv;il.jsxs=vv;ov.exports=il;var c=ov.exports,yv={exports:{}},Ot={},wv={exports:{}},_v={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(H,J){var Q=H.length;H.push(J);e:for(;0<Q;){var X=Q-1>>>1,le=H[X];if(0<i(le,J))H[X]=J,H[Q]=le,Q=X;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var J=H[0],Q=H.pop();if(Q!==J){H[0]=Q;e:for(var X=0,le=H.length,$t=le>>>1;X<$t;){var Ge=2*(X+1)-1,Jt=H[Ge],Ae=Ge+1,tr=H[Ae];if(0>i(Jt,Q))Ae<le&&0>i(tr,Jt)?(H[X]=tr,H[Ae]=Q,X=Ae):(H[X]=Jt,H[Ge]=Q,X=Ge);else if(Ae<le&&0>i(tr,Q))H[X]=tr,H[Ae]=Q,X=Ae;else break e}}return J}function i(H,J){var Q=H.sortIndex-J.sortIndex;return Q!==0?Q:H.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,f=o.now();e.unstable_now=function(){return o.now()-f}}var m=[],_=[],p=1,S=null,k=3,M=!1,V=!1,B=!1,v=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(H){for(var J=n(_);J!==null;){if(J.callback===null)r(_);else if(J.startTime<=H)r(_),J.sortIndex=J.expirationTime,t(m,J);else break;J=n(_)}}function C(H){if(B=!1,g(H),!V)if(n(m)!==null)V=!0,ae(N);else{var J=n(_);J!==null&&L(C,J.startTime-H)}}function N(H,J){V=!1,B&&(B=!1,l(R),R=-1),M=!0;var Q=k;try{for(g(J),S=n(m);S!==null&&(!(S.expirationTime>J)||H&&!j());){var X=S.callback;if(typeof X=="function"){S.callback=null,k=S.priorityLevel;var le=X(S.expirationTime<=J);J=e.unstable_now(),typeof le=="function"?S.callback=le:S===n(m)&&r(m),g(J)}else r(m);S=n(m)}if(S!==null)var $t=!0;else{var Ge=n(_);Ge!==null&&L(C,Ge.startTime-J),$t=!1}return $t}finally{S=null,k=Q,M=!1}}var w=!1,x=null,R=-1,D=5,P=-1;function j(){return!(e.unstable_now()-P<D)}function $(){if(x!==null){var H=e.unstable_now();P=H;var J=!0;try{J=x(!0,H)}finally{J?z():(w=!1,x=null)}}else w=!1}var z;if(typeof u=="function")z=function(){u($)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Z=G.port2;G.port1.onmessage=$,z=function(){Z.postMessage(null)}}else z=function(){v($,0)};function ae(H){x=H,w||(w=!0,z())}function L(H,J){R=v(function(){H(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){V||M||(V=!0,ae(N))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return k},e.unstable_getFirstCallbackNode=function(){return n(m)},e.unstable_next=function(H){switch(k){case 1:case 2:case 3:var J=3;break;default:J=k}var Q=k;k=J;try{return H()}finally{k=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,J){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Q=k;k=H;try{return J()}finally{k=Q}},e.unstable_scheduleCallback=function(H,J,Q){var X=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?X+Q:X):Q=X,H){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=Q+le,H={id:p++,callback:J,priorityLevel:H,startTime:Q,expirationTime:le,sortIndex:-1},Q>X?(H.sortIndex=Q,t(_,H),n(m)===null&&H===n(_)&&(B?(l(R),R=-1):B=!0,L(C,Q-X))):(H.sortIndex=le,t(m,H),V||M||(V=!0,ae(N))),H},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(H){var J=k;return function(){var Q=k;k=J;try{return H.apply(this,arguments)}finally{k=Q}}}})(_v);wv.exports=_v;var _C=wv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SC=b,Mt=_C;function K(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sv=new Set,$a={};function _s(e,t){ki(e,t),ki(e+"Capture",t)}function ki(e,t){for($a[e]=t,e=0;e<t.length;e++)Sv.add(t[e])}var Yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gu=Object.prototype.hasOwnProperty,CC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,am={},om={};function xC(e){return gu.call(om,e)?!0:gu.call(am,e)?!1:CC.test(e)?om[e]=!0:(am[e]=!0,!1)}function bC(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function EC(e,t,n,r){if(t===null||typeof t>"u"||bC(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function vt(e,t,n,r,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var Ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ze[e]=new vt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ze[t]=new vt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ze[e]=new vt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ze[e]=new vt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ze[e]=new vt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ze[e]=new vt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ze[e]=new vt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ze[e]=new vt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ze[e]=new vt(e,5,!1,e.toLowerCase(),null,!1,!1)});var wp=/[\-:]([a-z])/g;function _p(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(wp,_p);Ze[t]=new vt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(wp,_p);Ze[t]=new vt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(wp,_p);Ze[t]=new vt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ze[e]=new vt(e,1,!1,e.toLowerCase(),null,!1,!1)});Ze.xlinkHref=new vt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ze[e]=new vt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Sp(e,t,n,r){var i=Ze.hasOwnProperty(t)?Ze[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(EC(t,n,i,r)&&(n=null),r||i===null?xC(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Zn=SC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yo=Symbol.for("react.element"),ti=Symbol.for("react.portal"),ni=Symbol.for("react.fragment"),Cp=Symbol.for("react.strict_mode"),vu=Symbol.for("react.profiler"),Cv=Symbol.for("react.provider"),xv=Symbol.for("react.context"),xp=Symbol.for("react.forward_ref"),yu=Symbol.for("react.suspense"),wu=Symbol.for("react.suspense_list"),bp=Symbol.for("react.memo"),lr=Symbol.for("react.lazy"),bv=Symbol.for("react.offscreen"),cm=Symbol.iterator;function aa(e){return e===null||typeof e!="object"?null:(e=cm&&e[cm]||e["@@iterator"],typeof e=="function"?e:null)}var Pe=Object.assign,Md;function Ca(e){if(Md===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Md=t&&t[1]||""}return`
`+Md+e}var Od=!1;function Ad(e,t){if(!e||Od)return"";Od=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(_){var r=_}Reflect.construct(e,[],t)}else{try{t.call()}catch(_){r=_}e.call(t.prototype)}else{try{throw Error()}catch(_){r=_}e()}}catch(_){if(_&&r&&typeof _.stack=="string"){for(var i=_.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,f=a.length-1;1<=o&&0<=f&&i[o]!==a[f];)f--;for(;1<=o&&0<=f;o--,f--)if(i[o]!==a[f]){if(o!==1||f!==1)do if(o--,f--,0>f||i[o]!==a[f]){var m=`
`+i[o].replace(" at new "," at ");return e.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",e.displayName)),m}while(1<=o&&0<=f);break}}}finally{Od=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ca(e):""}function kC(e){switch(e.tag){case 5:return Ca(e.type);case 16:return Ca("Lazy");case 13:return Ca("Suspense");case 19:return Ca("SuspenseList");case 0:case 2:case 15:return e=Ad(e.type,!1),e;case 11:return e=Ad(e.type.render,!1),e;case 1:return e=Ad(e.type,!0),e;default:return""}}function _u(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ni:return"Fragment";case ti:return"Portal";case vu:return"Profiler";case Cp:return"StrictMode";case yu:return"Suspense";case wu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case xv:return(e.displayName||"Context")+".Consumer";case Cv:return(e._context.displayName||"Context")+".Provider";case xp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case bp:return t=e.displayName||null,t!==null?t:_u(e.type)||"Memo";case lr:t=e._payload,e=e._init;try{return _u(e(t))}catch{}}return null}function TC(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _u(t);case 8:return t===Cp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Er(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ev(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function RC(e){var t=Ev(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Jo(e){e._valueTracker||(e._valueTracker=RC(e))}function kv(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Ev(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Mc(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Su(e,t){var n=t.checked;return Pe({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function lm(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Er(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Tv(e,t){t=t.checked,t!=null&&Sp(e,"checked",t,!1)}function Cu(e,t){Tv(e,t);var n=Er(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?xu(e,t.type,n):t.hasOwnProperty("defaultValue")&&xu(e,t.type,Er(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function dm(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function xu(e,t,n){(t!=="number"||Mc(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var xa=Array.isArray;function mi(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Er(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function bu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(K(91));return Pe({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function um(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(K(92));if(xa(n)){if(1<n.length)throw Error(K(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Er(n)}}function Rv(e,t){var n=Er(t.value),r=Er(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function pm(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Iv(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Eu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Iv(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var qo,Nv=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(qo=qo||document.createElement("div"),qo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=qo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Fa(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},IC=["Webkit","ms","Moz","O"];Object.keys(ka).forEach(function(e){IC.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ka[t]=ka[e]})});function Pv(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||ka.hasOwnProperty(e)&&ka[e]?(""+t).trim():t+"px"}function jv(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Pv(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var NC=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ku(e,t){if(t){if(NC[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(K(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(K(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(K(61))}if(t.style!=null&&typeof t.style!="object")throw Error(K(62))}}function Tu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ru=null;function Ep(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Iu=null,gi=null,vi=null;function fm(e){if(e=io(e)){if(typeof Iu!="function")throw Error(K(280));var t=e.stateNode;t&&(t=dl(t),Iu(e.stateNode,e.type,t))}}function Dv(e){gi?vi?vi.push(e):vi=[e]:gi=e}function Lv(){if(gi){var e=gi,t=vi;if(vi=gi=null,fm(e),t)for(e=0;e<t.length;e++)fm(t[e])}}function Mv(e,t){return e(t)}function Ov(){}var $d=!1;function Av(e,t,n){if($d)return e(t,n);$d=!0;try{return Mv(e,t,n)}finally{$d=!1,(gi!==null||vi!==null)&&(Ov(),Lv())}}function Ua(e,t){var n=e.stateNode;if(n===null)return null;var r=dl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(K(231,t,typeof n));return n}var Nu=!1;if(Yn)try{var oa={};Object.defineProperty(oa,"passive",{get:function(){Nu=!0}}),window.addEventListener("test",oa,oa),window.removeEventListener("test",oa,oa)}catch{Nu=!1}function PC(e,t,n,r,i,a,o,f,m){var _=Array.prototype.slice.call(arguments,3);try{t.apply(n,_)}catch(p){this.onError(p)}}var Ta=!1,Oc=null,Ac=!1,Pu=null,jC={onError:function(e){Ta=!0,Oc=e}};function DC(e,t,n,r,i,a,o,f,m){Ta=!1,Oc=null,PC.apply(jC,arguments)}function LC(e,t,n,r,i,a,o,f,m){if(DC.apply(this,arguments),Ta){if(Ta){var _=Oc;Ta=!1,Oc=null}else throw Error(K(198));Ac||(Ac=!0,Pu=_)}}function Ss(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function $v(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function hm(e){if(Ss(e)!==e)throw Error(K(188))}function MC(e){var t=e.alternate;if(!t){if(t=Ss(e),t===null)throw Error(K(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return hm(i),e;if(a===r)return hm(i),t;a=a.sibling}throw Error(K(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,f=i.child;f;){if(f===n){o=!0,n=i,r=a;break}if(f===r){o=!0,r=i,n=a;break}f=f.sibling}if(!o){for(f=a.child;f;){if(f===n){o=!0,n=a,r=i;break}if(f===r){o=!0,r=a,n=i;break}f=f.sibling}if(!o)throw Error(K(189))}}if(n.alternate!==r)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?e:t}function Fv(e){return e=MC(e),e!==null?Uv(e):null}function Uv(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Uv(e);if(t!==null)return t;e=e.sibling}return null}var zv=Mt.unstable_scheduleCallback,mm=Mt.unstable_cancelCallback,OC=Mt.unstable_shouldYield,AC=Mt.unstable_requestPaint,Oe=Mt.unstable_now,$C=Mt.unstable_getCurrentPriorityLevel,kp=Mt.unstable_ImmediatePriority,Bv=Mt.unstable_UserBlockingPriority,$c=Mt.unstable_NormalPriority,FC=Mt.unstable_LowPriority,Vv=Mt.unstable_IdlePriority,al=null,Tn=null;function UC(e){if(Tn&&typeof Tn.onCommitFiberRoot=="function")try{Tn.onCommitFiberRoot(al,e,void 0,(e.current.flags&128)===128)}catch{}}var cn=Math.clz32?Math.clz32:VC,zC=Math.log,BC=Math.LN2;function VC(e){return e>>>=0,e===0?32:31-(zC(e)/BC|0)|0}var Xo=64,Zo=4194304;function ba(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Fc(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=n&268435455;if(o!==0){var f=o&~i;f!==0?r=ba(f):(a&=o,a!==0&&(r=ba(a)))}else o=n&~i,o!==0?r=ba(o):a!==0&&(r=ba(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-cn(t),i=1<<n,r|=e[n],t&=~i;return r}function WC(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HC(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-cn(a),f=1<<o,m=i[o];m===-1?(!(f&n)||f&r)&&(i[o]=WC(f,t)):m<=t&&(e.expiredLanes|=f),a&=~f}}function ju(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Wv(){var e=Xo;return Xo<<=1,!(Xo&4194240)&&(Xo=64),e}function Fd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ro(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-cn(t),e[t]=n}function GC(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-cn(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}function Tp(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-cn(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var ge=0;function Hv(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Gv,Rp,Qv,Kv,Yv,Du=!1,ec=[],gr=null,vr=null,yr=null,za=new Map,Ba=new Map,ur=[],QC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gm(e,t){switch(e){case"focusin":case"focusout":gr=null;break;case"dragenter":case"dragleave":vr=null;break;case"mouseover":case"mouseout":yr=null;break;case"pointerover":case"pointerout":za.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ba.delete(t.pointerId)}}function ca(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=io(t),t!==null&&Rp(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function KC(e,t,n,r,i){switch(t){case"focusin":return gr=ca(gr,e,t,n,r,i),!0;case"dragenter":return vr=ca(vr,e,t,n,r,i),!0;case"mouseover":return yr=ca(yr,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return za.set(a,ca(za.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Ba.set(a,ca(Ba.get(a)||null,e,t,n,r,i)),!0}return!1}function Jv(e){var t=Xr(e.target);if(t!==null){var n=Ss(t);if(n!==null){if(t=n.tag,t===13){if(t=$v(n),t!==null){e.blockedOn=t,Yv(e.priority,function(){Qv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function vc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Lu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Ru=r,n.target.dispatchEvent(r),Ru=null}else return t=io(n),t!==null&&Rp(t),e.blockedOn=n,!1;t.shift()}return!0}function vm(e,t,n){vc(e)&&n.delete(t)}function YC(){Du=!1,gr!==null&&vc(gr)&&(gr=null),vr!==null&&vc(vr)&&(vr=null),yr!==null&&vc(yr)&&(yr=null),za.forEach(vm),Ba.forEach(vm)}function la(e,t){e.blockedOn===t&&(e.blockedOn=null,Du||(Du=!0,Mt.unstable_scheduleCallback(Mt.unstable_NormalPriority,YC)))}function Va(e){function t(i){return la(i,e)}if(0<ec.length){la(ec[0],e);for(var n=1;n<ec.length;n++){var r=ec[n];r.blockedOn===e&&(r.blockedOn=null)}}for(gr!==null&&la(gr,e),vr!==null&&la(vr,e),yr!==null&&la(yr,e),za.forEach(t),Ba.forEach(t),n=0;n<ur.length;n++)r=ur[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<ur.length&&(n=ur[0],n.blockedOn===null);)Jv(n),n.blockedOn===null&&ur.shift()}var yi=Zn.ReactCurrentBatchConfig,Uc=!0;function JC(e,t,n,r){var i=ge,a=yi.transition;yi.transition=null;try{ge=1,Ip(e,t,n,r)}finally{ge=i,yi.transition=a}}function qC(e,t,n,r){var i=ge,a=yi.transition;yi.transition=null;try{ge=4,Ip(e,t,n,r)}finally{ge=i,yi.transition=a}}function Ip(e,t,n,r){if(Uc){var i=Lu(e,t,n,r);if(i===null)Yd(e,t,r,zc,n),gm(e,r);else if(KC(i,e,t,n,r))r.stopPropagation();else if(gm(e,r),t&4&&-1<QC.indexOf(e)){for(;i!==null;){var a=io(i);if(a!==null&&Gv(a),a=Lu(e,t,n,r),a===null&&Yd(e,t,r,zc,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Yd(e,t,r,null,n)}}var zc=null;function Lu(e,t,n,r){if(zc=null,e=Ep(r),e=Xr(e),e!==null)if(t=Ss(e),t===null)e=null;else if(n=t.tag,n===13){if(e=$v(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return zc=e,null}function qv(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($C()){case kp:return 1;case Bv:return 4;case $c:case FC:return 16;case Vv:return 536870912;default:return 16}default:return 16}}var hr=null,Np=null,yc=null;function Xv(){if(yc)return yc;var e,t=Np,n=t.length,r,i="value"in hr?hr.value:hr.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return yc=i.slice(e,1<r?1-r:void 0)}function wc(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function tc(){return!0}function ym(){return!1}function At(e){function t(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var f in e)e.hasOwnProperty(f)&&(n=e[f],this[f]=n?n(a):a[f]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?tc:ym,this.isPropagationStopped=ym,this}return Pe(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=tc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=tc)},persist:function(){},isPersistent:tc}),t}var Li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pp=At(Li),so=Pe({},Li,{view:0,detail:0}),XC=At(so),Ud,zd,da,ol=Pe({},so,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==da&&(da&&e.type==="mousemove"?(Ud=e.screenX-da.screenX,zd=e.screenY-da.screenY):zd=Ud=0,da=e),Ud)},movementY:function(e){return"movementY"in e?e.movementY:zd}}),wm=At(ol),ZC=Pe({},ol,{dataTransfer:0}),ex=At(ZC),tx=Pe({},so,{relatedTarget:0}),Bd=At(tx),nx=Pe({},Li,{animationName:0,elapsedTime:0,pseudoElement:0}),rx=At(nx),sx=Pe({},Li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ix=At(sx),ax=Pe({},Li,{data:0}),_m=At(ax),ox={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=lx[e])?!!t[e]:!1}function jp(){return dx}var ux=Pe({},so,{key:function(e){if(e.key){var t=ox[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=wc(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?cx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jp,charCode:function(e){return e.type==="keypress"?wc(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?wc(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),px=At(ux),fx=Pe({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sm=At(fx),hx=Pe({},so,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jp}),mx=At(hx),gx=Pe({},Li,{propertyName:0,elapsedTime:0,pseudoElement:0}),vx=At(gx),yx=Pe({},ol,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),wx=At(yx),_x=[9,13,27,32],Dp=Yn&&"CompositionEvent"in window,Ra=null;Yn&&"documentMode"in document&&(Ra=document.documentMode);var Sx=Yn&&"TextEvent"in window&&!Ra,Zv=Yn&&(!Dp||Ra&&8<Ra&&11>=Ra),Cm=" ",xm=!1;function ey(e,t){switch(e){case"keyup":return _x.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ty(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ri=!1;function Cx(e,t){switch(e){case"compositionend":return ty(t);case"keypress":return t.which!==32?null:(xm=!0,Cm);case"textInput":return e=t.data,e===Cm&&xm?null:e;default:return null}}function xx(e,t){if(ri)return e==="compositionend"||!Dp&&ey(e,t)?(e=Xv(),yc=Np=hr=null,ri=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Zv&&t.locale!=="ko"?null:t.data;default:return null}}var bx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!bx[e.type]:t==="textarea"}function ny(e,t,n,r){Dv(r),t=Bc(t,"onChange"),0<t.length&&(n=new Pp("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ia=null,Wa=null;function Ex(e){fy(e,0)}function cl(e){var t=ai(e);if(kv(t))return e}function kx(e,t){if(e==="change")return t}var ry=!1;if(Yn){var Vd;if(Yn){var Wd="oninput"in document;if(!Wd){var Em=document.createElement("div");Em.setAttribute("oninput","return;"),Wd=typeof Em.oninput=="function"}Vd=Wd}else Vd=!1;ry=Vd&&(!document.documentMode||9<document.documentMode)}function km(){Ia&&(Ia.detachEvent("onpropertychange",sy),Wa=Ia=null)}function sy(e){if(e.propertyName==="value"&&cl(Wa)){var t=[];ny(t,Wa,e,Ep(e)),Av(Ex,t)}}function Tx(e,t,n){e==="focusin"?(km(),Ia=t,Wa=n,Ia.attachEvent("onpropertychange",sy)):e==="focusout"&&km()}function Rx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return cl(Wa)}function Ix(e,t){if(e==="click")return cl(t)}function Nx(e,t){if(e==="input"||e==="change")return cl(t)}function Px(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var un=typeof Object.is=="function"?Object.is:Px;function Ha(e,t){if(un(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!gu.call(t,i)||!un(e[i],t[i]))return!1}return!0}function Tm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Rm(e,t){var n=Tm(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Tm(n)}}function iy(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?iy(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ay(){for(var e=window,t=Mc();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Mc(e.document)}return t}function Lp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function jx(e){var t=ay(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&iy(n.ownerDocument.documentElement,n)){if(r!==null&&Lp(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=Rm(n,a);var o=Rm(n,r);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Dx=Yn&&"documentMode"in document&&11>=document.documentMode,si=null,Mu=null,Na=null,Ou=!1;function Im(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ou||si==null||si!==Mc(r)||(r=si,"selectionStart"in r&&Lp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Na&&Ha(Na,r)||(Na=r,r=Bc(Mu,"onSelect"),0<r.length&&(t=new Pp("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=si)))}function nc(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ii={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Hd={},oy={};Yn&&(oy=document.createElement("div").style,"AnimationEvent"in window||(delete ii.animationend.animation,delete ii.animationiteration.animation,delete ii.animationstart.animation),"TransitionEvent"in window||delete ii.transitionend.transition);function ll(e){if(Hd[e])return Hd[e];if(!ii[e])return e;var t=ii[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in oy)return Hd[e]=t[n];return e}var cy=ll("animationend"),ly=ll("animationiteration"),dy=ll("animationstart"),uy=ll("transitionend"),py=new Map,Nm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tr(e,t){py.set(e,t),_s(t,[e])}for(var Gd=0;Gd<Nm.length;Gd++){var Qd=Nm[Gd],Lx=Qd.toLowerCase(),Mx=Qd[0].toUpperCase()+Qd.slice(1);Tr(Lx,"on"+Mx)}Tr(cy,"onAnimationEnd");Tr(ly,"onAnimationIteration");Tr(dy,"onAnimationStart");Tr("dblclick","onDoubleClick");Tr("focusin","onFocus");Tr("focusout","onBlur");Tr(uy,"onTransitionEnd");ki("onMouseEnter",["mouseout","mouseover"]);ki("onMouseLeave",["mouseout","mouseover"]);ki("onPointerEnter",["pointerout","pointerover"]);ki("onPointerLeave",["pointerout","pointerover"]);_s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_s("onBeforeInput",["compositionend","keypress","textInput","paste"]);_s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ea="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ox=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ea));function Pm(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,LC(r,t,void 0,e),e.currentTarget=null}function fy(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var f=r[o],m=f.instance,_=f.currentTarget;if(f=f.listener,m!==a&&i.isPropagationStopped())break e;Pm(i,f,_),a=m}else for(o=0;o<r.length;o++){if(f=r[o],m=f.instance,_=f.currentTarget,f=f.listener,m!==a&&i.isPropagationStopped())break e;Pm(i,f,_),a=m}}}if(Ac)throw e=Pu,Ac=!1,Pu=null,e}function xe(e,t){var n=t[zu];n===void 0&&(n=t[zu]=new Set);var r=e+"__bubble";n.has(r)||(hy(t,e,2,!1),n.add(r))}function Kd(e,t,n){var r=0;t&&(r|=4),hy(n,e,r,t)}var rc="_reactListening"+Math.random().toString(36).slice(2);function Ga(e){if(!e[rc]){e[rc]=!0,Sv.forEach(function(n){n!=="selectionchange"&&(Ox.has(n)||Kd(n,!1,e),Kd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[rc]||(t[rc]=!0,Kd("selectionchange",!1,t))}}function hy(e,t,n,r){switch(qv(t)){case 1:var i=JC;break;case 4:i=qC;break;default:i=Ip}n=i.bind(null,t,n,e),i=void 0,!Nu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Yd(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var f=r.stateNode.containerInfo;if(f===i||f.nodeType===8&&f.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var m=o.tag;if((m===3||m===4)&&(m=o.stateNode.containerInfo,m===i||m.nodeType===8&&m.parentNode===i))return;o=o.return}for(;f!==null;){if(o=Xr(f),o===null)return;if(m=o.tag,m===5||m===6){r=a=o;continue e}f=f.parentNode}}r=r.return}Av(function(){var _=a,p=Ep(n),S=[];e:{var k=py.get(e);if(k!==void 0){var M=Pp,V=e;switch(e){case"keypress":if(wc(n)===0)break e;case"keydown":case"keyup":M=px;break;case"focusin":V="focus",M=Bd;break;case"focusout":V="blur",M=Bd;break;case"beforeblur":case"afterblur":M=Bd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":M=wm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":M=ex;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":M=mx;break;case cy:case ly:case dy:M=rx;break;case uy:M=vx;break;case"scroll":M=XC;break;case"wheel":M=wx;break;case"copy":case"cut":case"paste":M=ix;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":M=Sm}var B=(t&4)!==0,v=!B&&e==="scroll",l=B?k!==null?k+"Capture":null:k;B=[];for(var u=_,g;u!==null;){g=u;var C=g.stateNode;if(g.tag===5&&C!==null&&(g=C,l!==null&&(C=Ua(u,l),C!=null&&B.push(Qa(u,C,g)))),v)break;u=u.return}0<B.length&&(k=new M(k,V,null,n,p),S.push({event:k,listeners:B}))}}if(!(t&7)){e:{if(k=e==="mouseover"||e==="pointerover",M=e==="mouseout"||e==="pointerout",k&&n!==Ru&&(V=n.relatedTarget||n.fromElement)&&(Xr(V)||V[Jn]))break e;if((M||k)&&(k=p.window===p?p:(k=p.ownerDocument)?k.defaultView||k.parentWindow:window,M?(V=n.relatedTarget||n.toElement,M=_,V=V?Xr(V):null,V!==null&&(v=Ss(V),V!==v||V.tag!==5&&V.tag!==6)&&(V=null)):(M=null,V=_),M!==V)){if(B=wm,C="onMouseLeave",l="onMouseEnter",u="mouse",(e==="pointerout"||e==="pointerover")&&(B=Sm,C="onPointerLeave",l="onPointerEnter",u="pointer"),v=M==null?k:ai(M),g=V==null?k:ai(V),k=new B(C,u+"leave",M,n,p),k.target=v,k.relatedTarget=g,C=null,Xr(p)===_&&(B=new B(l,u+"enter",V,n,p),B.target=g,B.relatedTarget=v,C=B),v=C,M&&V)t:{for(B=M,l=V,u=0,g=B;g;g=Bs(g))u++;for(g=0,C=l;C;C=Bs(C))g++;for(;0<u-g;)B=Bs(B),u--;for(;0<g-u;)l=Bs(l),g--;for(;u--;){if(B===l||l!==null&&B===l.alternate)break t;B=Bs(B),l=Bs(l)}B=null}else B=null;M!==null&&jm(S,k,M,B,!1),V!==null&&v!==null&&jm(S,v,V,B,!0)}}e:{if(k=_?ai(_):window,M=k.nodeName&&k.nodeName.toLowerCase(),M==="select"||M==="input"&&k.type==="file")var N=kx;else if(bm(k))if(ry)N=Nx;else{N=Rx;var w=Tx}else(M=k.nodeName)&&M.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(N=Ix);if(N&&(N=N(e,_))){ny(S,N,n,p);break e}w&&w(e,k,_),e==="focusout"&&(w=k._wrapperState)&&w.controlled&&k.type==="number"&&xu(k,"number",k.value)}switch(w=_?ai(_):window,e){case"focusin":(bm(w)||w.contentEditable==="true")&&(si=w,Mu=_,Na=null);break;case"focusout":Na=Mu=si=null;break;case"mousedown":Ou=!0;break;case"contextmenu":case"mouseup":case"dragend":Ou=!1,Im(S,n,p);break;case"selectionchange":if(Dx)break;case"keydown":case"keyup":Im(S,n,p)}var x;if(Dp)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else ri?ey(e,n)&&(R="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(Zv&&n.locale!=="ko"&&(ri||R!=="onCompositionStart"?R==="onCompositionEnd"&&ri&&(x=Xv()):(hr=p,Np="value"in hr?hr.value:hr.textContent,ri=!0)),w=Bc(_,R),0<w.length&&(R=new _m(R,e,null,n,p),S.push({event:R,listeners:w}),x?R.data=x:(x=ty(n),x!==null&&(R.data=x)))),(x=Sx?Cx(e,n):xx(e,n))&&(_=Bc(_,"onBeforeInput"),0<_.length&&(p=new _m("onBeforeInput","beforeinput",null,n,p),S.push({event:p,listeners:_}),p.data=x))}fy(S,t)})}function Qa(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Bc(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Ua(e,n),a!=null&&r.unshift(Qa(e,a,i)),a=Ua(e,t),a!=null&&r.push(Qa(e,a,i))),e=e.return}return r}function Bs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function jm(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var f=n,m=f.alternate,_=f.stateNode;if(m!==null&&m===r)break;f.tag===5&&_!==null&&(f=_,i?(m=Ua(n,a),m!=null&&o.unshift(Qa(n,m,f))):i||(m=Ua(n,a),m!=null&&o.push(Qa(n,m,f)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Ax=/\r\n?/g,$x=/\u0000|\uFFFD/g;function Dm(e){return(typeof e=="string"?e:""+e).replace(Ax,`
`).replace($x,"")}function sc(e,t,n){if(t=Dm(t),Dm(e)!==t&&n)throw Error(K(425))}function Vc(){}var Au=null,$u=null;function Fu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Uu=typeof setTimeout=="function"?setTimeout:void 0,Fx=typeof clearTimeout=="function"?clearTimeout:void 0,Lm=typeof Promise=="function"?Promise:void 0,Ux=typeof queueMicrotask=="function"?queueMicrotask:typeof Lm<"u"?function(e){return Lm.resolve(null).then(e).catch(zx)}:Uu;function zx(e){setTimeout(function(){throw e})}function Jd(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),Va(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Va(t)}function wr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Mm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Mi=Math.random().toString(36).slice(2),kn="__reactFiber$"+Mi,Ka="__reactProps$"+Mi,Jn="__reactContainer$"+Mi,zu="__reactEvents$"+Mi,Bx="__reactListeners$"+Mi,Vx="__reactHandles$"+Mi;function Xr(e){var t=e[kn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jn]||n[kn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Mm(e);e!==null;){if(n=e[kn])return n;e=Mm(e)}return t}e=n,n=e.parentNode}return null}function io(e){return e=e[kn]||e[Jn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ai(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(K(33))}function dl(e){return e[Ka]||null}var Bu=[],oi=-1;function Rr(e){return{current:e}}function be(e){0>oi||(e.current=Bu[oi],Bu[oi]=null,oi--)}function _e(e,t){oi++,Bu[oi]=e.current,e.current=t}var kr={},ct=Rr(kr),xt=Rr(!1),fs=kr;function Ti(e,t){var n=e.type.contextTypes;if(!n)return kr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function bt(e){return e=e.childContextTypes,e!=null}function Wc(){be(xt),be(ct)}function Om(e,t,n){if(ct.current!==kr)throw Error(K(168));_e(ct,t),_e(xt,n)}function my(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(K(108,TC(e)||"Unknown",i));return Pe({},n,r)}function Hc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||kr,fs=ct.current,_e(ct,e),_e(xt,xt.current),!0}function Am(e,t,n){var r=e.stateNode;if(!r)throw Error(K(169));n?(e=my(e,t,fs),r.__reactInternalMemoizedMergedChildContext=e,be(xt),be(ct),_e(ct,e)):be(xt),_e(xt,n)}var Wn=null,ul=!1,qd=!1;function gy(e){Wn===null?Wn=[e]:Wn.push(e)}function Wx(e){ul=!0,gy(e)}function Ir(){if(!qd&&Wn!==null){qd=!0;var e=0,t=ge;try{var n=Wn;for(ge=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Wn=null,ul=!1}catch(i){throw Wn!==null&&(Wn=Wn.slice(e+1)),zv(kp,Ir),i}finally{ge=t,qd=!1}}return null}var ci=[],li=0,Gc=null,Qc=0,Wt=[],Ht=0,hs=null,Hn=1,Gn="";function Jr(e,t){ci[li++]=Qc,ci[li++]=Gc,Gc=e,Qc=t}function vy(e,t,n){Wt[Ht++]=Hn,Wt[Ht++]=Gn,Wt[Ht++]=hs,hs=e;var r=Hn;e=Gn;var i=32-cn(r)-1;r&=~(1<<i),n+=1;var a=32-cn(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Hn=1<<32-cn(t)+i|n<<i|r,Gn=a+e}else Hn=1<<a|n<<i|r,Gn=e}function Mp(e){e.return!==null&&(Jr(e,1),vy(e,1,0))}function Op(e){for(;e===Gc;)Gc=ci[--li],ci[li]=null,Qc=ci[--li],ci[li]=null;for(;e===hs;)hs=Wt[--Ht],Wt[Ht]=null,Gn=Wt[--Ht],Wt[Ht]=null,Hn=Wt[--Ht],Wt[Ht]=null}var Lt=null,Dt=null,Te=!1,on=null;function yy(e,t){var n=Gt(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function $m(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Lt=e,Dt=wr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Lt=e,Dt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=hs!==null?{id:Hn,overflow:Gn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Gt(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Lt=e,Dt=null,!0):!1;default:return!1}}function Vu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Wu(e){if(Te){var t=Dt;if(t){var n=t;if(!$m(e,t)){if(Vu(e))throw Error(K(418));t=wr(n.nextSibling);var r=Lt;t&&$m(e,t)?yy(r,n):(e.flags=e.flags&-4097|2,Te=!1,Lt=e)}}else{if(Vu(e))throw Error(K(418));e.flags=e.flags&-4097|2,Te=!1,Lt=e}}}function Fm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Lt=e}function ic(e){if(e!==Lt)return!1;if(!Te)return Fm(e),Te=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Fu(e.type,e.memoizedProps)),t&&(t=Dt)){if(Vu(e))throw wy(),Error(K(418));for(;t;)yy(e,t),t=wr(t.nextSibling)}if(Fm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(K(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Dt=wr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Dt=null}}else Dt=Lt?wr(e.stateNode.nextSibling):null;return!0}function wy(){for(var e=Dt;e;)e=wr(e.nextSibling)}function Ri(){Dt=Lt=null,Te=!1}function Ap(e){on===null?on=[e]:on.push(e)}var Hx=Zn.ReactCurrentBatchConfig;function ua(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(K(309));var r=n.stateNode}if(!r)throw Error(K(147,e));var i=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var f=i.refs;o===null?delete f[a]:f[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(K(284));if(!n._owner)throw Error(K(290,e))}return e}function ac(e,t){throw e=Object.prototype.toString.call(t),Error(K(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Um(e){var t=e._init;return t(e._payload)}function _y(e){function t(l,u){if(e){var g=l.deletions;g===null?(l.deletions=[u],l.flags|=16):g.push(u)}}function n(l,u){if(!e)return null;for(;u!==null;)t(l,u),u=u.sibling;return null}function r(l,u){for(l=new Map;u!==null;)u.key!==null?l.set(u.key,u):l.set(u.index,u),u=u.sibling;return l}function i(l,u){return l=xr(l,u),l.index=0,l.sibling=null,l}function a(l,u,g){return l.index=g,e?(g=l.alternate,g!==null?(g=g.index,g<u?(l.flags|=2,u):g):(l.flags|=2,u)):(l.flags|=1048576,u)}function o(l){return e&&l.alternate===null&&(l.flags|=2),l}function f(l,u,g,C){return u===null||u.tag!==6?(u=su(g,l.mode,C),u.return=l,u):(u=i(u,g),u.return=l,u)}function m(l,u,g,C){var N=g.type;return N===ni?p(l,u,g.props.children,C,g.key):u!==null&&(u.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===lr&&Um(N)===u.type)?(C=i(u,g.props),C.ref=ua(l,u,g),C.return=l,C):(C=kc(g.type,g.key,g.props,null,l.mode,C),C.ref=ua(l,u,g),C.return=l,C)}function _(l,u,g,C){return u===null||u.tag!==4||u.stateNode.containerInfo!==g.containerInfo||u.stateNode.implementation!==g.implementation?(u=iu(g,l.mode,C),u.return=l,u):(u=i(u,g.children||[]),u.return=l,u)}function p(l,u,g,C,N){return u===null||u.tag!==7?(u=ps(g,l.mode,C,N),u.return=l,u):(u=i(u,g),u.return=l,u)}function S(l,u,g){if(typeof u=="string"&&u!==""||typeof u=="number")return u=su(""+u,l.mode,g),u.return=l,u;if(typeof u=="object"&&u!==null){switch(u.$$typeof){case Yo:return g=kc(u.type,u.key,u.props,null,l.mode,g),g.ref=ua(l,null,u),g.return=l,g;case ti:return u=iu(u,l.mode,g),u.return=l,u;case lr:var C=u._init;return S(l,C(u._payload),g)}if(xa(u)||aa(u))return u=ps(u,l.mode,g,null),u.return=l,u;ac(l,u)}return null}function k(l,u,g,C){var N=u!==null?u.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return N!==null?null:f(l,u,""+g,C);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Yo:return g.key===N?m(l,u,g,C):null;case ti:return g.key===N?_(l,u,g,C):null;case lr:return N=g._init,k(l,u,N(g._payload),C)}if(xa(g)||aa(g))return N!==null?null:p(l,u,g,C,null);ac(l,g)}return null}function M(l,u,g,C,N){if(typeof C=="string"&&C!==""||typeof C=="number")return l=l.get(g)||null,f(u,l,""+C,N);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Yo:return l=l.get(C.key===null?g:C.key)||null,m(u,l,C,N);case ti:return l=l.get(C.key===null?g:C.key)||null,_(u,l,C,N);case lr:var w=C._init;return M(l,u,g,w(C._payload),N)}if(xa(C)||aa(C))return l=l.get(g)||null,p(u,l,C,N,null);ac(u,C)}return null}function V(l,u,g,C){for(var N=null,w=null,x=u,R=u=0,D=null;x!==null&&R<g.length;R++){x.index>R?(D=x,x=null):D=x.sibling;var P=k(l,x,g[R],C);if(P===null){x===null&&(x=D);break}e&&x&&P.alternate===null&&t(l,x),u=a(P,u,R),w===null?N=P:w.sibling=P,w=P,x=D}if(R===g.length)return n(l,x),Te&&Jr(l,R),N;if(x===null){for(;R<g.length;R++)x=S(l,g[R],C),x!==null&&(u=a(x,u,R),w===null?N=x:w.sibling=x,w=x);return Te&&Jr(l,R),N}for(x=r(l,x);R<g.length;R++)D=M(x,l,R,g[R],C),D!==null&&(e&&D.alternate!==null&&x.delete(D.key===null?R:D.key),u=a(D,u,R),w===null?N=D:w.sibling=D,w=D);return e&&x.forEach(function(j){return t(l,j)}),Te&&Jr(l,R),N}function B(l,u,g,C){var N=aa(g);if(typeof N!="function")throw Error(K(150));if(g=N.call(g),g==null)throw Error(K(151));for(var w=N=null,x=u,R=u=0,D=null,P=g.next();x!==null&&!P.done;R++,P=g.next()){x.index>R?(D=x,x=null):D=x.sibling;var j=k(l,x,P.value,C);if(j===null){x===null&&(x=D);break}e&&x&&j.alternate===null&&t(l,x),u=a(j,u,R),w===null?N=j:w.sibling=j,w=j,x=D}if(P.done)return n(l,x),Te&&Jr(l,R),N;if(x===null){for(;!P.done;R++,P=g.next())P=S(l,P.value,C),P!==null&&(u=a(P,u,R),w===null?N=P:w.sibling=P,w=P);return Te&&Jr(l,R),N}for(x=r(l,x);!P.done;R++,P=g.next())P=M(x,l,R,P.value,C),P!==null&&(e&&P.alternate!==null&&x.delete(P.key===null?R:P.key),u=a(P,u,R),w===null?N=P:w.sibling=P,w=P);return e&&x.forEach(function($){return t(l,$)}),Te&&Jr(l,R),N}function v(l,u,g,C){if(typeof g=="object"&&g!==null&&g.type===ni&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case Yo:e:{for(var N=g.key,w=u;w!==null;){if(w.key===N){if(N=g.type,N===ni){if(w.tag===7){n(l,w.sibling),u=i(w,g.props.children),u.return=l,l=u;break e}}else if(w.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===lr&&Um(N)===w.type){n(l,w.sibling),u=i(w,g.props),u.ref=ua(l,w,g),u.return=l,l=u;break e}n(l,w);break}else t(l,w);w=w.sibling}g.type===ni?(u=ps(g.props.children,l.mode,C,g.key),u.return=l,l=u):(C=kc(g.type,g.key,g.props,null,l.mode,C),C.ref=ua(l,u,g),C.return=l,l=C)}return o(l);case ti:e:{for(w=g.key;u!==null;){if(u.key===w)if(u.tag===4&&u.stateNode.containerInfo===g.containerInfo&&u.stateNode.implementation===g.implementation){n(l,u.sibling),u=i(u,g.children||[]),u.return=l,l=u;break e}else{n(l,u);break}else t(l,u);u=u.sibling}u=iu(g,l.mode,C),u.return=l,l=u}return o(l);case lr:return w=g._init,v(l,u,w(g._payload),C)}if(xa(g))return V(l,u,g,C);if(aa(g))return B(l,u,g,C);ac(l,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,u!==null&&u.tag===6?(n(l,u.sibling),u=i(u,g),u.return=l,l=u):(n(l,u),u=su(g,l.mode,C),u.return=l,l=u),o(l)):n(l,u)}return v}var Ii=_y(!0),Sy=_y(!1),Kc=Rr(null),Yc=null,di=null,$p=null;function Fp(){$p=di=Yc=null}function Up(e){var t=Kc.current;be(Kc),e._currentValue=t}function Hu(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function wi(e,t){Yc=e,$p=di=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ct=!0),e.firstContext=null)}function Kt(e){var t=e._currentValue;if($p!==e)if(e={context:e,memoizedValue:t,next:null},di===null){if(Yc===null)throw Error(K(308));di=e,Yc.dependencies={lanes:0,firstContext:e}}else di=di.next=e;return t}var Zr=null;function zp(e){Zr===null?Zr=[e]:Zr.push(e)}function Cy(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,zp(t)):(n.next=i.next,i.next=n),t.interleaved=n,qn(e,r)}function qn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var dr=!1;function Bp(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xy(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Qn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function _r(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,me&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,qn(e,n)}return i=r.interleaved,i===null?(t.next=t,zp(r)):(t.next=i.next,i.next=t),r.interleaved=t,qn(e,n)}function _c(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Tp(e,n)}}function zm(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Jc(e,t,n,r){var i=e.updateQueue;dr=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,f=i.shared.pending;if(f!==null){i.shared.pending=null;var m=f,_=m.next;m.next=null,o===null?a=_:o.next=_,o=m;var p=e.alternate;p!==null&&(p=p.updateQueue,f=p.lastBaseUpdate,f!==o&&(f===null?p.firstBaseUpdate=_:f.next=_,p.lastBaseUpdate=m))}if(a!==null){var S=i.baseState;o=0,p=_=m=null,f=a;do{var k=f.lane,M=f.eventTime;if((r&k)===k){p!==null&&(p=p.next={eventTime:M,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});e:{var V=e,B=f;switch(k=t,M=n,B.tag){case 1:if(V=B.payload,typeof V=="function"){S=V.call(M,S,k);break e}S=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=B.payload,k=typeof V=="function"?V.call(M,S,k):V,k==null)break e;S=Pe({},S,k);break e;case 2:dr=!0}}f.callback!==null&&f.lane!==0&&(e.flags|=64,k=i.effects,k===null?i.effects=[f]:k.push(f))}else M={eventTime:M,lane:k,tag:f.tag,payload:f.payload,callback:f.callback,next:null},p===null?(_=p=M,m=S):p=p.next=M,o|=k;if(f=f.next,f===null){if(f=i.shared.pending,f===null)break;k=f,f=k.next,k.next=null,i.lastBaseUpdate=k,i.shared.pending=null}}while(!0);if(p===null&&(m=S),i.baseState=m,i.firstBaseUpdate=_,i.lastBaseUpdate=p,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);gs|=o,e.lanes=o,e.memoizedState=S}}function Bm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(K(191,i));i.call(r)}}}var ao={},Rn=Rr(ao),Ya=Rr(ao),Ja=Rr(ao);function es(e){if(e===ao)throw Error(K(174));return e}function Vp(e,t){switch(_e(Ja,t),_e(Ya,e),_e(Rn,ao),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Eu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Eu(t,e)}be(Rn),_e(Rn,t)}function Ni(){be(Rn),be(Ya),be(Ja)}function by(e){es(Ja.current);var t=es(Rn.current),n=Eu(t,e.type);t!==n&&(_e(Ya,e),_e(Rn,n))}function Wp(e){Ya.current===e&&(be(Rn),be(Ya))}var Ie=Rr(0);function qc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Xd=[];function Hp(){for(var e=0;e<Xd.length;e++)Xd[e]._workInProgressVersionPrimary=null;Xd.length=0}var Sc=Zn.ReactCurrentDispatcher,Zd=Zn.ReactCurrentBatchConfig,ms=0,Ne=null,Be=null,We=null,Xc=!1,Pa=!1,qa=0,Gx=0;function it(){throw Error(K(321))}function Gp(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!un(e[n],t[n]))return!1;return!0}function Qp(e,t,n,r,i,a){if(ms=a,Ne=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Sc.current=e===null||e.memoizedState===null?Jx:qx,e=n(r,i),Pa){a=0;do{if(Pa=!1,qa=0,25<=a)throw Error(K(301));a+=1,We=Be=null,t.updateQueue=null,Sc.current=Xx,e=n(r,i)}while(Pa)}if(Sc.current=Zc,t=Be!==null&&Be.next!==null,ms=0,We=Be=Ne=null,Xc=!1,t)throw Error(K(300));return e}function Kp(){var e=qa!==0;return qa=0,e}function Cn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return We===null?Ne.memoizedState=We=e:We=We.next=e,We}function Yt(){if(Be===null){var e=Ne.alternate;e=e!==null?e.memoizedState:null}else e=Be.next;var t=We===null?Ne.memoizedState:We.next;if(t!==null)We=t,Be=e;else{if(e===null)throw Error(K(310));Be=e,e={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},We===null?Ne.memoizedState=We=e:We=We.next=e}return We}function Xa(e,t){return typeof t=="function"?t(e):t}function eu(e){var t=Yt(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var r=Be,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var f=o=null,m=null,_=a;do{var p=_.lane;if((ms&p)===p)m!==null&&(m=m.next={lane:0,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null}),r=_.hasEagerState?_.eagerState:e(r,_.action);else{var S={lane:p,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null};m===null?(f=m=S,o=r):m=m.next=S,Ne.lanes|=p,gs|=p}_=_.next}while(_!==null&&_!==a);m===null?o=r:m.next=f,un(r,t.memoizedState)||(Ct=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=m,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do a=i.lane,Ne.lanes|=a,gs|=a,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function tu(e){var t=Yt(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);un(a,t.memoizedState)||(Ct=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ey(){}function ky(e,t){var n=Ne,r=Yt(),i=t(),a=!un(r.memoizedState,i);if(a&&(r.memoizedState=i,Ct=!0),r=r.queue,Yp(Iy.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||We!==null&&We.memoizedState.tag&1){if(n.flags|=2048,Za(9,Ry.bind(null,n,r,i,t),void 0,null),He===null)throw Error(K(349));ms&30||Ty(n,t,i)}return i}function Ty(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Ne.updateQueue,t===null?(t={lastEffect:null,stores:null},Ne.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ry(e,t,n,r){t.value=n,t.getSnapshot=r,Ny(t)&&Py(e)}function Iy(e,t,n){return n(function(){Ny(t)&&Py(e)})}function Ny(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!un(e,n)}catch{return!0}}function Py(e){var t=qn(e,1);t!==null&&ln(t,e,1,-1)}function Vm(e){var t=Cn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xa,lastRenderedState:e},t.queue=e,e=e.dispatch=Yx.bind(null,Ne,e),[t.memoizedState,e]}function Za(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Ne.updateQueue,t===null?(t={lastEffect:null,stores:null},Ne.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function jy(){return Yt().memoizedState}function Cc(e,t,n,r){var i=Cn();Ne.flags|=e,i.memoizedState=Za(1|t,n,void 0,r===void 0?null:r)}function pl(e,t,n,r){var i=Yt();r=r===void 0?null:r;var a=void 0;if(Be!==null){var o=Be.memoizedState;if(a=o.destroy,r!==null&&Gp(r,o.deps)){i.memoizedState=Za(t,n,a,r);return}}Ne.flags|=e,i.memoizedState=Za(1|t,n,a,r)}function Wm(e,t){return Cc(8390656,8,e,t)}function Yp(e,t){return pl(2048,8,e,t)}function Dy(e,t){return pl(4,2,e,t)}function Ly(e,t){return pl(4,4,e,t)}function My(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Oy(e,t,n){return n=n!=null?n.concat([e]):null,pl(4,4,My.bind(null,t,e),n)}function Jp(){}function Ay(e,t){var n=Yt();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Gp(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function $y(e,t){var n=Yt();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Gp(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Fy(e,t,n){return ms&21?(un(n,t)||(n=Wv(),Ne.lanes|=n,gs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ct=!0),e.memoizedState=n)}function Qx(e,t){var n=ge;ge=n!==0&&4>n?n:4,e(!0);var r=Zd.transition;Zd.transition={};try{e(!1),t()}finally{ge=n,Zd.transition=r}}function Uy(){return Yt().memoizedState}function Kx(e,t,n){var r=Cr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},zy(e))By(t,n);else if(n=Cy(e,t,n,r),n!==null){var i=mt();ln(n,e,r,i),Vy(n,t,r)}}function Yx(e,t,n){var r=Cr(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(zy(e))By(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,f=a(o,n);if(i.hasEagerState=!0,i.eagerState=f,un(f,o)){var m=t.interleaved;m===null?(i.next=i,zp(t)):(i.next=m.next,m.next=i),t.interleaved=i;return}}catch{}finally{}n=Cy(e,t,i,r),n!==null&&(i=mt(),ln(n,e,r,i),Vy(n,t,r))}}function zy(e){var t=e.alternate;return e===Ne||t!==null&&t===Ne}function By(e,t){Pa=Xc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Vy(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Tp(e,n)}}var Zc={readContext:Kt,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useInsertionEffect:it,useLayoutEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useMutableSource:it,useSyncExternalStore:it,useId:it,unstable_isNewReconciler:!1},Jx={readContext:Kt,useCallback:function(e,t){return Cn().memoizedState=[e,t===void 0?null:t],e},useContext:Kt,useEffect:Wm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Cc(4194308,4,My.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Cc(4194308,4,e,t)},useInsertionEffect:function(e,t){return Cc(4,2,e,t)},useMemo:function(e,t){var n=Cn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Cn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Kx.bind(null,Ne,e),[r.memoizedState,e]},useRef:function(e){var t=Cn();return e={current:e},t.memoizedState=e},useState:Vm,useDebugValue:Jp,useDeferredValue:function(e){return Cn().memoizedState=e},useTransition:function(){var e=Vm(!1),t=e[0];return e=Qx.bind(null,e[1]),Cn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Ne,i=Cn();if(Te){if(n===void 0)throw Error(K(407));n=n()}else{if(n=t(),He===null)throw Error(K(349));ms&30||Ty(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Wm(Iy.bind(null,r,a,e),[e]),r.flags|=2048,Za(9,Ry.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Cn(),t=He.identifierPrefix;if(Te){var n=Gn,r=Hn;n=(r&~(1<<32-cn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=qa++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Gx++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},qx={readContext:Kt,useCallback:Ay,useContext:Kt,useEffect:Yp,useImperativeHandle:Oy,useInsertionEffect:Dy,useLayoutEffect:Ly,useMemo:$y,useReducer:eu,useRef:jy,useState:function(){return eu(Xa)},useDebugValue:Jp,useDeferredValue:function(e){var t=Yt();return Fy(t,Be.memoizedState,e)},useTransition:function(){var e=eu(Xa)[0],t=Yt().memoizedState;return[e,t]},useMutableSource:Ey,useSyncExternalStore:ky,useId:Uy,unstable_isNewReconciler:!1},Xx={readContext:Kt,useCallback:Ay,useContext:Kt,useEffect:Yp,useImperativeHandle:Oy,useInsertionEffect:Dy,useLayoutEffect:Ly,useMemo:$y,useReducer:tu,useRef:jy,useState:function(){return tu(Xa)},useDebugValue:Jp,useDeferredValue:function(e){var t=Yt();return Be===null?t.memoizedState=e:Fy(t,Be.memoizedState,e)},useTransition:function(){var e=tu(Xa)[0],t=Yt().memoizedState;return[e,t]},useMutableSource:Ey,useSyncExternalStore:ky,useId:Uy,unstable_isNewReconciler:!1};function sn(e,t){if(e&&e.defaultProps){t=Pe({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Gu(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Pe({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var fl={isMounted:function(e){return(e=e._reactInternals)?Ss(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=mt(),i=Cr(e),a=Qn(r,i);a.payload=t,n!=null&&(a.callback=n),t=_r(e,a,i),t!==null&&(ln(t,e,i,r),_c(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=mt(),i=Cr(e),a=Qn(r,i);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=_r(e,a,i),t!==null&&(ln(t,e,i,r),_c(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=mt(),r=Cr(e),i=Qn(n,r);i.tag=2,t!=null&&(i.callback=t),t=_r(e,i,r),t!==null&&(ln(t,e,r,n),_c(t,e,r))}};function Hm(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!Ha(n,r)||!Ha(i,a):!0}function Wy(e,t,n){var r=!1,i=kr,a=t.contextType;return typeof a=="object"&&a!==null?a=Kt(a):(i=bt(t)?fs:ct.current,r=t.contextTypes,a=(r=r!=null)?Ti(e,i):kr),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=fl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Gm(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&fl.enqueueReplaceState(t,t.state,null)}function Qu(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Bp(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=Kt(a):(a=bt(t)?fs:ct.current,i.context=Ti(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(Gu(e,t,a,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&fl.enqueueReplaceState(i,i.state,null),Jc(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Pi(e,t){try{var n="",r=t;do n+=kC(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function nu(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ku(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Zx=typeof WeakMap=="function"?WeakMap:Map;function Hy(e,t,n){n=Qn(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){tl||(tl=!0,sp=r),Ku(e,t)},n}function Gy(e,t,n){n=Qn(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Ku(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Ku(e,t),typeof r!="function"&&(Sr===null?Sr=new Set([this]):Sr.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Qm(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Zx;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=f0.bind(null,e,t,n),t.then(e,e))}function Km(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ym(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Qn(-1,1),t.tag=2,_r(n,t,1))),n.lanes|=1),e)}var e0=Zn.ReactCurrentOwner,Ct=!1;function ft(e,t,n,r){t.child=e===null?Sy(t,null,n,r):Ii(t,e.child,n,r)}function Jm(e,t,n,r,i){n=n.render;var a=t.ref;return wi(t,i),r=Qp(e,t,n,r,a,i),n=Kp(),e!==null&&!Ct?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Xn(e,t,i)):(Te&&n&&Mp(t),t.flags|=1,ft(e,t,r,i),t.child)}function qm(e,t,n,r,i){if(e===null){var a=n.type;return typeof a=="function"&&!sf(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,Qy(e,t,a,r,i)):(e=kc(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:Ha,n(o,r)&&e.ref===t.ref)return Xn(e,t,i)}return t.flags|=1,e=xr(a,r),e.ref=t.ref,e.return=t,t.child=e}function Qy(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if(Ha(a,r)&&e.ref===t.ref)if(Ct=!1,t.pendingProps=r=a,(e.lanes&i)!==0)e.flags&131072&&(Ct=!0);else return t.lanes=e.lanes,Xn(e,t,i)}return Yu(e,t,n,r,i)}function Ky(e,t,n){var r=t.pendingProps,i=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},_e(pi,Pt),Pt|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,_e(pi,Pt),Pt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,_e(pi,Pt),Pt|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,_e(pi,Pt),Pt|=r;return ft(e,t,i,n),t.child}function Yy(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Yu(e,t,n,r,i){var a=bt(n)?fs:ct.current;return a=Ti(t,a),wi(t,i),n=Qp(e,t,n,r,a,i),r=Kp(),e!==null&&!Ct?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Xn(e,t,i)):(Te&&r&&Mp(t),t.flags|=1,ft(e,t,n,i),t.child)}function Xm(e,t,n,r,i){if(bt(n)){var a=!0;Hc(t)}else a=!1;if(wi(t,i),t.stateNode===null)xc(e,t),Wy(t,n,r),Qu(t,n,r,i),r=!0;else if(e===null){var o=t.stateNode,f=t.memoizedProps;o.props=f;var m=o.context,_=n.contextType;typeof _=="object"&&_!==null?_=Kt(_):(_=bt(n)?fs:ct.current,_=Ti(t,_));var p=n.getDerivedStateFromProps,S=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";S||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(f!==r||m!==_)&&Gm(t,o,r,_),dr=!1;var k=t.memoizedState;o.state=k,Jc(t,r,o,i),m=t.memoizedState,f!==r||k!==m||xt.current||dr?(typeof p=="function"&&(Gu(t,n,p,r),m=t.memoizedState),(f=dr||Hm(t,n,f,r,k,m,_))?(S||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=_,r=f):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,xy(e,t),f=t.memoizedProps,_=t.type===t.elementType?f:sn(t.type,f),o.props=_,S=t.pendingProps,k=o.context,m=n.contextType,typeof m=="object"&&m!==null?m=Kt(m):(m=bt(n)?fs:ct.current,m=Ti(t,m));var M=n.getDerivedStateFromProps;(p=typeof M=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(f!==S||k!==m)&&Gm(t,o,r,m),dr=!1,k=t.memoizedState,o.state=k,Jc(t,r,o,i);var V=t.memoizedState;f!==S||k!==V||xt.current||dr?(typeof M=="function"&&(Gu(t,n,M,r),V=t.memoizedState),(_=dr||Hm(t,n,_,r,k,V,m)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,V,m),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,V,m)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=V),o.props=r,o.state=V,o.context=m,r=_):(typeof o.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),r=!1)}return Ju(e,t,n,r,a,i)}function Ju(e,t,n,r,i,a){Yy(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return i&&Am(t,n,!1),Xn(e,t,a);r=t.stateNode,e0.current=t;var f=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Ii(t,e.child,null,a),t.child=Ii(t,null,f,a)):ft(e,t,f,a),t.memoizedState=r.state,i&&Am(t,n,!0),t.child}function Jy(e){var t=e.stateNode;t.pendingContext?Om(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Om(e,t.context,!1),Vp(e,t.containerInfo)}function Zm(e,t,n,r,i){return Ri(),Ap(i),t.flags|=256,ft(e,t,n,r),t.child}var qu={dehydrated:null,treeContext:null,retryLane:0};function Xu(e){return{baseLanes:e,cachePool:null,transitions:null}}function qy(e,t,n){var r=t.pendingProps,i=Ie.current,a=!1,o=(t.flags&128)!==0,f;if((f=o)||(f=e!==null&&e.memoizedState===null?!1:(i&2)!==0),f?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),_e(Ie,i&1),e===null)return Wu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=gl(o,r,0,null),e=ps(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Xu(n),t.memoizedState=qu,e):qp(t,o));if(i=e.memoizedState,i!==null&&(f=i.dehydrated,f!==null))return t0(e,t,o,r,f,i,n);if(a){a=r.fallback,o=t.mode,i=e.child,f=i.sibling;var m={mode:"hidden",children:r.children};return!(o&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=m,t.deletions=null):(r=xr(i,m),r.subtreeFlags=i.subtreeFlags&14680064),f!==null?a=xr(f,a):(a=ps(a,o,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,o=e.child.memoizedState,o=o===null?Xu(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~n,t.memoizedState=qu,r}return a=e.child,e=a.sibling,r=xr(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function qp(e,t){return t=gl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function oc(e,t,n,r){return r!==null&&Ap(r),Ii(t,e.child,null,n),e=qp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function t0(e,t,n,r,i,a,o){if(n)return t.flags&256?(t.flags&=-257,r=nu(Error(K(422))),oc(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=gl({mode:"visible",children:r.children},i,0,null),a=ps(a,i,o,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&Ii(t,e.child,null,o),t.child.memoizedState=Xu(o),t.memoizedState=qu,a);if(!(t.mode&1))return oc(e,t,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var f=r.dgst;return r=f,a=Error(K(419)),r=nu(a,r,void 0),oc(e,t,o,r)}if(f=(o&e.childLanes)!==0,Ct||f){if(r=He,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,qn(e,i),ln(r,e,i,-1))}return rf(),r=nu(Error(K(421))),oc(e,t,o,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=h0.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,Dt=wr(i.nextSibling),Lt=t,Te=!0,on=null,e!==null&&(Wt[Ht++]=Hn,Wt[Ht++]=Gn,Wt[Ht++]=hs,Hn=e.id,Gn=e.overflow,hs=t),t=qp(t,r.children),t.flags|=4096,t)}function eg(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Hu(e.return,t,n)}function ru(e,t,n,r,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Xy(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(ft(e,t,r.children,n),r=Ie.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&eg(e,n,t);else if(e.tag===19)eg(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(_e(Ie,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&qc(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ru(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&qc(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ru(t,!0,n,null,a);break;case"together":ru(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function xc(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Xn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),gs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(K(153));if(t.child!==null){for(e=t.child,n=xr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=xr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function n0(e,t,n){switch(t.tag){case 3:Jy(t),Ri();break;case 5:by(t);break;case 1:bt(t.type)&&Hc(t);break;case 4:Vp(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;_e(Kc,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(_e(Ie,Ie.current&1),t.flags|=128,null):n&t.child.childLanes?qy(e,t,n):(_e(Ie,Ie.current&1),e=Xn(e,t,n),e!==null?e.sibling:null);_e(Ie,Ie.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Xy(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),_e(Ie,Ie.current),r)break;return null;case 22:case 23:return t.lanes=0,Ky(e,t,n)}return Xn(e,t,n)}var Zy,Zu,ew,tw;Zy=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Zu=function(){};ew=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,es(Rn.current);var a=null;switch(n){case"input":i=Su(e,i),r=Su(e,r),a=[];break;case"select":i=Pe({},i,{value:void 0}),r=Pe({},r,{value:void 0}),a=[];break;case"textarea":i=bu(e,i),r=bu(e,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Vc)}ku(n,r);var o;n=null;for(_ in i)if(!r.hasOwnProperty(_)&&i.hasOwnProperty(_)&&i[_]!=null)if(_==="style"){var f=i[_];for(o in f)f.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else _!=="dangerouslySetInnerHTML"&&_!=="children"&&_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&($a.hasOwnProperty(_)?a||(a=[]):(a=a||[]).push(_,null));for(_ in r){var m=r[_];if(f=i!=null?i[_]:void 0,r.hasOwnProperty(_)&&m!==f&&(m!=null||f!=null))if(_==="style")if(f){for(o in f)!f.hasOwnProperty(o)||m&&m.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in m)m.hasOwnProperty(o)&&f[o]!==m[o]&&(n||(n={}),n[o]=m[o])}else n||(a||(a=[]),a.push(_,n)),n=m;else _==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,f=f?f.__html:void 0,m!=null&&f!==m&&(a=a||[]).push(_,m)):_==="children"?typeof m!="string"&&typeof m!="number"||(a=a||[]).push(_,""+m):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&($a.hasOwnProperty(_)?(m!=null&&_==="onScroll"&&xe("scroll",e),a||f===m||(a=[])):(a=a||[]).push(_,m))}n&&(a=a||[]).push("style",n);var _=a;(t.updateQueue=_)&&(t.flags|=4)}};tw=function(e,t,n,r){n!==r&&(t.flags|=4)};function pa(e,t){if(!Te)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function at(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function r0(e,t,n){var r=t.pendingProps;switch(Op(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(t),null;case 1:return bt(t.type)&&Wc(),at(t),null;case 3:return r=t.stateNode,Ni(),be(xt),be(ct),Hp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ic(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,on!==null&&(op(on),on=null))),Zu(e,t),at(t),null;case 5:Wp(t);var i=es(Ja.current);if(n=t.type,e!==null&&t.stateNode!=null)ew(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(K(166));return at(t),null}if(e=es(Rn.current),ic(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[kn]=t,r[Ka]=a,e=(t.mode&1)!==0,n){case"dialog":xe("cancel",r),xe("close",r);break;case"iframe":case"object":case"embed":xe("load",r);break;case"video":case"audio":for(i=0;i<Ea.length;i++)xe(Ea[i],r);break;case"source":xe("error",r);break;case"img":case"image":case"link":xe("error",r),xe("load",r);break;case"details":xe("toggle",r);break;case"input":lm(r,a),xe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},xe("invalid",r);break;case"textarea":um(r,a),xe("invalid",r)}ku(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var f=a[o];o==="children"?typeof f=="string"?r.textContent!==f&&(a.suppressHydrationWarning!==!0&&sc(r.textContent,f,e),i=["children",f]):typeof f=="number"&&r.textContent!==""+f&&(a.suppressHydrationWarning!==!0&&sc(r.textContent,f,e),i=["children",""+f]):$a.hasOwnProperty(o)&&f!=null&&o==="onScroll"&&xe("scroll",r)}switch(n){case"input":Jo(r),dm(r,a,!0);break;case"textarea":Jo(r),pm(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Vc)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Iv(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[kn]=t,e[Ka]=r,Zy(e,t,!1,!1),t.stateNode=e;e:{switch(o=Tu(n,r),n){case"dialog":xe("cancel",e),xe("close",e),i=r;break;case"iframe":case"object":case"embed":xe("load",e),i=r;break;case"video":case"audio":for(i=0;i<Ea.length;i++)xe(Ea[i],e);i=r;break;case"source":xe("error",e),i=r;break;case"img":case"image":case"link":xe("error",e),xe("load",e),i=r;break;case"details":xe("toggle",e),i=r;break;case"input":lm(e,r),i=Su(e,r),xe("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Pe({},r,{value:void 0}),xe("invalid",e);break;case"textarea":um(e,r),i=bu(e,r),xe("invalid",e);break;default:i=r}ku(n,i),f=i;for(a in f)if(f.hasOwnProperty(a)){var m=f[a];a==="style"?jv(e,m):a==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&Nv(e,m)):a==="children"?typeof m=="string"?(n!=="textarea"||m!=="")&&Fa(e,m):typeof m=="number"&&Fa(e,""+m):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&($a.hasOwnProperty(a)?m!=null&&a==="onScroll"&&xe("scroll",e):m!=null&&Sp(e,a,m,o))}switch(n){case"input":Jo(e),dm(e,r,!1);break;case"textarea":Jo(e),pm(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Er(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?mi(e,!!r.multiple,a,!1):r.defaultValue!=null&&mi(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Vc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return at(t),null;case 6:if(e&&t.stateNode!=null)tw(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(K(166));if(n=es(Ja.current),es(Rn.current),ic(t)){if(r=t.stateNode,n=t.memoizedProps,r[kn]=t,(a=r.nodeValue!==n)&&(e=Lt,e!==null))switch(e.tag){case 3:sc(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&sc(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[kn]=t,t.stateNode=r}return at(t),null;case 13:if(be(Ie),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Te&&Dt!==null&&t.mode&1&&!(t.flags&128))wy(),Ri(),t.flags|=98560,a=!1;else if(a=ic(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(K(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(K(317));a[kn]=t}else Ri(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;at(t),a=!1}else on!==null&&(op(on),on=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ie.current&1?Ve===0&&(Ve=3):rf())),t.updateQueue!==null&&(t.flags|=4),at(t),null);case 4:return Ni(),Zu(e,t),e===null&&Ga(t.stateNode.containerInfo),at(t),null;case 10:return Up(t.type._context),at(t),null;case 17:return bt(t.type)&&Wc(),at(t),null;case 19:if(be(Ie),a=t.memoizedState,a===null)return at(t),null;if(r=(t.flags&128)!==0,o=a.rendering,o===null)if(r)pa(a,!1);else{if(Ve!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=qc(e),o!==null){for(t.flags|=128,pa(a,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return _e(Ie,Ie.current&1|2),t.child}e=e.sibling}a.tail!==null&&Oe()>ji&&(t.flags|=128,r=!0,pa(a,!1),t.lanes=4194304)}else{if(!r)if(e=qc(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),pa(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Te)return at(t),null}else 2*Oe()-a.renderingStartTime>ji&&n!==1073741824&&(t.flags|=128,r=!0,pa(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(n=a.last,n!==null?n.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Oe(),t.sibling=null,n=Ie.current,_e(Ie,r?n&1|2:n&1),t):(at(t),null);case 22:case 23:return nf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Pt&1073741824&&(at(t),t.subtreeFlags&6&&(t.flags|=8192)):at(t),null;case 24:return null;case 25:return null}throw Error(K(156,t.tag))}function s0(e,t){switch(Op(t),t.tag){case 1:return bt(t.type)&&Wc(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ni(),be(xt),be(ct),Hp(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Wp(t),null;case 13:if(be(Ie),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(K(340));Ri()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return be(Ie),null;case 4:return Ni(),null;case 10:return Up(t.type._context),null;case 22:case 23:return nf(),null;case 24:return null;default:return null}}var cc=!1,ot=!1,i0=typeof WeakSet=="function"?WeakSet:Set,ee=null;function ui(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){De(e,t,r)}else n.current=null}function ep(e,t,n){try{n()}catch(r){De(e,t,r)}}var tg=!1;function a0(e,t){if(Au=Uc,e=ay(),Lp(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,f=-1,m=-1,_=0,p=0,S=e,k=null;t:for(;;){for(var M;S!==n||i!==0&&S.nodeType!==3||(f=o+i),S!==a||r!==0&&S.nodeType!==3||(m=o+r),S.nodeType===3&&(o+=S.nodeValue.length),(M=S.firstChild)!==null;)k=S,S=M;for(;;){if(S===e)break t;if(k===n&&++_===i&&(f=o),k===a&&++p===r&&(m=o),(M=S.nextSibling)!==null)break;S=k,k=S.parentNode}S=M}n=f===-1||m===-1?null:{start:f,end:m}}else n=null}n=n||{start:0,end:0}}else n=null;for($u={focusedElem:e,selectionRange:n},Uc=!1,ee=t;ee!==null;)if(t=ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ee=e;else for(;ee!==null;){t=ee;try{var V=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var B=V.memoizedProps,v=V.memoizedState,l=t.stateNode,u=l.getSnapshotBeforeUpdate(t.elementType===t.type?B:sn(t.type,B),v);l.__reactInternalSnapshotBeforeUpdate=u}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(C){De(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,ee=e;break}ee=t.return}return V=tg,tg=!1,V}function ja(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&ep(t,n,a)}i=i.next}while(i!==r)}}function hl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function tp(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function nw(e){var t=e.alternate;t!==null&&(e.alternate=null,nw(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[kn],delete t[Ka],delete t[zu],delete t[Bx],delete t[Vx])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rw(e){return e.tag===5||e.tag===3||e.tag===4}function ng(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||rw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function np(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Vc));else if(r!==4&&(e=e.child,e!==null))for(np(e,t,n),e=e.sibling;e!==null;)np(e,t,n),e=e.sibling}function rp(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(rp(e,t,n),e=e.sibling;e!==null;)rp(e,t,n),e=e.sibling}var Je=null,an=!1;function cr(e,t,n){for(n=n.child;n!==null;)sw(e,t,n),n=n.sibling}function sw(e,t,n){if(Tn&&typeof Tn.onCommitFiberUnmount=="function")try{Tn.onCommitFiberUnmount(al,n)}catch{}switch(n.tag){case 5:ot||ui(n,t);case 6:var r=Je,i=an;Je=null,cr(e,t,n),Je=r,an=i,Je!==null&&(an?(e=Je,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Je.removeChild(n.stateNode));break;case 18:Je!==null&&(an?(e=Je,n=n.stateNode,e.nodeType===8?Jd(e.parentNode,n):e.nodeType===1&&Jd(e,n),Va(e)):Jd(Je,n.stateNode));break;case 4:r=Je,i=an,Je=n.stateNode.containerInfo,an=!0,cr(e,t,n),Je=r,an=i;break;case 0:case 11:case 14:case 15:if(!ot&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&ep(n,t,o),i=i.next}while(i!==r)}cr(e,t,n);break;case 1:if(!ot&&(ui(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(f){De(n,t,f)}cr(e,t,n);break;case 21:cr(e,t,n);break;case 22:n.mode&1?(ot=(r=ot)||n.memoizedState!==null,cr(e,t,n),ot=r):cr(e,t,n);break;default:cr(e,t,n)}}function rg(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new i0),t.forEach(function(r){var i=m0.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function rn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,f=o;e:for(;f!==null;){switch(f.tag){case 5:Je=f.stateNode,an=!1;break e;case 3:Je=f.stateNode.containerInfo,an=!0;break e;case 4:Je=f.stateNode.containerInfo,an=!0;break e}f=f.return}if(Je===null)throw Error(K(160));sw(a,o,i),Je=null,an=!1;var m=i.alternate;m!==null&&(m.return=null),i.return=null}catch(_){De(i,t,_)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)iw(t,e),t=t.sibling}function iw(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(rn(t,e),wn(e),r&4){try{ja(3,e,e.return),hl(3,e)}catch(B){De(e,e.return,B)}try{ja(5,e,e.return)}catch(B){De(e,e.return,B)}}break;case 1:rn(t,e),wn(e),r&512&&n!==null&&ui(n,n.return);break;case 5:if(rn(t,e),wn(e),r&512&&n!==null&&ui(n,n.return),e.flags&32){var i=e.stateNode;try{Fa(i,"")}catch(B){De(e,e.return,B)}}if(r&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=n!==null?n.memoizedProps:a,f=e.type,m=e.updateQueue;if(e.updateQueue=null,m!==null)try{f==="input"&&a.type==="radio"&&a.name!=null&&Tv(i,a),Tu(f,o);var _=Tu(f,a);for(o=0;o<m.length;o+=2){var p=m[o],S=m[o+1];p==="style"?jv(i,S):p==="dangerouslySetInnerHTML"?Nv(i,S):p==="children"?Fa(i,S):Sp(i,p,S,_)}switch(f){case"input":Cu(i,a);break;case"textarea":Rv(i,a);break;case"select":var k=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var M=a.value;M!=null?mi(i,!!a.multiple,M,!1):k!==!!a.multiple&&(a.defaultValue!=null?mi(i,!!a.multiple,a.defaultValue,!0):mi(i,!!a.multiple,a.multiple?[]:"",!1))}i[Ka]=a}catch(B){De(e,e.return,B)}}break;case 6:if(rn(t,e),wn(e),r&4){if(e.stateNode===null)throw Error(K(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(B){De(e,e.return,B)}}break;case 3:if(rn(t,e),wn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Va(t.containerInfo)}catch(B){De(e,e.return,B)}break;case 4:rn(t,e),wn(e);break;case 13:rn(t,e),wn(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(ef=Oe())),r&4&&rg(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(ot=(_=ot)||p,rn(t,e),ot=_):rn(t,e),wn(e),r&8192){if(_=e.memoizedState!==null,(e.stateNode.isHidden=_)&&!p&&e.mode&1)for(ee=e,p=e.child;p!==null;){for(S=ee=p;ee!==null;){switch(k=ee,M=k.child,k.tag){case 0:case 11:case 14:case 15:ja(4,k,k.return);break;case 1:ui(k,k.return);var V=k.stateNode;if(typeof V.componentWillUnmount=="function"){r=k,n=k.return;try{t=r,V.props=t.memoizedProps,V.state=t.memoizedState,V.componentWillUnmount()}catch(B){De(r,n,B)}}break;case 5:ui(k,k.return);break;case 22:if(k.memoizedState!==null){ig(S);continue}}M!==null?(M.return=k,ee=M):ig(S)}p=p.sibling}e:for(p=null,S=e;;){if(S.tag===5){if(p===null){p=S;try{i=S.stateNode,_?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(f=S.stateNode,m=S.memoizedProps.style,o=m!=null&&m.hasOwnProperty("display")?m.display:null,f.style.display=Pv("display",o))}catch(B){De(e,e.return,B)}}}else if(S.tag===6){if(p===null)try{S.stateNode.nodeValue=_?"":S.memoizedProps}catch(B){De(e,e.return,B)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===e)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===e)break e;for(;S.sibling===null;){if(S.return===null||S.return===e)break e;p===S&&(p=null),S=S.return}p===S&&(p=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:rn(t,e),wn(e),r&4&&rg(e);break;case 21:break;default:rn(t,e),wn(e)}}function wn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(rw(n)){var r=n;break e}n=n.return}throw Error(K(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Fa(i,""),r.flags&=-33);var a=ng(e);rp(e,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,f=ng(e);np(e,f,o);break;default:throw Error(K(161))}}catch(m){De(e,e.return,m)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function o0(e,t,n){ee=e,aw(e)}function aw(e,t,n){for(var r=(e.mode&1)!==0;ee!==null;){var i=ee,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||cc;if(!o){var f=i.alternate,m=f!==null&&f.memoizedState!==null||ot;f=cc;var _=ot;if(cc=o,(ot=m)&&!_)for(ee=i;ee!==null;)o=ee,m=o.child,o.tag===22&&o.memoizedState!==null?ag(i):m!==null?(m.return=o,ee=m):ag(i);for(;a!==null;)ee=a,aw(a),a=a.sibling;ee=i,cc=f,ot=_}sg(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,ee=a):sg(e)}}function sg(e){for(;ee!==null;){var t=ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ot||hl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ot)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:sn(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Bm(t,a,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Bm(t,o,n)}break;case 5:var f=t.stateNode;if(n===null&&t.flags&4){n=f;var m=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&n.focus();break;case"img":m.src&&(n.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var _=t.alternate;if(_!==null){var p=_.memoizedState;if(p!==null){var S=p.dehydrated;S!==null&&Va(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}ot||t.flags&512&&tp(t)}catch(k){De(t,t.return,k)}}if(t===e){ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,ee=n;break}ee=t.return}}function ig(e){for(;ee!==null;){var t=ee;if(t===e){ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ee=n;break}ee=t.return}}function ag(e){for(;ee!==null;){var t=ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{hl(4,t)}catch(m){De(t,n,m)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(m){De(t,i,m)}}var a=t.return;try{tp(t)}catch(m){De(t,a,m)}break;case 5:var o=t.return;try{tp(t)}catch(m){De(t,o,m)}}}catch(m){De(t,t.return,m)}if(t===e){ee=null;break}var f=t.sibling;if(f!==null){f.return=t.return,ee=f;break}ee=t.return}}var c0=Math.ceil,el=Zn.ReactCurrentDispatcher,Xp=Zn.ReactCurrentOwner,Qt=Zn.ReactCurrentBatchConfig,me=0,He=null,Ue=null,qe=0,Pt=0,pi=Rr(0),Ve=0,eo=null,gs=0,ml=0,Zp=0,Da=null,St=null,ef=0,ji=1/0,Vn=null,tl=!1,sp=null,Sr=null,lc=!1,mr=null,nl=0,La=0,ip=null,bc=-1,Ec=0;function mt(){return me&6?Oe():bc!==-1?bc:bc=Oe()}function Cr(e){return e.mode&1?me&2&&qe!==0?qe&-qe:Hx.transition!==null?(Ec===0&&(Ec=Wv()),Ec):(e=ge,e!==0||(e=window.event,e=e===void 0?16:qv(e.type)),e):1}function ln(e,t,n,r){if(50<La)throw La=0,ip=null,Error(K(185));ro(e,n,r),(!(me&2)||e!==He)&&(e===He&&(!(me&2)&&(ml|=n),Ve===4&&pr(e,qe)),Et(e,r),n===1&&me===0&&!(t.mode&1)&&(ji=Oe()+500,ul&&Ir()))}function Et(e,t){var n=e.callbackNode;HC(e,t);var r=Fc(e,e===He?qe:0);if(r===0)n!==null&&mm(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&mm(n),t===1)e.tag===0?Wx(og.bind(null,e)):gy(og.bind(null,e)),Ux(function(){!(me&6)&&Ir()}),n=null;else{switch(Hv(r)){case 1:n=kp;break;case 4:n=Bv;break;case 16:n=$c;break;case 536870912:n=Vv;break;default:n=$c}n=hw(n,ow.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ow(e,t){if(bc=-1,Ec=0,me&6)throw Error(K(327));var n=e.callbackNode;if(_i()&&e.callbackNode!==n)return null;var r=Fc(e,e===He?qe:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=rl(e,r);else{t=r;var i=me;me|=2;var a=lw();(He!==e||qe!==t)&&(Vn=null,ji=Oe()+500,us(e,t));do try{u0();break}catch(f){cw(e,f)}while(!0);Fp(),el.current=a,me=i,Ue!==null?t=0:(He=null,qe=0,t=Ve)}if(t!==0){if(t===2&&(i=ju(e),i!==0&&(r=i,t=ap(e,i))),t===1)throw n=eo,us(e,0),pr(e,r),Et(e,Oe()),n;if(t===6)pr(e,r);else{if(i=e.current.alternate,!(r&30)&&!l0(i)&&(t=rl(e,r),t===2&&(a=ju(e),a!==0&&(r=a,t=ap(e,a))),t===1))throw n=eo,us(e,0),pr(e,r),Et(e,Oe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(K(345));case 2:qr(e,St,Vn);break;case 3:if(pr(e,r),(r&130023424)===r&&(t=ef+500-Oe(),10<t)){if(Fc(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){mt(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Uu(qr.bind(null,e,St,Vn),t);break}qr(e,St,Vn);break;case 4:if(pr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-cn(r);a=1<<o,o=t[o],o>i&&(i=o),r&=~a}if(r=i,r=Oe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*c0(r/1960))-r,10<r){e.timeoutHandle=Uu(qr.bind(null,e,St,Vn),r);break}qr(e,St,Vn);break;case 5:qr(e,St,Vn);break;default:throw Error(K(329))}}}return Et(e,Oe()),e.callbackNode===n?ow.bind(null,e):null}function ap(e,t){var n=Da;return e.current.memoizedState.isDehydrated&&(us(e,t).flags|=256),e=rl(e,t),e!==2&&(t=St,St=n,t!==null&&op(t)),e}function op(e){St===null?St=e:St.push.apply(St,e)}function l0(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!un(a(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function pr(e,t){for(t&=~Zp,t&=~ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-cn(t),r=1<<n;e[n]=-1,t&=~r}}function og(e){if(me&6)throw Error(K(327));_i();var t=Fc(e,0);if(!(t&1))return Et(e,Oe()),null;var n=rl(e,t);if(e.tag!==0&&n===2){var r=ju(e);r!==0&&(t=r,n=ap(e,r))}if(n===1)throw n=eo,us(e,0),pr(e,t),Et(e,Oe()),n;if(n===6)throw Error(K(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,qr(e,St,Vn),Et(e,Oe()),null}function tf(e,t){var n=me;me|=1;try{return e(t)}finally{me=n,me===0&&(ji=Oe()+500,ul&&Ir())}}function vs(e){mr!==null&&mr.tag===0&&!(me&6)&&_i();var t=me;me|=1;var n=Qt.transition,r=ge;try{if(Qt.transition=null,ge=1,e)return e()}finally{ge=r,Qt.transition=n,me=t,!(me&6)&&Ir()}}function nf(){Pt=pi.current,be(pi)}function us(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Fx(n)),Ue!==null)for(n=Ue.return;n!==null;){var r=n;switch(Op(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Wc();break;case 3:Ni(),be(xt),be(ct),Hp();break;case 5:Wp(r);break;case 4:Ni();break;case 13:be(Ie);break;case 19:be(Ie);break;case 10:Up(r.type._context);break;case 22:case 23:nf()}n=n.return}if(He=e,Ue=e=xr(e.current,null),qe=Pt=t,Ve=0,eo=null,Zp=ml=gs=0,St=Da=null,Zr!==null){for(t=0;t<Zr.length;t++)if(n=Zr[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}Zr=null}return e}function cw(e,t){do{var n=Ue;try{if(Fp(),Sc.current=Zc,Xc){for(var r=Ne.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Xc=!1}if(ms=0,We=Be=Ne=null,Pa=!1,qa=0,Xp.current=null,n===null||n.return===null){Ve=1,eo=t,Ue=null;break}e:{var a=e,o=n.return,f=n,m=t;if(t=qe,f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var _=m,p=f,S=p.tag;if(!(p.mode&1)&&(S===0||S===11||S===15)){var k=p.alternate;k?(p.updateQueue=k.updateQueue,p.memoizedState=k.memoizedState,p.lanes=k.lanes):(p.updateQueue=null,p.memoizedState=null)}var M=Km(o);if(M!==null){M.flags&=-257,Ym(M,o,f,a,t),M.mode&1&&Qm(a,_,t),t=M,m=_;var V=t.updateQueue;if(V===null){var B=new Set;B.add(m),t.updateQueue=B}else V.add(m);break e}else{if(!(t&1)){Qm(a,_,t),rf();break e}m=Error(K(426))}}else if(Te&&f.mode&1){var v=Km(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Ym(v,o,f,a,t),Ap(Pi(m,f));break e}}a=m=Pi(m,f),Ve!==4&&(Ve=2),Da===null?Da=[a]:Da.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var l=Hy(a,m,t);zm(a,l);break e;case 1:f=m;var u=a.type,g=a.stateNode;if(!(a.flags&128)&&(typeof u.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Sr===null||!Sr.has(g)))){a.flags|=65536,t&=-t,a.lanes|=t;var C=Gy(a,f,t);zm(a,C);break e}}a=a.return}while(a!==null)}uw(n)}catch(N){t=N,Ue===n&&n!==null&&(Ue=n=n.return);continue}break}while(!0)}function lw(){var e=el.current;return el.current=Zc,e===null?Zc:e}function rf(){(Ve===0||Ve===3||Ve===2)&&(Ve=4),He===null||!(gs&268435455)&&!(ml&268435455)||pr(He,qe)}function rl(e,t){var n=me;me|=2;var r=lw();(He!==e||qe!==t)&&(Vn=null,us(e,t));do try{d0();break}catch(i){cw(e,i)}while(!0);if(Fp(),me=n,el.current=r,Ue!==null)throw Error(K(261));return He=null,qe=0,Ve}function d0(){for(;Ue!==null;)dw(Ue)}function u0(){for(;Ue!==null&&!OC();)dw(Ue)}function dw(e){var t=fw(e.alternate,e,Pt);e.memoizedProps=e.pendingProps,t===null?uw(e):Ue=t,Xp.current=null}function uw(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=s0(n,t),n!==null){n.flags&=32767,Ue=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ve=6,Ue=null;return}}else if(n=r0(n,t,Pt),n!==null){Ue=n;return}if(t=t.sibling,t!==null){Ue=t;return}Ue=t=e}while(t!==null);Ve===0&&(Ve=5)}function qr(e,t,n){var r=ge,i=Qt.transition;try{Qt.transition=null,ge=1,p0(e,t,n,r)}finally{Qt.transition=i,ge=r}return null}function p0(e,t,n,r){do _i();while(mr!==null);if(me&6)throw Error(K(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(K(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(GC(e,a),e===He&&(Ue=He=null,qe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||lc||(lc=!0,hw($c,function(){return _i(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Qt.transition,Qt.transition=null;var o=ge;ge=1;var f=me;me|=4,Xp.current=null,a0(e,n),iw(n,e),jx($u),Uc=!!Au,$u=Au=null,e.current=n,o0(n),AC(),me=f,ge=o,Qt.transition=a}else e.current=n;if(lc&&(lc=!1,mr=e,nl=i),a=e.pendingLanes,a===0&&(Sr=null),UC(n.stateNode),Et(e,Oe()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(tl)throw tl=!1,e=sp,sp=null,e;return nl&1&&e.tag!==0&&_i(),a=e.pendingLanes,a&1?e===ip?La++:(La=0,ip=e):La=0,Ir(),null}function _i(){if(mr!==null){var e=Hv(nl),t=Qt.transition,n=ge;try{if(Qt.transition=null,ge=16>e?16:e,mr===null)var r=!1;else{if(e=mr,mr=null,nl=0,me&6)throw Error(K(331));var i=me;for(me|=4,ee=e.current;ee!==null;){var a=ee,o=a.child;if(ee.flags&16){var f=a.deletions;if(f!==null){for(var m=0;m<f.length;m++){var _=f[m];for(ee=_;ee!==null;){var p=ee;switch(p.tag){case 0:case 11:case 15:ja(8,p,a)}var S=p.child;if(S!==null)S.return=p,ee=S;else for(;ee!==null;){p=ee;var k=p.sibling,M=p.return;if(nw(p),p===_){ee=null;break}if(k!==null){k.return=M,ee=k;break}ee=M}}}var V=a.alternate;if(V!==null){var B=V.child;if(B!==null){V.child=null;do{var v=B.sibling;B.sibling=null,B=v}while(B!==null)}}ee=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,ee=o;else e:for(;ee!==null;){if(a=ee,a.flags&2048)switch(a.tag){case 0:case 11:case 15:ja(9,a,a.return)}var l=a.sibling;if(l!==null){l.return=a.return,ee=l;break e}ee=a.return}}var u=e.current;for(ee=u;ee!==null;){o=ee;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,ee=g;else e:for(o=u;ee!==null;){if(f=ee,f.flags&2048)try{switch(f.tag){case 0:case 11:case 15:hl(9,f)}}catch(N){De(f,f.return,N)}if(f===o){ee=null;break e}var C=f.sibling;if(C!==null){C.return=f.return,ee=C;break e}ee=f.return}}if(me=i,Ir(),Tn&&typeof Tn.onPostCommitFiberRoot=="function")try{Tn.onPostCommitFiberRoot(al,e)}catch{}r=!0}return r}finally{ge=n,Qt.transition=t}}return!1}function cg(e,t,n){t=Pi(n,t),t=Hy(e,t,1),e=_r(e,t,1),t=mt(),e!==null&&(ro(e,1,t),Et(e,t))}function De(e,t,n){if(e.tag===3)cg(e,e,n);else for(;t!==null;){if(t.tag===3){cg(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Sr===null||!Sr.has(r))){e=Pi(n,e),e=Gy(t,e,1),t=_r(t,e,1),e=mt(),t!==null&&(ro(t,1,e),Et(t,e));break}}t=t.return}}function f0(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=mt(),e.pingedLanes|=e.suspendedLanes&n,He===e&&(qe&n)===n&&(Ve===4||Ve===3&&(qe&130023424)===qe&&500>Oe()-ef?us(e,0):Zp|=n),Et(e,t)}function pw(e,t){t===0&&(e.mode&1?(t=Zo,Zo<<=1,!(Zo&130023424)&&(Zo=4194304)):t=1);var n=mt();e=qn(e,t),e!==null&&(ro(e,t,n),Et(e,n))}function h0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),pw(e,n)}function m0(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(t),pw(e,n)}var fw;fw=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||xt.current)Ct=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Ct=!1,n0(e,t,n);Ct=!!(e.flags&131072)}else Ct=!1,Te&&t.flags&1048576&&vy(t,Qc,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;xc(e,t),e=t.pendingProps;var i=Ti(t,ct.current);wi(t,n),i=Qp(null,t,r,e,i,n);var a=Kp();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,bt(r)?(a=!0,Hc(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Bp(t),i.updater=fl,t.stateNode=i,i._reactInternals=t,Qu(t,r,e,n),t=Ju(null,t,r,!0,a,n)):(t.tag=0,Te&&a&&Mp(t),ft(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(xc(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=v0(r),e=sn(r,e),i){case 0:t=Yu(null,t,r,e,n);break e;case 1:t=Xm(null,t,r,e,n);break e;case 11:t=Jm(null,t,r,e,n);break e;case 14:t=qm(null,t,r,sn(r.type,e),n);break e}throw Error(K(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:sn(r,i),Yu(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:sn(r,i),Xm(e,t,r,i,n);case 3:e:{if(Jy(t),e===null)throw Error(K(387));r=t.pendingProps,a=t.memoizedState,i=a.element,xy(e,t),Jc(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=Pi(Error(K(423)),t),t=Zm(e,t,r,n,i);break e}else if(r!==i){i=Pi(Error(K(424)),t),t=Zm(e,t,r,n,i);break e}else for(Dt=wr(t.stateNode.containerInfo.firstChild),Lt=t,Te=!0,on=null,n=Sy(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ri(),r===i){t=Xn(e,t,n);break e}ft(e,t,r,n)}t=t.child}return t;case 5:return by(t),e===null&&Wu(t),r=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,Fu(r,i)?o=null:a!==null&&Fu(r,a)&&(t.flags|=32),Yy(e,t),ft(e,t,o,n),t.child;case 6:return e===null&&Wu(t),null;case 13:return qy(e,t,n);case 4:return Vp(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ii(t,null,r,n):ft(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:sn(r,i),Jm(e,t,r,i,n);case 7:return ft(e,t,t.pendingProps,n),t.child;case 8:return ft(e,t,t.pendingProps.children,n),t.child;case 12:return ft(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,_e(Kc,r._currentValue),r._currentValue=o,a!==null)if(un(a.value,o)){if(a.children===i.children&&!xt.current){t=Xn(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var f=a.dependencies;if(f!==null){o=a.child;for(var m=f.firstContext;m!==null;){if(m.context===r){if(a.tag===1){m=Qn(-1,n&-n),m.tag=2;var _=a.updateQueue;if(_!==null){_=_.shared;var p=_.pending;p===null?m.next=m:(m.next=p.next,p.next=m),_.pending=m}}a.lanes|=n,m=a.alternate,m!==null&&(m.lanes|=n),Hu(a.return,n,t),f.lanes|=n;break}m=m.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(K(341));o.lanes|=n,f=o.alternate,f!==null&&(f.lanes|=n),Hu(o,n,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}ft(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,wi(t,n),i=Kt(i),r=r(i),t.flags|=1,ft(e,t,r,n),t.child;case 14:return r=t.type,i=sn(r,t.pendingProps),i=sn(r.type,i),qm(e,t,r,i,n);case 15:return Qy(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:sn(r,i),xc(e,t),t.tag=1,bt(r)?(e=!0,Hc(t)):e=!1,wi(t,n),Wy(t,r,i),Qu(t,r,i,n),Ju(null,t,r,!0,e,n);case 19:return Xy(e,t,n);case 22:return Ky(e,t,n)}throw Error(K(156,t.tag))};function hw(e,t){return zv(e,t)}function g0(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gt(e,t,n,r){return new g0(e,t,n,r)}function sf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function v0(e){if(typeof e=="function")return sf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===xp)return 11;if(e===bp)return 14}return 2}function xr(e,t){var n=e.alternate;return n===null?(n=Gt(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function kc(e,t,n,r,i,a){var o=2;if(r=e,typeof e=="function")sf(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case ni:return ps(n.children,i,a,t);case Cp:o=8,i|=8;break;case vu:return e=Gt(12,n,t,i|2),e.elementType=vu,e.lanes=a,e;case yu:return e=Gt(13,n,t,i),e.elementType=yu,e.lanes=a,e;case wu:return e=Gt(19,n,t,i),e.elementType=wu,e.lanes=a,e;case bv:return gl(n,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Cv:o=10;break e;case xv:o=9;break e;case xp:o=11;break e;case bp:o=14;break e;case lr:o=16,r=null;break e}throw Error(K(130,e==null?e:typeof e,""))}return t=Gt(o,n,t,i),t.elementType=e,t.type=r,t.lanes=a,t}function ps(e,t,n,r){return e=Gt(7,e,r,t),e.lanes=n,e}function gl(e,t,n,r){return e=Gt(22,e,r,t),e.elementType=bv,e.lanes=n,e.stateNode={isHidden:!1},e}function su(e,t,n){return e=Gt(6,e,null,t),e.lanes=n,e}function iu(e,t,n){return t=Gt(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function y0(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fd(0),this.expirationTimes=Fd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fd(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function af(e,t,n,r,i,a,o,f,m){return e=new y0(e,t,n,f,m),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Gt(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bp(a),e}function w0(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ti,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function mw(e){if(!e)return kr;e=e._reactInternals;e:{if(Ss(e)!==e||e.tag!==1)throw Error(K(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(bt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(K(171))}if(e.tag===1){var n=e.type;if(bt(n))return my(e,n,t)}return t}function gw(e,t,n,r,i,a,o,f,m){return e=af(n,r,!0,e,i,a,o,f,m),e.context=mw(null),n=e.current,r=mt(),i=Cr(n),a=Qn(r,i),a.callback=t??null,_r(n,a,i),e.current.lanes=i,ro(e,i,r),Et(e,r),e}function vl(e,t,n,r){var i=t.current,a=mt(),o=Cr(i);return n=mw(n),t.context===null?t.context=n:t.pendingContext=n,t=Qn(a,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=_r(i,t,o),e!==null&&(ln(e,i,o,a),_c(e,i,o)),o}function sl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function lg(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function of(e,t){lg(e,t),(e=e.alternate)&&lg(e,t)}function _0(){return null}var vw=typeof reportError=="function"?reportError:function(e){console.error(e)};function cf(e){this._internalRoot=e}yl.prototype.render=cf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(K(409));vl(e,t,null,null)};yl.prototype.unmount=cf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;vs(function(){vl(null,e,null,null)}),t[Jn]=null}};function yl(e){this._internalRoot=e}yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Kv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ur.length&&t!==0&&t<ur[n].priority;n++);ur.splice(n,0,e),n===0&&Jv(e)}};function lf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function wl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function dg(){}function S0(e,t,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var _=sl(o);a.call(_)}}var o=gw(t,r,e,0,null,!1,!1,"",dg);return e._reactRootContainer=o,e[Jn]=o.current,Ga(e.nodeType===8?e.parentNode:e),vs(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var f=r;r=function(){var _=sl(m);f.call(_)}}var m=af(e,0,!1,null,null,!1,!1,"",dg);return e._reactRootContainer=m,e[Jn]=m.current,Ga(e.nodeType===8?e.parentNode:e),vs(function(){vl(t,m,n,r)}),m}function _l(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var f=i;i=function(){var m=sl(o);f.call(m)}}vl(t,o,e,i)}else o=S0(n,t,e,i,r);return sl(o)}Gv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ba(t.pendingLanes);n!==0&&(Tp(t,n|1),Et(t,Oe()),!(me&6)&&(ji=Oe()+500,Ir()))}break;case 13:vs(function(){var r=qn(e,1);if(r!==null){var i=mt();ln(r,e,1,i)}}),of(e,1)}};Rp=function(e){if(e.tag===13){var t=qn(e,134217728);if(t!==null){var n=mt();ln(t,e,134217728,n)}of(e,134217728)}};Qv=function(e){if(e.tag===13){var t=Cr(e),n=qn(e,t);if(n!==null){var r=mt();ln(n,e,t,r)}of(e,t)}};Kv=function(){return ge};Yv=function(e,t){var n=ge;try{return ge=e,t()}finally{ge=n}};Iu=function(e,t,n){switch(t){case"input":if(Cu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=dl(r);if(!i)throw Error(K(90));kv(r),Cu(r,i)}}}break;case"textarea":Rv(e,n);break;case"select":t=n.value,t!=null&&mi(e,!!n.multiple,t,!1)}};Mv=tf;Ov=vs;var C0={usingClientEntryPoint:!1,Events:[io,ai,dl,Dv,Lv,tf]},fa={findFiberByHostInstance:Xr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x0={bundleType:fa.bundleType,version:fa.version,rendererPackageName:fa.rendererPackageName,rendererConfig:fa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Fv(e),e===null?null:e.stateNode},findFiberByHostInstance:fa.findFiberByHostInstance||_0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dc.isDisabled&&dc.supportsFiber)try{al=dc.inject(x0),Tn=dc}catch{}}Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=C0;Ot.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lf(t))throw Error(K(200));return w0(e,t,null,n)};Ot.createRoot=function(e,t){if(!lf(e))throw Error(K(299));var n=!1,r="",i=vw;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=af(e,1,!1,null,null,n,!1,r,i),e[Jn]=t.current,Ga(e.nodeType===8?e.parentNode:e),new cf(t)};Ot.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(K(188)):(e=Object.keys(e).join(","),Error(K(268,e)));return e=Fv(t),e=e===null?null:e.stateNode,e};Ot.flushSync=function(e){return vs(e)};Ot.hydrate=function(e,t,n){if(!wl(t))throw Error(K(200));return _l(null,e,t,!0,n)};Ot.hydrateRoot=function(e,t,n){if(!lf(e))throw Error(K(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=vw;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=gw(t,null,e,1,n??null,i,!1,a,o),e[Jn]=t.current,Ga(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new yl(t)};Ot.render=function(e,t,n){if(!wl(t))throw Error(K(200));return _l(null,e,t,!1,n)};Ot.unmountComponentAtNode=function(e){if(!wl(e))throw Error(K(40));return e._reactRootContainer?(vs(function(){_l(null,null,e,!1,function(){e._reactRootContainer=null,e[Jn]=null})}),!0):!1};Ot.unstable_batchedUpdates=tf;Ot.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!wl(n))throw Error(K(200));if(e==null||e._reactInternals===void 0)throw Error(K(38));return _l(e,t,n,!1,r)};Ot.version="18.3.1-next-f1338f8080-20240426";function yw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yw)}catch(e){console.error(e)}}yw(),yv.exports=Ot;var b0=yv.exports,ww,ug=b0;ww=ug.createRoot,ug.hydrateRoot;var au={},cp={exports:{}},ou,pg;function E0(){if(pg)return ou;pg=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,a=r*365.25;ou=function(p,S){S=S||{};var k=typeof p;if(k==="string"&&p.length>0)return o(p);if(k==="number"&&isFinite(p))return S.long?m(p):f(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function o(p){if(p=String(p),!(p.length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(S){var k=parseFloat(S[1]),M=(S[2]||"ms").toLowerCase();switch(M){case"years":case"year":case"yrs":case"yr":case"y":return k*a;case"weeks":case"week":case"w":return k*i;case"days":case"day":case"d":return k*r;case"hours":case"hour":case"hrs":case"hr":case"h":return k*n;case"minutes":case"minute":case"mins":case"min":case"m":return k*t;case"seconds":case"second":case"secs":case"sec":case"s":return k*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return k;default:return}}}}function f(p){var S=Math.abs(p);return S>=r?Math.round(p/r)+"d":S>=n?Math.round(p/n)+"h":S>=t?Math.round(p/t)+"m":S>=e?Math.round(p/e)+"s":p+"ms"}function m(p){var S=Math.abs(p);return S>=r?_(p,S,r,"day"):S>=n?_(p,S,n,"hour"):S>=t?_(p,S,t,"minute"):S>=e?_(p,S,e,"second"):p+" ms"}function _(p,S,k,M){var V=S>=k*1.5;return Math.round(p/k)+" "+M+(V?"s":"")}return ou}function k0(e){n.debug=n,n.default=n,n.coerce=m,n.disable=o,n.enable=i,n.enabled=f,n.humanize=E0(),n.destroy=_,Object.keys(e).forEach(p=>{n[p]=e[p]}),n.names=[],n.skips=[],n.formatters={};function t(p){let S=0;for(let k=0;k<p.length;k++)S=(S<<5)-S+p.charCodeAt(k),S|=0;return n.colors[Math.abs(S)%n.colors.length]}n.selectColor=t;function n(p){let S,k=null,M,V;function B(...v){if(!B.enabled)return;const l=B,u=Number(new Date),g=u-(S||u);l.diff=g,l.prev=S,l.curr=u,S=u,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let C=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(w,x)=>{if(w==="%%")return"%";C++;const R=n.formatters[x];if(typeof R=="function"){const D=v[C];w=R.call(l,D),v.splice(C,1),C--}return w}),n.formatArgs.call(l,v),(l.log||n.log).apply(l,v)}return B.namespace=p,B.useColors=n.useColors(),B.color=n.selectColor(p),B.extend=r,B.destroy=n.destroy,Object.defineProperty(B,"enabled",{enumerable:!0,configurable:!1,get:()=>k!==null?k:(M!==n.namespaces&&(M=n.namespaces,V=n.enabled(p)),V),set:v=>{k=v}}),typeof n.init=="function"&&n.init(B),B}function r(p,S){const k=n(this.namespace+(typeof S>"u"?":":S)+p);return k.log=this.log,k}function i(p){n.save(p),n.namespaces=p,n.names=[],n.skips=[];const S=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const k of S)k[0]==="-"?n.skips.push(k.slice(1)):n.names.push(k)}function a(p,S){let k=0,M=0,V=-1,B=0;for(;k<p.length;)if(M<S.length&&(S[M]===p[k]||S[M]==="*"))S[M]==="*"?(V=M,B=k,M++):(k++,M++);else if(V!==-1)M=V+1,B++,k=B;else return!1;for(;M<S.length&&S[M]==="*";)M++;return M===S.length}function o(){const p=[...n.names,...n.skips.map(S=>"-"+S)].join(",");return n.enable(""),p}function f(p){for(const S of n.skips)if(a(p,S))return!1;for(const S of n.names)if(a(p,S))return!0;return!1}function m(p){return p instanceof Error?p.stack||p.message:p}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var T0=k0;(function(e,t){var n={};t.formatArgs=i,t.save=a,t.load=o,t.useColors=r,t.storage=f(),t.destroy=(()=>{let _=!1;return()=>{_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let _;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(_=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(_[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;_.splice(1,0,p,"color: inherit");let S=0,k=0;_[0].replace(/%[a-zA-Z%]/g,M=>{M!=="%%"&&(S++,M==="%c"&&(k=S))}),_.splice(k,0,p)}t.log=console.debug||console.log||(()=>{});function a(_){try{_?t.storage.setItem("debug",_):t.storage.removeItem("debug")}catch{}}function o(){let _;try{_=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!_&&typeof process<"u"&&"env"in process&&(_=n.DEBUG),_}function f(){try{return localStorage}catch{}}e.exports=T0(t);const{formatters:m}=e.exports;m.j=function(_){try{return JSON.stringify(_)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(cp,cp.exports);var Sl=cp.exports,_w={};Object.defineProperty(_w,"__esModule",{value:!0});var Kr={},et={};Object.defineProperty(et,"__esModule",{value:!0});et.Logger=void 0;const Vs=Sl,Ws="mediasoup-client";let R0=class{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=(0,Vs.default)(`${Ws}:${t}`),this._warn=(0,Vs.default)(`${Ws}:WARN:${t}`),this._error=(0,Vs.default)(`${Ws}:ERROR:${t}`)):(this._debug=(0,Vs.default)(Ws),this._warn=(0,Vs.default)(`${Ws}:WARN`),this._error=(0,Vs.default)(`${Ws}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};et.Logger=R0;var dt={},df={exports:{}},Si=typeof Reflect=="object"?Reflect:null,fg=Si&&typeof Si.apply=="function"?Si.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Tc;Si&&typeof Si.ownKeys=="function"?Tc=Si.ownKeys:Object.getOwnPropertySymbols?Tc=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Tc=function(t){return Object.getOwnPropertyNames(t)};function I0(e){console&&console.warn&&console.warn(e)}var Sw=Number.isNaN||function(t){return t!==t};function ve(){ve.init.call(this)}df.exports=ve;df.exports.once=D0;ve.EventEmitter=ve;ve.prototype._events=void 0;ve.prototype._eventsCount=0;ve.prototype._maxListeners=void 0;var hg=10;function Cl(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ve,"defaultMaxListeners",{enumerable:!0,get:function(){return hg},set:function(e){if(typeof e!="number"||e<0||Sw(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");hg=e}});ve.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ve.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Sw(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Cw(e){return e._maxListeners===void 0?ve.defaultMaxListeners:e._maxListeners}ve.prototype.getMaxListeners=function(){return Cw(this)};ve.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var f=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw f.context=o,f}var m=a[t];if(m===void 0)return!1;if(typeof m=="function")fg(m,this,n);else for(var _=m.length,p=Tw(m,_),r=0;r<_;++r)fg(p[r],this,n);return!0};function xw(e,t,n,r){var i,a,o;if(Cl(n),a=e._events,a===void 0?(a=e._events=Object.create(null),e._eventsCount=0):(a.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),o===void 0)o=a[t]=n,++e._eventsCount;else if(typeof o=="function"?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=Cw(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=o.length,I0(f)}return e}ve.prototype.addListener=function(t,n){return xw(this,t,n,!1)};ve.prototype.on=ve.prototype.addListener;ve.prototype.prependListener=function(t,n){return xw(this,t,n,!0)};function N0(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bw(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=N0.bind(r);return i.listener=n,r.wrapFn=i,i}ve.prototype.once=function(t,n){return Cl(n),this.on(t,bw(this,t,n)),this};ve.prototype.prependOnceListener=function(t,n){return Cl(n),this.prependListener(t,bw(this,t,n)),this};ve.prototype.removeListener=function(t,n){var r,i,a,o,f;if(Cl(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(a=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){f=r[o].listener,a=o;break}if(a<0)return this;a===0?r.shift():P0(r,a),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,f||n)}return this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var a=Object.keys(r),o;for(i=0;i<a.length;++i)o=a[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function Ew(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?j0(i):Tw(i,i.length)}ve.prototype.listeners=function(t){return Ew(this,t,!0)};ve.prototype.rawListeners=function(t){return Ew(this,t,!1)};ve.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):kw.call(e,t)};ve.prototype.listenerCount=kw;function kw(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ve.prototype.eventNames=function(){return this._eventsCount>0?Tc(this._events):[]};function Tw(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function P0(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function j0(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function D0(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,a),r(o)}function a(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}Rw(e,t,a,{once:!0}),t!=="error"&&L0(e,i,{once:!0})})}function L0(e,t,n){typeof e.on=="function"&&Rw(e,"error",t,n)}function Rw(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(a){r.once&&e.removeEventListener(t,i),n(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var M0=df.exports;Object.defineProperty(dt,"__esModule",{value:!0});dt.EnhancedEventEmitter=void 0;const O0=M0,A0=et,$0=new A0.Logger("EnhancedEventEmitter");class F0 extends O0.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(t,...n){return super.emit(t,...n)}safeEmit(t,...n){try{return super.emit(t,...n)}catch(r){$0.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,r);try{super.emit("listenererror",t,r)}catch{}return!!super.listenerCount(t)}}on(t,n){return super.on(t,n),this}off(t,n){return super.off(t,n),this}addListener(t,n){return super.on(t,n),this}prependListener(t,n){return super.prependListener(t,n),this}once(t,n){return super.once(t,n),this}prependOnceListener(t,n){return super.prependOnceListener(t,n),this}removeListener(t,n){return super.off(t,n),this}removeAllListeners(t){return super.removeAllListeners(t),this}listenerCount(t){return super.listenerCount(t)}listeners(t){return super.listeners(t)}rawListeners(t){return super.rawListeners(t)}}dt.EnhancedEventEmitter=F0;var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.InvalidStateError=lt.UnsupportedError=void 0;class uf extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,uf):this.stack=new Error(t).stack}}lt.UnsupportedError=uf;class pf extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,pf):this.stack=new Error(t).stack}}lt.InvalidStateError=pf;var In={};Object.defineProperty(In,"__esModule",{value:!0});In.clone=U0;In.generateRandomNumber=z0;In.deepFreeze=Iw;function U0(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function z0(){return Math.round(Math.random()*1e7)}function Iw(e){const t=Reflect.ownKeys(e);for(const n of t){const r=e[n];(r&&typeof r=="object"||typeof r=="function")&&Iw(r)}return Object.freeze(e)}var Le={},Xe={},xl={};Object.defineProperty(xl,"__esModule",{value:!0});xl.Logger=void 0;const Hs=Sl,Gs="h264-profile-level-id";let B0=class{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=(0,Hs.default)(`${Gs}:${t}`),this._warn=(0,Hs.default)(`${Gs}:WARN:${t}`),this._error=(0,Hs.default)(`${Gs}:ERROR:${t}`)):(this._debug=(0,Hs.default)(Gs),this._warn=(0,Hs.default)(`${Gs}:WARN`),this._error=(0,Hs.default)(`${Gs}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};xl.Logger=B0;Object.defineProperty(Xe,"__esModule",{value:!0});Xe.ProfileLevelId=Xe.Level=Xe.Profile=void 0;Xe.parseProfileLevelId=Nw;Xe.profileLevelIdToString=Pw;Xe.profileToString=G0;Xe.levelToString=Q0;Xe.parseSdpProfileLevelId=ys;Xe.isSameProfile=K0;Xe.isSameProfileAndLevel=Y0;Xe.generateProfileLevelIdStringForAnswer=J0;Xe.supportedLevel=q0;const V0=xl,dn=new V0.Logger;var we;(function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"})(we||(Xe.Profile=we={}));var ne;(function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"})(ne||(Xe.Level=ne={}));class bl{constructor(t,n){I(this,"profile");I(this,"level");this.profile=t,this.level=n}}Xe.ProfileLevelId=bl;const W0=new bl(we.ConstrainedBaseline,ne.L3_1);class $n{constructor(t){I(this,"mask");I(this,"masked_value");this.mask=~gg("x",t),this.masked_value=gg("1",t)}isMatch(t){return this.masked_value===(t&this.mask)}}class Fn{constructor(t,n,r){I(this,"profile_idc");I(this,"profile_iop");I(this,"profile");this.profile_idc=t,this.profile_iop=n,this.profile=r}}const H0=[new Fn(66,new $n("x1xx0000"),we.ConstrainedBaseline),new Fn(77,new $n("1xxx0000"),we.ConstrainedBaseline),new Fn(88,new $n("11xx0000"),we.ConstrainedBaseline),new Fn(66,new $n("x0xx0000"),we.Baseline),new Fn(88,new $n("10xx0000"),we.Baseline),new Fn(77,new $n("0x0x0000"),we.Main),new Fn(100,new $n("00000000"),we.High),new Fn(100,new $n("00001100"),we.ConstrainedHigh),new Fn(244,new $n("00000000"),we.PredictiveHigh444)],mg=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:ne.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:ne.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:ne.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:ne.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:ne.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:ne.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:ne.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:ne.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:ne.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:ne.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:ne.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:ne.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:ne.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:ne.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:ne.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:ne.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:ne.L5_2}];function Nw(e){if(typeof e!="string"||e.length!==6)return;const n=parseInt(e,16);if(n===0)return;const r=n&255,i=n>>8&255,a=n>>16&255;let o;switch(r){case ne.L1_1:{o=i&16?ne.L1_b:ne.L1_1;break}case ne.L1:case ne.L1_2:case ne.L1_3:case ne.L2:case ne.L2_1:case ne.L2_2:case ne.L3:case ne.L3_1:case ne.L3_2:case ne.L4:case ne.L4_1:case ne.L4_2:case ne.L5:case ne.L5_1:case ne.L5_2:{o=r;break}default:{dn.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`);return}}for(const f of H0)if(a===f.profile_idc&&f.profile_iop.isMatch(i))return dn.debug(`parseProfileLevelId() | result [str:${e}, profile:${f.profile}, level:${o}]`),new bl(f.profile,o);dn.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${a}, profile_iop:${i}]`)}function Pw(e){if(e.level==ne.L1_b)switch(e.profile){case we.ConstrainedBaseline:return"42f00b";case we.Baseline:return"42100b";case we.Main:return"4d100b";default:{dn.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`);return}}let t;switch(e.profile){case we.ConstrainedBaseline:{t="42e0";break}case we.Baseline:{t="4200";break}case we.Main:{t="4d00";break}case we.ConstrainedHigh:{t="640c";break}case we.High:{t="6400";break}case we.PredictiveHigh444:{t="f400";break}default:{dn.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`);return}}let n=e.level.toString(16);return n.length===1&&(n=`0${n}`),`${t}${n}`}function G0(e){switch(e){case we.ConstrainedBaseline:return"ConstrainedBaseline";case we.Baseline:return"Baseline";case we.Main:return"Main";case we.ConstrainedHigh:return"ConstrainedHigh";case we.High:return"High";case we.PredictiveHigh444:return"PredictiveHigh444";default:{dn.warn(`profileToString() | unrecognized profile ${e}`);return}}}function Q0(e){switch(e){case ne.L1_b:return"1b";case ne.L1:return"1";case ne.L1_1:return"1.1";case ne.L1_2:return"1.2";case ne.L1_3:return"1.3";case ne.L2:return"2";case ne.L2_1:return"2.1";case ne.L2_2:return"2.2";case ne.L3:return"3";case ne.L3_1:return"3.1";case ne.L3_2:return"3.2";case ne.L4:return"4";case ne.L4_1:return"4.1";case ne.L4_2:return"4.2";case ne.L5:return"5";case ne.L5_1:return"5.1";case ne.L5_2:return"5.2";default:{dn.warn(`levelToString() | unrecognized level ${e}`);return}}}function ys(e={}){const t=e["profile-level-id"];return t?Nw(t):W0}function K0(e={},t={}){const n=ys(e),r=ys(t);return!!(n&&r&&n.profile===r.profile)}function Y0(e={},t={}){const n=ys(e),r=ys(t);return!!(n&&r&&n.profile===r.profile&&n.level==r.level)}function J0(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){dn.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const n=ys(e),r=ys(t);if(!n)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const i=vg(e)&&vg(t),a=n.level,o=r.level,f=Z0(a,o),m=i?a:f;return dn.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${n.profile}, level:${m}]`),Pw(new bl(n.profile,m))}function q0(e,t){for(let r=mg.length-1;r>=0;--r){const i=mg[r];if(i.max_macroblock_frame_size*256<=e&&i.max_macroblocks_per_second<=t*i.max_macroblock_frame_size)return dn.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${t}, level:${i.level}]`),i.level}dn.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${t}]`)}function gg(e,t){return+(t[0]===e)<<7|+(t[1]===e)<<6|+(t[2]===e)<<5|+(t[3]===e)<<4|+(t[4]===e)<<3|+(t[5]===e)<<2|+(t[6]===e)<<1|+(t[7]===e)<<0}function X0(e,t){return e===ne.L1_b?t!==ne.L1&&t!==ne.L1_b:t===ne.L1_b?e!==ne.L1:e<t}function Z0(e,t){return X0(e,t)?e:t}function vg(e={}){const t=e["level-asymmetry-allowed"];return t===!0||t===1||t==="1"}Object.defineProperty(Le,"__esModule",{value:!0});Le.validateAndNormalizeRtpCapabilities=sb;Le.validateAndNormalizeRtpParameters=ff;Le.validateAndNormalizeSctpStreamParameters=ib;Le.validateSctpCapabilities=ab;Le.getExtendedRtpCapabilities=ob;Le.getRecvRtpCapabilities=cb;Le.getSendingRtpParameters=lb;Le.getSendingRemoteRtpParameters=db;Le.reduceCodecs=ub;Le.generateProbatorRtpParameters=pb;Le.canSend=fb;Le.canReceive=hb;const yg=Xe,eb=In,tb="probator",nb=1234,rb=127;function sb(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)mb(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)gb(t)}function ff(e){if(typeof e!="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)vb(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)yb(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)wb(t);if(e.rtcp&&typeof e.rtcp!="object")throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),_b(e.rtcp)}function ib(e){if(typeof e!="object")throw new TypeError("params is not an object");if(typeof e.streamId!="number")throw new TypeError("missing params.streamId");let t=!1;if(typeof e.ordered=="boolean"?t=!0:e.ordered=!0,e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&typeof e.label!="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!="string")throw new TypeError("invalid params.protocol")}function ab(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!="object")throw new TypeError("missing caps.numStreams");Sb(e.numStreams)}function ob(e,t,n){const r={codecs:[],headerExtensions:[]};if(n)for(const i of e.codecs??[]){if(fi(i))continue;const a=(t.codecs??[]).find(f=>lp(f,i,{strict:!0,modify:!0}));if(!a)continue;const o={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:a.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters??{},remoteParameters:a.parameters??{},rtcpFeedback:wg(i,a)};r.codecs.push(o)}else for(const i of t.codecs??[]){if(fi(i))continue;const a=(e.codecs??[]).find(f=>lp(f,i,{strict:!0,modify:!0}));if(!a)continue;const o={kind:a.kind,mimeType:a.mimeType,clockRate:a.clockRate,channels:a.channels,localPayloadType:a.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:a.parameters??{},remoteParameters:i.parameters??{},rtcpFeedback:wg(a,i)};r.codecs.push(o)}for(const i of r.codecs){const a=e.codecs.find(f=>{var m;return fi(f)&&((m=f.parameters)==null?void 0:m.apt)===i.localPayloadType}),o=t.codecs.find(f=>{var m;return fi(f)&&((m=f.parameters)==null?void 0:m.apt)===i.remotePayloadType});a&&o&&(i.localRtxPayloadType=a.preferredPayloadType,i.remoteRtxPayloadType=o.preferredPayloadType)}for(const i of t.headerExtensions){const a=e.headerExtensions.find(f=>Cb(f,i));if(!a)continue;const o={kind:i.kind,uri:i.uri,sendId:a.preferredId,recvId:i.preferredId,encrypt:a.preferredEncrypt??!1,direction:"sendrecv"};switch(i.direction){case"sendrecv":{o.direction="sendrecv";break}case"recvonly":{o.direction="sendonly";break}case"sendonly":{o.direction="recvonly";break}case"inactive":{o.direction="inactive";break}}r.headerExtensions.push(o)}return r}function cb(e){const t={codecs:[],headerExtensions:[]};for(const n of e.codecs){const r={kind:n.kind,mimeType:n.mimeType,preferredPayloadType:n.remotePayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),!n.remoteRtxPayloadType)continue;const i={kind:n.kind,mimeType:`${n.kind}/rtx`,preferredPayloadType:n.remoteRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const n of e.headerExtensions){if(n.direction!=="sendrecv"&&n.direction!=="recvonly")continue;const r={kind:n.kind,uri:n.uri,preferredId:n.recvId,preferredEncrypt:n.encrypt??!1,direction:n.direction};t.headerExtensions.push(r)}return t}function lb(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(a)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}return n}function db(e,t){const n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(n.codecs.push(i),r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};n.codecs.push(a)}}for(const r of t.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};n.headerExtensions.push(i)}if(n.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(n.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(const r of n.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return n}function ub(e,t){const n=[];if(!t)n.push(e[0]),fi(e[1])&&n.push(e[1]);else{for(let r=0;r<e.length;++r)if(lp(e[r],t,{strict:!0})){n.push(e[r]),fi(e[r+1])&&n.push(e[r+1]);break}if(n.length===0)throw new TypeError("no matching codec found")}return n}function pb(e){e=eb.clone(e),ff(e);const t={mid:tb,codecs:[],headerExtensions:[],encodings:[{ssrc:nb}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=rb,t.headerExtensions=e.headerExtensions,t}function fb(e,t){return(t.codecs??[]).some(n=>n.kind===e)}function hb(e,t){if(ff(e),e.codecs.length===0)return!1;const n=e.codecs[0];return(t.codecs??[]).some(r=>r.preferredPayloadType===n.payloadType)}function mb(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(e.kind=n[1].toLowerCase(),typeof e.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");e.kind==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const r of Object.keys(e.parameters)){let i=e.parameters[r];if(i===void 0&&(e.parameters[r]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${i}]`);if(r==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const r of e.rtcpFeedback)jw(r)}function jw(e){if(typeof e!="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!="string")throw new TypeError("missing fb.type");(!e.parameter||typeof e.parameter!="string")&&(e.parameter="")}function gb(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&typeof e.direction!="string")throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function vb(e){const t=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const n=t.exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");if(typeof e.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");n[1].toLowerCase()==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const i of Object.keys(e.parameters)){let a=e.parameters[i];if(a===void 0&&(e.parameters[i]="",a=""),typeof a!="string"&&typeof a!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${a}]`);if(i==="apt"&&typeof a!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const i of e.rtcpFeedback)jw(i)}function yb(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.id!="number")throw new TypeError("missing ext.id");if(e.encrypt&&typeof e.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const t of Object.keys(e.parameters)){let n=e.parameters[t];if(n===void 0&&(e.parameters[t]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError("invalid header extension parameter")}}function wb(e){if(typeof e!="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!="object")throw new TypeError("invalid encoding.rtx");if(e.rtx&&typeof e.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||typeof e.dtx!="boolean")&&(e.dtx=!1),e.scalabilityMode&&typeof e.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function _b(e){if(typeof e!="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!="string")throw new TypeError("invalid rtcp.cname");(!e.reducedSize||typeof e.reducedSize!="boolean")&&(e.reducedSize=!0)}function Sb(e){if(typeof e!="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!="number")throw new TypeError("missing numStreams.MIS")}function fi(e){return e?/.+\/rtx$/i.test(e.mimeType):!1}function lp(e,t,{strict:n=!1,modify:r=!1}={}){const i=e.mimeType.toLowerCase(),a=t.mimeType.toLowerCase();if(i!==a||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(i){case"video/h264":{if(n){const o=e.parameters["packetization-mode"]??0,f=t.parameters["packetization-mode"]??0;if(o!==f||!yg.isSameProfile(e.parameters,t.parameters))return!1;let m;try{m=yg.generateProfileLevelIdStringForAnswer(e.parameters,t.parameters)}catch{return!1}r&&(m?(e.parameters["profile-level-id"]=m,t.parameters["profile-level-id"]=m):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break}case"video/vp9":{if(n){const o=e.parameters["profile-id"]??0,f=t.parameters["profile-id"]??0;if(o!==f)return!1}break}}return!0}function Cb(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function wg(e,t){const n=[];for(const r of e.rtcpFeedback??[]){const i=(t.rtcpFeedback??[]).find(a=>a.type===r.type&&(a.parameter===r.parameter||!a.parameter&&!r.parameter));i&&n.push(i)}return n}var El={},Dw={},kl={},Tl={};Object.defineProperty(Tl,"__esModule",{value:!0});Tl.Logger=void 0;const Qs=Sl,Ks="awaitqueue";class xb{constructor(t){I(this,"_debug");I(this,"_warn");I(this,"_error");t?(this._debug=Qs(`${Ks}:${t}`),this._warn=Qs(`${Ks}:WARN:${t}`),this._error=Qs(`${Ks}:ERROR:${t}`)):(this._debug=Qs(Ks),this._warn=Qs(`${Ks}:WARN`),this._error=Qs(`${Ks}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Tl.Logger=xb;var ws={};Object.defineProperty(ws,"__esModule",{value:!0});ws.AwaitQueueRemovedTaskError=ws.AwaitQueueStoppedError=void 0;class hf extends Error{constructor(t){super(t??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,hf)}}ws.AwaitQueueStoppedError=hf;class mf extends Error{constructor(t){super(t??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,mf)}}ws.AwaitQueueRemovedTaskError=mf;Object.defineProperty(kl,"__esModule",{value:!0});kl.AwaitQueue=void 0;const bb=Tl,cu=ws,Un=new bb.Logger("AwaitQueue");class Eb{constructor(){I(this,"pendingTasks",new Map);I(this,"nextTaskId",0);Un.debug("constructor()")}get size(){return this.pendingTasks.size}async push(t,n,r){if(n=n??t.name,Un.debug(`push() [name:${n}, options:%o]`,r),typeof t!="function")throw new TypeError("given task is not a function");if(n)try{Object.defineProperty(t,"name",{value:n})}catch{}return new Promise((i,a)=>{if(n&&(r!=null&&r.removeOngoingTasksWithSameName))for(const f of this.pendingTasks.values())f.name===n&&f.reject(new cu.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});const o={id:this.nextTaskId++,task:t,name:n,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:f=>{if(o.completed)return;o.completed=!0,this.pendingTasks.delete(o.id),Un.debug(`resolving task [name:${o.name}]`),i(f);const[m]=this.pendingTasks.values();m&&!m.executedAt&&this.execute(m)},reject:(f,{canExecuteNextTask:m})=>{if(!o.completed&&(o.completed=!0,this.pendingTasks.delete(o.id),Un.debug(`rejecting task [name:${o.name}]: %s`,String(f)),a(f),m)){const[_]=this.pendingTasks.values();_&&!_.executedAt&&this.execute(_)}}};this.pendingTasks.set(o.id,o),this.pendingTasks.size===1&&this.execute(o)})}stop(){Un.debug("stop()");for(const t of this.pendingTasks.values())Un.debug(`stop() | stopping task [name:${t.name}]`),t.reject(new cu.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(t){Un.debug(`remove() [taskIdx:${t}]`);const n=Array.from(this.pendingTasks.values())[t];if(!n){Un.debug(`stop() | no task with given idx [taskIdx:${t}]`);return}n.reject(new cu.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){const t=Date.now();let n=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:n++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:t-r.enqueuedAt,executionTime:r.executedAt?t-r.executedAt:0}))}async execute(t){if(Un.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{const n=await t.task();t.resolve(n)}catch(n){t.reject(n,{canExecuteNextTask:!0})}}}kl.AwaitQueue=Eb;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var t=kl;Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return t.AwaitQueue}});var n=ws;Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return n.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return n.AwaitQueueRemovedTaskError}})})(Dw);var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0});Rl.Producer=void 0;const kb=et,_g=dt,Ys=lt,_n=new kb.Logger("Producer");class Tb extends _g.EnhancedEventEmitter{constructor({id:n,localId:r,rtpSender:i,track:a,rtpParameters:o,stopTracks:f,disableTrackOnPause:m,zeroRtpOnPause:_,appData:p}){super();I(this,"_id");I(this,"_localId");I(this,"_closed",!1);I(this,"_rtpSender");I(this,"_track");I(this,"_kind");I(this,"_rtpParameters");I(this,"_paused");I(this,"_maxSpatialLayer");I(this,"_stopTracks");I(this,"_disableTrackOnPause");I(this,"_zeroRtpOnPause");I(this,"_appData");I(this,"_observer",new _g.EnhancedEventEmitter);_n.debug("constructor()"),this._id=n,this._localId=r,this._rtpSender=i,this._track=a,this._kind=a.kind,this._rtpParameters=o,this._paused=m?!a.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=f,this._disableTrackOnPause=m,this._zeroRtpOnPause=_,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(_n.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(_n.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Ys.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(_n.debug("pause()"),this._closed){_n.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@pause",n,r)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(_n.debug("resume()"),this._closed){_n.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((n,r)=>{this.safeEmit("@resume",n,r)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:n}){if(_n.debug("replaceTrack() [track:%o]",n),this._closed){if(n&&this._stopTracks)try{n.stop()}catch{}throw new Ys.InvalidStateError("closed")}else if((n==null?void 0:n.readyState)==="ended")throw new Ys.InvalidStateError("track ended");if(n===this._track){_n.debug("replaceTrack() | same track, ignored");return}await new Promise((r,i)=>{this.safeEmit("@replacetrack",n,r,i)}),this.destroyTrack(),this._track=n,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(n){if(this._closed)throw new Ys.InvalidStateError("closed");if(this._kind!=="video")throw new Ys.UnsupportedError("not a video Producer");if(typeof n!="number")throw new TypeError("invalid spatialLayer");n!==this._maxSpatialLayer&&(await new Promise((r,i)=>{this.safeEmit("@setmaxspatiallayer",n,r,i)}).catch(()=>{}),this._maxSpatialLayer=n)}async setRtpEncodingParameters(n){if(this._closed)throw new Ys.InvalidStateError("closed");if(typeof n!="object")throw new TypeError("invalid params");await new Promise((r,i)=>{this.safeEmit("@setrtpencodingparameters",n,r,i)})}onTrackEnded(){_n.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}Rl.Producer=Tb;var Il={};Object.defineProperty(Il,"__esModule",{value:!0});Il.Consumer=void 0;const Rb=et,Sg=dt,Ib=lt,Sn=new Rb.Logger("Consumer");class Nb extends Sg.EnhancedEventEmitter{constructor({id:n,localId:r,producerId:i,rtpReceiver:a,track:o,rtpParameters:f,appData:m}){super();I(this,"_id");I(this,"_localId");I(this,"_producerId");I(this,"_closed",!1);I(this,"_rtpReceiver");I(this,"_track");I(this,"_rtpParameters");I(this,"_paused");I(this,"_appData");I(this,"_observer",new Sg.EnhancedEventEmitter);Sn.debug("constructor()"),this._id=n,this._localId=r,this._producerId=i,this._rtpReceiver=a,this._track=o,this._rtpParameters=f,this._paused=!o.enabled,this._appData=m??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Sn.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Sn.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Ib.InvalidStateError("closed");return new Promise((n,r)=>{this.safeEmit("@getstats",n,r)})}pause(){if(Sn.debug("pause()"),this._closed){Sn.error("pause() | Consumer closed");return}if(this._paused){Sn.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(Sn.debug("resume()"),this._closed){Sn.error("resume() | Consumer closed");return}if(!this._paused){Sn.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){Sn.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}Il.Consumer=Nb;var Nl={};Object.defineProperty(Nl,"__esModule",{value:!0});Nl.DataProducer=void 0;const Pb=et,Cg=dt,jb=lt,zn=new Pb.Logger("DataProducer");class Db extends Cg.EnhancedEventEmitter{constructor({id:n,dataChannel:r,sctpStreamParameters:i,appData:a}){super();I(this,"_id");I(this,"_dataChannel");I(this,"_closed",!1);I(this,"_sctpStreamParameters");I(this,"_appData");I(this,"_observer",new Cg.EnhancedEventEmitter);zn.debug("constructor()"),this._id=n,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=a??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._dataChannel.bufferedAmountLowThreshold=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(zn.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(zn.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(n){if(zn.debug("send()"),this._closed)throw new jb.InvalidStateError("closed");this._dataChannel.send(n)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(zn.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,a;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?zn.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(a=n.error)==null?void 0:a.sctpCauseCode,n.error.message):zn.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(zn.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||zn.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}Nl.DataProducer=Db;var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.DataConsumer=void 0;const Lb=et,xg=dt,Yr=new Lb.Logger("DataConsumer");class Mb extends xg.EnhancedEventEmitter{constructor({id:n,dataProducerId:r,dataChannel:i,sctpStreamParameters:a,appData:o}){super();I(this,"_id");I(this,"_dataProducerId");I(this,"_dataChannel");I(this,"_closed",!1);I(this,"_sctpStreamParameters");I(this,"_appData");I(this,"_observer",new xg.EnhancedEventEmitter);Yr.debug("constructor()"),this._id=n,this._dataProducerId=r,this._dataChannel=i,this._sctpStreamParameters=a,this._appData=o??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(n){this._dataChannel.binaryType=n}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){this._closed||(Yr.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(Yr.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Yr.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",n=>{var i,a;if(this._closed)return;const r=n.error??new Error("unknown DataChannel error");((i=n.error)==null?void 0:i.errorDetail)==="sctp-failure"?Yr.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(a=n.error)==null?void 0:a.sctpCauseCode,n.error.message):Yr.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Yr.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",n=>{this._closed||this.safeEmit("message",n.data)})}}Pl.DataConsumer=Mb;Object.defineProperty(El,"__esModule",{value:!0});El.Transport=void 0;const Ob=Dw,Ab=et,bg=dt,ze=lt,lu=In,ha=Le,$b=Rl,Fb=Il,Ub=Nl,zb=Pl,Me=new Ab.Logger("Transport");class Bb{constructor(t){I(this,"consumerOptions");I(this,"promise");I(this,"resolve");I(this,"reject");this.consumerOptions=t,this.promise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}}class Vb extends bg.EnhancedEventEmitter{constructor({direction:n,id:r,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:f,iceServers:m,iceTransportPolicy:_,additionalSettings:p,appData:S,handlerFactory:k,getSendExtendedRtpCapabilities:M,recvRtpCapabilities:V,canProduceByKind:B}){super();I(this,"_id");I(this,"_closed",!1);I(this,"_direction");I(this,"_getSendExtendedRtpCapabilities");I(this,"_recvRtpCapabilities");I(this,"_canProduceByKind");I(this,"_maxSctpMessageSize");I(this,"_handler");I(this,"_iceGatheringState","new");I(this,"_connectionState","new");I(this,"_appData");I(this,"_producers",new Map);I(this,"_consumers",new Map);I(this,"_dataProducers",new Map);I(this,"_dataConsumers",new Map);I(this,"_probatorConsumerCreated",!1);I(this,"_awaitQueue",new Ob.AwaitQueue);I(this,"_pendingConsumerTasks",[]);I(this,"_consumerCreationInProgress",!1);I(this,"_pendingPauseConsumers",new Map);I(this,"_consumerPauseInProgress",!1);I(this,"_pendingResumeConsumers",new Map);I(this,"_consumerResumeInProgress",!1);I(this,"_pendingCloseConsumers",new Map);I(this,"_consumerCloseInProgress",!1);I(this,"_observer",new bg.EnhancedEventEmitter);Me.debug("constructor() [id:%s, direction:%s]",r,n),this._id=r,this._direction=n,this._getSendExtendedRtpCapabilities=M,this._recvRtpCapabilities=V,this._canProduceByKind=B,this._maxSctpMessageSize=f?f.maxMessageSize:null;const v=lu.clone(p)??{};delete v.iceServers,delete v.iceTransportPolicy,delete v.bundlePolicy,delete v.rtcpMuxPolicy,this._handler=k.factory({direction:n,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:f,iceServers:m,iceTransportPolicy:_,additionalSettings:v,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=S??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){if(!this._closed){Me.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const n of this._producers.values())n.transportClosed();this._producers.clear();for(const n of this._consumers.values())n.transportClosed();this._consumers.clear();for(const n of this._dataProducers.values())n.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new ze.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:n}){if(Me.debug("restartIce()"),this._closed)throw new ze.InvalidStateError("closed");if(!n)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(n),"transport.restartIce()")}async updateIceServers({iceServers:n}={}){if(Me.debug("updateIceServers()"),this._closed)throw new ze.InvalidStateError("closed");if(!Array.isArray(n))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(n),"transport.updateIceServers()")}async produce({track:n,streamId:r,encodings:i,codecOptions:a,headerExtensionOptions:o,codec:f,stopTracks:m=!0,disableTrackOnPause:_=!0,zeroRtpOnPause:p=!1,onRtpSender:S,appData:k={}}={}){if(Me.debug("produce() [track:%o]",n),this._closed)throw new ze.InvalidStateError("closed");if(n){if(this._direction!=="send")throw new ze.UnsupportedError("not a sending Transport");if(this._canProduceByKind[n.kind]){if(n.readyState==="ended")throw new ze.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(k&&typeof k!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError(`cannot produce ${n.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let M;if(i&&!Array.isArray(i))throw TypeError("encodings must be an array");(i==null?void 0:i.length)===0?M=void 0:i&&(M=i.map(l=>{const u={active:!0};return l.active===!1&&(u.active=!1),typeof l.dtx=="boolean"&&(u.dtx=l.dtx),typeof l.scalabilityMode=="string"&&(u.scalabilityMode=l.scalabilityMode),typeof l.scaleResolutionDownBy=="number"&&(u.scaleResolutionDownBy=l.scaleResolutionDownBy),typeof l.maxBitrate=="number"&&(u.maxBitrate=l.maxBitrate),typeof l.maxFramerate=="number"&&(u.maxFramerate=l.maxFramerate),typeof l.adaptivePtime=="boolean"&&(u.adaptivePtime=l.adaptivePtime),typeof l.priority=="string"&&(u.priority=l.priority),typeof l.networkPriority=="string"&&(u.networkPriority=l.networkPriority),u}));const{localId:V,rtpParameters:B,rtpSender:v}=await this._handler.send({track:n,streamId:r,encodings:M,codecOptions:a,headerExtensionOptions:o,codec:f,onRtpSender:S});try{ha.validateAndNormalizeRtpParameters(B);const{id:l}=await new Promise((g,C)=>{this.safeEmit("produce",{kind:n.kind,rtpParameters:B,appData:k},g,C)}),u=new $b.Producer({id:l,localId:V,rtpSender:v,track:n,rtpParameters:B,stopTracks:m,disableTrackOnPause:_,zeroRtpOnPause:p,appData:k});return this._producers.set(u.id,u),this.handleProducer(u),this._observer.safeEmit("newproducer",u),u}catch(l){throw this._handler.stopSending(V).catch(()=>{}),l}},"transport.produce()").catch(M=>{if(m)try{n.stop()}catch{}throw M})}async consume({id:n,producerId:r,kind:i,rtpParameters:a,streamId:o,onRtpReceiver:f,appData:m={}}){if(Me.debug("consume()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="recv")throw new ze.UnsupportedError("not a receiving Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind '${i}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(m&&typeof m!="object")throw new TypeError("if given, appData must be an object");const _=lu.clone(a);if(!ha.canReceive(_,this._recvRtpCapabilities))throw new ze.UnsupportedError("cannot consume this Producer");const S=new Bb({id:n,producerId:r,kind:i,rtpParameters:_,streamId:o,onRtpReceiver:f,appData:m});return this._pendingConsumerTasks.push(S),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),S.promise}async produceData({ordered:n=!0,maxPacketLifeTime:r,maxRetransmits:i,label:a="",protocol:o="",appData:f={}}={}){if(Me.debug("produceData()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="send")throw new ze.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(f&&typeof f!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError("SCTP not enabled by remote Transport");return(r||i)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:m,sctpStreamParameters:_}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o});ha.validateAndNormalizeSctpStreamParameters(_);const{id:p}=await new Promise((k,M)=>{this.safeEmit("producedata",{sctpStreamParameters:_,label:a,protocol:o,appData:f},k,M)}),S=new Ub.DataProducer({id:p,dataChannel:m,sctpStreamParameters:_,appData:f});return this._dataProducers.set(S.id,S),this.handleDataProducer(S),this._observer.safeEmit("newdataproducer",S),S},"transport.produceData()")}async consumeData({id:n,dataProducerId:r,sctpStreamParameters:i,label:a="",protocol:o="",appData:f={}}){if(Me.debug("consumeData()"),this._closed)throw new ze.InvalidStateError("closed");if(this._direction!=="recv")throw new ze.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(f&&typeof f!="object")throw new TypeError("if given, appData must be an object")}else throw new ze.UnsupportedError("SCTP not enabled by remote Transport");const m=lu.clone(i);return ha.validateAndNormalizeSctpStreamParameters(m),this._awaitQueue.push(async()=>{const{dataChannel:_}=await this._handler.receiveDataChannel({sctpStreamParameters:m,label:a,protocol:o}),p=new zb.DataConsumer({id:n,dataProducerId:r,dataChannel:_,sctpStreamParameters:m,appData:f});return this._dataConsumers.set(p.id,p),this.handleDataConsumer(p),this._observer.safeEmit("newdataconsumer",p),p},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){Me.debug("createPendingConsumers() | there is no Consumer to be created");return}const n=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r;const i=[];for(const a of n){const{id:o,kind:f,rtpParameters:m,streamId:_,onRtpReceiver:p}=a.consumerOptions;i.push({trackId:o,kind:f,rtpParameters:m,streamId:_,onRtpReceiver:p})}try{const a=await this._handler.receive(i);for(let o=0;o<a.length;++o){const f=n[o],m=a[o],{id:_,producerId:p,kind:S,rtpParameters:k,appData:M}=f.consumerOptions,{localId:V,rtpReceiver:B,track:v}=m,l=new Fb.Consumer({id:_,localId:V,producerId:p,rtpReceiver:B,track:v,rtpParameters:k,appData:M});this._consumers.set(l.id,l),this.handleConsumer(l),!this._probatorConsumerCreated&&!r&&S==="video"&&(r=l),this._observer.safeEmit("newconsumer",l),f.resolve(l)}}catch(a){for(const o of n)o.reject(a)}if(r)try{const a=ha.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:a}]),Me.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(a){Me.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",a)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){Me.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const n=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.pauseReceiving(r)}catch(r){Me.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){Me.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const n=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=n.map(i=>i.localId);await this._handler.resumeReceiving(r)}catch(r){Me.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){Me.debug("closePendingConsumers() | there is no Consumer to be closed");return}const n=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(n.map(r=>r.localId))}catch(r){Me.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const n=this._handler;n.on("@connect",({dtlsParameters:r},i,a)=>{if(this._closed){a(new ze.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:r},i,a)}),n.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(Me.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),n.on("@icecandidateerror",r=>{Me.warn(`ICE candidate error [url:${r.url}, localAddress:${r.address}, localPort:${r.port}]: ${r.errorCode} "${r.errorText}"`),this.safeEmit("icecandidateerror",r)}),n.on("@connectionstatechange",r=>{r!==this._connectionState&&(Me.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(n.localId),"producer @close event").catch(r=>Me.warn("producer.close() failed:%o",r))}),n.on("@pause",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(n.localId),"producer @pause event").then(r).catch(i)}),n.on("@resume",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(n.localId),"producer @resume event").then(r).catch(i)}),n.on("@replacetrack",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(n.localId,r),"producer @replacetrack event").then(i).catch(a)}),n.on("@setmaxspatiallayer",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(n.localId,r),"producer @setmaxspatiallayer event").then(i).catch(a)}),n.on("@setrtpencodingparameters",(r,i,a)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(n.localId,r),"producer @setrtpencodingparameters event").then(i).catch(a)}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new ze.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(r).catch(i)})}handleConsumer(n){n.on("@close",()=>{this._consumers.delete(n.id),this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.delete(n.id),!this._closed&&(this._pendingCloseConsumers.set(n.id,n),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),n.on("@pause",()=>{this._pendingResumeConsumers.has(n.id)&&this._pendingResumeConsumers.delete(n.id),this._pendingPauseConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),n.on("@resume",()=>{this._pendingPauseConsumers.has(n.id)&&this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.set(n.id,n),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),n.on("@getstats",(r,i)=>{if(this._closed)return i(new ze.InvalidStateError("closed"));this._handler.getReceiverStats(n.localId).then(r).catch(i)})}handleDataProducer(n){n.on("@close",()=>{this._dataProducers.delete(n.id)})}handleDataConsumer(n){n.on("@close",()=>{this._dataConsumers.delete(n.id)})}}El.Transport=Vb;var ma={},tt={},Lw={},Mw={exports:{}},Eg=Mw.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Eg).forEach(function(e){var t=Eg[e];t.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var gf=Mw.exports;(function(e){var t=function(f){return String(Number(f))===f?Number(f):f},n=function(f,m,_,p){if(p&&!_)m[p]=t(f[1]);else for(var S=0;S<_.length;S+=1)f[S+1]!=null&&(m[_[S]]=t(f[S+1]))},r=function(f,m,_){var p=f.name&&f.names;f.push&&!m[f.push]?m[f.push]=[]:p&&!m[f.name]&&(m[f.name]={});var S=f.push?{}:p?m[f.name]:m;n(_.match(f.reg),S,f.names,f.name),f.push&&m[f.push].push(S)},i=gf,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(f){var m={},_=[],p=m;return f.split(/(\r\n|\r|\n)/).filter(a).forEach(function(S){var k=S[0],M=S.slice(2);k==="m"&&(_.push({rtp:[],fmtp:[]}),p=_[_.length-1]);for(var V=0;V<(i[k]||[]).length;V+=1){var B=i[k][V];if(B.reg.test(M))return r(B,p,M)}}),m.media=_,m};var o=function(f,m){var _=m.split(/=(.+)/,2);return _.length===2?f[_[0]]=t(_[1]):_.length===1&&m.length>1&&(f[_[0]]=void 0),f};e.parseParams=function(f){return f.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(f){return f.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(f){for(var m=[],_=f.split(" ").map(t),p=0;p<_.length;p+=3)m.push({component:_[p],ip:_[p+1],port:_[p+2]});return m},e.parseImageAttributes=function(f){return f.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(f){return f.split(";").map(function(m){return m.split(",").map(function(_){var p,S=!1;return _[0]!=="~"?p=t(_):(p=t(_.substring(1,_.length)),S=!0),{scid:p,paused:S}})})}})(Lw);var du=gf,Wb=/%[sdv%]/g,Hb=function(e){var t=1,n=arguments,r=n.length;return e.replace(Wb,function(i){if(t>=r)return i;var a=n[t];switch(t+=1,i){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})},ga=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var a=0;a<t.names.length;a+=1){var o=t.names[a];t.name?i.push(n[t.name][o]):i.push(n[t.names[a]])}else i.push(n[t.name]);return Hb.apply(null,i)},Gb=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Qb=["i","c","b","a"],Kb=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var n=t.outerOrder||Gb,r=t.innerOrder||Qb,i=[];return n.forEach(function(a){du[a].forEach(function(o){o.name in e&&e[o.name]!=null?i.push(ga(a,o,e)):o.push in e&&e[o.push]!=null&&e[o.push].forEach(function(f){i.push(ga(a,o,f))})})}),e.media.forEach(function(a){i.push(ga("m",du.m[0],a)),r.forEach(function(o){du[o].forEach(function(f){f.name in a&&a[f.name]!=null?i.push(ga(o,f,a)):f.push in a&&a[f.push]!=null&&a[f.push].forEach(function(m){i.push(ga(o,f,m))})})})}),i.join(`\r
`)+`\r
`},Cs=Lw,Yb=Kb,Jb=gf;tt.grammar=Jb;tt.write=Yb;tt.parse=Cs.parse;tt.parseParams=Cs.parseParams;tt.parseFmtpConfig=Cs.parseFmtpConfig;tt.parsePayloads=Cs.parsePayloads;tt.parseRemoteCandidates=Cs.parseRemoteCandidates;tt.parseImageAttributes=Cs.parseImageAttributes;tt.parseSimulcastStreamList=Cs.parseSimulcastStreamList;var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.parse=Xb;const qb=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function Xb(e){const t=qb.exec(e??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}var va={},br={};Object.defineProperty(br,"__esModule",{value:!0});br.OfferMediaSection=br.AnswerMediaSection=br.MediaSection=void 0;const Zb=tt,kg=In;class vf{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r}){I(this,"_mediaObject");if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},t&&this.setIceParameters(t),n){this._mediaObject.candidates=[];for(const i of n){const a={foundation:i.foundation,component:1,ip:i.address??i.ip,port:i.port,priority:i.priority,transport:i.protocol,type:i.type};i.tcpType&&(a.tcptype=i.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(t){this._mediaObject.iceUfrag=t.usernameFragment,this._mediaObject.icePwd=t.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause()}close(){this.disable(),this._mediaObject.port=0,delete this._mediaObject.candidates,delete this._mediaObject.endOfCandidates,delete this._mediaObject.iceUfrag,delete this._mediaObject.icePwd,delete this._mediaObject.iceOptions,this._mediaObject.rtp=[],this._mediaObject.fmtp=[],delete this._mediaObject.rtcp,delete this._mediaObject.rtcpFb,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}br.MediaSection=vf;class eE extends vf{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:a,offerMediaObject:o,offerRtpParameters:f,answerRtpParameters:m,codecOptions:_}){switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const p of m.codecs){const S={payload:p.payloadType,codec:Ow(p),rate:p.clockRate};p.channels>1&&(S.encoding=p.channels),this._mediaObject.rtp.push(S);const k=kg.clone(p.parameters)??{};let M=kg.clone(p.rtcpFeedback)??[];if(_){const{opusStereo:B,opusFec:v,opusDtx:l,opusMaxPlaybackRate:u,opusMaxAverageBitrate:g,opusPtime:C,opusNack:N,videoGoogleStartBitrate:w,videoGoogleMaxBitrate:x,videoGoogleMinBitrate:R}=_,D=f.codecs.find(P=>P.payloadType===p.payloadType);switch(p.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{B!==void 0&&(D.parameters["sprop-stereo"]=B?1:0,k.stereo=B?1:0),v!==void 0&&(D.parameters.useinbandfec=v?1:0,k.useinbandfec=v?1:0),l!==void 0&&(D.parameters.usedtx=l?1:0,k.usedtx=l?1:0),u!==void 0&&(k.maxplaybackrate=u),g!==void 0&&(k.maxaveragebitrate=g),C!==void 0&&(D.parameters.ptime=C,k.ptime=C),N||(D.rtcpFeedback=D.rtcpFeedback.filter(P=>P.type!=="nack"||P.parameter),M=M.filter(P=>P.type!=="nack"||P.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{w!==void 0&&(k["x-google-start-bitrate"]=w),x!==void 0&&(k["x-google-max-bitrate"]=x),R!==void 0&&(k["x-google-min-bitrate"]=R);break}}}const V={payload:p.payloadType,config:""};for(const B of Object.keys(k))V.config&&(V.config+=";"),V.config+=`${B}=${k[B]}`;V.config&&this._mediaObject.fmtp.push(V);for(const B of M)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:B.type,subtype:B.parameter})}this._mediaObject.payloads=m.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of m.headerExtensions)(o.ext??[]).some(k=>k.uri===p.uri)&&this._mediaObject.ext.push({uri:p.uri,value:p.id});if(o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const p of o.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const p of o.rids??[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=String(i.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(t){switch(t){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(t){var a,o;if(!((a=this._mediaObject.simulcast)!=null&&a.list1))return;const n={};for(const f of t)f.rid&&(n[f.rid]=f);const r=this._mediaObject.simulcast.list1,i=Zb.parseSimulcastStreamList(r);for(const f of i)for(const m of f)m.paused=!((o=n[m.scid])!=null&&o.active);this._mediaObject.simulcast.list1=i.map(f=>f.map(m=>`${m.paused?"~":""}${m.scid}`).join(",")).join(";")}}br.AnswerMediaSection=eE;class tE extends vf{constructor({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:i,plainRtpParameters:a,mid:o,kind:f,offerRtpParameters:m,streamId:_,trackId:p}){var S;switch(super({iceParameters:t,iceCandidates:n,dtlsParameters:r}),this._mediaObject.mid=String(o),this._mediaObject.type=f,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",f){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:_,appdata:p}];for(const B of m.codecs){const v={payload:B.payloadType,codec:Ow(B),rate:B.clockRate};B.channels>1&&(v.encoding=B.channels),this._mediaObject.rtp.push(v);const l={payload:B.payloadType,config:""};for(const u of Object.keys(B.parameters??{}))l.config&&(l.config+=";"),l.config+=`${u}=${B.parameters[u]}`;l.config&&this._mediaObject.fmtp.push(l);for(const u of B.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:B.payloadType,type:u.type,subtype:u.parameter})}this._mediaObject.payloads=m.codecs.map(B=>B.payloadType).join(" "),this._mediaObject.ext=[];for(const B of m.headerExtensions)this._mediaObject.ext.push({uri:B.uri,value:B.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const k=m.encodings[0],M=k.ssrc,V=(S=k.rtx)==null?void 0:S.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],M&&m.rtcp.cname&&this._mediaObject.ssrcs.push({id:M,attribute:"cname",value:m.rtcp.cname}),V&&(m.rtcp.cname&&this._mediaObject.ssrcs.push({id:V,attribute:"cname",value:m.rtcp.cname}),M&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${M} ${V}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize;break}}}setDtlsRole(t){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}br.OfferMediaSection=tE;function Ow(e){const n=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!n)throw new TypeError("invalid codec.mimeType");return n[2]}var Tg;function oo(){if(Tg)return va;Tg=1,Object.defineProperty(va,"__esModule",{value:!0}),va.RemoteSdp=void 0;const e=tt,t=et,n=br,r=zw(),i=["av1","h264"],a=new t.Logger("RemoteSdp");let o=class{constructor({iceParameters:m,iceCandidates:_,dtlsParameters:p,sctpParameters:S,plainRtpParameters:k}){I(this,"_iceParameters");I(this,"_iceCandidates");I(this,"_dtlsParameters");I(this,"_sctpParameters");I(this,"_plainRtpParameters");I(this,"_mediaSections",[]);I(this,"_midToIndex",new Map);I(this,"_firstMid");I(this,"_sdpObject");if(this._iceParameters=m,this._iceCandidates=_,this._dtlsParameters=p,this._sctpParameters=S,this._plainRtpParameters=k,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:`mediasoup-client-v${r.version}`},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",m!=null&&m.iceLite&&(this._sdpObject.icelite="ice-lite"),p){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const M=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:p.fingerprints[M-1].algorithm,hash:p.fingerprints[M-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}k&&(this._sdpObject.origin.address=k.ip,this._sdpObject.origin.ipVer=k.ipVersion)}updateIceParameters(m){a.debug("updateIceParameters() [iceParameters:%o]",m),this._iceParameters=m,this._sdpObject.icelite=m.iceLite?"ice-lite":void 0;for(const _ of this._mediaSections)_.setIceParameters(m)}updateDtlsRole(m){a.debug("updateDtlsRole() [role:%s]",m),this._dtlsParameters.role=m;for(const _ of this._mediaSections)_.setDtlsRole(m)}setSessionExtmapAllowMixed(){a.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let m=0;m<this._mediaSections.length;++m){const _=this._mediaSections[m];if(_.closed)return{idx:m,reuseMid:_.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:m,reuseMid:_,offerRtpParameters:p,answerRtpParameters:S,codecOptions:k}){var v;const M=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:m,offerRtpParameters:p,answerRtpParameters:S,codecOptions:k}),V=M.getObject();V.rtp.find(l=>i.includes(l.codec.toLowerCase()))||(V.ext=(v=V.ext)==null?void 0:v.filter(l=>l.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),_?this.replaceMediaSection(M,_):this._midToIndex.has(M.mid)?this.replaceMediaSection(M):this.addMediaSection(M)}receive({mid:m,kind:_,offerRtpParameters:p,streamId:S,trackId:k}){this.setSessionExtmapAllowMixed();const M=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:m,kind:_,offerRtpParameters:p,streamId:S,trackId:k}),V=this._mediaSections.find(B=>B.closed);V?this.replaceMediaSection(M,V.mid):this.addMediaSection(M)}pauseMediaSection(m){this.findMediaSection(m).pause()}resumeSendingMediaSection(m){this.findMediaSection(m).resume()}resumeReceivingMediaSection(m){this.findMediaSection(m).resume()}disableMediaSection(m){this.findMediaSection(m).disable()}closeMediaSection(m){const _=this.findMediaSection(m);return m===this._firstMid?(a.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",m),this.disableMediaSection(m),!1):(_.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(m,_){const p=this.findMediaSection(m);p.muxSimulcastStreams(_),this.replaceMediaSection(p)}sendSctpAssociation({offerMediaObject:m}){const _=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:m});this.addMediaSection(_)}receiveSctpAssociation(){const m=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(m)}getSdp(){return this._sdpObject.origin.sessionVersion++,e.write(this._sdpObject)}addMediaSection(m){this._firstMid||(this._firstMid=m.mid),this._mediaSections.push(m),this._midToIndex.set(m.mid,this._mediaSections.length-1),this._sdpObject.media.push(m.getObject()),this.regenerateBundleMids()}replaceMediaSection(m,_){if(typeof _=="string"){const p=this._midToIndex.get(_);if(p===void 0)throw new Error(`no media section found for reuseMid '${_}'`);const S=this._mediaSections[p];this._mediaSections[p]=m,this._midToIndex.delete(S.mid),this._midToIndex.set(m.mid,p),this._sdpObject.media[p]=m.getObject(),this.regenerateBundleMids()}else{const p=this._midToIndex.get(m.mid);if(p===void 0)throw new Error(`no media section found with mid '${m.mid}'`);this._mediaSections[p]=m,this._sdpObject.media[p]=m.getObject()}}findMediaSection(m){const _=this._midToIndex.get(m);if(_===void 0)throw new Error(`no media section found with mid '${m}'`);return this._mediaSections[_]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(m=>!m.closed).map(m=>m.mid).join(" "))}};return va.RemoteSdp=o,va}var pn={};Object.defineProperty(pn,"__esModule",{value:!0});pn.extractRtpCapabilities=nE;pn.extractDtlsParameters=rE;pn.getCname=sE;pn.applyCodecParameters=iE;pn.addHeaderExtension=aE;const Aw=tt;function nE({sdpObject:e}){const t=new Map,n=new Map;for(const i of e.media){const a=i.type;switch(a){case"audio":case"video":break;default:continue}for(const o of i.rtp){const f={kind:a,mimeType:`${a}/${o.codec}`,preferredPayloadType:o.payload,clockRate:o.rate,channels:o.encoding,parameters:{},rtcpFeedback:[]};t.set(f.preferredPayloadType,f)}for(const o of i.fmtp??[]){const f=Aw.parseParams(o.config),m=t.get(o.payload);m&&(f!=null&&f.hasOwnProperty("profile-level-id")&&(f["profile-level-id"]=String(f["profile-level-id"])),m.parameters=f)}for(const o of i.rtcpFb??[]){const f={type:o.type,parameter:o.subtype};if(f.parameter||delete f.parameter,o.payload!=="*"){const m=t.get(Number(o.payload));if(!m)continue;m.rtcpFeedback.push(f)}else for(const m of t.values())m.kind===a&&!/.+\/rtx$/i.test(m.mimeType)&&m.rtcpFeedback.push(f)}for(const o of i.ext??[]){if(o["encrypt-uri"])continue;const f={kind:a,uri:o.uri,preferredId:o.value};n.set(f.preferredId,f)}}return{codecs:Array.from(t.values()),headerExtensions:Array.from(n.values())}}function rE({sdpObject:e}){let t=e.setup,n=e.fingerprint;if(!t||!n){const a=(e.media??[]).find(o=>o.port!==0);a&&(t=t??a.setup,n=n??a.fingerprint)}if(t){if(!n)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let r;switch(t){case"active":{r="client";break}case"passive":{r="server";break}case"actpass":{r="auto";break}}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function sE({offerMediaObject:e}){const t=(e.ssrcs??[]).find(n=>n.attribute==="cname");return t?t.value:""}function iE({offerRtpParameters:e,answerMediaObject:t}){var n;for(const r of e.codecs){const i=r.mimeType.toLowerCase();if(i!=="audio/opus"||!(t.rtp??[]).find(m=>m.payload===r.payloadType))continue;t.fmtp=t.fmtp??[];let o=t.fmtp.find(m=>m.payload===r.payloadType);o||(o={payload:r.payloadType,config:""},t.fmtp.push(o));const f=Aw.parseParams(o.config);switch(i){case"audio/opus":{const m=(n=r.parameters)==null?void 0:n["sprop-stereo"];m!==void 0&&(f.stereo=Number(m)?1:0);break}}o.config="";for(const m of Object.keys(f))o.config&&(o.config+=";"),o.config+=`${m}=${f[m]}`}}function aE({offerMediaObject:e,headerExtensionUri:t,headerExtensionId:n}){e.ext||(e.ext=[]),e.ext.push({uri:t,value:n})}var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});Pr.getRtpEncodings=oE;Pr.addLegacySimulcast=cE;function oE({offerMediaObject:e,codecs:t}){const n=new Set;for(const a of e.ssrcs??[]){const o=a.id;o&&n.add(o)}if(n.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups??[]){if(a.semantics!=="FID")continue;const o=a.ssrcs.split(/\s+/),f=Number(o[0]),m=Number(o[1]);n.has(f)&&(n.delete(f),n.delete(m),r.set(f,m))}for(const a of n)r.set(a,void 0);const i=[];for(const[a,o]of r){const f={ssrc:a};o&&t.length>1&&(f.rtx={ssrc:o}),i.push(f)}return i}function cE({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const n=(e.ssrcs??[]).find(S=>S.attribute==="msid");if(!n)throw new Error("a=ssrc line with msid information not found");const[r,i]=n.value.split(" "),a=Number(n.id);let o;(e.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const k=S.ssrcs.split(/\s+/);return Number(k[0])===a?(o=Number(k[1]),!0):!1});const f=(e.ssrcs??[]).find(S=>S.attribute==="cname");if(!f)throw new Error("a=ssrc line with cname information not found");const m=f.value,_=[],p=[];for(let S=0;S<t;++S)_.push(a+S),o&&p.push(o+S);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:_.join(" ")});for(const S of _)e.ssrcs.push({id:S,attribute:"cname",value:m}),e.ssrcs.push({id:S,attribute:"msid",value:`${r} ${i}`});for(let S=0;S<p.length;++S){const k=_[S],M=p[S];e.ssrcs.push({id:M,attribute:"cname",value:m}),e.ssrcs.push({id:M,attribute:"msid",value:`${r} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${k} ${M}`})}}var er={};Object.defineProperty(er,"__esModule",{value:!0});er.addNackSupportForOpus=lE;er.addHeaderExtensionSupport=dE;er.getMsidStreamIdAndTrackId=uE;function lE(e){var t;for(const n of e.codecs??[])(n.mimeType.toLowerCase()==="audio/opus"||n.mimeType.toLowerCase()==="audio/multiopus")&&!((t=n.rtcpFeedback)!=null&&t.some(r=>r.type==="nack"&&!r.parameter))&&(n.rtcpFeedback||(n.rtcpFeedback=[]),n.rtcpFeedback.push({type:"nack"}))}function dE(e,t){var a;let n;const r=(a=e.headerExtensions)==null?void 0:a.find(o=>o.uri===t.uri);if(r){if(r.kind===t.kind)return;n=r.preferredId}if(e.headerExtensions||(e.headerExtensions=[]),n===void 0){n=1;const o=new Set(e.headerExtensions.map(f=>f.preferredId));for(;o.has(n);)++n}const i={kind:t.kind,uri:t.uri,preferredId:n,preferredEncrypt:!1,direction:t.direction};e.headerExtensions.push(i)}function uE(e){if(!e||typeof e!="string")return{msidStreamId:void 0,msidTrackId:void 0};const[t,n]=e.trim().split(/\s+/);return t?{msidStreamId:t,msidTrackId:n}:{msidStreamId:void 0,msidTrackId:void 0}}var Rg;function pE(){if(Rg)return ma;Rg=1,Object.defineProperty(ma,"__esModule",{value:!0}),ma.Chrome111=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Nr,o=oo(),f=pn,m=Pr,_=er,p=new n.Logger("Chrome111"),S="Chrome111",k={OS:1024,MIS:1024};let M=class Rc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:R}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=R,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Rc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return Rc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){if(this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1){let J=1;for(const Q of u){const X=Q.scalabilityMode?(0,a.parse)(Q.scalabilityMode).temporalLayers:3;X>J&&(J=X)}u.forEach((Q,X)=>{Q.rid=`r${X}`,Q.scalabilityMode=`L1T${J}`})}const x=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});w&&w(R.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=Rc.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);if(Z.codecs=r.reduceCodecs(Z.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),C!=null&&C.absCaptureTime){const J=P.media[x.idx];f.addHeaderExtension({offerMediaObject:J,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}}p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);const ae=R.mid;G.mid=ae,P=e.parse(this._pc.localDescription.sdp);const L=P.media[x.idx];if(G.rtcp.cname=f.getCname({offerMediaObject:L}),G.msid=`${l??this._sendStream.id} ${v.id}`,!u)G.encodings=m.getRtpEncodings({offerMediaObject:L,codecs:G.codecs});else if(u.length===1){const J=m.getRtpEncodings({offerMediaObject:L,codecs:G.codecs});Object.assign(J[0],u[0]),G.encodings=J}else G.encodings=u;this._remoteSdp.send({offerMediaObject:L,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const H={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",H),await this._pc.setRemoteDescription(H),this._mapMidTransceiver.set(ae,R),{localId:ae,rtpParameters:G,rtpSender:R.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),D=e.parse(R.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:R,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",R,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(R,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:R})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:R,onRtpReceiver:D}=x;if(D){const P=u.get(R),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:R,rtpParameters:D}=x,P=u.get(R),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:R}=x,D=u.get(R),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const R=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ma.Chrome111=M,ma}var ya={},Ig;function fE(){if(Ig)return ya;Ig=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.Chrome74=void 0;const e=tt,t=et,n=dt,r=Le,i=lt,a=Nr,o=oo(),f=pn,m=Pr,_=er,p=new t.Logger("Chrome74"),S="Chrome74",k={OS:1024,MIS:1024};let M=class Ic extends n.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:R}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=R,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Ic(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return Ic.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((Q,X)=>{Q.rid=`r${X}`});const w=this._remoteSdp.getNextMediaSectionIdx(),x=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});let R=await this._pc.createOffer(),D=e.parse(R.sdp);D.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const P=[];P.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const j=Ic.getLocalRtpCapabilities(D,P),$=this._getSendExtendedRtpCapabilities(j),z=r.getSendingRtpParameters(v.kind,$);z.codecs=r.reduceCodecs(z.codecs,N);const G=r.getSendingRemoteRtpParameters(v.kind,$);G.codecs=r.reduceCodecs(G.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D});let Z=!1;const ae=(0,a.parse)((u??[{}])[0].scalabilityMode);let L;(u==null?void 0:u.length)===1&&ae.spatialLayers>1&&z.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),Z=!0,D=e.parse(R.sdp),L=D.media[w.idx],m.addLegacySimulcast({offerMediaObject:L,numStreams:ae.spatialLayers}),R={type:"offer",sdp:e.write(D)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",R),C!=null&&C.absCaptureTime&&(L=D.media[w.idx],f.addHeaderExtension({offerMediaObject:L,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:G.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),R={type:"offer",sdp:e.write(D)}),await this._pc.setLocalDescription(R);const H=x.mid;if(z.mid=H,D=e.parse(this._pc.localDescription.sdp),L=D.media[w.idx],z.rtcp.cname=f.getCname({offerMediaObject:L}),z.msid=`${l??this._sendStream.id} ${v.id}`,!u)z.encodings=m.getRtpEncodings({offerMediaObject:L,codecs:z.codecs});else if(u.length===1){let Q=m.getRtpEncodings({offerMediaObject:L,codecs:z.codecs});Object.assign(Q[0],u[0]),Z&&(Q=[Q[0]]),z.encodings=Q}else z.encodings=u;if(z.encodings.length>1&&(z.codecs[0].mimeType.toLowerCase()==="video/vp8"||z.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of z.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${ae.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:w.reuseMid,offerRtpParameters:z,answerRtpParameters:G,codecOptions:g});const J={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",J),await this._pc.setRemoteDescription(J),this._mapMidTransceiver.set(H,x),{localId:H,rtpParameters:z,rtpSender:x.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),D=e.parse(R.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:R,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",R,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(R,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:R})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:R,rtpParameters:D}=x,P=u.get(R),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:R}=x,D=u.get(R),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const R=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ya.Chrome74=M,ya}var wa={},Ng;function hE(){if(Ng)return wa;Ng=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.Firefox120=void 0;const e=tt,t=dt,n=et,r=lt,i=Le,a=Nr,o=oo(),f=pn,m=Pr,_=er,p=new n.Logger("Firefox120"),S="Firefox120",k={OS:16,MIS:2048};let M=class Nc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:R}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=R,this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Nc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const l=document.createElement("canvas");l.getContext("2d");const g=l.captureStream().getVideoTracks()[0];try{v.addTransceiver("audio",{direction:"sendrecv"}),v.addTransceiver(g,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const C=await v.createOffer();try{l.remove()}catch{}try{g.stop()}catch{}try{v.close()}catch{}v=void 0;const N=e.parse(C.sdp);return Nc.getLocalRtpCapabilities(N)}catch(C){try{l.remove()}catch{}try{g.stop()}catch{}try{v==null||v.close()}catch{}throw v=void 0,C}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v){const l=f.extractRtpCapabilities({sdpObject:v});return i.validateAndNormalizeRtpCapabilities(l),l}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){throw this.assertNotClosed(),new r.UnsupportedError("not supported")}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,codec:C,onRtpSender:N}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((L,H)=>{L.rid=`r${H}`});const w=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});N&&N(w.sender);const x=await this._pc.createOffer();let R=e.parse(x.sdp);R.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const D=Nc.getLocalRtpCapabilities(R),P=this._getSendExtendedRtpCapabilities(D),j=i.getSendingRtpParameters(v.kind,P);j.codecs=i.reduceCodecs(j.codecs,C);const $=i.getSendingRemoteRtpParameters(v.kind,P);$.codecs=i.reduceCodecs($.codecs,C),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:R});const z=(0,a.parse)((u??[{}])[0].scalabilityMode);p.debug("send() | calling pc.setLocalDescription() [offer:%o]",x),await this._pc.setLocalDescription(x);const G=w.mid;j.mid=G,R=e.parse(this._pc.localDescription.sdp);const Z=R.media[R.media.length-1];if(j.rtcp.cname=f.getCname({offerMediaObject:Z}),j.msid=`${l??this._sendStream.id} ${v.id}`,!u)j.encodings=m.getRtpEncodings({offerMediaObject:Z,codecs:j.codecs});else if(u.length===1){const L=m.getRtpEncodings({offerMediaObject:Z,codecs:j.codecs});Object.assign(L[0],u[0]),j.encodings=L}else j.encodings=u;if(j.encodings.length>1&&(j.codecs[0].mimeType.toLowerCase()==="video/vp8"||j.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const L of j.encodings)L.scalabilityMode?L.scalabilityMode=`L1T${z.temporalLayers}`:L.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Z,offerRtpParameters:j,answerRtpParameters:$,codecOptions:g});const ae={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ae),await this._pc.setRemoteDescription(ae),this._mapMidTransceiver.set(G,w),{localId:G,rtpParameters:j,rtpSender:w.sender}}async stopSending(v){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",v),this._closed)return;const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated transceiver not found");l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.disableMediaSection(l.mid);const u=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated transceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),D=e.parse(R.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:R,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",R,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(R,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:R})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:R,onRtpReceiver:D}=x;if(D){const P=u.get(R),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:R,rtpParameters:D}=x,P=u.get(R),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j}),C={type:"answer",sdp:e.write(N)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:R}=x,D=u.get(R),P=this._pc.getTransceivers().find(j=>j.mid===D);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const R=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new r.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return wa.Firefox120=M,wa}var _a={},Pg;function mE(){if(Pg)return _a;Pg=1,Object.defineProperty(_a,"__esModule",{value:!0}),_a.Safari12=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Nr,o=oo(),f=pn,m=Pr,_=er,p=new n.Logger("Safari12"),S="Safari12",k={OS:1024,MIS:1024};let M=class Pc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:R}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=R,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",D=>{this.emit("@icecandidateerror",D)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new Pc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return Pc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l);const x=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream]});w&&w(R.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=Pc.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,N);let ae;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});const L=(0,a.parse)((u??[{}])[0].scalabilityMode);u&&u.length>1&&(p.debug("send() | enabling legacy simulcast"),P=e.parse(D.sdp),ae=P.media[x.idx],m.addLegacySimulcast({offerMediaObject:ae,numStreams:u.length}),D={type:"offer",sdp:e.write(P)}),C!=null&&C.absCaptureTime&&(ae=P.media[x.idx],f.addHeaderExtension({offerMediaObject:ae,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(Q=>Q.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);const H=R.mid;if(G.mid=H,P=e.parse(this._pc.localDescription.sdp),ae=P.media[x.idx],G.rtcp.cname=f.getCname({offerMediaObject:ae}),G.msid=`${l??this._sendStream.id} ${v.id}`,G.encodings=m.getRtpEncodings({offerMediaObject:ae,codecs:G.codecs}),u)for(let Q=0;Q<G.encodings.length;++Q)u[Q]&&Object.assign(G.encodings[Q],u[Q]);if(G.encodings.length>1&&(G.codecs[0].mimeType.toLowerCase()==="video/vp8"||G.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Q of G.encodings)Q.scalabilityMode?Q.scalabilityMode=`L1T${L.temporalLayers}`:Q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ae,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const J={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",J),await this._pc.setRemoteDescription(J),this._mapMidTransceiver.set(H,R),{localId:H,rtpParameters:G,rtpSender:R.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),D=e.parse(R.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:R,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",R,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(R,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:R})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:R,onRtpReceiver:D}=x;if(D){const P=u.get(R),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:R,rtpParameters:D}=x,P=u.get(R),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:R}=x,D=u.get(R),P=this._pc.getTransceivers().find(j=>j.mid===D);if(!P)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver})}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const R=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return _a.Safari12=M,_a}var Sa={},jg;function gE(){if(jg)return Sa;jg=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.ReactNative106=void 0;const e=tt,t=dt,n=et,r=Le,i=lt,a=Nr,o=oo(),f=pn,m=Pr,_=er,p=new n.Logger("ReactNative106"),S="ReactNative106",k={OS:1024,MIS:1024};let M=class jc extends t.EnhancedEventEmitter{constructor({direction:v,iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C,iceServers:N,iceTransportPolicy:w,additionalSettings:x,getSendExtendedRtpCapabilities:R}){super();I(this,"_closed",!1);I(this,"_direction");I(this,"_remoteSdp");I(this,"_getSendExtendedRtpCapabilities");I(this,"_forcedLocalDtlsRole");I(this,"_pc");I(this,"_mapMidTransceiver",new Map);I(this,"_sendStream",new MediaStream);I(this,"_hasDataChannelMediaSection",!1);I(this,"_nextSendSctpStreamId",0);I(this,"_transportReady",!1);I(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)});I(this,"onIceCandidateError",v=>{this.emit("@icecandidateerror",v)});I(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)});I(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}});p.debug("constructor()"),this._direction=v,this._remoteSdp=new o.RemoteSdp({iceParameters:l,iceCandidates:u,dtlsParameters:g,sctpParameters:C}),this._getSendExtendedRtpCapabilities=R,g.role&&g.role!=="auto"&&(this._forcedLocalDtlsRole=g.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:N??[],iceTransportPolicy:w??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...x}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:S,factory:v=>new jc(v),getNativeRtpCapabilities:async()=>{p.debug("getNativeRtpCapabilities()");let v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const l=await v.createOffer();try{v.close()}catch{}v=void 0;const u=e.parse(l.sdp);return jc.getLocalRtpCapabilities(u)}catch(l){try{v==null||v.close()}catch{}throw v=void 0,l}},getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),{numStreams:k})}}static getLocalRtpCapabilities(v,l=[]){const u=f.extractRtpCapabilities({sdpObject:v});r.validateAndNormalizeRtpCapabilities(u),_.addNackSupportForOpus(u);for(const g of l)_.addHeaderExtensionSupport(u,g);return u}get name(){return S}close(){if(p.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(v){this.assertNotClosed(),p.debug("updateIceServers()");const l=this._pc.getConfiguration();l.iceServers=v,this._pc.setConfiguration(l)}async restartIce(v){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const l=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}else{const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,streamId:l,encodings:u,codecOptions:g,headerExtensionOptions:C,codec:N,onRtpSender:w}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s, streamId:%s]",v.kind,v.id,l),u&&u.length>1&&u.forEach((X,le)=>{X.rid=`r${le}`});const x=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:u});w&&w(R.sender);let D=await this._pc.createOffer(),P=e.parse(D.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const j=[];j.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:v.kind,direction:"sendonly"});const $=jc.getLocalRtpCapabilities(P,j),z=this._getSendExtendedRtpCapabilities($),G=r.getSendingRtpParameters(v.kind,z);G.codecs=r.reduceCodecs(G.codecs,N);const Z=r.getSendingRemoteRtpParameters(v.kind,z);Z.codecs=r.reduceCodecs(Z.codecs,N),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});let ae=!1;const L=(0,a.parse)((u??[{}])[0].scalabilityMode);let H;(u==null?void 0:u.length)===1&&L.spatialLayers>1&&G.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),ae=!0,P=e.parse(D.sdp),H=P.media[x.idx],m.addLegacySimulcast({offerMediaObject:H,numStreams:L.spatialLayers}),D={type:"offer",sdp:e.write(P)}),C!=null&&C.absCaptureTime&&(H=P.media[x.idx],f.addHeaderExtension({offerMediaObject:H,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:Z.headerExtensions.find(X=>X.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),D={type:"offer",sdp:e.write(P)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),await this._pc.setLocalDescription(D);let J=R.mid??void 0;if(J||p.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),G.mid=J,P=e.parse(this._pc.localDescription.sdp),H=P.media[x.idx],G.rtcp.cname=f.getCname({offerMediaObject:H}),G.msid=`${l??this._sendStream.id} ${v.id}`,!u)G.encodings=m.getRtpEncodings({offerMediaObject:H,codecs:G.codecs});else if(u.length===1){let X=m.getRtpEncodings({offerMediaObject:H,codecs:G.codecs});Object.assign(X[0],u[0]),ae&&(X=[X[0]]),G.encodings=X}else G.encodings=u;if(G.encodings.length>1&&(G.codecs[0].mimeType.toLowerCase()==="video/vp8"||G.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const X of G.encodings)X.scalabilityMode?X.scalabilityMode=`L1T${L.temporalLayers}`:X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:H,reuseMid:x.reuseMid,offerRtpParameters:G,answerRtpParameters:Z,codecOptions:g});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),J||(J=R.mid,G.mid=J),this._mapMidTransceiver.set(J,R),{localId:J,rtpParameters:G,rtpSender:R.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;p.debug("stopSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");if(l.sender.replaceTrack(null),this._pc.removeTrack(l.sender),this._remoteSdp.closeMediaSection(l.mid))try{l.stop()}catch{}const g=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="inactive",this._remoteSdp.pauseMediaSection(v);const u=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",v);const l=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!l)throw new Error("associated RTCRtpTransceiver not found");l.direction="sendonly";const u=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const g={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async replaceTrack(v,l){this.assertNotClosed(),this.assertSendDirection(),l?p.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):p.debug("replaceTrack() [localId:%s, no track]",v);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");await u.sender.replaceTrack(l)}async setMaxSpatialLayer(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{x<=l?w.active=!0:w.active=!1}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async setRtpEncodingParameters(v,l){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const u=this._mapMidTransceiver.get(v);if(!u)throw new Error("associated RTCRtpTransceiver not found");const g=u.sender.getParameters();g.encodings.forEach((w,x)=>{g.encodings[x]={...w,...l}}),await u.sender.setParameters(g),this._remoteSdp.muxMediaSectionSimulcast(v,g.encodings);const C=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),await this._pc.setLocalDescription(C);const N={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:l,maxRetransmits:u,label:g,protocol:C}){this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:l,maxRetransmits:u,protocol:C};p.debug("sendDataChannel() [options:%o]",N);const w=this._pc.createDataChannel(g,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%k.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),D=e.parse(R.sdp),P=D.media.find($=>$.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:D}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}const x={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:w,sctpStreamParameters:x}}async receive(v){var w;this.assertNotClosed(),this.assertRecvDirection();const l=[],u=new Map;for(const x of v){const{trackId:R,kind:D,rtpParameters:P,streamId:j}=x;p.debug("receive() [trackId:%s, kind:%s]",R,D);const $=P.mid??String(this._mapMidTransceiver.size);u.set(R,$);const{msidStreamId:z}=_.getMsidStreamIdAndTrackId(P.msid);this._remoteSdp.receive({mid:$,kind:D,offerRtpParameters:P,streamId:j??z??((w=P.rtcp)==null?void 0:w.cname)??"-",trackId:R})}const g={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);for(const x of v){const{trackId:R,onRtpReceiver:D}=x;if(D){const P=u.get(R),j=this._pc.getTransceivers().find($=>$.mid===P);if(!j)throw new Error("transceiver not found");D(j.receiver)}}let C=await this._pc.createAnswer();const N=e.parse(C.sdp);for(const x of v){const{trackId:R,rtpParameters:D}=x,P=u.get(R),j=N.media.find($=>String($.mid)===P);f.applyCodecParameters({offerRtpParameters:D,answerMediaObject:j})}C={type:"answer",sdp:e.write(N)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),await this._pc.setLocalDescription(C);for(const x of v){const{trackId:R}=x,D=u.get(R),P=this._pc.getTransceivers().find(j=>j.mid===D);if(P)this._mapMidTransceiver.set(D,P),l.push({localId:D,track:P.receiver.track,rtpReceiver:P.receiver});else throw new Error("new RTCRtpTransceiver not found")}return l}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const g of v){p.debug("stopReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u);for(const g of v)this._mapMidTransceiver.delete(g)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("pauseReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const g of v){p.debug("resumeReceiving() [localId:%s]",g);const C=this._mapMidTransceiver.get(g);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(g)}const l={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),await this._pc.setLocalDescription(u)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const l=this._mapMidTransceiver.get(v);if(!l)throw new Error("associated RTCRtpTransceiver not found");return l.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:l,protocol:u}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w}=v,x={negotiated:!0,id:g,ordered:C,maxPacketLifeTime:N,maxRetransmits:w,protocol:u};p.debug("receiveDataChannel() [options:%o]",x);const R=this._pc.createDataChannel(l,x);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const D={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",D),await this._pc.setRemoteDescription(D);const P=await this._pc.createAnswer();if(!this._transportReady){const j=e.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:v,localSdpObject:l}){l||(l=e.parse(this._pc.localDescription.sdp));const u=f.extractDtlsParameters({sdpObject:l});u.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((g,C)=>{this.safeEmit("@connect",{dtlsParameters:u},g,C)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Sa.ReactNative106=M,Sa}var Dg;function vE(){if(Dg)return Kr;Dg=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.Device=void 0,Kr.detectDevice=k,Kr.detectDeviceAsync=M;const e=et,t=dt,n=lt,r=In,i=Le,a=El,o=pE(),f=fE(),m=hE(),_=mE(),p=gE(),S=new e.Logger("Device");function k(w,x){return S.debug("detectDevice()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!x&&typeof navigator=="object"&&(x=navigator.userAgentData),B(w,x)}async function M(w,x){return S.debug("detectDeviceAsync()"),!w&&typeof navigator=="object"&&(w=navigator.userAgent),!x&&typeof navigator=="object"&&(x=navigator.userAgentData),B(w,x)}let V=class $w{constructor({handlerName:x,handlerFactory:R}={}){I(this,"_handlerFactory");I(this,"_handlerName");I(this,"_loaded",!1);I(this,"_getSendExtendedRtpCapabilities");I(this,"_recvRtpCapabilities");I(this,"_canProduceByKind",{audio:!1,video:!1});I(this,"_sctpCapabilities");I(this,"_observer",new t.EnhancedEventEmitter);if(S.debug("constructor()"),x&&R)throw new TypeError("just one of handlerName or handlerInterface can be given");if(R)this._handlerFactory=R;else{if(x)S.debug("constructor() | handler given: %s",x);else if(x=k(),x)S.debug("constructor() | detected handler: %s",x);else throw new n.UnsupportedError("device not supported");switch(x){case"Chrome111":{this._handlerFactory=o.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=f.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=m.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=_.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=p.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${x}"`)}}this._handlerName=this._handlerFactory.name}static async factory({handlerName:x,handlerFactory:R}={}){if(S.debug("factory()"),x&&R)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!x&&!R&&(x=await M(),!x))throw new n.UnsupportedError("device not supported");return new $w({handlerName:x,handlerFactory:R})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:x,preferLocalCodecsOrder:R=!1}){if(S.debug("load() [routerRtpCapabilities:%o]",x),this._loaded)throw new n.InvalidStateError("already loaded");const D=r.clone(x);i.validateAndNormalizeRtpCapabilities(D);const{getNativeRtpCapabilities:P,getNativeSctpCapabilities:j}=this._handlerFactory,$=r.clone(await P());i.validateAndNormalizeRtpCapabilities($),S.debug("load() | got native RTP capabilities:%o",$),this._getSendExtendedRtpCapabilities=G=>r.clone(i.getExtendedRtpCapabilities(G,D,R));const z=i.getExtendedRtpCapabilities($,D,!1);this._recvRtpCapabilities=i.getRecvRtpCapabilities(z),i.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),S.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=i.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=i.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await j(),i.validateSctpCapabilities(this._sctpCapabilities),S.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),S.debug("load() succeeded"),this._loaded=!0}canProduce(x){if(this._loaded){if(x!=="audio"&&x!=="video")throw new TypeError(`invalid kind "${x}"`)}else throw new n.InvalidStateError("not loaded");return this._canProduceByKind[x]}createSendTransport({id:x,iceParameters:R,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z}){return S.debug("createSendTransport()"),this.createTransport({direction:"send",id:x,iceParameters:R,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z})}createRecvTransport({id:x,iceParameters:R,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z}){return S.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:x,iceParameters:R,iceCandidates:D,dtlsParameters:P,sctpParameters:j,iceServers:$,iceTransportPolicy:z,additionalSettings:G,appData:Z})}createTransport({direction:x,id:R,iceParameters:D,iceCandidates:P,dtlsParameters:j,sctpParameters:$,iceServers:z,iceTransportPolicy:G,additionalSettings:Z,appData:ae}){if(this._loaded){if(typeof R!="string")throw new TypeError("missing id");if(typeof D!="object")throw new TypeError("missing iceParameters");if(Array.isArray(P)){if(typeof j!="object")throw new TypeError("missing dtlsParameters");if($&&typeof $!="object")throw new TypeError("wrong sctpParameters");if(ae&&typeof ae!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new n.InvalidStateError("not loaded");const L=new a.Transport({direction:x,id:R,iceParameters:D,iceCandidates:P,dtlsParameters:j,sctpParameters:$,iceServers:z,iceTransportPolicy:G,additionalSettings:Z,appData:ae,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",L),L}};Kr.Device=V;function B(w,x){S.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',w,x);const R=v(w,x);if(R){if(R>=111)return S.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(R>=74)return S.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";S.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const D=l(w);if(D){if(D>=120)return S.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";S.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const P=u(w);if(P){if(P>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const j=g(w);if(j){if(j>=605)return S.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";S.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(N()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return S.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";S.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}S.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',w,x)}function v(w,x){if(S.debug("getChromiumMajorVersion()"),C(w,x)){S.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(x){const D=(x.brands??[]).find(P=>P.brand==="Chromium");if(D){const P=Number(D.version);return S.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${P}`),P}}const R=w==null?void 0:w.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(R!=null&&R[1]){const D=Number(R[1]);return S.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${D}`),D}S.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function l(w){if(S.debug("getFirefoxMajorVersion()"),C(w)){S.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const x=w==null?void 0:w.match(/\bFirefox\/(\w+)/i);if(x!=null&&x[1]){const R=Number(x[1]);return S.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${R}`),R}S.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function u(w){if(S.debug("getMacOSWebKitMajorVersion()"),C(w)){S.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(N()){S.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(w&&/\bSafari\b/i.test(w)&&!/\bChrome\b/i.test(w)&&!/\bChromium\b/i.test(w)&&!/\bFirefox\b/i.test(w))){S.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const R=w.match(/AppleWebKit\/(\w+)/i);if(R!=null&&R[1]){const D=Number(R[1]);return S.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${D}`),D}S.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function g(w){if(S.debug("getIOSWebKitMajorVersion()"),!C(w)){S.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(N()){S.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const x=w==null?void 0:w.match(/AppleWebKit\/(\w+)/i);if(x!=null&&x[1]){const R=Number(x[1]);return S.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${R}`),R}S.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function C(w,x){return S.debug("isIOS()"),(x==null?void 0:x.platform)==="iOS"?(S.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):x!=null&&x.platform?(S.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):w&&/iPad|iPhone|iPod/.test(w)?(S.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(S.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(S.debug("isIOS() | this is not iOS => false"),!1)}function N(){return S.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(S.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(S.debug("isReactNative() | this is not React-Native => false"),!1)}return Kr}var jl={},Dl={},Fw={},ts=256,Dc=[],uc;for(;ts--;)Dc[ts]=(ts+256).toString(16).substring(1);function yE(){var e=0,t,n="";if(!uc||ts+16>256){for(uc=Array(e=256);e--;)uc[e]=256*Math.random()|0;e=ts=0}for(;e<16;e++)t=uc[ts+e],e==6?n+=Dc[t&15|64]:e==8?n+=Dc[t&63|128]:n+=Dc[t],e&1&&e>1&&e<11&&(n+="-");return ts++,n}Fw.v4=yE;var Ll={};Object.defineProperty(Ll,"__esModule",{value:!0});Ll.FakeEventTarget=void 0;let wE=class{constructor(){I(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}};Ll.FakeEventTarget=wE;var Ml={};Object.defineProperty(Ml,"__esModule",{value:!0});Ml.FakeEvent=void 0;class _E{constructor(t,n={}){I(this,"NONE",0);I(this,"CAPTURING_PHASE",1);I(this,"AT_TARGET",2);I(this,"BUBBLING_PHASE",3);I(this,"type");I(this,"bubbles");I(this,"cancelable");I(this,"defaultPrevented",!1);I(this,"composed",!1);I(this,"currentTarget",null);I(this,"eventPhase",this.NONE);I(this,"isTrusted",!0);I(this,"target",null);I(this,"timeStamp",0);I(this,"cancelBubble",!1);I(this,"returnValue",!0);I(this,"srcElement",null);this.type=t,this.bubbles=n.bubbles??!1,this.cancelable=n.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(t,n,r){}}Ml.FakeEvent=_E;var yf={};Object.defineProperty(yf,"__esModule",{value:!0});yf.clone=SE;function SE(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}Object.defineProperty(Dl,"__esModule",{value:!0});Dl.FakeMediaStreamTrack=void 0;const Lg=Fw,CE=Ll,Js=Ml,pc=yf;var to,Ci,xi,xn,fr,bn,rs,bi,ss,Ei,is,as,os,cs,ls,ds;const Sf=class Sf extends CE.FakeEventTarget{constructor({kind:n,id:r,label:i,contentHint:a,enabled:o,muted:f,readyState:m,capabilities:_,constraints:p,settings:S,data:k}){super();Ke(this,to);Ke(this,Ci);Ke(this,xi);Ke(this,xn);Ke(this,fr);Ke(this,bn);Ke(this,rs);Ke(this,bi);Ke(this,ss);Ke(this,Ei);Ke(this,is);Ke(this,as,null);Ke(this,os,null);Ke(this,cs,null);Ke(this,ls,null);Ke(this,ds,null);Ce(this,to,r??(0,Lg.v4)()),Ce(this,Ci,n),Ce(this,xi,i??""),Ce(this,rs,a??""),Ce(this,fr,o??!0),Ce(this,bn,f??!1),Ce(this,xn,m??"live"),Ce(this,bi,_??{}),Ce(this,ss,p??{}),Ce(this,Ei,S??{}),Ce(this,is,k??{})}get id(){return oe(this,to)}get kind(){return oe(this,Ci)}get label(){return oe(this,xi)}get contentHint(){return oe(this,rs)}set contentHint(n){Ce(this,rs,n)}get enabled(){return oe(this,fr)}set enabled(n){const r=oe(this,fr)!==n;Ce(this,fr,n),r&&this.dispatchEvent(new Js.FakeEvent("enabledchange"))}get muted(){return oe(this,bn)}get readyState(){return oe(this,xn)}get data(){return oe(this,is)}set data(n){Ce(this,is,n)}get onmute(){return oe(this,as)}set onmute(n){oe(this,as)&&this.removeEventListener("mute",oe(this,as)),Ce(this,as,n),n&&this.addEventListener("mute",n)}get onunmute(){return oe(this,os)}set onunmute(n){oe(this,os)&&this.removeEventListener("unmute",oe(this,os)),Ce(this,os,n),n&&this.addEventListener("unmute",n)}get onended(){return oe(this,cs)}set onended(n){oe(this,cs)&&this.removeEventListener("ended",oe(this,cs)),Ce(this,cs,n),n&&this.addEventListener("ended",n)}get onenabledchange(){return oe(this,ls)}set onenabledchange(n){oe(this,ls)&&this.removeEventListener("enabledchange",oe(this,ls)),Ce(this,ls,n),n&&this.addEventListener("enabledchange",n)}get onstopped(){return oe(this,ds)}set onstopped(n){oe(this,ds)&&this.removeEventListener("stopped",oe(this,ds)),Ce(this,ds,n),n&&this.addEventListener("stopped",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}stop(){oe(this,xn)!=="ended"&&(Ce(this,xn,"ended"),this.dispatchEvent(new Js.FakeEvent("stopped")))}clone({id:n,data:r}={}){return new Sf({id:n??(0,Lg.v4)(),kind:oe(this,Ci),label:oe(this,xi),contentHint:oe(this,rs),enabled:oe(this,fr),muted:oe(this,bn),readyState:oe(this,xn),capabilities:(0,pc.clone)(oe(this,bi)),constraints:(0,pc.clone)(oe(this,ss)),settings:(0,pc.clone)(oe(this,Ei)),data:r??(0,pc.clone)(oe(this,is))})}getCapabilities(){return oe(this,bi)}getConstraints(){return oe(this,ss)}async applyConstraints(n={}){return Ce(this,ss,n),Promise.resolve()}getSettings(){return oe(this,Ei)}remoteStop(){oe(this,xn)!=="ended"&&(Ce(this,xn,"ended"),this.dispatchEvent(new Js.FakeEvent("stopped")),this.dispatchEvent(new Js.FakeEvent("ended")))}remoteMute(){oe(this,bn)||(Ce(this,bn,!0),this.dispatchEvent(new Js.FakeEvent("mute")))}remoteUnmute(){oe(this,bn)&&(Ce(this,bn,!1),this.dispatchEvent(new Js.FakeEvent("unmute")))}};to=new WeakMap,Ci=new WeakMap,xi=new WeakMap,xn=new WeakMap,fr=new WeakMap,bn=new WeakMap,rs=new WeakMap,bi=new WeakMap,ss=new WeakMap,Ei=new WeakMap,is=new WeakMap,as=new WeakMap,os=new WeakMap,cs=new WeakMap,ls=new WeakMap,ds=new WeakMap;let dp=Sf;Dl.FakeMediaStreamTrack=dp;var Ol={};Object.defineProperty(Ol,"__esModule",{value:!0});Ol.FakeEventTarget=void 0;class xE{constructor(){I(this,"listeners",{})}addEventListener(t,n,r){n&&(this.listeners[t]=this.listeners[t]??[],this.listeners[t].push({callback:typeof n=="function"?n:n.handleEvent,once:typeof r=="object"&&r.once===!0}))}removeEventListener(t,n,r){this.listeners[t]&&n&&(this.listeners[t]=this.listeners[t].filter(i=>i.callback!==(typeof n=="function"?n:n.handleEvent)))}dispatchEvent(t){if(!t||typeof t.type!="string")throw new Error("invalid event object");const n=this.listeners[t.type];if(!n)return!0;for(const r of[...n]){try{r.callback.call(this,t)}catch(i){setTimeout(()=>{throw i},0)}r.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}}Ol.FakeEventTarget=xE;Object.defineProperty(jl,"__esModule",{value:!0});jl.FakeHandler=void 0;const bE=Dl,EE=dt,kE=et,qs=In,uu=Le,Uw=lt,TE=Ol,Ye=new kE.Logger("FakeHandler"),Mg="FakeHandler";class Ma extends EE.EnhancedEventEmitter{constructor({getSendExtendedRtpCapabilities:n},r){super();I(this,"_closed",!1);I(this,"_fakeParameters");I(this,"_getSendExtendedRtpCapabilities");I(this,"_cname",`CNAME-${qs.generateRandomNumber()}`);I(this,"_defaultSendStreamId",`${qs.generateRandomNumber()}`);I(this,"_transportReady",!1);I(this,"_nextLocalId",1);I(this,"_tracks",new Map);I(this,"_nextSctpStreamId",0);Ye.debug("constructor()"),this._getSendExtendedRtpCapabilities=n,this._fakeParameters=r}static createFactory(n){return{name:Mg,factory:r=>new Ma(r,n),getNativeRtpCapabilities:async()=>(Ye.debug("getNativeRtpCapabilities()"),Ma.getLocalRtpCapabilities(n)),getNativeSctpCapabilities:async()=>(Ye.debug("getNativeSctpCapabilities()"),n.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(n){const r=n.generateNativeRtpCapabilities();return uu.validateAndNormalizeRtpCapabilities(r),r}get name(){return Mg}close(){Ye.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(n){this.emit("@icegatheringstatechange",n)}setConnectionState(n){this.emit("@connectionstatechange",n)}async updateIceServers(n){this.assertNotClosed(),Ye.debug("updateIceServers()")}async restartIce(n){this.assertNotClosed(),Ye.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:n,streamId:r,encodings:i,codecOptions:a,codec:o}){this.assertNotClosed(),Ye.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const f=Ma.getLocalRtpCapabilities(this._fakeParameters),m=this._getSendExtendedRtpCapabilities(f),_=uu.getSendingRtpParameters(n.kind,m);_.codecs=uu.reduceCodecs(_.codecs,o);const p=_.codecs.some(k=>/.+\/rtx$/i.test(k.mimeType));_.mid=`mid-${qs.generateRandomNumber()}`,_.msid=`${r??"-"} ${n.id}`,i||(i=[{}]);for(const k of i)k.ssrc=qs.generateRandomNumber(),p&&(k.rtx={ssrc:qs.generateRandomNumber()});_.encodings=i,_.rtcp={cname:this._cname,reducedSize:!0,mux:!0},_.msid=`${r??this._defaultSendStreamId} ${n.id}`;const S=this._nextLocalId++;return this._tracks.set(S,n),{localId:String(S),rtpParameters:_}}async stopSending(n){if(Ye.debug("stopSending() [localId:%s]",n),!this._closed){if(!this._tracks.has(Number(n)))throw new Error("local track not found");this._tracks.delete(Number(n))}}async pauseSending(n){this.assertNotClosed()}async resumeSending(n){this.assertNotClosed()}async replaceTrack(n,r){this.assertNotClosed(),r?Ye.debug("replaceTrack() [localId:%s, track.id:%s]",n,r.id):Ye.debug("replaceTrack() [localId:%s, no track]",n),this._tracks.delete(Number(n)),this._tracks.set(Number(n),r)}async setMaxSpatialLayer(n,r){this.assertNotClosed(),Ye.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",n,r)}async setRtpEncodingParameters(n,r){this.assertNotClosed(),Ye.debug("setRtpEncodingParameters() [localId:%s, params:%o]",n,r)}async getSenderStats(n){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),Ye.debug("sendDataChannel()");const f=new Og({id:this._nextSctpStreamId++,ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:o}),m={streamId:this._nextSctpStreamId,ordered:n,maxPacketLifeTime:r,maxRetransmits:i};return{dataChannel:f,sctpStreamParameters:m}}async receive(n){this.assertNotClosed();const r=[];for(const i of n){const{trackId:a,kind:o}=i;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Ye.debug("receive() [trackId:%s, kind:%s]",a,o);const f=this._nextLocalId++,m=new bE.FakeMediaStreamTrack({kind:o});this._tracks.set(f,m),r.push({localId:String(f),track:m})}return r}async stopReceiving(n){if(!this._closed)for(const r of n)Ye.debug("stopReceiving() [localId:%s]",r),this._tracks.delete(Number(r))}async pauseReceiving(n){this.assertNotClosed()}async resumeReceiving(n){this.assertNotClosed()}async getReceiverStats(n){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:n,label:r,protocol:i}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Ye.debug("receiveDataChannel()"),{dataChannel:new Og({id:n.streamId,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,label:r,protocol:i})}}async setupTransport({localDtlsRole:n,localSdpObject:r}){const i=qs.clone(this._fakeParameters.generateLocalDtlsParameters());n&&(i.role=n),this.emit("@connectionstatechange","connecting"),await new Promise((a,o)=>this.emit("@connect",{dtlsParameters:i},a,o)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Uw.InvalidStateError("method called in a closed handler")}}jl.FakeHandler=Ma;class Og extends TE.FakeEventTarget{constructor({id:n,ordered:r=!0,maxPacketLifeTime:i=null,maxRetransmits:a=null,label:o="",protocol:f=""}){super();I(this,"_id");I(this,"_negotiated",!0);I(this,"_ordered");I(this,"_maxPacketLifeTime");I(this,"_maxRetransmits");I(this,"_label");I(this,"_protocol");I(this,"_readyState","connecting");I(this,"_bufferedAmount",0);I(this,"_bufferedAmountLowThreshold",0);I(this,"_binaryType","arraybuffer");I(this,"_onopen",null);I(this,"_onclosing",null);I(this,"_onclose",null);I(this,"_onmessage",null);I(this,"_onbufferedamountlow",null);I(this,"_onerror",null);Ye.debug(`constructor() [id:${n}, ordered:${r}, maxPacketLifeTime:${i}, maxRetransmits:${a}, label:${o}, protocol:${f}`),this._id=n,this._ordered=r,this._maxPacketLifeTime=i,this._maxRetransmits=a,this._label=o,this._protocol=f}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(n){this._bufferedAmountLowThreshold=n}get binaryType(){return this._binaryType}set binaryType(n){this._binaryType=n}get onopen(){return this._onopen}set onopen(n){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=n,n&&this.addEventListener("open",n)}get onclosing(){return this._onclosing}set onclosing(n){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=n,n&&this.addEventListener("closing",n)}get onclose(){return this._onclose}set onclose(n){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=n,n&&this.addEventListener("close",n)}get onmessage(){return this._onmessage}set onmessage(n){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=n,n&&this.addEventListener("message",n)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(n){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=n,n&&this.addEventListener("bufferedamountlow",n)}get onerror(){return this._onerror}set onerror(n){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=n,n&&this.addEventListener("error",n)}addEventListener(n,r,i){super.addEventListener(n,r,i)}removeEventListener(n,r,i){super.removeEventListener(n,r,i)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(n){if(this._readyState!=="open")throw new Uw.InvalidStateError("not open")}}var fn={};Object.defineProperty(fn,"__esModule",{value:!0});fn.generateRouterRtpCapabilities=RE;fn.generateNativeRtpCapabilities=IE;fn.generateNativeSctpCapabilities=NE;fn.generateLocalDtlsParameters=PE;fn.generateTransportRemoteParameters=jE;fn.generateProducerRemoteParameters=DE;fn.generateConsumerRemoteParameters=LE;fn.generateDataProducerRemoteParameters=ME;fn.generateDataConsumerRemoteParameters=OE;const ht=In;function jt(){return String(ht.generateRandomNumber())}function RE(){return ht.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function IE(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function NE(){return ht.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function PE(){return ht.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function jE(){return{id:jt(),iceParameters:ht.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:ht.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:ht.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:ht.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function DE(){return ht.deepFreeze({id:jt()})}function LE({id:e,codecMimeType:t}={}){switch(t){case"audio/opus":return{id:e??jt(),producerId:jt(),kind:"audio",rtpParameters:ht.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:e??jt(),producerId:jt(),kind:"audio",rtpParameters:ht.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:e??jt(),producerId:jt(),kind:"video",rtpParameters:ht.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:e??jt(),producerId:jt(),kind:"video",rtpParameters:ht.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${t}'`)}}function ME(){return ht.deepFreeze({id:jt()})}function OE({id:e}={}){return{id:e??jt(),dataProducerId:jt(),sctpStreamParameters:ht.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}var Ag;function zw(){return Ag||(Ag=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.enhancedEvents=e.ortc=e.parseScalabilityMode=e.detectDeviceAsync=e.detectDevice=e.Device=e.version=e.types=void 0;const t=Sl;e.debug=t.default,e.types=_w,e.version="3.18.6";var n=vE();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return n.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return n.detectDevice}}),Object.defineProperty(e,"detectDeviceAsync",{enumerable:!0,get:function(){return n.detectDeviceAsync}});var r=Nr;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=Le,e.enhancedEvents=dt;var i=jl;Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=fn}(au)),au}var AE=zw();const fc=1e4;function $E({selfUserId:e,getSelfUserId:t,sendDispatch:n,waitForEvent:r,onRemoteAudioAdded:i,onRemoteAudioRemoved:a}){const o={sessionToken:0,guildId:"",channelId:"",device:null,sendTransport:null,recvTransport:null,localProducer:null,localStream:null,consumersByProducerId:new Map,producerOwnerByProducerId:new Map,isMuted:!1,isDeafened:!1,audioOutputDeviceId:"",pendingAudioStartByProducerId:new Map};function f(j){const $=o.pendingAudioStartByProducerId.get(j);$&&($.cleanup(),o.pendingAudioStartByProducerId.delete(j))}function m(j,$){if(!j||!$||o.pendingAudioStartByProducerId.has($))return;const z=()=>{j.paused?j.play().then(()=>{f($)}).catch(()=>{}):f($)},G=["pointerdown","touchstart","keydown","click"];G.forEach(ae=>window.addEventListener(ae,z,{passive:!0}));const Z=window.setInterval(z,1500);o.pendingAudioStartByProducerId.set($,{cleanup:()=>{window.clearInterval(Z),G.forEach(ae=>window.removeEventListener(ae,z))}})}function _(j){return j===o.sessionToken&&!!o.channelId}function p(){return(t==null?void 0:t())||e||""}async function S(j,$,z=fc){return r({type:j,match:$,timeoutMs:z,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken})}async function k(j,$=fc){return r({type:"VOICE_TRANSPORT_CONNECTED",timeoutMs:$,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken,transportId:j})}async function M(j=fc){return r({type:"VOICE_ERROR",timeoutMs:j,guildId:o.guildId,channelId:o.channelId,sessionToken:o.sessionToken})}async function V(j,$=fc){const z=j(),G=M($).then(Z=>{throw new Error(`VOICE_ERROR: ${(Z==null?void 0:Z.error)||"UNKNOWN"}`)});return Promise.race([z,G])}async function B(j,$){await n("VOICE_CREATE_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,direction:j});const z=await S("VOICE_TRANSPORT_CREATED",G=>(G==null?void 0:G.direction)===j);if(!_($))throw new Error("VOICE_SESSION_CANCELLED");return j==="send"?o.device.createSendTransport(z.transport):o.device.createRecvTransport(z.transport)}async function v(j,$,z){if(!j||!o.recvTransport||!o.device||!_(z)||o.consumersByProducerId.has(j))return;await n("VOICE_CONSUME",{guildId:o.guildId,channelId:o.channelId,transportId:o.recvTransport.id,producerId:j,rtpCapabilities:o.device.rtpCapabilities});const G=await V(()=>S("VOICE_CONSUMED",H=>(H==null?void 0:H.producerId)===j));if(!_(z))return;const Z=await o.recvTransport.consume(G),ae=new MediaStream([Z.track]),L=document.createElement("audio");L.autoplay=!0,L.playsInline=!0,L.preload="auto",L.muted=!1,L.srcObject=ae,L.style.display="none",document.body.appendChild(L),L.addEventListener("loadedmetadata",()=>{L.paused&&L.play().catch(()=>{m(L,j)})}),typeof L.setSinkId=="function"&&o.audioOutputDeviceId&&await L.setSinkId(o.audioOutputDeviceId).catch(()=>{}),L.volume=o.isDeafened?0:1,await L.play().catch(()=>{m(L,j)}),o.consumersByProducerId.set(j,{consumer:Z,audio:L,userId:$||""}),$&&o.producerOwnerByProducerId.set(j,$),i==null||i({producerId:j,userId:$,audio:L})}async function l({guildId:j,channelId:$,audioInputDeviceId:z,isMuted:G=!1,isDeafened:Z=!1,audioOutputDeviceId:ae=""}){await g(),o.sessionToken+=1;const L=o.sessionToken;o.guildId=j,o.channelId=$,o.isMuted=!!G,o.isDeafened=!!Z,o.audioOutputDeviceId=ae||"",await n("VOICE_JOIN",{guildId:j,channelId:$});const H=await r({type:"VOICE_JOINED",match:X=>(X==null?void 0:X.guildId)===j&&(X==null?void 0:X.channelId)===$,timeoutMs:12e3,guildId:j,channelId:$,sessionToken:L});if(!_(L))throw new Error("VOICE_SESSION_CANCELLED");o.device=new AE.Device,await o.device.load({routerRtpCapabilities:H.rtpCapabilities}),o.sendTransport=await B("send",L),o.sendTransport.on("connect",async({dtlsParameters:X},le,$t)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,transportId:o.sendTransport.id,dtlsParameters:X}),await V(()=>k(o.sendTransport.id)),le()}catch(Ge){$t(Ge)}}),o.sendTransport.on("produce",async({kind:X,rtpParameters:le},$t,Ge)=>{try{await n("VOICE_PRODUCE",{guildId:o.guildId,channelId:o.channelId,transportId:o.sendTransport.id,kind:X,rtpParameters:le});const Jt=await V(()=>S("VOICE_PRODUCED",Ae=>(Ae==null?void 0:Ae.guildId)===o.guildId&&(Ae==null?void 0:Ae.channelId)===o.channelId&&(Ae==null?void 0:Ae.userId)===p()));$t({id:Jt.producerId})}catch(Jt){Ge(Jt)}});const J={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,...z?{deviceId:{exact:z}}:{}};o.localStream=await navigator.mediaDevices.getUserMedia({audio:J});const Q=o.localStream.getAudioTracks()[0];if(!Q)throw new Error("MIC_TRACK_NOT_FOUND");o.localProducer=await o.sendTransport.produce({track:Q}),o.isMuted&&(o.localProducer.pause(),Q.enabled=!1),o.recvTransport=await B("recv",L),o.recvTransport.on("connect",async({dtlsParameters:X},le,$t)=>{try{await n("VOICE_CONNECT_TRANSPORT",{guildId:o.guildId,channelId:o.channelId,transportId:o.recvTransport.id,dtlsParameters:X}),await V(()=>k(o.recvTransport.id)),le()}catch(Ge){$t(Ge)}});for(const X of H.producers||[])await v(X.producerId,X.userId,L)}async function u(j){const $=o.consumersByProducerId.get(j);if($){o.consumersByProducerId.delete(j),o.producerOwnerByProducerId.delete(j),f(j);try{$.consumer.close()}catch{}try{$.audio.pause(),$.audio.srcObject=null,$.audio.remove()}catch{}a==null||a({producerId:j,userId:$.userId||""})}}async function g(){var j,$,z;o.sessionToken+=1;for(const G of[...o.pendingAudioStartByProducerId.keys()])f(G);for(const G of[...o.consumersByProducerId.keys()])await u(G);try{(j=o.localProducer)==null||j.close()}catch{}o.localProducer=null,o.localStream&&(o.localStream.getTracks().forEach(G=>G.stop()),o.localStream=null);try{($=o.sendTransport)==null||$.close()}catch{}o.sendTransport=null;try{(z=o.recvTransport)==null||z.close()}catch{}o.recvTransport=null,o.device=null,o.guildId="",o.channelId=""}async function C(j,$){if(!(!o.channelId||!o.guildId)&&!($!=null&&$.guildId&&$.guildId!==o.guildId)&&!($!=null&&$.channelId&&$.channelId!==o.channelId)&&!(o.localProducer&&$.producerId===o.localProducer.id)){if(j==="VOICE_NEW_PRODUCER"&&($!=null&&$.producerId)){if($.userId&&$.userId===p())return;await v($.producerId,$.userId,o.sessionToken).catch(()=>{});return}if(j==="VOICE_PRODUCER_CLOSED"&&($!=null&&$.producerId)){await u($.producerId);return}j==="VOICE_USER_LEFT"&&($!=null&&$.userId)&&N($.userId)}}function N(j){if(!j)return;[...o.producerOwnerByProducerId.entries()].filter(([,z])=>z===j).map(([z])=>z).forEach(z=>{u(z).catch(()=>{})})}function w(j){var z,G;o.isMuted=!!j;const $=(G=(z=o.localStream)==null?void 0:z.getAudioTracks)==null?void 0:G.call(z)[0];o.localProducer&&(o.isMuted?o.localProducer.pause():o.localProducer.resume()),$&&($.enabled=!o.isMuted)}function x(j){o.isDeafened=!!j;for(const{audio:$}of o.consumersByProducerId.values())$.volume=o.isDeafened?0:1}function R(j){o.audioOutputDeviceId=j||"";for(const{audio:$}of o.consumersByProducerId.values())typeof $.setSinkId=="function"&&o.audioOutputDeviceId&&$.setSinkId(o.audioOutputDeviceId).catch(()=>{})}function D(){return o.localStream}function P(){return{guildId:o.guildId,channelId:o.channelId}}return{join:l,cleanup:g,handleGatewayDispatch:C,closeConsumersForUser:N,setMuted:w,setDeafened:x,setAudioOutputDevice:R,getLocalStream:D,getContext:P}}function FE({downloadMenuRef:e,downloadsMenuOpen:t,setDownloadsMenuOpen:n,downloadTargets:r,preferredDownloadTarget:i,onOpenClient:a}){var o;return c.jsxs("div",{className:"landing-page",children:[c.jsxs("header",{className:"landing-header",children:[c.jsx("img",{src:"logo.png",alt:"OpenCom",className:"landing-logo"}),c.jsx("span",{className:"landing-brand",children:"OpenCom"})]}),c.jsxs("main",{className:"landing-main",children:[c.jsxs("section",{className:"landing-hero",children:[c.jsx("h1",{className:"landing-headline",children:"The best way to communicate."}),c.jsx("p",{className:"landing-sub",children:"One place for your servers, friends, and communities. Chat, voice, and stay in sync without the noise."})]}),c.jsxs("section",{className:"landing-features",children:[c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Servers and channels"}),c.jsx("p",{children:"Organize conversations by topic. Create spaces that scale from a few friends to large communities."})]}),c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Friends and DMs"}),c.jsx("p",{children:"Add friends, send direct messages, and see who is online. Simple and private."})]}),c.jsxs("div",{className:"landing-feature",children:[c.jsx("span",{className:"landing-feature-icon",children:""}),c.jsx("h3",{children:"Voice and presence"}),c.jsx("p",{children:"Jump into voice channels when you need to talk. Status and presence keep everyone in the loop."})]})]}),c.jsxs("section",{className:"landing-cta",children:[c.jsxs("div",{className:"landing-cta-download",ref:e,children:[c.jsx("h3",{children:"Get the desktop app"}),c.jsx("p",{className:"landing-hint",children:"Windows and Linux builds are available."}),c.jsxs("div",{className:"download-wrapper",children:[c.jsx("a",{href:(i==null?void 0:i.href)||((o=r[0])==null?void 0:o.href)||"#",className:"landing-btn landing-btn-secondary",target:"_blank",rel:"noopener noreferrer",children:i?`Download ${i.label}`:"Download"}),c.jsx("button",{type:"button",className:"landing-btn landing-btn-secondary",onClick:()=>n(f=>!f),children:"All downloads"}),t&&c.jsx("div",{className:"download-menu",children:r.map(f=>c.jsx("a",{href:f.href,className:"download-item",target:"_blank",rel:"noopener noreferrer",children:f.label},f.href))})]})]}),c.jsxs("div",{className:"landing-cta-client",children:[c.jsx("h3",{children:"Use OpenCom now"}),c.jsx("p",{className:"landing-hint",children:"Open the client in your browser. No install required."}),c.jsx("button",{type:"button",className:"landing-btn landing-btn-primary",onClick:a,children:"Open client"})]})]})]}),c.jsx("footer",{className:"landing-footer",children:c.jsx("p",{children:"OpenCom. One place for teams, communities, and friends."})})]})}function UE({authMode:e,setAuthMode:t,email:n,setEmail:r,username:i,setUsername:a,password:o,setPassword:f,pendingVerificationEmail:m,status:_,onSubmit:p,onResendVerification:S,onBackHome:k}){return c.jsx("div",{className:"auth-shell",children:c.jsxs("div",{className:"auth-card",children:[c.jsx("button",{type:"button",className:"link-btn auth-back",onClick:k,children:"Back to home"}),c.jsx("h1",{children:"Welcome back"}),c.jsx("p",{className:"sub",children:"OpenCom keeps your teams, communities, and updates in one place."}),c.jsxs("form",{onSubmit:p,children:[c.jsxs("label",{children:["Email",c.jsx("input",{value:n,onChange:M=>r(M.target.value),type:"email",required:!0})]}),e==="register"&&c.jsxs("label",{children:["Username",c.jsx("input",{value:i,onChange:M=>a(M.target.value),required:!0})]}),c.jsxs("label",{children:["Password",c.jsx("input",{value:o,onChange:M=>f(M.target.value),type:"password",required:!0})]}),c.jsx("button",{type:"submit",children:e==="login"?"Log in":"Create account"})]}),c.jsx("button",{className:"link-btn",onClick:()=>t(e==="login"?"register":"login"),children:e==="login"?"Need an account? Register":"Have an account? Login"}),e==="login"&&c.jsx("button",{type:"button",className:"link-btn",onClick:S,children:"Resend verification email"}),m&&e==="login"&&c.jsxs("p",{className:"sub",children:["Pending verification: ",m]}),c.jsx("p",{className:"status",children:_})]})})}const zE="donskyblock/OpenCom",BE="main",pu=`https://raw.githubusercontent.com/${zE}/${BE}`.replace(/\/$/,""),up=[{href:`${pu}/frontend/OpenCom.exe`,label:"Windows (.exe)"},{href:`${pu}/frontend/OpenCom.deb`,label:"Linux (.deb)"},{href:`${pu}/frontend/OpenCom.tar.gz`,label:"Linux (.tar.gz)"}];function VE(e=up){return typeof navigator>"u"?e[0]||null:`${navigator.platform||""} ${navigator.userAgent||""}`.toLowerCase().includes("win")?e.find(n=>n.label.toLowerCase().includes("windows"))||e[0]||null:e.find(n=>n.label.toLowerCase().includes(".deb"))||e[0]||null}const Kn="/",hi="/login",ns="/app",fu=/^[a-zA-Z0-9_-]{3,32}$/;function WE(e=""){return/^\/join\/[a-zA-Z0-9_-]{3,32}\/?$/.test(e||"")}function HE(){return typeof window>"u"?!1:new URLSearchParams(window.location.search||"").get("desktop")==="1"}function wf(e=""){const t=e.replace(/\/+$/,"")||Kn;return t===hi?hi:t===ns?ns:Kn}function GE(){if(typeof window>"u")return Kn;const t=(new URLSearchParams(window.location.search||"").get("route")||"").trim();return t.startsWith("/")?t:window.location.pathname||Kn}function hc(){const e=wf(GE());return HE()&&e===Kn?ns:e}function QE(e,{replace:t=!1}={}){if(typeof window>"u")return;const n=wf(e),r=window.location.hash||"";if(window.location.protocol==="file:"){const a=new URLSearchParams(window.location.search||"");n===Kn?a.delete("route"):a.set("route",n);const o=`${window.location.pathname}${a.toString()?`?${a}`:""}${r}`;window.history[t?"replaceState":"pushState"]({},"",o);return}const i=`${n}${r}`;window.history[t?"replaceState":"pushState"]({},"",i)}function pp(e=""){const t=(e||"").trim();if(!t)return"";if(fu.test(t))return t;const n=t.match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(n!=null&&n[1])return n[1];try{const r=new URL(t),i=(r.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);if(i!=null&&i[1])return i[1];const a=r.searchParams.get("join");if(a&&fu.test(a))return a;for(const f of r.searchParams.keys())if(/^join[a-zA-Z0-9_-]{3,32}$/.test(f))return f;const o=(r.hash||"").replace(/^#/,"");if(o.startsWith("join=")){const f=decodeURIComponent(o.slice(5));if(fu.test(f))return f}}catch{return""}return""}function KE(){if(typeof window>"u")return"";const e=(window.location.pathname||"").match(/^\/join\/([a-zA-Z0-9_-]{3,32})\/?$/);return e!=null&&e[1]?e[1]:pp(window.location.href||"")}function $g(e){return typeof window>"u"?"":`${window.location.origin}/join/${encodeURIComponent(e)}`}function YE(){const e="".trim();let t="";if(typeof window<"u"){const r=new URLSearchParams(window.location.search||"");t=String(r.get("coreApi")||"").trim()}const n=t||e||"https://api.opencom.online";try{const r=new URL(n);return r.protocol!=="http:"&&r.protocol!=="https:"?"https://api.opencom.online":r.toString().replace(/\/$/,"")}catch{return"https://api.opencom.online"}}const En=YE();function Nt(e){return!e||typeof e!="string"?null:e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?`${En.replace(/\/$/,"")}${e}`:e}const Fg="opencom_custom_theme_css",Ug="opencom_custom_theme_enabled",zg="opencom_self_status",Bg="opencom_pinned_server_messages",Vg="opencom_pinned_dm_messages",hu="opencom_active_dm",Wg="opencom_gateway_device_id",Hg="opencom_mic_gain",Gg="opencom_mic_sensitivity",Qg="opencom_audio_input_device",Kg="opencom_audio_output_device",JE="opencom_server_voice_gateway_prefs",Yg="opencom_last_core_gateway",Jg="opencom_last_server_gateway",Lc="wss://ws.opencom.online/gateway",qE="opencom_debug_voice",qg="opencom_client_extensions_enabled",Xg="opencom_client_extensions_dev_mode",Zg="opencom_client_extensions_dev_urls",Oa="opencom_access_token",Aa="opencom_refresh_token",ev={smile:"",grin:"",joy:"",rofl:"",wink:"",heart:"",thumbs_up:"",fire:"",tada:"",eyes:"",thinking:"",sob:""},Xs={MANAGE_CHANNELS:1n<<2n,MANAGE_ROLES:1n<<3n,KICK_MEMBERS:1n<<4n,BAN_MEMBERS:1n<<5n,ADMINISTRATOR:1n<<60n};function XE(e){try{return typeof e=="bigint"?e:typeof e=="number"?BigInt(e):typeof e=="string"&&e.trim()?BigInt(e.trim()):0n}catch{return 0n}}function ZE(){const e="".trim()==="1",t=typeof window<"u"&&localStorage.getItem(qE)==="1";return e||t}function ek(e=""){try{const t=e.split(".");if(t.length!==3)return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=atob(n);return JSON.parse(r)}catch{return null}}async function fp(){const e=localStorage.getItem(Aa)||"";if(!e)return null;const t=await fetch(`${En}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return null;const n=await t.json().catch(()=>null),r=n==null?void 0:n.accessToken;return r?(localStorage.setItem(Oa,r),n!=null&&n.refreshToken&&localStorage.setItem(Aa,n.refreshToken),typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-access-token-refresh",{detail:{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}})),{accessToken:r,refreshToken:(n==null?void 0:n.refreshToken)||e}):null}async function tk(e,t){if(!t)return null;const n=localStorage.getItem(Oa)||"";if(!n)return null;const r=ek(t),i=(r==null?void 0:r.core_server_id)||(r==null?void 0:r.server_id);if(!i)return null;const a=await fetch(`${En}/v1/servers/${encodeURIComponent(i)}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!a.ok)return null;const o=await a.json().catch(()=>null),f=o==null?void 0:o.membershipToken;return f?(typeof window<"u"&&window.dispatchEvent(new CustomEvent("opencom-membership-token-refresh",{detail:{serverId:i,membershipToken:f}})),f):null}function nk(e,t){return Vw(e,t)}function _f(e){if(!e||typeof e!="string")return"";const t=e.trim();if(!t)return"";if(typeof window<"u"&&window.location.protocol==="file:"&&(t.startsWith("/")||!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(t)))return Lc;try{const n=new URL(t,window.location.origin);return n.protocol!=="ws:"&&n.protocol!=="wss:"&&(n.protocol=n.protocol==="http:"?"ws:":"wss:"),n.pathname="/gateway",n.search="",n.hash="",n.toString().replace(/\/$/,"")}catch{const n=t.replace(/\/$/,"");return n.endsWith("/gateway")?n:`${n}/gateway`}}function rk(){if(typeof window>"u"||window.location.protocol==="file:")return Lc;const e=window.location.hostname||"";return e==="opencom.online"||e.endsWith(".opencom.online")?Lc:_f("/gateway")}function Bw(){const e=[];return(n=>{const r=_f(n);r&&(e.includes(r)||e.push(r))})(rk()),e}function hp(){return typeof window>"u"?null:window.opencomDesktopBridge||null}async function Zs(e,t=""){const n=hp();if(n!=null&&n.prompt)try{return await n.prompt(e,t,"OpenCom")}catch{}return typeof window>"u"||typeof window.prompt!="function"?null:window.prompt(e,t)}function sk(e,t=!1){const n=[],r=a=>{const o=_f(a);o&&(n.includes(o)||n.push(o))};for(const a of Bw())r(a);return(t||"".trim()==="1")&&r(e),n}function Vw(e,t){const n=localStorage.getItem(t);if(!n)return e;const r=e.indexOf(n);return r<=0?e:[e[r],...e.slice(0,r),...e.slice(r+1)]}function ik(){const[e,t]=b.useState(localStorage.getItem(Fg)||""),[n,r]=b.useState(localStorage.getItem(Ug)!=="0");return b.useEffect(()=>{let i=document.getElementById("opencom-theme-style");i||(i=document.createElement("style"),i.id="opencom-theme-style",document.head.appendChild(i)),i.textContent=n?e:"",localStorage.setItem(Fg,e),localStorage.setItem(Ug,n?"1":"0")},[e,n]),[e,t,n,r]}function tv(e=[],t,n,r=null,i=null){const a=[];for(const o of e){const f=t(o),m=r?r(o):f,_=i?i(o):null,p=n(o),S=p?new Date(p):null,k=S&&!Number.isNaN(S.getTime())?S.getTime():null,M=a[a.length-1];if(M&&M.authorId===m&&k!==null&&M.lastMessageMs!==null&&k-M.lastMessageMs<=12e4){M.messages.push(o),M.lastMessageMs=k;continue}a.push({id:o.id,author:f,authorId:m,pfpUrl:_,firstMessageTime:p,lastMessageMs:k,messages:[o]})}return a}async function re(e,t={}){const n=t.__retried===!0,r={...t};delete r.__retried;const i=await fetch(`${En}${e}`,{headers:{"Content-Type":"application/json",...r.headers||{}},...r});if(!i.ok){if(i.status===401&&!n&&e!=="/v1/auth/refresh"){const f=await fp().catch(()=>null);if(f!=null&&f.accessToken){const m={...r.headers||{},Authorization:`Bearer ${f.accessToken}`};return re(e,{...r,headers:m,__retried:!0})}}const a=await i.json().catch(()=>({})),o=new Error(a.error||`HTTP_${i.status}`);throw o.status=i.status,o}return i.json()}async function ie(e,t,n,r={}){const i=r.__retried===!0,a={...r};delete a.__retried;const o=a.body!==void 0&&a.body!==null,f=await fetch(`${e}${t}`,{headers:{...o?{"Content-Type":"application/json"}:{},Authorization:`Bearer ${n}`,...a.headers||{}},...a});if(!f.ok){if(f.status===401&&!i){const _=await tk(e,n).catch(()=>null);if(_)return ie(e,t,_,{...a,__retried:!0})}const m=await f.json().catch(()=>({}));throw new Error(m.error||`HTTP_${f.status}`)}return f.json()}function ei(e,t){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function nv(e){const t=ei(e,[]);return Array.isArray(t)?t.filter(n=>typeof n=="string"&&n.trim()):[]}function Bn(e=""){const t=e.trim();if(!t)return"OC";const n=t.split(/\s+/).filter(Boolean);return n.length===1?n[0].slice(0,2).toUpperCase():`${n[0][0]||""}${n[1][0]||""}`.toUpperCase()}function mu(e=""){const t=e.match(/(?:^|\s)(@\{?)([^\s{}@]*)$/);if(!t)return null;const n=t[1]||"@",r=t[2]||"",i=e.length-n.length-r.length;return{query:r.toLowerCase(),start:i}}function ak(e=""){const t=e.trimStart();return t.startsWith("/")?(t.slice(1).split(/\s+/)[0]||"").toLowerCase():null}function ok(e=""){const t=[],n=/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|(\S+)/g;let r=n.exec(e);for(;r;)t.push((r[1]??r[2]??r[3]??"").replace(/\\(["'\\])/g,"$1")),r=n.exec(e);return t}function ck(e,t){if(t==="number"){const n=Number(e);if(Number.isNaN(n))throw new Error(`Invalid number: ${e}`);return n}if(t==="boolean"){const n=String(e).toLowerCase();if(["true","1","yes","on"].includes(n))return!0;if(["false","0","no","off"].includes(n))return!1;throw new Error(`Invalid boolean: ${e}`)}return e}function rv(e){if(!e)return"just now";const t=new Date(e);return Number.isNaN(t.getTime())?"just now":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function sv(e=null){var t,n,r,i,a,o,f,m;return{name:(e==null?void 0:e.name)||"",details:(e==null?void 0:e.details)||"",state:(e==null?void 0:e.state)||"",largeImageUrl:(e==null?void 0:e.largeImageUrl)||"",largeImageText:(e==null?void 0:e.largeImageText)||"",smallImageUrl:(e==null?void 0:e.smallImageUrl)||"",smallImageText:(e==null?void 0:e.smallImageText)||"",button1Label:((n=(t=e==null?void 0:e.buttons)==null?void 0:t[0])==null?void 0:n.label)||"",button1Url:((i=(r=e==null?void 0:e.buttons)==null?void 0:r[0])==null?void 0:i.url)||"",button2Label:((o=(a=e==null?void 0:e.buttons)==null?void 0:a[1])==null?void 0:o.label)||"",button2Url:((m=(f=e==null?void 0:e.buttons)==null?void 0:f[1])==null?void 0:m.url)||""}}function lk(e){const t=[];return e.button1Label.trim()&&e.button1Url.trim()&&t.push({label:e.button1Label.trim(),url:e.button1Url.trim()}),e.button2Label.trim()&&e.button2Url.trim()&&t.push({label:e.button2Label.trim(),url:e.button2Url.trim()}),{name:e.name.trim()||void 0,details:e.details.trim()||void 0,state:e.state.trim()||void 0,largeImageUrl:e.largeImageUrl.trim()||void 0,largeImageText:e.largeImageText.trim()||void 0,smallImageUrl:e.smallImageUrl.trim()||void 0,smallImageText:e.smallImageText.trim()||void 0,buttons:t.length?t:void 0}}function iv(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function av(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function dk(e=!1){if(!e)try{const t=new window.AudioContext,n=t.createOscillator(),r=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.value=523.25,r.type="sine",r.frequency.value=659.25,i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.12,t.currentTime+.04),i.gain.linearRampToValueAtTime(0,t.currentTime+.22),n.connect(i),r.connect(i),i.connect(t.destination),n.start(),r.start(),n.stop(t.currentTime+.22),r.stop(t.currentTime+.22),n.onended=()=>{r.onended=()=>t.close()}}catch{}}function uk(){var Xh,Zh,em;const e=ZE(),t=(s,d={})=>{e&&console.debug(`[voice-debug] ${s}`,d)},n=localStorage.getItem(hu)||"",[r,i]=b.useState(localStorage.getItem(Oa)||""),[a,o]=b.useState(localStorage.getItem(Aa)||""),[f,m]=b.useState("login"),[_,p]=b.useState(""),[S,k]=b.useState(""),[M,V]=b.useState(""),[B,v]=b.useState(""),[l,u]=b.useState(null),[g,C]=b.useState("servers"),[N,w]=b.useState(""),[x,R]=b.useState([]),[D,P]=b.useState([]),[j,$]=b.useState(""),[z,G]=b.useState(""),[Z,ae]=b.useState(""),[L,H]=b.useState(null),[J,Q]=b.useState([]),[X,le]=b.useState(""),[$t,Ge]=b.useState(!1),[Jt,Ae]=b.useState(""),[tr,Al]=b.useState(""),[Oi,co]=b.useState([]),[Cf,$l]=b.useState(""),[Nn,lo]=b.useState([]),[Fl,Ww]=b.useState(""),[xf,bf]=b.useState(""),[jr,Ai]=b.useState("online"),[Ft,Pn]=b.useState([]),[ye,jn]=b.useState(n),[uo,Ul]=b.useState(""),[de,$i]=b.useState(null),[Dn,nr]=b.useState({displayName:"",bio:"",pfpUrl:"",bannerUrl:""}),[Ut,ut]=b.useState({name:"",details:"",state:"",largeImageUrl:"",largeImageText:"",smallImageUrl:"",smallImageText:"",button1Label:"",button1Url:"",button2Label:"",button2Url:""}),[rr,Dr]=b.useState({name:"",logoUrl:"",bannerUrl:""}),[xs,zl]=b.useState(""),[bs,Bl]=b.useState("https://"),[Es,Fi]=b.useState(""),[Vl,Ui]=b.useState(""),[Wl,Ef]=b.useState(""),[po,Hw]=b.useState(""),[kf,Gw]=b.useState(""),[Tf,Rf]=b.useState(""),[If,Qw]=b.useState(!1),[ks,zi]=b.useState(""),[hn,fo]=b.useState(null),[Hl,Nf]=b.useState(""),[ho,Kw]=b.useState("text"),[Pf,jf]=b.useState(""),[Bi,Df]=b.useState(""),[mo,Gl]=b.useState({incoming:[],outgoing:[]}),[pk,Yw]=b.useState(!0),[Jw,qw]=b.useState({}),[Lf,go]=b.useState({guildId:"",channelId:""}),[Ql,Mf]=b.useState(!1),[Xw,Of]=b.useState(!1),[Lr,Af]=b.useState(!1),[Mr,$f]=b.useState(!1),[vo,Zw]=b.useState(Number(localStorage.getItem(Hg)||100)),[Ts,e_]=b.useState(Number(localStorage.getItem(Gg)||50)),[Ln,Ff]=b.useState(localStorage.getItem(Qg)||""),[sr,Uf]=b.useState(localStorage.getItem(Kg)||""),[t_,n_]=b.useState([]),[r_,s_]=b.useState([]),[qt,i_]=b.useState(localStorage.getItem(zg)||"online"),[zf,Bf]=b.useState(!1),[Or,Kl]=b.useState(""),[ir,Vi]=b.useState(""),[Yl,Wi]=b.useState(""),[yo,a_]=b.useState(ei(Bg,{})),[wo,o_]=b.useState(ei(Vg,{})),[Jl,Vf]=b.useState(""),[ql,c_]=b.useState(""),[Xl,l_]=b.useState(""),[Hi,Wf]=b.useState(""),[Hf,d_]=b.useState(""),[Zl,Gf]=b.useState(""),[Rs,Is]=b.useState(!1),[_o,u_]=b.useState({x:26,y:26}),[Qf,Kf]=b.useState(!1),[Gi,mn]=b.useState(!1),[Re,Qe]=b.useState("profile"),[Qi,p_]=b.useState(null),[f_,Yf]=b.useState(!1),[h_,Ar]=b.useState(!1),[Ns,So]=b.useState("create"),[zt,nt]=b.useState(null),[rt,Bt]=b.useState(null),[kt,Tt]=b.useState(null),[$r,Xt]=b.useState(null),[Fr,Zt]=b.useState(null),[Ki,ed]=b.useState(null),[Jf,m_]=b.useState({}),[ce,Ur]=b.useState(null),[zr,td]=b.useState({}),nd=b.useRef(new Set),[g_,qf,v_,y_]=ik(),[fk,w_]=b.useState([]),[hk,mk]=b.useState({current:"",new:"",confirm:""}),[__,rd]=b.useState(!1),[Xf,sd]=b.useState(""),[Co,id]=b.useState(""),[Zf,ad]=b.useState(""),[S_,gk]=b.useState([{id:"current",device:"Current Device",location:"Your Location",lastActive:"Now",status:"active"}]),[eh,vk]=b.useState({date:new Date().toISOString(),device:"Current Device",location:"Your Location"}),[C_,od]=b.useState(""),[th,x_]=b.useState(""),[nh,xo]=b.useState([]),[rh,cd]=b.useState(""),[b_,ld]=b.useState(!1),[sh,bo]=b.useState(!1),[ih,ah]=b.useState({twoFactorEnabled:!1}),[Eo,dd]=b.useState(null),[ko,ud]=b.useState(null),[To,oh]=b.useState(""),[Ro,Yi]=b.useState({}),[Ji,ch]=b.useState(hc),[E_,pd]=b.useState(!1),[yk,Io]=b.useState(!1),[qi,fd]=b.useState(null),[Br,k_]=b.useState({}),[lh,dh]=b.useState({}),[uh,T_]=b.useState(ei(JE,{})),[ph,R_]=b.useState({}),[fh,hd]=b.useState([]),[Xi,I_]=b.useState(nv(qg)),[Ps,N_]=b.useState(localStorage.getItem(Xg)==="1"),[Zi,hh]=b.useState(nv(Zg)),[mh,gh]=b.useState(""),[No,md]=b.useState({}),[Po,gd]=b.useState([]),[vh,jo]=b.useState(0),Do=b.useRef(null),yt=b.useRef(null),Vt=b.useRef(null),$e=b.useRef(null),pt=b.useRef(null),Rt=b.useRef(!1),ea=b.useRef([]),vd=b.useRef({audioCtx:null,stream:null,analyser:null,timer:null,lastSpeaking:!1}),Mn=b.useRef(new Map),yh=b.useRef("");yh.current=(l==null?void 0:l.id)||"";const en=b.useRef(null);en.current||(en.current=$E({getSelfUserId:()=>yh.current,sendDispatch:(s,d)=>Go(s,d),waitForEvent:OS,debugLog:t}));const wh=b.useRef(qt);wh.current=qt;function gn(s){var d;return s?s===(l==null?void 0:l.id)?qt:((d=Ro[s])==null?void 0:d.status)??"offline":"offline"}function P_(s){var d;return s?((d=Ro[s])==null?void 0:d.richPresence)??null:null}const j_={online:"Online",idle:"Idle",dnd:"Do Not Disturb",offline:"Offline"};function Lo(s){return j_[s]||s||"Offline"}const ta=b.useRef(null),na=b.useRef(null),js=b.useRef(null),_h=b.useRef(null),Mo=b.useRef(!0),yd=b.useRef(0),Sh=b.useRef(""),wd=b.useRef(""),_d=b.useRef({x:0,y:0}),Sd=b.useRef(null),D_=b.useMemo(()=>VE(up),[]),Ch=b.useRef(new Set),Cd=b.useRef(!1),L_=b.useRef([]),xh=b.useRef([]),Vr=(l==null?void 0:l.id)||"anonymous";function Wr(s,{replace:d=!1}={}){QE(s,{replace:d}),ch(hc())}b.useEffect(()=>{xh.current=x},[x]),b.useEffect(()=>{const s=()=>ch(hc());return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),b.useEffect(()=>{if(typeof window>"u"||window.location.protocol==="file:"||WE(window.location.pathname||""))return;const s=wf(window.location.pathname||"");s!==(window.location.pathname||"")&&Wr(s,{replace:!0})},[]),b.useEffect(()=>{r&&Ji!==ns&&Wr(ns,{replace:!0})},[r,Ji]),b.useEffect(()=>{r||Ji===ns&&Wr(hi,{replace:!0})},[r,Ji]),b.useEffect(()=>{function s(h){Sd.current&&!Sd.current.contains(h.target)&&pd(!1)}function d(h){h.key==="Escape"&&pd(!1)}return document.addEventListener("mousedown",s),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",d)}},[]),b.useEffect(()=>{localStorage.setItem(qg,JSON.stringify(Xi))},[Xi]),b.useEffect(()=>{localStorage.setItem(Xg,Ps?"1":"0")},[Ps]),b.useEffect(()=>{localStorage.setItem(Zg,JSON.stringify(Zi))},[Zi]),b.useEffect(()=>{const s=x.find(d=>d.id===j);if(!s){Dr({name:"",logoUrl:"",bannerUrl:""});return}Dr({name:s.name||"",logoUrl:s.logoUrl||"",bannerUrl:s.bannerUrl||""})},[j,x]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){hd([]);return}re("/v1/extensions/catalog",{headers:{Authorization:`Bearer ${r}`}}).then(s=>hd(s.clientExtensions||[])).catch(()=>hd([]))},[r,l==null?void 0:l.id]),b.useEffect(()=>{const s=x.find(d=>d.id===j)||null;if(!r||!s){gd([]);return}ie(s.baseUrl,"/v1/extensions/commands",s.membershipToken).then(d=>gd(Array.isArray(d.commands)?d.commands:[])).catch(()=>gd([]))},[r,j,x]),b.useEffect(()=>{if(!r||x.length===0)return;let s=!1;const d=async()=>{try{const y=xh.current||[],E=await Promise.all(y.map(async A=>{try{const U=await re(`/v1/servers/${A.id}/membership-token`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});return{id:A.id,membershipToken:U.membershipToken}}catch{return null}}));if(s)return;const T=new Map(E.filter(Boolean).map(A=>[A.id,A.membershipToken]));T.size&&R(A=>A.map(U=>{const F=T.get(U.id);return F?{...U,membershipToken:F}:U}))}catch{}};d();const h=window.setInterval(d,8*60*1e3);return()=>{s=!0,window.clearInterval(h)}},[r,x.length]),b.useEffect(()=>{if(!a)return;let s=!1;const d=async()=>{const y=await fp().catch(()=>null);s||y!=null&&y.accessToken||(w("Session expired. Please sign in again."),i(""),o(""))},h=window.setInterval(d,10*60*1e3);return()=>{s=!0,window.clearInterval(h)}},[a]),b.useEffect(()=>{jo(0)},[X,Po]);async function M_({extensionId:s,extensionName:d,devUrl:h}){if(h){const E=await fetch(h);if(!E.ok)throw new Error(`HTTP_${E.status}`);return E.text()}const y=await fetch(`${En}/v1/extensions/client/${encodeURIComponent(s)}/source`,{headers:{Authorization:`Bearer ${r}`}});if(!y.ok)throw new Error(`HTTP_${y.status}`);return y.text()}async function O_({extensionId:s,extensionName:d,devUrl:h}){const y=await M_({extensionId:s,extensionName:d,devUrl:h}),E=new Blob([y],{type:"application/javascript"}),T=URL.createObjectURL(E);try{const A=await import(T),U=(A==null?void 0:A.activateClient)||(A==null?void 0:A.default);if(typeof U!="function")throw new Error("Missing activateClient export");const F={registerPanel:W=>{L_.current.push(W)},coreApi:(W,Y={})=>re(W,{...Y,headers:{Authorization:`Bearer ${r}`,...Y.headers||{}}}),getSelf:()=>l,setStatus:w};await Promise.resolve(U(F))}finally{URL.revokeObjectURL(T)}}b.useEffect(()=>{if(!r)return;[...Xi.map(d=>({id:d,extensionId:d,extensionName:d,devUrl:null})),...Ps?Zi.map((d,h)=>({id:`dev:${d}`,extensionId:`dev-extension-${h+1}`,extensionName:`Developer Extension ${h+1}`,devUrl:d})):[]].forEach(d=>{Ch.current.has(d.id)||(Ch.current.add(d.id),md(h=>({...h,[d.id]:"loading"})),O_(d).then(()=>md(h=>({...h,[d.id]:"loaded"}))).catch(h=>md(y=>({...y,[d.id]:`error:${h.message}`}))))})},[r,Xi,Ps,Zi,l]);function A_(s,d){I_(h=>d?h.includes(s)?h:[...h,s]:h.filter(y=>y!==s))}function $_(){const s=mh.trim();s&&(hh(d=>d.includes(s)?d:[...d,s]),gh(""))}b.useEffect(()=>{if(!r)return;const s=new Set;((L==null?void 0:L.members)||[]).forEach(h=>h.id&&s.add(h.id)),J.forEach(h=>{const y=h.author_id||h.authorId;y&&s.add(y)}),l!=null&&l.id&&s.add(l.id);const d=[...s].filter(h=>!zr[h]&&!nd.current.has(h));d.length!==0&&(d.forEach(h=>nd.current.add(h)),Promise.all(d.map(h=>fetch(`${En}/v1/users/${h}/profile`,{headers:{Authorization:`Bearer ${r}`}}).then(y=>y.ok?y.json():null).catch(()=>null))).then(h=>{d.forEach(y=>nd.current.delete(y)),td(y=>{const E={...y};return d.forEach((T,A)=>{const U=h[A];U&&(U.username!=null||U.displayName!=null||U.pfpUrl!=null)&&(E[T]={username:U.username??U.displayName??T,displayName:U.displayName??U.username??T,pfpUrl:U.pfpUrl??null})}),E})}))},[r,L==null?void 0:L.members,J,l==null?void 0:l.id]),b.useEffect(()=>{!(l!=null&&l.id)||!de||td(s=>({...s,[l.id]:{username:de.username??l.username??l.id,displayName:de.displayName??de.username??l.username??l.id,pfpUrl:de.pfpUrl??null}}))},[l==null?void 0:l.id,l==null?void 0:l.username,de==null?void 0:de.username,de==null?void 0:de.displayName,de==null?void 0:de.pfpUrl]);const O=b.useMemo(()=>x.find(s=>s.id===j)||null,[x,j]),On=b.useMemo(()=>D.find(s=>s.id===z)||null,[D,z]),wt=b.useMemo(()=>{var s;return z||(On==null?void 0:On.id)||((s=L==null?void 0:L.guild)==null?void 0:s.id)||(O==null?void 0:O.defaultGuildId)||""},[z,On==null?void 0:On.id,(Xh=L==null?void 0:L.guild)==null?void 0:Xh.id,O==null?void 0:O.defaultGuildId]),_t=Lf.channelId,Fe=Lf.guildId,Hr=!!_t,Ds=(L==null?void 0:L.channels)||[],bh=b.useMemo(()=>{if(!_t)return"";const s=Ds.find(d=>d.id===_t);return(s==null?void 0:s.name)||_t},[Ds,_t]),Ls=b.useMemo(()=>Ds.find(s=>s.id===Z)||null,[Ds,Z]),Ee=b.useMemo(()=>Ft.find(s=>s.id===ye)||null,[Ft,ye]),xd=b.useMemo(()=>{var y;const s=(L==null?void 0:L.roles)||[],d=new Set(((y=L==null?void 0:L.me)==null?void 0:y.roleIds)||[]);let h=0n;for(const E of s)E&&(E.is_everyone||d.has(E.id))&&(h|=XE(E.permissions));return h},[L==null?void 0:L.roles,(Zh=L==null?void 0:L.me)==null?void 0:Zh.roleIds]),Gr=b.useMemo(()=>s=>(xd&Xs.ADMINISTRATOR)===Xs.ADMINISTRATOR?!0:(xd&s)===s,[xd]),Se=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Gr(Xs.MANAGE_CHANNELS)||Gr(Xs.MANAGE_ROLES):!1,[O,Gr]),ra=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Gr(Xs.KICK_MEMBERS):!1,[O,Gr]),ar=b.useMemo(()=>O?(O.roles||[]).includes("owner")||(O.roles||[]).includes("platform_admin")||Gr(Xs.BAN_MEMBERS):!1,[O,Gr]),bd=ra||ar,Ms=b.useMemo(()=>[...Ds||[]].filter(Boolean).sort((s,d)=>(s.position??0)-(d.position??0)),[Ds]),sa=b.useMemo(()=>Ms.filter(s=>s&&s.type==="category"),[Ms]),Eh=b.useMemo(()=>{const s=new Map;for(const d of(L==null?void 0:L.emotes)||[]){const h=String((d==null?void 0:d.name)||"").toLowerCase();h&&s.set(h,d)}return s},[L==null?void 0:L.emotes]),Oo=b.useMemo(()=>{const s=Fl.trim().toLowerCase();return s?Nn.filter(d=>d.username.toLowerCase().includes(s)||d.id.includes(s)):Nn},[Fl,Nn]),kh=b.useMemo(()=>{var h;const s=(L==null?void 0:L.members)||[];if(s.length)return s;const d=new Map;for(const y of J){const E=y.author_id||y.authorId;!E||d.has(E)||d.set(E,{id:E,username:y.username||E,status:"offline",pfp_url:y.pfp_url||null,roleIds:[]})}return l!=null&&l.id&&!d.has(l.id)&&d.set(l.id,{id:l.id,username:l.username||l.id,status:"offline",pfp_url:(de==null?void 0:de.pfpUrl)||null,roleIds:((h=L==null?void 0:L.me)==null?void 0:h.roleIds)||[]}),Array.from(d.values())},[L,J,l,de]),st=b.useMemo(()=>kh.map(s=>{var d,h,y;return{...s,username:((d=zr[s.id])==null?void 0:d.displayName)||((h=zr[s.id])==null?void 0:h.username)||s.username,pfp_url:((y=zr[s.id])==null?void 0:y.pfpUrl)??s.pfp_url}}),[kh,zr]),Ao=b.useMemo(()=>{const s=mu(X);if(!s||g!=="servers")return[];const d=["everyone",...st.map(y=>y.username||"")].map(y=>y.trim()).filter(Boolean),h=Array.from(new Set(d));return s.query?h.filter(y=>y.toLowerCase().startsWith(s.query)).slice(0,8):h.slice(0,8)},[X,g,st]),Os=b.useMemo(()=>g!=="servers"?null:ak(X),[X,g]),tn=b.useMemo(()=>{if(Os==null)return[];const s=[...Po].sort((d,h)=>d.name.localeCompare(h.name));return Os?s.filter(d=>d.name.toLowerCase().includes(Os)).slice(0,10):s.slice(0,10)},[Os,Po]),$o=Os!=null,F_=b.useMemo(()=>{const s=new Map;for(const d of st)d!=null&&d.id&&(s.set(String(d.id).toLowerCase(),d),d.username&&s.set(String(d.username).toLowerCase(),d));return s},[st]),Fo=b.useMemo(()=>new Map(st.map(s=>[s.id,s.username])),[st]),or=b.useMemo(()=>{const s=(L==null?void 0:L.voiceStates)||[];if(!z)return s;const d=Br[z]||{};if(!Object.keys(d).length)return s;const h=new Map(s.map(y=>[y.userId,y]));for(const[y,E]of Object.entries(d))E!=null&&E.channelId?h.set(y,{userId:y,channelId:E.channelId,muted:!!E.muted,deafened:!!E.deafened}):h.delete(y);return Array.from(h.values())},[L==null?void 0:L.voiceStates,Br,z]),Ed=b.useMemo(()=>{var d;if(!(l!=null&&l.id)||!Fe||!_t)return!1;const s=(d=Br[Fe])==null?void 0:d[l.id];if(s!=null&&s.channelId)return s.channelId===_t;if(z===Fe){const h=or.find(y=>y.userId===l.id);return(h==null?void 0:h.channelId)===_t}return!1},[l==null?void 0:l.id,Fe,_t,Br,z,or]),Uo=b.useMemo(()=>{var d;const s=new Map;for(const h of or)!(h!=null&&h.channelId)||!(h!=null&&h.userId)||(s.has(h.channelId)||s.set(h.channelId,[]),s.get(h.channelId).push({userId:h.userId,username:Fo.get(h.userId)||h.userId,pfp_url:((d=st.find(y=>y.id===h.userId))==null?void 0:d.pfp_url)||null,muted:!!h.muted,deafened:!!h.deafened}));return s},[or,Fo,st]),Th=b.useMemo(()=>{const s=sa.map(h=>({category:h,channels:Ms.filter(y=>y.parent_id===h.id&&y.type!=="category")})),d=Ms.filter(h=>!h.parent_id&&h.type!=="category");return[...s,...d.length?[{category:{id:"uncategorized",name:"Channels"},channels:d}]:[]]},[sa,Ms]),U_=b.useMemo(()=>tv(J,s=>{const d=s.author_id||s.authorId;return Fo.get(d)||d||"Unknown"},s=>s.created_at||s.createdAt,s=>s.author_id||s.authorId||"unknown",s=>{var h;const d=s.author_id||s.authorId;return((h=zr[d])==null?void 0:h.pfpUrl)??s.pfp_url??null}),[J,Fo,zr]),z_=b.useMemo(()=>tv((Ee==null?void 0:Ee.messages)||[],s=>s.author||"Unknown",s=>s.createdAt,s=>s.authorId||"unknown",s=>s.pfp_url||null),[Ee]),zo=b.useMemo(()=>yo[Z]||[],[yo,Z]),Bo=b.useMemo(()=>wo[ye]||[],[wo,ye]),Rh=b.useMemo(()=>{if(!j)return{mode:"core",customUrl:""};const s=uh[j]||{};return{mode:s.mode==="server"?"server":"core",customUrl:typeof s.customUrl=="string"?s.customUrl:""}},[j,uh]);async function Ih(s=r){var A;if(!s)return;const[d,h,y,E]=await Promise.all([re("/v1/social/friends",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/dms",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/requests",{headers:{Authorization:`Bearer ${s}`}}),re("/v1/social/settings",{headers:{Authorization:`Bearer ${s}`}})]);lo(d.friends||[]);let T=[];if(Pn(U=>{const F=new Map(U.map(W=>[W.id,W]));return T=(h.dms||[]).map(W=>{var Y;return{...W,messages:((Y=F.get(W.id))==null?void 0:Y.messages)||[]}}),T}),!T.some(U=>U.id===ye)){const U=T.find(W=>W.messages&&W.messages.length>0),F=(U==null?void 0:U.id)||((A=T[0])==null?void 0:A.id)||"";F&&(jn(F),localStorage.setItem(hu,F))}Gl({incoming:y.incoming||[],outgoing:y.outgoing||[]}),Yw(E.allowFriendRequests!==!1)}b.useEffect(()=>{r?localStorage.setItem(Oa,r):localStorage.removeItem(Oa)},[r]),b.useEffect(()=>{let s=!1;const d=hp();if(!(d!=null&&d.getSession)){Cd.current=!0;return}return d.getSession().then(h=>{if(s||!h)return;const y=typeof h.accessToken=="string"?h.accessToken:"",E=typeof h.refreshToken=="string"?h.refreshToken:"";y&&!r&&i(y),E&&!a&&o(E)}).catch(()=>{}).finally(()=>{Cd.current=!0}),()=>{s=!0}},[]),b.useEffect(()=>{var s,d;try{(d=(s=window.opencomDesktopBridge)==null?void 0:s.setPresenceAuth)==null||d.call(s,{accessToken:r||"",coreApi:En})}catch{}},[r]),b.useEffect(()=>{r||!a||fp().then(s=>{s!=null&&s.accessToken&&(i(s.accessToken),s.refreshToken&&o(s.refreshToken))}).catch(()=>{})},[r,a]);const Nh=b.useMemo(()=>{var s;return JSON.stringify((l!=null&&l.id?(s=Ro[l.id])==null?void 0:s.richPresence:null)||null)},[l==null?void 0:l.id,Ro]);b.useEffect(()=>{if(!(l!=null&&l.id))return;let s=null;try{s=JSON.parse(Nh)}catch{}ut(sv(s))},[l==null?void 0:l.id,Nh]),b.useEffect(()=>{a?localStorage.setItem(Aa,a):localStorage.removeItem(Aa)},[a]),b.useEffect(()=>{const s=hp();s!=null&&s.setSession&&Cd.current&&s.setSession({accessToken:r||"",refreshToken:a||""}).catch(()=>{})},[r,a]),b.useEffect(()=>{const s=h=>{var T,A;const y=((T=h==null?void 0:h.detail)==null?void 0:T.accessToken)||"",E=((A=h==null?void 0:h.detail)==null?void 0:A.refreshToken)||"";y&&i(y),E&&o(E)},d=h=>{var T,A;const y=(T=h==null?void 0:h.detail)==null?void 0:T.serverId,E=(A=h==null?void 0:h.detail)==null?void 0:A.membershipToken;!y||!E||R(U=>U.map(F=>F.id===y?{...F,membershipToken:E}:F))};return window.addEventListener("opencom-access-token-refresh",s),window.addEventListener("opencom-membership-token-refresh",d),()=>{window.removeEventListener("opencom-access-token-refresh",s),window.removeEventListener("opencom-membership-token-refresh",d)}},[]),b.useEffect(()=>{var h;if(r)return;const s=ei(`opencom_friends_${Vr}`,[]),d=ei(`opencom_dms_${Vr}`,[]);lo(s),Pn(d),d.some(y=>y.id===ye)||jn(((h=d[0])==null?void 0:h.id)||"")},[Vr,r]),b.useEffect(()=>{localStorage.setItem(`opencom_friends_${Vr}`,JSON.stringify(Nn))},[Nn,Vr]),b.useEffect(()=>{localStorage.setItem(`opencom_dms_${Vr}`,JSON.stringify(Ft))},[Ft,Vr]),b.useEffect(()=>{if(!N)return;const s=window.setTimeout(()=>w(""),4500);return()=>window.clearTimeout(s)},[N]),b.useEffect(()=>{localStorage.setItem(zg,qt)},[qt]),b.useEffect(()=>{localStorage.setItem(Bg,JSON.stringify(yo))},[yo]),b.useEffect(()=>{localStorage.setItem(Vg,JSON.stringify(wo))},[wo]),b.useEffect(()=>{ye&&localStorage.setItem(hu,ye)},[ye]),b.useEffect(()=>{if(!Qf)return;const s=h=>{const y=Math.max(8,Math.min(window.innerWidth-340,h.clientX-_d.current.x)),E=Math.max(8,Math.min(window.innerHeight-280,h.clientY-_d.current.y));u_({x:y,y:E})},d=()=>Kf(!1);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",d)}},[Qf]),b.useEffect(()=>{const s=()=>{nt(null),Bt(null),Tt(null),Xt(null),Zt(null),Gi||Ur(null)},d=h=>{h.key==="Escape"&&(nt(null),Bt(null),Tt(null),Xt(null),Zt(null),Ur(null),mn(!1))};return window.addEventListener("click",s),window.addEventListener("keydown",d),()=>{window.removeEventListener("click",s),window.removeEventListener("keydown",d)}},[Gi]),b.useEffect(()=>{!Do.current||g!=="servers"||Do.current.scrollTo({top:Do.current.scrollHeight,behavior:"smooth"})},[J,g]),b.useEffect(()=>{var T,A;if(!ta.current||g!=="dms")return;const s=ta.current;if(ye!==Sh.current){Sh.current=ye,yd.current=((T=Ee==null?void 0:Ee.messages)==null?void 0:T.length)||0,s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Mo.current=!0;return}const h=s.scrollHeight-s.scrollTop-s.clientHeight<100,y=((A=Ee==null?void 0:Ee.messages)==null?void 0:A.length)||0,E=y>yd.current;E&&h?(s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),Mo.current=!0):E&&(Mo.current=!1),yd.current=y},[Ee==null?void 0:Ee.messages,ye,g]),b.useEffect(()=>{if(!ta.current||g!=="dms")return;const s=ta.current,d=()=>{const h=s.scrollHeight-s.scrollTop-s.clientHeight<100;Mo.current=h};return s.addEventListener("scroll",d),()=>s.removeEventListener("scroll",d)},[g,ye]),b.useEffect(()=>{if(!r)return;async function s(){try{const d=await re("/v1/me",{headers:{Authorization:`Bearer ${r}`}});u(d);const[h,y]=await Promise.all([re(`/v1/users/${d.id}/profile`,{headers:{Authorization:`Bearer ${r}`}}),re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})]),E=y.servers||[];$i(h),nr({displayName:h.displayName||"",bio:h.bio||"",pfpUrl:h.pfpUrl||"",bannerUrl:h.bannerUrl||""}),R(E);try{await Ih(r)}catch{}if(!E.length){$(""),G(""),H(null),Q([]);return}E.some(T=>T.id===j)||$(E[0].id)}catch(d){const h=String((d==null?void 0:d.message)||"");if(h.includes("UNAUTHORIZED")||h.includes("HTTP_401")||h.includes("INVALID_REFRESH")||h.includes("REFRESH_")){i(""),o(""),R([]),H(null),Q([]),w("Session expired. Please sign in again.");return}w(`Session error: ${d.message}`)}}s()},[r]),b.useEffect(()=>{if(!r||!(l!=null&&l.id)){Io(!1),yt.current&&(yt.current.close(),yt.current=null),Vt.current&&(clearInterval(Vt.current),Vt.current=null);return}let s=localStorage.getItem(Wg);s||(s="web-"+Math.random().toString(36).slice(2)+"-"+Date.now(),localStorage.setItem(Wg,s));let d=!1,h=!1,y=!1,E=null,T=0,A=0;const U=Vw(Bw(),Yg),F=()=>{if(d)return;const Y=Math.min(5e3,300*2**Math.min(A,4));A+=1,E=setTimeout(W,Y)},W=()=>{if(d||h||!U.length)return;const Y=U[T%U.length];T+=1;const q=new WebSocket(Y);yt.current=q,q.onopen=()=>{q.send(JSON.stringify({op:"IDENTIFY",d:{accessToken:r,deviceId:s}}))},q.onmessage=se=>{var fe,te,pe,he,je,An,Us,zs;try{const ke=JSON.parse(se.data);if(ke.op==="HELLO"&&((fe=ke.d)!=null&&fe.heartbeat_interval)&&(Vt.current&&clearInterval(Vt.current),Vt.current=setInterval(()=>{var vn;((vn=yt.current)==null?void 0:vn.readyState)===WebSocket.OPEN&&yt.current.send(JSON.stringify({op:"HEARTBEAT"}))},ke.d.heartbeat_interval)),ke.op==="READY"&&(h=!0,y=!0,A=0,Io(!0),localStorage.setItem(Yg,Y),w(""),((te=yt.current)==null?void 0:te.readyState)===WebSocket.OPEN&&yt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:qt,customStatus:null}}))),ke.op==="DISPATCH"&&ke.t==="PRESENCE_UPDATE"&&((pe=ke.d)!=null&&pe.userId)&&Yi(vn=>({...vn,[ke.d.userId]:{status:ke.d.status??"offline",customStatus:ke.d.customStatus??null,richPresence:ke.d.richPresence??null}})),ke.op==="DISPATCH"&&ke.t==="SOCIAL_DM_MESSAGE_CREATE"&&((he=ke.d)!=null&&he.threadId)&&((An=(je=ke.d)==null?void 0:je.message)!=null&&An.id)){const vn=ke.d.threadId,nn=ke.d.message;Pn(Qo=>{const yn=[...Qo],ia=yn.findIndex(Qr=>Qr.id===vn),QS=(Qr=[])=>Qr.some(KS=>KS.id===nn.id);if(ia>=0){const Qr=yn[ia];return QS(Qr.messages||[])?Qo:(yn[ia]={...Qr,messages:[...Qr.messages||[],nn]},yn)}return[{id:vn,participantId:nn.authorId===(l==null?void 0:l.id)?"unknown":nn.authorId,name:nn.authorId===(l==null?void 0:l.id)?"Unknown":nn.author||"Unknown",messages:[nn]},...yn]}),nn.authorId&&nn.authorId!==(l==null?void 0:l.id)&&(dk(wh.current==="dnd"),fd({dmId:vn,at:Date.now()}))}if(ke.op==="DISPATCH"&&ke.t==="SOCIAL_DM_MESSAGE_DELETE"&&((Us=ke.d)!=null&&Us.threadId)&&((zs=ke.d)!=null&&zs.messageId)){const vn=ke.d.threadId,nn=ke.d.messageId;Pn(Qo=>Qo.map(yn=>yn.id===vn?{...yn,messages:(yn.messages||[]).filter(ia=>ia.id!==nn)}:yn))}}catch{}},q.onclose=()=>{d||(Io(!1),yt.current=null,Vt.current&&(clearInterval(Vt.current),Vt.current=null),h=!1,Nd("VOICE_GATEWAY_CLOSED"),F(),w(y?"Gateway disconnected. Reconnecting...":"Gateway websocket unavailable. Check DNS/TLS or set VITE_CORE_GATEWAY_URL."))},q.onerror=()=>{}};return W(),()=>{d=!0,E&&clearTimeout(E),Io(!1),Vt.current&&clearInterval(Vt.current),Vt.current=null,yt.current&&yt.current.close(),yt.current=null}},[r,l==null?void 0:l.id]),b.useEffect(()=>{var s;!r||!(l!=null&&l.id)||((s=yt.current)==null?void 0:s.readyState)!==WebSocket.OPEN||yt.current.send(JSON.stringify({op:"DISPATCH",t:"SET_PRESENCE",d:{status:qt,customStatus:null}}))},[qt,r,l==null?void 0:l.id]),b.useEffect(()=>{const s=O;if(!(s!=null&&s.baseUrl)||!(s!=null&&s.membershipToken)){if(ea.current=[],Rt.current=!1,pt.current&&(clearInterval(pt.current),pt.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}return}if(ph[s.id]){if(ea.current=[],Rt.current=!1,pt.current&&(clearInterval(pt.current),pt.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}return}const d=nk(sk(s.baseUrl,!0),Jg);if(ea.current=d,!d.length)return;let h=!1,y=!1,E=!1,T=null,A=0,U=0;const F=()=>{if(h)return;const Y=Math.min(5e3,300*2**Math.min(U,4));U+=1,T=setTimeout(W,Y)},W=()=>{if(h||!d.length)return;const Y=d[A%d.length];A+=1;const q=new WebSocket(Y);$e.current=q,q.onopen=()=>{w(""),q.send(JSON.stringify({op:"IDENTIFY",d:{membershipToken:s.membershipToken}}))},q.onmessage=se=>{var fe,te,pe;try{const he=JSON.parse(se.data);if(AS(he),he.op==="HELLO"&&((fe=he.d)!=null&&fe.heartbeat_interval)){pt.current&&clearInterval(pt.current),pt.current=setInterval(()=>{var je;((je=$e.current)==null?void 0:je.readyState)===WebSocket.OPEN&&$e.current.send(JSON.stringify({op:"HEARTBEAT"}))},he.d.heartbeat_interval);return}if(he.op==="READY"){y=!0,E=!0,U=0,Rt.current=!0,localStorage.setItem(Jg,Y),activeGuildIdRef.current&&q.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:activeGuildIdRef.current}})),wd.current&&q.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:wd.current}}));return}if(he.op==="ERROR"&&((te=he.d)!=null&&te.error)){if(typeof he.d.error=="string"&&he.d.error.startsWith("VOICE_UPSTREAM_UNAVAILABLE")&&(s!=null&&s.id)){R_(je=>je[s.id]?je:{...je,[s.id]:!0}),w("Realtime voice gateway unavailable for this server. Falling back to REST voice controls.");try{q.close()}catch{}return}w(`Voice gateway error: ${he.d.error}`);return}he.op==="DISPATCH"&&typeof he.t=="string"&&((pe=en.current)==null||pe.handleGatewayDispatch(he.t,he.d).catch(()=>{}))}catch{}},q.onclose=()=>{h||(Rt.current=!1,pt.current&&(clearInterval(pt.current),pt.current=null),$e.current=null,y=!1,Nd("VOICE_GATEWAY_CLOSED"),F(),w(E?"Server voice gateway disconnected. Reconnecting...":"Voice gateway unavailable. Check core gateway/proxy configuration."))},q.onerror=()=>{}};return W(),()=>{if(h=!0,T&&clearTimeout(T),Rt.current=!1,pt.current&&(clearInterval(pt.current),pt.current=null),$e.current){try{$e.current.close()}catch{}$e.current=null}}},[O==null?void 0:O.id,O==null?void 0:O.baseUrl,O==null?void 0:O.membershipToken,ph]),b.useEffect(()=>{if(!z||!Z)return;const s=$e.current;!s||s.readyState!==WebSocket.OPEN||!Rt.current||(s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_GUILD",d:{guildId:z}})),s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:Z}})))},[z,Z]),b.useEffect(()=>{var d;if(g!=="servers"||!z||!((d=L==null?void 0:L.channels)!=null&&d.length))return;const s=$e.current;if(!(!s||s.readyState!==WebSocket.OPEN||!Rt.current))for(const h of L.channels)!(h!=null&&h.id)||h.type!=="text"||s.send(JSON.stringify({op:"DISPATCH",t:"SUBSCRIBE_CHANNEL",d:{channelId:h.id}}))},[g,z,L==null?void 0:L.channels]),b.useEffect(()=>{j&&m_(s=>{if(!s[j])return s;const d={...s};return delete d[j],d})},[j]),b.useEffect(()=>{if(!r)return;const s=new Set;((L==null?void 0:L.members)||[]).forEach(y=>y.id&&s.add(y.id)),(Nn||[]).forEach(y=>y.id&&s.add(y.id));const d=[...s];if(d.length===0)return;const h=new URLSearchParams({userIds:d.join(",")});fetch(`${En}/v1/presence?${h}`,{headers:{Authorization:`Bearer ${r}`}}).then(y=>y.ok?y.json():{}).then(y=>{y&&typeof y=="object"&&Yi(E=>({...E,...y}))}).catch(()=>{})},[r,L==null?void 0:L.members,Nn]),b.useEffect(()=>{const s=KE();if(!s)return;zi(s),$l(s),Ar(!0),So("join"),Td(s),Wr(r?ns:hi,{replace:!0})},[r]),b.useEffect(()=>{if(g!=="servers"||!O){P([]),g!=="servers"&&(H(null),Q([]));return}ie(O.baseUrl,"/v1/guilds",O.membershipToken).then(s=>{const d=s||[];if(P(d),!d.length){G(""),H(null);return}d.some(y=>y.id===z)||G(d[0].id)}).catch(s=>{P([]),H(null),w(`Workspace list failed: ${s.message}`)})},[O,z,g]),b.useEffect(()=>{if(g!=="servers"||!O||!z)return;let s=!1;const d=()=>ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken).then(y=>{var U;if(s)return;const E=y.channels||[];if(H(y),E.some(F=>F.id===Z&&F.type==="text"))return;const A=((U=E.find(F=>F.type==="text"))==null?void 0:U.id)||"";ae(A)}).catch(y=>{s||(H(null),ae(""),Q([]),w(`Workspace state failed: ${y.message}`))});d();const h=window.setInterval(d,3e3);return()=>{s=!0,window.clearInterval(h)}},[O,z,g,Z]),b.useEffect(()=>{g!=="dms"||!ye||!r||re(`/v1/social/dms/${ye}/messages`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{const d=s.messages||[];Pn(h=>h.map(y=>y.id===ye?{...y,messages:d}:y))}).catch(()=>{})},[ye,g,r]),b.useEffect(()=>{if(g==="dms"){if(!Ft.length){jn("");return}(!ye||!Ft.some(s=>s.id===ye))&&jn(Ft[0].id)}},[g,Ft,ye]),b.useEffect(()=>{if(!qi)return;const s=setTimeout(()=>fd(null),4e3);return()=>clearTimeout(s)},[qi]),b.useEffect(()=>{var h,y,E;const s=Hr&&Ed&&!!Fe&&!!Rt.current&&((h=$e.current)==null?void 0:h.readyState)===WebSocket.OPEN;if(!Hr||!Ed||!Fe||Lr||Mr||!((y=navigator.mediaDevices)!=null&&y.getUserMedia)||!s){const T=vd.current;T.timer&&clearInterval(T.timer),T.timer=null,T.stream&&T.stream!==((E=en.current)==null?void 0:E.getLocalStream())&&T.stream.getTracks().forEach(A=>A.stop()),T.stream=null,T.audioCtx&&T.audioCtx.close().catch(()=>{}),T.audioCtx=null,T.analyser=null,T.lastSpeaking=!1,Fe&&(l!=null&&l.id)&&dh(A=>({...A,[Fe]:{...A[Fe]||{},[l.id]:!1}})),Hr&&Fe&&s&&Go("VOICE_SPEAKING",{guildId:Fe,channelId:_t,speaking:!1}).catch(()=>{});return}let d=!1;return(async()=>{var T;try{const A=((T=en.current)==null?void 0:T.getLocalStream())||await navigator.mediaDevices.getUserMedia({audio:Ln?{deviceId:{exact:Ln}}:!0});if(d){A.getTracks().forEach(se=>se.stop());return}const U=new window.AudioContext,F=U.createMediaStreamSource(A),W=U.createAnalyser();W.fftSize=1024,F.connect(W);const Y=vd.current;Y.stream=A,Y.audioCtx=U,Y.analyser=W,Y.lastSpeaking=!1;const q=new Uint8Array(W.fftSize);Y.timer=setInterval(()=>{var he;W.getByteTimeDomainData(q);let se=0;for(let je=0;je<q.length;je+=1){const An=(q[je]-128)/128;se+=An*An}const fe=Math.sqrt(se/q.length),te=.01+(100-Math.max(0,Math.min(100,Ts)))/100*.03,pe=fe>te;pe!==Y.lastSpeaking&&(Y.lastSpeaking=pe,Fe&&(l!=null&&l.id)&&dh(je=>({...je,[Fe]:{...je[Fe]||{},[l.id]:pe}})),Hr&&Fe&&Rt.current&&((he=$e.current)==null?void 0:he.readyState)===WebSocket.OPEN&&Go("VOICE_SPEAKING",{guildId:Fe,channelId:_t,speaking:pe}).catch(()=>{}))},150)}catch{w("Mic speaking detection unavailable. Check microphone permissions.")}})(),()=>{var A;d=!0;const T=vd.current;T.timer&&clearInterval(T.timer),T.timer=null,T.stream&&T.stream!==((A=en.current)==null?void 0:A.getLocalStream())&&T.stream.getTracks().forEach(U=>U.stop()),T.stream=null,T.audioCtx&&T.audioCtx.close().catch(()=>{}),T.audioCtx=null,T.analyser=null,T.lastSpeaking=!1}},[Hr,Ed,Fe,_t,Lr,Mr,Ts,Ln,l==null?void 0:l.id]),b.useEffect(()=>{localStorage.setItem(Hg,String(vo))},[vo]),b.useEffect(()=>{localStorage.setItem(Gg,String(Ts))},[Ts]),b.useEffect(()=>{localStorage.setItem(Qg,Ln||"")},[Ln]),b.useEffect(()=>{localStorage.setItem(Kg,sr||"")},[sr]),b.useEffect(()=>{var s;(s=en.current)==null||s.setMuted(Lr)},[Lr]),b.useEffect(()=>{var s;(s=en.current)==null||s.setDeafened(Mr)},[Mr]),b.useEffect(()=>{var s;(s=en.current)==null||s.setAudioOutputDevice(sr)},[sr]),b.useEffect(()=>{var h;if(Re!=="voice"||!Gi||!((h=navigator.mediaDevices)!=null&&h.enumerateDevices))return;let s=!1;return(async()=>{var y,E;try{try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch{}const T=await navigator.mediaDevices.enumerateDevices();if(s)return;const A=T.filter(F=>F.kind==="audioinput"),U=T.filter(F=>F.kind==="audiooutput");n_(A),s_(U),!Ln&&((y=A[0])!=null&&y.deviceId)&&Ff(A[0].deviceId),!sr&&((E=U[0])!=null&&E.deviceId)&&Uf(U[0].deviceId)}catch{s||w("Could not load audio devices. Check browser permissions.")}})(),()=>{s=!0}},[Re,Gi,Ln,sr]),b.useEffect(()=>{if(!(l!=null&&l.id))return;let s="",d="";for(const[h,y]of Object.entries(Br||{})){const E=y==null?void 0:y[l.id];if(E!=null&&E.channelId){s=h,d=E.channelId;break}}if(!d){const h=or.find(y=>y.userId===l.id);h!=null&&h.channelId&&(s=z||Fe||"",d=h.channelId)}go(h=>d?h.guildId===s&&h.channelId===d?h:{guildId:s,channelId:d}:h.guildId&&h.guildId!==z||!h.guildId&&!h.channelId?h:{guildId:"",channelId:""})},[or,Br,l==null?void 0:l.id,z,Fe]),b.useEffect(()=>{!r||g!=="friends"&&g!=="dms"||Ih(r).catch(()=>{})},[r,g]),wd.current=Z,b.useEffect(()=>{if(g!=="servers"||!O||!Z){g!=="servers"&&Q([]);return}let s=!1;const d=()=>ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken).then(y=>{s||(w(""),Q((y.messages||[]).slice().reverse()))}).catch(y=>{var E,T;if(!s){if((E=y==null?void 0:y.message)!=null&&E.startsWith("HTTP_403")){Q([]),w("You no longer have access to that channel."),ae("");return}if((T=y==null?void 0:y.message)!=null&&T.startsWith("HTTP_404")){Q([]),w("That channel no longer exists. Switching to an available channel."),ae("");return}w(`Message fetch failed: ${y.message}`)}});d();const h=window.setInterval(d,2e3);return()=>{s=!0,window.clearInterval(h)}},[O,Z,g]),b.useEffect(()=>{co([]),js.current&&(js.current.value="")},[j,Z]),b.useEffect(()=>{if(g!=="servers"||!r||!z)return;let s=!1;const d=()=>{const y=Array.from(new Set(((L==null?void 0:L.members)||[]).map(T=>T==null?void 0:T.id).filter(Boolean)));if(!y.length)return;const E=new URLSearchParams({userIds:y.join(",")});fetch(`${En}/v1/presence?${E}`,{headers:{Authorization:`Bearer ${r}`}}).then(T=>T.ok?T.json():{}).then(T=>{s||!T||typeof T!="object"||Yi(A=>({...A,...T}))}).catch(()=>{})};d();const h=window.setInterval(d,3e3);return()=>{s=!0,window.clearInterval(h)}},[g,r,z,L==null?void 0:L.members]),b.useEffect(()=>{const s=new URLSearchParams(window.location.search||""),d=s.get("verifyEmailToken");d&&(hc()===Kn&&Wr(hi,{replace:!0}),w("Verifying your email..."),re("/v1/auth/verify-email",{method:"POST",body:JSON.stringify({token:d})}).then(()=>{m("login"),w("Email verified. You can now log in.")}).catch(h=>{w(`Email verification failed: ${h.message}`)}).finally(()=>{s.delete("verifyEmailToken");const h=s.toString(),y=`${window.location.pathname}${h?`?${h}`:""}${window.location.hash||""}`;window.history.replaceState({},"",y)}))},[]);async function B_(s){s.preventDefault(),w("Authenticating...");try{if(f==="register"){await re("/v1/auth/register",{method:"POST",body:JSON.stringify({email:_,username:S,password:M})}),v(_.trim()),m("login"),V(""),w("Account created. Check your email for a verification link before logging in.");return}const d=await re("/v1/auth/login",{method:"POST",body:JSON.stringify({email:_,password:M})});i(d.accessToken),o(d.refreshToken||""),u(d.user),v(""),w("Authenticated.")}catch(d){if((d==null?void 0:d.message)==="EMAIL_NOT_VERIFIED"){v(_.trim()),w("Auth failed: EMAIL_NOT_VERIFIED. Use the resend button below if needed.");return}if((d==null?void 0:d.message)==="SMTP_NOT_CONFIGURED"){w("Auth failed: SMTP is not configured on the API server, so verification emails cannot be sent yet.");return}if((d==null?void 0:d.message)==="SMTP_AUTH_FAILED"){w("Auth failed: SMTP auth failed. Check Zoho SMTP username/app password.");return}if((d==null?void 0:d.message)==="SMTP_CONNECTION_FAILED"){w("Auth failed: SMTP connection failed. Check server network + SMTP host/port/TLS.");return}w(`Auth failed: ${d.message}`)}}async function V_(){const s=(B||_||"").trim();if(!s){w("Enter your email first, then resend verification.");return}w("Sending verification email...");try{await re("/v1/auth/resend-verification",{method:"POST",body:JSON.stringify({email:s})}),v(s),w("If the account exists and is unverified, a new verification email has been sent.")}catch(d){if((d==null?void 0:d.message)==="SMTP_NOT_CONFIGURED"){w("Resend failed: SMTP is not configured on the API server. Set SMTP_* (or Zoho SMTP envs) and restart backend.");return}if((d==null?void 0:d.message)==="SMTP_AUTH_FAILED"){w("Resend failed: SMTP auth failed. Check Zoho username and app password.");return}if((d==null?void 0:d.message)==="SMTP_CONNECTION_FAILED"){w("Resend failed: could not connect to SMTP server. Check host/port/TLS/firewall.");return}w(`Resend failed: ${d.message}`)}}async function W_(s){const h=s.trim().replace(/^\//,"").trim(),[y,...E]=h.split(/\s+/);if(!y)return!1;const T=Po.find(W=>W.name===y);if(!T)return w(`Unknown command: /${y}`),!0;const A=Array.isArray(T.options)?T.options:[],U=ok(E.join(" ")),F={};try{A.forEach((W,Y)=>{const q=U[Y];if((q==null||q==="")&&W.required)throw new Error(`Missing required option: ${W.name}`);q==null||q===""||(F[W.name]=ck(q,W.type||"string"))})}catch(W){return w(`/${y}: ${W.message}`),!0}try{le("");const W=await ie(O.baseUrl,`/v1/extensions/commands/${encodeURIComponent(y)}/execute`,O.membershipToken,{method:"POST",body:JSON.stringify({args:F})}),Y=W==null?void 0:W.result;if(Y&&typeof Y=="object"&&(Y.content||Array.isArray(Y.embeds))){await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken,{method:"POST",body:JSON.stringify({content:String(Y.content||`/${y}`),embeds:Array.isArray(Y.embeds)?Y.embeds:[]})});const q=await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken);Q((q.messages||[]).slice().reverse()),w(`Executed /${y}`)}else w(`Executed /${y}${(W==null?void 0:W.result)!=null?`  ${typeof W.result=="string"?W.result:JSON.stringify(W.result)}`:""}`)}catch(W){le(s),w(`Command failed: ${W.message}`)}return!0}async function H_(s){if(!(!O||!z||!Z||!s))try{const d=new FormData;d.append("guildId",z),d.append("channelId",Z),d.append("file",s,s.name||"upload.bin");const h=await fetch(`${O.baseUrl}/v1/attachments/upload`,{method:"POST",headers:{Authorization:`Bearer ${O.membershipToken}`},body:d});if(!h.ok){const E=await h.json().catch(()=>({}));throw new Error(E.error||`HTTP_${h.status}`)}const y=await h.json();co(E=>[...E,y]),w(`Attached ${y.fileName||"file"} (${y.tier||"default"} tier).`)}catch(d){w(`Attachment upload failed: ${d.message}`)}}async function Ph(){if(!O||!Z||!X.trim()&&Oi.length===0)return;if(X.trimStart().startsWith("/")){await W_(X);return}const s=`${Ki?`> replying to ${Ki.author}: ${Ki.content}
`:""}${X.trim()}`;try{le(""),Ge(!1),await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken,{method:"POST",body:JSON.stringify({content:s||"Attachment",attachmentIds:Oi.map(h=>h.attachmentId||h.id).filter(Boolean)})});const d=await ie(O.baseUrl,`/v1/channels/${Z}/messages`,O.membershipToken);Q((d.messages||[]).slice().reverse()),ed(null),co([]),js.current&&(js.current.value="")}catch(d){le(s),w(`Send failed: ${d.message}`)}}async function jh(){if(!Ee||!uo.trim())return;const s=uo.trim();Ul("");try{await re(`/v1/social/dms/${Ee.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({content:s})});const d=await re(`/v1/social/dms/${Ee.id}/messages`,{headers:{Authorization:`Bearer ${r}`}});Pn(h=>h.map(y=>y.id===Ee.id?{...y,messages:d.messages||[]}:y))}catch(d){Ul(s),w(`DM send failed: ${d.message}`)}}async function G_(){const s=xf.trim();if(s)try{const d=await re("/v1/social/friends",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({username:s})});if(d.friend&&d.threadId){lo(E=>[d.friend,...E.filter(T=>T.id!==d.friend.id)]);const y={id:d.threadId,participantId:d.friend.id,name:d.friend.username,messages:[]};Pn(E=>[y,...E.filter(T=>T.id!==y.id)]),jn(y.id),w(`You're now connected with ${d.friend.username}.`)}else w("Friend request sent.");const h=await re("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}});Gl({incoming:h.incoming||[],outgoing:h.outgoing||[]}),bf(""),Ai("requests")}catch(d){w(`Add friend failed: ${d.message}`)}}async function Dh(s,d){try{await re(`/v1/social/requests/${s}/${d}`,{method:"POST",headers:{Authorization:`Bearer ${r}`}});const[h,y]=await Promise.all([re("/v1/social/requests",{headers:{Authorization:`Bearer ${r}`}}),re("/v1/social/friends",{headers:{Authorization:`Bearer ${r}`}})]);Gl({incoming:h.incoming||[],outgoing:h.outgoing||[]}),lo(y.friends||[]),w(d==="accept"?"Friend request accepted.":"Friend request declined.")}catch(h){w(`Request update failed: ${h.message}`)}}async function Q_(){if(r)try{const s=await re("/v1/auth/sessions",{headers:{Authorization:`Bearer ${r}`}});w_(s.sessions||[])}catch(s){w(`Could not load sessions: ${s.message}`)}}async function Lh(){if(r){Yf(!0);try{const s=await re("/v1/billing/boost",{headers:{Authorization:`Bearer ${r}`}});p_(s)}catch(s){w(`Could not load billing status: ${s.message}`)}finally{Yf(!1)}}}async function K_(){if(r)try{const s=await re("/v1/billing/boost/checkout",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not start checkout: ${s.message}`)}}async function Y_(){if(r)try{const s=await re("/v1/billing/boost/portal",{method:"POST",headers:{Authorization:`Bearer ${r}`}});s!=null&&s.url&&(window.location.href=s.url)}catch(s){w(`Could not open billing portal: ${s.message}`)}}function J_(s=32){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let h="";for(let y=0;y<s;y++)h+=d.charAt(Math.floor(Math.random()*d.length));return h}function q_(s=8){const d=[];for(let h=0;h<s;h++){let y="";for(let E=0;E<4;E++)y+=Math.floor(Math.random()*1e4).toString().padStart(4,"0"),E<3&&(y+="-");d.push(y)}return d}function X_(){const s=J_(32),d=q_(8);od(s),xo(d),bo(!0),ld(!1),cd("");const h="OpenCom",y=(l==null?void 0:l.username)||"user",E=`otpauth://totp/${h}:${y}?secret=${s}&issuer=${h}`,T=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(E)}`;x_(T),w("2FA setup initiated. Scan the QR code with your authenticator app.")}function Z_(s,d){if(!s||!d)return!1;const h=s.replace(/\s/g,"").slice(0,6);if(!/^\d{6}$/.test(h))return!1;if(nh.includes(h))return w("Backup code verified! Removing code from backups."),xo(y=>y.filter(E=>E!==h)),!0;for(let y=-1;y<=1;y++){const E=Math.floor(Date.now()/3e4)+y;if(eS(d,E)===h)return!0}return!1}function eS(s,d){const h=tS(s),y=new ArrayBuffer(8);return new DataView(y).setBigInt64(0,BigInt(d),!1),nS(h,y)}function tS(s){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let h="";for(let E=0;E<s.length;E++){const T=d.indexOf(s[E]);T<0||(h+=T.toString(2).padStart(5,"0"))}const y=new Uint8Array(Math.floor(h.length/8));for(let E=0;E<y.length;E++)y[E]=parseInt(h.slice(E*8,(E+1)*8),2);return y}function nS(s,d){let y=new Uint8Array(64);s.length>64?(y=kd(s),y=new Uint8Array(64).map((se,fe)=>fe<y.length?y[fe]:0)):y.set(s);const E=new Uint8Array(64),T=new Uint8Array(64);for(let se=0;se<64;se++)E[se]=y[se]^92,T[se]=y[se]^54;const A=new Uint8Array(T.length+d.byteLength);A.set(T),A.set(new Uint8Array(d),T.length);const U=kd(A.buffer),F=new Uint8Array(E.length+U.length);F.set(E),F.set(U,E.length);const W=kd(F.buffer),Y=W[W.length-1]&15;return(((W[Y]&127)<<24|(W[Y+1]&255)<<16|(W[Y+2]&255)<<8|W[Y+3]&255)%1e6).toString().padStart(6,"0")}function kd(s){let d=new Uint8Array(s);const h=Array.from(d).map(U=>String.fromCharCode(U)).join(""),y=[1732584193,4023233417,2562383102,271733878,3285377520],E=h.length*8;let T=h.slice(0);for(T+="";T.length*8%512!==448;)T+="\0";for(let U=7;U>=0;U--)T+=String.fromCharCode(E>>>U*8&255);for(let U=0;U<T.length;U+=64){const F=Array(80);for(let te=0;te<16;te++)F[te]=T.charCodeAt(U+te*4)<<24|T.charCodeAt(U+te*4+1)<<16|T.charCodeAt(U+te*4+2)<<8|T.charCodeAt(U+te*4+3);for(let te=16;te<80;te++)F[te]=(F[te-3]^F[te-8]^F[te-14]^F[te-16])<<1|(F[te-3]^F[te-8]^F[te-14]^F[te-16])>>>31;let[W,Y,q,se,fe]=y;for(let te=0;te<80;te++){let pe,he;te<20?(pe=Y&q|~Y&se,he=1518500249):te<40?(pe=Y^q^se,he=1859775393):te<60?(pe=Y&q|Y&se|q&se,he=2400959708):(pe=Y^q^se,he=3395469782);const je=(W<<5|W>>>27)+pe+fe+he+F[te]>>>0;fe=se,se=q,q=Y<<30|Y>>>2,Y=W,W=je}y[0]=y[0]+W>>>0,y[1]=y[1]+Y>>>0,y[2]=y[2]+q>>>0,y[3]=y[3]+se>>>0,y[4]=y[4]+fe>>>0}const A=new Uint8Array(20);for(let U=0;U<5;U++)A[U*4]=y[U]>>>24&255,A[U*4+1]=y[U]>>>16&255,A[U*4+2]=y[U]>>>8&255,A[U*4+3]=y[U]&255;return A}function rS(){if(!Z_(rh,C_)){w("Invalid token. Please check your authenticator app.");return}ah(s=>({...s,twoFactorEnabled:!0})),ld(!0),w("2FA enabled successfully! Your backup codes have been saved."),bo(!1)}function sS(){window.confirm("Are you sure? You will lose 2FA protection.")&&(ah(s=>({...s,twoFactorEnabled:!1})),od(""),xo([]),ld(!1),bo(!1),w("2FA has been disabled."))}async function Vo(s){const d=Ft.find(h=>h.participantId===s.id||h.name===s.username);if(d){jn(d.id),C("dms");return}try{const y=(await re("/v1/social/dms/open",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({friendId:s.id})})).threadId;Pn(E=>E.find(A=>A.id===y)?E:[{id:y,participantId:s.id,name:s.username,messages:[]},...E]),jn(y),C("dms")}catch(h){w(`Open DM failed: ${h.message}`)}}async function iS(){try{if(await re("/v1/me/profile",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({displayName:Dn.displayName||null,bio:Dn.bio||null,pfpUrl:Dn.pfpUrl||null,bannerUrl:Dn.bannerUrl||null})}),l!=null&&l.id){const s=await re(`/v1/users/${l.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});$i(s),nr({displayName:s.displayName??"",bio:s.bio??"",pfpUrl:s.pfpUrl??"",bannerUrl:s.bannerUrl??""})}else $i(s=>({...s,...Dn}));w("Profile updated.")}catch(s){const d=(s==null?void 0:s.message)||"";d.includes("INVALID_IMAGE")?w("Invalid image. Use PNG, JPG, GIF, or WebP under 4MB."):w(`Profile update failed: ${d}`)}}async function aS(){if(!r)return;const s=lk(Ut);if(!s.name&&!s.details&&!s.state&&!s.largeImageUrl&&!s.smallImageUrl&&!s.buttons){w("Add at least one rich presence field before saving.");return}try{await re("/v1/presence/rpc",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({activity:s})}),l!=null&&l.id&&Yi(d=>{var h,y;return{...d,[l.id]:{...d[l.id]||{},status:((h=d[l.id])==null?void 0:h.status)||qt,customStatus:((y=d[l.id])==null?void 0:y.customStatus)??null,richPresence:s}}}),w("Rich presence updated.")}catch(d){w(`Rich presence update failed: ${d.message}`)}}async function oS(){if(r)try{await re("/v1/presence/rpc",{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),l!=null&&l.id&&Yi(s=>{var d,h;return{...s,[l.id]:{...s[l.id]||{},status:((d=s[l.id])==null?void 0:d.status)||qt,customStatus:((h=s[l.id])==null?void 0:h.customStatus)??null,richPresence:null}}}),ut(sv(null)),w("Rich presence cleared.")}catch(s){w(`Clear rich presence failed: ${s.message}`)}}async function cS(){var s,d,h;if(!(!O||!Se))try{await re(`/v1/servers/${O.id}/profile`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:((s=rr.name)==null?void 0:s.trim())||void 0,logoUrl:(d=rr.logoUrl)!=null&&d.trim()?rr.logoUrl.trim():null,bannerUrl:(h=rr.bannerUrl)!=null&&h.trim()?rr.bannerUrl.trim():null})});const E=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(E),w("Server profile updated.")}catch(y){w(`Server profile update failed: ${y.message}`)}}async function Mh(){if(!(!xs.trim()||!bs.trim()||!Es.trim()))try{await re("/v1/servers",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:xs.trim(),baseUrl:bs.trim(),logoUrl:Es.trim(),bannerUrl:Vl.trim()||null})}),zl(""),Bl("https://"),Fi(""),Ui(""),w("Server provider added.");const s=await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}});R(s.servers||[]),Ar(!1)}catch(s){w(`Add server failed: ${s.message}`)}}function Oh(s){j&&T_(d=>{const y={...d[j]||{mode:"core",customUrl:""},...s};return{...d,[j]:y}})}async function lS(){if(!(O!=null&&O.baseUrl)||!(O!=null&&O.membershipToken)||!(Bi!=null&&Bi.trim())){w("Select a server and enter a workspace name.");return}try{const s=await ie(O.baseUrl,"/v1/guilds",O.membershipToken,{method:"POST",body:JSON.stringify({name:Bi.trim(),createDefaultVoice:!0})});Df(""),w("Workspace created.");const d=await ie(O.baseUrl,"/v1/guilds",O.membershipToken),h=Array.isArray(d)?d:[];P(h),s!=null&&s.guildId&&h.length&&G(s.guildId)}catch(s){w(`Create workspace failed: ${s.message}`)}}async function dS(){if(Wl)try{const s={serverId:Wl,code:Tf.trim()||void 0,permanent:If},d=await re("/v1/invites",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify(s)});Hw(d.code),Gw(d.joinUrl||""),Rf(""),w("Invite code generated.")}catch(s){w(`Invite failed: ${s.message}`)}}async function Td(s=null){const d=pp(s??ks??"");if(!d){fo(null),w("Invalid invite code/link.");return}try{const h=await re(`/v1/invites/${d}`);fo(h),zi(d),$l(d),w("Invite preview loaded.")}catch(h){fo(null),w(`Invite lookup failed: ${h.message}`)}}async function Ah(s=null){const d=pp(s||ks||"");if(d)try{const h=await re(`/v1/invites/${d}/join`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({accept:!0})});zi(""),fo(null),$l(""),w("Joined server from invite.");const E=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(E);const T=h==null?void 0:h.serverId;T&&E.some(A=>A.id===T)?$(T):E.length&&$(E[0].id),Ar(!1)}catch(h){w(`Join failed: ${h.message}`)}}const $h=1,Wo=2;function Fh(s=""){const d=s.split(",").map(A=>A.trim()).filter(Boolean);if(!d.length)return[];const h=((L==null?void 0:L.roles)||[]).filter(A=>!A.is_everyone),y=new Map(h.map(A=>[String(A.id).toLowerCase(),A.id])),E=new Map(h.map(A=>[String(A.name||"").toLowerCase(),A.id])),T=[];for(const A of d){const U=A.toLowerCase(),F=y.get(U)||E.get(U);F&&!T.includes(F)&&T.push(F)}return T}async function Uh(s,d=[],h=O,y=wt){if(!h||!y||!s)return;const E=((L==null?void 0:L.roles)||[]).find(T=>T.is_everyone);if(!E)throw new Error("EVERYONE_ROLE_NOT_FOUND");await ie(h.baseUrl,`/v1/channels/${s}/overwrites`,h.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:E.id,allow:"0",deny:String($h)})});for(const T of d)await ie(h.baseUrl,`/v1/channels/${s}/overwrites`,h.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:T,allow:String($h),deny:"0"})})}async function zh({server:s=O,guildId:d=wt,name:h,type:y="text",parentId:E="",privateRoleIds:T=null}){if(!s||!d||!(h!=null&&h.trim()))return null;const A={name:h.trim(),type:y};y!=="category"&&E&&(A.parentId=E);const U=await ie(s.baseUrl,`/v1/guilds/${d}/channels`,s.membershipToken,{method:"POST",body:JSON.stringify(A)}),F=U==null?void 0:U.channelId;if(F&&Array.isArray(T)&&await Uh(F,T,s,d),s.id===j&&d===wt){const W=await ie(s.baseUrl,`/v1/guilds/${d}/state`,s.membershipToken);H(W)}return F}async function As({server:s=O,guildId:d=wt,fixedType:h="",fixedParentId:y=""}={}){if(!s||!d){w("No active guild selected yet. Open a channel first, then try again.");return}const E=h||(await Zs("Channel type: text, voice, or category","text")||"").trim().toLowerCase();if(!["text","voice","category"].includes(E)){w("Invalid channel type.");return}const T=E==="category"?"New Category":`new-${E}`,A=(await Zs(`Name for the new ${E}:`,T)||"").trim();if(!A)return;let U=y||"";if(E!=="category"&&!y){const W=(await Zs("Optional category name/ID (leave blank for none):","")||"").trim();if(W){const Y=(sa||[]).find(q=>q.id===W||String(q.name||"").toLowerCase()===W.toLowerCase());if(!Y){w("Category not found.");return}U=Y.id}}let F=null;if(E==="category"&&window.confirm("Make this category private?")){const Y=((L==null?void 0:L.roles)||[]).filter(se=>!se.is_everyone).map(se=>se.name).join(", "),q=await Zs(`Allowed roles (comma-separated names or IDs).
Available: ${Y}`,"")||"";F=Fh(q)}try{await zh({server:s,guildId:d,name:A,type:E,parentId:U,privateRoleIds:F}),w(`${E==="category"?"Category":"Channel"} created.`)}catch(W){w(`Create channel failed: ${W.message}`)}}async function uS(){if(!(!O||!wt||!Hl.trim()))try{await zh({server:O,guildId:wt,name:Hl,type:ho,parentId:ho!=="category"?Pf:""}),Nf(""),jf(""),w("Channel created.")}catch(s){w(`Create channel failed: ${s.message}`)}}async function pS(){if(!(!O||!z||!Jt.trim()||!tr.trim()))try{await ie(O.baseUrl,`/v1/guilds/${z}/emotes`,O.membershipToken,{method:"POST",body:JSON.stringify({name:Jt.trim().toLowerCase(),imageUrl:tr.trim()})}),Ae(""),Al("");const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s),w("Custom emote created.")}catch(s){w(`Create emote failed: ${s.message}`)}}async function fS(s){if(!(!O||!z||!s))try{await ie(O.baseUrl,`/v1/guilds/${z}/emotes/${s}`,O.membershipToken,{method:"DELETE"});const d=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(d),w("Custom emote removed.")}catch(d){w(`Remove emote failed: ${d.message}`)}}async function Bh(s,d){if(!(!O||!z))try{await ie(O.baseUrl,`/v1/channels/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({position:d})});const h=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(h)}catch(h){w(`Move channel failed: ${h.message}`)}}async function hS(s,d,h){var fe;const y=h.findIndex(te=>te.id===s),E=h.findIndex(te=>te.id===d);if(y===-1||E===-1||y===E)return;const T=[...h],[A]=T.splice(y,1);T.splice(E,0,A);const U=(L==null?void 0:L.channels)||[],F=new Map;for(const te of U){const pe=te.parent_id||"__uncat__";F.has(pe)||F.set(pe,[]),F.get(pe).push(te)}const W=((fe=h[0])==null?void 0:fe.parent_id)??"__uncat__",Y=[],q=[...F.keys()].sort((te,pe)=>{const he=F.get(te),je=F.get(pe),An=Math.min(...he.map(zs=>zs.position??0)),Us=Math.min(...je.map(zs=>zs.position??0));return An-Us});for(const te of q){const pe=F.get(te),je=te===W?T:pe.sort((An,Us)=>(An.position??0)-(Us.position??0));Y.push(...je)}const se=Y.map((te,pe)=>(te.position??-1)!==pe?Bh(te.id,pe):Promise.resolve());await Promise.all(se),dd(null)}async function mS(s,d){const h=[...sa||[]],y=h.findIndex(U=>U.id===s),E=h.findIndex(U=>U.id===d);if(y===-1||E===-1||y===E)return;const T=[...h],[A]=T.splice(y,1);T.splice(E,0,A);try{await Promise.all(T.map((U,F)=>Bh(U.id,F*100))),ud(null)}catch(U){w(`Move category failed: ${U.message}`)}}async function gS(s,d,h){if(!(!O||!s||!d))try{const y=((L==null?void 0:L.roles)||[]).find(T=>T.is_everyone);if(h)y&&await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:y.id,allow:"0",deny:String(Wo)})}),await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"PUT",body:JSON.stringify({targetType:"role",targetId:d,allow:String(Wo),deny:"0"})});else{await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:d})});const T=((L==null?void 0:L.overwrites)||[]).filter(A=>A.channel_id===s&&A.target_type==="role"&&A.target_id!==d&&parseInt(A.allow,10)&Wo);y&&T.length===0&&await ie(O.baseUrl,`/v1/channels/${s}/overwrites`,O.membershipToken,{method:"DELETE",body:JSON.stringify({targetType:"role",targetId:y.id})})}const E=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(E)}catch(y){w(`Permission update failed: ${y.message}`)}}function vS(s,d){const h=((L==null?void 0:L.overwrites)||[]).find(y=>y.channel_id===s&&y.target_type==="role"&&y.target_id===d);return h?(parseInt(h.allow,10)&Wo)!==0:!1}async function yS(){if(!(!O||!z||!Jl.trim()))try{await ie(O.baseUrl,`/v1/guilds/${z}/roles`,O.membershipToken,{method:"POST",body:JSON.stringify({name:Jl.trim(),permissions:"0"})}),Vf("");const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s),w("Role created.")}catch(s){w(`Create role failed: ${s.message}`)}}async function wS(){if(!(!O||!z||!Xl||!ql))try{await ie(O.baseUrl,`/v1/guilds/${z}/members/${Xl}/roles/${ql}`,O.membershipToken,{method:"PUT",body:"{}"}),w("Role assigned.")}catch(s){w(`Assign role failed: ${s.message}`)}}async function Vh(){if(!O||!z)return;const s=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(s)}async function Rd(s){if(!O||!z||!s||!ra||Rs)return;const d=st.find(y=>y.id===s),h=(d==null?void 0:d.username)||s;if(window.confirm(`Kick ${h}? They can rejoin with an invite.`)){Is(!0);try{await ie(O.baseUrl,`/v1/guilds/${z}/members/${s}/kick`,O.membershipToken,{method:"POST",body:"{}"}),await Vh(),(ce==null?void 0:ce.id)===s&&Ur(null),w(`Kicked ${h}.`)}catch(y){w(`Kick failed: ${y.message}`)}finally{Is(!1)}}}async function Id(s,d=""){if(!O||!z||!s||!ar||Rs)return;const h=st.find(E=>E.id===s),y=(h==null?void 0:h.username)||s;if(window.confirm(`Ban ${y}? This removes them and blocks rejoin until unbanned.`)){Is(!0);try{const E={};d.trim()&&(E.reason=d.trim().slice(0,256)),await ie(O.baseUrl,`/v1/guilds/${z}/members/${s}/ban`,O.membershipToken,{method:"POST",body:JSON.stringify(E)}),await Vh(),(ce==null?void 0:ce.id)===s&&Ur(null),w(`Banned ${y}.`)}catch(E){w(`Ban failed: ${E.message}`)}finally{Is(!1)}}}async function _S(s){if(!(!O||!z||!s||!ar||Rs)){Is(!0);try{await ie(O.baseUrl,`/v1/guilds/${z}/bans/${s}`,O.membershipToken,{method:"DELETE"}),w(`Unbanned ${s}.`),Gf("")}catch(d){w(`Unban failed: ${d.message}`)}finally{Is(!1)}}}async function Wh(s,{color:d,position:h}){if(!(!O||!s))try{const y={};if(d!==void 0&&(y.color=typeof d=="string"&&d.startsWith("#")?parseInt(d.slice(1),16):d),h!==void 0&&(y.position=h),Object.keys(y).length===0)return;await ie(O.baseUrl,`/v1/roles/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify(y)});const E=await ie(O.baseUrl,`/v1/guilds/${z}/state`,O.membershipToken);H(E),w("Role updated.")}catch(y){w(`Update role failed: ${y.message}`)}}function SS(s){s.preventDefault(),_d.current={x:s.clientX-_o.x,y:s.clientY-_o.y},Kf(!0)}function CS(s){qw(d=>({...d,[s]:!d[s]}))}function xS(s,d){s.preventDefault(),Bt(null),Tt(null),Xt(null),Zt(null),nt({server:d,x:s.clientX,y:s.clientY})}function bS(s,d){s.preventDefault(),nt(null),Bt(null),Tt(null),Zt(null),Xt({channel:d,x:s.clientX,y:s.clientY})}function ES(s,d){s.preventDefault(),nt(null),Bt(null),Tt(null),Xt(null),Zt({category:d,x:s.clientX,y:s.clientY})}async function kS(s,d){if(!O||!wt)return;const h=(await Zs("Channel name:",d||"")||"").trim();!h||h===d||await ie(O.baseUrl,`/v1/channels/${s}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({name:h})})}async function TS(s){if(!O||!wt||!s)return;const d=((L==null?void 0:L.roles)||[]).filter(E=>!E.is_everyone).map(E=>E.name).join(", "),h=await Zs(`Visible to roles (comma-separated names or IDs). Leave blank to keep private for admins only.
Available: ${d}`,"");if(h==null)return;const y=Fh(h);await Uh(s,y,O,wt)}async function Ho(s){if(!(!s||!Se||!O||!wt))try{await kS(s.id,s.name),window.confirm("Configure visibility (private roles) for this channel/category?")&&await TS(s.id);const d=await ie(O.baseUrl,`/v1/guilds/${wt}/state`,O.membershipToken);H(d),w("Channel settings updated.")}catch(d){w(`Update channel failed: ${d.message}`)}finally{Xt(null),Zt(null)}}async function Hh(s){if(!s||!Se||!O||!wt)return;const d=s.type==="category"?"category":"channel";if(window.confirm(`Delete ${d} "${s.name}"?`))try{if(s.type==="category"){const y=((L==null?void 0:L.channels)||[]).filter(E=>E.parent_id===s.id);for(const E of y)await ie(O.baseUrl,`/v1/channels/${E.id}`,O.membershipToken,{method:"PATCH",body:JSON.stringify({parentId:null})})}await ie(O.baseUrl,`/v1/channels/${s.id}`,O.membershipToken,{method:"DELETE"}),Z===s.id&&ae("");const h=await ie(O.baseUrl,`/v1/guilds/${wt}/state`,O.membershipToken);H(h),w(`${d[0].toUpperCase()}${d.slice(1)} deleted.`)}catch(h){w(`Delete channel failed: ${h.message}`)}finally{Xt(null),Zt(null)}}async function RS(s){try{await navigator.clipboard.writeText(s),w("Server ID copied.")}catch{w("Could not copy server ID.")}nt(null)}function IS(s){C("servers"),$(s),nt(null)}async function Gh(s,d){const h=x.findIndex(A=>A.id===s);if(h<0)return;const y=d==="up"?h-1:h+1;if(y<0||y>=x.length)return;const E=x.slice(),[T]=E.splice(h,1);E.splice(y,0,T),R(E),nt(null);try{await re("/v1/servers/reorder",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({serverIds:E.map(A=>A.id)})}),w("Server order updated.")}catch(A){w(`Server reorder failed: ${A.message}`)}}async function NS(s){if(!(s!=null&&s.id))return;nt(null);const d=j===s.id;d&&($(""),G(""),H(null),Q([]));try{if(await re(`/v1/servers/${s.id}/leave`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),s.defaultGuildId&&s.baseUrl)try{await ie(s.baseUrl,`/v1/guilds/${s.defaultGuildId}/leave`,s.membershipToken,{method:"POST",body:"{}"})}catch{}const y=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(y),d&&y.length&&$(y[0].id),w("Left server.")}catch(h){w(`Leave failed: ${h.message}`)}}async function PS(s){if(!(!(s!=null&&s.id)||!(s.roles||[]).includes("owner"))&&window.confirm(`Delete "${s.name}"? This cannot be undone. All members will lose access.`)){nt(null);try{await re(`/v1/servers/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});const h=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(h),j===s.id&&($(h.length?h[0].id:""),G(""),H(null),Q([])),w("Server deleted.")}catch(d){w(`Delete failed: ${d.message}`)}}}async function jS(s){if(!(!O||!Z||!s)){try{await ie(O.baseUrl,`/v1/channels/${Z}/messages/${s}`,O.membershipToken,{method:"DELETE",body:"{}"}),Q(d=>d.filter(h=>h.id!==s)),w("Message deleted.")}catch(d){w(`Delete failed: ${d.message}`)}Bt(null)}}async function DS(s){if(!(!ye||!s)){try{await re(`/v1/social/dms/${ye}/messages/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),Pn(d=>d.map(h=>h.id===ye?{...h,messages:(h.messages||[]).filter(y=>y.id!==s)}:h)),w("DM message deleted.")}catch(d){w(`Delete failed: ${d.message}`)}Bt(null)}}function LS(s){if(s!=null&&s.id){if(s.kind==="server"){if(!Z)return;a_(d=>{const h=d[Z]||[],E=h.some(T=>T.id===s.id)?h.filter(T=>T.id!==s.id):[{id:s.id,author:s.author,content:s.content},...h].slice(0,50);return{...d,[Z]:E}}),w("Updated pinned messages.");return}if(s.kind==="dm"){if(!ye)return;o_(d=>{const h=d[ye]||[],E=h.some(T=>T.id===s.id)?h.filter(T=>T.id!==s.id):[{id:s.id,author:s.author,content:s.content},...h].slice(0,50);return{...d,[ye]:E}}),w("Updated pinned messages.")}}}function MS(s){return s!=null&&s.id?s.kind==="server"?zo.some(d=>d.id===s.id):s.kind==="dm"?Bo.some(d=>d.id===s.id):!1:!1}function OS({type:s,match:d=null,timeoutMs:h=1e4,guildId:y=null,channelId:E=null,sessionToken:T=null,transportId:A=null}){return new Promise((U,F)=>{const W=s,Y=Mn.current.get(W)||[],q={match:d,guildId:y,channelId:E,sessionToken:T,transportId:A,resolve:U,reject:F,timeout:setTimeout(()=>{F(new Error(`${s}_TIMEOUT`));const se=Mn.current.get(W)||[];Mn.current.set(W,se.filter(fe=>fe!==q))},h)};Y.push(q),Mn.current.set(W,Y)})}function AS(s){if((s==null?void 0:s.op)!=="DISPATCH"||typeof s.t!="string")return;const d=Mn.current.get(s.t);if(!(d!=null&&d.length))return;const h=s.d||{},y=s.t==="VOICE_TRANSPORT_CONNECTED",E=[];for(const T of d){const A=y?!T.guildId||h.guildId==null||h.guildId===T.guildId:!T.guildId||h.guildId===T.guildId,U=y?!T.channelId||h.channelId==null||h.channelId===T.channelId:!T.channelId||h.channelId===T.channelId,F=!y||!T.transportId||h.transportId===T.transportId,W=!T.match||T.match(h,s);if(A&&U&&F&&W){clearTimeout(T.timeout),T.resolve(h);continue}E.push(T)}E.length?Mn.current.set(s.t,E):Mn.current.delete(s.t)}function Nd(s="VOICE_REQUEST_CANCELLED"){for(const[d,h]of Mn.current.entries()){for(const y of h)clearTimeout(y.timeout),y.reject(new Error(s));Mn.current.delete(d)}}async function Qh(){var s;Nd("VOICE_SESSION_CLEANUP"),await((s=en.current)==null?void 0:s.cleanup())}async function $S(s=15e3){var T,A;const d=Date.now();for(;Date.now()-d<s;){const U=$e.current;if(U&&U.readyState===WebSocket.OPEN&&Rt.current)return U;await new Promise(F=>setTimeout(F,120))}const h=(T=$e.current)==null?void 0:T.readyState,y=h===WebSocket.CONNECTING?"CONNECTING":h===WebSocket.OPEN?"OPEN":h===WebSocket.CLOSING?"CLOSING":h===WebSocket.CLOSED?"CLOSED":"MISSING",E=(A=ea.current)!=null&&A.length?ea.current.join(","):"none";throw new Error(`VOICE_GATEWAY_UNAVAILABLE:ready=${Rt.current?"1":"0"},ws=${y},candidates=${E}`)}async function Go(s,d){(await $S()).send(JSON.stringify({op:"DISPATCH",t:s,d}))}function FS(){const s=$e.current,d=!!(s&&s.readyState===WebSocket.OPEN&&Rt.current);if(e){const h=s==null?void 0:s.readyState,y=h===WebSocket.CONNECTING?"CONNECTING":h===WebSocket.OPEN?"OPEN":h===WebSocket.CLOSING?"CLOSING":h===WebSocket.CLOSED?"CLOSED":"MISSING";t("canUseRealtimeVoiceGateway",{usable:d,readyState:y,gatewayReady:Rt.current,activeGuildId:z,activeChannelId:Z})}return d}async function US(s){var y;if(!(s!=null&&s.id)||!z||!(O!=null&&O.baseUrl)||!(O!=null&&O.membershipToken))return;let d=null;try{w(`Joining ${s.name}...`),await((y=en.current)==null?void 0:y.join({guildId:z,channelId:s.id,audioInputDeviceId:Ln,isMuted:Lr,isDeafened:Mr,audioOutputDeviceId:sr})),go({guildId:z,channelId:s.id}),w(`Joined ${s.name}.`);return}catch(E){d=E}if(!("".trim()==="1")){const T=`Voice connection failed: ${(d==null?void 0:d.message)||"VOICE_GATEWAY_UNAVAILABLE"}. Realtime voice gateway is required; set VITE_ENABLE_REST_VOICE_FALLBACK=1 only for diagnostics.`;w(T),window.alert(T);return}try{await ie(O.baseUrl,`/v1/channels/${s.id}/voice/join`,O.membershipToken,{method:"POST"}),go({guildId:z,channelId:s.id});const E=d!=null&&d.message?` (gateway fallback: ${d.message})`:"";w(`Joined ${s.name} (REST voice mode, no SFU playback).${E}`)}catch(E){const T=`Voice connection failed: ${E.message||"VOICE_JOIN_FAILED"}`;w(T),window.alert(T)}}async function zS(){if(Ql)return;let s=Fe,d=_t;if(!s||!d)for(const[E,T]of Object.entries(Br||{})){const A=T==null?void 0:T[l==null?void 0:l.id];if(A!=null&&A.channelId){s=E,d=A.channelId;break}}if(!d){const E=or.find(T=>T.userId===(l==null?void 0:l.id));E!=null&&E.channelId&&(s=s||z||"",d=E.channelId)}const h=x.find(E=>E.defaultGuildId===s)||O||null,y=async()=>{go({guildId:"",channelId:""}),Of(!1),Af(!1),$f(!1),l!=null&&l.id&&k_(E=>{var U;let T=!1;const A={...E};for(const F of Object.keys(A)){if(!((U=A[F])!=null&&U[l.id]))continue;const W={...A[F]};delete W[l.id],A[F]=W,T=!0}return T?A:E}),await Qh()};Mf(!0);try{if(await y(),w("Disconnected from voice."),!s||!d){if(!(h!=null&&h.baseUrl)||!(h!=null&&h.membershipToken))return;try{await ie(h.baseUrl,"/v1/me/voice-disconnect",h.membershipToken,{method:"POST"})}catch(E){const T=`Disconnected locally. Server voice leave failed: ${E.message||"VOICE_LEAVE_FAILED"}`;w(T),console.warn(T)}return}if(FS())try{await Go("VOICE_LEAVE",{guildId:s,channelId:d});return}catch{}if(!(h!=null&&h.baseUrl)||!(h!=null&&h.membershipToken))return;try{if(d){await ie(h.baseUrl,`/v1/channels/${d}/voice/leave`,h.membershipToken,{method:"POST"});return}await ie(h.baseUrl,"/v1/me/voice-disconnect",h.membershipToken,{method:"POST"})}catch(E){const T=`Disconnected locally. Server voice leave failed: ${E.message||"VOICE_LEAVE_FAILED"}`;w(T),console.warn(T)}}finally{Mf(!1)}}async function Kh(){const s=Or.trim();if(!(!s||!r||!ir.trim()))try{const d=await re("/v1/servers/official",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({name:s,logoUrl:ir.trim(),bannerUrl:Yl.trim()||null})});Kl(""),Vi(""),Wi(""),w("Your server was created.");const y=(await re("/v1/servers",{headers:{Authorization:`Bearer ${r}`}})).servers||[];R(y),d.serverId&&y.length&&($(d.serverId),C("servers")),Ar(!1)}catch(d){const h=(d==null?void 0:d.message)||"";h.includes("SERVER_LIMIT")?w("You already have a server."):h.includes("OFFICIAL_SERVER_NOT_CONFIGURED")?w("Server creation isnt set up yet. The site admin needs to set OFFICIAL_NODE_SERVER_ID on the API server (same value as NODE_SERVER_ID on the node)."):h.includes("OFFICIAL_SERVER_UNAVAILABLE")?w("Official server is unavailable. Please try again later."):w(`Failed: ${h}`)}}function Yh(s,d){s.preventDefault();const h=Math.min(s.clientX,window.innerWidth-240),y=Math.min(s.clientY,window.innerHeight-180);Xt(null),Zt(null),Tt(null),Bt({x:h,y,message:{...d,pinned:MS(d)}})}function Pd(s,d){if(!(d!=null&&d.id))return;s.preventDefault(),s.stopPropagation();const h=Math.min(s.clientX,window.innerWidth-250),y=Math.min(s.clientY,window.innerHeight-220);nt(null),Xt(null),Zt(null),Bt(null),Tt({x:h,y,member:d})}const $s=25*1024*1024;function jd(s){return s!=null&&s.type?s.type.startsWith("image/"):!1}async function Dd(s,d){if(!r)throw new Error("AUTH_REQUIRED");const h=new FormData;h.append("image",s);const y=await fetch(`${En}${d}`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:h});if(!y.ok){const E=await y.json().catch(()=>({}));throw new Error(E.error||`Upload failed: ${y.status}`)}return y.json()}async function It(s,d,h){var E;const y=(E=s.target.files)==null?void 0:E[0];if(s.target.value="",!!y){if(!jd(y)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(y.size>$s){w(`Image too large. Max ${Math.round($s/1024/1024)}MB.`);return}try{w(`Uploading ${d}...`);const T=await Dd(y,"/v1/images/upload");if(!(T!=null&&T.imageUrl))throw new Error("UPLOAD_FAILED");h(T.imageUrl),w(`${d} uploaded.`)}catch(T){w((T==null?void 0:T.message)||"Upload failed.")}}}async function BS(s){var h;const d=(h=s.target.files)==null?void 0:h[0];if(s.target.value="",!!d){if(!jd(d)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(d.size>$s){w(`Image too large. Max ${Math.round($s/1024/1024)}MB.`);return}try{w("Uploading avatar");const y=await Dd(d,"/v1/me/profile/pfp");nr(E=>({...E,pfpUrl:y.pfpUrl||""})),$i(de?{...de,pfpUrl:y.pfpUrl}:null),w("Avatar updated.")}catch(y){w(y.message||"Upload failed.")}}}async function VS(s){var h;const d=(h=s.target.files)==null?void 0:h[0];if(s.target.value="",!!d){if(!jd(d)){w("Please choose an image (PNG, JPG, GIF, WebP, etc.).");return}if(d.size>$s){w(`Image too large. Max ${Math.round($s/1024/1024)}MB.`);return}try{w("Uploading banner");const y=await Dd(d,"/v1/me/profile/banner");nr(E=>({...E,bannerUrl:y.bannerUrl||""})),$i(de?{...de,bannerUrl:y.bannerUrl}:null),w("Banner updated.")}catch(y){w(y.message||"Upload failed.")}}}async function Fs(s){try{const d=await re(`/v1/users/${s.id}/profile`,{headers:{Authorization:`Bearer ${r}`}});td(h=>{var y;return{...h,[s.id]:{username:d.username??((y=h[s.id])==null?void 0:y.username)??s.username,displayName:d.displayName??d.username??s.username,pfpUrl:d.pfpUrl??null}}}),Ur({...d,username:d.username||s.username,status:gn(s.id)||"offline",roleIds:s.roleIds||[]})}catch{Ur({id:s.id,username:s.username||s.id,displayName:s.username||s.id,bio:"Profile details are private or unavailable.",badges:[],badgeDetails:[],status:gn(s.id)||"offline",platformTitle:null,createdAt:null,roleIds:s.roleIds||[]})}}function WS(s){if(s&&typeof s=="object"&&(s.bgColor||s.icon||s.name))return{icon:s.icon||"",name:s.name||String(s.id||"Badge"),bgColor:s.bgColor||"#3a4f72",fgColor:s.fgColor||"#ffffff"};const d=String((s==null?void 0:s.id)||s||"").toLowerCase();return d==="platform_owner"?{icon:"",name:"Platform Owner",bgColor:"#2d6cdf",fgColor:"#ffffff"}:d==="platform_admin"?{icon:"",name:"Platform Admin",bgColor:"#2d6cdf",fgColor:"#ffffff"}:d==="boost"?{icon:"",name:"Boost",bgColor:"#4f7ecf",fgColor:"#ffffff"}:{icon:(s==null?void 0:s.icon)||"",name:(s==null?void 0:s.name)||d||"Badge",bgColor:(s==null?void 0:s.bgColor)||"#3a4f72",fgColor:(s==null?void 0:s.fgColor)||"#ffffff"}}function Jh(s){var h;const d=`:${s}:`;le(y=>{const E=y||"",T=E.length>0&&!/\s$/.test(E)?" ":"";return`${E}${T}${d} `}),Ge(!1),(h=na.current)==null||h.focus()}function HS(s){const d=(s==null?void 0:s.content)||"",h=[],y=(U,F)=>{if(!U)return;const W=/:([a-zA-Z0-9_+-]{2,32}):/g;let Y=0,q=W.exec(U),se=0;for(;q;){const fe=q.index??0;fe>Y&&(h.push(c.jsx("span",{children:U.slice(Y,fe)},`${F}-plain-${se}`)),se+=1);const te=String(q[1]||"").toLowerCase(),pe=ev[te];if(pe)h.push(c.jsx("span",{className:"message-emote",title:`:${te}:`,children:pe},`${F}-emote-${se}`));else if(Eh.has(te)){const he=Eh.get(te);h.push(c.jsx("img",{className:"message-custom-emote",src:he.imageUrl||he.image_url,alt:`:${te}:`,title:`:${te}:`},`${F}-custom-emote-${se}`))}else h.push(c.jsx("span",{children:q[0]},`${F}-raw-${se}`));se+=1,Y=fe+q[0].length,q=W.exec(U)}Y<U.length&&h.push(c.jsx("span",{children:U.slice(Y)},`${F}-tail-${se}`))},E=(U,F)=>{if(!U)return;const W=/(https?:\/\/[^\s<>"'`]+)/gi;let Y=0,q=W.exec(U),se=0;for(;q;){const fe=q.index??0;fe>Y&&(y(U.slice(Y,fe),`${F}-text-${se}`),se+=1);const te=q[1];h.push(c.jsx("a",{href:te,target:"_blank",rel:"noreferrer",children:te},`${F}-link-${se}`)),se+=1,Y=fe+te.length,q=W.exec(U)}Y<U.length&&y(U.slice(Y),`${F}-tail-${se}`)},T=/@\{([^}\n]{1,64})\}|@([a-zA-Z0-9_.-]{2,64})/g;let A=0;for(const U of d.matchAll(T)){const F=U.index??0,W=(U[1]||U[2]||"").trim(),Y=U[0],q=F>0?d[F-1]:"";if(!(!(F===0||/\s/.test(q))||!W)){if(F>A&&E(d.slice(A,F),`text-${A}`),W.toLowerCase()==="everyone")h.push(c.jsx("span",{className:"message-mention",children:Y},`everyone-${F}`));else{const fe=F_.get(W.toLowerCase());fe?h.push(c.jsxs("button",{type:"button",className:"message-mention mention-click",onClick:te=>{te.stopPropagation(),Fs(fe)},children:["@",fe.username||fe.id]},`mention-${F}`)):h.push(c.jsx("span",{className:"message-mention",children:Y},`unknown-${F}`))}A=F+Y.length}}return A<d.length&&E(d.slice(A),`tail-${A}`),h.length?h:d}function qh(s){if(!s)return null;try{const d=new Date(s);return Number.isNaN(d.getTime())?null:d.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return null}}async function GS(s){var h;const d=(h=s.target.files)==null?void 0:h[0];d&&(qf(await d.text()),w(`Theme loaded: ${d.name}`))}return r?c.jsxs("div",{className:"opencom-shell",children:[c.jsxs("aside",{className:"server-rail",children:[c.jsx("div",{className:"rail-header",title:"OpenCom",children:c.jsx("img",{src:"logo.png",alt:"OpenCom",className:"logo-img",style:{width:"100%",height:"100%",objectFit:"contain"}})}),qi&&(()=>{const s=Ft.find(d=>d.id===qi.dmId);return s?c.jsxs("button",{type:"button",className:"dm-notification-popup",onClick:()=>{C("dms"),jn(qi.dmId),fd(null)},children:[s.pfp_url?c.jsx("img",{src:Nt(s.pfp_url),alt:"",className:"dm-notification-avatar"}):c.jsx("div",{className:"dm-notification-avatar dm-notification-avatar-initials",children:Bn(s.name||s.username||"?")}),c.jsxs("span",{className:"dm-notification-text",children:["New message from ",s.name||s.username||"Someone"]})]}):null})(),c.jsx("button",{className:`server-pill nav-pill ${g==="friends"?"active":""}`,onClick:()=>C("friends"),title:"Friends",children:""}),c.jsx("button",{className:`server-pill nav-pill ${g==="dms"?"active":""}`,onClick:()=>C("dms"),title:"Direct messages",children:""}),c.jsx("button",{className:`server-pill nav-pill ${g==="profile"?"active":""}`,onClick:()=>C("profile"),title:"Profile",children:""}),c.jsxs("div",{className:"server-list",children:[x.map(s=>c.jsxs("button",{className:`server-pill ${s.id===j&&g==="servers"?"active":""}`,title:s.name,onClick:()=>{C("servers"),$(s.id),G(""),H(null),Q([])},onContextMenu:d=>xS(d,s),children:[s.logoUrl?c.jsx("img",{src:Nt(s.logoUrl),alt:s.name,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"inherit"}}):Bn(s.name),(Jf[s.id]||0)>0&&c.jsx("span",{className:"server-pill-ping-badge",children:Jf[s.id]})]},s.id)),c.jsx("button",{className:"server-pill",title:"Create or join a server",onClick:()=>Ar(!0),children:""})]})]}),c.jsxs("aside",{className:`channel-sidebar ${Hr?"voice-connected":""}`,children:[c.jsxs("header",{className:"sidebar-header",style:O!=null&&O.bannerUrl?{backgroundImage:`linear-gradient(rgba(10,16,30,0.72), rgba(10,16,30,0.86)), url(${Nt(O.bannerUrl)})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[c.jsx("h2",{children:g==="servers"?(O==null?void 0:O.name)||"No server":g.toUpperCase()}),c.jsx("small",{children:g==="servers"?(On==null?void 0:On.name)||"Choose a channel":"Unified communication hub"})]}),g==="servers"&&c.jsx(c.Fragment,{children:c.jsxs("section",{className:"sidebar-block channels-container",children:[Th.map(({category:s,channels:d})=>{const h=Jw[s.id];return c.jsxs("div",{className:"category-block",children:[c.jsxs("div",{className:"category-header-row",children:[c.jsxs("button",{className:`category-header ${ko===s.id?"channel-dragging":""}`,draggable:Se&&s.id!=="uncategorized",onDragStart:()=>Se&&s.id!=="uncategorized"&&ud(s.id),onDragOver:y=>{y.preventDefault(),s.id!=="uncategorized"&&y.currentTarget.classList.add("channel-drop-target")},onDragLeave:y=>y.currentTarget.classList.remove("channel-drop-target"),onDrop:y=>{y.preventDefault(),y.currentTarget.classList.remove("channel-drop-target"),Se&&ko&&s.id!=="uncategorized"&&ko!==s.id&&mS(ko,s.id)},onDragEnd:()=>ud(null),onClick:()=>CS(s.id),onContextMenu:y=>s.id!=="uncategorized"&&Se&&ES(y,s),children:[c.jsx("span",{className:"chevron",children:h?"":""}),s.name]}),Se&&s.id!=="uncategorized"&&c.jsxs("div",{className:"category-actions",children:[c.jsx("button",{type:"button",className:"channel-action-btn",title:"Create channel in category",onClick:y=>{y.stopPropagation(),As({fixedType:"text",fixedParentId:s.id})},children:""}),c.jsx("button",{type:"button",className:"channel-action-btn",title:"Category settings",onClick:y=>{y.stopPropagation(),Ho(s)},children:""})]})]}),!h&&c.jsx("div",{className:"category-items",children:d.map(y=>{var E,T;return c.jsxs("div",{children:[c.jsxs("div",{className:"channel-row-wrap",children:[c.jsxs("button",{className:`channel-row ${y.id===Z?"active":""} ${Eo===y.id?"channel-dragging":""}`,draggable:Se,onDragStart:()=>Se&&dd(y.id),onDragOver:A=>{A.preventDefault(),A.currentTarget.classList.add("channel-drop-target")},onDragLeave:A=>A.currentTarget.classList.remove("channel-drop-target"),onDrop:A=>{A.preventDefault(),A.currentTarget.classList.remove("channel-drop-target"),Se&&Eo&&Eo!==y.id&&hS(Eo,y.id,d)},onDragEnd:()=>dd(null),onContextMenu:A=>Se&&bS(A,y),onClick:()=>{if(y.type==="text"){ae(y.id);return}y.type==="voice"&&US(y)},children:[c.jsx("span",{className:"channel-hash",children:y.type==="voice"?"":"#"}),c.jsxs("span",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:0},children:[c.jsx("span",{children:y.name}),y.type==="voice"&&(((E=Uo.get(y.id))==null?void 0:E.length)||0)>0&&c.jsxs("span",{className:"hint",style:{fontSize:"11px"},children:[Uo.get(y.id).length," connected"]})]})]}),Se&&c.jsx("button",{type:"button",className:"channel-action-btn channel-row-cog",title:"Channel settings",onClick:A=>{A.stopPropagation(),Ho(y)},children:""})]}),y.type==="voice"&&(((T=Uo.get(y.id))==null?void 0:T.length)||0)>0&&c.jsx("div",{className:"voice-channel-members",children:Uo.get(y.id).map(A=>{var F;const U=!!((F=lh[z])!=null&&F[A.userId]);return c.jsxs("div",{className:"voice-channel-member-row",children:[c.jsx("div",{className:`avatar member-avatar vc-avatar ${U?"speaking":""}`,children:A.pfp_url?c.jsx("img",{src:Nt(A.pfp_url),alt:A.username,className:"avatar-image"}):Bn(A.username)}),c.jsx("span",{className:"voice-channel-member-name",children:A.username}),c.jsx("span",{className:"voice-channel-member-icons",children:A.deafened?"":A.muted?"":""})]},`${y.id}-${A.userId}`)})})]},y.id)})})]},s.id)}),!Th.length&&c.jsx("p",{className:"hint",children:"No channels available. Create one in Settings."})]})}),g==="dms"&&c.jsxs("section",{className:"sidebar-block channels-container",children:[Ft.map(s=>{var d;return c.jsxs("button",{className:`channel-row dm-sidebar-row ${s.id===ye?"active":""}`,onClick:()=>jn(s.id),title:`DM ${s.name}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.pfp_url?c.jsx("img",{src:Nt(s.pfp_url),alt:s.name,style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover",flexShrink:0}}):c.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`hsl(${Math.abs((s.participantId||s.id||"").charCodeAt(0)*7)%360}, 70%, 60%)`,display:"grid",placeItems:"center",fontSize:"12px",fontWeight:"bold",flexShrink:0},children:(d=s.name)==null?void 0:d.substring(0,1).toUpperCase()}),c.jsx("span",{className:"channel-hash",children:"@"}),c.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:s.name})]},s.id)}),!Ft.length&&c.jsx("p",{className:"hint",children:"Add friends to open direct message threads."})]}),g==="friends"&&c.jsxs("section",{className:"sidebar-block channels-container",children:[Nn.map(s=>{var d;return c.jsxs("button",{className:"friend-row friend-sidebar-row",onClick:()=>Vo(s),title:`Open ${s.username}`,style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.pfp_url?c.jsx("img",{src:Nt(s.pfp_url),alt:s.username,style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover",flexShrink:0}}):c.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`hsl(${Math.abs((s.id||"").charCodeAt(0)*7)%360}, 70%, 60%)`,display:"grid",placeItems:"center",fontSize:"12px",fontWeight:"bold",flexShrink:0},children:(d=s.username)==null?void 0:d.substring(0,1).toUpperCase()}),c.jsxs("div",{style:{flex:1,minWidth:0},children:[c.jsx("strong",{children:s.username}),c.jsx("span",{className:"hint",children:s.status})]})]},s.id)}),!Nn.length&&c.jsx("p",{className:"hint",children:"No friends yet. Use the Add Friend tab in the main panel."})]}),g==="profile"&&de&&c.jsx("section",{className:"sidebar-block channels-container",children:c.jsxs("div",{className:"profile-preview",style:{backgroundImage:de!=null&&de.bannerUrl?`url(${Nt(de.bannerUrl)})`:void 0},children:[c.jsx("div",{className:"avatar",children:Bn(de.displayName||de.username||"User")}),c.jsx("strong",{children:de.displayName||de.username}),c.jsxs("span",{children:["@",de.username]}),c.jsx("small",{children:de.platformTitle||"OpenCom Member"})]})}),c.jsxs("footer",{className:"self-card",children:[Hr&&c.jsxs("div",{className:"voice-widget",children:[c.jsxs("div",{className:"voice-top",children:[c.jsx("strong",{children:"Voice connected"}),c.jsx("span",{title:bh,children:bh})]}),c.jsxs("div",{className:"voice-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>Of(s=>!s),children:Xw?"Stop Share":"Share Screen"}),c.jsx("button",{className:"danger",onClick:zS,disabled:Ql,children:Ql?"Disconnecting...":"Disconnect"})]}),c.jsx("p",{className:"hint",children:"Voice controls moved to Settings  Voice."})]}),c.jsxs("div",{className:"user-row",children:[c.jsx("div",{className:"avatar",children:de!=null&&de.pfpUrl?c.jsx("img",{src:Nt(de.pfpUrl),alt:"Your avatar",className:"avatar-image"}):Bn((l==null?void 0:l.username)||"OpenCom User")}),c.jsxs("div",{className:"user-meta",children:[c.jsx("strong",{children:l==null?void 0:l.username}),c.jsx("span",{children:Se?"Owner":"Member"})]}),c.jsxs("select",{className:"status-select",value:qt,onChange:s=>i_(s.target.value),title:"Your status",children:[c.jsx("option",{value:"online",children:"Online"}),c.jsx("option",{value:"idle",children:"Idle"}),c.jsx("option",{value:"dnd",children:"Do Not Disturb"}),c.jsx("option",{value:"invisible",children:"Invisible"})]}),c.jsxs("div",{className:"user-controls",children:[c.jsx("button",{className:`icon-btn ${Lr?"danger":"ghost"}`,onClick:()=>Af(s=>!s),children:Lr?"":""}),c.jsx("button",{className:`icon-btn ${Mr?"danger":"ghost"}`,onClick:()=>$f(s=>!s),children:Mr?"":""}),c.jsx("button",{className:"icon-btn ghost",onClick:()=>{mn(!0),Qe("profile")},children:""}),c.jsx("button",{className:"icon-btn danger",onClick:()=>{Qh().catch(()=>{}),i(""),o(""),R([]),H(null),Q([])},children:""})]})]})]})]}),c.jsxs("main",{className:"chat-pane",children:[g==="servers"&&x.length===0&&c.jsxs("div",{className:"create-server-empty",style:{padding:"2rem",maxWidth:"420px",margin:"auto"},children:[c.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Create your server"}),c.jsx("p",{className:"hint",style:{marginBottom:"1rem"},children:"You get one server hosted by us. Name it and start customising channels and roles."}),c.jsx("input",{type:"text",value:Or,onChange:s=>Kl(s.target.value),placeholder:"Server name",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsx("input",{type:"text",value:ir,onChange:s=>Vi(s.target.value),placeholder:"Logo URL (.png/.jpg/.webp/.svg)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Logo",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server logo",Vi),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("input",{type:"text",value:Yl,onChange:s=>Wi(s.target.value),placeholder:"Banner URL (optional)",style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.75rem"},children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server banner",Wi),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("button",{onClick:Kh,disabled:!Or.trim()||!ir.trim(),children:"Create your server"})]}),g==="servers"&&x.length>0&&c.jsxs("div",{className:"chat-layout",children:[c.jsxs("section",{className:"chat-main",children:[c.jsxs("header",{className:"chat-header",children:[c.jsxs("h3",{children:[c.jsx("span",{className:"channel-hash",children:"#"})," ",(Ls==null?void 0:Ls.name)||"updates"]}),c.jsxs("div",{className:"chat-actions",children:[c.jsx("button",{className:"icon-btn ghost",title:"Pinned messages",onClick:()=>Bf(s=>!s),children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Threads",children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Notifications",children:""}),c.jsx("button",{className:"icon-btn ghost",title:"Members",children:""}),c.jsx("input",{className:"search-input",placeholder:`Search ${(O==null?void 0:O.name)||"server"}`}),c.jsx("button",{className:"ghost",onClick:()=>{mn(!0),Qe("server")},children:"Open settings"})]})]}),zf&&zo.length>0&&c.jsx("div",{className:"pinned-strip",children:zo.slice(0,3).map(s=>c.jsxs("div",{className:"pinned-item",children:[c.jsx("strong",{children:s.author}),c.jsx("span",{children:s.content})]},s.id))}),c.jsxs("div",{className:"messages",ref:Do,children:[(()=>{let s="";return U_.map(d=>{const h=st.find(F=>F.id===d.authorId),E=((L==null?void 0:L.roles)||[]).filter(F=>((h==null?void 0:h.roleIds)||[]).includes(F.id)).sort((F,W)=>(W.position??0)-(F.position??0))[0],T=(E==null?void 0:E.color)!=null&&E.color!==""?typeof E.color=="number"?`#${Number(E.color).toString(16).padStart(6,"0")}`:E.color:null,A=iv(d.firstMessageTime),U=!!A&&A!==s;return A&&(s=A),c.jsxs("div",{children:[U&&c.jsx("div",{className:"message-date-divider",children:c.jsx("span",{children:av(d.firstMessageTime)})}),c.jsxs("article",{className:"msg grouped-msg",children:[c.jsx("div",{className:"msg-avatar",children:d.pfpUrl?c.jsx("img",{src:Nt(d.pfpUrl),alt:d.author}):Bn(d.author||"User")}),c.jsxs("div",{className:"msg-body",children:[c.jsxs("strong",{className:"msg-author",children:[c.jsx("button",{className:"name-btn",style:T?{color:T}:void 0,onClick:()=>Fs({id:d.authorId,username:d.author,status:gn(d.authorId),pfp_url:d.pfpUrl}),onContextMenu:F=>Pd(F,{id:d.authorId,username:d.author,pfp_url:d.pfpUrl,roleIds:(h==null?void 0:h.roleIds)||[]}),children:d.author}),E&&c.jsx("span",{className:"msg-role-tag",children:E.name}),c.jsx("span",{className:"msg-time",children:rv(d.firstMessageTime)})]}),d.messages.map(F=>c.jsxs("div",{onContextMenu:W=>Yh(W,{id:F.id,kind:"server",author:d.author,content:F.content,mine:(F.author_id||F.authorId)===(l==null?void 0:l.id)}),children:[c.jsxs("p",{children:[zo.some(W=>W.id===F.id)?" ":"",HS(F)]}),Array.isArray(F==null?void 0:F.embeds)&&F.embeds.length>0&&c.jsx("div",{className:"message-embeds",children:F.embeds.map((W,Y)=>{var q;return c.jsxs("div",{className:"message-embed-card",children:[W.title&&c.jsx("strong",{children:W.title}),W.description&&c.jsx("p",{children:W.description}),W.url&&c.jsx("a",{href:W.url,target:"_blank",rel:"noreferrer",children:W.url}),((q=W.footer)==null?void 0:q.text)&&c.jsx("small",{children:W.footer.text})]},`${F.id}-embed-${Y}`)})}),Array.isArray(F==null?void 0:F.linkEmbeds)&&F.linkEmbeds.length>0&&c.jsx("div",{className:"message-embeds",children:F.linkEmbeds.map((W,Y)=>c.jsxs("a",{className:"message-embed-card",href:W.url,target:"_blank",rel:"noreferrer",children:[c.jsx("strong",{children:W.title||"Link"}),c.jsx("p",{children:W.url})]},`${F.id}-link-${Y}`))}),Array.isArray(F==null?void 0:F.attachments)&&F.attachments.length>0&&c.jsx("div",{className:"message-embeds",children:F.attachments.map((W,Y)=>c.jsxs("a",{className:"message-embed-card",href:`${(O==null?void 0:O.baseUrl)||""}${W.url}`,target:"_blank",rel:"noreferrer",children:[c.jsx("strong",{children:W.fileName||"Attachment"}),c.jsx("p",{children:W.contentType||"file"})]},`${F.id}-att-${Y}`))})]},F.id))]})]})]},`group-wrap-${d.id}`)})})(),!J.length&&c.jsx("p",{className:"empty",children:"No messages yet. Start the conversation."})]}),Ki&&c.jsxs("div",{className:"reply-banner",children:[c.jsxs("span",{children:["Replying to ",Ki.author]}),c.jsx("button",{className:"ghost",onClick:()=>ed(null),children:"Cancel"})]}),c.jsxs("footer",{className:"composer server-composer",onClick:()=>{var s;return(s=na.current)==null?void 0:s.focus()},children:[c.jsx("button",{className:"ghost composer-icon",onClick:s=>{var d;s.stopPropagation(),(d=js.current)==null||d.click()},children:""}),c.jsx("input",{ref:js,type:"file",multiple:!0,style:{display:"none"},onChange:async s=>{const d=Array.from(s.target.files||[]);for(const h of d.slice(0,10))await H_(h)}}),c.jsxs("div",{className:"composer-input-wrap",children:[Oi.length>0&&c.jsx("div",{className:"mention-suggestions",children:Oi.map((s,d)=>c.jsxs("div",{className:"mention-suggestion",style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[c.jsx("span",{children:s.fileName||"attachment"}),c.jsx("button",{type:"button",className:"ghost",onClick:h=>{h.stopPropagation(),co(y=>y.filter((E,T)=>T!==d))},children:"Remove"})]},`pending-att-${d}`))}),c.jsx("input",{ref:na,value:X,onChange:s=>le(s.target.value),placeholder:`Message #${(Ls==null?void 0:Ls.name)||"channel"}`,onKeyDown:s=>{if(s.key==="ArrowDown"&&tn.length>0){s.preventDefault(),jo(d=>(d+1)%tn.length);return}if(s.key==="ArrowUp"&&tn.length>0){s.preventDefault(),jo(d=>(d-1+tn.length)%tn.length);return}if(s.key==="Escape"&&$o){s.preventDefault(),le("");return}if((s.key==="Tab"||s.key==="Enter")&&tn.length>0){s.preventDefault();const d=tn[Math.min(vh,tn.length-1)]||tn[0];if(!d)return;le(`/${d.name} `);return}if(s.key==="Enter"){Ph();return}if(s.key==="Tab"&&Ao.length){s.preventDefault();const d=mu(X);if(!d)return;const h=Ao[0],y=X.slice(0,d.start);le(`${y}@{${h}} `)}}}),$o&&c.jsxs("div",{className:"slash-command-suggestions",children:[c.jsxs("div",{className:"slash-command-header",children:["COMMANDS MATCHING /",(Os||"").toUpperCase()]}),tn.length===0?c.jsx("div",{className:"slash-command-empty",children:"No commands found for this server."}):tn.map((s,d)=>c.jsxs("button",{type:"button",className:`slash-command-item ${d===vh?"active":""}`,onClick:h=>{var y;h.stopPropagation(),le(`/${s.name} `),jo(d),(y=na.current)==null||y.focus()},children:[c.jsxs("div",{children:[c.jsxs("strong",{children:["/",s.name]}),c.jsx("p",{children:s.description||"No description provided."})]}),c.jsx("span",{children:s.extensionName||s.extensionId})]},s.name))]}),Ao.length>0&&!$o&&c.jsx("div",{className:"mention-suggestions",children:Ao.map(s=>c.jsxs("button",{type:"button",className:"mention-suggestion",onClick:d=>{var E;d.stopPropagation();const h=mu(X);if(!h)return;const y=X.slice(0,h.start);le(`${y}@{${s}} `),(E=na.current)==null||E.focus()},children:["@",s]},s))}),$t&&!$o&&c.jsxs("div",{className:"emote-picker",children:[Object.entries(ev).map(([s,d])=>c.jsxs("button",{type:"button",className:"emote-item",onClick:h=>{h.stopPropagation(),Jh(s)},title:`:${s}:`,children:[c.jsx("span",{children:d}),c.jsxs("small",{children:[":",s,":"]})]},s)),((L==null?void 0:L.emotes)||[]).map(s=>c.jsxs("button",{type:"button",className:"emote-item",onClick:d=>{d.stopPropagation(),Jh(String(s.name||"").toLowerCase())},title:`:${s.name}:`,children:[c.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:`:${s.name}:`}),c.jsxs("small",{children:[":",s.name,":"]})]},s.id||s.name))]})]}),c.jsx("button",{className:"ghost composer-icon",onClick:s=>{s.stopPropagation(),Ge(d=>!d)},title:"Open emotes",children:""}),c.jsx("button",{className:"send-btn",onClick:Ph,disabled:!Z||!X.trim()&&Oi.length===0,children:"Send"})]})]}),c.jsxs("aside",{className:"members-pane",children:[c.jsxs("h4",{children:["Members  ",st.length]}),(()=>{const s=new Map(((L==null?void 0:L.roles)||[]).map(T=>[T.id,T])),d=T=>(T.roleIds||[]).map(U=>s.get(U)).filter(Boolean).sort((U,F)=>(F.position??0)-(U.position??0))[0]||null,h=new Map;for(const T of st){const A=d(T),U=(A==null?void 0:A.id)??"__none__";h.has(U)||h.set(U,{role:A,members:[]}),h.get(U).members.push(T)}const y={id:"__none__",name:"No role",position:-1,color:null},E=Array.from(h.entries()).map(([T,{role:A,members:U}])=>({role:A||y,members:U}));return E.sort((T,A)=>(A.role.position??0)-(T.role.position??0)),E.map(({role:T,members:A})=>{const U=T.color!=null&&T.color!==""?typeof T.color=="number"?`#${Number(T.color).toString(16).padStart(6,"0")}`:T.color:null;return c.jsxs("div",{className:"members-role-section",children:[c.jsx("div",{className:"members-role-label",style:U?{color:U}:void 0,children:T.name}),A.map(F=>{var te;const W=d(F),Y=(W==null?void 0:W.color)!=null&&W.color!==""?typeof W.color=="number"?`#${Number(W.color).toString(16).padStart(6,"0")}`:W.color:null,q=or.find(pe=>pe.userId===F.id),fe=!!((q==null?void 0:q.channelId)&&q.channelId===_t)&&!!((te=lh[z])!=null&&te[F.id]);return c.jsxs("button",{className:"member-row",title:`View ${F.username}`,onClick:pe=>{pe.stopPropagation(),Fs(F)},onContextMenu:pe=>Pd(pe,F),children:[F.pfp_url?c.jsx("img",{src:Nt(F.pfp_url),alt:F.username,className:`avatar member-avatar ${fe?"speaking":""}`,style:{objectFit:"cover"}}):c.jsx("div",{className:`avatar member-avatar ${fe?"speaking":""}`,children:Bn(F.username)}),c.jsxs("div",{children:[c.jsx("strong",{style:Y?{color:Y}:void 0,children:F.username}),c.jsx("span",{children:q?`${q.deafened?"":q.muted?"":""} In voice`:Lo(gn(F.id))})]})]},F.id)})]},T.id)})})(),!st.length&&c.jsx("p",{className:"hint",children:"No visible members yet."})]})]}),g==="dms"&&c.jsxs("section",{className:"chat-main",children:[c.jsxs("header",{className:"chat-header dm-header-actions",children:[c.jsx("h3",{children:Ee?`@ ${Ee.name}`:"Direct Messages"}),c.jsx("div",{className:"chat-actions",children:c.jsx("button",{className:"icon-btn ghost",onClick:()=>Bf(s=>!s),title:"Pinned DMs",children:""})})]}),zf&&Bo.length>0&&c.jsx("div",{className:"pinned-strip",children:Bo.slice(0,3).map(s=>c.jsxs("div",{className:"pinned-item",children:[c.jsx("strong",{children:s.author}),c.jsx("span",{children:s.content})]},s.id))}),c.jsxs("div",{className:"messages",ref:ta,children:[(()=>{let s="";return z_.map(d=>{const h=iv(d.firstMessageTime),y=!!h&&h!==s;return h&&(s=h),c.jsxs("div",{children:[y&&c.jsx("div",{className:"message-date-divider",children:c.jsx("span",{children:av(d.firstMessageTime)})}),c.jsxs("article",{className:"msg dm-msg grouped-msg",children:[c.jsx("div",{className:"msg-avatar",children:d.pfpUrl?c.jsx("img",{src:Nt(d.pfpUrl),alt:d.author}):Bn(d.author)}),c.jsxs("div",{className:"msg-body",children:[c.jsxs("strong",{className:"msg-author",children:[c.jsx("button",{className:"name-btn",onClick:()=>Fs({id:d.authorId,username:d.author,status:gn(d.authorId),pfp_url:d.pfpUrl}),onContextMenu:E=>Pd(E,{id:d.authorId,username:d.author,pfp_url:d.pfpUrl}),children:d.author}),c.jsx("span",{className:"msg-time",children:rv(d.firstMessageTime)})]}),d.messages.map(E=>c.jsxs("p",{onContextMenu:T=>Yh(T,{id:E.id,kind:"dm",author:E.author,content:E.content,mine:E.authorId===(l==null?void 0:l.id)}),children:[Bo.some(T=>T.id===E.id)?" ":"",E.content]},E.id))]})]})]},`dm-group-wrap-${d.id}`)})})(),!Ee&&c.jsx("p",{className:"empty",children:"Select a DM on the left."})]}),c.jsxs("footer",{className:"composer dm-composer",onClick:()=>{var s;return(s=_h.current)==null?void 0:s.focus()},children:[c.jsx("input",{ref:_h,value:uo,onChange:s=>Ul(s.target.value),placeholder:`Message ${(Ee==null?void 0:Ee.name)||"friend"}`,onKeyDown:s=>s.key==="Enter"&&jh()}),c.jsx("button",{className:"send-btn",onClick:jh,disabled:!Ee||!uo.trim(),children:"Send"})]})]}),g==="friends"&&c.jsxs("div",{className:"friends-surface",children:[c.jsxs("section",{className:"friends-main",children:[c.jsxs("header",{className:"friends-header",children:[c.jsx("h3",{children:"Friends"}),c.jsxs("div",{className:"friends-tabs",children:[c.jsx("button",{className:jr==="online"?"active":"ghost",onClick:()=>Ai("online"),children:"Online"}),c.jsx("button",{className:jr==="all"?"active":"ghost",onClick:()=>Ai("all"),children:"All"}),c.jsx("button",{className:jr==="add"?"active":"ghost",onClick:()=>Ai("add"),children:"Add Friend"}),c.jsx("button",{className:jr==="requests"?"active":"ghost",onClick:()=>Ai("requests"),children:"Requests"})]})]}),c.jsx("input",{placeholder:"Search friends",value:Fl,onChange:s=>Ww(s.target.value)}),jr==="add"&&c.jsxs("div",{className:"friend-add-card",children:[c.jsx("h4",{children:"Add Friend"}),c.jsx("p",{className:"hint",children:"Type the username and send your request instantly."}),c.jsxs("div",{className:"friend-add-row",children:[c.jsx("input",{placeholder:"Username",value:xf,onChange:s=>bf(s.target.value)}),c.jsx("button",{onClick:G_,children:"Send Request"})]})]}),jr==="requests"&&c.jsxs("div",{className:"friend-add-card",children:[c.jsx("h4",{children:"Friend Requests"}),mo.incoming.map(s=>c.jsxs("div",{className:"friend-row",children:[c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:"Incoming request"})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{onClick:()=>Dh(s.id,"accept"),children:"Accept"}),c.jsx("button",{className:"ghost",onClick:()=>Dh(s.id,"decline"),children:"Decline"})]})]},s.id)),mo.outgoing.map(s=>c.jsx("div",{className:"friend-row",children:c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:"Pending"})]})},s.id)),!mo.incoming.length&&!mo.outgoing.length&&c.jsx("p",{className:"hint",children:"No pending friend requests."})]}),(jr==="online"?Oo.filter(s=>gn(s.id)!=="offline"):Oo).map(s=>c.jsxs("div",{className:"friend-row",children:[c.jsxs("div",{className:"friend-meta",children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:Lo(gn(s.id))})]}),c.jsx("button",{className:"ghost",onClick:d=>{d.stopPropagation(),Vo(s)},children:"Message"})]},s.id))]}),c.jsxs("aside",{className:"active-now",children:[c.jsx("h4",{children:"Active Now"}),Oo.slice(0,5).map(s=>c.jsxs("button",{className:"active-card",onClick:d=>{d.stopPropagation(),Fs(s)},children:[c.jsx("strong",{children:s.username}),c.jsx("span",{children:gn(s.id)==="online"?"Available now":Lo(gn(s.id))})]},`active-${s.id}`)),!Oo.length&&c.jsx("p",{className:"hint",children:"When friends are active, they will appear here."})]})]}),g==="profile"&&c.jsxs("div",{className:"social-panel",children:[c.jsx("h3",{children:"Your Profile"}),c.jsx("p",{className:"hint",children:"Manage your public details and account appearance in Settings."}),c.jsx("button",{onClick:()=>{mn(!0),Qe("profile")},children:"Open Profile Settings"})]})]}),rt&&c.jsxs("div",{className:"server-context-menu",style:{top:rt.y,left:rt.x},onClick:s=>s.stopPropagation(),children:[rt.message.kind==="server"&&c.jsx("button",{onClick:()=>{ed({author:rt.message.author,content:rt.message.content}),Bt(null)},children:"Reply"}),c.jsx("button",{onClick:()=>{LS(rt.message),Bt(null)},children:rt.message.pinned?"Unpin":"Pin"}),rt.message.kind==="dm"&&c.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(rt.message.content||""),w("Copied message text.")}catch{w("Could not copy message text.")}Bt(null)},children:"Copy Text"}),rt.message.mine&&rt.message.kind==="server"&&c.jsx("button",{className:"danger",onClick:()=>jS(rt.message.id),children:"Delete"}),rt.message.mine&&rt.message.kind==="dm"&&c.jsx("button",{className:"danger",onClick:()=>DS(rt.message.id),children:"Delete"})]}),kt&&c.jsxs("div",{className:"server-context-menu",style:{top:kt.y,left:kt.x},onClick:s=>s.stopPropagation(),children:[c.jsx("button",{onClick:()=>{Fs(kt.member),Tt(null)},children:"View Profile"}),c.jsx("button",{onClick:()=>{Vo({id:kt.member.id,username:kt.member.username||kt.member.id}),Tt(null)},children:"Message"}),c.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(kt.member.id||""),w("User ID copied.")}catch{w("Could not copy user ID.")}Tt(null)},children:"Copy User ID"}),ra&&kt.member.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:async()=>{await Rd(kt.member.id),Tt(null)},children:"Kick Member"}),ar&&kt.member.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:async()=>{await Id(kt.member.id,""),Tt(null)},children:"Ban Member"}),bd&&c.jsx("button",{onClick:()=>{Wf(kt.member.id||""),mn(!0),Qe("moderation"),Tt(null)},children:"Open Moderation Panel"})]}),zt&&c.jsxs("div",{className:"server-context-menu",style:{top:zt.y,left:zt.x},onClick:s=>s.stopPropagation(),children:[c.jsx("button",{onClick:()=>IS(zt.server.id),children:"Open Server"}),Se&&zt.server.id===j&&!!wt&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{As({fixedType:"text"}),nt(null)},children:"Create Text Channel"}),c.jsx("button",{onClick:()=>{As({fixedType:"voice"}),nt(null)},children:"Create Voice Channel"}),c.jsx("button",{onClick:()=>{As({fixedType:"category"}),nt(null)},children:"Create Category"})]}),c.jsx("button",{onClick:()=>Gh(zt.server.id,"up"),children:"Move Up"}),c.jsx("button",{onClick:()=>Gh(zt.server.id,"down"),children:"Move Down"}),c.jsx("button",{onClick:()=>{Ef(zt.server.id),mn(!0),Qe("invites"),nt(null)},children:"Create Invite"}),c.jsx("button",{onClick:()=>RS(zt.server.id),children:"Copy Server ID"}),c.jsx("button",{onClick:()=>{mn(!0),Qe("server"),nt(null)},children:"Server Settings"}),c.jsx("button",{className:"danger",onClick:()=>NS(zt.server),children:"Leave Server"}),(zt.server.roles||[]).includes("owner")&&c.jsx("button",{className:"danger",onClick:()=>PS(zt.server),children:"Delete Server"})]}),$r&&c.jsxs("div",{className:"server-context-menu",style:{top:$r.y,left:$r.x},onClick:s=>s.stopPropagation(),children:[Se&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>Ho($r.channel),children:"Edit Channel"}),c.jsx("button",{onClick:()=>{oh($r.channel.id),mn(!0),Qe("server"),Xt(null)},children:"Permissions"})]}),c.jsx("button",{onClick:()=>{ae($r.channel.id),Xt(null)},children:"Open"}),Se&&c.jsx("button",{className:"danger",onClick:()=>Hh($r.channel),children:"Delete"})]}),Fr&&c.jsx("div",{className:"server-context-menu",style:{top:Fr.y,left:Fr.x},onClick:s=>s.stopPropagation(),children:Se&&c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{As({fixedType:"text",fixedParentId:Fr.category.id}),Zt(null)},children:"Create Text Channel"}),c.jsx("button",{onClick:()=>{As({fixedType:"voice",fixedParentId:Fr.category.id}),Zt(null)},children:"Create Voice Channel"}),c.jsx("button",{onClick:()=>Ho(Fr.category),children:"Edit Category"}),c.jsx("button",{className:"danger",onClick:()=>Hh(Fr.category),children:"Delete Category"})]})}),h_&&c.jsx("div",{className:"settings-overlay",onClick:()=>Ar(!1),children:c.jsxs("div",{className:"add-server-modal",onClick:s=>s.stopPropagation(),children:[c.jsxs("header",{className:"add-server-modal-header",children:[c.jsx("h3",{style:{margin:0},children:"Create or join a server"}),c.jsxs("div",{className:"add-server-tabs",children:[c.jsx("button",{type:"button",className:Ns==="join"?"active":"ghost",onClick:()=>So("join"),children:"Join"}),c.jsx("button",{type:"button",className:Ns==="custom"?"active":"ghost",onClick:()=>So("custom"),children:"Add host"}),c.jsx("button",{type:"button",className:Ns==="create"?"active":"ghost",onClick:()=>So("create"),children:"Create yours"}),x.some(s=>{var d,h;return(h=(d=s==null?void 0:s.roles)==null?void 0:d.includes)==null?void 0:h.call(d,"owner")})&&c.jsx("a",{href:"/server-admin.html",target:"_blank",rel:"noopener noreferrer",className:"add-server-admin-link",onClick:s=>s.stopPropagation(),children:" Admin"})]})]}),c.jsxs("div",{className:"add-server-content",children:[Ns==="join"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Paste an invite code or full join link. Invite links are previewed and need explicit accept."}),c.jsx("input",{placeholder:"Invite code or join link",value:ks??"",onChange:s=>zi(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("div",{className:"row-actions",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("button",{className:"ghost",onClick:Td,children:"Preview"}),c.jsx("button",{onClick:()=>Ah(Cf||ks),children:"Accept Invite"})]}),hn&&c.jsxs("p",{className:"hint",style:{marginTop:"0.5rem"},children:["Invite: ",hn.code,"  Server: ",hn.serverName||hn.server_id,"  Uses: ",hn.uses]})]}),Ns==="custom"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"Connect to a server node by URL (self-hosted or provider)."}),c.jsx("input",{placeholder:"Server name",value:xs??"",onChange:s=>zl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"https://node.example.com",value:bs??"https://",onChange:s=>Bl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Es??"",onChange:s=>Fi(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server logo",Fi),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Vl??"",onChange:s=>Ui(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server banner",Ui),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("button",{onClick:Mh,disabled:!xs.trim()||!bs.trim()||!Es.trim(),children:"Add Server"})]}),Ns==="create"&&c.jsxs("section",{className:"card",children:[c.jsx("p",{className:"hint",style:{marginBottom:"0.5rem"},children:"One server hosted by usname it and customize channels and roles."}),c.jsx("input",{placeholder:"Server name",value:Or??"",onChange:s=>Kl(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:ir??"",onChange:s=>Vi(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Logo",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server logo",Vi),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Yl??"",onChange:s=>Wi(s.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),c.jsxs("label",{style:{display:"block",marginBottom:"0.5rem"},children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server banner",Wi),style:{width:"100%",marginTop:"0.35rem"}})]}),c.jsx("button",{onClick:Kh,disabled:!(Or!=null&&Or.trim())||!(ir!=null&&ir.trim()),children:"Create your server"})]})]}),c.jsx("button",{type:"button",className:"ghost",style:{width:"100%",marginTop:"0.5rem"},onClick:()=>Ar(!1),children:"Close"})]})}),ce&&c.jsxs("div",{className:"member-profile-popout",style:{right:_o.x,bottom:_o.y},onClick:s=>s.stopPropagation(),children:[c.jsx("div",{className:"popout-drag-handle",onMouseDown:SS,children:"Drag"}),c.jsx("div",{className:"popout-banner",style:{backgroundImage:ce.bannerUrl?`url(${Nt(ce.bannerUrl)})`:void 0}}),c.jsxs("div",{className:"popout-content",children:[(()=>{const s=P_(ce.id);return s?c.jsxs("div",{className:"message-embed-card",style:{marginBottom:"8px"},children:[s.largeImageUrl&&c.jsx("img",{src:s.largeImageUrl,alt:s.largeImageText||"Activity",style:{width:"100%",borderRadius:"8px",marginBottom:"6px"}}),c.jsx("strong",{children:s.name||"Activity"}),s.details&&c.jsx("p",{children:s.details}),s.state&&c.jsx("p",{children:s.state}),Array.isArray(s.buttons)&&s.buttons.length>0&&c.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginTop:"6px"},children:s.buttons.map((d,h)=>c.jsx("a",{href:d.url,target:"_blank",rel:"noreferrer",className:"ghost",style:{padding:"4px 8px",borderRadius:"8px",border:"1px solid var(--border-subtle)",textDecoration:"none",color:"var(--text-soft)"},children:d.label},`${d.url}-${h}`))})]}):null})(),c.jsx("div",{className:"avatar popout-avatar",children:ce.pfpUrl?c.jsx("img",{src:Nt(ce.pfpUrl),alt:"Profile avatar",className:"avatar-image"}):Bn(ce.displayName||ce.username||"User")}),c.jsx("h4",{children:ce.displayName||ce.username}),c.jsxs("p",{className:"hint",children:["@",ce.username,"  ",Lo(gn(ce==null?void 0:ce.id)||(ce==null?void 0:ce.status)||"offline")]}),ce.platformTitle&&c.jsx("p",{className:"hint",children:ce.platformTitle}),qh(ce.createdAt)&&c.jsxs("p",{className:"hint",children:["Account created: ",qh(ce.createdAt)]}),Array.isArray(ce.badgeDetails)&&ce.badgeDetails.length>0&&c.jsx("div",{className:"popout-roles",children:ce.badgeDetails.map((s,d)=>{const h=WS(s);return c.jsx("span",{className:"popout-role-tag",title:h.name,style:{backgroundColor:h.bgColor,color:h.fgColor,borderColor:h.bgColor},children:h.icon},`${s.id||s.name||"badge"}-${d}`)})}),((em=ce.roleIds)==null?void 0:em.length)>0&&(L==null?void 0:L.roles)&&c.jsx("div",{className:"popout-roles",children:(L.roles||[]).filter(s=>(ce.roleIds||[]).includes(s.id)&&!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>{const d=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return c.jsx("span",{className:"popout-role-tag",style:{backgroundColor:d+"22",color:d,borderColor:d},children:s.name},s.id)})}),c.jsx("p",{children:ce.bio||"No bio set."}),c.jsxs("div",{className:"popout-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>Vo({id:ce.id,username:ce.username}),children:"Message"}),ra&&ce.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"ghost",onClick:()=>Rd(ce.id),children:"Kick"}),ar&&ce.id!==(l==null?void 0:l.id)&&c.jsx("button",{className:"danger",onClick:()=>Id(ce.id,""),children:"Ban"}),c.jsx("button",{onClick:()=>Ur(null),children:"Close"})]})]})]}),Gi&&c.jsx("div",{className:"settings-overlay",onClick:()=>mn(!1),children:c.jsxs("div",{className:"settings-panel",onClick:s=>s.stopPropagation(),children:[c.jsxs("aside",{className:"settings-nav",children:[c.jsx("h3",{children:"Settings"}),c.jsx("button",{className:Re==="profile"?"active":"ghost",onClick:()=>Qe("profile"),children:"Profile"}),c.jsx("button",{className:Re==="security"?"active":"ghost",onClick:()=>{Qe("security"),Q_()},children:" Security"}),c.jsx("button",{className:Re==="billing"?"active":"ghost",onClick:()=>{Qe("billing"),Lh()},children:" Billing"}),c.jsx("button",{className:Re==="server"?"active":"ghost",onClick:()=>Qe("server"),children:"Server"}),c.jsx("button",{className:Re==="roles"?"active":"ghost",onClick:()=>Qe("roles"),children:"Roles"}),bd&&c.jsx("button",{className:Re==="moderation"?"active":"ghost",onClick:()=>Qe("moderation"),children:"Moderation"}),c.jsx("button",{className:Re==="invites"?"active":"ghost",onClick:()=>Qe("invites"),children:"Invites"}),c.jsx("button",{className:Re==="appearance"?"active":"ghost",onClick:()=>Qe("appearance"),children:"Appearance"}),c.jsx("button",{className:Re==="extensions"?"active":"ghost",onClick:()=>Qe("extensions"),children:"Extensions"}),c.jsx("button",{className:Re==="voice"?"active":"ghost",onClick:()=>Qe("voice"),children:"Voice"}),x.some(s=>s.roles.includes("owner"))&&c.jsx("a",{href:"/server-admin.html",target:"_blank",style:{display:"block",padding:"var(--space-sm) var(--space-md)",background:"rgba(149, 168, 205, 0.12)",border:"1px solid rgba(125, 164, 255, 0.25)",borderRadius:"calc(var(--radius) * 0.9)",color:"var(--text-main)",textDecoration:"none",textAlign:"center",fontWeight:"500",cursor:"pointer",fontSize:"0.95em"},children:" Server Admin Panel"}),c.jsx("button",{className:"ghost",onClick:()=>mn(!1),children:"Close"})]}),c.jsxs("section",{className:"settings-content",children:[Re==="profile"&&c.jsxs("div",{className:"card",children:[c.jsx("h4",{children:"Profile Settings"}),c.jsxs("label",{children:["Display Name",c.jsx("input",{value:Dn.displayName,onChange:s=>nr(d=>({...d,displayName:s.target.value}))})]}),c.jsxs("label",{children:["Bio",c.jsx("textarea",{rows:4,value:Dn.bio,onChange:s=>nr(d=>({...d,bio:s.target.value}))})]}),c.jsxs("label",{children:["Avatar URL",c.jsx("input",{value:Dn.pfpUrl,onChange:s=>nr(d=>({...d,pfpUrl:s.target.value}))})]}),c.jsxs("label",{children:["Upload Avatar",c.jsx("input",{type:"file",accept:"image/*",onChange:BS})]}),c.jsxs("label",{children:["Banner URL",c.jsx("input",{value:Dn.bannerUrl,onChange:s=>nr(d=>({...d,bannerUrl:s.target.value}))})]}),c.jsxs("label",{children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:VS})]}),c.jsx("button",{onClick:iS,children:"Save Profile"}),c.jsx("hr",{style:{borderColor:"var(--border-subtle)",width:"100%"}}),c.jsx("h4",{children:"Rich Presence (RPC-style)"}),c.jsx("p",{className:"hint",children:"No app ID needed. Set activity text, image URLs, and optional buttons."}),c.jsxs("label",{children:["Activity Name",c.jsx("input",{value:Ut.name,onChange:s=>ut(d=>({...d,name:s.target.value})),placeholder:"Playing OpenCom"})]}),c.jsxs("label",{children:["Details",c.jsx("input",{value:Ut.details,onChange:s=>ut(d=>({...d,details:s.target.value})),placeholder:"In a voice channel"})]}),c.jsxs("label",{children:["State",c.jsx("input",{value:Ut.state,onChange:s=>ut(d=>({...d,state:s.target.value})),placeholder:"With friends"})]}),c.jsxs("label",{children:["Large Image URL",c.jsx("input",{value:Ut.largeImageUrl,onChange:s=>ut(d=>({...d,largeImageUrl:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Upload Large Image",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"large image",d=>ut(h=>({...h,largeImageUrl:d})))})]}),c.jsxs("label",{children:["Large Image Text",c.jsx("input",{value:Ut.largeImageText,onChange:s=>ut(d=>({...d,largeImageText:s.target.value})),placeholder:"Tooltip text"})]}),c.jsxs("label",{children:["Small Image URL",c.jsx("input",{value:Ut.smallImageUrl,onChange:s=>ut(d=>({...d,smallImageUrl:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Upload Small Image",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"small image",d=>ut(h=>({...h,smallImageUrl:d})))})]}),c.jsxs("label",{children:["Small Image Text",c.jsx("input",{value:Ut.smallImageText,onChange:s=>ut(d=>({...d,smallImageText:s.target.value})),placeholder:"Tooltip text"})]}),c.jsxs("label",{children:["Button 1 Label",c.jsx("input",{value:Ut.button1Label,onChange:s=>ut(d=>({...d,button1Label:s.target.value})),placeholder:"Watch"})]}),c.jsxs("label",{children:["Button 1 URL",c.jsx("input",{value:Ut.button1Url,onChange:s=>ut(d=>({...d,button1Url:s.target.value})),placeholder:"https://..."})]}),c.jsxs("label",{children:["Button 2 Label",c.jsx("input",{value:Ut.button2Label,onChange:s=>ut(d=>({...d,button2Label:s.target.value})),placeholder:"Join"})]}),c.jsxs("label",{children:["Button 2 URL",c.jsx("input",{value:Ut.button2Url,onChange:s=>ut(d=>({...d,button2Url:s.target.value})),placeholder:"https://..."})]}),c.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[c.jsx("button",{onClick:aS,children:"Save Rich Presence"}),c.jsx("button",{className:"ghost",onClick:oS,children:"Clear"})]})]}),Re==="server"&&c.jsxs(c.Fragment,{children:[O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Server Branding"}),c.jsx("input",{placeholder:"Server name",value:rr.name??"",onChange:s=>Dr(d=>({...d,name:s.target.value}))}),c.jsx("input",{placeholder:"Logo URL",value:rr.logoUrl??"",onChange:s=>Dr(d=>({...d,logoUrl:s.target.value}))}),c.jsxs("label",{children:["Upload Logo",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server logo",d=>Dr(h=>({...h,logoUrl:d})))})]}),c.jsx("input",{placeholder:"Banner URL",value:rr.bannerUrl??"",onChange:s=>Dr(d=>({...d,bannerUrl:s.target.value}))}),c.jsxs("label",{children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server banner",d=>Dr(h=>({...h,bannerUrl:d})))})]}),c.jsx("button",{onClick:cS,children:"Save Server Profile"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Add Server Provider"}),c.jsx("input",{placeholder:"Server name",value:xs??"",onChange:s=>zl(s.target.value)}),c.jsx("input",{placeholder:"https://node.provider.tld",value:bs??"https://",onChange:s=>Bl(s.target.value)}),c.jsx("input",{placeholder:"Logo URL (.png/.jpg/.webp/.svg)",value:Es??"",onChange:s=>Fi(s.target.value)}),c.jsxs("label",{children:["Upload Logo",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server logo",Fi)})]}),c.jsx("input",{placeholder:"Banner URL (optional)",value:Vl??"",onChange:s=>Ui(s.target.value)}),c.jsxs("label",{children:["Upload Banner",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"server banner",Ui)})]}),c.jsx("button",{onClick:Mh,disabled:!xs.trim()||!bs.trim()||!Es.trim(),children:"Add Server"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Voice Gateway Routing"}),c.jsx("p",{className:"hint",children:"Default is OpenCom core gateway. Switch to self-hosted to reduce latency for your server."}),c.jsxs("label",{children:["Voice Gateway Mode",c.jsxs("select",{value:Rh.mode,onChange:s=>Oh({mode:s.target.value==="server"?"server":"core"}),children:[c.jsx("option",{value:"core",children:"OpenCom Core (default)"}),c.jsx("option",{value:"server",children:"Self-hosted/Server-first"})]})]}),c.jsxs("label",{children:["Optional custom gateway URL",c.jsx("input",{placeholder:"https://gateway.yourserver.tld",value:Rh.customUrl,onChange:s=>Oh({customUrl:s.target.value})})]}),c.jsx("p",{className:"hint",children:"Client fallback order follows this mode and automatically tries the other gateways if one fails."})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Workspace"}),c.jsx("input",{placeholder:"Workspace name",value:Bi??"",onChange:s=>Df(s.target.value)}),c.jsx("button",{onClick:lS,children:"Create Workspace"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Channel"}),c.jsx("input",{placeholder:"New channel/category",value:Hl??"",onChange:s=>Nf(s.target.value)}),c.jsxs("select",{value:ho??"text",onChange:s=>Kw(s.target.value),children:[c.jsx("option",{value:"text",children:"Text Channel"}),c.jsx("option",{value:"voice",children:"Voice Channel"}),c.jsx("option",{value:"category",children:"Category"})]}),ho!=="category"&&c.jsxs("select",{value:Pf??"",onChange:s=>jf(s.target.value),children:[c.jsx("option",{value:"",children:"No category"}),(sa||[]).map(s=>c.jsx("option",{value:(s==null?void 0:s.id)??"",children:(s==null?void 0:s.name)??"Category"},(s==null?void 0:s.id)??""))]}),c.jsx("button",{onClick:uS,children:"Create Channel"})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Custom Emotes"}),c.jsxs("p",{className:"hint",children:["Use emotes in chat with ",c.jsx("code",{children:":name:"}),"."]}),c.jsx("input",{placeholder:"Emote name (example: hype)",value:Jt,onChange:s=>Ae(s.target.value)}),c.jsx("input",{placeholder:"Emote image URL (.png/.gif/.webp/.svg)",value:tr,onChange:s=>Al(s.target.value)}),c.jsxs("label",{children:["Upload Emote Image",c.jsx("input",{type:"file",accept:"image/*",onChange:s=>It(s,"emote image",Al)})]}),c.jsx("button",{onClick:pS,children:"Create Emote"}),c.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:((L==null?void 0:L.emotes)||[]).map(s=>c.jsxs("li",{children:[c.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[c.jsx("img",{className:"message-custom-emote",src:s.imageUrl||s.image_url,alt:s.name}),c.jsxs("code",{children:[":",s.name,":"]})]}),c.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>fS(s.id),children:"Remove"})]},s.id))})]}),O&&Se&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Channel permissions"}),c.jsx("p",{className:"hint",children:"Choose a channel and set which roles can send messages there. By default everyone can send."}),c.jsxs("select",{value:To,onChange:s=>oh(s.target.value),children:[c.jsx("option",{value:"",children:"Select channel"}),(Ms||[]).filter(s=>s.type==="text").map(s=>c.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]}),To&&c.jsx("ul",{className:"channel-perms-role-list",children:((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>c.jsx("li",{children:c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:vS(To,s.id),onChange:d=>gS(To,s.id,d.target.checked)}),c.jsx("span",{className:"channel-perms-role-name",style:{color:s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5"},children:s.name}),c.jsx("span",{className:"hint",children:" can send here"})]})},s.id))})]}),Re==="server"&&!O&&x.length>0&&c.jsx("p",{className:"hint",children:"Select a server from the sidebar to manage workspaces and channels."})]}),Re==="roles"&&Se&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Role"}),c.jsx("input",{placeholder:"Role name",value:Jl,onChange:s=>Vf(s.target.value)}),c.jsx("button",{onClick:yS,children:"Create Role"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Edit Roles (colour & hierarchy)"}),c.jsx("p",{className:"hint",children:"Higher position = higher in the list. Colours show in member list and chat."}),c.jsx("ul",{className:"role-edit-list",children:((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).sort((s,d)=>(d.position??0)-(s.position??0)).map(s=>{const d=s.color!=null&&s.color!==""?typeof s.color=="number"?`#${Number(s.color).toString(16).padStart(6,"0")}`:s.color:"#99aab5";return c.jsxs("li",{className:"role-edit-row",children:[c.jsx("span",{className:"role-edit-name",style:{color:d},children:s.name}),c.jsx("input",{type:"color",value:d,onChange:h=>Wh(s.id,{color:h.target.value}),title:"Role colour"}),c.jsxs("label",{children:["Position ",c.jsx("input",{type:"number",min:0,value:s.position??0,onChange:h=>Wh(s.id,{position:parseInt(h.target.value,10)||0})})]})]},s.id)})})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Assign Role"}),c.jsxs("select",{value:Xl,onChange:s=>l_(s.target.value),children:[c.jsx("option",{value:"",children:"Select member"}),st.map(s=>c.jsx("option",{value:s.id,children:s.username},s.id))]}),c.jsxs("select",{value:ql,onChange:s=>c_(s.target.value),children:[c.jsx("option",{value:"",children:"Select role"}),((L==null?void 0:L.roles)||[]).filter(s=>!s.is_everyone).map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]}),c.jsx("button",{onClick:wS,children:"Assign Role"})]})]}),Re==="moderation"&&bd&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Member moderation"}),c.jsx("p",{className:"hint",children:"Kick removes a member from this guild. Ban removes and blocks rejoin until unbanned."}),c.jsxs("select",{value:Hi,onChange:s=>Wf(s.target.value),children:[c.jsx("option",{value:"",children:"Select member"}),st.filter(s=>s.id!==(l==null?void 0:l.id)).map(s=>c.jsx("option",{value:s.id,children:s.username},s.id))]}),ar&&c.jsx("input",{placeholder:"Ban reason (optional)",value:Hf,onChange:s=>d_(s.target.value)}),c.jsxs("div",{className:"row-actions",children:[ra&&c.jsx("button",{disabled:!Hi||Rs,onClick:()=>Rd(Hi),children:"Kick Member"}),ar&&c.jsx("button",{className:"danger",disabled:!Hi||Rs,onClick:()=>Id(Hi,Hf),children:"Ban Member"})]})]}),ar&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Unban user"}),c.jsx("p",{className:"hint",children:"Paste a user ID and remove their ban record."}),c.jsx("input",{placeholder:"User ID to unban",value:Zl,onChange:s=>Gf(s.target.value)}),c.jsx("button",{disabled:!Zl.trim()||Rs,onClick:()=>_S(Zl.trim()),children:"Unban User"})]})]}),Re==="invites"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Join Server"}),c.jsx("input",{placeholder:"Paste invite code or join link",value:ks,onChange:s=>zi(s.target.value)}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:Td,children:"Preview"}),c.jsx("button",{onClick:()=>Ah(Cf||ks),children:"Accept Invite"})]}),hn&&c.jsxs("p",{className:"hint",children:["Invite: ",hn.code,"  Server: ",hn.serverName||hn.server_id,"  Uses: ",hn.uses]})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Create Invite"}),c.jsxs("p",{className:"hint",children:["Boost perk: custom code + permanent invite links (example: ",c.jsx("code",{children:"?joinOpen"}),")."]}),c.jsxs("select",{value:Wl,onChange:s=>Ef(s.target.value),children:[c.jsx("option",{value:"",children:"Select server"}),x.map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]}),c.jsx("input",{placeholder:"Custom code (Boost perk, optional)",value:Tf,onChange:s=>Rf(s.target.value)}),c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[c.jsx("input",{type:"checkbox",checked:If,onChange:s=>Qw(s.target.checked)}),"Permanent invite (Boost perk)"]}),c.jsx("button",{onClick:dS,children:"Generate Invite"}),po&&c.jsxs(c.Fragment,{children:[c.jsxs("p",{className:"hint",children:["Code: ",c.jsx("code",{children:po})]}),c.jsx("p",{className:"hint",children:"Invite link (share this):"}),c.jsxs("div",{className:"invite-link-row",children:[c.jsx("input",{readOnly:!0,className:"invite-link-input",value:kf||$g(po)}),c.jsx("button",{type:"button",onClick:()=>{const s=kf||$g(po);navigator.clipboard.writeText(s).then(()=>w("Invite link copied.")).catch(()=>w("Could not copy."))},children:"Copy link"})]})]})]})]}),Re==="extensions"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Client Extensions"}),c.jsx("p",{className:"hint",children:"Enable reviewed client-only extensions from the catalog. Extensions run in your client session."}),fh.length?c.jsx("ul",{className:"channel-perms-role-list",children:fh.map(s=>{const d=Xi.includes(s.id);return c.jsxs("li",{children:[c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:d,onChange:h=>A_(s.id,h.target.checked)}),c.jsx("strong",{children:s.name}),c.jsxs("span",{className:"hint",children:["  ",s.id,"  ",s.version||"0.1.0"]}),c.jsx("span",{className:"hint",style:{marginLeft:"6px",color:d?"#4ec97e":"#f0a4a4"},children:d?"Enabled":"Disabled"})]}),s.description&&c.jsx("p",{className:"hint",style:{margin:"4px 0 0 24px"},children:s.description}),No[s.id]&&c.jsxs("p",{className:"hint",style:{margin:"2px 0 0 24px"},children:["Status: ",No[s.id]]})]},s.id)})}):c.jsx("p",{className:"hint",children:"No client extensions found in the catalog."})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Developer Mode"}),c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[c.jsx("input",{type:"checkbox",checked:Ps,onChange:s=>N_(s.target.checked)}),"Enable local/testing extension URLs"]}),c.jsx("p",{className:"hint",children:"Use this while developing extensions. Add one URL per extension entry script."}),Ps&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"row-actions",style:{marginTop:"8px"},children:[c.jsx("input",{placeholder:"http://localhost:5174/my-extension.js",value:mh,onChange:s=>gh(s.target.value),style:{flex:1}}),c.jsx("button",{onClick:$_,children:"Add URL"})]}),c.jsx("ul",{className:"channel-perms-role-list",style:{marginTop:"10px"},children:Zi.map(s=>c.jsxs("li",{children:[c.jsx("span",{style:{wordBreak:"break-all"},children:s}),c.jsx("button",{className:"ghost",style:{marginLeft:"8px"},onClick:()=>hh(d=>d.filter(h=>h!==s)),children:"Remove"}),No[`dev:${s}`]&&c.jsxs("p",{className:"hint",style:{margin:"4px 0 0 0"},children:["Status: ",No[`dev:${s}`]]})]},s))})]})]})]}),Re==="appearance"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Custom CSS Theme"}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox",checked:v_,onChange:s=>y_(s.target.checked)})," Enable custom CSS"]}),c.jsx("input",{type:"file",accept:"text/css,.css",onChange:GS}),c.jsx("textarea",{value:g_,onChange:s=>qf(s.target.value),rows:10,placeholder:"Paste custom CSS"})]}),Re==="voice"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Voice Settings"}),c.jsxs("label",{children:["Input Device",c.jsxs("select",{value:Ln,onChange:s=>Ff(s.target.value),children:[c.jsx("option",{value:"",children:"System default"}),t_.map(s=>c.jsx("option",{value:s.deviceId,children:s.label||`Microphone ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),c.jsxs("label",{children:["Output Device",c.jsxs("select",{value:sr,onChange:s=>Uf(s.target.value),children:[c.jsx("option",{value:"",children:"System default"}),r_.map(s=>c.jsx("option",{value:s.deviceId,children:s.label||`Speaker ${s.deviceId.slice(0,6)}`},s.deviceId))]})]}),c.jsxs("label",{children:["Microphone Gain (",vo,"%)",c.jsx("input",{type:"range",min:"0",max:"200",step:"5",value:vo,onChange:s=>Zw(Number(s.target.value))})]}),c.jsxs("label",{children:["Mic Sensitivity (",Ts,"%)",c.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Ts,onChange:s=>e_(Number(s.target.value))})]}),c.jsx("p",{className:"hint",children:"Tip: allow microphone permissions so device names show properly."})]}),Re==="billing"&&c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"OpenCom Boost"}),c.jsx("p",{className:"hint",children:"10/month  100MB upload limit  Unlimited servers. More Boost features are coming soon."}),f_&&c.jsx("p",{className:"hint",children:"Loading billing status"}),Qi&&c.jsxs(c.Fragment,{children:[c.jsxs("p",{className:"hint",children:["Status: ",Qi.active?"Active":"Inactive",Qi.currentPeriodEnd?`  Renews ${new Date(Qi.currentPeriodEnd).toLocaleDateString()}`:""]}),!Qi.stripeConfigured&&c.jsx("p",{className:"hint",children:"Stripe is not configured on this server yet."})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{onClick:K_,children:"Subscribe to OpenCom Boost"}),c.jsx("button",{className:"ghost",onClick:Y_,children:"Manage Subscription"}),c.jsx("button",{className:"ghost",onClick:Lh,children:"Refresh"})]})]}),Re==="security"&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Account Security"}),c.jsxs("div",{className:"security-info",children:[c.jsxs("p",{className:"hint",children:["Last login: ",new Date(eh.date).toLocaleString()]}),c.jsxs("p",{className:"hint",children:["Device: ",eh.device]})]})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Change Password"}),__?c.jsxs(c.Fragment,{children:[c.jsxs("label",{children:["Current Password",c.jsx("input",{type:"password",value:Xf,onChange:s=>sd(s.target.value)})]}),c.jsxs("label",{children:["New Password",c.jsx("input",{type:"password",value:Co,onChange:s=>id(s.target.value)})]}),c.jsxs("label",{children:["Confirm Password",c.jsx("input",{type:"password",value:Zf,onChange:s=>ad(s.target.value)})]}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>{rd(!1),sd(""),id(""),ad("")},children:"Cancel"}),c.jsx("button",{onClick:async()=>{if(Co!==Zf){w("Passwords do not match.");return}if(Co.length<8){w("Password must be at least 8 characters.");return}try{await re("/v1/auth/password",{method:"PATCH",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({currentPassword:Xf,newPassword:Co})}),w("Password changed successfully."),rd(!1),sd(""),id(""),ad("")}catch(s){w(`Could not change password: ${s.message}`)}},children:"Update Password"})]})]}):c.jsx("button",{onClick:()=>rd(!0),children:"Change Password"})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Two-Factor Authentication"}),c.jsx("p",{className:"hint",children:"Secure your account with an additional authentication layer"}),!ih.twoFactorEnabled&&!sh&&c.jsx("button",{onClick:X_,children:"Enable 2FA"}),sh&&!b_&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"hint",style:{marginTop:"var(--space-sm)",fontWeight:600},children:" Step 1: Scan QR Code"}),c.jsx("p",{className:"hint",children:"Scan this QR code with an authenticator app (Google Authenticator, Authy, Microsoft Authenticator, etc.):"}),th&&c.jsx("img",{src:th,alt:"2FA QR Code",style:{width:"200px",height:"200px",border:"2px solid rgba(125, 164, 255, 0.3)",borderRadius:"var(--radius)",margin:"var(--space-sm) 0",background:"#fff",padding:"0.5em"}}),c.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 2: Verify Token"}),c.jsx("p",{className:"hint",children:"Enter a 6-digit code from your authenticator app:"}),c.jsx("input",{type:"text",placeholder:"000000",value:rh,onChange:s=>cd(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:"6",style:{textAlign:"center",fontSize:"1.2em",letterSpacing:"0.3em",fontFamily:"monospace"}}),c.jsx("p",{className:"hint",style:{marginTop:"var(--space-md)",fontWeight:600},children:" Step 3: Save Backup Codes"}),c.jsx("p",{className:"hint",children:"Save these backup codes somewhere safe. You can use them to regain access if you lose your authenticator."}),c.jsx("code",{style:{display:"block",background:"var(--bg-input)",padding:"var(--space-sm)",borderRadius:"calc(var(--radius)*0.8)",fontSize:"0.85em",marginBottom:"var(--space-sm)",whiteSpace:"pre-wrap",wordBreak:"break-all",fontFamily:"monospace",lineHeight:"1.8"},children:nh.map(s=>`${s}
`).join("")}),c.jsxs("div",{className:"row-actions",children:[c.jsx("button",{className:"ghost",onClick:()=>{bo(!1),od(""),xo([]),cd("")},children:"Cancel"}),c.jsx("button",{onClick:rS,children:"Verify & Enable 2FA"})]})]}),ih.twoFactorEnabled&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{color:"var(--green)",fontWeight:600,marginTop:"var(--space-sm)"},children:" 2FA is enabled"}),c.jsx("p",{className:"hint",children:"Your account is protected with two-factor authentication. Your backup codes are stored securely."}),c.jsx("button",{className:"danger",onClick:sS,style:{marginTop:"var(--space-sm)"},children:"Disable 2FA"})]})]}),c.jsxs("section",{className:"card security-card",children:[c.jsx("h4",{children:" Active Sessions"}),c.jsx("p",{className:"hint",children:"Devices where you're logged in. Sign out of any session you don't recognize."}),S_.map(s=>c.jsxs("div",{className:"session-item",children:[c.jsxs("div",{className:"session-info",children:[c.jsx("strong",{children:s.device}),c.jsx("span",{className:"hint",children:s.location}),c.jsxs("span",{className:"hint",children:["Last active: ",s.lastActive]})]}),c.jsx("button",{className:s.status==="active"?"ghost":"danger",onClick:()=>w(`Session ${s.device} would be signed out.`),children:s.status==="active"?"Current":"Sign Out"})]},s.id))]}),c.jsxs("section",{className:"card security-card danger-card",children:[c.jsx("h4",{children:" Danger Zone"}),c.jsx("p",{className:"hint",children:"Irreversible actions. Proceed with caution."}),c.jsx("button",{className:"danger",onClick:()=>{window.confirm("Are you absolutely sure? This cannot be undone.")&&w("Account deletion request submitted for review.")},children:"Delete Account Permanently"})]}),c.jsxs("section",{className:"card",children:[c.jsx("h4",{children:"Security Privacy"}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox"})," Log out of all other sessions"]}),c.jsxs("label",{children:[c.jsx("input",{type:"checkbox"})," Show security alerts"]}),c.jsx("button",{onClick:()=>w("Privacy settings saved."),children:"Save Security Settings"})]})]}),c.jsx("p",{className:"status",children:N})]})]})})]}):Ji===Kn?c.jsx(FE,{downloadMenuRef:Sd,downloadsMenuOpen:E_,setDownloadsMenuOpen:pd,downloadTargets:up,preferredDownloadTarget:D_,onOpenClient:()=>Wr(hi)}):c.jsx(UE,{authMode:f,setAuthMode:m,email:_,setEmail:p,username:S,setUsername:k,password:M,setPassword:V,pendingVerificationEmail:B,status:N,onSubmit:B_,onResendVerification:V_,onBackHome:()=>Wr(Kn)})}ww(document.getElementById("root")).render(c.jsx(fC.StrictMode,{children:c.jsx(uk,{})}));
